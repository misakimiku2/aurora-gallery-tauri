# 优化首次使用流程 - 避免空白界面

## 问题
用户选择目录后点击"开始使用"，界面显示空白40秒，因为 `scan_directory` 在返回文件树前需要将6.7万张图片批量写入 pending 表（约135个批次 × 0.3秒 = 40秒）。

## 解决方案
将扫描和数据库写入分离，在第一页完成所有工作后才允许进入下一步。

## 实施步骤

### 1. 后端修改（src-tauri/src/main.rs）
- 创建新命令 `add_pending_files_to_db`，接收文件路径列表并批量写入 pending 表
- 修改 `scan_directory` 函数，将批量写入 pending 表的逻辑移除，只返回文件树结构

### 2. 前端修改（src/App.tsx）
- 修改 `handleOpenFolder`：添加 `isScanning` 状态，扫描期间禁用"下一步"
- 修改 `scanAndMerge`：扫描完成后，调用 `add_pending_files_to_db` 将图片路径写入数据库
- 在 `handleWelcomeFinish` 中调用 `resume_color_extraction()` 之前，确保数据库写入已完成

### 3. 前端修改（src/components/modals/WelcomeModal.tsx）
- 修改第一步的"下一步"按钮：添加 `disabled={isScanning}` 属性
- 在扫描期间显示加载状态和进度条
- 扫描完成后才允许点击"下一步"

## 效果
- 第一页：选择目录后立即开始扫描，显示实时进度，等待扫描完成
- 第二页：设置语言、主题
- 点击"开始使用"：立即显示文件树（无空白），后台开始颜色提取