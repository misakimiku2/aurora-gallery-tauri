# CLIP 模型下载问题修复计划

## 问题分析

### 问题1：模型文件名冲突
- **现象**：下载 ViT-B/32 后，ViT-L/14 也显示为已下载
- **原因**：两个模型使用相同的文件名（vision_model.onnx、text_model.onnx、tokenizer.json），都存储在同一目录
- **修复方案**：为每个模型创建独立的子目录

### 问题2：下载进度显示0%
- **现象**：下载时进度条一直显示0%
- **原因**：下载函数没有发送进度更新事件
- **修复方案**：添加下载进度事件机制

## 修复任务列表

### [ ] 任务1：修改模型文件存储结构
- **优先级**：P0
- **描述**：为每个模型创建独立子目录
- **文件**：
  - `src-tauri/src/clip/model.rs` - 修改 ModelInfo 结构体和文件路径逻辑
  - `src-tauri/src/main.rs` - 修改 clip_get_model_status 和 clip_delete_model
- **成功标准**：ViT-B/32 和 ViT-L/14 的文件分别存储在独立目录

### [ ] 任务2：实现下载进度反馈
- **优先级**：P0
- **描述**：添加下载进度事件
- **文件**：
  - `src-tauri/src/clip/model.rs` - 修改 ensure_model_file 函数，添加进度回调
  - `src-tauri/src/main.rs` - 添加进度事件发送
- **成功标准**：下载时前端能收到进度更新

### [ ] 任务3：更新前端进度显示
- **优先级**：P1
- **描述**：前端监听并显示下载进度
- **文件**：
  - `src/components/SettingsModal.tsx` - 添加进度事件监听
  - `src/api/tauri-bridge.ts` - 添加进度事件监听函数
- **成功标准**：进度条能正确更新

### [ ] 任务4：测试修复
- **优先级**：P0
- **描述**：验证修复是否正常工作
- **成功标准**：
  - 下载 ViT-B/32 时进度条正常更新
  - ViT-L/14 不会错误显示为已下载
  - 可以正确删除单个模型
