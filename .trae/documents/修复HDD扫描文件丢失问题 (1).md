## 问题分析

根据文档和代码分析，问题的根本原因是：

1. **并行度过高**：代码使用 16 线程并行扫描 (`RayonNewPool(16)`)，在 HDD 上导致磁头寻道竞争
2. **HDD I/O 瓶颈**：机械硬盘随机读取性能差，高并行度反而降低性能
3. **竞争条件**：生产者线程因 I/O 阻塞变慢，消费者处理更快，导致通道提前关闭

## 修复内容

### 1. 添加 HDD 检测函数
在 `main.rs` 中添加 `is_likely_hdd()` 函数，通过测量小文件随机读取延迟来判断：
- SSD 通常在 0.1-1ms
- HDD 通常在 5-15ms
- 阈值设为 10ms

### 2. 动态调整扫描并行度
修改两处 `jwalk::WalkDir` 的并行度设置：
- **文件计数**（第 636 行附近）
- **文件扫描**（第 672 行附近）

HDD 使用 `Parallelism::Serial`，SSD 使用 `Parallelism::RayonNewPool(16)`

### 3. 添加诊断日志
在扫描过程中添加进度日志，方便排查问题：
- 每 500 个文件输出接收进度
- 扫描完成后输出统计信息
- 如果接收文件数量与预期相差较大，输出警告

## 修改文件

- `src-tauri/src/main.rs`

## 测试验证

修复后需要在 HDD 环境下测试：
1. 首次选择目录扫描应完整扫描所有文件（3121/3121）
2. 刷新功能也应正常工作
3. 控制台应显示 HDD 检测日志和扫描进度日志