<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 0773935f-bbed-4cd7-b726-56bef06683bb (2025-12-17 19:42Z) -->

# 选中内容视觉标识 (2025-12-17 19:42Z)

_**User**_

当前在选择文件或文件夹时，选择标识并不是很清晰，加强选中内容的视觉标识。

---

_**Agent (model default, mode Agent)**_



---


查看文件选择相关代码，了解当前实现：


---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "文件选择 选中状态 selected visual indicator",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 681
          },
          "endPosition": {
            "line": 926,
            "column": 1
          }
        },
        "contents": "const FileListItem = ({\n  file,\n  isSelected,\n  renamingId,\n  onFileClick,\n  onFileDoubleClick,\n  onContextMenu,\n  onStartRename,\n  onRenameSubmit,\n  onRenameCancel,\n  onDragStart,\n  onDragEnd,\n  onDragOver,\n  onDragLeave,\n  onDropOnFolder,\n  onDropExternal,\n  t,\n  dragTargetId,\n  resourceRoot,\n  cachePath\n}: any) =&gt; {\n\n                    &lt;/div&gt;\n                )}\n            &lt;/div&gt;\n            )}\n            {renamingId === file.id ? (\n            &lt;div className=\"w-64 pointer-events-auto\"&gt;\n                &lt;InlineRenameInput\n                    defaultValue={file.name}\n                    onCommit={(val: string) =&gt; onRenameSubmit(val, file.id)}\n                    onCancel={onRenameCancel}\n                /&gt;\n            &lt;/div&gt;\n            ) : (\n            &lt;span\n                className=\"truncate text-gray-900 dark:text-gray-100 font-bold text-sm pointer-events-auto\"\n                onDoubleClick={(e) =&gt; {\n                e.stopPropagation();\n                onStartRename(file.id);\n                }}\n            &gt;{file.name}&lt;/span&gt;\n            )}\n        &lt;/div&gt;\n        &lt;div className=\"w-32 text-xs text-gray-500 truncate hidden sm:block pointer-events-none\"&gt;\n            {file.updatedAt ? new Date(file.updatedAt).toLocaleDateString() : '-'}\n        &lt;/div&gt;\n        &lt;div className=\"w-24 text-xs text-gray-500 uppercase hidden md:block pointer-events-none\"&gt;\n            {file.type === FileType.FOLDER ? t('meta.folderType') : file.meta?.format || '-'}\n        &lt;/div&gt;\n        &lt;div className=\"w-20 text-xs text-gray-500 text-right font-mono hidden sm:block pointer-events-none\"&gt;\n            {file.type === FileType.IMAGE ? formatSize(file.meta?.sizeKb || 0) : '-'}\n        &lt;/div&gt;\n    &lt;/div&gt;\n  );\n});\n\nconst PersonCard = React.memo(({\n  person,\n  files,\n  isSelected,\n  onPersonClick,\n  onPersonDoubleClick,\n  onStartRenamePerson,\n  onPersonContextMenu,\n  t,\n  style\n}: {\n  person: Person;\n  files: Record&lt;string, FileNode&gt;;\n  isSelected: boolean;\n  onPersonClick: (id: string, e: React.MouseEvent) =&gt; void;\n  onPersonDoubleClick: (id: string) =&gt; void;\n  onStartRenamePerson?: (id: string) =&gt; void;\n  onPersonContextMenu: (e: React.MouseEvent, id: string) =&gt; void;\n  t: (key: string) =&gt; string;\n  style: any;\n}) =&gt; {\n  \n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FileListItem = ({",
            "lineNumber": 682
          },
          {
            "text": "  file,",
            "lineNumber": 683
          },
          {
            "text": "  isSelected,",
            "lineNumber": 684
          },
          {
            "text": "  renamingId,",
            "lineNumber": 685
          },
          {
            "text": "  onFileClick,",
            "lineNumber": 686
          },
          {
            "text": "  onFileDoubleClick,",
            "lineNumber": 687
          },
          {
            "text": "  onContextMenu,",
            "lineNumber": 688
          },
          {
            "text": "  onStartRename,",
            "lineNumber": 689
          },
          {
            "text": "  onRenameSubmit,",
            "lineNumber": 690
          },
          {
            "text": "  onRenameCancel,",
            "lineNumber": 691
          },
          {
            "text": "  onDragStart,",
            "lineNumber": 692
          },
          {
            "text": "  onDragEnd,",
            "lineNumber": 693
          },
          {
            "text": "  onDragOver,",
            "lineNumber": 694
          },
          {
            "text": "  onDragLeave,",
            "lineNumber": 695
          },
          {
            "text": "  onDropOnFolder,",
            "lineNumber": 696
          },
          {
            "text": "  onDropExternal,",
            "lineNumber": 697
          },
          {
            "text": "  t,",
            "lineNumber": 698
          },
          {
            "text": "  dragTargetId,",
            "lineNumber": 699
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 700
          },
          {
            "text": "  cachePath",
            "lineNumber": 701
          },
          {
            "text": "}: any) =&gt; {",
            "lineNumber": 702
          },
          {
            "lineNumber": 798
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 799
          },
          {
            "text": "                )}",
            "lineNumber": 800
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 801
          },
          {
            "text": "            )}",
            "lineNumber": 802
          },
          {
            "text": "            {renamingId === file.id ? (",
            "lineNumber": 803
          },
          {
            "text": "            &lt;div className=\"w-64 pointer-events-auto\"&gt;",
            "lineNumber": 804
          },
          {
            "text": "                &lt;InlineRenameInput",
            "lineNumber": 805
          },
          {
            "text": "                    defaultValue={file.name}",
            "lineNumber": 806
          },
          {
            "text": "                    onCommit={(val: string) =&gt; onRenameSubmit(val, file.id)}",
            "lineNumber": 807
          },
          {
            "text": "                    onCancel={onRenameCancel}",
            "lineNumber": 808
          },
          {
            "text": "                /&gt;",
            "lineNumber": 809
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 810
          },
          {
            "text": "            ) : (",
            "lineNumber": 811
          },
          {
            "text": "            &lt;span",
            "lineNumber": 812
          },
          {
            "text": "                className=\"truncate text-gray-900 dark:text-gray-100 font-bold text-sm pointer-events-auto\"",
            "lineNumber": 813
          },
          {
            "text": "                onDoubleClick={(e) =&gt; {",
            "lineNumber": 814
          },
          {
            "text": "                e.stopPropagation();",
            "lineNumber": 815
          },
          {
            "text": "                onStartRename(file.id);",
            "lineNumber": 816
          },
          {
            "text": "                }}",
            "lineNumber": 817
          },
          {
            "text": "            &gt;{file.name}&lt;/span&gt;",
            "lineNumber": 818
          },
          {
            "text": "            )}",
            "lineNumber": 819
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 820
          },
          {
            "text": "        &lt;div className=\"w-32 text-xs text-gray-500 truncate hidden sm:block pointer-events-none\"&gt;",
            "lineNumber": 821
          },
          {
            "text": "            {file.updatedAt ? new Date(file.updatedAt).toLocaleDateString() : '-'}",
            "lineNumber": 822
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 823
          },
          {
            "text": "        &lt;div className=\"w-24 text-xs text-gray-500 uppercase hidden md:block pointer-events-none\"&gt;",
            "lineNumber": 824
          },
          {
            "text": "            {file.type === FileType.FOLDER ? t('meta.folderType') : file.meta?.format || '-'}",
            "lineNumber": 825
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 826
          },
          {
            "text": "        &lt;div className=\"w-20 text-xs text-gray-500 text-right font-mono hidden sm:block pointer-events-none\"&gt;",
            "lineNumber": 827
          },
          {
            "text": "            {file.type === FileType.IMAGE ? formatSize(file.meta?.sizeKb || 0) : '-'}",
            "lineNumber": 828
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 829
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 830
          },
          {
            "text": "  );",
            "lineNumber": 831
          },
          {
            "text": "});",
            "lineNumber": 832
          },
          {
            "lineNumber": 833
          },
          {
            "text": "const PersonCard = React.memo(({",
            "lineNumber": 834
          },
          {
            "text": "  person,",
            "lineNumber": 835
          },
          {
            "text": "  files,",
            "lineNumber": 836
          },
          {
            "text": "  isSelected,",
            "lineNumber": 837
          },
          {
            "text": "  onPersonClick,",
            "lineNumber": 838
          },
          {
            "text": "  onPersonDoubleClick,",
            "lineNumber": 839
          },
          {
            "text": "  onStartRenamePerson,",
            "lineNumber": 840
          },
          {
            "text": "  onPersonContextMenu,",
            "lineNumber": 841
          },
          {
            "text": "  t,",
            "lineNumber": 842
          },
          {
            "text": "  style",
            "lineNumber": 843
          },
          {
            "text": "}: {",
            "lineNumber": 844
          },
          {
            "text": "  person: Person;",
            "lineNumber": 845
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 846
          },
          {
            "text": "  isSelected: boolean;",
            "lineNumber": 847
          },
          {
            "text": "  onPersonClick: (id: string, e: React.MouseEvent) =&gt; void;",
            "lineNumber": 848
          },
          {
            "text": "  onPersonDoubleClick: (id: string) =&gt; void;",
            "lineNumber": 849
          },
          {
            "text": "  onStartRenamePerson?: (id: string) =&gt; void;",
            "lineNumber": 850
          },
          {
            "text": "  onPersonContextMenu: (e: React.MouseEvent, id: string) =&gt; void;",
            "lineNumber": 851
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 852
          },
          {
            "text": "  style: any;",
            "lineNumber": 853
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 854
          },
          {
            "text": "  ",
            "lineNumber": 855
          },
          {
            "text": "};",
            "lineNumber": 927
          }
        ]
      },
      "score": 0.4632020890712738
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleExternalFileDrop = async \n\n      \n      setDragFiles(null);\n  };\n\n  const handleFileClick = (e: React.MouseEvent, id: string) =&gt; {\n    e.stopPropagation();\n    \n    // 关闭右键菜单\n    closeContextMenu();\n    \n    // If we just finished a selection box operation, don't process the click\n    if (isSelecting) return;\n    \n    const isCtrl = e.ctrlKey || e.metaKey; // Ctrl for Windows/Linux, Command for macOS\n    const isShift = e.shiftKey;\n    \n    let newSelectedFileIds: string[];\n    let newLastSelectedId: string = id;\n    \n    if (isCtrl) {\n      // Ctrl+Click: Toggle selection of this file\n      if (activeTab.selectedFileIds.includes(id)) {\n        // Remove from selection\n        newSelectedFileIds = activeTab.selectedFileIds.filter(fileId =&gt; fileId !== id);\n      } else {\n        // Add to selection\n        newSelectedFileIds = [...activeTab.selectedFileIds, id];\n      }\n    } else if (isShift &amp;&amp; activeTab.lastSelectedId &amp;&amp; activeTab.selectedFileIds.length &gt; 0) {\n      // Shift+Click: Select range from last selected to current\n      const currentFolderId = activeTab.folderId;\n      let allFiles: string[] = [];\n      \n      if (activeTab.searchQuery) {\n        // Search results view\n        allFiles = displayFileIds;\n      } else {\n        // Folder view - use displayFileIds which already contains the sorted and filtered list of files to display\n        allFiles = displayFileIds;\n      }\n      \n      const lastIndex = allFiles.indexOf(activeTab.lastSelectedId);\n      const currentIndex = allFiles.indexOf(id);\n      \n      if (lastIndex !== -1 &amp;&amp; currentIndex !== -1) {\n        const start = Math.min(lastIndex, currentIndex);\n        const end = Math.max(lastIndex, currentIndex);\n        newSelectedFileIds = allFiles.slice(start, end + 1);\n      } else {\n        newSelectedFileIds = [id];\n      }\n    } else {\n      // Normal click: Select only this file\n      newSelectedFileIds = [id];\n    }\n    \n    updateActiveTab({ \n        selectedFileIds: newSelectedFileIds, \n        lastSelectedId: newLastSelectedId \n    });\n  };\n\n  const handleMouseDown = (e: React.MouseEvent) =&gt; {\n    // 关闭右键菜单\n    closeContextMenu();\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleExternalFileDrop = async ",
            "lineNumber": 1721
          },
          {
            "lineNumber": 1759
          },
          {
            "text": "      ",
            "lineNumber": 1760
          },
          {
            "text": "      setDragFiles(null);",
            "lineNumber": 1761
          },
          {
            "text": "  };",
            "lineNumber": 1762
          },
          {
            "lineNumber": 1763
          },
          {
            "text": "  const handleFileClick = (e: React.MouseEvent, id: string) =&gt; {",
            "lineNumber": 1764
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 1765
          },
          {
            "text": "    ",
            "lineNumber": 1766
          },
          {
            "text": "    // 关闭右键菜单",
            "lineNumber": 1767
          },
          {
            "text": "    closeContextMenu();",
            "lineNumber": 1768
          },
          {
            "text": "    ",
            "lineNumber": 1769
          },
          {
            "text": "    // If we just finished a selection box operation, don't process the click",
            "lineNumber": 1770
          },
          {
            "text": "    if (isSelecting) return;",
            "lineNumber": 1771
          },
          {
            "text": "    ",
            "lineNumber": 1772
          },
          {
            "text": "    const isCtrl = e.ctrlKey || e.metaKey; // Ctrl for Windows/Linux, Command for macOS",
            "lineNumber": 1773
          },
          {
            "text": "    const isShift = e.shiftKey;",
            "lineNumber": 1774
          },
          {
            "text": "    ",
            "lineNumber": 1775
          },
          {
            "text": "    let newSelectedFileIds: string[];",
            "lineNumber": 1776
          },
          {
            "text": "    let newLastSelectedId: string = id;",
            "lineNumber": 1777
          },
          {
            "text": "    ",
            "lineNumber": 1778
          },
          {
            "text": "    if (isCtrl) {",
            "lineNumber": 1779
          },
          {
            "text": "      // Ctrl+Click: Toggle selection of this file",
            "lineNumber": 1780
          },
          {
            "text": "      if (activeTab.selectedFileIds.includes(id)) {",
            "lineNumber": 1781
          },
          {
            "text": "        // Remove from selection",
            "lineNumber": 1782
          },
          {
            "text": "        newSelectedFileIds = activeTab.selectedFileIds.filter(fileId =&gt; fileId !== id);",
            "lineNumber": 1783
          },
          {
            "text": "      } else {",
            "lineNumber": 1784
          },
          {
            "text": "        // Add to selection",
            "lineNumber": 1785
          },
          {
            "text": "        newSelectedFileIds = [...activeTab.selectedFileIds, id];",
            "lineNumber": 1786
          },
          {
            "text": "      }",
            "lineNumber": 1787
          },
          {
            "text": "    } else if (isShift &amp;&amp; activeTab.lastSelectedId &amp;&amp; activeTab.selectedFileIds.length &gt; 0) {",
            "lineNumber": 1788
          },
          {
            "text": "      // Shift+Click: Select range from last selected to current",
            "lineNumber": 1789
          },
          {
            "text": "      const currentFolderId = activeTab.folderId;",
            "lineNumber": 1790
          },
          {
            "text": "      let allFiles: string[] = [];",
            "lineNumber": 1791
          },
          {
            "text": "      ",
            "lineNumber": 1792
          },
          {
            "text": "      if (activeTab.searchQuery) {",
            "lineNumber": 1793
          },
          {
            "text": "        // Search results view",
            "lineNumber": 1794
          },
          {
            "text": "        allFiles = displayFileIds;",
            "lineNumber": 1795
          },
          {
            "text": "      } else {",
            "lineNumber": 1796
          },
          {
            "text": "        // Folder view - use displayFileIds which already contains the sorted and filtered list of files to display",
            "lineNumber": 1797
          },
          {
            "text": "        allFiles = displayFileIds;",
            "lineNumber": 1798
          },
          {
            "text": "      }",
            "lineNumber": 1799
          },
          {
            "text": "      ",
            "lineNumber": 1800
          },
          {
            "text": "      const lastIndex = allFiles.indexOf(activeTab.lastSelectedId);",
            "lineNumber": 1801
          },
          {
            "text": "      const currentIndex = allFiles.indexOf(id);",
            "lineNumber": 1802
          },
          {
            "text": "      ",
            "lineNumber": 1803
          },
          {
            "text": "      if (lastIndex !== -1 &amp;&amp; currentIndex !== -1) {",
            "lineNumber": 1804
          },
          {
            "text": "        const start = Math.min(lastIndex, currentIndex);",
            "lineNumber": 1805
          },
          {
            "text": "        const end = Math.max(lastIndex, currentIndex);",
            "lineNumber": 1806
          },
          {
            "text": "        newSelectedFileIds = allFiles.slice(start, end + 1);",
            "lineNumber": 1807
          },
          {
            "text": "      } else {",
            "lineNumber": 1808
          },
          {
            "text": "        newSelectedFileIds = [id];",
            "lineNumber": 1809
          },
          {
            "text": "      }",
            "lineNumber": 1810
          },
          {
            "text": "    } else {",
            "lineNumber": 1811
          },
          {
            "text": "      // Normal click: Select only this file",
            "lineNumber": 1812
          },
          {
            "text": "      newSelectedFileIds = [id];",
            "lineNumber": 1813
          },
          {
            "text": "    }",
            "lineNumber": 1814
          },
          {
            "text": "    ",
            "lineNumber": 1815
          },
          {
            "text": "    updateActiveTab({ ",
            "lineNumber": 1816
          },
          {
            "text": "        selectedFileIds: newSelectedFileIds, ",
            "lineNumber": 1817
          },
          {
            "text": "        lastSelectedId: newLastSelectedId ",
            "lineNumber": 1818
          },
          {
            "text": "    });",
            "lineNumber": 1819
          },
          {
            "text": "  };",
            "lineNumber": 1820
          },
          {
            "lineNumber": 1821
          },
          {
            "text": "  const handleMouseDown = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 1822
          },
          {
            "text": "    // 关闭右键菜单",
            "lineNumber": 1823
          },
          {
            "text": "    closeContextMenu();",
            "lineNumber": 1824
          },
          {
            "text": ";",
            "lineNumber": 1855
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.43089380860328674
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 512
          },
          "endPosition": {
            "line": 679,
            "column": 1
          }
        },
        "contents": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {\n(group: string) =&gt; {\n(tag: string) =&gt; {\n\n                           return (\n                              &lt;TagItem \n                                  key={tag}\n                                  tag={tag}\n                                  count={count}\n                                  isSelected={isSelected}\n                                  onTagClick={onTagClick}\n                                  onTagDoubleClick={onTagDoubleClick}\n                                  onTagContextMenu={onTagContextMenu}\n                                  handleMouseEnter={handleMouseEnter}\n                                  handleMouseLeave={handleMouseLeave}\n                              /&gt;\n                           );\n                       })}\n                   &lt;/div&gt;\n              &lt;/div&gt;\n          );\n      })}\n\n      {hoveredTag &amp;&amp; previewImages.length &gt; 0 &amp;&amp; hoveredTagPos &amp;&amp; createPortal(\n        &lt;div \n          className=\"fixed z-[100] bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl p-3 w-64 animate-fade-in pointer-events-none\" \n          style={{ top: hoveredTagPos.top, left: hoveredTagPos.left }}\n        &gt;\n          &lt;div className=\"text-sm text-gray-800 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-600 pb-1 font-bold flex items-center justify-between\"&gt;\n             &lt;span&gt;{t('sidebar.tagPreview')} \"{hoveredTag}\"&lt;/span&gt;\n             &lt;span className=\"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 rounded\"&gt;{previewImages.length} {t('sidebar.recent')}&lt;/span&gt;\n          &lt;/div&gt;\n          &lt;div className=\"grid grid-cols-3 gap-2\"&gt;\n            {previewImages.map((f: any) =&gt; (\n              &lt;div key={f.id} className=\"aspect-square bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-700 overflow-hidden\"&gt;\n                 {/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */}\n                 &lt;div className=\"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center\"&gt;\n                   &lt;ImageIcon className=\"text-gray-400 dark:text-gray-500\" size={20} /&gt;\n                 &lt;/div&gt;\n              &lt;/div&gt;\n            ))}\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {",
            "lineNumber": 513
          },
          {
            "text": "(group: string) =&gt; {",
            "lineNumber": 616
          },
          {
            "text": "(tag: string) =&gt; {",
            "lineNumber": 629
          },
          {
            "lineNumber": 631
          },
          {
            "text": "                           return (",
            "lineNumber": 632
          },
          {
            "text": "                              &lt;TagItem ",
            "lineNumber": 633
          },
          {
            "text": "                                  key={tag}",
            "lineNumber": 634
          },
          {
            "text": "                                  tag={tag}",
            "lineNumber": 635
          },
          {
            "text": "                                  count={count}",
            "lineNumber": 636
          },
          {
            "text": "                                  isSelected={isSelected}",
            "lineNumber": 637
          },
          {
            "text": "                                  onTagClick={onTagClick}",
            "lineNumber": 638
          },
          {
            "text": "                                  onTagDoubleClick={onTagDoubleClick}",
            "lineNumber": 639
          },
          {
            "text": "                                  onTagContextMenu={onTagContextMenu}",
            "lineNumber": 640
          },
          {
            "text": "                                  handleMouseEnter={handleMouseEnter}",
            "lineNumber": 641
          },
          {
            "text": "                                  handleMouseLeave={handleMouseLeave}",
            "lineNumber": 642
          },
          {
            "text": "                              /&gt;",
            "lineNumber": 643
          },
          {
            "text": "                           );",
            "lineNumber": 644
          },
          {
            "text": "                       })}",
            "lineNumber": 645
          },
          {
            "text": "                   &lt;/div&gt;",
            "lineNumber": 646
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 647
          },
          {
            "text": "          );",
            "lineNumber": 648
          },
          {
            "text": "      })}",
            "lineNumber": 649
          },
          {
            "lineNumber": 650
          },
          {
            "text": "      {hoveredTag &amp;&amp; previewImages.length &gt; 0 &amp;&amp; hoveredTagPos &amp;&amp; createPortal(",
            "lineNumber": 651
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 652
          },
          {
            "text": "          className=\"fixed z-[100] bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl p-3 w-64 animate-fade-in pointer-events-none\" ",
            "lineNumber": 653
          },
          {
            "text": "          style={{ top: hoveredTagPos.top, left: hoveredTagPos.left }}",
            "lineNumber": 654
          },
          {
            "text": "        &gt;",
            "lineNumber": 655
          },
          {
            "text": "          &lt;div className=\"text-sm text-gray-800 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-600 pb-1 font-bold flex items-center justify-between\"&gt;",
            "lineNumber": 656
          },
          {
            "text": "             &lt;span&gt;{t('sidebar.tagPreview')} \"{hoveredTag}\"&lt;/span&gt;",
            "lineNumber": 657
          },
          {
            "text": "             &lt;span className=\"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 rounded\"&gt;{previewImages.length} {t('sidebar.recent')}&lt;/span&gt;",
            "lineNumber": 658
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 659
          },
          {
            "text": "          &lt;div className=\"grid grid-cols-3 gap-2\"&gt;",
            "lineNumber": 660
          },
          {
            "text": "            {previewImages.map((f: any) =&gt; (",
            "lineNumber": 661
          },
          {
            "text": "              &lt;div key={f.id} className=\"aspect-square bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-700 overflow-hidden\"&gt;",
            "lineNumber": 662
          },
          {
            "text": "                 {/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */}",
            "lineNumber": 663
          },
          {
            "text": "                 &lt;div className=\"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center\"&gt;",
            "lineNumber": 664
          },
          {
            "text": "                   &lt;ImageIcon className=\"text-gray-400 dark:text-gray-500\" size={20} /&gt;",
            "lineNumber": 665
          },
          {
            "text": "                 &lt;/div&gt;",
            "lineNumber": 666
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 667
          },
          {
            "text": "            ))}",
            "lineNumber": 668
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 669
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 670
          },
          {
            "lineNumber": 672
          },
          {
            "text": "}",
            "lineNumber": 675
          },
          {
            "text": ";",
            "lineNumber": 680
          }
        ]
      },
      "score": 0.4136050045490265
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 449
          },
          "endPosition": {
            "line": 510,
            "column": 1
          }
        },
        "contents": "export const InlineRenameInput = \n\n\n  useEffect(() =&gt; {\n    if (inputRef.current) {\n      inputRef.current.focus();\n      const lastDot = defaultValue.lastIndexOf('.');\n      if (lastDot &gt; 0) {\n        inputRef.current.setSelectionRange(0, lastDot);\n      } else {\n        inputRef.current.select();\n      }\n    }\n  }, []);\n\n  const handleKeyDown = (e: React.KeyboardEvent) =&gt; {\n    if (e.key === 'Enter') {\n      e.stopPropagation();\n      onCommit(inputRef.current?.value || defaultValue);\n    }\n    if (e.key === 'Escape') {\n      e.stopPropagation();\n      onCancel();\n    }\n  };\n\n  return (\n    &lt;input\n      ref={inputRef}\n      type=\"text\"\n      defaultValue={defaultValue}\n      onBlur={(e) =&gt; onCommit(e.target.value)}\n      onKeyDown={handleKeyDown}\n      onClick={(e) =&gt; e.stopPropagation()}\n      onMouseDown={(e) =&gt; e.stopPropagation()}\n      className=\"w-full text-center text-xs font-bold bg-white dark:bg-gray-700 border border-blue-500 rounded px-1 py-0.5 focus:outline-none shadow-sm cursor-text\"\n    /&gt;\n  );\n};\n\nconst TagItem = React.memo(({ tag, count, isSelected, onTagClick, onTagDoubleClick, onTagContextMenu, handleMouseEnter, handleMouseLeave }: any) =&gt; {\n  return (\n    &lt;div \n      key={tag} \n      data-tag={tag}\n      className={&#96;tag-item rounded-lg p-4 border cursor-pointer group transition-all relative ${isSelected ? 'bg-blue-100 dark:bg-blue-900/40 border-blue-500' : 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500'}&#96;} \n      onClick={(e) =&gt; { e.stopPropagation(); onTagClick &amp;&amp; onTagClick(tag, e); }}\n      onMouseDown={(e) =&gt; e.stopPropagation()}\n      onDoubleClick={() =&gt; onTagDoubleClick &amp;&amp; onTagDoubleClick(tag)} \n      onContextMenu={(e) =&gt; onTagContextMenu &amp;&amp; onTagContextMenu(e, tag)}\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export const InlineRenameInput = ",
            "lineNumber": 450
          },
          {
            "lineNumber": 451
          },
          {
            "lineNumber": 452
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 453
          },
          {
            "text": "    if (inputRef.current) {",
            "lineNumber": 454
          },
          {
            "text": "      inputRef.current.focus();",
            "lineNumber": 455
          },
          {
            "text": "      const lastDot = defaultValue.lastIndexOf('.');",
            "lineNumber": 456
          },
          {
            "text": "      if (lastDot &gt; 0) {",
            "lineNumber": 457
          },
          {
            "text": "        inputRef.current.setSelectionRange(0, lastDot);",
            "lineNumber": 458
          },
          {
            "text": "      } else {",
            "lineNumber": 459
          },
          {
            "text": "        inputRef.current.select();",
            "lineNumber": 460
          },
          {
            "text": "      }",
            "lineNumber": 461
          },
          {
            "text": "    }",
            "lineNumber": 462
          },
          {
            "text": "  }, []);",
            "lineNumber": 463
          },
          {
            "lineNumber": 464
          },
          {
            "text": "  const handleKeyDown = (e: React.KeyboardEvent) =&gt; {",
            "lineNumber": 465
          },
          {
            "text": "    if (e.key === 'Enter') {",
            "lineNumber": 466
          },
          {
            "text": "      e.stopPropagation();",
            "lineNumber": 467
          },
          {
            "text": "      onCommit(inputRef.current?.value || defaultValue);",
            "lineNumber": 468
          },
          {
            "text": "    }",
            "lineNumber": 469
          },
          {
            "text": "    if (e.key === 'Escape') {",
            "lineNumber": 470
          },
          {
            "text": "      e.stopPropagation();",
            "lineNumber": 471
          },
          {
            "text": "      onCancel();",
            "lineNumber": 472
          },
          {
            "text": "    }",
            "lineNumber": 473
          },
          {
            "text": "  };",
            "lineNumber": 474
          },
          {
            "lineNumber": 475
          },
          {
            "text": "  return (",
            "lineNumber": 476
          },
          {
            "text": "    &lt;input",
            "lineNumber": 477
          },
          {
            "text": "      ref={inputRef}",
            "lineNumber": 478
          },
          {
            "text": "      type=\"text\"",
            "lineNumber": 479
          },
          {
            "text": "      defaultValue={defaultValue}",
            "lineNumber": 480
          },
          {
            "text": "      onBlur={(e) =&gt; onCommit(e.target.value)}",
            "lineNumber": 481
          },
          {
            "text": "      onKeyDown={handleKeyDown}",
            "lineNumber": 482
          },
          {
            "text": "      onClick={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 483
          },
          {
            "text": "      onMouseDown={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 484
          },
          {
            "text": "      className=\"w-full text-center text-xs font-bold bg-white dark:bg-gray-700 border border-blue-500 rounded px-1 py-0.5 focus:outline-none shadow-sm cursor-text\"",
            "lineNumber": 485
          },
          {
            "text": "    /&gt;",
            "lineNumber": 486
          },
          {
            "text": "  );",
            "lineNumber": 487
          },
          {
            "text": "};",
            "lineNumber": 488
          },
          {
            "lineNumber": 489
          },
          {
            "text": "const TagItem = React.memo(({ tag, count, isSelected, onTagClick, onTagDoubleClick, onTagContextMenu, handleMouseEnter, handleMouseLeave }: any) =&gt; {",
            "lineNumber": 490
          },
          {
            "text": "  return (",
            "lineNumber": 491
          },
          {
            "text": "    &lt;div ",
            "lineNumber": 492
          },
          {
            "text": "      key={tag} ",
            "lineNumber": 493
          },
          {
            "text": "      data-tag={tag}",
            "lineNumber": 494
          },
          {
            "text": "      className={&#96;tag-item rounded-lg p-4 border cursor-pointer group transition-all relative ${isSelected ? 'bg-blue-100 dark:bg-blue-900/40 border-blue-500' : 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500'}&#96;} ",
            "lineNumber": 495
          },
          {
            "text": "      onClick={(e) =&gt; { e.stopPropagation(); onTagClick &amp;&amp; onTagClick(tag, e); }}",
            "lineNumber": 496
          },
          {
            "text": "      onMouseDown={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 497
          },
          {
            "text": "      onDoubleClick={() =&gt; onTagDoubleClick &amp;&amp; onTagDoubleClick(tag)} ",
            "lineNumber": 498
          },
          {
            "text": "      onContextMenu={(e) =&gt; onTagContextMenu &amp;&amp; onTagContextMenu(e, tag)}",
            "lineNumber": 499
          },
          {
            "text": "};",
            "lineNumber": 511
          }
        ]
      },
      "score": 0.3806627094745636
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 40
          },
          "endPosition": {
            "line": 105,
            "column": 1
          }
        },
        "contents": "const ClearPersonModal = \n\"&gt; \n        {peopleList.map((p: Person) =&gt; { \n          const coverFile = files[p.coverFileId]; \n          const hasCover = !!coverFile; \n          const isSelected = selectedPeople.includes(p.id); \n          return ( \n            &lt;div key={p.id} onClick={() =&gt; handleTogglePerson(p.id)} className={&#96;flex items-center p-2 rounded cursor-pointer group ${isSelected ? 'bg-blue-50 dark:bg-blue-900/30 border-l-2 border-blue-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}&#96;}&gt; \n              &lt;div className=\"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 overflow-hidden mr-3 flex items-center justify-center\"&gt;\n                {hasCover ? (/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */&lt;div className=\"w-full h-full flex items-center justify-center bg-gray-300 dark:bg-gray-700\"&gt;&lt;User size={14} className=\"text-gray-400 dark:text-gray-500\" /&gt;&lt;/div&gt;) : (\n                  &lt;User size={14} className=\"text-gray-400 dark:text-gray-500\" /&gt;\n                )}\n              &lt;/div&gt; \n              &lt;span className=\"text-sm text-gray-800 dark:text-gray-200 flex-1\"&gt;{p.name}&lt;/span&gt; \n              &lt;div className={&#96;w-4 h-4 rounded border-2 flex items-center justify-center ${isSelected ? 'border-blue-500 bg-blue-500' : 'border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800'}&#96;}&gt; \n                {isSelected &amp;&amp; &lt;Check size={12} className=\"text-white\" /&gt;} \n              &lt;/div&gt; \n            &lt;/div&gt; \n          ); \n        })}\n      &lt;/div&gt; \n      &lt;div className=\"flex justify-end space-x-2\"&gt; \n        &lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;{t('settings.cancel')}&lt;/button&gt; \n        \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 41,
                "column": 1
              },
              "endPosition": {
                "line": 41,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 41,
                "column": 7
              },
              "endPosition": {
                "line": 41,
                "column": 26
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const ClearPersonModal = ",
            "lineNumber": 41
          },
          {
            "text": "\"&gt; ",
            "lineNumber": 80
          },
          {
            "text": "        {peopleList.map((p: Person) =&gt; { ",
            "lineNumber": 81
          },
          {
            "text": "          const coverFile = files[p.coverFileId]; ",
            "lineNumber": 82
          },
          {
            "text": "          const hasCover = !!coverFile; ",
            "lineNumber": 83
          },
          {
            "text": "          const isSelected = selectedPeople.includes(p.id); ",
            "lineNumber": 84
          },
          {
            "text": "          return ( ",
            "lineNumber": 85
          },
          {
            "text": "            &lt;div key={p.id} onClick={() =&gt; handleTogglePerson(p.id)} className={&#96;flex items-center p-2 rounded cursor-pointer group ${isSelected ? 'bg-blue-50 dark:bg-blue-900/30 border-l-2 border-blue-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}&#96;}&gt; ",
            "lineNumber": 86
          },
          {
            "text": "              &lt;div className=\"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 overflow-hidden mr-3 flex items-center justify-center\"&gt;",
            "lineNumber": 87
          },
          {
            "text": "                {hasCover ? (/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */&lt;div className=\"w-full h-full flex items-center justify-center bg-gray-300 dark:bg-gray-700\"&gt;&lt;User size={14} className=\"text-gray-400 dark:text-gray-500\" /&gt;&lt;/div&gt;) : (",
            "lineNumber": 88
          },
          {
            "text": "                  &lt;User size={14} className=\"text-gray-400 dark:text-gray-500\" /&gt;",
            "lineNumber": 89
          },
          {
            "text": "                )}",
            "lineNumber": 90
          },
          {
            "text": "              &lt;/div&gt; ",
            "lineNumber": 91
          },
          {
            "text": "              &lt;span className=\"text-sm text-gray-800 dark:text-gray-200 flex-1\"&gt;{p.name}&lt;/span&gt; ",
            "lineNumber": 92
          },
          {
            "text": "              &lt;div className={&#96;w-4 h-4 rounded border-2 flex items-center justify-center ${isSelected ? 'border-blue-500 bg-blue-500' : 'border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800'}&#96;}&gt; ",
            "lineNumber": 93
          },
          {
            "text": "                {isSelected &amp;&amp; &lt;Check size={12} className=\"text-white\" /&gt;} ",
            "lineNumber": 94
          },
          {
            "text": "              &lt;/div&gt; ",
            "lineNumber": 95
          },
          {
            "text": "            &lt;/div&gt; ",
            "lineNumber": 96
          },
          {
            "text": "          ); ",
            "lineNumber": 97
          },
          {
            "text": "        })}",
            "lineNumber": 98
          },
          {
            "text": "      &lt;/div&gt; ",
            "lineNumber": 99
          },
          {
            "text": "      &lt;div className=\"flex justify-end space-x-2\"&gt; ",
            "lineNumber": 100
          },
          {
            "text": "        &lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;{t('settings.cancel')}&lt;/button&gt; ",
            "lineNumber": 101
          },
          {
            "text": "        ",
            "lineNumber": 102
          },
          {
            "text": ";",
            "lineNumber": 106
          }
        ]
      },
      "score": 0.3731522560119629
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleMouseUp = (e: React.MouseEvent) =&gt; {\n\n    \n    // Update selection based on view mode\n    if (activeTab.viewMode === 'browser') {\n      // File selection - simple and reliable approach using viewport coordinates directly\n      const selectedIds: string[] = [];\n      \n      // Get all file elements in the current FileGrid container\n      const allFileElements = container.querySelectorAll('.file-item');\n      \n      // Loop through all file elements and check if they are in the selection box\n      allFileElements.forEach(element =&gt; {\n        const id = element.getAttribute('data-id');\n        if (id) {\n          // Get the element's bounding rect in viewport coordinates\n          const rect = element.getBoundingClientRect();\n          \n          // Check if element overlaps with selection box in viewport coordinates\n          if (rect.left &lt; selectionRight &amp;&amp; \n              rect.right &gt; selectionLeft &amp;&amp; \n              rect.top &lt; selectionBottom &amp;&amp; \n              rect.bottom &gt; selectionTop) {\n            selectedIds.push(id);\n          }\n        }\n      });\n      \n      // Always update selection, regardless of whether any files were selected\n      updateActiveTab({\n        selectedFileIds: selectedIds,\n        lastSelectedId: selectedIds[selectedIds.length - 1] || null\n      });\n    } else if (activeTab.viewMode === 'tags-overview') {\n      // Tag selection - optimized with efficient checking\n      const selectedTagIds: string[] = [];\n      const tagElements = document.querySelectorAll('.tag-item');\n  };\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1885,
                "column": 3
              },
              "endPosition": {
                "line": 1885,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1885,
                "column": 9
              },
              "endPosition": {
                "line": 1885,
                "column": 25
              }
            },
            {
              "startPosition": {
                "line": 1885,
                "column": 37
              },
              "endPosition": {
                "line": 1886,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleMouseUp = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 1884
          },
          {
            "lineNumber": 1907
          },
          {
            "text": "    ",
            "lineNumber": 1908
          },
          {
            "text": "    // Update selection based on view mode",
            "lineNumber": 1909
          },
          {
            "text": "    if (activeTab.viewMode === 'browser') {",
            "lineNumber": 1910
          },
          {
            "text": "      // File selection - simple and reliable approach using viewport coordinates directly",
            "lineNumber": 1911
          },
          {
            "text": "      const selectedIds: string[] = [];",
            "lineNumber": 1912
          },
          {
            "text": "      ",
            "lineNumber": 1913
          },
          {
            "text": "      // Get all file elements in the current FileGrid container",
            "lineNumber": 1914
          },
          {
            "text": "      const allFileElements = container.querySelectorAll('.file-item');",
            "lineNumber": 1915
          },
          {
            "text": "      ",
            "lineNumber": 1916
          },
          {
            "text": "      // Loop through all file elements and check if they are in the selection box",
            "lineNumber": 1917
          },
          {
            "text": "      allFileElements.forEach(element =&gt; {",
            "lineNumber": 1918
          },
          {
            "text": "        const id = element.getAttribute('data-id');",
            "lineNumber": 1919
          },
          {
            "text": "        if (id) {",
            "lineNumber": 1920
          },
          {
            "text": "          // Get the element's bounding rect in viewport coordinates",
            "lineNumber": 1921
          },
          {
            "text": "          const rect = element.getBoundingClientRect();",
            "lineNumber": 1922
          },
          {
            "text": "          ",
            "lineNumber": 1923
          },
          {
            "text": "          // Check if element overlaps with selection box in viewport coordinates",
            "lineNumber": 1924
          },
          {
            "text": "          if (rect.left &lt; selectionRight &amp;&amp; ",
            "lineNumber": 1925
          },
          {
            "text": "              rect.right &gt; selectionLeft &amp;&amp; ",
            "lineNumber": 1926
          },
          {
            "text": "              rect.top &lt; selectionBottom &amp;&amp; ",
            "lineNumber": 1927
          },
          {
            "text": "              rect.bottom &gt; selectionTop) {",
            "lineNumber": 1928
          },
          {
            "text": "            selectedIds.push(id);",
            "lineNumber": 1929
          },
          {
            "text": "          }",
            "lineNumber": 1930
          },
          {
            "text": "        }",
            "lineNumber": 1931
          },
          {
            "text": "      });",
            "lineNumber": 1932
          },
          {
            "text": "      ",
            "lineNumber": 1933
          },
          {
            "text": "      // Always update selection, regardless of whether any files were selected",
            "lineNumber": 1934
          },
          {
            "text": "      updateActiveTab({",
            "lineNumber": 1935
          },
          {
            "text": "        selectedFileIds: selectedIds,",
            "lineNumber": 1936
          },
          {
            "text": "        lastSelectedId: selectedIds[selectedIds.length - 1] || null",
            "lineNumber": 1937
          },
          {
            "text": "      });",
            "lineNumber": 1938
          },
          {
            "text": "    } else if (activeTab.viewMode === 'tags-overview') {",
            "lineNumber": 1939
          },
          {
            "text": "      // Tag selection - optimized with efficient checking",
            "lineNumber": 1940
          },
          {
            "text": "      const selectedTagIds: string[] = [];",
            "lineNumber": 1941
          },
          {
            "text": "      const tagElements = document.querySelectorAll('.tag-item');",
            "lineNumber": 1942
          },
          {
            "text": "  };",
            "lineNumber": 2009
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.36030030250549316
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1477
          },
          "endPosition": {
            "line": 1958,
            "column": 1
          }
        },
        "contents": "export const FileGrid: React.FC&lt;FileGridProps&gt; = \n\n  onBackgroundContextMenu,\n  people,\n  groupedTags,\n  onPersonClick,\n  onPersonContextMenu,\n  onPersonDoubleClick,\n  onStartRenamePerson,\n  onTagClick,\n  onTagContextMenu,\n  onTagDoubleClick,\n  groupedFiles = [],\n  groupBy = 'none',\n  collapsedGroups = {},\n  onToggleGroup,\n  isSelecting,\n  selectionBox,\n  t,\n  onThumbnailSizeChange,\n  onUpdateFile,\n  settings,\n  onScrollTopChange\n}) =&gt; {\n  // #region agent log\n  // Removed debug logs\n  // #endregion\n\n  const [dragTargetId, setDragTargetId] = useState&lt;string | null&gt;(null);\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const FileGrid: React.FC&lt;FileGridProps&gt; = ",
            "lineNumber": 1478
          },
          {
            "lineNumber": 1501
          },
          {
            "text": "  onBackgroundContextMenu,",
            "lineNumber": 1502
          },
          {
            "text": "  people,",
            "lineNumber": 1503
          },
          {
            "text": "  groupedTags,",
            "lineNumber": 1504
          },
          {
            "text": "  onPersonClick,",
            "lineNumber": 1505
          },
          {
            "text": "  onPersonContextMenu,",
            "lineNumber": 1506
          },
          {
            "text": "  onPersonDoubleClick,",
            "lineNumber": 1507
          },
          {
            "text": "  onStartRenamePerson,",
            "lineNumber": 1508
          },
          {
            "text": "  onTagClick,",
            "lineNumber": 1509
          },
          {
            "text": "  onTagContextMenu,",
            "lineNumber": 1510
          },
          {
            "text": "  onTagDoubleClick,",
            "lineNumber": 1511
          },
          {
            "text": "  groupedFiles = [],",
            "lineNumber": 1512
          },
          {
            "text": "  groupBy = 'none',",
            "lineNumber": 1513
          },
          {
            "text": "  collapsedGroups = {},",
            "lineNumber": 1514
          },
          {
            "text": "  onToggleGroup,",
            "lineNumber": 1515
          },
          {
            "text": "  isSelecting,",
            "lineNumber": 1516
          },
          {
            "text": "  selectionBox,",
            "lineNumber": 1517
          },
          {
            "text": "  t,",
            "lineNumber": 1518
          },
          {
            "text": "  onThumbnailSizeChange,",
            "lineNumber": 1519
          },
          {
            "text": "  onUpdateFile,",
            "lineNumber": 1520
          },
          {
            "text": "  settings,",
            "lineNumber": 1521
          },
          {
            "text": "  onScrollTopChange",
            "lineNumber": 1522
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 1523
          },
          {
            "text": "  // #region agent log",
            "lineNumber": 1524
          },
          {
            "text": "  // Removed debug logs",
            "lineNumber": 1525
          },
          {
            "text": "  // #endregion",
            "lineNumber": 1526
          },
          {
            "lineNumber": 1527
          },
          {
            "text": "  const [dragTargetId, setDragTargetId] = useState&lt;string | null&gt;(null);",
            "lineNumber": 1528
          },
          {
            "text": ";",
            "lineNumber": 1959
          }
        ]
      },
      "score": 0.34409329295158386
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 107
          },
          "endPosition": {
            "line": 253,
            "column": 1
          }
        },
        "contents": "const FolderPickerModal = \nconst findMatchingFolders = \n\n    \n    return matchingFolders;\n  };\n  \n  // 递归渲染文件夹树，支持搜索过滤\n  const renderTree = (nodeId: string, depth = 0, matchingFolders?: Set&lt;string&gt; | null) =&gt; {\n    const node = files[nodeId];\n    if (!node || node.type !== FileType.FOLDER) return null;\n    if (selectedFileIds.includes(nodeId)) return null;\n    \n    // 如果有搜索条件，检查当前文件夹是否应该显示\n    const shouldShow = !matchingFolders || matchingFolders.has(nodeId);\n    if (!shouldShow) return null;\n    \n    const expanded = expandedIds.includes(nodeId);\n    const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];\n    \n    return (\n      &lt;div key={nodeId}&gt;\n        &lt;div \n          className={&#96;flex items-center py-1 px-2 cursor-pointer text-sm ${currentId === nodeId ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300' : 'hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300'}&#96;}\n          style={{ paddingLeft: &#96;${depth * 16 + 8}px&#96; }}\n          onClick={() =&gt; setCurrentId(nodeId)}\n        &gt;\n          {/* 展开/折叠按钮 */}\n          &lt;div \n            className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\"\n            onClick={(e) =&gt; handleToggle(e, nodeId)}\n          &gt;\n            {folderChildren.length &gt; 0 ? (\n              expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;\n            ) : &lt;div className=\"w-[14px]\" /&gt;}\n          &lt;/div&gt;\n          &lt;Folder size={14} className=\"mr-2 text-blue-500\"/&gt;\n          &lt;span className=\"truncate\"&gt;{node.name}&lt;/span&gt;\n        &lt;/div&gt;\n        {/* 只渲染展开的文件夹 */}\n        {expanded &amp;&amp; folderChildren.map((childId: string) =&gt; renderTree(childId, depth + 1, matchingFolders))}\n      &lt;/div&gt;\n    );\n  };\n  \n  const matchingFolders = findMatchingFolders();\n  \n  return (\n    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 108,
                "column": 1
              },
              "endPosition": {
                "line": 108,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 108,
                "column": 7
              },
              "endPosition": {
                "line": 108,
                "column": 27
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ",
            "lineNumber": 108
          },
          {
            "text": "const findMatchingFolders = ",
            "lineNumber": 127
          },
          {
            "lineNumber": 163
          },
          {
            "text": "    ",
            "lineNumber": 164
          },
          {
            "text": "    return matchingFolders;",
            "lineNumber": 165
          },
          {
            "text": "  };",
            "lineNumber": 166
          },
          {
            "text": "  ",
            "lineNumber": 167
          },
          {
            "text": "  // 递归渲染文件夹树，支持搜索过滤",
            "lineNumber": 168
          },
          {
            "text": "  const renderTree = (nodeId: string, depth = 0, matchingFolders?: Set&lt;string&gt; | null) =&gt; {",
            "lineNumber": 169
          },
          {
            "text": "    const node = files[nodeId];",
            "lineNumber": 170
          },
          {
            "text": "    if (!node || node.type !== FileType.FOLDER) return null;",
            "lineNumber": 171
          },
          {
            "text": "    if (selectedFileIds.includes(nodeId)) return null;",
            "lineNumber": 172
          },
          {
            "text": "    ",
            "lineNumber": 173
          },
          {
            "text": "    // 如果有搜索条件，检查当前文件夹是否应该显示",
            "lineNumber": 174
          },
          {
            "text": "    const shouldShow = !matchingFolders || matchingFolders.has(nodeId);",
            "lineNumber": 175
          },
          {
            "text": "    if (!shouldShow) return null;",
            "lineNumber": 176
          },
          {
            "text": "    ",
            "lineNumber": 177
          },
          {
            "text": "    const expanded = expandedIds.includes(nodeId);",
            "lineNumber": 178
          },
          {
            "text": "    const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];",
            "lineNumber": 179
          },
          {
            "text": "    ",
            "lineNumber": 180
          },
          {
            "text": "    return (",
            "lineNumber": 181
          },
          {
            "text": "      &lt;div key={nodeId}&gt;",
            "lineNumber": 182
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 183
          },
          {
            "text": "          className={&#96;flex items-center py-1 px-2 cursor-pointer text-sm ${currentId === nodeId ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300' : 'hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300'}&#96;}",
            "lineNumber": 184
          },
          {
            "text": "          style={{ paddingLeft: &#96;${depth * 16 + 8}px&#96; }}",
            "lineNumber": 185
          },
          {
            "text": "          onClick={() =&gt; setCurrentId(nodeId)}",
            "lineNumber": 186
          },
          {
            "text": "        &gt;",
            "lineNumber": 187
          },
          {
            "text": "          {/* 展开/折叠按钮 */}",
            "lineNumber": 188
          },
          {
            "text": "          &lt;div ",
            "lineNumber": 189
          },
          {
            "text": "            className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\"",
            "lineNumber": 190
          },
          {
            "text": "            onClick={(e) =&gt; handleToggle(e, nodeId)}",
            "lineNumber": 191
          },
          {
            "text": "          &gt;",
            "lineNumber": 192
          },
          {
            "text": "            {folderChildren.length &gt; 0 ? (",
            "lineNumber": 193
          },
          {
            "text": "              expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;",
            "lineNumber": 194
          },
          {
            "text": "            ) : &lt;div className=\"w-[14px]\" /&gt;}",
            "lineNumber": 195
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 196
          },
          {
            "text": "          &lt;Folder size={14} className=\"mr-2 text-blue-500\"/&gt;",
            "lineNumber": 197
          },
          {
            "text": "          &lt;span className=\"truncate\"&gt;{node.name}&lt;/span&gt;",
            "lineNumber": 198
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 199
          },
          {
            "text": "        {/* 只渲染展开的文件夹 */}",
            "lineNumber": 200
          },
          {
            "text": "        {expanded &amp;&amp; folderChildren.map((childId: string) =&gt; renderTree(childId, depth + 1, matchingFolders))}",
            "lineNumber": 201
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 202
          },
          {
            "text": "    );",
            "lineNumber": 203
          },
          {
            "text": "  };",
            "lineNumber": 204
          },
          {
            "text": "  ",
            "lineNumber": 205
          },
          {
            "text": "  const matchingFolders = findMatchingFolders();",
            "lineNumber": 206
          },
          {
            "text": "  ",
            "lineNumber": 207
          },
          {
            "text": "  return (",
            "lineNumber": 208
          },
          {
            "text": "    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in",
            "lineNumber": 209
          },
          {
            "text": ";",
            "lineNumber": 254
          }
        ]
      },
      "score": 0.3357873857021332
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 16,
            "column": 1
          },
          "endPosition": {
            "line": 126,
            "column": 1
          }
        },
        "contents": "const TreeNode: React.FC&lt;TreeProps&gt; = ({ files, nodeId, currentFolderId, expandedIds, onToggle, onNavigate, onContextMenu, onDrop, depth = 0 }) =&gt; {\n  const node = files[nodeId];\n  const [isDragOver, setIsDragOver] = useState(false);\n\n  if (!node || node.type !== FileType.FOLDER) return null;\n\n  const isRoot = depth === 0;\n  const isSelected = nodeId === currentFolderId;\n  const expanded = expandedIds.includes(nodeId);\n  \n  const folderChildren = node.children?.filter(childId =&gt; files[childId]?.type === FileType.FOLDER) || [];\n\n  const handleToggle = (e: React.MouseEvent) =&gt; {\n    e.stopPropagation();\n    onToggle(nodeId);\n  };\n\n  const handleClick = () =&gt; {\n    onNavigate(nodeId);\n  };\n\n  const handleContextMenu = (e: React.MouseEvent) =&gt; {\n    onContextMenu(e, isRoot ? 'root-folder' : 'file', nodeId);\n  };\n\n  const handleDragOver = (e: React.DragEvent) =&gt; {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(true);\n    e.dataTransfer.dropEffect = 'move';\n  };\n\n  const handleDragLeave = (e: React.DragEvent) =&gt; {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) =&gt; {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n    \n    const data = e.dataTransfer.getData('application/json');\n    if (data) {\n      try {\n        const sourceIds = JSON.parse(data);\n        if (Array.isArray(sourceIds) &amp;&amp; sourceIds.length &gt; 0) {\n          onDrop(nodeId, sourceIds);\n        }\n      } catch (err) {\n        console.error('Failed to parse drop data', err);\n      }\n    }\n  };\n\n  const Icon = isRoot \n    ? HardDrive \n    : (node.category === 'book' ? Book : node.category === 'sequence' ? Film : Folder);\n\n  const iconColorClass = isSelected ? 'text-white' : (\n      node.category === 'book' ? 'text-amber-500' :\n      node.category === 'sequence' ? 'text-purple-500' :\n      'text-blue-500 dark:text-blue-400'\n  );\n\n  return (\n    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const TreeNode: React.FC&lt;TreeProps&gt; = ({ files, nodeId, currentFolderId, expandedIds, onToggle, onNavigate, onContextMenu, onDrop, depth = 0 }) =&gt; {",
            "lineNumber": 19
          },
          {
            "text": "  const node = files[nodeId];",
            "lineNumber": 20
          },
          {
            "text": "  const [isDragOver, setIsDragOver] = useState(false);",
            "lineNumber": 21
          },
          {
            "lineNumber": 22
          },
          {
            "text": "  if (!node || node.type !== FileType.FOLDER) return null;",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "  const isRoot = depth === 0;",
            "lineNumber": 25
          },
          {
            "text": "  const isSelected = nodeId === currentFolderId;",
            "lineNumber": 26
          },
          {
            "text": "  const expanded = expandedIds.includes(nodeId);",
            "lineNumber": 27
          },
          {
            "text": "  ",
            "lineNumber": 28
          },
          {
            "text": "  const folderChildren = node.children?.filter(childId =&gt; files[childId]?.type === FileType.FOLDER) || [];",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "  const handleToggle = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 31
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 32
          },
          {
            "text": "    onToggle(nodeId);",
            "lineNumber": 33
          },
          {
            "text": "  };",
            "lineNumber": 34
          },
          {
            "lineNumber": 35
          },
          {
            "text": "  const handleClick = () =&gt; {",
            "lineNumber": 36
          },
          {
            "text": "    onNavigate(nodeId);",
            "lineNumber": 37
          },
          {
            "text": "  };",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "  const handleContextMenu = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 40
          },
          {
            "text": "    onContextMenu(e, isRoot ? 'root-folder' : 'file', nodeId);",
            "lineNumber": 41
          },
          {
            "text": "  };",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "  const handleDragOver = (e: React.DragEvent) =&gt; {",
            "lineNumber": 44
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 45
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 46
          },
          {
            "text": "    setIsDragOver(true);",
            "lineNumber": 47
          },
          {
            "text": "    e.dataTransfer.dropEffect = 'move';",
            "lineNumber": 48
          },
          {
            "text": "  };",
            "lineNumber": 49
          },
          {
            "lineNumber": 50
          },
          {
            "text": "  const handleDragLeave = (e: React.DragEvent) =&gt; {",
            "lineNumber": 51
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 52
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 53
          },
          {
            "text": "    setIsDragOver(false);",
            "lineNumber": 54
          },
          {
            "text": "  };",
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "  const handleDrop = (e: React.DragEvent) =&gt; {",
            "lineNumber": 57
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 58
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 59
          },
          {
            "text": "    setIsDragOver(false);",
            "lineNumber": 60
          },
          {
            "text": "    ",
            "lineNumber": 61
          },
          {
            "text": "    const data = e.dataTransfer.getData('application/json');",
            "lineNumber": 62
          },
          {
            "text": "    if (data) {",
            "lineNumber": 63
          },
          {
            "text": "      try {",
            "lineNumber": 64
          },
          {
            "text": "        const sourceIds = JSON.parse(data);",
            "lineNumber": 65
          },
          {
            "text": "        if (Array.isArray(sourceIds) &amp;&amp; sourceIds.length &gt; 0) {",
            "lineNumber": 66
          },
          {
            "text": "          onDrop(nodeId, sourceIds);",
            "lineNumber": 67
          },
          {
            "text": "        }",
            "lineNumber": 68
          },
          {
            "text": "      } catch (err) {",
            "lineNumber": 69
          },
          {
            "text": "        console.error('Failed to parse drop data', err);",
            "lineNumber": 70
          },
          {
            "text": "      }",
            "lineNumber": 71
          },
          {
            "text": "    }",
            "lineNumber": 72
          },
          {
            "text": "  };",
            "lineNumber": 73
          },
          {
            "lineNumber": 74
          },
          {
            "text": "  const Icon = isRoot ",
            "lineNumber": 75
          },
          {
            "text": "    ? HardDrive ",
            "lineNumber": 76
          },
          {
            "text": "    : (node.category === 'book' ? Book : node.category === 'sequence' ? Film : Folder);",
            "lineNumber": 77
          },
          {
            "lineNumber": 78
          },
          {
            "text": "  const iconColorClass = isSelected ? 'text-white' : (",
            "lineNumber": 79
          },
          {
            "text": "      node.category === 'book' ? 'text-amber-500' :",
            "lineNumber": 80
          },
          {
            "text": "      node.category === 'sequence' ? 'text-purple-500' :",
            "lineNumber": 81
          },
          {
            "text": "      'text-blue-500 dark:text-blue-400'",
            "lineNumber": 82
          },
          {
            "text": "  );",
            "lineNumber": 83
          },
          {
            "lineNumber": 84
          },
          {
            "text": "  return (",
            "lineNumber": 85
          },
          {
            "text": "    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300",
            "lineNumber": 86
          },
          {
            "text": ";",
            "lineNumber": 127
          }
        ]
      },
      "score": 0.3261061906814575
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 246
          },
          "endPosition": {
            "line": 1381,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \n(e) =&gt; {\n (e.key === 'Enter') {\n                            handleUpdateMeta();\n                        }\n                    }}\n                    placeholder=\"https://...\"\n                    className=\"flex-1 bg-transparent border-none py-2 px-3 text-sm text-blue-600 dark:text-blue-400 placeholder-gray-400 focus:outline-none\"\n                /&gt;\n                {(isMulti ? batchSource : source) &amp;&amp; (\n                    &lt;button \n                      onClick={() =&gt; window.electron?.openExternal(isMulti ? batchSource : source)}\n                      className=\"p-2 text-gray-400 hover:text-blue-500\"\n                      title={t('meta.openSource')}\n                    &gt;\n                        &lt;ExternalLink size={14} /&gt;\n                    &lt;/button&gt;\n                )}\n            &lt;/div&gt;\n            {isMulti &amp;&amp; (\n                &lt;div className=\"mt-3 space-y-2 max-h-40 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-200 dark:scrollbar-thumb-gray-700 pr-1\"&gt;\n                    {selectedFileIds.map(id =&gt; {\n                        const f = files[id];\n                        if (!f || !f.sourceUrl) return null;\n                        return (\n                            &lt;div key={id} className=\"flex items-center text-xs group bg-gray-50 dark:bg-gray-800/50 p-1.5 rounded border border-transparent hover:border-gray-200 dark:hover:border-gray-700 transition-colors\"&gt;\n                                &lt;div className=\"text-gray-500 dark:text-gray-400 w-20 truncate mr-2 font-medium shrink-0\" title={f.name}&gt;{f.name}&lt;/div&gt;\n                                &lt;button \n                                    onClick=\n                    }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 247
          },
          {
            "text": "(e) =&gt; {",
            "lineNumber": 1300
          },
          {
            "text": " (e.key === 'Enter') {",
            "lineNumber": 1301
          },
          {
            "text": "                            handleUpdateMeta();",
            "lineNumber": 1302
          },
          {
            "text": "                        }",
            "lineNumber": 1303
          },
          {
            "text": "                    }}",
            "lineNumber": 1304
          },
          {
            "text": "                    placeholder=\"https://...\"",
            "lineNumber": 1305
          },
          {
            "text": "                    className=\"flex-1 bg-transparent border-none py-2 px-3 text-sm text-blue-600 dark:text-blue-400 placeholder-gray-400 focus:outline-none\"",
            "lineNumber": 1306
          },
          {
            "text": "                /&gt;",
            "lineNumber": 1307
          },
          {
            "text": "                {(isMulti ? batchSource : source) &amp;&amp; (",
            "lineNumber": 1308
          },
          {
            "text": "                    &lt;button ",
            "lineNumber": 1309
          },
          {
            "text": "                      onClick={() =&gt; window.electron?.openExternal(isMulti ? batchSource : source)}",
            "lineNumber": 1310
          },
          {
            "text": "                      className=\"p-2 text-gray-400 hover:text-blue-500\"",
            "lineNumber": 1311
          },
          {
            "text": "                      title={t('meta.openSource')}",
            "lineNumber": 1312
          },
          {
            "text": "                    &gt;",
            "lineNumber": 1313
          },
          {
            "text": "                        &lt;ExternalLink size={14} /&gt;",
            "lineNumber": 1314
          },
          {
            "text": "                    &lt;/button&gt;",
            "lineNumber": 1315
          },
          {
            "text": "                )}",
            "lineNumber": 1316
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 1317
          },
          {
            "text": "            {isMulti &amp;&amp; (",
            "lineNumber": 1318
          },
          {
            "text": "                &lt;div className=\"mt-3 space-y-2 max-h-40 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-200 dark:scrollbar-thumb-gray-700 pr-1\"&gt;",
            "lineNumber": 1319
          },
          {
            "text": "                    {selectedFileIds.map(id =&gt; {",
            "lineNumber": 1320
          },
          {
            "text": "                        const f = files[id];",
            "lineNumber": 1321
          },
          {
            "text": "                        if (!f || !f.sourceUrl) return null;",
            "lineNumber": 1322
          },
          {
            "text": "                        return (",
            "lineNumber": 1323
          },
          {
            "text": "                            &lt;div key={id} className=\"flex items-center text-xs group bg-gray-50 dark:bg-gray-800/50 p-1.5 rounded border border-transparent hover:border-gray-200 dark:hover:border-gray-700 transition-colors\"&gt;",
            "lineNumber": 1324
          },
          {
            "text": "                                &lt;div className=\"text-gray-500 dark:text-gray-400 w-20 truncate mr-2 font-medium shrink-0\" title={f.name}&gt;{f.name}&lt;/div&gt;",
            "lineNumber": 1325
          },
          {
            "text": "                                &lt;button ",
            "lineNumber": 1326
          },
          {
            "text": "                                    onClick=",
            "lineNumber": 1327
          },
          {
            "text": "                    }",
            "lineNumber": 1335
          },
          {
            "text": ";",
            "lineNumber": 1382
          }
        ]
      },
      "score": 0.32220810651779175
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n  const [showSplash, setShowSplash] = useState(true);\n  const [hasShownWelcome, setHasShownWelcome] = useState(false);\n  const [loadingInfo, setLoadingInfo] = useState&lt;string[]&gt;([]);\n  // Selection box state\n  const [isSelecting, setIsSelecting] = useState(false);\n  const [selectionBox, setSelectionBox] = useState&lt;{ startX: number; startY: number; currentX: number; currentY: number } | null&gt;(null);\n  const selectionRef = useRef&lt;HTMLDivElement&gt;(null);\n  const [isElectron, setIsElectron] = useState(false);\n  const [hoverPlayingId, setHoverPlayingId] = useState&lt;string | null&gt;(null);\n  const [isCreatingTag, setIsCreatingTag] = useState(false);\n  const [tagSearchQuery, setTagSearchQuery] = useState(''); \n  const lastSelectedTagRef = useRef&lt;string | null&gt;(null);\n  const [deletionTasks, setDeletionTasks] = useState&lt;DeletionTask[]&gt;([]);\n  const [contextMenu, setContextMenu] = useState&lt;{ visible: boolean; x: number; y: number; type: 'file-single' | 'file-multi' | 'folder-single' | 'folder-multi' | 'tag-single' | 'tag-multi' | 'tag-background' | 'root-folder' | 'background' | 'tab' | 'person' | null; targetId?: string; }&gt;({ visible: false, x: 0, y: 0, type: null });\n  const [toast, setToast] = useState&lt;{msg: string, visible: boolean}&gt;({ msg: '', visible: false });\n  const [toolbarQuery, setToolbarQuery] = useState('');\n  const [groupBy, setGroupBy] = useState&lt;GroupByOption&gt;('none');\n  const [collapsedGroups, setCollapsedGroups] = useState&lt;Record&lt;string, boolean&gt;&gt;({});\n  const [rememberExitChoice, setRememberExitChoice] = useState(false);\n  // Drag and drop overlay state\n  const [isDragOver, setIsDragOver] = useState(false);\n  const [dragAction, setDragAction] = useState&lt;'copy' | 'move' | null&gt;(null);\n  const [dragFiles, setDragFiles] = useState&lt;FileList | null&gt;(null);\n  // Ref to track if we're doing an internal drag operation (drag from inside the app to outside)\n  // Using ref instead of state for synchronous updates to avoid flickering\n  const isInternalDragRef = useRef(false);\n  // Ref to track if files are selected (user's suggested approach)\n  // This will help distinguish between internal drag (from selected files) and external drag\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "lineNumber": 546
          },
          {
            "text": "  const [showSplash, setShowSplash] = useState(true);",
            "lineNumber": 547
          },
          {
            "text": "  const [hasShownWelcome, setHasShownWelcome] = useState(false);",
            "lineNumber": 548
          },
          {
            "text": "  const [loadingInfo, setLoadingInfo] = useState&lt;string[]&gt;([]);",
            "lineNumber": 549
          },
          {
            "text": "  // Selection box state",
            "lineNumber": 550
          },
          {
            "text": "  const [isSelecting, setIsSelecting] = useState(false);",
            "lineNumber": 551
          },
          {
            "text": "  const [selectionBox, setSelectionBox] = useState&lt;{ startX: number; startY: number; currentX: number; currentY: number } | null&gt;(null);",
            "lineNumber": 552
          },
          {
            "text": "  const selectionRef = useRef&lt;HTMLDivElement&gt;(null);",
            "lineNumber": 553
          },
          {
            "text": "  const [isElectron, setIsElectron] = useState(false);",
            "lineNumber": 554
          },
          {
            "text": "  const [hoverPlayingId, setHoverPlayingId] = useState&lt;string | null&gt;(null);",
            "lineNumber": 555
          },
          {
            "text": "  const [isCreatingTag, setIsCreatingTag] = useState(false);",
            "lineNumber": 556
          },
          {
            "text": "  const [tagSearchQuery, setTagSearchQuery] = useState(''); ",
            "lineNumber": 557
          },
          {
            "text": "  const lastSelectedTagRef = useRef&lt;string | null&gt;(null);",
            "lineNumber": 558
          },
          {
            "text": "  const [deletionTasks, setDeletionTasks] = useState&lt;DeletionTask[]&gt;([]);",
            "lineNumber": 559
          },
          {
            "text": "  const [contextMenu, setContextMenu] = useState&lt;{ visible: boolean; x: number; y: number; type: 'file-single' | 'file-multi' | 'folder-single' | 'folder-multi' | 'tag-single' | 'tag-multi' | 'tag-background' | 'root-folder' | 'background' | 'tab' | 'person' | null; targetId?: string; }&gt;({ visible: false, x: 0, y: 0, type: null });",
            "lineNumber": 560
          },
          {
            "text": "  const [toast, setToast] = useState&lt;{msg: string, visible: boolean}&gt;({ msg: '', visible: false });",
            "lineNumber": 561
          },
          {
            "text": "  const [toolbarQuery, setToolbarQuery] = useState('');",
            "lineNumber": 562
          },
          {
            "text": "  const [groupBy, setGroupBy] = useState&lt;GroupByOption&gt;('none');",
            "lineNumber": 563
          },
          {
            "text": "  const [collapsedGroups, setCollapsedGroups] = useState&lt;Record&lt;string, boolean&gt;&gt;({});",
            "lineNumber": 564
          },
          {
            "text": "  const [rememberExitChoice, setRememberExitChoice] = useState(false);",
            "lineNumber": 565
          },
          {
            "text": "  // Drag and drop overlay state",
            "lineNumber": 566
          },
          {
            "text": "  const [isDragOver, setIsDragOver] = useState(false);",
            "lineNumber": 567
          },
          {
            "text": "  const [dragAction, setDragAction] = useState&lt;'copy' | 'move' | null&gt;(null);",
            "lineNumber": 568
          },
          {
            "text": "  const [dragFiles, setDragFiles] = useState&lt;FileList | null&gt;(null);",
            "lineNumber": 569
          },
          {
            "text": "  // Ref to track if we're doing an internal drag operation (drag from inside the app to outside)",
            "lineNumber": 570
          },
          {
            "text": "  // Using ref instead of state for synchronous updates to avoid flickering",
            "lineNumber": 571
          },
          {
            "text": "  const isInternalDragRef = useRef(false);",
            "lineNumber": 572
          },
          {
            "text": "  // Ref to track if files are selected (user's suggested approach)",
            "lineNumber": 573
          },
          {
            "text": "  // This will help distinguish between internal drag (from selected files) and external drag",
            "lineNumber": 574
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.321554958820343
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1430
          },
          "endPosition": {
            "line": 1958,
            "column": 1
          }
        },
        "contents": "interface FileGridProps {\n\n  selectionBox?: { startX: number; startY: number; currentX: number; currentY: number } | null;\n  t: (key: string) =&gt; string;\n  onThumbnailSizeChange?: (size: number) =&gt; void;\n  onUpdateFile?: (id: string, updates: Partial&lt;FileNode&gt;) =&gt; void;\n  settings?: import('../types').AppSettings;\n  onDragEnd?: (e: React.DragEvent) =&gt; void;\n  resourceRoot?: string;\n  cachePath?: string;\n  onScrollTopChange?: (scrollTop: number) =&gt; void;\n}\n\nexport const FileGrid: React.FC&lt;FileGridProps&gt; = ({\n  displayFileIds,\n  files,\n  activeTab,\n  renamingId,\n  thumbnailSize,\n  resourceRoot,\n  cachePath,\n  hoverPlayingId,\n  onSetHoverPlayingId,\n  onFileClick,\n  onFileDoubleClick,\n  onContextMenu,\n  onRenameSubmit,\n  onRenameCancel,\n  onStartRename,\n  onDragStart,\n  onDragEnd,\n  onDropOnFolder,\n  onDropExternal,\n  containerRef,\n  onMouseDown,\n  onMouseMove,\n  onMouseUp,\n  onBackgroundContextMenu,\n  people,\n  groupedTags,\n  onPersonClick,\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "interface FileGridProps {",
            "lineNumber": 1431,
            "isSignature": true
          },
          {
            "lineNumber": 1466
          },
          {
            "text": "  selectionBox?: { startX: number; startY: number; currentX: number; currentY: number } | null;",
            "lineNumber": 1467
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 1468
          },
          {
            "text": "  onThumbnailSizeChange?: (size: number) =&gt; void;",
            "lineNumber": 1469
          },
          {
            "text": "  onUpdateFile?: (id: string, updates: Partial&lt;FileNode&gt;) =&gt; void;",
            "lineNumber": 1470
          },
          {
            "text": "  settings?: import('../types').AppSettings;",
            "lineNumber": 1471
          },
          {
            "text": "  onDragEnd?: (e: React.DragEvent) =&gt; void;",
            "lineNumber": 1472
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 1473
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 1474
          },
          {
            "text": "  onScrollTopChange?: (scrollTop: number) =&gt; void;",
            "lineNumber": 1475,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 1476,
            "isSignature": true
          },
          {
            "lineNumber": 1477
          },
          {
            "text": "export const FileGrid: React.FC&lt;FileGridProps&gt; = ({",
            "lineNumber": 1478
          },
          {
            "text": "  displayFileIds,",
            "lineNumber": 1479
          },
          {
            "text": "  files,",
            "lineNumber": 1480
          },
          {
            "text": "  activeTab,",
            "lineNumber": 1481
          },
          {
            "text": "  renamingId,",
            "lineNumber": 1482
          },
          {
            "text": "  thumbnailSize,",
            "lineNumber": 1483
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 1484
          },
          {
            "text": "  cachePath,",
            "lineNumber": 1485
          },
          {
            "text": "  hoverPlayingId,",
            "lineNumber": 1486
          },
          {
            "text": "  onSetHoverPlayingId,",
            "lineNumber": 1487
          },
          {
            "text": "  onFileClick,",
            "lineNumber": 1488
          },
          {
            "text": "  onFileDoubleClick,",
            "lineNumber": 1489
          },
          {
            "text": "  onContextMenu,",
            "lineNumber": 1490
          },
          {
            "text": "  onRenameSubmit,",
            "lineNumber": 1491
          },
          {
            "text": "  onRenameCancel,",
            "lineNumber": 1492
          },
          {
            "text": "  onStartRename,",
            "lineNumber": 1493
          },
          {
            "text": "  onDragStart,",
            "lineNumber": 1494
          },
          {
            "text": "  onDragEnd,",
            "lineNumber": 1495
          },
          {
            "text": "  onDropOnFolder,",
            "lineNumber": 1496
          },
          {
            "text": "  onDropExternal,",
            "lineNumber": 1497
          },
          {
            "text": "  containerRef,",
            "lineNumber": 1498
          },
          {
            "text": "  onMouseDown,",
            "lineNumber": 1499
          },
          {
            "text": "  onMouseMove,",
            "lineNumber": 1500
          },
          {
            "text": "  onMouseUp,",
            "lineNumber": 1501
          },
          {
            "text": "  onBackgroundContextMenu,",
            "lineNumber": 1502
          },
          {
            "text": "  people,",
            "lineNumber": 1503
          },
          {
            "text": "  groupedTags,",
            "lineNumber": 1504
          },
          {
            "text": "  onPersonClick,",
            "lineNumber": 1505
          },
          {
            "text": ";",
            "lineNumber": 1959
          }
        ]
      },
      "score": 0.3212306499481201
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 512
          },
          "endPosition": {
            "line": 679,
            "column": 1
          }
        },
        "contents": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {\n\n              &lt;p&gt;{t('sidebar.noTagsFound')}&lt;/p&gt;\n          &lt;/div&gt;\n      )}\n      {keys.map((group: string) =&gt; {\n          const tagsInGroup = groupedTags[group];\n          return (\n              &lt;div id={&#96;tag-group-${group}&#96;} key={group} className=\"mb-8 scroll-mt-4\"&gt;\n                   &lt;div className=\"flex items-center mb-0 border-b border-gray-100 dark:border-gray-800 pt-3 pb-3 sticky top-0 bg-white/95 dark:bg-gray-950/95 z-10 backdrop-blur-sm transition-colors h-16\"&gt;\n                       &lt;div className=\"w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-lg mr-3 shadow-sm border border-blue-100 dark:border-blue-900/50\"&gt;\n                          {group}\n                       &lt;/div&gt;\n                       &lt;span className=\"text-xs font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wider\"&gt;\n                          {tagsInGroup.length} {t('context.items')}\n                       &lt;/span&gt;\n                   &lt;/div&gt;\n                   &lt;div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3\"&gt;\n                       {tagsInGroup.map((tag: string) =&gt; {\n                           const count = tagCounts[tag] || 0;\n                           const isSelected = selectedTagIds.includes(tag);\n                           return (\n                              &lt;TagItem\n                       }\n      }\n}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {",
            "lineNumber": 513
          },
          {
            "lineNumber": 612
          },
          {
            "text": "              &lt;p&gt;{t('sidebar.noTagsFound')}&lt;/p&gt;",
            "lineNumber": 613
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 614
          },
          {
            "text": "      )}",
            "lineNumber": 615
          },
          {
            "text": "      {keys.map((group: string) =&gt; {",
            "lineNumber": 616
          },
          {
            "text": "          const tagsInGroup = groupedTags[group];",
            "lineNumber": 617
          },
          {
            "text": "          return (",
            "lineNumber": 618
          },
          {
            "text": "              &lt;div id={&#96;tag-group-${group}&#96;} key={group} className=\"mb-8 scroll-mt-4\"&gt;",
            "lineNumber": 619
          },
          {
            "text": "                   &lt;div className=\"flex items-center mb-0 border-b border-gray-100 dark:border-gray-800 pt-3 pb-3 sticky top-0 bg-white/95 dark:bg-gray-950/95 z-10 backdrop-blur-sm transition-colors h-16\"&gt;",
            "lineNumber": 620
          },
          {
            "text": "                       &lt;div className=\"w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-lg mr-3 shadow-sm border border-blue-100 dark:border-blue-900/50\"&gt;",
            "lineNumber": 621
          },
          {
            "text": "                          {group}",
            "lineNumber": 622
          },
          {
            "text": "                       &lt;/div&gt;",
            "lineNumber": 623
          },
          {
            "text": "                       &lt;span className=\"text-xs font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wider\"&gt;",
            "lineNumber": 624
          },
          {
            "text": "                          {tagsInGroup.length} {t('context.items')}",
            "lineNumber": 625
          },
          {
            "text": "                       &lt;/span&gt;",
            "lineNumber": 626
          },
          {
            "text": "                   &lt;/div&gt;",
            "lineNumber": 627
          },
          {
            "text": "                   &lt;div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3\"&gt;",
            "lineNumber": 628
          },
          {
            "text": "                       {tagsInGroup.map((tag: string) =&gt; {",
            "lineNumber": 629
          },
          {
            "text": "                           const count = tagCounts[tag] || 0;",
            "lineNumber": 630
          },
          {
            "text": "                           const isSelected = selectedTagIds.includes(tag);",
            "lineNumber": 631
          },
          {
            "text": "                           return (",
            "lineNumber": 632
          },
          {
            "text": "                              &lt;TagItem",
            "lineNumber": 633
          },
          {
            "text": "                       }",
            "lineNumber": 645
          },
          {
            "text": "      }",
            "lineNumber": 649
          },
          {
            "text": "}",
            "lineNumber": 675
          },
          {
            "text": ";",
            "lineNumber": 680
          }
        ]
      },
      "score": 0.32040584087371826
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n\n  const handleMouseDown = (e: React.MouseEvent) =&gt; {\n    // 关闭右键菜单\n    closeContextMenu();\n    \n    if ((e.target as HTMLElement).closest('.file-item') || (e.target as HTMLElement).closest('.tag-item')) {\n        return;\n    }\n    \n    // Start selection box\n    if (e.button === 0) { // Left mouse button\n        const container = selectionRef.current;\n        if (container) {\n            const rect = container.getBoundingClientRect();\n            const startX = e.clientX - rect.left + container.scrollLeft;\n            const startY = e.clientY - rect.top + container.scrollTop;\n            setIsSelecting(true);\n            setSelectionBox({\n                startX: startX,\n                startY: startY,\n                currentX: startX,\n                currentY: startY\n            });\n            \n            // Clear selection on background click\n            if (activeTab.viewMode === 'browser') {\n                updateActiveTab({ selectedFileIds: [] });\n            } else if (activeTab.viewMode === 'tags-overview') {\n                updateActiveTab({ selectedTagIds: [] });\n            } else if (activeTab.viewMode === 'people-overview') {\n                updateActiveTab({ selectedPersonIds: [] });\n            }\n        }\n    }\n  };\n  \n  // Optimized mouse move handler with throttling and direct DOM manipulation\n  const handleMouseMove = useCallback(throttle\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "lineNumber": 1820
          },
          {
            "lineNumber": 1821
          },
          {
            "text": "  const handleMouseDown = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 1822
          },
          {
            "text": "    // 关闭右键菜单",
            "lineNumber": 1823
          },
          {
            "text": "    closeContextMenu();",
            "lineNumber": 1824
          },
          {
            "text": "    ",
            "lineNumber": 1825
          },
          {
            "text": "    if ((e.target as HTMLElement).closest('.file-item') || (e.target as HTMLElement).closest('.tag-item')) {",
            "lineNumber": 1826
          },
          {
            "text": "        return;",
            "lineNumber": 1827
          },
          {
            "text": "    }",
            "lineNumber": 1828
          },
          {
            "text": "    ",
            "lineNumber": 1829
          },
          {
            "text": "    // Start selection box",
            "lineNumber": 1830
          },
          {
            "text": "    if (e.button === 0) { // Left mouse button",
            "lineNumber": 1831
          },
          {
            "text": "        const container = selectionRef.current;",
            "lineNumber": 1832
          },
          {
            "text": "        if (container) {",
            "lineNumber": 1833
          },
          {
            "text": "            const rect = container.getBoundingClientRect();",
            "lineNumber": 1834
          },
          {
            "text": "            const startX = e.clientX - rect.left + container.scrollLeft;",
            "lineNumber": 1835
          },
          {
            "text": "            const startY = e.clientY - rect.top + container.scrollTop;",
            "lineNumber": 1836
          },
          {
            "text": "            setIsSelecting(true);",
            "lineNumber": 1837
          },
          {
            "text": "            setSelectionBox({",
            "lineNumber": 1838
          },
          {
            "text": "                startX: startX,",
            "lineNumber": 1839
          },
          {
            "text": "                startY: startY,",
            "lineNumber": 1840
          },
          {
            "text": "                currentX: startX,",
            "lineNumber": 1841
          },
          {
            "text": "                currentY: startY",
            "lineNumber": 1842
          },
          {
            "text": "            });",
            "lineNumber": 1843
          },
          {
            "text": "            ",
            "lineNumber": 1844
          },
          {
            "text": "            // Clear selection on background click",
            "lineNumber": 1845
          },
          {
            "text": "            if (activeTab.viewMode === 'browser') {",
            "lineNumber": 1846
          },
          {
            "text": "                updateActiveTab({ selectedFileIds: [] });",
            "lineNumber": 1847
          },
          {
            "text": "            } else if (activeTab.viewMode === 'tags-overview') {",
            "lineNumber": 1848
          },
          {
            "text": "                updateActiveTab({ selectedTagIds: [] });",
            "lineNumber": 1849
          },
          {
            "text": "            } else if (activeTab.viewMode === 'people-overview') {",
            "lineNumber": 1850
          },
          {
            "text": "                updateActiveTab({ selectedPersonIds: [] });",
            "lineNumber": 1851
          },
          {
            "text": "            }",
            "lineNumber": 1852
          },
          {
            "text": "        }",
            "lineNumber": 1853
          },
          {
            "text": "    }",
            "lineNumber": 1854
          },
          {
            "text": "  };",
            "lineNumber": 1855
          },
          {
            "text": "  ",
            "lineNumber": 1856
          },
          {
            "text": "  // Optimized mouse move handler with throttling and direct DOM manipulation",
            "lineNumber": 1857
          },
          {
            "text": "  const handleMouseMove = useCallback(throttle",
            "lineNumber": 1858
          },
          {
            "text": ";",
            "lineNumber": 1882
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.31941309571266174
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 18
          },
          "endPosition": {
            "line": 137,
            "column": 1
          }
        },
        "contents": "const TreeNode: React.FC&lt;TreeProps&gt; = \n\n\n  return (\n    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300\"&gt;\n      &lt;div \n        className={&#96;flex items-center py-1 px-2 cursor-pointer transition-colors border border-transparent group\n          ${isSelected ? 'bg-blue-600 text-white' : 'hover:bg-gray-200 dark:hover:bg-gray-800'}\n          ${isDragOver ? 'bg-blue-100 dark:bg-blue-900 border-blue-500 dark:border-blue-400' : ''}\n        &#96;}\n        style={{ paddingLeft: &#96;${depth * 12 + 8}px&#96; }}\n        onClick={handleClick}\n        onContextMenu={handleContextMenu}\n        onDragOver={handleDragOver}\n        onDragLeave={handleDragLeave}\n        onDrop={handleDrop}\n      &gt;\n        &lt;div \n          className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\"\n          onClick={handleToggle}\n        &gt;\n          {folderChildren.length &gt; 0 ? (\n            expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;\n          ) : &lt;div className=\"w-[14px]\" /&gt;}\n        &lt;/div&gt;\n        &lt;Icon size={16} className={&#96;mr-2 ${iconColorClass}&#96;} /&gt;\n        &lt;span className=\"truncate pointer-events-none flex-1\"&gt;{node.name}&lt;/span&gt;\n      &lt;/div&gt;\n\n      {expanded &amp;&amp; folderChildren.map(childId =&gt; (\n        &lt;TreeNode \n          key={childId}\n          files={files}\n          nodeId={childId}\n          currentFolderId={currentFolderId}\n          expandedIds={expandedIds}\n          onToggle={onToggle}\n          onNavigate={onNavigate}\n          onContextMenu={onContextMenu}\n          onDrop={onDrop}\n          depth={depth + 1}\n        /&gt;\n      ))}\n    &lt;/div&gt;\n  );\n};\n\ninterface PeopleSectionProps {\n  people: Record&lt;string, Person&gt;;\n;\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 19,
                "column": 1
              },
              "endPosition": {
                "line": 19,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 19,
                "column": 7
              },
              "endPosition": {
                "line": 19,
                "column": 39
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TreeNode: React.FC&lt;TreeProps&gt; = ",
            "lineNumber": 19
          },
          {
            "lineNumber": 83
          },
          {
            "lineNumber": 84
          },
          {
            "text": "  return (",
            "lineNumber": 85
          },
          {
            "text": "    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300\"&gt;",
            "lineNumber": 86
          },
          {
            "text": "      &lt;div ",
            "lineNumber": 87
          },
          {
            "text": "        className={&#96;flex items-center py-1 px-2 cursor-pointer transition-colors border border-transparent group",
            "lineNumber": 88
          },
          {
            "text": "          ${isSelected ? 'bg-blue-600 text-white' : 'hover:bg-gray-200 dark:hover:bg-gray-800'}",
            "lineNumber": 89
          },
          {
            "text": "          ${isDragOver ? 'bg-blue-100 dark:bg-blue-900 border-blue-500 dark:border-blue-400' : ''}",
            "lineNumber": 90
          },
          {
            "text": "        &#96;}",
            "lineNumber": 91
          },
          {
            "text": "        style={{ paddingLeft: &#96;${depth * 12 + 8}px&#96; }}",
            "lineNumber": 92
          },
          {
            "text": "        onClick={handleClick}",
            "lineNumber": 93
          },
          {
            "text": "        onContextMenu={handleContextMenu}",
            "lineNumber": 94
          },
          {
            "text": "        onDragOver={handleDragOver}",
            "lineNumber": 95
          },
          {
            "text": "        onDragLeave={handleDragLeave}",
            "lineNumber": 96
          },
          {
            "text": "        onDrop={handleDrop}",
            "lineNumber": 97
          },
          {
            "text": "      &gt;",
            "lineNumber": 98
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 99
          },
          {
            "text": "          className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\"",
            "lineNumber": 100
          },
          {
            "text": "          onClick={handleToggle}",
            "lineNumber": 101
          },
          {
            "text": "        &gt;",
            "lineNumber": 102
          },
          {
            "text": "          {folderChildren.length &gt; 0 ? (",
            "lineNumber": 103
          },
          {
            "text": "            expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;",
            "lineNumber": 104
          },
          {
            "text": "          ) : &lt;div className=\"w-[14px]\" /&gt;}",
            "lineNumber": 105
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 106
          },
          {
            "text": "        &lt;Icon size={16} className={&#96;mr-2 ${iconColorClass}&#96;} /&gt;",
            "lineNumber": 107
          },
          {
            "text": "        &lt;span className=\"truncate pointer-events-none flex-1\"&gt;{node.name}&lt;/span&gt;",
            "lineNumber": 108
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 109
          },
          {
            "lineNumber": 110
          },
          {
            "text": "      {expanded &amp;&amp; folderChildren.map(childId =&gt; (",
            "lineNumber": 111
          },
          {
            "text": "        &lt;TreeNode ",
            "lineNumber": 112
          },
          {
            "text": "          key={childId}",
            "lineNumber": 113
          },
          {
            "text": "          files={files}",
            "lineNumber": 114
          },
          {
            "text": "          nodeId={childId}",
            "lineNumber": 115
          },
          {
            "text": "          currentFolderId={currentFolderId}",
            "lineNumber": 116
          },
          {
            "text": "          expandedIds={expandedIds}",
            "lineNumber": 117
          },
          {
            "text": "          onToggle={onToggle}",
            "lineNumber": 118
          },
          {
            "text": "          onNavigate={onNavigate}",
            "lineNumber": 119
          },
          {
            "text": "          onContextMenu={onContextMenu}",
            "lineNumber": 120
          },
          {
            "text": "          onDrop={onDrop}",
            "lineNumber": 121
          },
          {
            "text": "          depth={depth + 1}",
            "lineNumber": 122
          },
          {
            "text": "        /&gt;",
            "lineNumber": 123
          },
          {
            "text": "      ))}",
            "lineNumber": 124
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 125
          },
          {
            "text": "  );",
            "lineNumber": 126
          },
          {
            "text": "};",
            "lineNumber": 127
          },
          {
            "lineNumber": 128
          },
          {
            "text": "interface PeopleSectionProps {",
            "lineNumber": 129,
            "isSignature": true
          },
          {
            "text": "  people: Record&lt;string, Person&gt;;",
            "lineNumber": 130
          },
          {
            "text": ";",
            "lineNumber": 137,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 138,
            "isSignature": true
          }
        ]
      },
      "score": 0.31660890579223633
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst onPerformSearch = async \n activeTab.searchScope, activeTab.activeTags, null, 0);\n      }\n  };\n\n  const handlePerformSearch = onPerformSearch;\n\n  const handleViewerSearch = (query: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', query, activeTab.searchScope, activeTab.activeTags, null, 0);\n  const enterTagView = (tagName: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'tag', [tagName], null, 0);\n  const enterTagsOverview = () =&gt; pushHistory(activeTab.folderId, null, 'tags-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);\n  const enterPeopleOverview = () =&gt; pushHistory(activeTab.folderId, null, 'people-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);\n  const enterPersonView = (personId: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'all', [], personId, 0);\n  const handleClearTagFilter = (tagToRemove: string) =&gt; updateActiveTab(prev =&gt; ({ activeTags: prev.activeTags.filter(t =&gt; t !== tagToRemove) }));\n  const handleClearAllTags = () =&gt; updateActiveTab({ activeTags: [] });\n  const handleClearPersonFilter = () =&gt; updateActiveTab({ activePersonId: null });\n  \n  const handleRenameSubmit = async (value: string, id: string) =&gt; {\n      value = value.trim();\n      const file = state.files[id];\n      if (!value || value === file.name) { setState(s =&gt; ({ ...s, renamingId: null })); return; }\n      if (file.path) {\n          try {\n              const separator = file.path.includes('/') ? '/' : '\\\\';\n              const parentPath = file.path.substring(0, file.path.lastIndexOf(separator));\n              const newPath = &#96;${parentPath}${separator}${value}&#96;;\n              \n              // Use appropriate renameFile function based on environment\n              const isTauriEnv = isTauriEnvironment();\n              if (isTauriEnv) {\n                  await renameFile(file.path, newPath);\n              } else if (window.electron) {\n                  await window.electron.renameFile(file.path, newPath);\n              } else {\n                  throw new Error(\"No file system access available\");\n              }\n              \n              await handleRefresh();\n              setState(s =&gt; ({ ...s, renamingId: null }));\n          }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const onPerformSearch = async ",
            "lineNumber": 3105
          },
          {
            "text": " activeTab.searchScope, activeTab.activeTags, null, 0);",
            "lineNumber": 3109
          },
          {
            "text": "      }",
            "lineNumber": 3110
          },
          {
            "text": "  };",
            "lineNumber": 3111
          },
          {
            "lineNumber": 3112
          },
          {
            "text": "  const handlePerformSearch = onPerformSearch;",
            "lineNumber": 3113
          },
          {
            "lineNumber": 3114
          },
          {
            "text": "  const handleViewerSearch = (query: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', query, activeTab.searchScope, activeTab.activeTags, null, 0);",
            "lineNumber": 3115
          },
          {
            "text": "  const enterTagView = (tagName: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'tag', [tagName], null, 0);",
            "lineNumber": 3116
          },
          {
            "text": "  const enterTagsOverview = () =&gt; pushHistory(activeTab.folderId, null, 'tags-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);",
            "lineNumber": 3117
          },
          {
            "text": "  const enterPeopleOverview = () =&gt; pushHistory(activeTab.folderId, null, 'people-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);",
            "lineNumber": 3118
          },
          {
            "text": "  const enterPersonView = (personId: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'all', [], personId, 0);",
            "lineNumber": 3119
          },
          {
            "text": "  const handleClearTagFilter = (tagToRemove: string) =&gt; updateActiveTab(prev =&gt; ({ activeTags: prev.activeTags.filter(t =&gt; t !== tagToRemove) }));",
            "lineNumber": 3120
          },
          {
            "text": "  const handleClearAllTags = () =&gt; updateActiveTab({ activeTags: [] });",
            "lineNumber": 3121
          },
          {
            "text": "  const handleClearPersonFilter = () =&gt; updateActiveTab({ activePersonId: null });",
            "lineNumber": 3122
          },
          {
            "text": "  ",
            "lineNumber": 3123
          },
          {
            "text": "  const handleRenameSubmit = async (value: string, id: string) =&gt; {",
            "lineNumber": 3124
          },
          {
            "text": "      value = value.trim();",
            "lineNumber": 3125
          },
          {
            "text": "      const file = state.files[id];",
            "lineNumber": 3126
          },
          {
            "text": "      if (!value || value === file.name) { setState(s =&gt; ({ ...s, renamingId: null })); return; }",
            "lineNumber": 3127
          },
          {
            "text": "      if (file.path) {",
            "lineNumber": 3128
          },
          {
            "text": "          try {",
            "lineNumber": 3129
          },
          {
            "text": "              const separator = file.path.includes('/') ? '/' : '\\\\';",
            "lineNumber": 3130
          },
          {
            "text": "              const parentPath = file.path.substring(0, file.path.lastIndexOf(separator));",
            "lineNumber": 3131
          },
          {
            "text": "              const newPath = &#96;${parentPath}${separator}${value}&#96;;",
            "lineNumber": 3132
          },
          {
            "text": "              ",
            "lineNumber": 3133
          },
          {
            "text": "              // Use appropriate renameFile function based on environment",
            "lineNumber": 3134
          },
          {
            "text": "              const isTauriEnv = isTauriEnvironment();",
            "lineNumber": 3135
          },
          {
            "text": "              if (isTauriEnv) {",
            "lineNumber": 3136
          },
          {
            "text": "                  await renameFile(file.path, newPath);",
            "lineNumber": 3137
          },
          {
            "text": "              } else if (window.electron) {",
            "lineNumber": 3138
          },
          {
            "text": "                  await window.electron.renameFile(file.path, newPath);",
            "lineNumber": 3139
          },
          {
            "text": "              } else {",
            "lineNumber": 3140
          },
          {
            "text": "                  throw new Error(\"No file system access available\");",
            "lineNumber": 3141
          },
          {
            "text": "              }",
            "lineNumber": 3142
          },
          {
            "text": "              ",
            "lineNumber": 3143
          },
          {
            "text": "              await handleRefresh();",
            "lineNumber": 3144
          },
          {
            "text": "              setState(s =&gt; ({ ...s, renamingId: null }));",
            "lineNumber": 3145
          },
          {
            "text": "          }",
            "lineNumber": 3146
          },
          {
            "text": ";",
            "lineNumber": 3154
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.31646865606307983
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n\n  const handlePersonClick = (personId: string, e: React.MouseEvent) =&gt; {\n      e.stopPropagation();\n      \n      closeContextMenu();\n      \n      const isCtrl = e.ctrlKey || e.metaKey; // Ctrl for Windows/Linux, Command for macOS\n      const isShift = e.shiftKey;\n      \n      let newSelectedPersonIds: string[];\n      \n      // Get all people in the current view, in the same order as displayed in the grid\n      // Match the order used in FileGrid's useLayout function for people-overview\n      const allPeople = Object.values(state.people);\n      const allPersonIds = allPeople.map(person =&gt; person.id);\n      \n      if (isCtrl) {\n        // Ctrl+Click: Toggle selection of this person\n        if (activeTab.selectedPersonIds.includes(personId)) {\n          // Remove from selection\n          newSelectedPersonIds = activeTab.selectedPersonIds.filter(id =&gt; id !== personId);\n        } else {\n          // Add to selection\n          newSelectedPersonIds = [...activeTab.selectedPersonIds, personId];\n        }\n      } else if (isShift &amp;&amp; activeTab.selectedPersonIds.length &gt; 0) {\n        // Shift+Click: Select range from last selected to current\n        const lastSelectedPersonId = activeTab.selectedPersonIds[activeTab.selectedPersonIds.length - 1];\n        const lastIndex = allPersonIds.indexOf(lastSelectedPersonId);\n        const currentIndex = allPersonIds.indexOf(personId);\n        \n        if (lastIndex !== -1 &amp;&amp; currentIndex !== -1) {\n          const start = Math.min(lastIndex, currentIndex);\n          const end = Math.max(lastIndex, currentIndex);\n          newSelectedPersonIds = allPersonIds.slice(start, end + 1);\n        } else {\n          newSelectedPersonIds = [personId];\n        }\n      } else {\n        // Normal click: Select only this person\n        newSelectedPersonIds = [personId];\n      }\n      \n      updateActiveTab({ selectedPersonIds: newSelectedPersonIds });\n  };\n\n  const handleRenameTag = (oldTag: string, newTag: string) =&gt; {\n      if (!newTag.trim() || oldTag === newTag) return;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "lineNumber": 2419
          },
          {
            "lineNumber": 2420
          },
          {
            "text": "  const handlePersonClick = (personId: string, e: React.MouseEvent) =&gt; {",
            "lineNumber": 2421
          },
          {
            "text": "      e.stopPropagation();",
            "lineNumber": 2422
          },
          {
            "text": "      ",
            "lineNumber": 2423
          },
          {
            "text": "      closeContextMenu();",
            "lineNumber": 2424
          },
          {
            "text": "      ",
            "lineNumber": 2425
          },
          {
            "text": "      const isCtrl = e.ctrlKey || e.metaKey; // Ctrl for Windows/Linux, Command for macOS",
            "lineNumber": 2426
          },
          {
            "text": "      const isShift = e.shiftKey;",
            "lineNumber": 2427
          },
          {
            "text": "      ",
            "lineNumber": 2428
          },
          {
            "text": "      let newSelectedPersonIds: string[];",
            "lineNumber": 2429
          },
          {
            "text": "      ",
            "lineNumber": 2430
          },
          {
            "text": "      // Get all people in the current view, in the same order as displayed in the grid",
            "lineNumber": 2431
          },
          {
            "text": "      // Match the order used in FileGrid's useLayout function for people-overview",
            "lineNumber": 2432
          },
          {
            "text": "      const allPeople = Object.values(state.people);",
            "lineNumber": 2433
          },
          {
            "text": "      const allPersonIds = allPeople.map(person =&gt; person.id);",
            "lineNumber": 2434
          },
          {
            "text": "      ",
            "lineNumber": 2435
          },
          {
            "text": "      if (isCtrl) {",
            "lineNumber": 2436
          },
          {
            "text": "        // Ctrl+Click: Toggle selection of this person",
            "lineNumber": 2437
          },
          {
            "text": "        if (activeTab.selectedPersonIds.includes(personId)) {",
            "lineNumber": 2438
          },
          {
            "text": "          // Remove from selection",
            "lineNumber": 2439
          },
          {
            "text": "          newSelectedPersonIds = activeTab.selectedPersonIds.filter(id =&gt; id !== personId);",
            "lineNumber": 2440
          },
          {
            "text": "        } else {",
            "lineNumber": 2441
          },
          {
            "text": "          // Add to selection",
            "lineNumber": 2442
          },
          {
            "text": "          newSelectedPersonIds = [...activeTab.selectedPersonIds, personId];",
            "lineNumber": 2443
          },
          {
            "text": "        }",
            "lineNumber": 2444
          },
          {
            "text": "      } else if (isShift &amp;&amp; activeTab.selectedPersonIds.length &gt; 0) {",
            "lineNumber": 2445
          },
          {
            "text": "        // Shift+Click: Select range from last selected to current",
            "lineNumber": 2446
          },
          {
            "text": "        const lastSelectedPersonId = activeTab.selectedPersonIds[activeTab.selectedPersonIds.length - 1];",
            "lineNumber": 2447
          },
          {
            "text": "        const lastIndex = allPersonIds.indexOf(lastSelectedPersonId);",
            "lineNumber": 2448
          },
          {
            "text": "        const currentIndex = allPersonIds.indexOf(personId);",
            "lineNumber": 2449
          },
          {
            "text": "        ",
            "lineNumber": 2450
          },
          {
            "text": "        if (lastIndex !== -1 &amp;&amp; currentIndex !== -1) {",
            "lineNumber": 2451
          },
          {
            "text": "          const start = Math.min(lastIndex, currentIndex);",
            "lineNumber": 2452
          },
          {
            "text": "          const end = Math.max(lastIndex, currentIndex);",
            "lineNumber": 2453
          },
          {
            "text": "          newSelectedPersonIds = allPersonIds.slice(start, end + 1);",
            "lineNumber": 2454
          },
          {
            "text": "        } else {",
            "lineNumber": 2455
          },
          {
            "text": "          newSelectedPersonIds = [personId];",
            "lineNumber": 2456
          },
          {
            "text": "        }",
            "lineNumber": 2457
          },
          {
            "text": "      } else {",
            "lineNumber": 2458
          },
          {
            "text": "        // Normal click: Select only this person",
            "lineNumber": 2459
          },
          {
            "text": "        newSelectedPersonIds = [personId];",
            "lineNumber": 2460
          },
          {
            "text": "      }",
            "lineNumber": 2461
          },
          {
            "text": "      ",
            "lineNumber": 2462
          },
          {
            "text": "      updateActiveTab({ selectedPersonIds: newSelectedPersonIds });",
            "lineNumber": 2463
          },
          {
            "text": "  };",
            "lineNumber": 2464
          },
          {
            "lineNumber": 2465
          },
          {
            "text": "  const handleRenameTag = (oldTag: string, newTag: string) =&gt; {",
            "lineNumber": 2466
          },
          {
            "text": "      if (!newTag.trim() || oldTag === newTag) return;",
            "lineNumber": 2467
          },
          {
            "text": ";",
            "lineNumber": 2517
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.30724823474884033
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 512
          },
          "endPosition": {
            "line": 679,
            "column": 1
          }
        },
        "contents": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {\nconst handleMouseEnter = (e: React.MouseEvent, tag: string) =&gt; {\n\n    \n    hoverTimerRef.current = setTimeout(() =&gt; {\n      const rect = target.getBoundingClientRect();\n      const PREVIEW_WIDTH = 256; \n      const PREVIEW_HEIGHT = 120;\n      \n      let left = rect.left + (rect.width / 2) - (PREVIEW_WIDTH / 2);\n      let top = rect.bottom + 10;\n\n      if (left &lt; 10) left = 10;\n      if (left + PREVIEW_WIDTH &gt; window.innerWidth) left = window.innerWidth - PREVIEW_WIDTH - 10;\n      if (top + PREVIEW_HEIGHT &gt; window.innerHeight) top = rect.top - PREVIEW_HEIGHT - 10;\n\n      setHoveredTagPos({ top, left });\n      setHoveredTag(tag);\n    }, 600);\n  }, []);\n\n  const handleMouseLeave = useCallback(() =&gt; {\n    if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);\n    setHoveredTag(null);\n    setHoveredTagPos(null);\n  }, []);\n\n  return (\n    &lt;div className=\"relative\"&gt;\n      {/* 字母索引栏 */}\n      {keys.length &gt; 0 &amp;&amp; (\n        &lt;div className=\"fixed top-1/2 transform -translate-y-1/2 z-20 bg-white/80 dark:bg-gray-950/80 backdrop-blur-sm rounded-full px-1 py-2 shadow-md border border-gray-200 dark:border-gray-800 transition-all duration-300\"\n             style={{ \n               right: 'calc(20px + var(--metadata-panel-width, 0px))',\n               transform: 'translateY(-50%) translateY(10px)' // 向下调整10px，使其居中\n             }}\n             onMouseEnter={() =&gt; {\n              // 鼠标悬停时，确保索引栏显示在最前面\n              const metadataPanel = document.querySelector('.metadata-panel-container') as HTMLElement | null;\n              if (metadataPanel) {\n                metadataPanel.style.zIndex = '10';\n              }\n            }}\n            onMouseLeave={() =&gt; {\n              // 鼠标离开时，恢复详情面板的z-index\n              const metadataPanel = document.querySelector('.metadata-panel-container');\n            }\n}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 498,
                "column": 17
              },
              "endPosition": {
                "line": 499,
                "column": 13
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {",
            "lineNumber": 513
          },
          {
            "text": "const handleMouseEnter = (e: React.MouseEvent, tag: string) =&gt; {",
            "lineNumber": 538
          },
          {
            "lineNumber": 540
          },
          {
            "text": "    ",
            "lineNumber": 541
          },
          {
            "text": "    hoverTimerRef.current = setTimeout(() =&gt; {",
            "lineNumber": 542
          },
          {
            "text": "      const rect = target.getBoundingClientRect();",
            "lineNumber": 543
          },
          {
            "text": "      const PREVIEW_WIDTH = 256; ",
            "lineNumber": 544
          },
          {
            "text": "      const PREVIEW_HEIGHT = 120;",
            "lineNumber": 545
          },
          {
            "text": "      ",
            "lineNumber": 546
          },
          {
            "text": "      let left = rect.left + (rect.width / 2) - (PREVIEW_WIDTH / 2);",
            "lineNumber": 547
          },
          {
            "text": "      let top = rect.bottom + 10;",
            "lineNumber": 548
          },
          {
            "lineNumber": 549
          },
          {
            "text": "      if (left &lt; 10) left = 10;",
            "lineNumber": 550
          },
          {
            "text": "      if (left + PREVIEW_WIDTH &gt; window.innerWidth) left = window.innerWidth - PREVIEW_WIDTH - 10;",
            "lineNumber": 551
          },
          {
            "text": "      if (top + PREVIEW_HEIGHT &gt; window.innerHeight) top = rect.top - PREVIEW_HEIGHT - 10;",
            "lineNumber": 552
          },
          {
            "lineNumber": 553
          },
          {
            "text": "      setHoveredTagPos({ top, left });",
            "lineNumber": 554
          },
          {
            "text": "      setHoveredTag(tag);",
            "lineNumber": 555
          },
          {
            "text": "    }, 600);",
            "lineNumber": 556
          },
          {
            "text": "  }, []);",
            "lineNumber": 557
          },
          {
            "lineNumber": 558
          },
          {
            "text": "  const handleMouseLeave = useCallback(() =&gt; {",
            "lineNumber": 559
          },
          {
            "text": "    if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);",
            "lineNumber": 560
          },
          {
            "text": "    setHoveredTag(null);",
            "lineNumber": 561
          },
          {
            "text": "    setHoveredTagPos(null);",
            "lineNumber": 562
          },
          {
            "text": "  }, []);",
            "lineNumber": 563
          },
          {
            "lineNumber": 564
          },
          {
            "text": "  return (",
            "lineNumber": 565
          },
          {
            "text": "    &lt;div className=\"relative\"&gt;",
            "lineNumber": 566
          },
          {
            "text": "      {/* 字母索引栏 */}",
            "lineNumber": 567
          },
          {
            "text": "      {keys.length &gt; 0 &amp;&amp; (",
            "lineNumber": 568
          },
          {
            "text": "        &lt;div className=\"fixed top-1/2 transform -translate-y-1/2 z-20 bg-white/80 dark:bg-gray-950/80 backdrop-blur-sm rounded-full px-1 py-2 shadow-md border border-gray-200 dark:border-gray-800 transition-all duration-300\"",
            "lineNumber": 569
          },
          {
            "text": "             style={{ ",
            "lineNumber": 570
          },
          {
            "text": "               right: 'calc(20px + var(--metadata-panel-width, 0px))',",
            "lineNumber": 571
          },
          {
            "text": "               transform: 'translateY(-50%) translateY(10px)' // 向下调整10px，使其居中",
            "lineNumber": 572
          },
          {
            "text": "             }}",
            "lineNumber": 573
          },
          {
            "text": "             onMouseEnter={() =&gt; {",
            "lineNumber": 574
          },
          {
            "text": "              // 鼠标悬停时，确保索引栏显示在最前面",
            "lineNumber": 575
          },
          {
            "text": "              const metadataPanel = document.querySelector('.metadata-panel-container') as HTMLElement | null;",
            "lineNumber": 576
          },
          {
            "text": "              if (metadataPanel) {",
            "lineNumber": 577
          },
          {
            "text": "                metadataPanel.style.zIndex = '10';",
            "lineNumber": 578
          },
          {
            "text": "              }",
            "lineNumber": 579
          },
          {
            "text": "            }}",
            "lineNumber": 580
          },
          {
            "text": "            onMouseLeave={() =&gt; {",
            "lineNumber": 581
          },
          {
            "text": "              // 鼠标离开时，恢复详情面板的z-index",
            "lineNumber": 582
          },
          {
            "text": "              const metadataPanel = document.querySelector('.metadata-panel-container');",
            "lineNumber": 583
          },
          {
            "text": "            }",
            "lineNumber": 587
          },
          {
            "text": "}",
            "lineNumber": 675
          },
          {
            "text": ";",
            "lineNumber": 680
          }
        ]
      },
      "score": 0.3058238923549652
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 231
          },
          "endPosition": {
            "line": 465
          }
        },
        "contents": "const TagSection: React.FC&lt;TagSectionProps&gt; = \ntag =&gt; (\n\n              &lt;div \n                className={&#96;py-1 px-2 rounded cursor-pointer flex items-center justify-between transition-colors\n                   ${dragOverTag === tag \n                      ? 'bg-blue-200 dark:bg-blue-900 border border-blue-400 dark:border-blue-500' \n                      : 'hover:bg-blue-100 dark:hover:bg-blue-900/30 hover:text-blue-700 dark:text-gray-300 dark:hover:text-blue-300 border border-transparent'}\n                &#96;}\n                onClick={() =&gt; onTagSelect(tag)}\n              &gt;\n                 &lt;span className=\"pointer-events-none\"&gt;{tag}&lt;/span&gt;\n                 &lt;span className=\"text-[10px] text-gray-500 dark:text-gray-600 bg-gray-200 dark:bg-gray-800 px-1.5 rounded-full pointer-events-none\"&gt;\n                   {Object.values(files).filter((f: FileNode) =&gt; f.tags.includes(tag)).length}\n                 &lt;/span&gt;\n              &lt;/div&gt;\n              \n              {hoveredTag === tag &amp;&amp; previewImages.length &gt; 0 &amp;&amp;\n          )",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 232,
                "column": 1
              },
              "endPosition": {
                "line": 232,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 232,
                "column": 7
              },
              "endPosition": {
                "line": 232,
                "column": 47
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 12
              },
              "endPosition": {
                "line": 387,
                "column": 12
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 27
              },
              "endPosition": {
                "line": 388,
                "column": 13
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagSection: React.FC&lt;TagSectionProps&gt; = ",
            "lineNumber": 232
          },
          {
            "text": "tag =&gt; (",
            "lineNumber": 387
          },
          {
            "lineNumber": 420
          },
          {
            "text": "              &lt;div ",
            "lineNumber": 421
          },
          {
            "text": "                className={&#96;py-1 px-2 rounded cursor-pointer flex items-center justify-between transition-colors",
            "lineNumber": 422
          },
          {
            "text": "                   ${dragOverTag === tag ",
            "lineNumber": 423
          },
          {
            "text": "                      ? 'bg-blue-200 dark:bg-blue-900 border border-blue-400 dark:border-blue-500' ",
            "lineNumber": 424
          },
          {
            "text": "                      : 'hover:bg-blue-100 dark:hover:bg-blue-900/30 hover:text-blue-700 dark:text-gray-300 dark:hover:text-blue-300 border border-transparent'}",
            "lineNumber": 425
          },
          {
            "text": "                &#96;}",
            "lineNumber": 426
          },
          {
            "text": "                onClick={() =&gt; onTagSelect(tag)}",
            "lineNumber": 427
          },
          {
            "text": "              &gt;",
            "lineNumber": 428
          },
          {
            "text": "                 &lt;span className=\"pointer-events-none\"&gt;{tag}&lt;/span&gt;",
            "lineNumber": 429
          },
          {
            "text": "                 &lt;span className=\"text-[10px] text-gray-500 dark:text-gray-600 bg-gray-200 dark:bg-gray-800 px-1.5 rounded-full pointer-events-none\"&gt;",
            "lineNumber": 430
          },
          {
            "text": "                   {Object.values(files).filter((f: FileNode) =&gt; f.tags.includes(tag)).length}",
            "lineNumber": 431
          },
          {
            "text": "                 &lt;/span&gt;",
            "lineNumber": 432
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 433
          },
          {
            "text": "              ",
            "lineNumber": 434
          },
          {
            "text": "              {hoveredTag === tag &amp;&amp; previewImages.length &gt; 0 &amp;&amp;",
            "lineNumber": 435
          },
          {
            "text": "          )",
            "lineNumber": 458
          }
        ]
      },
      "score": 0.3027881383895874
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 246
          },
          "endPosition": {
            "line": 1381,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \n\n                      {t('context.deletePerson')}\n                  &lt;/button&gt;\n              &lt;/div&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      );\n  }\n\n  if (!file &amp;&amp; !isMulti) {\n      return (\n          &lt;div className=\"flex flex-col items-center justify-center h-full text-gray-400 p-4 text-center\"&gt;\n              &lt;Sparkles size={48} className=\"mb-4 opacity-20\"/&gt;\n              &lt;p&gt;{t('meta.selectHint')}&lt;/p&gt;\n          &lt;/div&gt;\n      );\n  }\n\n  return (\n    &lt;div className=\"h-full flex flex-col bg-white dark:bg-gray-900 overflow-y-auto custom-scrollbar relative\"&gt;\n      &lt;div className=\"p-5 border-b border-gray-100 dark:border-gray-800 flex-shrink-0 bg-gray-50 dark:bg-gray-900/50\"&gt;\n        &lt;div className=\"font-bold text-lg text-gray-800 dark:text-white break-words leading-tight mb-1\"&gt;\n            {isMulti ? &#96;${selectedFileIds.length} ${t('meta.items')}&#96; : file?.name}\n        &lt;/div&gt;\n        {!isMulti &amp;&amp; file &amp;&amp; (\n            &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 truncate\"&gt;\n               {files[file.parentId || '']?.name || 'Root'}\n            &lt;/div&gt;\n        )}\n      &lt;/div&gt;\n\n      &lt;div className=\"p-5 space-y-6\"&gt;\n        \n        {/* Multi-Selection Composition Chart */}\n        {isMulti &amp;&amp; batchStats &amp;&amp; (\n             &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow-sm\"&gt;\n                &lt;div className=\"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-4 flex items-center\"&gt;\n                    &lt;PieChart size={12} className=\"mr-1.5\" /&gt; {t('meta.typeDistribution')}\n                &lt;/div&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 247
          },
          {
            "lineNumber": 771
          },
          {
            "text": "                      {t('context.deletePerson')}",
            "lineNumber": 772
          },
          {
            "text": "                  &lt;/button&gt;",
            "lineNumber": 773
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 774
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 775
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 776
          },
          {
            "text": "      );",
            "lineNumber": 777
          },
          {
            "text": "  }",
            "lineNumber": 778
          },
          {
            "lineNumber": 779
          },
          {
            "text": "  if (!file &amp;&amp; !isMulti) {",
            "lineNumber": 780
          },
          {
            "text": "      return (",
            "lineNumber": 781
          },
          {
            "text": "          &lt;div className=\"flex flex-col items-center justify-center h-full text-gray-400 p-4 text-center\"&gt;",
            "lineNumber": 782
          },
          {
            "text": "              &lt;Sparkles size={48} className=\"mb-4 opacity-20\"/&gt;",
            "lineNumber": 783
          },
          {
            "text": "              &lt;p&gt;{t('meta.selectHint')}&lt;/p&gt;",
            "lineNumber": 784
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 785
          },
          {
            "text": "      );",
            "lineNumber": 786
          },
          {
            "text": "  }",
            "lineNumber": 787
          },
          {
            "lineNumber": 788
          },
          {
            "text": "  return (",
            "lineNumber": 789
          },
          {
            "text": "    &lt;div className=\"h-full flex flex-col bg-white dark:bg-gray-900 overflow-y-auto custom-scrollbar relative\"&gt;",
            "lineNumber": 790
          },
          {
            "text": "      &lt;div className=\"p-5 border-b border-gray-100 dark:border-gray-800 flex-shrink-0 bg-gray-50 dark:bg-gray-900/50\"&gt;",
            "lineNumber": 791
          },
          {
            "text": "        &lt;div className=\"font-bold text-lg text-gray-800 dark:text-white break-words leading-tight mb-1\"&gt;",
            "lineNumber": 792
          },
          {
            "text": "            {isMulti ? &#96;${selectedFileIds.length} ${t('meta.items')}&#96; : file?.name}",
            "lineNumber": 793
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 794
          },
          {
            "text": "        {!isMulti &amp;&amp; file &amp;&amp; (",
            "lineNumber": 795
          },
          {
            "text": "            &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 truncate\"&gt;",
            "lineNumber": 796
          },
          {
            "text": "               {files[file.parentId || '']?.name || 'Root'}",
            "lineNumber": 797
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 798
          },
          {
            "text": "        )}",
            "lineNumber": 799
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 800
          },
          {
            "lineNumber": 801
          },
          {
            "text": "      &lt;div className=\"p-5 space-y-6\"&gt;",
            "lineNumber": 802
          },
          {
            "text": "        ",
            "lineNumber": 803
          },
          {
            "text": "        {/* Multi-Selection Composition Chart */}",
            "lineNumber": 804
          },
          {
            "text": "        {isMulti &amp;&amp; batchStats &amp;&amp; (",
            "lineNumber": 805
          },
          {
            "text": "             &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow-sm\"&gt;",
            "lineNumber": 806
          },
          {
            "text": "                &lt;div className=\"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-4 flex items-center\"&gt;",
            "lineNumber": 807
          },
          {
            "text": "                    &lt;PieChart size={12} className=\"mr-1.5\" /&gt; {t('meta.typeDistribution')}",
            "lineNumber": 808
          },
          {
            "text": "                &lt;/div&gt;",
            "lineNumber": 809
          },
          {
            "text": ";",
            "lineNumber": 1382
          }
        ]
      },
      "score": 0.3017394542694092
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n \n                onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })} \n                onPerformSearch={handlePerformSearch} \n                onSetToolbarQuery={setToolbarQuery} \n                onLayoutModeChange={(mode) =&gt; updateActiveTab({ layoutMode: mode })} \n                onSortOptionChange={(opt) =&gt; setState(s =&gt; ({ ...s, sortBy: opt }))} \n                onSortDirectionChange={() =&gt; setState(s =&gt; ({ ...s, sortDirection: s.sortDirection === 'asc' ? 'desc' : 'asc' }))} \n                onThumbnailSizeChange={(size) =&gt; setState(s =&gt; ({ ...s, thumbnailSize: size }))} \n                onToggleMetadata={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isMetadataVisible: !s.layout.isMetadataVisible } }))} \n                onToggleSettings={toggleSettings} \n                onUpdateDateFilter={(f) =&gt; updateActiveTab({ dateFilter: f })} \n                groupBy={groupBy}\n                onGroupByChange={setGroupBy}\n                isAISearchEnabled={state.settings.search.isAISearchEnabled}\n                onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}\n                onRememberFolderSettings={activeTab.viewMode === 'browser' ? handleRememberFolderSettings : undefined}\n                hasFolderSettings={activeTab.viewMode === 'browser' ? !!state.folderSettings[activeTab.folderId] : false}\n                t={t} \n              /&gt;\n              {/* ... (Filter UI, same as before) ... */}\n              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start || activeTab.activePersonId || activeTab.aiFilter) &amp;&amp; ( \n                  &lt;div className=\"flex items-center px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 space-x-2 overflow-x-auto shrink-0 z-20\"&gt;\n                      &lt;div className=\"flex items-center text-xs text-gray-500 dark:text-gray-400 mr-2 shrink-0\"&gt;\n                          &lt;Filter size={12} className=\"mr-1\"/&gt; {t('context.filters')}\n                      &lt;/div&gt;\n                      \n                      \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": " ",
            "lineNumber": 4525
          },
          {
            "text": "                onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })} ",
            "lineNumber": 4526
          },
          {
            "text": "                onPerformSearch={handlePerformSearch} ",
            "lineNumber": 4527
          },
          {
            "text": "                onSetToolbarQuery={setToolbarQuery} ",
            "lineNumber": 4528
          },
          {
            "text": "                onLayoutModeChange={(mode) =&gt; updateActiveTab({ layoutMode: mode })} ",
            "lineNumber": 4529
          },
          {
            "text": "                onSortOptionChange={(opt) =&gt; setState(s =&gt; ({ ...s, sortBy: opt }))} ",
            "lineNumber": 4530
          },
          {
            "text": "                onSortDirectionChange={() =&gt; setState(s =&gt; ({ ...s, sortDirection: s.sortDirection === 'asc' ? 'desc' : 'asc' }))} ",
            "lineNumber": 4531
          },
          {
            "text": "                onThumbnailSizeChange={(size) =&gt; setState(s =&gt; ({ ...s, thumbnailSize: size }))} ",
            "lineNumber": 4532
          },
          {
            "text": "                onToggleMetadata={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isMetadataVisible: !s.layout.isMetadataVisible } }))} ",
            "lineNumber": 4533
          },
          {
            "text": "                onToggleSettings={toggleSettings} ",
            "lineNumber": 4534
          },
          {
            "text": "                onUpdateDateFilter={(f) =&gt; updateActiveTab({ dateFilter: f })} ",
            "lineNumber": 4535
          },
          {
            "text": "                groupBy={groupBy}",
            "lineNumber": 4536
          },
          {
            "text": "                onGroupByChange={setGroupBy}",
            "lineNumber": 4537
          },
          {
            "text": "                isAISearchEnabled={state.settings.search.isAISearchEnabled}",
            "lineNumber": 4538
          },
          {
            "text": "                onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}",
            "lineNumber": 4539
          },
          {
            "text": "                onRememberFolderSettings={activeTab.viewMode === 'browser' ? handleRememberFolderSettings : undefined}",
            "lineNumber": 4540
          },
          {
            "text": "                hasFolderSettings={activeTab.viewMode === 'browser' ? !!state.folderSettings[activeTab.folderId] : false}",
            "lineNumber": 4541
          },
          {
            "text": "                t={t} ",
            "lineNumber": 4542
          },
          {
            "text": "              /&gt;",
            "lineNumber": 4543
          },
          {
            "text": "              {/* ... (Filter UI, same as before) ... */}",
            "lineNumber": 4544
          },
          {
            "text": "              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start || activeTab.activePersonId || activeTab.aiFilter) &amp;&amp; ( ",
            "lineNumber": 4545
          },
          {
            "text": "                  &lt;div className=\"flex items-center px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 space-x-2 overflow-x-auto shrink-0 z-20\"&gt;",
            "lineNumber": 4546
          },
          {
            "text": "                      &lt;div className=\"flex items-center text-xs text-gray-500 dark:text-gray-400 mr-2 shrink-0\"&gt;",
            "lineNumber": 4547
          },
          {
            "text": "                          &lt;Filter size={12} className=\"mr-1\"/&gt; {t('context.filters')}",
            "lineNumber": 4548
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4549
          },
          {
            "text": "                      ",
            "lineNumber": 4550
          },
          {
            "text": "                      ",
            "lineNumber": 4551
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.3009493350982666
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 156
          },
          "endPosition": {
            "line": 306,
            "column": 1
          }
        },
        "contents": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { \n  src: string; \n  alt: string; \n  isSelected: boolean;\n  filePath?: string;\n  modified?: string;\n  size?: number;\n  isHovering?: boolean;\n  fileMeta?: { format?: string };\n  resourceRoot?: string;\n  cachePath?: string;\n}) =&gt; {\n\n  \n  const [animSrc, setAnimSrc] = React.useState&lt;string | null&gt;(null);\n  // 如果有缓存，初始 loading 为 false\n  const [loading, setLoading] = React.useState(!thumbnailSrc);\n\n  React.useEffect(() =&gt; {\n    // Only load thumbnail if the component is in view or was previously in view\n    if ((isInView || wasInView) &amp;&amp; filePath &amp;&amp; resourceRoot) {\n      const cache = getGlobalCache();\n      const key = filePath; // 保持 Key 一致\n\n      // 如果已经有图了（比如从缓存中读到的），且 URL 没变，就不用重新加载\n      if (thumbnailSrc &amp;&amp; cache.get(key) === thumbnailSrc) {\n          // 这里可以不做任何事，但为了应对文件修改的情况，\n          // 可以选择继续请求，或者信任缓存。\n          // 考虑到用户对“闪烁”敏感，我们优先信任缓存。\n          // 如果真的需要更新，可以通过文件修改时间对比（这里略过，优先流畅度）\n          // return; \n      }\n\n      const controller = new AbortController();\n      const loadThumbnail = async () =&gt; {\n        // 只有当没有当前数据时才显示 loading\n        if (!thumbnailSrc) setLoading(true);\n;\n  }\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 144,
                "column": 1
              },
              "endPosition": {
                "line": 144,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 144,
                "column": 8
              },
              "endPosition": {
                "line": 144,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 144,
                "column": 14
              },
              "endPosition": {
                "line": 144,
                "column": 31
              }
            },
            {
              "startPosition": {
                "line": 144,
                "column": 42
              },
              "endPosition": {
                "line": 156,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { ",
            "lineNumber": 157
          },
          {
            "text": "  src: string; ",
            "lineNumber": 158
          },
          {
            "text": "  alt: string; ",
            "lineNumber": 159
          },
          {
            "text": "  isSelected: boolean;",
            "lineNumber": 160
          },
          {
            "text": "  filePath?: string;",
            "lineNumber": 161
          },
          {
            "text": "  modified?: string;",
            "lineNumber": 162
          },
          {
            "text": "  size?: number;",
            "lineNumber": 163
          },
          {
            "text": "  isHovering?: boolean;",
            "lineNumber": 164
          },
          {
            "text": "  fileMeta?: { format?: string };",
            "lineNumber": 165
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 166
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 167
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 168
          },
          {
            "lineNumber": 179
          },
          {
            "text": "  ",
            "lineNumber": 180
          },
          {
            "text": "  const [animSrc, setAnimSrc] = React.useState&lt;string | null&gt;(null);",
            "lineNumber": 181
          },
          {
            "text": "  // 如果有缓存，初始 loading 为 false",
            "lineNumber": 182
          },
          {
            "text": "  const [loading, setLoading] = React.useState(!thumbnailSrc);",
            "lineNumber": 183
          },
          {
            "lineNumber": 184
          },
          {
            "text": "  React.useEffect(() =&gt; {",
            "lineNumber": 185
          },
          {
            "text": "    // Only load thumbnail if the component is in view or was previously in view",
            "lineNumber": 186
          },
          {
            "text": "    if ((isInView || wasInView) &amp;&amp; filePath &amp;&amp; resourceRoot) {",
            "lineNumber": 187
          },
          {
            "text": "      const cache = getGlobalCache();",
            "lineNumber": 188
          },
          {
            "text": "      const key = filePath; // 保持 Key 一致",
            "lineNumber": 189
          },
          {
            "lineNumber": 190
          },
          {
            "text": "      // 如果已经有图了（比如从缓存中读到的），且 URL 没变，就不用重新加载",
            "lineNumber": 191
          },
          {
            "text": "      if (thumbnailSrc &amp;&amp; cache.get(key) === thumbnailSrc) {",
            "lineNumber": 192
          },
          {
            "text": "          // 这里可以不做任何事，但为了应对文件修改的情况，",
            "lineNumber": 193
          },
          {
            "text": "          // 可以选择继续请求，或者信任缓存。",
            "lineNumber": 194
          },
          {
            "text": "          // 考虑到用户对“闪烁”敏感，我们优先信任缓存。",
            "lineNumber": 195
          },
          {
            "text": "          // 如果真的需要更新，可以通过文件修改时间对比（这里略过，优先流畅度）",
            "lineNumber": 196
          },
          {
            "text": "          // return; ",
            "lineNumber": 197
          },
          {
            "text": "      }",
            "lineNumber": 198
          },
          {
            "lineNumber": 199
          },
          {
            "text": "      const controller = new AbortController();",
            "lineNumber": 200
          },
          {
            "text": "      const loadThumbnail = async () =&gt; {",
            "lineNumber": 201
          },
          {
            "text": "        // 只有当没有当前数据时才显示 loading",
            "lineNumber": 202
          },
          {
            "text": "        if (!thumbnailSrc) setLoading(true);",
            "lineNumber": 203
          },
          {
            "text": ";",
            "lineNumber": 225
          },
          {
            "text": "  }",
            "lineNumber": 233
          },
          {
            "text": "};",
            "lineNumber": 307
          }
        ]
      },
      "score": 0.29905441403388977
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\types.ts",
        "range": {
          "startPosition": {
            "line": 183
          },
          "endPosition": {
            "line": 216,
            "column": 1
          }
        },
        "contents": "export interface HistoryItem {\n;\n  viewMode: 'browser' | 'tags-overview' | 'people-overview';\n  searchQuery: string;\n  searchScope: SearchScope;\n  activeTags: string[];\n  activePersonId: string | null;\n  aiFilter?: AiSearchFilter | null;\n  scrollTop?: number;\n}\n\nexport interface TabState {\n  id: string;\n  folderId: string;\n  viewingFileId: string | null;\n  viewMode: 'browser' | 'tags-overview' | 'people-overview'; \n  layoutMode: LayoutMode;\n  searchQuery: string;\n  searchScope: SearchScope;\n  aiFilter?: AiSearchFilter | null;\n  activeTags: string[];\n  activePersonId: string | null;\n  dateFilter: DateFilter;\n  selectedFileIds: string[];\n  lastSelectedId: string | null;\n  selectedTagIds: string[];\n  selectedPersonIds: string[];\n;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export interface HistoryItem {",
            "lineNumber": 184,
            "isSignature": true
          },
          {
            "text": ";",
            "lineNumber": 186
          },
          {
            "text": "  viewMode: 'browser' | 'tags-overview' | 'people-overview';",
            "lineNumber": 187
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 188
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 189
          },
          {
            "text": "  activeTags: string[];",
            "lineNumber": 190
          },
          {
            "text": "  activePersonId: string | null;",
            "lineNumber": 191
          },
          {
            "text": "  aiFilter?: AiSearchFilter | null;",
            "lineNumber": 192
          },
          {
            "text": "  scrollTop?: number;",
            "lineNumber": 193,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 194,
            "isSignature": true
          },
          {
            "lineNumber": 195
          },
          {
            "text": "export interface TabState {",
            "lineNumber": 196,
            "isSignature": true
          },
          {
            "text": "  id: string;",
            "lineNumber": 197
          },
          {
            "text": "  folderId: string;",
            "lineNumber": 198
          },
          {
            "text": "  viewingFileId: string | null;",
            "lineNumber": 199
          },
          {
            "text": "  viewMode: 'browser' | 'tags-overview' | 'people-overview'; ",
            "lineNumber": 200
          },
          {
            "text": "  layoutMode: LayoutMode;",
            "lineNumber": 201
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 202
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 203
          },
          {
            "text": "  aiFilter?: AiSearchFilter | null;",
            "lineNumber": 204
          },
          {
            "text": "  activeTags: string[];",
            "lineNumber": 205
          },
          {
            "text": "  activePersonId: string | null;",
            "lineNumber": 206
          },
          {
            "text": "  dateFilter: DateFilter;",
            "lineNumber": 207
          },
          {
            "text": "  selectedFileIds: string[];",
            "lineNumber": 208
          },
          {
            "text": "  lastSelectedId: string | null;",
            "lineNumber": 209
          },
          {
            "text": "  selectedTagIds: string[];",
            "lineNumber": 210
          },
          {
            "text": "  selectedPersonIds: string[];",
            "lineNumber": 211
          },
          {
            "text": ";",
            "lineNumber": 216,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 217,
            "isSignature": true
          }
        ]
      },
      "score": 0.29849231243133545
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1126
          },
          "endPosition": {
            "line": 1247,
            "column": 1
          }
        },
        "contents": "const GroupContent = ({\n  group,\n  files,\n  activeTab,\n  renamingId,\n  thumbnailSize,\n  hoverPlayingId,\n  dragTargetId,\n  handleFileClick,\n  handleFileDoubleClick,\n  handleContextMenu,\n  handleStartRename,\n  handleRenameSubmit,\n  handleRenameCancel,\n  handleSetHoverPlayingId,\n  handleDragStart,\n  handleDragEnd,\n  handleDragOverFolder,\n  handleDragLeaveFolder,\n  handleDropOnFolderWrapper,\n  settings,\n  containerRect,\n  t,\n  resourceRoot,\n  cachePath\n}: any) =&gt; {\n (\n        // List layout\n        &lt;div className=\"overflow-hidden\"&gt;\n          {group.fileIds.map((id: string) =&gt; {\n            const file = files[id];\n            if (!file) return null;\n            return (\n              &lt;FileListItem\n                  key={file.id}\n                  file={file}\n                  isSelected={activeTab.selectedFileIds.includes(file.id)}\n                  renamingId={renamingId}\n                  onFileClick={handleFileClick}\n                  onFileDoubleClick={handleFileDoubleClick}\n                  onContextMenu={handleContextMenu}\n                  onStartRename={handleStartRename}\n                  onRenameSubmit={handleRenameSubmit}\n                  onRenameCancel={handleRenameCancel}\n                  onDragStart={handleDragStart}\n                  onDragEnd={handleDragEnd}\n                  onDragOver={(e: React.DragEvent) =&gt; handleDragOverFolder(e, file.id)}\n                  onDragLeave={(e: React.DragEvent) =&gt; handleDragLeaveFolder(e, file.id)}\n                  onDropOnFolder={handleDropOnFolderWrapper}\n                  onDropExternal={null}\n                  t={t}\n                  dragTargetId={dragTargetId}\n                  resourceRoot={effectiveResourceRoot}\n                  cachePath={effectiveCachePath}\n              /&gt;\n            );\n          })}\n        &lt;/div&gt;\n      ) : (\n        // Grid, adaptive, or masonry layout\n        &lt;div \n          className=\"relative\" \n          style={{ \n            width: '100%', \n            height: layout.reduce((max, item) =&gt; Math.max(max, item.y + item.height), 0) \n          }}\n        &gt;\n          {layout.map((item) =&gt; {\n            const file = files[item.id];\n            if (!file) return null;\n            \n            return (\n              &lt;FileCard\n                    key={file.id}\n                    file={file}\n                    files={files}\n          }\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const GroupContent = ({",
            "lineNumber": 1127
          },
          {
            "text": "  group,",
            "lineNumber": 1128
          },
          {
            "text": "  files,",
            "lineNumber": 1129
          },
          {
            "text": "  activeTab,",
            "lineNumber": 1130
          },
          {
            "text": "  renamingId,",
            "lineNumber": 1131
          },
          {
            "text": "  thumbnailSize,",
            "lineNumber": 1132
          },
          {
            "text": "  hoverPlayingId,",
            "lineNumber": 1133
          },
          {
            "text": "  dragTargetId,",
            "lineNumber": 1134
          },
          {
            "text": "  handleFileClick,",
            "lineNumber": 1135
          },
          {
            "text": "  handleFileDoubleClick,",
            "lineNumber": 1136
          },
          {
            "text": "  handleContextMenu,",
            "lineNumber": 1137
          },
          {
            "text": "  handleStartRename,",
            "lineNumber": 1138
          },
          {
            "text": "  handleRenameSubmit,",
            "lineNumber": 1139
          },
          {
            "text": "  handleRenameCancel,",
            "lineNumber": 1140
          },
          {
            "text": "  handleSetHoverPlayingId,",
            "lineNumber": 1141
          },
          {
            "text": "  handleDragStart,",
            "lineNumber": 1142
          },
          {
            "text": "  handleDragEnd,",
            "lineNumber": 1143
          },
          {
            "text": "  handleDragOverFolder,",
            "lineNumber": 1144
          },
          {
            "text": "  handleDragLeaveFolder,",
            "lineNumber": 1145
          },
          {
            "text": "  handleDropOnFolderWrapper,",
            "lineNumber": 1146
          },
          {
            "text": "  settings,",
            "lineNumber": 1147
          },
          {
            "text": "  containerRect,",
            "lineNumber": 1148
          },
          {
            "text": "  t,",
            "lineNumber": 1149
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 1150
          },
          {
            "text": "  cachePath",
            "lineNumber": 1151
          },
          {
            "text": "}: any) =&gt; {",
            "lineNumber": 1152
          },
          {
            "text": " (",
            "lineNumber": 1169
          },
          {
            "text": "        // List layout",
            "lineNumber": 1170
          },
          {
            "text": "        &lt;div className=\"overflow-hidden\"&gt;",
            "lineNumber": 1171
          },
          {
            "text": "          {group.fileIds.map((id: string) =&gt; {",
            "lineNumber": 1172
          },
          {
            "text": "            const file = files[id];",
            "lineNumber": 1173
          },
          {
            "text": "            if (!file) return null;",
            "lineNumber": 1174
          },
          {
            "text": "            return (",
            "lineNumber": 1175
          },
          {
            "text": "              &lt;FileListItem",
            "lineNumber": 1176
          },
          {
            "text": "                  key={file.id}",
            "lineNumber": 1177
          },
          {
            "text": "                  file={file}",
            "lineNumber": 1178
          },
          {
            "text": "                  isSelected={activeTab.selectedFileIds.includes(file.id)}",
            "lineNumber": 1179
          },
          {
            "text": "                  renamingId={renamingId}",
            "lineNumber": 1180
          },
          {
            "text": "                  onFileClick={handleFileClick}",
            "lineNumber": 1181
          },
          {
            "text": "                  onFileDoubleClick={handleFileDoubleClick}",
            "lineNumber": 1182
          },
          {
            "text": "                  onContextMenu={handleContextMenu}",
            "lineNumber": 1183
          },
          {
            "text": "                  onStartRename={handleStartRename}",
            "lineNumber": 1184
          },
          {
            "text": "                  onRenameSubmit={handleRenameSubmit}",
            "lineNumber": 1185
          },
          {
            "text": "                  onRenameCancel={handleRenameCancel}",
            "lineNumber": 1186
          },
          {
            "text": "                  onDragStart={handleDragStart}",
            "lineNumber": 1187
          },
          {
            "text": "                  onDragEnd={handleDragEnd}",
            "lineNumber": 1188
          },
          {
            "text": "                  onDragOver={(e: React.DragEvent) =&gt; handleDragOverFolder(e, file.id)}",
            "lineNumber": 1189
          },
          {
            "text": "                  onDragLeave={(e: React.DragEvent) =&gt; handleDragLeaveFolder(e, file.id)}",
            "lineNumber": 1190
          },
          {
            "text": "                  onDropOnFolder={handleDropOnFolderWrapper}",
            "lineNumber": 1191
          },
          {
            "text": "                  onDropExternal={null}",
            "lineNumber": 1192
          },
          {
            "text": "                  t={t}",
            "lineNumber": 1193
          },
          {
            "text": "                  dragTargetId={dragTargetId}",
            "lineNumber": 1194
          },
          {
            "text": "                  resourceRoot={effectiveResourceRoot}",
            "lineNumber": 1195
          },
          {
            "text": "                  cachePath={effectiveCachePath}",
            "lineNumber": 1196
          },
          {
            "text": "              /&gt;",
            "lineNumber": 1197
          },
          {
            "text": "            );",
            "lineNumber": 1198
          },
          {
            "text": "          })}",
            "lineNumber": 1199
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 1200
          },
          {
            "text": "      ) : (",
            "lineNumber": 1201
          },
          {
            "text": "        // Grid, adaptive, or masonry layout",
            "lineNumber": 1202
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 1203
          },
          {
            "text": "          className=\"relative\" ",
            "lineNumber": 1204
          },
          {
            "text": "          style={{ ",
            "lineNumber": 1205
          },
          {
            "text": "            width: '100%', ",
            "lineNumber": 1206
          },
          {
            "text": "            height: layout.reduce((max, item) =&gt; Math.max(max, item.y + item.height), 0) ",
            "lineNumber": 1207
          },
          {
            "text": "          }}",
            "lineNumber": 1208
          },
          {
            "text": "        &gt;",
            "lineNumber": 1209
          },
          {
            "text": "          {layout.map((item) =&gt; {",
            "lineNumber": 1210
          },
          {
            "text": "            const file = files[item.id];",
            "lineNumber": 1211
          },
          {
            "text": "            if (!file) return null;",
            "lineNumber": 1212
          },
          {
            "text": "            ",
            "lineNumber": 1213
          },
          {
            "text": "            return (",
            "lineNumber": 1214
          },
          {
            "text": "              &lt;FileCard",
            "lineNumber": 1215
          },
          {
            "text": "                    key={file.id}",
            "lineNumber": 1216
          },
          {
            "text": "                    file={file}",
            "lineNumber": 1217
          },
          {
            "text": "                    files={files}",
            "lineNumber": 1218
          },
          {
            "text": "          }",
            "lineNumber": 1243
          },
          {
            "text": "};",
            "lineNumber": 1248
          }
        ]
      },
      "score": 0.2982904016971588
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 156
          },
          "endPosition": {
            "line": 306,
            "column": 1
          }
        },
        "contents": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { \n  src: string; \n  alt: string; \n  isSelected: boolean;\n  filePath?: string;\n  modified?: string;\n  size?: number;\n  isHovering?: boolean;\n  fileMeta?: { format?: string };\n  resourceRoot?: string;\n  cachePath?: string;\n}) =&gt; {\n() =&gt; {\nconst loadAnimation = async \n\n              } else {\n                setAnimSrc(null);\n              }\n            }\n          } catch (e) {\n            setAnimSrc(null);\n          }\n        } else {\n          if (isMounted) {\n            setAnimSrc(null);\n          }\n        }\n      } else {\n        if (isMounted) {\n          setAnimSrc(null);\n        }\n      }\n    };\n\n    loadAnimation();\n\n    return () =&gt; {\n      isMounted = false;\n    };\n  }, [isHovering, filePath, fileMeta]);\n\n  const finalSrc = animSrc || thumbnailSrc;\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { ",
            "lineNumber": 157
          },
          {
            "text": "  src: string; ",
            "lineNumber": 158
          },
          {
            "text": "  alt: string; ",
            "lineNumber": 159
          },
          {
            "text": "  isSelected: boolean;",
            "lineNumber": 160
          },
          {
            "text": "  filePath?: string;",
            "lineNumber": 161
          },
          {
            "text": "  modified?: string;",
            "lineNumber": 162
          },
          {
            "text": "  size?: number;",
            "lineNumber": 163
          },
          {
            "text": "  isHovering?: boolean;",
            "lineNumber": 164
          },
          {
            "text": "  fileMeta?: { format?: string };",
            "lineNumber": 165
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 166
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 167
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 168
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 237
          },
          {
            "text": "const loadAnimation = async ",
            "lineNumber": 240
          },
          {
            "lineNumber": 258
          },
          {
            "text": "              } else {",
            "lineNumber": 259
          },
          {
            "text": "                setAnimSrc(null);",
            "lineNumber": 260
          },
          {
            "text": "              }",
            "lineNumber": 261
          },
          {
            "text": "            }",
            "lineNumber": 262
          },
          {
            "text": "          } catch (e) {",
            "lineNumber": 263
          },
          {
            "text": "            setAnimSrc(null);",
            "lineNumber": 264
          },
          {
            "text": "          }",
            "lineNumber": 265
          },
          {
            "text": "        } else {",
            "lineNumber": 266
          },
          {
            "text": "          if (isMounted) {",
            "lineNumber": 267
          },
          {
            "text": "            setAnimSrc(null);",
            "lineNumber": 268
          },
          {
            "text": "          }",
            "lineNumber": 269
          },
          {
            "text": "        }",
            "lineNumber": 270
          },
          {
            "text": "      } else {",
            "lineNumber": 271
          },
          {
            "text": "        if (isMounted) {",
            "lineNumber": 272
          },
          {
            "text": "          setAnimSrc(null);",
            "lineNumber": 273
          },
          {
            "text": "        }",
            "lineNumber": 274
          },
          {
            "text": "      }",
            "lineNumber": 275
          },
          {
            "text": "    };",
            "lineNumber": 276
          },
          {
            "lineNumber": 277
          },
          {
            "text": "    loadAnimation();",
            "lineNumber": 278
          },
          {
            "lineNumber": 279
          },
          {
            "text": "    return () =&gt; {",
            "lineNumber": 280
          },
          {
            "text": "      isMounted = false;",
            "lineNumber": 281
          },
          {
            "text": "    };",
            "lineNumber": 282
          },
          {
            "text": "  }, [isHovering, filePath, fileMeta]);",
            "lineNumber": 283
          },
          {
            "lineNumber": 284
          },
          {
            "text": "  const finalSrc = animSrc || thumbnailSrc;",
            "lineNumber": 285
          },
          {
            "text": "};",
            "lineNumber": 307
          }
        ]
      },
      "score": 0.2955780029296875
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "文件夹选择 folder selection highlight",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 107
          },
          "endPosition": {
            "line": 253,
            "column": 1
          }
        },
        "contents": "const FolderPickerModal = \nconst findMatchingFolders = \n\n    \n    return matchingFolders;\n  };\n  \n  // 递归渲染文件夹树，支持搜索过滤\n  const renderTree = (nodeId: string, depth = 0, matchingFolders?: Set&lt;string&gt; | null) =&gt; {\n    const node = files[nodeId];\n    if (!node || node.type !== FileType.FOLDER) return null;\n    if (selectedFileIds.includes(nodeId)) return null;\n    \n    // 如果有搜索条件，检查当前文件夹是否应该显示\n    const shouldShow = !matchingFolders || matchingFolders.has(nodeId);\n    if (!shouldShow) return null;\n    \n    const expanded = expandedIds.includes(nodeId);\n    const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];\n    \n    return (\n      &lt;div key={nodeId}&gt;\n        &lt;div \n          className={&#96;flex items-center py-1 px-2 cursor-pointer text-sm ${currentId === nodeId ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300' : 'hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300'}&#96;}\n          style={{ paddingLeft: &#96;${depth * 16 + 8}px&#96; }}\n          onClick={() =&gt; setCurrentId(nodeId)}\n        &gt;\n          {/* 展开/折叠按钮 */}\n          &lt;div \n            className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\"\n            onClick={(e) =&gt; handleToggle(e, nodeId)}\n          &gt;\n            {folderChildren.length &gt; 0 ? (\n              expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;\n            ) : &lt;div className=\"w-[14px]\" /&gt;}\n          &lt;/div&gt;\n          &lt;Folder size={14} className=\"mr-2 text-blue-500\"/&gt;\n          &lt;span className=\"truncate\"&gt;{node.name}&lt;/span&gt;\n        &lt;/div&gt;\n        {/* 只渲染展开的文件夹 */}\n        {expanded &amp;&amp; folderChildren.map((childId: string) =&gt; renderTree(childId, depth + 1, matchingFolders))}\n      &lt;/div&gt;\n    );\n  };\n  \n  const matchingFolders = findMatchingFolders();\n  \n  return (\n    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 108,
                "column": 1
              },
              "endPosition": {
                "line": 108,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 108,
                "column": 7
              },
              "endPosition": {
                "line": 108,
                "column": 27
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ",
            "lineNumber": 108
          },
          {
            "text": "const findMatchingFolders = ",
            "lineNumber": 127
          },
          {
            "lineNumber": 163
          },
          {
            "text": "    ",
            "lineNumber": 164
          },
          {
            "text": "    return matchingFolders;",
            "lineNumber": 165
          },
          {
            "text": "  };",
            "lineNumber": 166
          },
          {
            "text": "  ",
            "lineNumber": 167
          },
          {
            "text": "  // 递归渲染文件夹树，支持搜索过滤",
            "lineNumber": 168
          },
          {
            "text": "  const renderTree = (nodeId: string, depth = 0, matchingFolders?: Set&lt;string&gt; | null) =&gt; {",
            "lineNumber": 169
          },
          {
            "text": "    const node = files[nodeId];",
            "lineNumber": 170
          },
          {
            "text": "    if (!node || node.type !== FileType.FOLDER) return null;",
            "lineNumber": 171
          },
          {
            "text": "    if (selectedFileIds.includes(nodeId)) return null;",
            "lineNumber": 172
          },
          {
            "text": "    ",
            "lineNumber": 173
          },
          {
            "text": "    // 如果有搜索条件，检查当前文件夹是否应该显示",
            "lineNumber": 174
          },
          {
            "text": "    const shouldShow = !matchingFolders || matchingFolders.has(nodeId);",
            "lineNumber": 175
          },
          {
            "text": "    if (!shouldShow) return null;",
            "lineNumber": 176
          },
          {
            "text": "    ",
            "lineNumber": 177
          },
          {
            "text": "    const expanded = expandedIds.includes(nodeId);",
            "lineNumber": 178
          },
          {
            "text": "    const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];",
            "lineNumber": 179
          },
          {
            "text": "    ",
            "lineNumber": 180
          },
          {
            "text": "    return (",
            "lineNumber": 181
          },
          {
            "text": "      &lt;div key={nodeId}&gt;",
            "lineNumber": 182
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 183
          },
          {
            "text": "          className={&#96;flex items-center py-1 px-2 cursor-pointer text-sm ${currentId === nodeId ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300' : 'hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300'}&#96;}",
            "lineNumber": 184
          },
          {
            "text": "          style={{ paddingLeft: &#96;${depth * 16 + 8}px&#96; }}",
            "lineNumber": 185
          },
          {
            "text": "          onClick={() =&gt; setCurrentId(nodeId)}",
            "lineNumber": 186
          },
          {
            "text": "        &gt;",
            "lineNumber": 187
          },
          {
            "text": "          {/* 展开/折叠按钮 */}",
            "lineNumber": 188
          },
          {
            "text": "          &lt;div ",
            "lineNumber": 189
          },
          {
            "text": "            className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\"",
            "lineNumber": 190
          },
          {
            "text": "            onClick={(e) =&gt; handleToggle(e, nodeId)}",
            "lineNumber": 191
          },
          {
            "text": "          &gt;",
            "lineNumber": 192
          },
          {
            "text": "            {folderChildren.length &gt; 0 ? (",
            "lineNumber": 193
          },
          {
            "text": "              expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;",
            "lineNumber": 194
          },
          {
            "text": "            ) : &lt;div className=\"w-[14px]\" /&gt;}",
            "lineNumber": 195
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 196
          },
          {
            "text": "          &lt;Folder size={14} className=\"mr-2 text-blue-500\"/&gt;",
            "lineNumber": 197
          },
          {
            "text": "          &lt;span className=\"truncate\"&gt;{node.name}&lt;/span&gt;",
            "lineNumber": 198
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 199
          },
          {
            "text": "        {/* 只渲染展开的文件夹 */}",
            "lineNumber": 200
          },
          {
            "text": "        {expanded &amp;&amp; folderChildren.map((childId: string) =&gt; renderTree(childId, depth + 1, matchingFolders))}",
            "lineNumber": 201
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 202
          },
          {
            "text": "    );",
            "lineNumber": 203
          },
          {
            "text": "  };",
            "lineNumber": 204
          },
          {
            "text": "  ",
            "lineNumber": 205
          },
          {
            "text": "  const matchingFolders = findMatchingFolders();",
            "lineNumber": 206
          },
          {
            "text": "  ",
            "lineNumber": 207
          },
          {
            "text": "  return (",
            "lineNumber": 208
          },
          {
            "text": "    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in",
            "lineNumber": 209
          },
          {
            "text": ";",
            "lineNumber": 254
          }
        ]
      },
      "score": 0.4613906145095825
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 681
          },
          "endPosition": {
            "line": 926,
            "column": 1
          }
        },
        "contents": "const FileListItem = ({\n  file,\n  isSelected,\n  renamingId,\n  onFileClick,\n  onFileDoubleClick,\n  onContextMenu,\n  onStartRename,\n  onRenameSubmit,\n  onRenameCancel,\n  onDragStart,\n  onDragEnd,\n  onDragOver,\n  onDragLeave,\n  onDropOnFolder,\n  onDropExternal,\n  t,\n  dragTargetId,\n  resourceRoot,\n  cachePath\n}: any) =&gt; {\n\n                    &lt;/div&gt;\n                )}\n            &lt;/div&gt;\n            )}\n            {renamingId === file.id ? (\n            &lt;div className=\"w-64 pointer-events-auto\"&gt;\n                &lt;InlineRenameInput\n                    defaultValue={file.name}\n                    onCommit={(val: string) =&gt; onRenameSubmit(val, file.id)}\n                    onCancel={onRenameCancel}\n                /&gt;\n            &lt;/div&gt;\n            ) : (\n            &lt;span\n                className=\"truncate text-gray-900 dark:text-gray-100 font-bold text-sm pointer-events-auto\"\n                onDoubleClick={(e) =&gt; {\n                e.stopPropagation();\n                onStartRename(file.id);\n                }}\n            &gt;{file.name}&lt;/span&gt;\n            )}\n        &lt;/div&gt;\n        &lt;div className=\"w-32 text-xs text-gray-500 truncate hidden sm:block pointer-events-none\"&gt;\n            {file.updatedAt ? new Date(file.updatedAt).toLocaleDateString() : '-'}\n        &lt;/div&gt;\n        &lt;div className=\"w-24 text-xs text-gray-500 uppercase hidden md:block pointer-events-none\"&gt;\n            {file.type === FileType.FOLDER ? t('meta.folderType') : file.meta?.format || '-'}\n        &lt;/div&gt;\n        &lt;div className=\"w-20 text-xs text-gray-500 text-right font-mono hidden sm:block pointer-events-none\"&gt;\n            {file.type === FileType.IMAGE ? formatSize(file.meta?.sizeKb || 0) : '-'}\n        &lt;/div&gt;\n    &lt;/div&gt;\n  );\n});\n\nconst PersonCard = React.memo(({\n  person,\n  files,\n  isSelected,\n  onPersonClick,\n  onPersonDoubleClick,\n  onStartRenamePerson,\n  onPersonContextMenu,\n  t,\n  style\n}: {\n  person: Person;\n  files: Record&lt;string, FileNode&gt;;\n  isSelected: boolean;\n  onPersonClick: (id: string, e: React.MouseEvent) =&gt; void;\n  onPersonDoubleClick: (id: string) =&gt; void;\n  onStartRenamePerson?: (id: string) =&gt; void;\n  onPersonContextMenu: (e: React.MouseEvent, id: string) =&gt; void;\n  t: (key: string) =&gt; string;\n  style: any;\n}) =&gt; {\n  \n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FileListItem = ({",
            "lineNumber": 682
          },
          {
            "text": "  file,",
            "lineNumber": 683
          },
          {
            "text": "  isSelected,",
            "lineNumber": 684
          },
          {
            "text": "  renamingId,",
            "lineNumber": 685
          },
          {
            "text": "  onFileClick,",
            "lineNumber": 686
          },
          {
            "text": "  onFileDoubleClick,",
            "lineNumber": 687
          },
          {
            "text": "  onContextMenu,",
            "lineNumber": 688
          },
          {
            "text": "  onStartRename,",
            "lineNumber": 689
          },
          {
            "text": "  onRenameSubmit,",
            "lineNumber": 690
          },
          {
            "text": "  onRenameCancel,",
            "lineNumber": 691
          },
          {
            "text": "  onDragStart,",
            "lineNumber": 692
          },
          {
            "text": "  onDragEnd,",
            "lineNumber": 693
          },
          {
            "text": "  onDragOver,",
            "lineNumber": 694
          },
          {
            "text": "  onDragLeave,",
            "lineNumber": 695
          },
          {
            "text": "  onDropOnFolder,",
            "lineNumber": 696
          },
          {
            "text": "  onDropExternal,",
            "lineNumber": 697
          },
          {
            "text": "  t,",
            "lineNumber": 698
          },
          {
            "text": "  dragTargetId,",
            "lineNumber": 699
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 700
          },
          {
            "text": "  cachePath",
            "lineNumber": 701
          },
          {
            "text": "}: any) =&gt; {",
            "lineNumber": 702
          },
          {
            "lineNumber": 798
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 799
          },
          {
            "text": "                )}",
            "lineNumber": 800
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 801
          },
          {
            "text": "            )}",
            "lineNumber": 802
          },
          {
            "text": "            {renamingId === file.id ? (",
            "lineNumber": 803
          },
          {
            "text": "            &lt;div className=\"w-64 pointer-events-auto\"&gt;",
            "lineNumber": 804
          },
          {
            "text": "                &lt;InlineRenameInput",
            "lineNumber": 805
          },
          {
            "text": "                    defaultValue={file.name}",
            "lineNumber": 806
          },
          {
            "text": "                    onCommit={(val: string) =&gt; onRenameSubmit(val, file.id)}",
            "lineNumber": 807
          },
          {
            "text": "                    onCancel={onRenameCancel}",
            "lineNumber": 808
          },
          {
            "text": "                /&gt;",
            "lineNumber": 809
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 810
          },
          {
            "text": "            ) : (",
            "lineNumber": 811
          },
          {
            "text": "            &lt;span",
            "lineNumber": 812
          },
          {
            "text": "                className=\"truncate text-gray-900 dark:text-gray-100 font-bold text-sm pointer-events-auto\"",
            "lineNumber": 813
          },
          {
            "text": "                onDoubleClick={(e) =&gt; {",
            "lineNumber": 814
          },
          {
            "text": "                e.stopPropagation();",
            "lineNumber": 815
          },
          {
            "text": "                onStartRename(file.id);",
            "lineNumber": 816
          },
          {
            "text": "                }}",
            "lineNumber": 817
          },
          {
            "text": "            &gt;{file.name}&lt;/span&gt;",
            "lineNumber": 818
          },
          {
            "text": "            )}",
            "lineNumber": 819
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 820
          },
          {
            "text": "        &lt;div className=\"w-32 text-xs text-gray-500 truncate hidden sm:block pointer-events-none\"&gt;",
            "lineNumber": 821
          },
          {
            "text": "            {file.updatedAt ? new Date(file.updatedAt).toLocaleDateString() : '-'}",
            "lineNumber": 822
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 823
          },
          {
            "text": "        &lt;div className=\"w-24 text-xs text-gray-500 uppercase hidden md:block pointer-events-none\"&gt;",
            "lineNumber": 824
          },
          {
            "text": "            {file.type === FileType.FOLDER ? t('meta.folderType') : file.meta?.format || '-'}",
            "lineNumber": 825
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 826
          },
          {
            "text": "        &lt;div className=\"w-20 text-xs text-gray-500 text-right font-mono hidden sm:block pointer-events-none\"&gt;",
            "lineNumber": 827
          },
          {
            "text": "            {file.type === FileType.IMAGE ? formatSize(file.meta?.sizeKb || 0) : '-'}",
            "lineNumber": 828
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 829
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 830
          },
          {
            "text": "  );",
            "lineNumber": 831
          },
          {
            "text": "});",
            "lineNumber": 832
          },
          {
            "lineNumber": 833
          },
          {
            "text": "const PersonCard = React.memo(({",
            "lineNumber": 834
          },
          {
            "text": "  person,",
            "lineNumber": 835
          },
          {
            "text": "  files,",
            "lineNumber": 836
          },
          {
            "text": "  isSelected,",
            "lineNumber": 837
          },
          {
            "text": "  onPersonClick,",
            "lineNumber": 838
          },
          {
            "text": "  onPersonDoubleClick,",
            "lineNumber": 839
          },
          {
            "text": "  onStartRenamePerson,",
            "lineNumber": 840
          },
          {
            "text": "  onPersonContextMenu,",
            "lineNumber": 841
          },
          {
            "text": "  t,",
            "lineNumber": 842
          },
          {
            "text": "  style",
            "lineNumber": 843
          },
          {
            "text": "}: {",
            "lineNumber": 844
          },
          {
            "text": "  person: Person;",
            "lineNumber": 845
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 846
          },
          {
            "text": "  isSelected: boolean;",
            "lineNumber": 847
          },
          {
            "text": "  onPersonClick: (id: string, e: React.MouseEvent) =&gt; void;",
            "lineNumber": 848
          },
          {
            "text": "  onPersonDoubleClick: (id: string) =&gt; void;",
            "lineNumber": 849
          },
          {
            "text": "  onStartRenamePerson?: (id: string) =&gt; void;",
            "lineNumber": 850
          },
          {
            "text": "  onPersonContextMenu: (e: React.MouseEvent, id: string) =&gt; void;",
            "lineNumber": 851
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 852
          },
          {
            "text": "  style: any;",
            "lineNumber": 853
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 854
          },
          {
            "text": "  ",
            "lineNumber": 855
          },
          {
            "text": "};",
            "lineNumber": 927
          }
        ]
      },
      "score": 0.45483696460723877
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 16,
            "column": 1
          },
          "endPosition": {
            "line": 126,
            "column": 1
          }
        },
        "contents": "const TreeNode: React.FC&lt;TreeProps&gt; = ({ files, nodeId, currentFolderId, expandedIds, onToggle, onNavigate, onContextMenu, onDrop, depth = 0 }) =&gt; {\n  const node = files[nodeId];\n  const [isDragOver, setIsDragOver] = useState(false);\n\n  if (!node || node.type !== FileType.FOLDER) return null;\n\n  const isRoot = depth === 0;\n  const isSelected = nodeId === currentFolderId;\n  const expanded = expandedIds.includes(nodeId);\n  \n  const folderChildren = node.children?.filter(childId =&gt; files[childId]?.type === FileType.FOLDER) || [];\n\n  const handleToggle = (e: React.MouseEvent) =&gt; {\n    e.stopPropagation();\n    onToggle(nodeId);\n  };\n\n  const handleClick = () =&gt; {\n    onNavigate(nodeId);\n  };\n\n  const handleContextMenu = (e: React.MouseEvent) =&gt; {\n    onContextMenu(e, isRoot ? 'root-folder' : 'file', nodeId);\n  };\n\n  const handleDragOver = (e: React.DragEvent) =&gt; {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(true);\n    e.dataTransfer.dropEffect = 'move';\n  };\n\n  const handleDragLeave = (e: React.DragEvent) =&gt; {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) =&gt; {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n    \n    const data = e.dataTransfer.getData('application/json');\n    if (data) {\n      try {\n        const sourceIds = JSON.parse(data);\n        if (Array.isArray(sourceIds) &amp;&amp; sourceIds.length &gt; 0) {\n          onDrop(nodeId, sourceIds);\n        }\n      } catch (err) {\n        console.error('Failed to parse drop data', err);\n      }\n    }\n  };\n\n  const Icon = isRoot \n    ? HardDrive \n    : (node.category === 'book' ? Book : node.category === 'sequence' ? Film : Folder);\n\n  const iconColorClass = isSelected ? 'text-white' : (\n      node.category === 'book' ? 'text-amber-500' :\n      node.category === 'sequence' ? 'text-purple-500' :\n      'text-blue-500 dark:text-blue-400'\n  );\n\n  return (\n    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const TreeNode: React.FC&lt;TreeProps&gt; = ({ files, nodeId, currentFolderId, expandedIds, onToggle, onNavigate, onContextMenu, onDrop, depth = 0 }) =&gt; {",
            "lineNumber": 19
          },
          {
            "text": "  const node = files[nodeId];",
            "lineNumber": 20
          },
          {
            "text": "  const [isDragOver, setIsDragOver] = useState(false);",
            "lineNumber": 21
          },
          {
            "lineNumber": 22
          },
          {
            "text": "  if (!node || node.type !== FileType.FOLDER) return null;",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "  const isRoot = depth === 0;",
            "lineNumber": 25
          },
          {
            "text": "  const isSelected = nodeId === currentFolderId;",
            "lineNumber": 26
          },
          {
            "text": "  const expanded = expandedIds.includes(nodeId);",
            "lineNumber": 27
          },
          {
            "text": "  ",
            "lineNumber": 28
          },
          {
            "text": "  const folderChildren = node.children?.filter(childId =&gt; files[childId]?.type === FileType.FOLDER) || [];",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "  const handleToggle = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 31
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 32
          },
          {
            "text": "    onToggle(nodeId);",
            "lineNumber": 33
          },
          {
            "text": "  };",
            "lineNumber": 34
          },
          {
            "lineNumber": 35
          },
          {
            "text": "  const handleClick = () =&gt; {",
            "lineNumber": 36
          },
          {
            "text": "    onNavigate(nodeId);",
            "lineNumber": 37
          },
          {
            "text": "  };",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "  const handleContextMenu = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 40
          },
          {
            "text": "    onContextMenu(e, isRoot ? 'root-folder' : 'file', nodeId);",
            "lineNumber": 41
          },
          {
            "text": "  };",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "  const handleDragOver = (e: React.DragEvent) =&gt; {",
            "lineNumber": 44
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 45
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 46
          },
          {
            "text": "    setIsDragOver(true);",
            "lineNumber": 47
          },
          {
            "text": "    e.dataTransfer.dropEffect = 'move';",
            "lineNumber": 48
          },
          {
            "text": "  };",
            "lineNumber": 49
          },
          {
            "lineNumber": 50
          },
          {
            "text": "  const handleDragLeave = (e: React.DragEvent) =&gt; {",
            "lineNumber": 51
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 52
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 53
          },
          {
            "text": "    setIsDragOver(false);",
            "lineNumber": 54
          },
          {
            "text": "  };",
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "  const handleDrop = (e: React.DragEvent) =&gt; {",
            "lineNumber": 57
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 58
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 59
          },
          {
            "text": "    setIsDragOver(false);",
            "lineNumber": 60
          },
          {
            "text": "    ",
            "lineNumber": 61
          },
          {
            "text": "    const data = e.dataTransfer.getData('application/json');",
            "lineNumber": 62
          },
          {
            "text": "    if (data) {",
            "lineNumber": 63
          },
          {
            "text": "      try {",
            "lineNumber": 64
          },
          {
            "text": "        const sourceIds = JSON.parse(data);",
            "lineNumber": 65
          },
          {
            "text": "        if (Array.isArray(sourceIds) &amp;&amp; sourceIds.length &gt; 0) {",
            "lineNumber": 66
          },
          {
            "text": "          onDrop(nodeId, sourceIds);",
            "lineNumber": 67
          },
          {
            "text": "        }",
            "lineNumber": 68
          },
          {
            "text": "      } catch (err) {",
            "lineNumber": 69
          },
          {
            "text": "        console.error('Failed to parse drop data', err);",
            "lineNumber": 70
          },
          {
            "text": "      }",
            "lineNumber": 71
          },
          {
            "text": "    }",
            "lineNumber": 72
          },
          {
            "text": "  };",
            "lineNumber": 73
          },
          {
            "lineNumber": 74
          },
          {
            "text": "  const Icon = isRoot ",
            "lineNumber": 75
          },
          {
            "text": "    ? HardDrive ",
            "lineNumber": 76
          },
          {
            "text": "    : (node.category === 'book' ? Book : node.category === 'sequence' ? Film : Folder);",
            "lineNumber": 77
          },
          {
            "lineNumber": 78
          },
          {
            "text": "  const iconColorClass = isSelected ? 'text-white' : (",
            "lineNumber": 79
          },
          {
            "text": "      node.category === 'book' ? 'text-amber-500' :",
            "lineNumber": 80
          },
          {
            "text": "      node.category === 'sequence' ? 'text-purple-500' :",
            "lineNumber": 81
          },
          {
            "text": "      'text-blue-500 dark:text-blue-400'",
            "lineNumber": 82
          },
          {
            "text": "  );",
            "lineNumber": 83
          },
          {
            "lineNumber": 84
          },
          {
            "text": "  return (",
            "lineNumber": 85
          },
          {
            "text": "    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300",
            "lineNumber": 86
          },
          {
            "text": ";",
            "lineNumber": 127
          }
        ]
      },
      "score": 0.39461541175842285
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 18
          },
          "endPosition": {
            "line": 137,
            "column": 1
          }
        },
        "contents": "const TreeNode: React.FC&lt;TreeProps&gt; = \n\n\n  return (\n    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300\"&gt;\n      &lt;div \n        className={&#96;flex items-center py-1 px-2 cursor-pointer transition-colors border border-transparent group\n          ${isSelected ? 'bg-blue-600 text-white' : 'hover:bg-gray-200 dark:hover:bg-gray-800'}\n          ${isDragOver ? 'bg-blue-100 dark:bg-blue-900 border-blue-500 dark:border-blue-400' : ''}\n        &#96;}\n        style={{ paddingLeft: &#96;${depth * 12 + 8}px&#96; }}\n        onClick={handleClick}\n        onContextMenu={handleContextMenu}\n        onDragOver={handleDragOver}\n        onDragLeave={handleDragLeave}\n        onDrop={handleDrop}\n      &gt;\n        &lt;div \n          className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\"\n          onClick={handleToggle}\n        &gt;\n          {folderChildren.length &gt; 0 ? (\n            expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;\n          ) : &lt;div className=\"w-[14px]\" /&gt;}\n        &lt;/div&gt;\n        &lt;Icon size={16} className={&#96;mr-2 ${iconColorClass}&#96;} /&gt;\n        &lt;span className=\"truncate pointer-events-none flex-1\"&gt;{node.name}&lt;/span&gt;\n      &lt;/div&gt;\n\n      {expanded &amp;&amp; folderChildren.map(childId =&gt; (\n        &lt;TreeNode \n          key={childId}\n          files={files}\n          nodeId={childId}\n          currentFolderId={currentFolderId}\n          expandedIds={expandedIds}\n          onToggle={onToggle}\n          onNavigate={onNavigate}\n          onContextMenu={onContextMenu}\n          onDrop={onDrop}\n          depth={depth + 1}\n        /&gt;\n      ))}\n    &lt;/div&gt;\n  );\n};\n\ninterface PeopleSectionProps {\n  people: Record&lt;string, Person&gt;;\n;\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 19,
                "column": 1
              },
              "endPosition": {
                "line": 19,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 19,
                "column": 7
              },
              "endPosition": {
                "line": 19,
                "column": 39
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TreeNode: React.FC&lt;TreeProps&gt; = ",
            "lineNumber": 19
          },
          {
            "lineNumber": 83
          },
          {
            "lineNumber": 84
          },
          {
            "text": "  return (",
            "lineNumber": 85
          },
          {
            "text": "    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300\"&gt;",
            "lineNumber": 86
          },
          {
            "text": "      &lt;div ",
            "lineNumber": 87
          },
          {
            "text": "        className={&#96;flex items-center py-1 px-2 cursor-pointer transition-colors border border-transparent group",
            "lineNumber": 88
          },
          {
            "text": "          ${isSelected ? 'bg-blue-600 text-white' : 'hover:bg-gray-200 dark:hover:bg-gray-800'}",
            "lineNumber": 89
          },
          {
            "text": "          ${isDragOver ? 'bg-blue-100 dark:bg-blue-900 border-blue-500 dark:border-blue-400' : ''}",
            "lineNumber": 90
          },
          {
            "text": "        &#96;}",
            "lineNumber": 91
          },
          {
            "text": "        style={{ paddingLeft: &#96;${depth * 12 + 8}px&#96; }}",
            "lineNumber": 92
          },
          {
            "text": "        onClick={handleClick}",
            "lineNumber": 93
          },
          {
            "text": "        onContextMenu={handleContextMenu}",
            "lineNumber": 94
          },
          {
            "text": "        onDragOver={handleDragOver}",
            "lineNumber": 95
          },
          {
            "text": "        onDragLeave={handleDragLeave}",
            "lineNumber": 96
          },
          {
            "text": "        onDrop={handleDrop}",
            "lineNumber": 97
          },
          {
            "text": "      &gt;",
            "lineNumber": 98
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 99
          },
          {
            "text": "          className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\"",
            "lineNumber": 100
          },
          {
            "text": "          onClick={handleToggle}",
            "lineNumber": 101
          },
          {
            "text": "        &gt;",
            "lineNumber": 102
          },
          {
            "text": "          {folderChildren.length &gt; 0 ? (",
            "lineNumber": 103
          },
          {
            "text": "            expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;",
            "lineNumber": 104
          },
          {
            "text": "          ) : &lt;div className=\"w-[14px]\" /&gt;}",
            "lineNumber": 105
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 106
          },
          {
            "text": "        &lt;Icon size={16} className={&#96;mr-2 ${iconColorClass}&#96;} /&gt;",
            "lineNumber": 107
          },
          {
            "text": "        &lt;span className=\"truncate pointer-events-none flex-1\"&gt;{node.name}&lt;/span&gt;",
            "lineNumber": 108
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 109
          },
          {
            "lineNumber": 110
          },
          {
            "text": "      {expanded &amp;&amp; folderChildren.map(childId =&gt; (",
            "lineNumber": 111
          },
          {
            "text": "        &lt;TreeNode ",
            "lineNumber": 112
          },
          {
            "text": "          key={childId}",
            "lineNumber": 113
          },
          {
            "text": "          files={files}",
            "lineNumber": 114
          },
          {
            "text": "          nodeId={childId}",
            "lineNumber": 115
          },
          {
            "text": "          currentFolderId={currentFolderId}",
            "lineNumber": 116
          },
          {
            "text": "          expandedIds={expandedIds}",
            "lineNumber": 117
          },
          {
            "text": "          onToggle={onToggle}",
            "lineNumber": 118
          },
          {
            "text": "          onNavigate={onNavigate}",
            "lineNumber": 119
          },
          {
            "text": "          onContextMenu={onContextMenu}",
            "lineNumber": 120
          },
          {
            "text": "          onDrop={onDrop}",
            "lineNumber": 121
          },
          {
            "text": "          depth={depth + 1}",
            "lineNumber": 122
          },
          {
            "text": "        /&gt;",
            "lineNumber": 123
          },
          {
            "text": "      ))}",
            "lineNumber": 124
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 125
          },
          {
            "text": "  );",
            "lineNumber": 126
          },
          {
            "text": "};",
            "lineNumber": 127
          },
          {
            "lineNumber": 128
          },
          {
            "text": "interface PeopleSectionProps {",
            "lineNumber": 129,
            "isSignature": true
          },
          {
            "text": "  people: Record&lt;string, Person&gt;;",
            "lineNumber": 130
          },
          {
            "text": ";",
            "lineNumber": 137,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 138,
            "isSignature": true
          }
        ]
      },
      "score": 0.3814885914325714
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 107
          },
          "endPosition": {
            "line": 255,
            "column": 77
          }
        },
        "contents": "const FolderPickerModal = \n\n  \n  return (\n    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in\"&gt;\n      &lt;h3 className=\"font-bold text-lg mb-2 text-gray-900 dark:text-white\"&gt;\n        {type === 'copy-to-folder' ? t('context.copyTo') : t('context.moveTo')}\n      &lt;/h3&gt;\n      \n      {/* 搜索框 */}\n      &lt;div className=\"relative mb-4\"&gt;\n        &lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;\n        &lt;input\n          type=\"text\"\n          id=\"folder-picker-search\"\n          name=\"folder-picker-search\"\n          className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\"\n          placeholder={t('search.placeholder')}\n          value={searchQuery}\n          onChange={(e) =&gt; setSearchQuery(e.target.value)}\n          autoFocus\n        /&gt;\n        {searchQuery &amp;&amp; (\n          &lt;button\n            className=\"absolute right-2.5 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n            onClick={() =&gt; setSearchQuery('')}\n          &gt;\n            &lt;X size={14} /&gt;\n          &lt;/button&gt;\n        )}\n      &lt;/div&gt;\n      \n      &lt;div className=\"flex-1 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded mb-4 p-2 bg-gray-50 dark:bg-gray-900/50\"&gt;\n        {roots.map((rootId: string) =&gt; renderTree(rootId, 0, matchingFolders))}\n      &lt;/div&gt;\n      &lt;div className=\"flex justify-end space-x-2\"&gt;\n        &lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;\n          {t('settings.cancel')}\n        &lt;/button&gt;\n        &lt;button \n          onClick={() =&gt; currentId &amp;&amp; onConfirm(currentId)} \n          disabled={!currentId}\n          className=\"bg-blue-600 disabled:opacity-50 text-white px-3 py-1.5 rounded hover:bg-blue-700 text-sm\"\n        &gt;\n          {t('settings.confirm')}\n        &lt;/button&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  );\n};\nconst getPinyinGroup = (char: string) =&gt; { if (!char) return '#'; const c = char.charAt(0); if (/^[a-zA-Z]/.test(c)) return c.toUpperCase(); if (/^[0-9]/.test(c)) return c; if (/[\\u4e00-\\u9fa5]/.test(c)) { try { const collator = new Intl.Collator('zh-Hans-CN', { sensitivity: 'accent' }); const boundaries = [{ char: '阿', group: 'A' }, { char: '芭', group: 'B' }, { char: '擦', group: 'C' }, { char: '搭', group: 'D' }, { char: '蛾', group: 'E' }, { char: '发', group: 'F' }, { char: '噶', group: 'G' }, { char: '哈', group: 'H' }, { char: '击', group: 'J' }, { char: '喀', group: 'K' }, { char: '垃', group: 'L' }, { char: '妈', group: 'M' }, { char: '拿', group: 'N' }, { char: '哦', group: 'O' }, { char: '啪', group: 'P' }, { char: '期', group: 'Q' }, { char: '然', group: 'R' }, { char: '撒', group: 'S' }, { char: '塌', group: 'T' }, { char: '挖', group: 'W' }, { char: '昔', group: 'X' }, { char: '压', group: 'Y' }, { char: '匝', group: 'Z' }]; for (let i = boundaries.length - 1; i &gt;= 0; i--) { if (collator.compare(c, boundaries[i].char) &gt;= 0) return boundaries[i].group; } } catch (e) { console.warn('Native pinyin grouping failed', e); } } return '#'; };\nconst DUMMY_TAB: TabState = { id: 'dummy', folderId: '', viewingFileId: null, };",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 108,
                "column": 1
              },
              "endPosition": {
                "line": 108,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 108,
                "column": 7
              },
              "endPosition": {
                "line": 108,
                "column": 27
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ",
            "lineNumber": 108
          },
          {
            "lineNumber": 206
          },
          {
            "text": "  ",
            "lineNumber": 207
          },
          {
            "text": "  return (",
            "lineNumber": 208
          },
          {
            "text": "    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in\"&gt;",
            "lineNumber": 209
          },
          {
            "text": "      &lt;h3 className=\"font-bold text-lg mb-2 text-gray-900 dark:text-white\"&gt;",
            "lineNumber": 210
          },
          {
            "text": "        {type === 'copy-to-folder' ? t('context.copyTo') : t('context.moveTo')}",
            "lineNumber": 211
          },
          {
            "text": "      &lt;/h3&gt;",
            "lineNumber": 212
          },
          {
            "text": "      ",
            "lineNumber": 213
          },
          {
            "text": "      {/* 搜索框 */}",
            "lineNumber": 214
          },
          {
            "text": "      &lt;div className=\"relative mb-4\"&gt;",
            "lineNumber": 215
          },
          {
            "text": "        &lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;",
            "lineNumber": 216
          },
          {
            "text": "        &lt;input",
            "lineNumber": 217
          },
          {
            "text": "          type=\"text\"",
            "lineNumber": 218
          },
          {
            "text": "          id=\"folder-picker-search\"",
            "lineNumber": 219
          },
          {
            "text": "          name=\"folder-picker-search\"",
            "lineNumber": 220
          },
          {
            "text": "          className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\"",
            "lineNumber": 221
          },
          {
            "text": "          placeholder={t('search.placeholder')}",
            "lineNumber": 222
          },
          {
            "text": "          value={searchQuery}",
            "lineNumber": 223
          },
          {
            "text": "          onChange={(e) =&gt; setSearchQuery(e.target.value)}",
            "lineNumber": 224
          },
          {
            "text": "          autoFocus",
            "lineNumber": 225
          },
          {
            "text": "        /&gt;",
            "lineNumber": 226
          },
          {
            "text": "        {searchQuery &amp;&amp; (",
            "lineNumber": 227
          },
          {
            "text": "          &lt;button",
            "lineNumber": 228
          },
          {
            "text": "            className=\"absolute right-2.5 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"",
            "lineNumber": 229
          },
          {
            "text": "            onClick={() =&gt; setSearchQuery('')}",
            "lineNumber": 230
          },
          {
            "text": "          &gt;",
            "lineNumber": 231
          },
          {
            "text": "            &lt;X size={14} /&gt;",
            "lineNumber": 232
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 233
          },
          {
            "text": "        )}",
            "lineNumber": 234
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 235
          },
          {
            "text": "      ",
            "lineNumber": 236
          },
          {
            "text": "      &lt;div className=\"flex-1 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded mb-4 p-2 bg-gray-50 dark:bg-gray-900/50\"&gt;",
            "lineNumber": 237
          },
          {
            "text": "        {roots.map((rootId: string) =&gt; renderTree(rootId, 0, matchingFolders))}",
            "lineNumber": 238
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 239
          },
          {
            "text": "      &lt;div className=\"flex justify-end space-x-2\"&gt;",
            "lineNumber": 240
          },
          {
            "text": "        &lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;",
            "lineNumber": 241
          },
          {
            "text": "          {t('settings.cancel')}",
            "lineNumber": 242
          },
          {
            "text": "        &lt;/button&gt;",
            "lineNumber": 243
          },
          {
            "text": "        &lt;button ",
            "lineNumber": 244
          },
          {
            "text": "          onClick={() =&gt; currentId &amp;&amp; onConfirm(currentId)} ",
            "lineNumber": 245
          },
          {
            "text": "          disabled={!currentId}",
            "lineNumber": 246
          },
          {
            "text": "          className=\"bg-blue-600 disabled:opacity-50 text-white px-3 py-1.5 rounded hover:bg-blue-700 text-sm\"",
            "lineNumber": 247
          },
          {
            "text": "        &gt;",
            "lineNumber": 248
          },
          {
            "text": "          {t('settings.confirm')}",
            "lineNumber": 249
          },
          {
            "text": "        &lt;/button&gt;",
            "lineNumber": 250
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 251
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 252
          },
          {
            "text": "  );",
            "lineNumber": 253
          },
          {
            "text": "};",
            "lineNumber": 254
          },
          {
            "text": "const getPinyinGroup = (char: string) =&gt; { if (!char) return '#'; const c = char.charAt(0); if (/^[a-zA-Z]/.test(c)) return c.toUpperCase(); if (/^[0-9]/.test(c)) return c; if (/[\\u4e00-\\u9fa5]/.test(c)) { try { const collator = new Intl.Collator('zh-Hans-CN', { sensitivity: 'accent' }); const boundaries = [{ char: '阿', group: 'A' }, { char: '芭', group: 'B' }, { char: '擦', group: 'C' }, { char: '搭', group: 'D' }, { char: '蛾', group: 'E' }, { char: '发', group: 'F' }, { char: '噶', group: 'G' }, { char: '哈', group: 'H' }, { char: '击', group: 'J' }, { char: '喀', group: 'K' }, { char: '垃', group: 'L' }, { char: '妈', group: 'M' }, { char: '拿', group: 'N' }, { char: '哦', group: 'O' }, { char: '啪', group: 'P' }, { char: '期', group: 'Q' }, { char: '然', group: 'R' }, { char: '撒', group: 'S' }, { char: '塌', group: 'T' }, { char: '挖', group: 'W' }, { char: '昔', group: 'X' }, { char: '压', group: 'Y' }, { char: '匝', group: 'Z' }]; for (let i = boundaries.length - 1; i &gt;= 0; i--) { if (collator.compare(c, boundaries[i].char) &gt;= 0) return boundaries[i].group; } } catch (e) { console.warn('Native pinyin grouping failed', e); } } return '#'; };",
            "lineNumber": 255
          },
          {
            "text": "const DUMMY_TAB: TabState = { id: 'dummy', folderId: '', viewingFileId: null, };",
            "lineNumber": 256
          }
        ]
      },
      "score": 0.3814677596092224
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleExternalFileDrop = async \n\n      \n      setDragFiles(null);\n  };\n\n  const handleFileClick = (e: React.MouseEvent, id: string) =&gt; {\n    e.stopPropagation();\n    \n    // 关闭右键菜单\n    closeContextMenu();\n    \n    // If we just finished a selection box operation, don't process the click\n    if (isSelecting) return;\n    \n    const isCtrl = e.ctrlKey || e.metaKey; // Ctrl for Windows/Linux, Command for macOS\n    const isShift = e.shiftKey;\n    \n    let newSelectedFileIds: string[];\n    let newLastSelectedId: string = id;\n    \n    if (isCtrl) {\n      // Ctrl+Click: Toggle selection of this file\n      if (activeTab.selectedFileIds.includes(id)) {\n        // Remove from selection\n        newSelectedFileIds = activeTab.selectedFileIds.filter(fileId =&gt; fileId !== id);\n      } else {\n        // Add to selection\n        newSelectedFileIds = [...activeTab.selectedFileIds, id];\n      }\n    } else if (isShift &amp;&amp; activeTab.lastSelectedId &amp;&amp; activeTab.selectedFileIds.length &gt; 0) {\n      // Shift+Click: Select range from last selected to current\n      const currentFolderId = activeTab.folderId;\n      let allFiles: string[] = [];\n      \n      if (activeTab.searchQuery) {\n        // Search results view\n        allFiles = displayFileIds;\n      } else {\n        // Folder view - use displayFileIds which already contains the sorted and filtered list of files to display\n        allFiles = displayFileIds;\n      }\n      \n      const lastIndex = allFiles.indexOf(activeTab.lastSelectedId);\n      const currentIndex = allFiles.indexOf(id);\n      \n      if (lastIndex !== -1 &amp;&amp; currentIndex !== -1) {\n        const start = Math.min(lastIndex, currentIndex);\n        const end = Math.max(lastIndex, currentIndex);\n        newSelectedFileIds = allFiles.slice(start, end + 1);\n      } else {\n        newSelectedFileIds = [id];\n      }\n    } else {\n      // Normal click: Select only this file\n      newSelectedFileIds = [id];\n    }\n    \n    updateActiveTab({ \n        selectedFileIds: newSelectedFileIds, \n        lastSelectedId: newLastSelectedId \n    });\n  };\n\n  const handleMouseDown = (e: React.MouseEvent) =&gt; {\n    // 关闭右键菜单\n    closeContextMenu();\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleExternalFileDrop = async ",
            "lineNumber": 1721
          },
          {
            "lineNumber": 1759
          },
          {
            "text": "      ",
            "lineNumber": 1760
          },
          {
            "text": "      setDragFiles(null);",
            "lineNumber": 1761
          },
          {
            "text": "  };",
            "lineNumber": 1762
          },
          {
            "lineNumber": 1763
          },
          {
            "text": "  const handleFileClick = (e: React.MouseEvent, id: string) =&gt; {",
            "lineNumber": 1764
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 1765
          },
          {
            "text": "    ",
            "lineNumber": 1766
          },
          {
            "text": "    // 关闭右键菜单",
            "lineNumber": 1767
          },
          {
            "text": "    closeContextMenu();",
            "lineNumber": 1768
          },
          {
            "text": "    ",
            "lineNumber": 1769
          },
          {
            "text": "    // If we just finished a selection box operation, don't process the click",
            "lineNumber": 1770
          },
          {
            "text": "    if (isSelecting) return;",
            "lineNumber": 1771
          },
          {
            "text": "    ",
            "lineNumber": 1772
          },
          {
            "text": "    const isCtrl = e.ctrlKey || e.metaKey; // Ctrl for Windows/Linux, Command for macOS",
            "lineNumber": 1773
          },
          {
            "text": "    const isShift = e.shiftKey;",
            "lineNumber": 1774
          },
          {
            "text": "    ",
            "lineNumber": 1775
          },
          {
            "text": "    let newSelectedFileIds: string[];",
            "lineNumber": 1776
          },
          {
            "text": "    let newLastSelectedId: string = id;",
            "lineNumber": 1777
          },
          {
            "text": "    ",
            "lineNumber": 1778
          },
          {
            "text": "    if (isCtrl) {",
            "lineNumber": 1779
          },
          {
            "text": "      // Ctrl+Click: Toggle selection of this file",
            "lineNumber": 1780
          },
          {
            "text": "      if (activeTab.selectedFileIds.includes(id)) {",
            "lineNumber": 1781
          },
          {
            "text": "        // Remove from selection",
            "lineNumber": 1782
          },
          {
            "text": "        newSelectedFileIds = activeTab.selectedFileIds.filter(fileId =&gt; fileId !== id);",
            "lineNumber": 1783
          },
          {
            "text": "      } else {",
            "lineNumber": 1784
          },
          {
            "text": "        // Add to selection",
            "lineNumber": 1785
          },
          {
            "text": "        newSelectedFileIds = [...activeTab.selectedFileIds, id];",
            "lineNumber": 1786
          },
          {
            "text": "      }",
            "lineNumber": 1787
          },
          {
            "text": "    } else if (isShift &amp;&amp; activeTab.lastSelectedId &amp;&amp; activeTab.selectedFileIds.length &gt; 0) {",
            "lineNumber": 1788
          },
          {
            "text": "      // Shift+Click: Select range from last selected to current",
            "lineNumber": 1789
          },
          {
            "text": "      const currentFolderId = activeTab.folderId;",
            "lineNumber": 1790
          },
          {
            "text": "      let allFiles: string[] = [];",
            "lineNumber": 1791
          },
          {
            "text": "      ",
            "lineNumber": 1792
          },
          {
            "text": "      if (activeTab.searchQuery) {",
            "lineNumber": 1793
          },
          {
            "text": "        // Search results view",
            "lineNumber": 1794
          },
          {
            "text": "        allFiles = displayFileIds;",
            "lineNumber": 1795
          },
          {
            "text": "      } else {",
            "lineNumber": 1796
          },
          {
            "text": "        // Folder view - use displayFileIds which already contains the sorted and filtered list of files to display",
            "lineNumber": 1797
          },
          {
            "text": "        allFiles = displayFileIds;",
            "lineNumber": 1798
          },
          {
            "text": "      }",
            "lineNumber": 1799
          },
          {
            "text": "      ",
            "lineNumber": 1800
          },
          {
            "text": "      const lastIndex = allFiles.indexOf(activeTab.lastSelectedId);",
            "lineNumber": 1801
          },
          {
            "text": "      const currentIndex = allFiles.indexOf(id);",
            "lineNumber": 1802
          },
          {
            "text": "      ",
            "lineNumber": 1803
          },
          {
            "text": "      if (lastIndex !== -1 &amp;&amp; currentIndex !== -1) {",
            "lineNumber": 1804
          },
          {
            "text": "        const start = Math.min(lastIndex, currentIndex);",
            "lineNumber": 1805
          },
          {
            "text": "        const end = Math.max(lastIndex, currentIndex);",
            "lineNumber": 1806
          },
          {
            "text": "        newSelectedFileIds = allFiles.slice(start, end + 1);",
            "lineNumber": 1807
          },
          {
            "text": "      } else {",
            "lineNumber": 1808
          },
          {
            "text": "        newSelectedFileIds = [id];",
            "lineNumber": 1809
          },
          {
            "text": "      }",
            "lineNumber": 1810
          },
          {
            "text": "    } else {",
            "lineNumber": 1811
          },
          {
            "text": "      // Normal click: Select only this file",
            "lineNumber": 1812
          },
          {
            "text": "      newSelectedFileIds = [id];",
            "lineNumber": 1813
          },
          {
            "text": "    }",
            "lineNumber": 1814
          },
          {
            "text": "    ",
            "lineNumber": 1815
          },
          {
            "text": "    updateActiveTab({ ",
            "lineNumber": 1816
          },
          {
            "text": "        selectedFileIds: newSelectedFileIds, ",
            "lineNumber": 1817
          },
          {
            "text": "        lastSelectedId: newLastSelectedId ",
            "lineNumber": 1818
          },
          {
            "text": "    });",
            "lineNumber": 1819
          },
          {
            "text": "  };",
            "lineNumber": 1820
          },
          {
            "lineNumber": 1821
          },
          {
            "text": "  const handleMouseDown = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 1822
          },
          {
            "text": "    // 关闭右键菜单",
            "lineNumber": 1823
          },
          {
            "text": "    closeContextMenu();",
            "lineNumber": 1824
          },
          {
            "text": ";",
            "lineNumber": 1855
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.36957693099975586
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 106,
            "column": 2121
          },
          "endPosition": {
            "line": 253,
            "column": 1
          }
        },
        "contents": "const FolderPickerModal = ({ type, files, roots, selectedFileIds, onClose, onConfirm, t }: any) =&gt; {\n  const [currentId, setCurrentId] = useState&lt;string | null&gt;(null);\n  const [searchQuery, setSearchQuery] = useState(''); // 搜索状态\n  // 初始化时将所有根目录 ID 添加到 expandedIds 中，让根目录默认展开\n  const [expandedIds, setExpandedIds] = useState&lt;string[]&gt;(roots); // 跟踪展开的文件夹\n  \n  // 展开/折叠文件夹\n  const handleToggle = (e: React.MouseEvent, nodeId: string) =&gt; {\n    e.stopPropagation();\n    setExpandedIds(prev =&gt; {\n      if (prev.includes(nodeId)) {\n        return prev.filter(id =&gt; id !== nodeId);\n      } else {\n        return [...prev, nodeId];\n      }\n    });\n  };\n  \n  // 查找所有匹配的文件夹及其祖先文件夹\n  const findMatchingFolders = (): Set&lt;string&gt; | null =&gt; {\n    // 如果搜索框为空，返回 null，表示不需要过滤\n    if (!searchQuery.trim()) {\n      return null;\n    }\n;\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ({ type, files, roots, selectedFileIds, onClose, onConfirm, t }: any) =&gt; {",
            "lineNumber": 108
          },
          {
            "text": "  const [currentId, setCurrentId] = useState&lt;string | null&gt;(null);",
            "lineNumber": 109
          },
          {
            "text": "  const [searchQuery, setSearchQuery] = useState(''); // 搜索状态",
            "lineNumber": 110
          },
          {
            "text": "  // 初始化时将所有根目录 ID 添加到 expandedIds 中，让根目录默认展开",
            "lineNumber": 111
          },
          {
            "text": "  const [expandedIds, setExpandedIds] = useState&lt;string[]&gt;(roots); // 跟踪展开的文件夹",
            "lineNumber": 112
          },
          {
            "text": "  ",
            "lineNumber": 113
          },
          {
            "text": "  // 展开/折叠文件夹",
            "lineNumber": 114
          },
          {
            "text": "  const handleToggle = (e: React.MouseEvent, nodeId: string) =&gt; {",
            "lineNumber": 115
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 116
          },
          {
            "text": "    setExpandedIds(prev =&gt; {",
            "lineNumber": 117
          },
          {
            "text": "      if (prev.includes(nodeId)) {",
            "lineNumber": 118
          },
          {
            "text": "        return prev.filter(id =&gt; id !== nodeId);",
            "lineNumber": 119
          },
          {
            "text": "      } else {",
            "lineNumber": 120
          },
          {
            "text": "        return [...prev, nodeId];",
            "lineNumber": 121
          },
          {
            "text": "      }",
            "lineNumber": 122
          },
          {
            "text": "    });",
            "lineNumber": 123
          },
          {
            "text": "  };",
            "lineNumber": 124
          },
          {
            "text": "  ",
            "lineNumber": 125
          },
          {
            "text": "  // 查找所有匹配的文件夹及其祖先文件夹",
            "lineNumber": 126
          },
          {
            "text": "  const findMatchingFolders = (): Set&lt;string&gt; | null =&gt; {",
            "lineNumber": 127
          },
          {
            "text": "    // 如果搜索框为空，返回 null，表示不需要过滤",
            "lineNumber": 128
          },
          {
            "text": "    if (!searchQuery.trim()) {",
            "lineNumber": 129
          },
          {
            "text": "      return null;",
            "lineNumber": 130
          },
          {
            "text": "    }",
            "lineNumber": 131
          },
          {
            "text": ";",
            "lineNumber": 166
          },
          {
            "text": ";",
            "lineNumber": 254
          }
        ]
      },
      "score": 0.36943280696868896
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 77
          },
          "endPosition": {
            "line": 244,
            "column": 1
          }
        },
        "contents": "const extractPalette = async \n(resolve) =&gt; {\n() =&gt; {\n\n            }\n        };\n        img.onerror = () =&gt; resolve([]);\n    });\n};\n\nconst CategorySelector = ({ current, onChange, t }: any) =&gt; (\n  &lt;div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-800\"&gt;\n      &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2\"&gt;{t('meta.folderCategory')}&lt;/div&gt;\n      &lt;div className=\"flex bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl gap-2\"&gt;\n          {['general', 'book', 'sequence'].map((cat) =&gt; {\n              const isActive = current === cat;\n              return (\n                  &lt;button\n                      key={cat}\n                      onClick={() =&gt; onChange(cat)}\n                      className={&#96;flex-1 flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all ${\n                          isActive\n                          ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-md ring-1 ring-black/5 dark:ring-white/10' \n                          : 'text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-100'\n                      }&#96;}\n                  &gt;\n                      {cat === 'general' &amp;&amp; &lt;Folder size={20} className={&#96;mb-1.5 ${isActive ? 'fill-blue-100 dark:fill-blue-900/30' : ''}&#96;}/&gt;}\n                      {cat === 'book' &amp;&amp; &lt;Book size={20} className={&#96;mb-1.5 ${isActive ? 'fill-amber-100 dark:fill-amber-900/30' : ''}&#96;}/&gt;}\n                      {cat === 'sequence' &amp;&amp; &lt;Film size={20} className={&#96;mb-1.5 ${isActive ? 'fill-purple-100 dark:fill-purple-900/30' : ''}&#96;}/&gt;}\n                      {t(&#96;meta.cat${cat.charAt(0).toUpperCase() + cat.slice(1)}&#96;)}\n                  &lt;/button&gt;\n              );\n          })}\n      &lt;/div&gt;\n  &lt;/div&gt;\n);\n\nconst DistributionChart = ({ data, totalFiles }\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const extractPalette = async ",
            "lineNumber": 78
          },
          {
            "text": "(resolve) =&gt; {",
            "lineNumber": 79
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 83
          },
          {
            "lineNumber": 185
          },
          {
            "text": "            }",
            "lineNumber": 186
          },
          {
            "text": "        };",
            "lineNumber": 187
          },
          {
            "text": "        img.onerror = () =&gt; resolve([]);",
            "lineNumber": 188
          },
          {
            "text": "    });",
            "lineNumber": 189
          },
          {
            "text": "};",
            "lineNumber": 190
          },
          {
            "lineNumber": 191
          },
          {
            "text": "const CategorySelector = ({ current, onChange, t }: any) =&gt; (",
            "lineNumber": 192
          },
          {
            "text": "  &lt;div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-800\"&gt;",
            "lineNumber": 193
          },
          {
            "text": "      &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2\"&gt;{t('meta.folderCategory')}&lt;/div&gt;",
            "lineNumber": 194
          },
          {
            "text": "      &lt;div className=\"flex bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl gap-2\"&gt;",
            "lineNumber": 195
          },
          {
            "text": "          {['general', 'book', 'sequence'].map((cat) =&gt; {",
            "lineNumber": 196
          },
          {
            "text": "              const isActive = current === cat;",
            "lineNumber": 197
          },
          {
            "text": "              return (",
            "lineNumber": 198
          },
          {
            "text": "                  &lt;button",
            "lineNumber": 199
          },
          {
            "text": "                      key={cat}",
            "lineNumber": 200
          },
          {
            "text": "                      onClick={() =&gt; onChange(cat)}",
            "lineNumber": 201
          },
          {
            "text": "                      className={&#96;flex-1 flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all ${",
            "lineNumber": 202
          },
          {
            "text": "                          isActive",
            "lineNumber": 203
          },
          {
            "text": "                          ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-md ring-1 ring-black/5 dark:ring-white/10' ",
            "lineNumber": 204
          },
          {
            "text": "                          : 'text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-100'",
            "lineNumber": 205
          },
          {
            "text": "                      }&#96;}",
            "lineNumber": 206
          },
          {
            "text": "                  &gt;",
            "lineNumber": 207
          },
          {
            "text": "                      {cat === 'general' &amp;&amp; &lt;Folder size={20} className={&#96;mb-1.5 ${isActive ? 'fill-blue-100 dark:fill-blue-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 208
          },
          {
            "text": "                      {cat === 'book' &amp;&amp; &lt;Book size={20} className={&#96;mb-1.5 ${isActive ? 'fill-amber-100 dark:fill-amber-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 209
          },
          {
            "text": "                      {cat === 'sequence' &amp;&amp; &lt;Film size={20} className={&#96;mb-1.5 ${isActive ? 'fill-purple-100 dark:fill-purple-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 210
          },
          {
            "text": "                      {t(&#96;meta.cat${cat.charAt(0).toUpperCase() + cat.slice(1)}&#96;)}",
            "lineNumber": 211
          },
          {
            "text": "                  &lt;/button&gt;",
            "lineNumber": 212
          },
          {
            "text": "              );",
            "lineNumber": 213
          },
          {
            "text": "          })}",
            "lineNumber": 214
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 215
          },
          {
            "text": "  &lt;/div&gt;",
            "lineNumber": 216
          },
          {
            "text": ");",
            "lineNumber": 217
          },
          {
            "lineNumber": 218
          },
          {
            "text": "const DistributionChart = ({ data, totalFiles }",
            "lineNumber": 219
          },
          {
            "text": ";",
            "lineNumber": 245
          }
        ]
      },
      "score": 0.36136776208877563
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 449
          },
          "endPosition": {
            "line": 510,
            "column": 1
          }
        },
        "contents": "export const InlineRenameInput = \n\n\n  useEffect(() =&gt; {\n    if (inputRef.current) {\n      inputRef.current.focus();\n      const lastDot = defaultValue.lastIndexOf('.');\n      if (lastDot &gt; 0) {\n        inputRef.current.setSelectionRange(0, lastDot);\n      } else {\n        inputRef.current.select();\n      }\n    }\n  }, []);\n\n  const handleKeyDown = (e: React.KeyboardEvent) =&gt; {\n    if (e.key === 'Enter') {\n      e.stopPropagation();\n      onCommit(inputRef.current?.value || defaultValue);\n    }\n    if (e.key === 'Escape') {\n      e.stopPropagation();\n      onCancel();\n    }\n  };\n\n  return (\n    &lt;input\n      ref={inputRef}\n      type=\"text\"\n      defaultValue={defaultValue}\n      onBlur={(e) =&gt; onCommit(e.target.value)}\n      onKeyDown={handleKeyDown}\n      onClick={(e) =&gt; e.stopPropagation()}\n      onMouseDown={(e) =&gt; e.stopPropagation()}\n      className=\"w-full text-center text-xs font-bold bg-white dark:bg-gray-700 border border-blue-500 rounded px-1 py-0.5 focus:outline-none shadow-sm cursor-text\"\n    /&gt;\n  );\n};\n\nconst TagItem = React.memo(({ tag, count, isSelected, onTagClick, onTagDoubleClick, onTagContextMenu, handleMouseEnter, handleMouseLeave }: any) =&gt; {\n  return (\n    &lt;div \n      key={tag} \n      data-tag={tag}\n      className={&#96;tag-item rounded-lg p-4 border cursor-pointer group transition-all relative ${isSelected ? 'bg-blue-100 dark:bg-blue-900/40 border-blue-500' : 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500'}&#96;} \n      onClick={(e) =&gt; { e.stopPropagation(); onTagClick &amp;&amp; onTagClick(tag, e); }}\n      onMouseDown={(e) =&gt; e.stopPropagation()}\n      onDoubleClick={() =&gt; onTagDoubleClick &amp;&amp; onTagDoubleClick(tag)} \n      onContextMenu={(e) =&gt; onTagContextMenu &amp;&amp; onTagContextMenu(e, tag)}\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export const InlineRenameInput = ",
            "lineNumber": 450
          },
          {
            "lineNumber": 451
          },
          {
            "lineNumber": 452
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 453
          },
          {
            "text": "    if (inputRef.current) {",
            "lineNumber": 454
          },
          {
            "text": "      inputRef.current.focus();",
            "lineNumber": 455
          },
          {
            "text": "      const lastDot = defaultValue.lastIndexOf('.');",
            "lineNumber": 456
          },
          {
            "text": "      if (lastDot &gt; 0) {",
            "lineNumber": 457
          },
          {
            "text": "        inputRef.current.setSelectionRange(0, lastDot);",
            "lineNumber": 458
          },
          {
            "text": "      } else {",
            "lineNumber": 459
          },
          {
            "text": "        inputRef.current.select();",
            "lineNumber": 460
          },
          {
            "text": "      }",
            "lineNumber": 461
          },
          {
            "text": "    }",
            "lineNumber": 462
          },
          {
            "text": "  }, []);",
            "lineNumber": 463
          },
          {
            "lineNumber": 464
          },
          {
            "text": "  const handleKeyDown = (e: React.KeyboardEvent) =&gt; {",
            "lineNumber": 465
          },
          {
            "text": "    if (e.key === 'Enter') {",
            "lineNumber": 466
          },
          {
            "text": "      e.stopPropagation();",
            "lineNumber": 467
          },
          {
            "text": "      onCommit(inputRef.current?.value || defaultValue);",
            "lineNumber": 468
          },
          {
            "text": "    }",
            "lineNumber": 469
          },
          {
            "text": "    if (e.key === 'Escape') {",
            "lineNumber": 470
          },
          {
            "text": "      e.stopPropagation();",
            "lineNumber": 471
          },
          {
            "text": "      onCancel();",
            "lineNumber": 472
          },
          {
            "text": "    }",
            "lineNumber": 473
          },
          {
            "text": "  };",
            "lineNumber": 474
          },
          {
            "lineNumber": 475
          },
          {
            "text": "  return (",
            "lineNumber": 476
          },
          {
            "text": "    &lt;input",
            "lineNumber": 477
          },
          {
            "text": "      ref={inputRef}",
            "lineNumber": 478
          },
          {
            "text": "      type=\"text\"",
            "lineNumber": 479
          },
          {
            "text": "      defaultValue={defaultValue}",
            "lineNumber": 480
          },
          {
            "text": "      onBlur={(e) =&gt; onCommit(e.target.value)}",
            "lineNumber": 481
          },
          {
            "text": "      onKeyDown={handleKeyDown}",
            "lineNumber": 482
          },
          {
            "text": "      onClick={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 483
          },
          {
            "text": "      onMouseDown={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 484
          },
          {
            "text": "      className=\"w-full text-center text-xs font-bold bg-white dark:bg-gray-700 border border-blue-500 rounded px-1 py-0.5 focus:outline-none shadow-sm cursor-text\"",
            "lineNumber": 485
          },
          {
            "text": "    /&gt;",
            "lineNumber": 486
          },
          {
            "text": "  );",
            "lineNumber": 487
          },
          {
            "text": "};",
            "lineNumber": 488
          },
          {
            "lineNumber": 489
          },
          {
            "text": "const TagItem = React.memo(({ tag, count, isSelected, onTagClick, onTagDoubleClick, onTagContextMenu, handleMouseEnter, handleMouseLeave }: any) =&gt; {",
            "lineNumber": 490
          },
          {
            "text": "  return (",
            "lineNumber": 491
          },
          {
            "text": "    &lt;div ",
            "lineNumber": 492
          },
          {
            "text": "      key={tag} ",
            "lineNumber": 493
          },
          {
            "text": "      data-tag={tag}",
            "lineNumber": 494
          },
          {
            "text": "      className={&#96;tag-item rounded-lg p-4 border cursor-pointer group transition-all relative ${isSelected ? 'bg-blue-100 dark:bg-blue-900/40 border-blue-500' : 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500'}&#96;} ",
            "lineNumber": 495
          },
          {
            "text": "      onClick={(e) =&gt; { e.stopPropagation(); onTagClick &amp;&amp; onTagClick(tag, e); }}",
            "lineNumber": 496
          },
          {
            "text": "      onMouseDown={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 497
          },
          {
            "text": "      onDoubleClick={() =&gt; onTagDoubleClick &amp;&amp; onTagDoubleClick(tag)} ",
            "lineNumber": 498
          },
          {
            "text": "      onContextMenu={(e) =&gt; onTagContextMenu &amp;&amp; onTagContextMenu(e, tag)}",
            "lineNumber": 499
          },
          {
            "text": "};",
            "lineNumber": 511
          }
        ]
      },
      "score": 0.34777355194091797
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1477
          },
          "endPosition": {
            "line": 1958,
            "column": 1
          }
        },
        "contents": "export const FileGrid: React.FC&lt;FileGridProps&gt; = \n\n  onBackgroundContextMenu,\n  people,\n  groupedTags,\n  onPersonClick,\n  onPersonContextMenu,\n  onPersonDoubleClick,\n  onStartRenamePerson,\n  onTagClick,\n  onTagContextMenu,\n  onTagDoubleClick,\n  groupedFiles = [],\n  groupBy = 'none',\n  collapsedGroups = {},\n  onToggleGroup,\n  isSelecting,\n  selectionBox,\n  t,\n  onThumbnailSizeChange,\n  onUpdateFile,\n  settings,\n  onScrollTopChange\n}) =&gt; {\n  // #region agent log\n  // Removed debug logs\n  // #endregion\n\n  const [dragTargetId, setDragTargetId] = useState&lt;string | null&gt;(null);\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const FileGrid: React.FC&lt;FileGridProps&gt; = ",
            "lineNumber": 1478
          },
          {
            "lineNumber": 1501
          },
          {
            "text": "  onBackgroundContextMenu,",
            "lineNumber": 1502
          },
          {
            "text": "  people,",
            "lineNumber": 1503
          },
          {
            "text": "  groupedTags,",
            "lineNumber": 1504
          },
          {
            "text": "  onPersonClick,",
            "lineNumber": 1505
          },
          {
            "text": "  onPersonContextMenu,",
            "lineNumber": 1506
          },
          {
            "text": "  onPersonDoubleClick,",
            "lineNumber": 1507
          },
          {
            "text": "  onStartRenamePerson,",
            "lineNumber": 1508
          },
          {
            "text": "  onTagClick,",
            "lineNumber": 1509
          },
          {
            "text": "  onTagContextMenu,",
            "lineNumber": 1510
          },
          {
            "text": "  onTagDoubleClick,",
            "lineNumber": 1511
          },
          {
            "text": "  groupedFiles = [],",
            "lineNumber": 1512
          },
          {
            "text": "  groupBy = 'none',",
            "lineNumber": 1513
          },
          {
            "text": "  collapsedGroups = {},",
            "lineNumber": 1514
          },
          {
            "text": "  onToggleGroup,",
            "lineNumber": 1515
          },
          {
            "text": "  isSelecting,",
            "lineNumber": 1516
          },
          {
            "text": "  selectionBox,",
            "lineNumber": 1517
          },
          {
            "text": "  t,",
            "lineNumber": 1518
          },
          {
            "text": "  onThumbnailSizeChange,",
            "lineNumber": 1519
          },
          {
            "text": "  onUpdateFile,",
            "lineNumber": 1520
          },
          {
            "text": "  settings,",
            "lineNumber": 1521
          },
          {
            "text": "  onScrollTopChange",
            "lineNumber": 1522
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 1523
          },
          {
            "text": "  // #region agent log",
            "lineNumber": 1524
          },
          {
            "text": "  // Removed debug logs",
            "lineNumber": 1525
          },
          {
            "text": "  // #endregion",
            "lineNumber": 1526
          },
          {
            "lineNumber": 1527
          },
          {
            "text": "  const [dragTargetId, setDragTargetId] = useState&lt;string | null&gt;(null);",
            "lineNumber": 1528
          },
          {
            "text": ";",
            "lineNumber": 1959
          }
        ]
      },
      "score": 0.34705281257629395
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 512
          },
          "endPosition": {
            "line": 679,
            "column": 1
          }
        },
        "contents": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {\n(group: string) =&gt; {\n(tag: string) =&gt; {\n\n                           return (\n                              &lt;TagItem \n                                  key={tag}\n                                  tag={tag}\n                                  count={count}\n                                  isSelected={isSelected}\n                                  onTagClick={onTagClick}\n                                  onTagDoubleClick={onTagDoubleClick}\n                                  onTagContextMenu={onTagContextMenu}\n                                  handleMouseEnter={handleMouseEnter}\n                                  handleMouseLeave={handleMouseLeave}\n                              /&gt;\n                           );\n                       })}\n                   &lt;/div&gt;\n              &lt;/div&gt;\n          );\n      })}\n\n      {hoveredTag &amp;&amp; previewImages.length &gt; 0 &amp;&amp; hoveredTagPos &amp;&amp; createPortal(\n        &lt;div \n          className=\"fixed z-[100] bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl p-3 w-64 animate-fade-in pointer-events-none\" \n          style={{ top: hoveredTagPos.top, left: hoveredTagPos.left }}\n        &gt;\n          &lt;div className=\"text-sm text-gray-800 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-600 pb-1 font-bold flex items-center justify-between\"&gt;\n             &lt;span&gt;{t('sidebar.tagPreview')} \"{hoveredTag}\"&lt;/span&gt;\n             &lt;span className=\"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 rounded\"&gt;{previewImages.length} {t('sidebar.recent')}&lt;/span&gt;\n          &lt;/div&gt;\n          &lt;div className=\"grid grid-cols-3 gap-2\"&gt;\n            {previewImages.map((f: any) =&gt; (\n              &lt;div key={f.id} className=\"aspect-square bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-700 overflow-hidden\"&gt;\n                 {/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */}\n                 &lt;div className=\"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center\"&gt;\n                   &lt;ImageIcon className=\"text-gray-400 dark:text-gray-500\" size={20} /&gt;\n                 &lt;/div&gt;\n              &lt;/div&gt;\n            ))}\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {",
            "lineNumber": 513
          },
          {
            "text": "(group: string) =&gt; {",
            "lineNumber": 616
          },
          {
            "text": "(tag: string) =&gt; {",
            "lineNumber": 629
          },
          {
            "lineNumber": 631
          },
          {
            "text": "                           return (",
            "lineNumber": 632
          },
          {
            "text": "                              &lt;TagItem ",
            "lineNumber": 633
          },
          {
            "text": "                                  key={tag}",
            "lineNumber": 634
          },
          {
            "text": "                                  tag={tag}",
            "lineNumber": 635
          },
          {
            "text": "                                  count={count}",
            "lineNumber": 636
          },
          {
            "text": "                                  isSelected={isSelected}",
            "lineNumber": 637
          },
          {
            "text": "                                  onTagClick={onTagClick}",
            "lineNumber": 638
          },
          {
            "text": "                                  onTagDoubleClick={onTagDoubleClick}",
            "lineNumber": 639
          },
          {
            "text": "                                  onTagContextMenu={onTagContextMenu}",
            "lineNumber": 640
          },
          {
            "text": "                                  handleMouseEnter={handleMouseEnter}",
            "lineNumber": 641
          },
          {
            "text": "                                  handleMouseLeave={handleMouseLeave}",
            "lineNumber": 642
          },
          {
            "text": "                              /&gt;",
            "lineNumber": 643
          },
          {
            "text": "                           );",
            "lineNumber": 644
          },
          {
            "text": "                       })}",
            "lineNumber": 645
          },
          {
            "text": "                   &lt;/div&gt;",
            "lineNumber": 646
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 647
          },
          {
            "text": "          );",
            "lineNumber": 648
          },
          {
            "text": "      })}",
            "lineNumber": 649
          },
          {
            "lineNumber": 650
          },
          {
            "text": "      {hoveredTag &amp;&amp; previewImages.length &gt; 0 &amp;&amp; hoveredTagPos &amp;&amp; createPortal(",
            "lineNumber": 651
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 652
          },
          {
            "text": "          className=\"fixed z-[100] bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl p-3 w-64 animate-fade-in pointer-events-none\" ",
            "lineNumber": 653
          },
          {
            "text": "          style={{ top: hoveredTagPos.top, left: hoveredTagPos.left }}",
            "lineNumber": 654
          },
          {
            "text": "        &gt;",
            "lineNumber": 655
          },
          {
            "text": "          &lt;div className=\"text-sm text-gray-800 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-600 pb-1 font-bold flex items-center justify-between\"&gt;",
            "lineNumber": 656
          },
          {
            "text": "             &lt;span&gt;{t('sidebar.tagPreview')} \"{hoveredTag}\"&lt;/span&gt;",
            "lineNumber": 657
          },
          {
            "text": "             &lt;span className=\"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 rounded\"&gt;{previewImages.length} {t('sidebar.recent')}&lt;/span&gt;",
            "lineNumber": 658
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 659
          },
          {
            "text": "          &lt;div className=\"grid grid-cols-3 gap-2\"&gt;",
            "lineNumber": 660
          },
          {
            "text": "            {previewImages.map((f: any) =&gt; (",
            "lineNumber": 661
          },
          {
            "text": "              &lt;div key={f.id} className=\"aspect-square bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-700 overflow-hidden\"&gt;",
            "lineNumber": 662
          },
          {
            "text": "                 {/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */}",
            "lineNumber": 663
          },
          {
            "text": "                 &lt;div className=\"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center\"&gt;",
            "lineNumber": 664
          },
          {
            "text": "                   &lt;ImageIcon className=\"text-gray-400 dark:text-gray-500\" size={20} /&gt;",
            "lineNumber": 665
          },
          {
            "text": "                 &lt;/div&gt;",
            "lineNumber": 666
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 667
          },
          {
            "text": "            ))}",
            "lineNumber": 668
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 669
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 670
          },
          {
            "lineNumber": 672
          },
          {
            "text": "}",
            "lineNumber": 675
          },
          {
            "text": ";",
            "lineNumber": 680
          }
        ]
      },
      "score": 0.3441222012042999
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 246
          },
          "endPosition": {
            "line": 1381,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst colors = \n);\n\n  const folderDetails = useMemo(() =&gt; {\n    if (file &amp;&amp; file.type === FileType.FOLDER) {\n        const types: Record&lt;string, number&gt; = {};\n        let totalFiles = 0;\n        let subFolderCount = 0;\n        \n        const stack = [file.id];\n        \n        while(stack.length) {\n            const currentId = stack.pop()!;\n            const node = files[currentId];\n            if (!node) continue;\n            \n            if (currentId !== file.id) {\n                if (node.type === FileType.FOLDER) {\n                    subFolderCount++;\n                } else if (node.type === FileType.IMAGE) {\n                    totalFiles++;\n                    const fmt = node.meta?.format.toUpperCase() || 'OTHER';\n                    types[fmt] = (types[fmt] || 0) + 1;\n                }\n            }\n\n            if (node.children) {\n                stack.push(...node.children);\n            }\n        }\n        \n        return { types, totalFiles, subFolderCount };\n    }\n    return null;\n  }, [file, files]);\n\n  const folderStats = useMemo(() =&gt; {\n    if (file &amp;&amp; file.type === FileType.FOLDER) {\n      return getFolderStats(files, file.id);\n    }\n    return null;\n  }, [file, files]);\n\n  const folderPreviewImages = useMemo(() =&gt; {\n    if (file &amp;&amp; file.type === FileType.FOLDER) {\n        // Custom logic for Tauri to use Asset Protocol\n        const found: string[] = [];\n        const queue = [...(file.children || [])];\n        let head = 0;\n        let iterations = 0;\n        const maxIterations = 200;\n\n        while (head &lt; queue.length &amp;&amp; found.length &lt; 3 &amp;&amp; iterations &lt; maxIterations) {\n            const id = queue[head++];\n            iterations++;\n            const node = files[id];\n            if (!node) continue;\n            \n            if (node.type === FileType.IMAGE &amp;&amp; node.path) {\n                found.push(convertFileSrc(node.path));\n            } else if (node.type === FileType.FOLDER &amp;&amp; node.children) {\n                queue.push(...node.children);\n            }\n        }\n        return found;\n    }\n    return [];\n  }, [file, files]);\n\n  const typeColors: Record&lt;string, string&gt; = {\n      \n  };\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 247
          },
          {
            "text": "const colors = ",
            "lineNumber": 418
          },
          {
            "text": ");",
            "lineNumber": 432
          },
          {
            "lineNumber": 433
          },
          {
            "text": "  const folderDetails = useMemo(() =&gt; {",
            "lineNumber": 434
          },
          {
            "text": "    if (file &amp;&amp; file.type === FileType.FOLDER) {",
            "lineNumber": 435
          },
          {
            "text": "        const types: Record&lt;string, number&gt; = {};",
            "lineNumber": 436
          },
          {
            "text": "        let totalFiles = 0;",
            "lineNumber": 437
          },
          {
            "text": "        let subFolderCount = 0;",
            "lineNumber": 438
          },
          {
            "text": "        ",
            "lineNumber": 439
          },
          {
            "text": "        const stack = [file.id];",
            "lineNumber": 440
          },
          {
            "text": "        ",
            "lineNumber": 441
          },
          {
            "text": "        while(stack.length) {",
            "lineNumber": 442
          },
          {
            "text": "            const currentId = stack.pop()!;",
            "lineNumber": 443
          },
          {
            "text": "            const node = files[currentId];",
            "lineNumber": 444
          },
          {
            "text": "            if (!node) continue;",
            "lineNumber": 445
          },
          {
            "text": "            ",
            "lineNumber": 446
          },
          {
            "text": "            if (currentId !== file.id) {",
            "lineNumber": 447
          },
          {
            "text": "                if (node.type === FileType.FOLDER) {",
            "lineNumber": 448
          },
          {
            "text": "                    subFolderCount++;",
            "lineNumber": 449
          },
          {
            "text": "                } else if (node.type === FileType.IMAGE) {",
            "lineNumber": 450
          },
          {
            "text": "                    totalFiles++;",
            "lineNumber": 451
          },
          {
            "text": "                    const fmt = node.meta?.format.toUpperCase() || 'OTHER';",
            "lineNumber": 452
          },
          {
            "text": "                    types[fmt] = (types[fmt] || 0) + 1;",
            "lineNumber": 453
          },
          {
            "text": "                }",
            "lineNumber": 454
          },
          {
            "text": "            }",
            "lineNumber": 455
          },
          {
            "lineNumber": 456
          },
          {
            "text": "            if (node.children) {",
            "lineNumber": 457
          },
          {
            "text": "                stack.push(...node.children);",
            "lineNumber": 458
          },
          {
            "text": "            }",
            "lineNumber": 459
          },
          {
            "text": "        }",
            "lineNumber": 460
          },
          {
            "text": "        ",
            "lineNumber": 461
          },
          {
            "text": "        return { types, totalFiles, subFolderCount };",
            "lineNumber": 462
          },
          {
            "text": "    }",
            "lineNumber": 463
          },
          {
            "text": "    return null;",
            "lineNumber": 464
          },
          {
            "text": "  }, [file, files]);",
            "lineNumber": 465
          },
          {
            "lineNumber": 466
          },
          {
            "text": "  const folderStats = useMemo(() =&gt; {",
            "lineNumber": 467
          },
          {
            "text": "    if (file &amp;&amp; file.type === FileType.FOLDER) {",
            "lineNumber": 468
          },
          {
            "text": "      return getFolderStats(files, file.id);",
            "lineNumber": 469
          },
          {
            "text": "    }",
            "lineNumber": 470
          },
          {
            "text": "    return null;",
            "lineNumber": 471
          },
          {
            "text": "  }, [file, files]);",
            "lineNumber": 472
          },
          {
            "lineNumber": 473
          },
          {
            "text": "  const folderPreviewImages = useMemo(() =&gt; {",
            "lineNumber": 474
          },
          {
            "text": "    if (file &amp;&amp; file.type === FileType.FOLDER) {",
            "lineNumber": 475
          },
          {
            "text": "        // Custom logic for Tauri to use Asset Protocol",
            "lineNumber": 476
          },
          {
            "text": "        const found: string[] = [];",
            "lineNumber": 477
          },
          {
            "text": "        const queue = [...(file.children || [])];",
            "lineNumber": 478
          },
          {
            "text": "        let head = 0;",
            "lineNumber": 479
          },
          {
            "text": "        let iterations = 0;",
            "lineNumber": 480
          },
          {
            "text": "        const maxIterations = 200;",
            "lineNumber": 481
          },
          {
            "lineNumber": 482
          },
          {
            "text": "        while (head &lt; queue.length &amp;&amp; found.length &lt; 3 &amp;&amp; iterations &lt; maxIterations) {",
            "lineNumber": 483
          },
          {
            "text": "            const id = queue[head++];",
            "lineNumber": 484
          },
          {
            "text": "            iterations++;",
            "lineNumber": 485
          },
          {
            "text": "            const node = files[id];",
            "lineNumber": 486
          },
          {
            "text": "            if (!node) continue;",
            "lineNumber": 487
          },
          {
            "text": "            ",
            "lineNumber": 488
          },
          {
            "text": "            if (node.type === FileType.IMAGE &amp;&amp; node.path) {",
            "lineNumber": 489
          },
          {
            "text": "                found.push(convertFileSrc(node.path));",
            "lineNumber": 490
          },
          {
            "text": "            } else if (node.type === FileType.FOLDER &amp;&amp; node.children) {",
            "lineNumber": 491
          },
          {
            "text": "                queue.push(...node.children);",
            "lineNumber": 492
          },
          {
            "text": "            }",
            "lineNumber": 493
          },
          {
            "text": "        }",
            "lineNumber": 494
          },
          {
            "text": "        return found;",
            "lineNumber": 495
          },
          {
            "text": "    }",
            "lineNumber": 496
          },
          {
            "text": "    return [];",
            "lineNumber": 497
          },
          {
            "text": "  }, [file, files]);",
            "lineNumber": 498
          },
          {
            "lineNumber": 499
          },
          {
            "text": "  const typeColors: Record&lt;string, string&gt; = {",
            "lineNumber": 500
          },
          {
            "text": "      ",
            "lineNumber": 501
          },
          {
            "text": "  };",
            "lineNumber": 510
          },
          {
            "text": ";",
            "lineNumber": 1382
          }
        ]
      },
      "score": 0.3422338366508484
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 512
          },
          "endPosition": {
            "line": 679,
            "column": 1
          }
        },
        "contents": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {\nconst handleMouseEnter = (e: React.MouseEvent, tag: string) =&gt; {\n\n    \n    hoverTimerRef.current = setTimeout(() =&gt; {\n      const rect = target.getBoundingClientRect();\n      const PREVIEW_WIDTH = 256; \n      const PREVIEW_HEIGHT = 120;\n      \n      let left = rect.left + (rect.width / 2) - (PREVIEW_WIDTH / 2);\n      let top = rect.bottom + 10;\n\n      if (left &lt; 10) left = 10;\n      if (left + PREVIEW_WIDTH &gt; window.innerWidth) left = window.innerWidth - PREVIEW_WIDTH - 10;\n      if (top + PREVIEW_HEIGHT &gt; window.innerHeight) top = rect.top - PREVIEW_HEIGHT - 10;\n\n      setHoveredTagPos({ top, left });\n      setHoveredTag(tag);\n    }, 600);\n  }, []);\n\n  const handleMouseLeave = useCallback(() =&gt; {\n    if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);\n    setHoveredTag(null);\n    setHoveredTagPos(null);\n  }, []);\n\n  return (\n    &lt;div className=\"relative\"&gt;\n      {/* 字母索引栏 */}\n      {keys.length &gt; 0 &amp;&amp; (\n        &lt;div className=\"fixed top-1/2 transform -translate-y-1/2 z-20 bg-white/80 dark:bg-gray-950/80 backdrop-blur-sm rounded-full px-1 py-2 shadow-md border border-gray-200 dark:border-gray-800 transition-all duration-300\"\n             style={{ \n               right: 'calc(20px + var(--metadata-panel-width, 0px))',\n               transform: 'translateY(-50%) translateY(10px)' // 向下调整10px，使其居中\n             }}\n             onMouseEnter={() =&gt; {\n              // 鼠标悬停时，确保索引栏显示在最前面\n              const metadataPanel = document.querySelector('.metadata-panel-container') as HTMLElement | null;\n              if (metadataPanel) {\n                metadataPanel.style.zIndex = '10';\n              }\n            }}\n            onMouseLeave={() =&gt; {\n              // 鼠标离开时，恢复详情面板的z-index\n              const metadataPanel = document.querySelector('.metadata-panel-container');\n            }\n}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 498,
                "column": 17
              },
              "endPosition": {
                "line": 499,
                "column": 13
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {",
            "lineNumber": 513
          },
          {
            "text": "const handleMouseEnter = (e: React.MouseEvent, tag: string) =&gt; {",
            "lineNumber": 538
          },
          {
            "lineNumber": 540
          },
          {
            "text": "    ",
            "lineNumber": 541
          },
          {
            "text": "    hoverTimerRef.current = setTimeout(() =&gt; {",
            "lineNumber": 542
          },
          {
            "text": "      const rect = target.getBoundingClientRect();",
            "lineNumber": 543
          },
          {
            "text": "      const PREVIEW_WIDTH = 256; ",
            "lineNumber": 544
          },
          {
            "text": "      const PREVIEW_HEIGHT = 120;",
            "lineNumber": 545
          },
          {
            "text": "      ",
            "lineNumber": 546
          },
          {
            "text": "      let left = rect.left + (rect.width / 2) - (PREVIEW_WIDTH / 2);",
            "lineNumber": 547
          },
          {
            "text": "      let top = rect.bottom + 10;",
            "lineNumber": 548
          },
          {
            "lineNumber": 549
          },
          {
            "text": "      if (left &lt; 10) left = 10;",
            "lineNumber": 550
          },
          {
            "text": "      if (left + PREVIEW_WIDTH &gt; window.innerWidth) left = window.innerWidth - PREVIEW_WIDTH - 10;",
            "lineNumber": 551
          },
          {
            "text": "      if (top + PREVIEW_HEIGHT &gt; window.innerHeight) top = rect.top - PREVIEW_HEIGHT - 10;",
            "lineNumber": 552
          },
          {
            "lineNumber": 553
          },
          {
            "text": "      setHoveredTagPos({ top, left });",
            "lineNumber": 554
          },
          {
            "text": "      setHoveredTag(tag);",
            "lineNumber": 555
          },
          {
            "text": "    }, 600);",
            "lineNumber": 556
          },
          {
            "text": "  }, []);",
            "lineNumber": 557
          },
          {
            "lineNumber": 558
          },
          {
            "text": "  const handleMouseLeave = useCallback(() =&gt; {",
            "lineNumber": 559
          },
          {
            "text": "    if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);",
            "lineNumber": 560
          },
          {
            "text": "    setHoveredTag(null);",
            "lineNumber": 561
          },
          {
            "text": "    setHoveredTagPos(null);",
            "lineNumber": 562
          },
          {
            "text": "  }, []);",
            "lineNumber": 563
          },
          {
            "lineNumber": 564
          },
          {
            "text": "  return (",
            "lineNumber": 565
          },
          {
            "text": "    &lt;div className=\"relative\"&gt;",
            "lineNumber": 566
          },
          {
            "text": "      {/* 字母索引栏 */}",
            "lineNumber": 567
          },
          {
            "text": "      {keys.length &gt; 0 &amp;&amp; (",
            "lineNumber": 568
          },
          {
            "text": "        &lt;div className=\"fixed top-1/2 transform -translate-y-1/2 z-20 bg-white/80 dark:bg-gray-950/80 backdrop-blur-sm rounded-full px-1 py-2 shadow-md border border-gray-200 dark:border-gray-800 transition-all duration-300\"",
            "lineNumber": 569
          },
          {
            "text": "             style={{ ",
            "lineNumber": 570
          },
          {
            "text": "               right: 'calc(20px + var(--metadata-panel-width, 0px))',",
            "lineNumber": 571
          },
          {
            "text": "               transform: 'translateY(-50%) translateY(10px)' // 向下调整10px，使其居中",
            "lineNumber": 572
          },
          {
            "text": "             }}",
            "lineNumber": 573
          },
          {
            "text": "             onMouseEnter={() =&gt; {",
            "lineNumber": 574
          },
          {
            "text": "              // 鼠标悬停时，确保索引栏显示在最前面",
            "lineNumber": 575
          },
          {
            "text": "              const metadataPanel = document.querySelector('.metadata-panel-container') as HTMLElement | null;",
            "lineNumber": 576
          },
          {
            "text": "              if (metadataPanel) {",
            "lineNumber": 577
          },
          {
            "text": "                metadataPanel.style.zIndex = '10';",
            "lineNumber": 578
          },
          {
            "text": "              }",
            "lineNumber": 579
          },
          {
            "text": "            }}",
            "lineNumber": 580
          },
          {
            "text": "            onMouseLeave={() =&gt; {",
            "lineNumber": 581
          },
          {
            "text": "              // 鼠标离开时，恢复详情面板的z-index",
            "lineNumber": 582
          },
          {
            "text": "              const metadataPanel = document.querySelector('.metadata-panel-container');",
            "lineNumber": 583
          },
          {
            "text": "            }",
            "lineNumber": 587
          },
          {
            "text": "}",
            "lineNumber": 675
          },
          {
            "text": ";",
            "lineNumber": 680
          }
        ]
      },
      "score": 0.33642539381980896
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 246
          },
          "endPosition": {
            "line": 1381,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \n((color, i) =&gt; (\n                        &lt;div \n                            key={i} \n                            className=\"h-8 rounded-md cursor-pointer hover:scale-105 transition-transform shadow-sm ring-1 ring-black/10 dark:ring-white/10 relative group flex items-center justify-center overflow-hidden\"\n                            style={{ backgroundColor: color }}\n                            onClick={() =&gt; onSearch(&#96;color:${color.replace('#', '')}&#96;)}\n                            onContextMenu={(e) =&gt; {\n                                e.preventDefault();\n                                e.stopPropagation();\n                                // 计算菜单宽度（根据菜单项内容估算）\n                                const menuWidth = 180;\n                                // 对于最右边一列的色块（索引3和7），将菜单显示在鼠标左边\n                                const isRightmostColumn = i === 3 || i === 7; // 4列网格，第4列索引为3和7\n                                const x = isRightmostColumn ? e.clientX - menuWidth : e.clientX;\n                                setPaletteMenu({ visible: true, x, y: e.clientY, color });\n                            }}\n                            title={color}\n                        &gt;\n                             &lt;span className=\"text-[9px] font-mono font-bold text-white/90 opacity-0 group-hover:opacity-100 bg-black/30 px-1 py-0.5 rounded backdrop-blur-sm transition-opacity\"&gt;\n                                {color.toUpperCase()}\n                             &lt;/span&gt;\n                        &lt;/div&gt;\n                    ))}\n                &lt;/div&gt;\n            &lt;/div&gt;\n        )}\n        \n        {/* Folder Thumbnail */}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            },
            {
              "startPosition": {
                "line": 816,
                "column": 22
              },
              "endPosition": {
                "line": 816,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 816,
                "column": 45
              },
              "endPosition": {
                "line": 817,
                "column": 25
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 247
          },
          {
            "text": "((color, i) =&gt; (",
            "lineNumber": 832
          },
          {
            "text": "                        &lt;div ",
            "lineNumber": 833
          },
          {
            "text": "                            key={i} ",
            "lineNumber": 834
          },
          {
            "text": "                            className=\"h-8 rounded-md cursor-pointer hover:scale-105 transition-transform shadow-sm ring-1 ring-black/10 dark:ring-white/10 relative group flex items-center justify-center overflow-hidden\"",
            "lineNumber": 835
          },
          {
            "text": "                            style={{ backgroundColor: color }}",
            "lineNumber": 836
          },
          {
            "text": "                            onClick={() =&gt; onSearch(&#96;color:${color.replace('#', '')}&#96;)}",
            "lineNumber": 837
          },
          {
            "text": "                            onContextMenu={(e) =&gt; {",
            "lineNumber": 838
          },
          {
            "text": "                                e.preventDefault();",
            "lineNumber": 839
          },
          {
            "text": "                                e.stopPropagation();",
            "lineNumber": 840
          },
          {
            "text": "                                // 计算菜单宽度（根据菜单项内容估算）",
            "lineNumber": 841
          },
          {
            "text": "                                const menuWidth = 180;",
            "lineNumber": 842
          },
          {
            "text": "                                // 对于最右边一列的色块（索引3和7），将菜单显示在鼠标左边",
            "lineNumber": 843
          },
          {
            "text": "                                const isRightmostColumn = i === 3 || i === 7; // 4列网格，第4列索引为3和7",
            "lineNumber": 844
          },
          {
            "text": "                                const x = isRightmostColumn ? e.clientX - menuWidth : e.clientX;",
            "lineNumber": 845
          },
          {
            "text": "                                setPaletteMenu({ visible: true, x, y: e.clientY, color });",
            "lineNumber": 846
          },
          {
            "text": "                            }}",
            "lineNumber": 847
          },
          {
            "text": "                            title={color}",
            "lineNumber": 848
          },
          {
            "text": "                        &gt;",
            "lineNumber": 849
          },
          {
            "text": "                             &lt;span className=\"text-[9px] font-mono font-bold text-white/90 opacity-0 group-hover:opacity-100 bg-black/30 px-1 py-0.5 rounded backdrop-blur-sm transition-opacity\"&gt;",
            "lineNumber": 850
          },
          {
            "text": "                                {color.toUpperCase()}",
            "lineNumber": 851
          },
          {
            "text": "                             &lt;/span&gt;",
            "lineNumber": 852
          },
          {
            "text": "                        &lt;/div&gt;",
            "lineNumber": 853
          },
          {
            "text": "                    ))}",
            "lineNumber": 854
          },
          {
            "text": "                &lt;/div&gt;",
            "lineNumber": 855
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 856
          },
          {
            "text": "        )}",
            "lineNumber": 857
          },
          {
            "text": "        ",
            "lineNumber": 858
          },
          {
            "text": "        {/* Folder Thumbnail */}",
            "lineNumber": 859
          },
          {
            "text": ";",
            "lineNumber": 1382
          }
        ]
      },
      "score": 0.33617734909057617
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 107
          },
          "endPosition": {
            "line": 253,
            "column": 1
          }
        },
        "contents": "const FolderPickerModal = \nconst findMatchingFolders =  {\n    // 如果搜索框为空，返回 null，表示不需要过滤\n    if (!searchQuery.trim()) {\n      return null;\n    }\n    \n    const matchingFolders = new Set&lt;string&gt;();\n    const query = searchQuery.toLowerCase();\n    \n    // 递归遍历文件夹树，查找匹配的文件夹\n    const traverse = (nodeId: string) =&gt; {\n      const node = files[nodeId];\n      if (!node || node.type !== FileType.FOLDER) return;\n      \n      // 检查当前文件夹是否匹配搜索条件\n      const matches = node.name.toLowerCase().includes(query);\n      \n      // 获取子文件夹\n      const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];\n      \n      // 检查是否有子文件夹匹配\n      let hasMatchingChild = false;\n      for (const childId of folderChildren) {\n        traverse(childId);\n        if (matchingFolders.has(childId)) {\n          hasMatchingChild = true;\n        }\n      }\n      \n      // 如果当前文件夹匹配或有匹配的子文件夹，添加到结果中\n      if (matches || hasMatchingChild) {\n        matchingFolders.add(nodeId);\n      }\n    };\n    \n    // 从所有根目录开始遍历\n    roots.forEach((rootId: string) =&gt; traverse(rootId));\n    \n    return matchingFolders;\n  };\n  \n  // 递归渲染文件夹树，支持搜索过滤\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 108,
                "column": 1
              },
              "endPosition": {
                "line": 108,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 108,
                "column": 7
              },
              "endPosition": {
                "line": 108,
                "column": 27
              }
            },
            {
              "startPosition": {
                "line": 127,
                "column": 3
              },
              "endPosition": {
                "line": 127,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 127,
                "column": 9
              },
              "endPosition": {
                "line": 127,
                "column": 31
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ",
            "lineNumber": 108
          },
          {
            "text": "const findMatchingFolders =  {",
            "lineNumber": 127
          },
          {
            "text": "    // 如果搜索框为空，返回 null，表示不需要过滤",
            "lineNumber": 128
          },
          {
            "text": "    if (!searchQuery.trim()) {",
            "lineNumber": 129
          },
          {
            "text": "      return null;",
            "lineNumber": 130
          },
          {
            "text": "    }",
            "lineNumber": 131
          },
          {
            "text": "    ",
            "lineNumber": 132
          },
          {
            "text": "    const matchingFolders = new Set&lt;string&gt;();",
            "lineNumber": 133
          },
          {
            "text": "    const query = searchQuery.toLowerCase();",
            "lineNumber": 134
          },
          {
            "text": "    ",
            "lineNumber": 135
          },
          {
            "text": "    // 递归遍历文件夹树，查找匹配的文件夹",
            "lineNumber": 136
          },
          {
            "text": "    const traverse = (nodeId: string) =&gt; {",
            "lineNumber": 137
          },
          {
            "text": "      const node = files[nodeId];",
            "lineNumber": 138
          },
          {
            "text": "      if (!node || node.type !== FileType.FOLDER) return;",
            "lineNumber": 139
          },
          {
            "text": "      ",
            "lineNumber": 140
          },
          {
            "text": "      // 检查当前文件夹是否匹配搜索条件",
            "lineNumber": 141
          },
          {
            "text": "      const matches = node.name.toLowerCase().includes(query);",
            "lineNumber": 142
          },
          {
            "text": "      ",
            "lineNumber": 143
          },
          {
            "text": "      // 获取子文件夹",
            "lineNumber": 144
          },
          {
            "text": "      const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];",
            "lineNumber": 145
          },
          {
            "text": "      ",
            "lineNumber": 146
          },
          {
            "text": "      // 检查是否有子文件夹匹配",
            "lineNumber": 147
          },
          {
            "text": "      let hasMatchingChild = false;",
            "lineNumber": 148
          },
          {
            "text": "      for (const childId of folderChildren) {",
            "lineNumber": 149
          },
          {
            "text": "        traverse(childId);",
            "lineNumber": 150
          },
          {
            "text": "        if (matchingFolders.has(childId)) {",
            "lineNumber": 151
          },
          {
            "text": "          hasMatchingChild = true;",
            "lineNumber": 152
          },
          {
            "text": "        }",
            "lineNumber": 153
          },
          {
            "text": "      }",
            "lineNumber": 154
          },
          {
            "text": "      ",
            "lineNumber": 155
          },
          {
            "text": "      // 如果当前文件夹匹配或有匹配的子文件夹，添加到结果中",
            "lineNumber": 156
          },
          {
            "text": "      if (matches || hasMatchingChild) {",
            "lineNumber": 157
          },
          {
            "text": "        matchingFolders.add(nodeId);",
            "lineNumber": 158
          },
          {
            "text": "      }",
            "lineNumber": 159
          },
          {
            "text": "    };",
            "lineNumber": 160
          },
          {
            "text": "    ",
            "lineNumber": 161
          },
          {
            "text": "    // 从所有根目录开始遍历",
            "lineNumber": 162
          },
          {
            "text": "    roots.forEach((rootId: string) =&gt; traverse(rootId));",
            "lineNumber": 163
          },
          {
            "text": "    ",
            "lineNumber": 164
          },
          {
            "text": "    return matchingFolders;",
            "lineNumber": 165
          },
          {
            "text": "  };",
            "lineNumber": 166
          },
          {
            "text": "  ",
            "lineNumber": 167
          },
          {
            "text": "  // 递归渲染文件夹树，支持搜索过滤",
            "lineNumber": 168
          },
          {
            "text": ";",
            "lineNumber": 254
          }
        ]
      },
      "score": 0.3361501693725586
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 246
          },
          "endPosition": {
            "line": 1381,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \n&lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/&gt;\n                    )}\n                    &lt;div&gt;\n                        &lt;div className=\"text-xs text-gray-500 dark:text-gray-500 mb-0.5 flex items-center\"&gt;&lt;Calendar size={10} className=\"mr-1\"/&gt; {t('meta.created')}&lt;/div&gt;\n                        &lt;div className=\"text-xs text-gray-800 dark:text-gray-200 font-mono\"&gt;{file.createdAt ? new Date(file.createdAt).toLocaleDateString() : '-'}&lt;/div&gt;\n                    &lt;/div&gt;\n                    &lt;div&gt;\n                        &lt;div className=\"text-xs text-gray-500 dark:text-gray-500 mb-0.5 flex items-center\"&gt;&lt;Clock size={10} className=\"mr-1\"/&gt; {t('meta.updated')}&lt;/div&gt;\n                        &lt;div className=\"text-xs text-gray-800 dark:text-gray-200 font-mono\"&gt;{file.updatedAt ? new Date(file.updatedAt).toLocaleString() : '-'}&lt;/div&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n        )}\n\n        {/* Folder Category Selector */}\n        {((file &amp;&amp; file.type === FileType.FOLDER) || (isMulti &amp;&amp; selectedFileIds.every(id =&gt; files[id]?.type === FileType.FOLDER))) &amp;&amp; (\n            &lt;CategorySelector \n                current={file ? file.category : (selectedFileIds.every(id =&gt; files[id]?.category === 'book') ? 'book' : 'general')}\n                onChange={handleCategoryChange}\n                t={t}\n            /&gt;\n        )}\n\n        {/* Tags Section */}\n        {!isMulti &amp;&amp; file &amp;&amp; file.type !== FileType.FOLDER &amp;&amp; (\n            &lt;div&gt;\n                &lt;div className=\"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 flex items-center\"&gt;\n                    &lt;Tag size={12} className=\"mr-1.5\"/&gt; {t('meta.tags')}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 247
          },
          {
            "text": "&lt;/div&gt;",
            "lineNumber": 1163
          },
          {
            "text": "                            &lt;/div&gt;",
            "lineNumber": 1164
          },
          {
            "text": "                        &lt;/&gt;",
            "lineNumber": 1165
          },
          {
            "text": "                    )}",
            "lineNumber": 1166
          },
          {
            "text": "                    &lt;div&gt;",
            "lineNumber": 1167
          },
          {
            "text": "                        &lt;div className=\"text-xs text-gray-500 dark:text-gray-500 mb-0.5 flex items-center\"&gt;&lt;Calendar size={10} className=\"mr-1\"/&gt; {t('meta.created')}&lt;/div&gt;",
            "lineNumber": 1168
          },
          {
            "text": "                        &lt;div className=\"text-xs text-gray-800 dark:text-gray-200 font-mono\"&gt;{file.createdAt ? new Date(file.createdAt).toLocaleDateString() : '-'}&lt;/div&gt;",
            "lineNumber": 1169
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 1170
          },
          {
            "text": "                    &lt;div&gt;",
            "lineNumber": 1171
          },
          {
            "text": "                        &lt;div className=\"text-xs text-gray-500 dark:text-gray-500 mb-0.5 flex items-center\"&gt;&lt;Clock size={10} className=\"mr-1\"/&gt; {t('meta.updated')}&lt;/div&gt;",
            "lineNumber": 1172
          },
          {
            "text": "                        &lt;div className=\"text-xs text-gray-800 dark:text-gray-200 font-mono\"&gt;{file.updatedAt ? new Date(file.updatedAt).toLocaleString() : '-'}&lt;/div&gt;",
            "lineNumber": 1173
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 1174
          },
          {
            "text": "                &lt;/div&gt;",
            "lineNumber": 1175
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 1176
          },
          {
            "text": "        )}",
            "lineNumber": 1177
          },
          {
            "lineNumber": 1178
          },
          {
            "text": "        {/* Folder Category Selector */}",
            "lineNumber": 1179
          },
          {
            "text": "        {((file &amp;&amp; file.type === FileType.FOLDER) || (isMulti &amp;&amp; selectedFileIds.every(id =&gt; files[id]?.type === FileType.FOLDER))) &amp;&amp; (",
            "lineNumber": 1180
          },
          {
            "text": "            &lt;CategorySelector ",
            "lineNumber": 1181
          },
          {
            "text": "                current={file ? file.category : (selectedFileIds.every(id =&gt; files[id]?.category === 'book') ? 'book' : 'general')}",
            "lineNumber": 1182
          },
          {
            "text": "                onChange={handleCategoryChange}",
            "lineNumber": 1183
          },
          {
            "text": "                t={t}",
            "lineNumber": 1184
          },
          {
            "text": "            /&gt;",
            "lineNumber": 1185
          },
          {
            "text": "        )}",
            "lineNumber": 1186
          },
          {
            "lineNumber": 1187
          },
          {
            "text": "        {/* Tags Section */}",
            "lineNumber": 1188
          },
          {
            "text": "        {!isMulti &amp;&amp; file &amp;&amp; file.type !== FileType.FOLDER &amp;&amp; (",
            "lineNumber": 1189
          },
          {
            "text": "            &lt;div&gt;",
            "lineNumber": 1190
          },
          {
            "text": "                &lt;div className=\"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 flex items-center\"&gt;",
            "lineNumber": 1191
          },
          {
            "text": "                    &lt;Tag size={12} className=\"mr-1.5\"/&gt; {t('meta.tags')}",
            "lineNumber": 1192
          },
          {
            "text": ";",
            "lineNumber": 1382
          }
        ]
      },
      "score": 0.3313111960887909
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 246
          },
          "endPosition": {
            "line": 1381,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \n\"&gt;\n                                    &lt;button \n                                        onClick={() =&gt; onUpdate(file.id, { aiData: undefined })} \n                                        className=\"flex items-center px-3 py-1.5 bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-400 text-white rounded-md font-medium transition-colors text-sm\"\n                                        title={t('meta.clearAiData')}\n                                    &gt;\n                                        &lt;X size={12} className=\"mr-1.5\"/&gt; {t('meta.clear')}\n                                    &lt;/button&gt;\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        )\n                    )}\n                &lt;/div&gt;\n            )\n        )}\n\n        {/* Open Folder Button */}\n        {!isMulti &amp;&amp; file &amp;&amp; (\n            &lt;button\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 247
          },
          {
            "text": "\"&gt;",
            "lineNumber": 1100
          },
          {
            "text": "                                    &lt;button ",
            "lineNumber": 1101
          },
          {
            "text": "                                        onClick={() =&gt; onUpdate(file.id, { aiData: undefined })} ",
            "lineNumber": 1102
          },
          {
            "text": "                                        className=\"flex items-center px-3 py-1.5 bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-400 text-white rounded-md font-medium transition-colors text-sm\"",
            "lineNumber": 1103
          },
          {
            "text": "                                        title={t('meta.clearAiData')}",
            "lineNumber": 1104
          },
          {
            "text": "                                    &gt;",
            "lineNumber": 1105
          },
          {
            "text": "                                        &lt;X size={12} className=\"mr-1.5\"/&gt; {t('meta.clear')}",
            "lineNumber": 1106
          },
          {
            "text": "                                    &lt;/button&gt;",
            "lineNumber": 1107
          },
          {
            "text": "                                &lt;/div&gt;",
            "lineNumber": 1108
          },
          {
            "text": "                            &lt;/div&gt;",
            "lineNumber": 1109
          },
          {
            "text": "                        )",
            "lineNumber": 1110
          },
          {
            "text": "                    )}",
            "lineNumber": 1111
          },
          {
            "text": "                &lt;/div&gt;",
            "lineNumber": 1112
          },
          {
            "text": "            )",
            "lineNumber": 1113
          },
          {
            "text": "        )}",
            "lineNumber": 1114
          },
          {
            "lineNumber": 1115
          },
          {
            "text": "        {/* Open Folder Button */}",
            "lineNumber": 1116
          },
          {
            "text": "        {!isMulti &amp;&amp; file &amp;&amp; (",
            "lineNumber": 1117
          },
          {
            "text": "            &lt;button",
            "lineNumber": 1118
          },
          {
            "text": ";",
            "lineNumber": 1382
          }
        ]
      },
      "score": 0.3300071060657501
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleChangePath = async \n\n\n          if (!saveResult) {\n              console.error('[HANDLE_CHANGE_PATH] saveUserData returned false!');\n          }\n          \n          showToast(t('settings.success'));\n      } catch (e) {\n          console.error(\"Change path failed\", e);\n          showToast(\"Error changing path\");\n      }\n  };\n  \n  // Navigation helpers\n  const pushHistory = (folderId: string, viewingId: string | null, viewMode: 'browser' | 'tags-overview' | 'people-overview' = 'browser', searchQuery: string = '', searchScope: SearchScope = 'all', activeTags: string[] = [], activePersonId: string | null = null, nextScrollTop: number = 0, aiFilter: AiSearchFilter | null | undefined = null) =&gt; { \n      const currentScrollTop = selectionRef.current?.scrollTop ?? activeTab.scrollTop;\n      updateActiveTab(prevTab =&gt; { \n          const stackCopy = [...prevTab.history.stack];\n          if (prevTab.history.currentIndex &gt;= 0 &amp;&amp; prevTab.history.currentIndex &lt; stackCopy.length) {\n              stackCopy[prevTab.history.currentIndex] = { ...stackCopy[prevTab.history.currentIndex], scrollTop: currentScrollTop };\n          }\n          const newStack = [...stackCopy.slice(0, prevTab.history.currentIndex + 1), { folderId, viewingId, viewMode, searchQuery, searchScope, activeTags, activePersonId, aiFilter, scrollTop: nextScrollTop }]; \n          return { folderId, viewingFileId: viewingId, viewMode, searchQuery, searchScope, activeTags, activePersonId, aiFilter, scrollTop: nextScrollTop, selectedFileIds: viewingId ? [viewingId] : [], selectedPersonIds: [], selectedTagIds: [], history: { stack: newStack, currentIndex: newStack.length - 1 } }; \n      }); \n  };\n\n\n  \n  const handleRememberFolderSettings = () =&gt;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 2728,
                "column": 3
              },
              "endPosition": {
                "line": 2728,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 2728,
                "column": 9
              },
              "endPosition": {
                "line": 2728,
                "column": 34
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleChangePath = async ",
            "lineNumber": 2727
          },
          {
            "lineNumber": 2806
          },
          {
            "lineNumber": 2807
          },
          {
            "text": "          if (!saveResult) {",
            "lineNumber": 2808
          },
          {
            "text": "              console.error('[HANDLE_CHANGE_PATH] saveUserData returned false!');",
            "lineNumber": 2809
          },
          {
            "text": "          }",
            "lineNumber": 2810
          },
          {
            "text": "          ",
            "lineNumber": 2811
          },
          {
            "text": "          showToast(t('settings.success'));",
            "lineNumber": 2812
          },
          {
            "text": "      } catch (e) {",
            "lineNumber": 2813
          },
          {
            "text": "          console.error(\"Change path failed\", e);",
            "lineNumber": 2814
          },
          {
            "text": "          showToast(\"Error changing path\");",
            "lineNumber": 2815
          },
          {
            "text": "      }",
            "lineNumber": 2816
          },
          {
            "text": "  };",
            "lineNumber": 2817
          },
          {
            "text": "  ",
            "lineNumber": 2818
          },
          {
            "text": "  // Navigation helpers",
            "lineNumber": 2819
          },
          {
            "text": "  const pushHistory = (folderId: string, viewingId: string | null, viewMode: 'browser' | 'tags-overview' | 'people-overview' = 'browser', searchQuery: string = '', searchScope: SearchScope = 'all', activeTags: string[] = [], activePersonId: string | null = null, nextScrollTop: number = 0, aiFilter: AiSearchFilter | null | undefined = null) =&gt; { ",
            "lineNumber": 2820
          },
          {
            "text": "      const currentScrollTop = selectionRef.current?.scrollTop ?? activeTab.scrollTop;",
            "lineNumber": 2821
          },
          {
            "text": "      updateActiveTab(prevTab =&gt; { ",
            "lineNumber": 2822
          },
          {
            "text": "          const stackCopy = [...prevTab.history.stack];",
            "lineNumber": 2823
          },
          {
            "text": "          if (prevTab.history.currentIndex &gt;= 0 &amp;&amp; prevTab.history.currentIndex &lt; stackCopy.length) {",
            "lineNumber": 2824
          },
          {
            "text": "              stackCopy[prevTab.history.currentIndex] = { ...stackCopy[prevTab.history.currentIndex], scrollTop: currentScrollTop };",
            "lineNumber": 2825
          },
          {
            "text": "          }",
            "lineNumber": 2826
          },
          {
            "text": "          const newStack = [...stackCopy.slice(0, prevTab.history.currentIndex + 1), { folderId, viewingId, viewMode, searchQuery, searchScope, activeTags, activePersonId, aiFilter, scrollTop: nextScrollTop }]; ",
            "lineNumber": 2827
          },
          {
            "text": "          return { folderId, viewingFileId: viewingId, viewMode, searchQuery, searchScope, activeTags, activePersonId, aiFilter, scrollTop: nextScrollTop, selectedFileIds: viewingId ? [viewingId] : [], selectedPersonIds: [], selectedTagIds: [], history: { stack: newStack, currentIndex: newStack.length - 1 } }; ",
            "lineNumber": 2828
          },
          {
            "text": "      }); ",
            "lineNumber": 2829
          },
          {
            "text": "  };",
            "lineNumber": 2830
          },
          {
            "lineNumber": 2831
          },
          {
            "lineNumber": 2832
          },
          {
            "text": "  ",
            "lineNumber": 2833
          },
          {
            "text": "  const handleRememberFolderSettings = () =&gt;",
            "lineNumber": 2834
          },
          {
            "text": ";",
            "lineNumber": 2862
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.32780516147613525
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\nconst fetchDimensions = async \n\n                  }\n              }\n          }\n      };\n      fetchDimensions();\n  }, [activeTab.selectedFileIds, activeTab.viewingFileId]);\n\n  useEffect(() =&gt; {\n    const currentFolderId = activeTab.folderId;\n    if (!currentFolderId) return;\n    setState(prev =&gt; {\n        const files = prev.files;\n        if (!files[currentFolderId]) return prev;\n        const ancestorsToExpand = new Set&lt;string&gt;();\n        let curr = files[currentFolderId];\n        while (curr &amp;&amp; curr.parentId) { ancestorsToExpand.add(curr.parentId); curr = files[curr.parentId]; }\n        if (ancestorsToExpand.size === 0) return prev;\n        const existingExpanded = new Set(prev.expandedFolderIds);\n        let changed = false;\n        ancestorsToExpand.forEach(id =&gt; { if (!existingExpanded.has(id)) { existingExpanded.add(id); changed = true; } });\n        if (!changed) return prev;\n        return { ...prev, expandedFolderIds: Array.from(existingExpanded) };\n    });\n  }, [activeTab.folderId]);\n\n  useEffect(() =&gt; {\n    const root = window.document.documentElement;\n    const applyTheme = () =&gt; {\n      const theme = state.settings.theme;\n      let isDark = false;\n      if (theme === 'dark') isDark = true;\n      else if (theme === 'light') isDark = false;\n      else { \n          if (window.matchMedia('(prefers-color-scheme: dark)').matches) isDark = true; \n          else isDark = false; \n      }\n      if (isDark) root.classList.add('dark');\n      else root.classList.remove('dark');\n      if (window.electron &amp;&amp; window.electron.setTheme) {\n          window.electron.setTheme(isDark ? 'dark' : 'light');\n      }\n    };\n    applyTheme();\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    const handleChange = () =&gt; { if (state.settings.theme === 'system') applyTheme(); };\n    mediaQuery.addEventListener('change', handleChange);\n    return () =&gt; mediaQuery.removeEventListener('change', handleChange);\n  }, [state.settings.theme]);\n\n  useEffect(() =&gt; { setToolbarQuery(activeTab.searchQuery); }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 1200
          },
          {
            "text": "const fetchDimensions = async ",
            "lineNumber": 1201
          },
          {
            "lineNumber": 1215
          },
          {
            "text": "                  }",
            "lineNumber": 1216
          },
          {
            "text": "              }",
            "lineNumber": 1217
          },
          {
            "text": "          }",
            "lineNumber": 1218
          },
          {
            "text": "      };",
            "lineNumber": 1219
          },
          {
            "text": "      fetchDimensions();",
            "lineNumber": 1220
          },
          {
            "text": "  }, [activeTab.selectedFileIds, activeTab.viewingFileId]);",
            "lineNumber": 1221
          },
          {
            "lineNumber": 1222
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 1223
          },
          {
            "text": "    const currentFolderId = activeTab.folderId;",
            "lineNumber": 1224
          },
          {
            "text": "    if (!currentFolderId) return;",
            "lineNumber": 1225
          },
          {
            "text": "    setState(prev =&gt; {",
            "lineNumber": 1226
          },
          {
            "text": "        const files = prev.files;",
            "lineNumber": 1227
          },
          {
            "text": "        if (!files[currentFolderId]) return prev;",
            "lineNumber": 1228
          },
          {
            "text": "        const ancestorsToExpand = new Set&lt;string&gt;();",
            "lineNumber": 1229
          },
          {
            "text": "        let curr = files[currentFolderId];",
            "lineNumber": 1230
          },
          {
            "text": "        while (curr &amp;&amp; curr.parentId) { ancestorsToExpand.add(curr.parentId); curr = files[curr.parentId]; }",
            "lineNumber": 1231
          },
          {
            "text": "        if (ancestorsToExpand.size === 0) return prev;",
            "lineNumber": 1232
          },
          {
            "text": "        const existingExpanded = new Set(prev.expandedFolderIds);",
            "lineNumber": 1233
          },
          {
            "text": "        let changed = false;",
            "lineNumber": 1234
          },
          {
            "text": "        ancestorsToExpand.forEach(id =&gt; { if (!existingExpanded.has(id)) { existingExpanded.add(id); changed = true; } });",
            "lineNumber": 1235
          },
          {
            "text": "        if (!changed) return prev;",
            "lineNumber": 1236
          },
          {
            "text": "        return { ...prev, expandedFolderIds: Array.from(existingExpanded) };",
            "lineNumber": 1237
          },
          {
            "text": "    });",
            "lineNumber": 1238
          },
          {
            "text": "  }, [activeTab.folderId]);",
            "lineNumber": 1239
          },
          {
            "lineNumber": 1240
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 1241
          },
          {
            "text": "    const root = window.document.documentElement;",
            "lineNumber": 1242
          },
          {
            "text": "    const applyTheme = () =&gt; {",
            "lineNumber": 1243
          },
          {
            "text": "      const theme = state.settings.theme;",
            "lineNumber": 1244
          },
          {
            "text": "      let isDark = false;",
            "lineNumber": 1245
          },
          {
            "text": "      if (theme === 'dark') isDark = true;",
            "lineNumber": 1246
          },
          {
            "text": "      else if (theme === 'light') isDark = false;",
            "lineNumber": 1247
          },
          {
            "text": "      else { ",
            "lineNumber": 1248
          },
          {
            "text": "          if (window.matchMedia('(prefers-color-scheme: dark)').matches) isDark = true; ",
            "lineNumber": 1249
          },
          {
            "text": "          else isDark = false; ",
            "lineNumber": 1250
          },
          {
            "text": "      }",
            "lineNumber": 1251
          },
          {
            "text": "      if (isDark) root.classList.add('dark');",
            "lineNumber": 1252
          },
          {
            "text": "      else root.classList.remove('dark');",
            "lineNumber": 1253
          },
          {
            "text": "      if (window.electron &amp;&amp; window.electron.setTheme) {",
            "lineNumber": 1254
          },
          {
            "text": "          window.electron.setTheme(isDark ? 'dark' : 'light');",
            "lineNumber": 1255
          },
          {
            "text": "      }",
            "lineNumber": 1256
          },
          {
            "text": "    };",
            "lineNumber": 1257
          },
          {
            "text": "    applyTheme();",
            "lineNumber": 1258
          },
          {
            "text": "    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');",
            "lineNumber": 1259
          },
          {
            "text": "    const handleChange = () =&gt; { if (state.settings.theme === 'system') applyTheme(); };",
            "lineNumber": 1260
          },
          {
            "text": "    mediaQuery.addEventListener('change', handleChange);",
            "lineNumber": 1261
          },
          {
            "text": "    return () =&gt; mediaQuery.removeEventListener('change', handleChange);",
            "lineNumber": 1262
          },
          {
            "text": "  }, [state.settings.theme]);",
            "lineNumber": 1263
          },
          {
            "lineNumber": 1264
          },
          {
            "text": "  useEffect(() =&gt; { setToolbarQuery(activeTab.searchQuery); }",
            "lineNumber": 1265
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.3271704316139221
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\n\n                              t={t}\n                          /&gt;\n                      );\n                  }\n\n                  return (\n                      &lt;ImageViewer\n                          file={state.files[activeTab.viewingFileId]}\n                          sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)} \n                          files={state.files}\n                          layout={state.layout}\n                          slideshowConfig={state.slideshowConfig}\n                          onLayoutToggle={(part) =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, [part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible']: !s.layout[part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible'] } }))}\n                          onClose={closeViewer}\n                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}\n                          onPrev={() =&gt; handleViewerNavigate('prev')}\n                          onNavigateBack={goBack}\n                          onNavigateForward={goForward}\n                          canGoBack={activeTab.history.currentIndex &gt; 0}\n                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}\n                          onDelete={(id) =&gt; requestDelete([id])}\n                          onViewInExplorer={handleViewInExplorer}\n                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}\n                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}\n                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}\n                          searchQuery={activeTab.searchQuery}\n                          onSearch={handleViewerSearch}\n                          searchScope={activeTab.searchScope}\n                          onSearchScopeChange=\n              }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4453
          },
          {
            "lineNumber": 4468
          },
          {
            "text": "                              t={t}",
            "lineNumber": 4469
          },
          {
            "text": "                          /&gt;",
            "lineNumber": 4470
          },
          {
            "text": "                      );",
            "lineNumber": 4471
          },
          {
            "text": "                  }",
            "lineNumber": 4472
          },
          {
            "lineNumber": 4473
          },
          {
            "text": "                  return (",
            "lineNumber": 4474
          },
          {
            "text": "                      &lt;ImageViewer",
            "lineNumber": 4475
          },
          {
            "text": "                          file={state.files[activeTab.viewingFileId]}",
            "lineNumber": 4476
          },
          {
            "text": "                          sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)} ",
            "lineNumber": 4477
          },
          {
            "text": "                          files={state.files}",
            "lineNumber": 4478
          },
          {
            "text": "                          layout={state.layout}",
            "lineNumber": 4479
          },
          {
            "text": "                          slideshowConfig={state.slideshowConfig}",
            "lineNumber": 4480
          },
          {
            "text": "                          onLayoutToggle={(part) =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, [part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible']: !s.layout[part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible'] } }))}",
            "lineNumber": 4481
          },
          {
            "text": "                          onClose={closeViewer}",
            "lineNumber": 4482
          },
          {
            "text": "                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}",
            "lineNumber": 4483
          },
          {
            "text": "                          onPrev={() =&gt; handleViewerNavigate('prev')}",
            "lineNumber": 4484
          },
          {
            "text": "                          onNavigateBack={goBack}",
            "lineNumber": 4485
          },
          {
            "text": "                          onNavigateForward={goForward}",
            "lineNumber": 4486
          },
          {
            "text": "                          canGoBack={activeTab.history.currentIndex &gt; 0}",
            "lineNumber": 4487
          },
          {
            "text": "                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}",
            "lineNumber": 4488
          },
          {
            "text": "                          onDelete={(id) =&gt; requestDelete([id])}",
            "lineNumber": 4489
          },
          {
            "text": "                          onViewInExplorer={handleViewInExplorer}",
            "lineNumber": 4490
          },
          {
            "text": "                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4491
          },
          {
            "text": "                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4492
          },
          {
            "text": "                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}",
            "lineNumber": 4493
          },
          {
            "text": "                          searchQuery={activeTab.searchQuery}",
            "lineNumber": 4494
          },
          {
            "text": "                          onSearch={handleViewerSearch}",
            "lineNumber": 4495
          },
          {
            "text": "                          searchScope={activeTab.searchScope}",
            "lineNumber": 4496
          },
          {
            "text": "                          onSearchScopeChange=",
            "lineNumber": 4497
          },
          {
            "text": "              }",
            "lineNumber": 4509
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.31438934803009033
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\SequenceViewer.tsx",
        "range": {
          "startPosition": {
            "line": 22
          },
          "endPosition": {
            "line": 617,
            "column": 1
          }
        },
        "contents": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = \n\n              &gt;\n                &lt;Sidebar size={20} /&gt;\n              &lt;/button&gt;\n              &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;\n              &lt;Film className=\"text-purple-500\" size={20} /&gt;\n              &lt;span className=\"font-bold text-lg truncate\"&gt;{folder.name}&lt;/span&gt;\n              &lt;span className=\"text-sm text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full whitespace-nowrap border border-gray-200 dark:border-gray-700\"&gt;\n                 {currentFile?.name}\n              &lt;/span&gt;\n           &lt;/div&gt;\n           \n           &lt;div className=\"flex items-center space-x-2\"&gt;\n              {/* Zoom Controls */}\n              &lt;div className=\"flex items-center space-x-2 mr-4 w-32 hidden lg:flex\"&gt;\n                &lt;Minimize size={14} className=\"text-gray-500\" /&gt;\n                &lt;input \n                  type=\"range\" \n                  min=\"0.1\" \n                  max=\"8\" \n                  step=\"0.1\" \n                  value={scale}\n                  onChange={(e) =&gt; setScale(parseFloat(e.target.value))}\n                  className=\"flex-1 h-1 bg-gray-300 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer\"\n                /&gt;\n                &lt;Maximize size={14} className=\"text-gray-500\" /&gt;\n              &lt;/div&gt;\n\n              &lt;button onClick={handleOriginal} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('sequence.original')}&gt;\n                 &lt;span className=\"text-xs font-bold\"&gt;1:1&lt;/span&gt;\n              &lt;/button&gt;\n              &lt;button onClick={handleReset}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 22,
                "column": 1
              },
              "endPosition": {
                "line": 22,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 8
              },
              "endPosition": {
                "line": 22,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 14
              },
              "endPosition": {
                "line": 22,
                "column": 62
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = ",
            "lineNumber": 23
          },
          {
            "lineNumber": 289
          },
          {
            "text": "              &gt;",
            "lineNumber": 290
          },
          {
            "text": "                &lt;Sidebar size={20} /&gt;",
            "lineNumber": 291
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 292
          },
          {
            "text": "              &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;",
            "lineNumber": 293
          },
          {
            "text": "              &lt;Film className=\"text-purple-500\" size={20} /&gt;",
            "lineNumber": 294
          },
          {
            "text": "              &lt;span className=\"font-bold text-lg truncate\"&gt;{folder.name}&lt;/span&gt;",
            "lineNumber": 295
          },
          {
            "text": "              &lt;span className=\"text-sm text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full whitespace-nowrap border border-gray-200 dark:border-gray-700\"&gt;",
            "lineNumber": 296
          },
          {
            "text": "                 {currentFile?.name}",
            "lineNumber": 297
          },
          {
            "text": "              &lt;/span&gt;",
            "lineNumber": 298
          },
          {
            "text": "           &lt;/div&gt;",
            "lineNumber": 299
          },
          {
            "text": "           ",
            "lineNumber": 300
          },
          {
            "text": "           &lt;div className=\"flex items-center space-x-2\"&gt;",
            "lineNumber": 301
          },
          {
            "text": "              {/* Zoom Controls */}",
            "lineNumber": 302
          },
          {
            "text": "              &lt;div className=\"flex items-center space-x-2 mr-4 w-32 hidden lg:flex\"&gt;",
            "lineNumber": 303
          },
          {
            "text": "                &lt;Minimize size={14} className=\"text-gray-500\" /&gt;",
            "lineNumber": 304
          },
          {
            "text": "                &lt;input ",
            "lineNumber": 305
          },
          {
            "text": "                  type=\"range\" ",
            "lineNumber": 306
          },
          {
            "text": "                  min=\"0.1\" ",
            "lineNumber": 307
          },
          {
            "text": "                  max=\"8\" ",
            "lineNumber": 308
          },
          {
            "text": "                  step=\"0.1\" ",
            "lineNumber": 309
          },
          {
            "text": "                  value={scale}",
            "lineNumber": 310
          },
          {
            "text": "                  onChange={(e) =&gt; setScale(parseFloat(e.target.value))}",
            "lineNumber": 311
          },
          {
            "text": "                  className=\"flex-1 h-1 bg-gray-300 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer\"",
            "lineNumber": 312
          },
          {
            "text": "                /&gt;",
            "lineNumber": 313
          },
          {
            "text": "                &lt;Maximize size={14} className=\"text-gray-500\" /&gt;",
            "lineNumber": 314
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 315
          },
          {
            "lineNumber": 316
          },
          {
            "text": "              &lt;button onClick={handleOriginal} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('sequence.original')}&gt;",
            "lineNumber": 317
          },
          {
            "text": "                 &lt;span className=\"text-xs font-bold\"&gt;1:1&lt;/span&gt;",
            "lineNumber": 318
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 319
          },
          {
            "text": "              &lt;button onClick={handleReset}",
            "lineNumber": 320
          },
          {
            "text": ";",
            "lineNumber": 618
          }
        ]
      },
      "score": 0.3130679130554199
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleCreateFolder = async \nprev =&gt; (\n\n              files: { ...prev.files, [newId]: newFolder },\n              roots: [...prev.roots, newId],\n              renamingId: newId\n          }));\n          return;\n      }\n      \n      const parent = state.files[parentId];\n      if (!parent) return;\n      const baseName = t('context.newFolder');\n      let name = baseName;\n      if (parent.path) {\n          try {\n              let counter = 1;\n              const children = parent.children?.map(id =&gt; state.files[id]) || [];\n              while (children.some(c =&gt; c.name === name)) { name = &#96;${baseName} (${counter++})&#96;; }\n              const separator = parent.path.includes('/') ? '/' : '\\\\';\n              const newPath = &#96;${parent.path}${separator}${name}&#96;;\n              \n              // Use appropriate createFolder function based on environment\n              const isTauriEnv = isTauriEnvironment();\n              if (isTauriEnv) {\n                  await createFolder(newPath);\n              } else if (window.electron) {\n                  await window.electron.createFolder(newPath);\n              } else {\n                  throw new Error(\"No file system access available\");\n              }\n              \n              await handleRefresh();\n              \n              // Find the newly created folder and set it to renaming state\n              setState(prev =&gt; {\n                  const parentFolder = prev.files[parentId];\n                  if (parentFolder?.children) {\n                      // Get all children files\n                      const childFiles = parentFolder.children.map(id =&gt; prev.files[id]);\n                      // Find the folder with the matching name we just created\n                      const newFolder = childFiles.find(file =&gt; file?.name === name &amp;&amp; file?.type === FileType.FOLDER);\n                      if (newFolder) {\n                          return { ...prev, renamingId: newFolder.id };\n                      }\n                  }\n                  return prev;\n              });\n          } catch (error) { console.error(error); showToast(\"Error creating folder\"); }\n      } else {\n          let counter = 1;\n          const children = parent.children?.map(id =&gt; state.files[id]) || [];\n          while (children.some(c =&gt; c.name === name)) { name = &#96;${baseName} (${counter++})&#96;; }\n          const newId = Math.random().toString(36).substr(2, 9);\n          const newFolder: FileNode = {\n              id: newId,\n              parentId: parentId,\n              name,\n              type: FileType.FOLDER,\n              path: '',\n              children: [],\n              tags: [],\n          };\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleCreateFolder = async ",
            "lineNumber": 3286
          },
          {
            "text": "prev =&gt; (",
            "lineNumber": 3315
          },
          {
            "lineNumber": 3316
          },
          {
            "text": "              files: { ...prev.files, [newId]: newFolder },",
            "lineNumber": 3317
          },
          {
            "text": "              roots: [...prev.roots, newId],",
            "lineNumber": 3318
          },
          {
            "text": "              renamingId: newId",
            "lineNumber": 3319
          },
          {
            "text": "          }));",
            "lineNumber": 3320
          },
          {
            "text": "          return;",
            "lineNumber": 3321
          },
          {
            "text": "      }",
            "lineNumber": 3322
          },
          {
            "text": "      ",
            "lineNumber": 3323
          },
          {
            "text": "      const parent = state.files[parentId];",
            "lineNumber": 3324
          },
          {
            "text": "      if (!parent) return;",
            "lineNumber": 3325
          },
          {
            "text": "      const baseName = t('context.newFolder');",
            "lineNumber": 3326
          },
          {
            "text": "      let name = baseName;",
            "lineNumber": 3327
          },
          {
            "text": "      if (parent.path) {",
            "lineNumber": 3328
          },
          {
            "text": "          try {",
            "lineNumber": 3329
          },
          {
            "text": "              let counter = 1;",
            "lineNumber": 3330
          },
          {
            "text": "              const children = parent.children?.map(id =&gt; state.files[id]) || [];",
            "lineNumber": 3331
          },
          {
            "text": "              while (children.some(c =&gt; c.name === name)) { name = &#96;${baseName} (${counter++})&#96;; }",
            "lineNumber": 3332
          },
          {
            "text": "              const separator = parent.path.includes('/') ? '/' : '\\\\';",
            "lineNumber": 3333
          },
          {
            "text": "              const newPath = &#96;${parent.path}${separator}${name}&#96;;",
            "lineNumber": 3334
          },
          {
            "text": "              ",
            "lineNumber": 3335
          },
          {
            "text": "              // Use appropriate createFolder function based on environment",
            "lineNumber": 3336
          },
          {
            "text": "              const isTauriEnv = isTauriEnvironment();",
            "lineNumber": 3337
          },
          {
            "text": "              if (isTauriEnv) {",
            "lineNumber": 3338
          },
          {
            "text": "                  await createFolder(newPath);",
            "lineNumber": 3339
          },
          {
            "text": "              } else if (window.electron) {",
            "lineNumber": 3340
          },
          {
            "text": "                  await window.electron.createFolder(newPath);",
            "lineNumber": 3341
          },
          {
            "text": "              } else {",
            "lineNumber": 3342
          },
          {
            "text": "                  throw new Error(\"No file system access available\");",
            "lineNumber": 3343
          },
          {
            "text": "              }",
            "lineNumber": 3344
          },
          {
            "text": "              ",
            "lineNumber": 3345
          },
          {
            "text": "              await handleRefresh();",
            "lineNumber": 3346
          },
          {
            "text": "              ",
            "lineNumber": 3347
          },
          {
            "text": "              // Find the newly created folder and set it to renaming state",
            "lineNumber": 3348
          },
          {
            "text": "              setState(prev =&gt; {",
            "lineNumber": 3349
          },
          {
            "text": "                  const parentFolder = prev.files[parentId];",
            "lineNumber": 3350
          },
          {
            "text": "                  if (parentFolder?.children) {",
            "lineNumber": 3351
          },
          {
            "text": "                      // Get all children files",
            "lineNumber": 3352
          },
          {
            "text": "                      const childFiles = parentFolder.children.map(id =&gt; prev.files[id]);",
            "lineNumber": 3353
          },
          {
            "text": "                      // Find the folder with the matching name we just created",
            "lineNumber": 3354
          },
          {
            "text": "                      const newFolder = childFiles.find(file =&gt; file?.name === name &amp;&amp; file?.type === FileType.FOLDER);",
            "lineNumber": 3355
          },
          {
            "text": "                      if (newFolder) {",
            "lineNumber": 3356
          },
          {
            "text": "                          return { ...prev, renamingId: newFolder.id };",
            "lineNumber": 3357
          },
          {
            "text": "                      }",
            "lineNumber": 3358
          },
          {
            "text": "                  }",
            "lineNumber": 3359
          },
          {
            "text": "                  return prev;",
            "lineNumber": 3360
          },
          {
            "text": "              });",
            "lineNumber": 3361
          },
          {
            "text": "          } catch (error) { console.error(error); showToast(\"Error creating folder\"); }",
            "lineNumber": 3362
          },
          {
            "text": "      } else {",
            "lineNumber": 3363
          },
          {
            "text": "          let counter = 1;",
            "lineNumber": 3364
          },
          {
            "text": "          const children = parent.children?.map(id =&gt; state.files[id]) || [];",
            "lineNumber": 3365
          },
          {
            "text": "          while (children.some(c =&gt; c.name === name)) { name = &#96;${baseName} (${counter++})&#96;; }",
            "lineNumber": 3366
          },
          {
            "text": "          const newId = Math.random().toString(36).substr(2, 9);",
            "lineNumber": 3367
          },
          {
            "text": "          const newFolder: FileNode = {",
            "lineNumber": 3368
          },
          {
            "text": "              id: newId,",
            "lineNumber": 3369
          },
          {
            "text": "              parentId: parentId,",
            "lineNumber": 3370
          },
          {
            "text": "              name,",
            "lineNumber": 3371
          },
          {
            "text": "              type: FileType.FOLDER,",
            "lineNumber": 3372
          },
          {
            "text": "              path: '',",
            "lineNumber": 3373
          },
          {
            "text": "              children: [],",
            "lineNumber": 3374
          },
          {
            "text": "              tags: [],",
            "lineNumber": 3375
          },
          {
            "text": "          };",
            "lineNumber": 3378
          },
          {
            "text": ";",
            "lineNumber": 3387
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.3127967119216919
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1272
          },
          "endPosition": {
            "line": 1428,
            "column": 1
          }
        },
        "contents": "const useLayout = \n() =&gt; {\n(id, index) =&gt; {\n {\n                    const scale = (availableWidth - (currentRow.length - 1) * GAP) / currentWidth;\n                    const rowHeight = targetHeight * scale;\n                    \n                    let x = PADDING;\n                    currentRow.forEach(item =&gt; {\n                        const finalW = item.w * scale;\n                        layout.push({ id: item.id, x, y, width: finalW, height: rowHeight + 40 });\n                        x += finalW + GAP;\n                    });\n                    \n                    y += rowHeight + 40 + GAP;\n                    currentRow = [];\n                    currentWidth = 0;\n                }\n                \n                currentRow.push({ id, w });\n                currentWidth += w;\n            });\n\n            if (currentRow.length &gt; 0) {\n                let x = PADDING;\n                currentRow.forEach(item =&gt; {\n                    layout.push({ id: item.id, x, y, width: item.w, height: targetHeight + 40 });\n                    x += item.w + GAP;\n                });\n                y += targetHeight + 40 + GAP;\n            }\n            totalHeight = y;\n\n        } else if (layoutMode === 'masonry') {\n            const minColWidth = thumbnailSize;\n            const cols = Math.max(1, Math.floor((availableWidth + GAP) / (minColWidth + GAP)));\n            const itemWidth = (availableWidth - (cols - 1) * GAP) / cols;\n            const colHeights = new Array(cols).fill(PADDING);\n\n            items.forEach(id =&gt; {\n                const aspect = aspectRatios[id];\n                const imgHeight = itemWidth / aspect;\n                const totalItemHeight = imgHeight + 40;\n\n                let minCol = 0;\n                let minHeight = colHeights[0];\n                for (let i = 1; i &lt; cols; i++) {\n                    if (colHeights[i] &lt; minHeight) {\n                        minCol = i;\n                }\n            }\n  }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const useLayout = ",
            "lineNumber": 1273
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 1296
          },
          {
            "text": "(id, index) =&gt; {",
            "lineNumber": 1338
          },
          {
            "text": " {",
            "lineNumber": 1342
          },
          {
            "text": "                    const scale = (availableWidth - (currentRow.length - 1) * GAP) / currentWidth;",
            "lineNumber": 1343
          },
          {
            "text": "                    const rowHeight = targetHeight * scale;",
            "lineNumber": 1344
          },
          {
            "text": "                    ",
            "lineNumber": 1345
          },
          {
            "text": "                    let x = PADDING;",
            "lineNumber": 1346
          },
          {
            "text": "                    currentRow.forEach(item =&gt; {",
            "lineNumber": 1347
          },
          {
            "text": "                        const finalW = item.w * scale;",
            "lineNumber": 1348
          },
          {
            "text": "                        layout.push({ id: item.id, x, y, width: finalW, height: rowHeight + 40 });",
            "lineNumber": 1349
          },
          {
            "text": "                        x += finalW + GAP;",
            "lineNumber": 1350
          },
          {
            "text": "                    });",
            "lineNumber": 1351
          },
          {
            "text": "                    ",
            "lineNumber": 1352
          },
          {
            "text": "                    y += rowHeight + 40 + GAP;",
            "lineNumber": 1353
          },
          {
            "text": "                    currentRow = [];",
            "lineNumber": 1354
          },
          {
            "text": "                    currentWidth = 0;",
            "lineNumber": 1355
          },
          {
            "text": "                }",
            "lineNumber": 1356
          },
          {
            "text": "                ",
            "lineNumber": 1357
          },
          {
            "text": "                currentRow.push({ id, w });",
            "lineNumber": 1358
          },
          {
            "text": "                currentWidth += w;",
            "lineNumber": 1359
          },
          {
            "text": "            });",
            "lineNumber": 1360
          },
          {
            "lineNumber": 1361
          },
          {
            "text": "            if (currentRow.length &gt; 0) {",
            "lineNumber": 1362
          },
          {
            "text": "                let x = PADDING;",
            "lineNumber": 1363
          },
          {
            "text": "                currentRow.forEach(item =&gt; {",
            "lineNumber": 1364
          },
          {
            "text": "                    layout.push({ id: item.id, x, y, width: item.w, height: targetHeight + 40 });",
            "lineNumber": 1365
          },
          {
            "text": "                    x += item.w + GAP;",
            "lineNumber": 1366
          },
          {
            "text": "                });",
            "lineNumber": 1367
          },
          {
            "text": "                y += targetHeight + 40 + GAP;",
            "lineNumber": 1368
          },
          {
            "text": "            }",
            "lineNumber": 1369
          },
          {
            "text": "            totalHeight = y;",
            "lineNumber": 1370
          },
          {
            "lineNumber": 1371
          },
          {
            "text": "        } else if (layoutMode === 'masonry') {",
            "lineNumber": 1372
          },
          {
            "text": "            const minColWidth = thumbnailSize;",
            "lineNumber": 1373
          },
          {
            "text": "            const cols = Math.max(1, Math.floor((availableWidth + GAP) / (minColWidth + GAP)));",
            "lineNumber": 1374
          },
          {
            "text": "            const itemWidth = (availableWidth - (cols - 1) * GAP) / cols;",
            "lineNumber": 1375
          },
          {
            "text": "            const colHeights = new Array(cols).fill(PADDING);",
            "lineNumber": 1376
          },
          {
            "lineNumber": 1377
          },
          {
            "text": "            items.forEach(id =&gt; {",
            "lineNumber": 1378
          },
          {
            "text": "                const aspect = aspectRatios[id];",
            "lineNumber": 1379
          },
          {
            "text": "                const imgHeight = itemWidth / aspect;",
            "lineNumber": 1380
          },
          {
            "text": "                const totalItemHeight = imgHeight + 40;",
            "lineNumber": 1381
          },
          {
            "lineNumber": 1382
          },
          {
            "text": "                let minCol = 0;",
            "lineNumber": 1383
          },
          {
            "text": "                let minHeight = colHeights[0];",
            "lineNumber": 1384
          },
          {
            "text": "                for (let i = 1; i &lt; cols; i++) {",
            "lineNumber": 1385
          },
          {
            "text": "                    if (colHeights[i] &lt; minHeight) {",
            "lineNumber": 1386
          },
          {
            "text": "                        minCol = i;",
            "lineNumber": 1387
          },
          {
            "text": "                }",
            "lineNumber": 1390
          },
          {
            "text": "            }",
            "lineNumber": 1401
          },
          {
            "text": "  }",
            "lineNumber": 1428
          },
          {
            "text": ";",
            "lineNumber": 1429
          }
        ]
      },
      "score": 0.31236881017684937
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n\n          \n          &lt;div className=\"px-4 py-2 hover:bg-purple-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { onAIAnalysis(file.id); setContextMenu({...contextMenu, visible: false}); }}&gt;\n             &lt;Brain size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.aiAnalyze')}\n          &lt;/div&gt;\n          \n          &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;\n          \n          &lt;div \n            className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center justify-between\"\n            onClick={() =&gt; { setShowSlideshowSettings(true); setContextMenu({...contextMenu, visible: false}); }}\n          &gt;\n            &lt;div className=\"flex items-center\"&gt;\n                &lt;Settings size={14} className=\"mr-2\"/&gt;\n                {t('context.slideshowSettings')}\n            &lt;/div&gt;\n          &lt;/div&gt;\n          &lt;div \n            className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center justify-between\"\n            onClick={toggleSlideshow}\n          &gt;\n            &lt;div className=\"flex items-center\"&gt;\n                {slideshowActive ? &lt;Square size={14} className=\"mr-2\"/&gt; : &lt;Play size={14} className=\"mr-2\"/&gt;}\n                {slideshowActive ? t('context.stopSlideshow') : t('context.startSlideshow')}\n            &lt;/div&gt;\n          &lt;/div&gt;\n          \n          &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;\n          \n          &lt;div className=\"px-4 py-2 hover:bg-red-600 hover:text-white text-red-500 dark:text-red-400 cursor-pointer flex items-center\" onClick={() =&gt; { onDelete(file.id); setContextMenu({...contextMenu, visible: false}); }}&gt;\n             &lt;Trash2 size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.delete')}\n          &lt;/div&gt;\n        &lt;/div&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "lineNumber": 712
          },
          {
            "text": "          ",
            "lineNumber": 713
          },
          {
            "text": "          &lt;div className=\"px-4 py-2 hover:bg-purple-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { onAIAnalysis(file.id); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 714
          },
          {
            "text": "             &lt;Brain size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.aiAnalyze')}",
            "lineNumber": 715
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 716
          },
          {
            "text": "          ",
            "lineNumber": 717
          },
          {
            "text": "          &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;",
            "lineNumber": 718
          },
          {
            "text": "          ",
            "lineNumber": 719
          },
          {
            "text": "          &lt;div ",
            "lineNumber": 720
          },
          {
            "text": "            className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center justify-between\"",
            "lineNumber": 721
          },
          {
            "text": "            onClick={() =&gt; { setShowSlideshowSettings(true); setContextMenu({...contextMenu, visible: false}); }}",
            "lineNumber": 722
          },
          {
            "text": "          &gt;",
            "lineNumber": 723
          },
          {
            "text": "            &lt;div className=\"flex items-center\"&gt;",
            "lineNumber": 724
          },
          {
            "text": "                &lt;Settings size={14} className=\"mr-2\"/&gt;",
            "lineNumber": 725
          },
          {
            "text": "                {t('context.slideshowSettings')}",
            "lineNumber": 726
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 727
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 728
          },
          {
            "text": "          &lt;div ",
            "lineNumber": 729
          },
          {
            "text": "            className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center justify-between\"",
            "lineNumber": 730
          },
          {
            "text": "            onClick={toggleSlideshow}",
            "lineNumber": 731
          },
          {
            "text": "          &gt;",
            "lineNumber": 732
          },
          {
            "text": "            &lt;div className=\"flex items-center\"&gt;",
            "lineNumber": 733
          },
          {
            "text": "                {slideshowActive ? &lt;Square size={14} className=\"mr-2\"/&gt; : &lt;Play size={14} className=\"mr-2\"/&gt;}",
            "lineNumber": 734
          },
          {
            "text": "                {slideshowActive ? t('context.stopSlideshow') : t('context.startSlideshow')}",
            "lineNumber": 735
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 736
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 737
          },
          {
            "text": "          ",
            "lineNumber": 738
          },
          {
            "text": "          &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;",
            "lineNumber": 739
          },
          {
            "text": "          ",
            "lineNumber": 740
          },
          {
            "text": "          &lt;div className=\"px-4 py-2 hover:bg-red-600 hover:text-white text-red-500 dark:text-red-400 cursor-pointer flex items-center\" onClick={() =&gt; { onDelete(file.id); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 741
          },
          {
            "text": "             &lt;Trash2 size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.delete')}",
            "lineNumber": 742
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 743
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 744
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.30927199125289917
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 512
          },
          "endPosition": {
            "line": 679,
            "column": 1
          }
        },
        "contents": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {\n\n              &lt;p&gt;{t('sidebar.noTagsFound')}&lt;/p&gt;\n          &lt;/div&gt;\n      )}\n      {keys.map((group: string) =&gt; {\n          const tagsInGroup = groupedTags[group];\n          return (\n              &lt;div id={&#96;tag-group-${group}&#96;} key={group} className=\"mb-8 scroll-mt-4\"&gt;\n                   &lt;div className=\"flex items-center mb-0 border-b border-gray-100 dark:border-gray-800 pt-3 pb-3 sticky top-0 bg-white/95 dark:bg-gray-950/95 z-10 backdrop-blur-sm transition-colors h-16\"&gt;\n                       &lt;div className=\"w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-lg mr-3 shadow-sm border border-blue-100 dark:border-blue-900/50\"&gt;\n                          {group}\n                       &lt;/div&gt;\n                       &lt;span className=\"text-xs font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wider\"&gt;\n                          {tagsInGroup.length} {t('context.items')}\n                       &lt;/span&gt;\n                   &lt;/div&gt;\n                   &lt;div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3\"&gt;\n                       {tagsInGroup.map((tag: string) =&gt; {\n                           const count = tagCounts[tag] || 0;\n                           const isSelected = selectedTagIds.includes(tag);\n                           return (\n                              &lt;TagItem\n                       }\n      }\n}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {",
            "lineNumber": 513
          },
          {
            "lineNumber": 612
          },
          {
            "text": "              &lt;p&gt;{t('sidebar.noTagsFound')}&lt;/p&gt;",
            "lineNumber": 613
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 614
          },
          {
            "text": "      )}",
            "lineNumber": 615
          },
          {
            "text": "      {keys.map((group: string) =&gt; {",
            "lineNumber": 616
          },
          {
            "text": "          const tagsInGroup = groupedTags[group];",
            "lineNumber": 617
          },
          {
            "text": "          return (",
            "lineNumber": 618
          },
          {
            "text": "              &lt;div id={&#96;tag-group-${group}&#96;} key={group} className=\"mb-8 scroll-mt-4\"&gt;",
            "lineNumber": 619
          },
          {
            "text": "                   &lt;div className=\"flex items-center mb-0 border-b border-gray-100 dark:border-gray-800 pt-3 pb-3 sticky top-0 bg-white/95 dark:bg-gray-950/95 z-10 backdrop-blur-sm transition-colors h-16\"&gt;",
            "lineNumber": 620
          },
          {
            "text": "                       &lt;div className=\"w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-lg mr-3 shadow-sm border border-blue-100 dark:border-blue-900/50\"&gt;",
            "lineNumber": 621
          },
          {
            "text": "                          {group}",
            "lineNumber": 622
          },
          {
            "text": "                       &lt;/div&gt;",
            "lineNumber": 623
          },
          {
            "text": "                       &lt;span className=\"text-xs font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wider\"&gt;",
            "lineNumber": 624
          },
          {
            "text": "                          {tagsInGroup.length} {t('context.items')}",
            "lineNumber": 625
          },
          {
            "text": "                       &lt;/span&gt;",
            "lineNumber": 626
          },
          {
            "text": "                   &lt;/div&gt;",
            "lineNumber": 627
          },
          {
            "text": "                   &lt;div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3\"&gt;",
            "lineNumber": 628
          },
          {
            "text": "                       {tagsInGroup.map((tag: string) =&gt; {",
            "lineNumber": 629
          },
          {
            "text": "                           const count = tagCounts[tag] || 0;",
            "lineNumber": 630
          },
          {
            "text": "                           const isSelected = selectedTagIds.includes(tag);",
            "lineNumber": 631
          },
          {
            "text": "                           return (",
            "lineNumber": 632
          },
          {
            "text": "                              &lt;TagItem",
            "lineNumber": 633
          },
          {
            "text": "                       }",
            "lineNumber": 645
          },
          {
            "text": "      }",
            "lineNumber": 649
          },
          {
            "text": "}",
            "lineNumber": 675
          },
          {
            "text": ";",
            "lineNumber": 680
          }
        ]
      },
      "score": 0.3072878122329712
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


检查当前选中状态的样式实现：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/TreeSidebar.tsx</summary>

</details>
</tool-use>

---



---


增强选中状态的视觉标识，使其更清晰：


---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "475508df-db78-4f4b-ab1d-7f6e76099920"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "0fe9e358-b7aa-4829-a876-a79b814a5132"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "83a259cc-e153-42cc-93d5-724e26982c5d"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "ca008a99-ef33-41e2-a66c-00927ba3349f"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "FolderPickerModal 文件夹选择 selected currentId bg-blue",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 107
          },
          "endPosition": {
            "line": 253,
            "column": 1
          }
        },
        "contents": "const FolderPickerModal = \nconst findMatchingFolders = \n\n    \n    return matchingFolders;\n  };\n  \n  // 递归渲染文件夹树，支持搜索过滤\n  const renderTree = (nodeId: string, depth = 0, matchingFolders?: Set&lt;string&gt; | null) =&gt; {\n    const node = files[nodeId];\n    if (!node || node.type !== FileType.FOLDER) return null;\n    if (selectedFileIds.includes(nodeId)) return null;\n    \n    // 如果有搜索条件，检查当前文件夹是否应该显示\n    const shouldShow = !matchingFolders || matchingFolders.has(nodeId);\n    if (!shouldShow) return null;\n    \n    const expanded = expandedIds.includes(nodeId);\n    const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];\n    \n    return (\n      &lt;div key={nodeId}&gt;\n        &lt;div \n          className={&#96;flex items-center py-1 px-2 cursor-pointer text-sm ${currentId === nodeId ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300' : 'hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300'}&#96;}\n          style={{ paddingLeft: &#96;${depth * 16 + 8}px&#96; }}\n          onClick={() =&gt; setCurrentId(nodeId)}\n        &gt;\n          {/* 展开/折叠按钮 */}\n          &lt;div \n            className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\"\n            onClick={(e) =&gt; handleToggle(e, nodeId)}\n          &gt;\n            {folderChildren.length &gt; 0 ? (\n              expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;\n            ) : &lt;div className=\"w-[14px]\" /&gt;}\n          &lt;/div&gt;\n          &lt;Folder size={14} className=\"mr-2 text-blue-500\"/&gt;\n          &lt;span className=\"truncate\"&gt;{node.name}&lt;/span&gt;\n        &lt;/div&gt;\n        {/* 只渲染展开的文件夹 */}\n        {expanded &amp;&amp; folderChildren.map((childId: string) =&gt; renderTree(childId, depth + 1, matchingFolders))}\n      &lt;/div&gt;\n    );\n  };\n  \n  const matchingFolders = findMatchingFolders();\n  \n  return (\n    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 108,
                "column": 1
              },
              "endPosition": {
                "line": 108,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 108,
                "column": 7
              },
              "endPosition": {
                "line": 108,
                "column": 27
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ",
            "lineNumber": 108
          },
          {
            "text": "const findMatchingFolders = ",
            "lineNumber": 127
          },
          {
            "lineNumber": 163
          },
          {
            "text": "    ",
            "lineNumber": 164
          },
          {
            "text": "    return matchingFolders;",
            "lineNumber": 165
          },
          {
            "text": "  };",
            "lineNumber": 166
          },
          {
            "text": "  ",
            "lineNumber": 167
          },
          {
            "text": "  // 递归渲染文件夹树，支持搜索过滤",
            "lineNumber": 168
          },
          {
            "text": "  const renderTree = (nodeId: string, depth = 0, matchingFolders?: Set&lt;string&gt; | null) =&gt; {",
            "lineNumber": 169
          },
          {
            "text": "    const node = files[nodeId];",
            "lineNumber": 170
          },
          {
            "text": "    if (!node || node.type !== FileType.FOLDER) return null;",
            "lineNumber": 171
          },
          {
            "text": "    if (selectedFileIds.includes(nodeId)) return null;",
            "lineNumber": 172
          },
          {
            "text": "    ",
            "lineNumber": 173
          },
          {
            "text": "    // 如果有搜索条件，检查当前文件夹是否应该显示",
            "lineNumber": 174
          },
          {
            "text": "    const shouldShow = !matchingFolders || matchingFolders.has(nodeId);",
            "lineNumber": 175
          },
          {
            "text": "    if (!shouldShow) return null;",
            "lineNumber": 176
          },
          {
            "text": "    ",
            "lineNumber": 177
          },
          {
            "text": "    const expanded = expandedIds.includes(nodeId);",
            "lineNumber": 178
          },
          {
            "text": "    const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];",
            "lineNumber": 179
          },
          {
            "text": "    ",
            "lineNumber": 180
          },
          {
            "text": "    return (",
            "lineNumber": 181
          },
          {
            "text": "      &lt;div key={nodeId}&gt;",
            "lineNumber": 182
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 183
          },
          {
            "text": "          className={&#96;flex items-center py-1 px-2 cursor-pointer text-sm ${currentId === nodeId ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300' : 'hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300'}&#96;}",
            "lineNumber": 184
          },
          {
            "text": "          style={{ paddingLeft: &#96;${depth * 16 + 8}px&#96; }}",
            "lineNumber": 185
          },
          {
            "text": "          onClick={() =&gt; setCurrentId(nodeId)}",
            "lineNumber": 186
          },
          {
            "text": "        &gt;",
            "lineNumber": 187
          },
          {
            "text": "          {/* 展开/折叠按钮 */}",
            "lineNumber": 188
          },
          {
            "text": "          &lt;div ",
            "lineNumber": 189
          },
          {
            "text": "            className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\"",
            "lineNumber": 190
          },
          {
            "text": "            onClick={(e) =&gt; handleToggle(e, nodeId)}",
            "lineNumber": 191
          },
          {
            "text": "          &gt;",
            "lineNumber": 192
          },
          {
            "text": "            {folderChildren.length &gt; 0 ? (",
            "lineNumber": 193
          },
          {
            "text": "              expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;",
            "lineNumber": 194
          },
          {
            "text": "            ) : &lt;div className=\"w-[14px]\" /&gt;}",
            "lineNumber": 195
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 196
          },
          {
            "text": "          &lt;Folder size={14} className=\"mr-2 text-blue-500\"/&gt;",
            "lineNumber": 197
          },
          {
            "text": "          &lt;span className=\"truncate\"&gt;{node.name}&lt;/span&gt;",
            "lineNumber": 198
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 199
          },
          {
            "text": "        {/* 只渲染展开的文件夹 */}",
            "lineNumber": 200
          },
          {
            "text": "        {expanded &amp;&amp; folderChildren.map((childId: string) =&gt; renderTree(childId, depth + 1, matchingFolders))}",
            "lineNumber": 201
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 202
          },
          {
            "text": "    );",
            "lineNumber": 203
          },
          {
            "text": "  };",
            "lineNumber": 204
          },
          {
            "text": "  ",
            "lineNumber": 205
          },
          {
            "text": "  const matchingFolders = findMatchingFolders();",
            "lineNumber": 206
          },
          {
            "text": "  ",
            "lineNumber": 207
          },
          {
            "text": "  return (",
            "lineNumber": 208
          },
          {
            "text": "    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in",
            "lineNumber": 209
          },
          {
            "text": ";",
            "lineNumber": 254
          }
        ]
      },
      "score": 0.47797054052352905
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 107
          },
          "endPosition": {
            "line": 255,
            "column": 77
          }
        },
        "contents": "const FolderPickerModal = \n\n  \n  return (\n    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in\"&gt;\n      &lt;h3 className=\"font-bold text-lg mb-2 text-gray-900 dark:text-white\"&gt;\n        {type === 'copy-to-folder' ? t('context.copyTo') : t('context.moveTo')}\n      &lt;/h3&gt;\n      \n      {/* 搜索框 */}\n      &lt;div className=\"relative mb-4\"&gt;\n        &lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;\n        &lt;input\n          type=\"text\"\n          id=\"folder-picker-search\"\n          name=\"folder-picker-search\"\n          className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\"\n          placeholder={t('search.placeholder')}\n          value={searchQuery}\n          onChange={(e) =&gt; setSearchQuery(e.target.value)}\n          autoFocus\n        /&gt;\n        {searchQuery &amp;&amp; (\n          &lt;button\n            className=\"absolute right-2.5 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n            onClick={() =&gt; setSearchQuery('')}\n          &gt;\n            &lt;X size={14} /&gt;\n          &lt;/button&gt;\n        )}\n      &lt;/div&gt;\n      \n      &lt;div className=\"flex-1 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded mb-4 p-2 bg-gray-50 dark:bg-gray-900/50\"&gt;\n        {roots.map((rootId: string) =&gt; renderTree(rootId, 0, matchingFolders))}\n      &lt;/div&gt;\n      &lt;div className=\"flex justify-end space-x-2\"&gt;\n        &lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;\n          {t('settings.cancel')}\n        &lt;/button&gt;\n        &lt;button \n          onClick={() =&gt; currentId &amp;&amp; onConfirm(currentId)} \n          disabled={!currentId}\n          className=\"bg-blue-600 disabled:opacity-50 text-white px-3 py-1.5 rounded hover:bg-blue-700 text-sm\"\n        &gt;\n          {t('settings.confirm')}\n        &lt;/button&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  );\n};\nconst getPinyinGroup = (char: string) =&gt; { if (!char) return '#'; const c = char.charAt(0); if (/^[a-zA-Z]/.test(c)) return c.toUpperCase(); if (/^[0-9]/.test(c)) return c; if (/[\\u4e00-\\u9fa5]/.test(c)) { try { const collator = new Intl.Collator('zh-Hans-CN', { sensitivity: 'accent' }); const boundaries = [{ char: '阿', group: 'A' }, { char: '芭', group: 'B' }, { char: '擦', group: 'C' }, { char: '搭', group: 'D' }, { char: '蛾', group: 'E' }, { char: '发', group: 'F' }, { char: '噶', group: 'G' }, { char: '哈', group: 'H' }, { char: '击', group: 'J' }, { char: '喀', group: 'K' }, { char: '垃', group: 'L' }, { char: '妈', group: 'M' }, { char: '拿', group: 'N' }, { char: '哦', group: 'O' }, { char: '啪', group: 'P' }, { char: '期', group: 'Q' }, { char: '然', group: 'R' }, { char: '撒', group: 'S' }, { char: '塌', group: 'T' }, { char: '挖', group: 'W' }, { char: '昔', group: 'X' }, { char: '压', group: 'Y' }, { char: '匝', group: 'Z' }]; for (let i = boundaries.length - 1; i &gt;= 0; i--) { if (collator.compare(c, boundaries[i].char) &gt;= 0) return boundaries[i].group; } } catch (e) { console.warn('Native pinyin grouping failed', e); } } return '#'; };\nconst DUMMY_TAB: TabState = { id: 'dummy', folderId: '', viewingFileId: null, };",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 108,
                "column": 1
              },
              "endPosition": {
                "line": 108,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 108,
                "column": 7
              },
              "endPosition": {
                "line": 108,
                "column": 27
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ",
            "lineNumber": 108
          },
          {
            "lineNumber": 206
          },
          {
            "text": "  ",
            "lineNumber": 207
          },
          {
            "text": "  return (",
            "lineNumber": 208
          },
          {
            "text": "    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in\"&gt;",
            "lineNumber": 209
          },
          {
            "text": "      &lt;h3 className=\"font-bold text-lg mb-2 text-gray-900 dark:text-white\"&gt;",
            "lineNumber": 210
          },
          {
            "text": "        {type === 'copy-to-folder' ? t('context.copyTo') : t('context.moveTo')}",
            "lineNumber": 211
          },
          {
            "text": "      &lt;/h3&gt;",
            "lineNumber": 212
          },
          {
            "text": "      ",
            "lineNumber": 213
          },
          {
            "text": "      {/* 搜索框 */}",
            "lineNumber": 214
          },
          {
            "text": "      &lt;div className=\"relative mb-4\"&gt;",
            "lineNumber": 215
          },
          {
            "text": "        &lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;",
            "lineNumber": 216
          },
          {
            "text": "        &lt;input",
            "lineNumber": 217
          },
          {
            "text": "          type=\"text\"",
            "lineNumber": 218
          },
          {
            "text": "          id=\"folder-picker-search\"",
            "lineNumber": 219
          },
          {
            "text": "          name=\"folder-picker-search\"",
            "lineNumber": 220
          },
          {
            "text": "          className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\"",
            "lineNumber": 221
          },
          {
            "text": "          placeholder={t('search.placeholder')}",
            "lineNumber": 222
          },
          {
            "text": "          value={searchQuery}",
            "lineNumber": 223
          },
          {
            "text": "          onChange={(e) =&gt; setSearchQuery(e.target.value)}",
            "lineNumber": 224
          },
          {
            "text": "          autoFocus",
            "lineNumber": 225
          },
          {
            "text": "        /&gt;",
            "lineNumber": 226
          },
          {
            "text": "        {searchQuery &amp;&amp; (",
            "lineNumber": 227
          },
          {
            "text": "          &lt;button",
            "lineNumber": 228
          },
          {
            "text": "            className=\"absolute right-2.5 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"",
            "lineNumber": 229
          },
          {
            "text": "            onClick={() =&gt; setSearchQuery('')}",
            "lineNumber": 230
          },
          {
            "text": "          &gt;",
            "lineNumber": 231
          },
          {
            "text": "            &lt;X size={14} /&gt;",
            "lineNumber": 232
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 233
          },
          {
            "text": "        )}",
            "lineNumber": 234
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 235
          },
          {
            "text": "      ",
            "lineNumber": 236
          },
          {
            "text": "      &lt;div className=\"flex-1 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded mb-4 p-2 bg-gray-50 dark:bg-gray-900/50\"&gt;",
            "lineNumber": 237
          },
          {
            "text": "        {roots.map((rootId: string) =&gt; renderTree(rootId, 0, matchingFolders))}",
            "lineNumber": 238
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 239
          },
          {
            "text": "      &lt;div className=\"flex justify-end space-x-2\"&gt;",
            "lineNumber": 240
          },
          {
            "text": "        &lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;",
            "lineNumber": 241
          },
          {
            "text": "          {t('settings.cancel')}",
            "lineNumber": 242
          },
          {
            "text": "        &lt;/button&gt;",
            "lineNumber": 243
          },
          {
            "text": "        &lt;button ",
            "lineNumber": 244
          },
          {
            "text": "          onClick={() =&gt; currentId &amp;&amp; onConfirm(currentId)} ",
            "lineNumber": 245
          },
          {
            "text": "          disabled={!currentId}",
            "lineNumber": 246
          },
          {
            "text": "          className=\"bg-blue-600 disabled:opacity-50 text-white px-3 py-1.5 rounded hover:bg-blue-700 text-sm\"",
            "lineNumber": 247
          },
          {
            "text": "        &gt;",
            "lineNumber": 248
          },
          {
            "text": "          {t('settings.confirm')}",
            "lineNumber": 249
          },
          {
            "text": "        &lt;/button&gt;",
            "lineNumber": 250
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 251
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 252
          },
          {
            "text": "  );",
            "lineNumber": 253
          },
          {
            "text": "};",
            "lineNumber": 254
          },
          {
            "text": "const getPinyinGroup = (char: string) =&gt; { if (!char) return '#'; const c = char.charAt(0); if (/^[a-zA-Z]/.test(c)) return c.toUpperCase(); if (/^[0-9]/.test(c)) return c; if (/[\\u4e00-\\u9fa5]/.test(c)) { try { const collator = new Intl.Collator('zh-Hans-CN', { sensitivity: 'accent' }); const boundaries = [{ char: '阿', group: 'A' }, { char: '芭', group: 'B' }, { char: '擦', group: 'C' }, { char: '搭', group: 'D' }, { char: '蛾', group: 'E' }, { char: '发', group: 'F' }, { char: '噶', group: 'G' }, { char: '哈', group: 'H' }, { char: '击', group: 'J' }, { char: '喀', group: 'K' }, { char: '垃', group: 'L' }, { char: '妈', group: 'M' }, { char: '拿', group: 'N' }, { char: '哦', group: 'O' }, { char: '啪', group: 'P' }, { char: '期', group: 'Q' }, { char: '然', group: 'R' }, { char: '撒', group: 'S' }, { char: '塌', group: 'T' }, { char: '挖', group: 'W' }, { char: '昔', group: 'X' }, { char: '压', group: 'Y' }, { char: '匝', group: 'Z' }]; for (let i = boundaries.length - 1; i &gt;= 0; i--) { if (collator.compare(c, boundaries[i].char) &gt;= 0) return boundaries[i].group; } } catch (e) { console.warn('Native pinyin grouping failed', e); } } return '#'; };",
            "lineNumber": 255
          },
          {
            "text": "const DUMMY_TAB: TabState = { id: 'dummy', folderId: '', viewingFileId: null, };",
            "lineNumber": 256
          }
        ]
      },
      "score": 0.4665476679801941
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 106,
            "column": 2121
          },
          "endPosition": {
            "line": 253,
            "column": 1
          }
        },
        "contents": "const FolderPickerModal = ({ type, files, roots, selectedFileIds, onClose, onConfirm, t }: any) =&gt; {\n  const [currentId, setCurrentId] = useState&lt;string | null&gt;(null);\n  const [searchQuery, setSearchQuery] = useState(''); // 搜索状态\n  // 初始化时将所有根目录 ID 添加到 expandedIds 中，让根目录默认展开\n  const [expandedIds, setExpandedIds] = useState&lt;string[]&gt;(roots); // 跟踪展开的文件夹\n  \n  // 展开/折叠文件夹\n  const handleToggle = (e: React.MouseEvent, nodeId: string) =&gt; {\n    e.stopPropagation();\n    setExpandedIds(prev =&gt; {\n      if (prev.includes(nodeId)) {\n        return prev.filter(id =&gt; id !== nodeId);\n      } else {\n        return [...prev, nodeId];\n      }\n    });\n  };\n  \n  // 查找所有匹配的文件夹及其祖先文件夹\n  const findMatchingFolders = (): Set&lt;string&gt; | null =&gt; {\n    // 如果搜索框为空，返回 null，表示不需要过滤\n    if (!searchQuery.trim()) {\n      return null;\n    }\n;\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ({ type, files, roots, selectedFileIds, onClose, onConfirm, t }: any) =&gt; {",
            "lineNumber": 108
          },
          {
            "text": "  const [currentId, setCurrentId] = useState&lt;string | null&gt;(null);",
            "lineNumber": 109
          },
          {
            "text": "  const [searchQuery, setSearchQuery] = useState(''); // 搜索状态",
            "lineNumber": 110
          },
          {
            "text": "  // 初始化时将所有根目录 ID 添加到 expandedIds 中，让根目录默认展开",
            "lineNumber": 111
          },
          {
            "text": "  const [expandedIds, setExpandedIds] = useState&lt;string[]&gt;(roots); // 跟踪展开的文件夹",
            "lineNumber": 112
          },
          {
            "text": "  ",
            "lineNumber": 113
          },
          {
            "text": "  // 展开/折叠文件夹",
            "lineNumber": 114
          },
          {
            "text": "  const handleToggle = (e: React.MouseEvent, nodeId: string) =&gt; {",
            "lineNumber": 115
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 116
          },
          {
            "text": "    setExpandedIds(prev =&gt; {",
            "lineNumber": 117
          },
          {
            "text": "      if (prev.includes(nodeId)) {",
            "lineNumber": 118
          },
          {
            "text": "        return prev.filter(id =&gt; id !== nodeId);",
            "lineNumber": 119
          },
          {
            "text": "      } else {",
            "lineNumber": 120
          },
          {
            "text": "        return [...prev, nodeId];",
            "lineNumber": 121
          },
          {
            "text": "      }",
            "lineNumber": 122
          },
          {
            "text": "    });",
            "lineNumber": 123
          },
          {
            "text": "  };",
            "lineNumber": 124
          },
          {
            "text": "  ",
            "lineNumber": 125
          },
          {
            "text": "  // 查找所有匹配的文件夹及其祖先文件夹",
            "lineNumber": 126
          },
          {
            "text": "  const findMatchingFolders = (): Set&lt;string&gt; | null =&gt; {",
            "lineNumber": 127
          },
          {
            "text": "    // 如果搜索框为空，返回 null，表示不需要过滤",
            "lineNumber": 128
          },
          {
            "text": "    if (!searchQuery.trim()) {",
            "lineNumber": 129
          },
          {
            "text": "      return null;",
            "lineNumber": 130
          },
          {
            "text": "    }",
            "lineNumber": 131
          },
          {
            "text": ";",
            "lineNumber": 166
          },
          {
            "text": ";",
            "lineNumber": 254
          }
        ]
      },
      "score": 0.4404717683792114
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 681
          },
          "endPosition": {
            "line": 926,
            "column": 1
          }
        },
        "contents": "const FileListItem = ({\n  file,\n  isSelected,\n  renamingId,\n  onFileClick,\n  onFileDoubleClick,\n  onContextMenu,\n  onStartRename,\n  onRenameSubmit,\n  onRenameCancel,\n  onDragStart,\n  onDragEnd,\n  onDragOver,\n  onDragLeave,\n  onDropOnFolder,\n  onDropExternal,\n  t,\n  dragTargetId,\n  resourceRoot,\n  cachePath\n}: any) =&gt; {\n\n                    &lt;/div&gt;\n                )}\n            &lt;/div&gt;\n            )}\n            {renamingId === file.id ? (\n            &lt;div className=\"w-64 pointer-events-auto\"&gt;\n                &lt;InlineRenameInput\n                    defaultValue={file.name}\n                    onCommit={(val: string) =&gt; onRenameSubmit(val, file.id)}\n                    onCancel={onRenameCancel}\n                /&gt;\n            &lt;/div&gt;\n            ) : (\n            &lt;span\n                className=\"truncate text-gray-900 dark:text-gray-100 font-bold text-sm pointer-events-auto\"\n                onDoubleClick={(e) =&gt; {\n                e.stopPropagation();\n                onStartRename(file.id);\n                }}\n            &gt;{file.name}&lt;/span&gt;\n            )}\n        &lt;/div&gt;\n        &lt;div className=\"w-32 text-xs text-gray-500 truncate hidden sm:block pointer-events-none\"&gt;\n            {file.updatedAt ? new Date(file.updatedAt).toLocaleDateString() : '-'}\n        &lt;/div&gt;\n        &lt;div className=\"w-24 text-xs text-gray-500 uppercase hidden md:block pointer-events-none\"&gt;\n            {file.type === FileType.FOLDER ? t('meta.folderType') : file.meta?.format || '-'}\n        &lt;/div&gt;\n        &lt;div className=\"w-20 text-xs text-gray-500 text-right font-mono hidden sm:block pointer-events-none\"&gt;\n            {file.type === FileType.IMAGE ? formatSize(file.meta?.sizeKb || 0) : '-'}\n        &lt;/div&gt;\n    &lt;/div&gt;\n  );\n});\n\nconst PersonCard = React.memo(({\n  person,\n  files,\n  isSelected,\n  onPersonClick,\n  onPersonDoubleClick,\n  onStartRenamePerson,\n  onPersonContextMenu,\n  t,\n  style\n}: {\n  person: Person;\n  files: Record&lt;string, FileNode&gt;;\n  isSelected: boolean;\n  onPersonClick: (id: string, e: React.MouseEvent) =&gt; void;\n  onPersonDoubleClick: (id: string) =&gt; void;\n  onStartRenamePerson?: (id: string) =&gt; void;\n  onPersonContextMenu: (e: React.MouseEvent, id: string) =&gt; void;\n  t: (key: string) =&gt; string;\n  style: any;\n}) =&gt; {\n  \n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FileListItem = ({",
            "lineNumber": 682
          },
          {
            "text": "  file,",
            "lineNumber": 683
          },
          {
            "text": "  isSelected,",
            "lineNumber": 684
          },
          {
            "text": "  renamingId,",
            "lineNumber": 685
          },
          {
            "text": "  onFileClick,",
            "lineNumber": 686
          },
          {
            "text": "  onFileDoubleClick,",
            "lineNumber": 687
          },
          {
            "text": "  onContextMenu,",
            "lineNumber": 688
          },
          {
            "text": "  onStartRename,",
            "lineNumber": 689
          },
          {
            "text": "  onRenameSubmit,",
            "lineNumber": 690
          },
          {
            "text": "  onRenameCancel,",
            "lineNumber": 691
          },
          {
            "text": "  onDragStart,",
            "lineNumber": 692
          },
          {
            "text": "  onDragEnd,",
            "lineNumber": 693
          },
          {
            "text": "  onDragOver,",
            "lineNumber": 694
          },
          {
            "text": "  onDragLeave,",
            "lineNumber": 695
          },
          {
            "text": "  onDropOnFolder,",
            "lineNumber": 696
          },
          {
            "text": "  onDropExternal,",
            "lineNumber": 697
          },
          {
            "text": "  t,",
            "lineNumber": 698
          },
          {
            "text": "  dragTargetId,",
            "lineNumber": 699
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 700
          },
          {
            "text": "  cachePath",
            "lineNumber": 701
          },
          {
            "text": "}: any) =&gt; {",
            "lineNumber": 702
          },
          {
            "lineNumber": 798
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 799
          },
          {
            "text": "                )}",
            "lineNumber": 800
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 801
          },
          {
            "text": "            )}",
            "lineNumber": 802
          },
          {
            "text": "            {renamingId === file.id ? (",
            "lineNumber": 803
          },
          {
            "text": "            &lt;div className=\"w-64 pointer-events-auto\"&gt;",
            "lineNumber": 804
          },
          {
            "text": "                &lt;InlineRenameInput",
            "lineNumber": 805
          },
          {
            "text": "                    defaultValue={file.name}",
            "lineNumber": 806
          },
          {
            "text": "                    onCommit={(val: string) =&gt; onRenameSubmit(val, file.id)}",
            "lineNumber": 807
          },
          {
            "text": "                    onCancel={onRenameCancel}",
            "lineNumber": 808
          },
          {
            "text": "                /&gt;",
            "lineNumber": 809
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 810
          },
          {
            "text": "            ) : (",
            "lineNumber": 811
          },
          {
            "text": "            &lt;span",
            "lineNumber": 812
          },
          {
            "text": "                className=\"truncate text-gray-900 dark:text-gray-100 font-bold text-sm pointer-events-auto\"",
            "lineNumber": 813
          },
          {
            "text": "                onDoubleClick={(e) =&gt; {",
            "lineNumber": 814
          },
          {
            "text": "                e.stopPropagation();",
            "lineNumber": 815
          },
          {
            "text": "                onStartRename(file.id);",
            "lineNumber": 816
          },
          {
            "text": "                }}",
            "lineNumber": 817
          },
          {
            "text": "            &gt;{file.name}&lt;/span&gt;",
            "lineNumber": 818
          },
          {
            "text": "            )}",
            "lineNumber": 819
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 820
          },
          {
            "text": "        &lt;div className=\"w-32 text-xs text-gray-500 truncate hidden sm:block pointer-events-none\"&gt;",
            "lineNumber": 821
          },
          {
            "text": "            {file.updatedAt ? new Date(file.updatedAt).toLocaleDateString() : '-'}",
            "lineNumber": 822
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 823
          },
          {
            "text": "        &lt;div className=\"w-24 text-xs text-gray-500 uppercase hidden md:block pointer-events-none\"&gt;",
            "lineNumber": 824
          },
          {
            "text": "            {file.type === FileType.FOLDER ? t('meta.folderType') : file.meta?.format || '-'}",
            "lineNumber": 825
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 826
          },
          {
            "text": "        &lt;div className=\"w-20 text-xs text-gray-500 text-right font-mono hidden sm:block pointer-events-none\"&gt;",
            "lineNumber": 827
          },
          {
            "text": "            {file.type === FileType.IMAGE ? formatSize(file.meta?.sizeKb || 0) : '-'}",
            "lineNumber": 828
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 829
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 830
          },
          {
            "text": "  );",
            "lineNumber": 831
          },
          {
            "text": "});",
            "lineNumber": 832
          },
          {
            "lineNumber": 833
          },
          {
            "text": "const PersonCard = React.memo(({",
            "lineNumber": 834
          },
          {
            "text": "  person,",
            "lineNumber": 835
          },
          {
            "text": "  files,",
            "lineNumber": 836
          },
          {
            "text": "  isSelected,",
            "lineNumber": 837
          },
          {
            "text": "  onPersonClick,",
            "lineNumber": 838
          },
          {
            "text": "  onPersonDoubleClick,",
            "lineNumber": 839
          },
          {
            "text": "  onStartRenamePerson,",
            "lineNumber": 840
          },
          {
            "text": "  onPersonContextMenu,",
            "lineNumber": 841
          },
          {
            "text": "  t,",
            "lineNumber": 842
          },
          {
            "text": "  style",
            "lineNumber": 843
          },
          {
            "text": "}: {",
            "lineNumber": 844
          },
          {
            "text": "  person: Person;",
            "lineNumber": 845
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 846
          },
          {
            "text": "  isSelected: boolean;",
            "lineNumber": 847
          },
          {
            "text": "  onPersonClick: (id: string, e: React.MouseEvent) =&gt; void;",
            "lineNumber": 848
          },
          {
            "text": "  onPersonDoubleClick: (id: string) =&gt; void;",
            "lineNumber": 849
          },
          {
            "text": "  onStartRenamePerson?: (id: string) =&gt; void;",
            "lineNumber": 850
          },
          {
            "text": "  onPersonContextMenu: (e: React.MouseEvent, id: string) =&gt; void;",
            "lineNumber": 851
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 852
          },
          {
            "text": "  style: any;",
            "lineNumber": 853
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 854
          },
          {
            "text": "  ",
            "lineNumber": 855
          },
          {
            "text": "};",
            "lineNumber": 927
          }
        ]
      },
      "score": 0.3791886568069458
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 449
          },
          "endPosition": {
            "line": 510,
            "column": 1
          }
        },
        "contents": "export const InlineRenameInput = \n\n\n  useEffect(() =&gt; {\n    if (inputRef.current) {\n      inputRef.current.focus();\n      const lastDot = defaultValue.lastIndexOf('.');\n      if (lastDot &gt; 0) {\n        inputRef.current.setSelectionRange(0, lastDot);\n      } else {\n        inputRef.current.select();\n      }\n    }\n  }, []);\n\n  const handleKeyDown = (e: React.KeyboardEvent) =&gt; {\n    if (e.key === 'Enter') {\n      e.stopPropagation();\n      onCommit(inputRef.current?.value || defaultValue);\n    }\n    if (e.key === 'Escape') {\n      e.stopPropagation();\n      onCancel();\n    }\n  };\n\n  return (\n    &lt;input\n      ref={inputRef}\n      type=\"text\"\n      defaultValue={defaultValue}\n      onBlur={(e) =&gt; onCommit(e.target.value)}\n      onKeyDown={handleKeyDown}\n      onClick={(e) =&gt; e.stopPropagation()}\n      onMouseDown={(e) =&gt; e.stopPropagation()}\n      className=\"w-full text-center text-xs font-bold bg-white dark:bg-gray-700 border border-blue-500 rounded px-1 py-0.5 focus:outline-none shadow-sm cursor-text\"\n    /&gt;\n  );\n};\n\nconst TagItem = React.memo(({ tag, count, isSelected, onTagClick, onTagDoubleClick, onTagContextMenu, handleMouseEnter, handleMouseLeave }: any) =&gt; {\n  return (\n    &lt;div \n      key={tag} \n      data-tag={tag}\n      className={&#96;tag-item rounded-lg p-4 border cursor-pointer group transition-all relative ${isSelected ? 'bg-blue-100 dark:bg-blue-900/40 border-blue-500' : 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500'}&#96;} \n      onClick={(e) =&gt; { e.stopPropagation(); onTagClick &amp;&amp; onTagClick(tag, e); }}\n      onMouseDown={(e) =&gt; e.stopPropagation()}\n      onDoubleClick={() =&gt; onTagDoubleClick &amp;&amp; onTagDoubleClick(tag)} \n      onContextMenu={(e) =&gt; onTagContextMenu &amp;&amp; onTagContextMenu(e, tag)}\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export const InlineRenameInput = ",
            "lineNumber": 450
          },
          {
            "lineNumber": 451
          },
          {
            "lineNumber": 452
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 453
          },
          {
            "text": "    if (inputRef.current) {",
            "lineNumber": 454
          },
          {
            "text": "      inputRef.current.focus();",
            "lineNumber": 455
          },
          {
            "text": "      const lastDot = defaultValue.lastIndexOf('.');",
            "lineNumber": 456
          },
          {
            "text": "      if (lastDot &gt; 0) {",
            "lineNumber": 457
          },
          {
            "text": "        inputRef.current.setSelectionRange(0, lastDot);",
            "lineNumber": 458
          },
          {
            "text": "      } else {",
            "lineNumber": 459
          },
          {
            "text": "        inputRef.current.select();",
            "lineNumber": 460
          },
          {
            "text": "      }",
            "lineNumber": 461
          },
          {
            "text": "    }",
            "lineNumber": 462
          },
          {
            "text": "  }, []);",
            "lineNumber": 463
          },
          {
            "lineNumber": 464
          },
          {
            "text": "  const handleKeyDown = (e: React.KeyboardEvent) =&gt; {",
            "lineNumber": 465
          },
          {
            "text": "    if (e.key === 'Enter') {",
            "lineNumber": 466
          },
          {
            "text": "      e.stopPropagation();",
            "lineNumber": 467
          },
          {
            "text": "      onCommit(inputRef.current?.value || defaultValue);",
            "lineNumber": 468
          },
          {
            "text": "    }",
            "lineNumber": 469
          },
          {
            "text": "    if (e.key === 'Escape') {",
            "lineNumber": 470
          },
          {
            "text": "      e.stopPropagation();",
            "lineNumber": 471
          },
          {
            "text": "      onCancel();",
            "lineNumber": 472
          },
          {
            "text": "    }",
            "lineNumber": 473
          },
          {
            "text": "  };",
            "lineNumber": 474
          },
          {
            "lineNumber": 475
          },
          {
            "text": "  return (",
            "lineNumber": 476
          },
          {
            "text": "    &lt;input",
            "lineNumber": 477
          },
          {
            "text": "      ref={inputRef}",
            "lineNumber": 478
          },
          {
            "text": "      type=\"text\"",
            "lineNumber": 479
          },
          {
            "text": "      defaultValue={defaultValue}",
            "lineNumber": 480
          },
          {
            "text": "      onBlur={(e) =&gt; onCommit(e.target.value)}",
            "lineNumber": 481
          },
          {
            "text": "      onKeyDown={handleKeyDown}",
            "lineNumber": 482
          },
          {
            "text": "      onClick={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 483
          },
          {
            "text": "      onMouseDown={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 484
          },
          {
            "text": "      className=\"w-full text-center text-xs font-bold bg-white dark:bg-gray-700 border border-blue-500 rounded px-1 py-0.5 focus:outline-none shadow-sm cursor-text\"",
            "lineNumber": 485
          },
          {
            "text": "    /&gt;",
            "lineNumber": 486
          },
          {
            "text": "  );",
            "lineNumber": 487
          },
          {
            "text": "};",
            "lineNumber": 488
          },
          {
            "lineNumber": 489
          },
          {
            "text": "const TagItem = React.memo(({ tag, count, isSelected, onTagClick, onTagDoubleClick, onTagContextMenu, handleMouseEnter, handleMouseLeave }: any) =&gt; {",
            "lineNumber": 490
          },
          {
            "text": "  return (",
            "lineNumber": 491
          },
          {
            "text": "    &lt;div ",
            "lineNumber": 492
          },
          {
            "text": "      key={tag} ",
            "lineNumber": 493
          },
          {
            "text": "      data-tag={tag}",
            "lineNumber": 494
          },
          {
            "text": "      className={&#96;tag-item rounded-lg p-4 border cursor-pointer group transition-all relative ${isSelected ? 'bg-blue-100 dark:bg-blue-900/40 border-blue-500' : 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500'}&#96;} ",
            "lineNumber": 495
          },
          {
            "text": "      onClick={(e) =&gt; { e.stopPropagation(); onTagClick &amp;&amp; onTagClick(tag, e); }}",
            "lineNumber": 496
          },
          {
            "text": "      onMouseDown={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 497
          },
          {
            "text": "      onDoubleClick={() =&gt; onTagDoubleClick &amp;&amp; onTagDoubleClick(tag)} ",
            "lineNumber": 498
          },
          {
            "text": "      onContextMenu={(e) =&gt; onTagContextMenu &amp;&amp; onTagContextMenu(e, tag)}",
            "lineNumber": 499
          },
          {
            "text": "};",
            "lineNumber": 511
          }
        ]
      },
      "score": 0.33518874645233154
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 512
          },
          "endPosition": {
            "line": 679,
            "column": 1
          }
        },
        "contents": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {\n(group: string) =&gt; {\n(tag: string) =&gt; {\n\n                           return (\n                              &lt;TagItem \n                                  key={tag}\n                                  tag={tag}\n                                  count={count}\n                                  isSelected={isSelected}\n                                  onTagClick={onTagClick}\n                                  onTagDoubleClick={onTagDoubleClick}\n                                  onTagContextMenu={onTagContextMenu}\n                                  handleMouseEnter={handleMouseEnter}\n                                  handleMouseLeave={handleMouseLeave}\n                              /&gt;\n                           );\n                       })}\n                   &lt;/div&gt;\n              &lt;/div&gt;\n          );\n      })}\n\n      {hoveredTag &amp;&amp; previewImages.length &gt; 0 &amp;&amp; hoveredTagPos &amp;&amp; createPortal(\n        &lt;div \n          className=\"fixed z-[100] bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl p-3 w-64 animate-fade-in pointer-events-none\" \n          style={{ top: hoveredTagPos.top, left: hoveredTagPos.left }}\n        &gt;\n          &lt;div className=\"text-sm text-gray-800 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-600 pb-1 font-bold flex items-center justify-between\"&gt;\n             &lt;span&gt;{t('sidebar.tagPreview')} \"{hoveredTag}\"&lt;/span&gt;\n             &lt;span className=\"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 rounded\"&gt;{previewImages.length} {t('sidebar.recent')}&lt;/span&gt;\n          &lt;/div&gt;\n          &lt;div className=\"grid grid-cols-3 gap-2\"&gt;\n            {previewImages.map((f: any) =&gt; (\n              &lt;div key={f.id} className=\"aspect-square bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-700 overflow-hidden\"&gt;\n                 {/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */}\n                 &lt;div className=\"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center\"&gt;\n                   &lt;ImageIcon className=\"text-gray-400 dark:text-gray-500\" size={20} /&gt;\n                 &lt;/div&gt;\n              &lt;/div&gt;\n            ))}\n          &lt;/div&gt;\n        &lt;/div&gt;\n\n}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {",
            "lineNumber": 513
          },
          {
            "text": "(group: string) =&gt; {",
            "lineNumber": 616
          },
          {
            "text": "(tag: string) =&gt; {",
            "lineNumber": 629
          },
          {
            "lineNumber": 631
          },
          {
            "text": "                           return (",
            "lineNumber": 632
          },
          {
            "text": "                              &lt;TagItem ",
            "lineNumber": 633
          },
          {
            "text": "                                  key={tag}",
            "lineNumber": 634
          },
          {
            "text": "                                  tag={tag}",
            "lineNumber": 635
          },
          {
            "text": "                                  count={count}",
            "lineNumber": 636
          },
          {
            "text": "                                  isSelected={isSelected}",
            "lineNumber": 637
          },
          {
            "text": "                                  onTagClick={onTagClick}",
            "lineNumber": 638
          },
          {
            "text": "                                  onTagDoubleClick={onTagDoubleClick}",
            "lineNumber": 639
          },
          {
            "text": "                                  onTagContextMenu={onTagContextMenu}",
            "lineNumber": 640
          },
          {
            "text": "                                  handleMouseEnter={handleMouseEnter}",
            "lineNumber": 641
          },
          {
            "text": "                                  handleMouseLeave={handleMouseLeave}",
            "lineNumber": 642
          },
          {
            "text": "                              /&gt;",
            "lineNumber": 643
          },
          {
            "text": "                           );",
            "lineNumber": 644
          },
          {
            "text": "                       })}",
            "lineNumber": 645
          },
          {
            "text": "                   &lt;/div&gt;",
            "lineNumber": 646
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 647
          },
          {
            "text": "          );",
            "lineNumber": 648
          },
          {
            "text": "      })}",
            "lineNumber": 649
          },
          {
            "lineNumber": 650
          },
          {
            "text": "      {hoveredTag &amp;&amp; previewImages.length &gt; 0 &amp;&amp; hoveredTagPos &amp;&amp; createPortal(",
            "lineNumber": 651
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 652
          },
          {
            "text": "          className=\"fixed z-[100] bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl p-3 w-64 animate-fade-in pointer-events-none\" ",
            "lineNumber": 653
          },
          {
            "text": "          style={{ top: hoveredTagPos.top, left: hoveredTagPos.left }}",
            "lineNumber": 654
          },
          {
            "text": "        &gt;",
            "lineNumber": 655
          },
          {
            "text": "          &lt;div className=\"text-sm text-gray-800 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-600 pb-1 font-bold flex items-center justify-between\"&gt;",
            "lineNumber": 656
          },
          {
            "text": "             &lt;span&gt;{t('sidebar.tagPreview')} \"{hoveredTag}\"&lt;/span&gt;",
            "lineNumber": 657
          },
          {
            "text": "             &lt;span className=\"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 rounded\"&gt;{previewImages.length} {t('sidebar.recent')}&lt;/span&gt;",
            "lineNumber": 658
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 659
          },
          {
            "text": "          &lt;div className=\"grid grid-cols-3 gap-2\"&gt;",
            "lineNumber": 660
          },
          {
            "text": "            {previewImages.map((f: any) =&gt; (",
            "lineNumber": 661
          },
          {
            "text": "              &lt;div key={f.id} className=\"aspect-square bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-700 overflow-hidden\"&gt;",
            "lineNumber": 662
          },
          {
            "text": "                 {/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */}",
            "lineNumber": 663
          },
          {
            "text": "                 &lt;div className=\"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center\"&gt;",
            "lineNumber": 664
          },
          {
            "text": "                   &lt;ImageIcon className=\"text-gray-400 dark:text-gray-500\" size={20} /&gt;",
            "lineNumber": 665
          },
          {
            "text": "                 &lt;/div&gt;",
            "lineNumber": 666
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 667
          },
          {
            "text": "            ))}",
            "lineNumber": 668
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 669
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 670
          },
          {
            "lineNumber": 672
          },
          {
            "text": "}",
            "lineNumber": 675
          },
          {
            "text": ";",
            "lineNumber": 680
          }
        ]
      },
      "score": 0.3272213935852051
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 77
          },
          "endPosition": {
            "line": 244,
            "column": 1
          }
        },
        "contents": "const extractPalette = async \n(resolve) =&gt; {\n() =&gt; {\n\n            }\n        };\n        img.onerror = () =&gt; resolve([]);\n    });\n};\n\nconst CategorySelector = ({ current, onChange, t }: any) =&gt; (\n  &lt;div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-800\"&gt;\n      &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2\"&gt;{t('meta.folderCategory')}&lt;/div&gt;\n      &lt;div className=\"flex bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl gap-2\"&gt;\n          {['general', 'book', 'sequence'].map((cat) =&gt; {\n              const isActive = current === cat;\n              return (\n                  &lt;button\n                      key={cat}\n                      onClick={() =&gt; onChange(cat)}\n                      className={&#96;flex-1 flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all ${\n                          isActive\n                          ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-md ring-1 ring-black/5 dark:ring-white/10' \n                          : 'text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-100'\n                      }&#96;}\n                  &gt;\n                      {cat === 'general' &amp;&amp; &lt;Folder size={20} className={&#96;mb-1.5 ${isActive ? 'fill-blue-100 dark:fill-blue-900/30' : ''}&#96;}/&gt;}\n                      {cat === 'book' &amp;&amp; &lt;Book size={20} className={&#96;mb-1.5 ${isActive ? 'fill-amber-100 dark:fill-amber-900/30' : ''}&#96;}/&gt;}\n                      {cat === 'sequence' &amp;&amp; &lt;Film size={20} className={&#96;mb-1.5 ${isActive ? 'fill-purple-100 dark:fill-purple-900/30' : ''}&#96;}/&gt;}\n                      {t(&#96;meta.cat${cat.charAt(0).toUpperCase() + cat.slice(1)}&#96;)}\n                  &lt;/button&gt;\n              );\n          })}\n      &lt;/div&gt;\n  &lt;/div&gt;\n);\n\nconst DistributionChart = ({ data, totalFiles }\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const extractPalette = async ",
            "lineNumber": 78
          },
          {
            "text": "(resolve) =&gt; {",
            "lineNumber": 79
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 83
          },
          {
            "lineNumber": 185
          },
          {
            "text": "            }",
            "lineNumber": 186
          },
          {
            "text": "        };",
            "lineNumber": 187
          },
          {
            "text": "        img.onerror = () =&gt; resolve([]);",
            "lineNumber": 188
          },
          {
            "text": "    });",
            "lineNumber": 189
          },
          {
            "text": "};",
            "lineNumber": 190
          },
          {
            "lineNumber": 191
          },
          {
            "text": "const CategorySelector = ({ current, onChange, t }: any) =&gt; (",
            "lineNumber": 192
          },
          {
            "text": "  &lt;div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-800\"&gt;",
            "lineNumber": 193
          },
          {
            "text": "      &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2\"&gt;{t('meta.folderCategory')}&lt;/div&gt;",
            "lineNumber": 194
          },
          {
            "text": "      &lt;div className=\"flex bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl gap-2\"&gt;",
            "lineNumber": 195
          },
          {
            "text": "          {['general', 'book', 'sequence'].map((cat) =&gt; {",
            "lineNumber": 196
          },
          {
            "text": "              const isActive = current === cat;",
            "lineNumber": 197
          },
          {
            "text": "              return (",
            "lineNumber": 198
          },
          {
            "text": "                  &lt;button",
            "lineNumber": 199
          },
          {
            "text": "                      key={cat}",
            "lineNumber": 200
          },
          {
            "text": "                      onClick={() =&gt; onChange(cat)}",
            "lineNumber": 201
          },
          {
            "text": "                      className={&#96;flex-1 flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all ${",
            "lineNumber": 202
          },
          {
            "text": "                          isActive",
            "lineNumber": 203
          },
          {
            "text": "                          ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-md ring-1 ring-black/5 dark:ring-white/10' ",
            "lineNumber": 204
          },
          {
            "text": "                          : 'text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-100'",
            "lineNumber": 205
          },
          {
            "text": "                      }&#96;}",
            "lineNumber": 206
          },
          {
            "text": "                  &gt;",
            "lineNumber": 207
          },
          {
            "text": "                      {cat === 'general' &amp;&amp; &lt;Folder size={20} className={&#96;mb-1.5 ${isActive ? 'fill-blue-100 dark:fill-blue-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 208
          },
          {
            "text": "                      {cat === 'book' &amp;&amp; &lt;Book size={20} className={&#96;mb-1.5 ${isActive ? 'fill-amber-100 dark:fill-amber-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 209
          },
          {
            "text": "                      {cat === 'sequence' &amp;&amp; &lt;Film size={20} className={&#96;mb-1.5 ${isActive ? 'fill-purple-100 dark:fill-purple-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 210
          },
          {
            "text": "                      {t(&#96;meta.cat${cat.charAt(0).toUpperCase() + cat.slice(1)}&#96;)}",
            "lineNumber": 211
          },
          {
            "text": "                  &lt;/button&gt;",
            "lineNumber": 212
          },
          {
            "text": "              );",
            "lineNumber": 213
          },
          {
            "text": "          })}",
            "lineNumber": 214
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 215
          },
          {
            "text": "  &lt;/div&gt;",
            "lineNumber": 216
          },
          {
            "text": ");",
            "lineNumber": 217
          },
          {
            "lineNumber": 218
          },
          {
            "text": "const DistributionChart = ({ data, totalFiles }",
            "lineNumber": 219
          },
          {
            "text": ";",
            "lineNumber": 245
          }
        ]
      },
      "score": 0.31841886043548584
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n                      &lt;div \n                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'copy' ? 'bg-blue-600/80' : 'bg-blue-600/50 hover:bg-blue-600/70'}&#96;}\n                      &gt;\n                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📋&lt;/div&gt;\n                        &lt;h3 className=\"text-white text-2xl font-bold mb-2\"&gt;{t('context.copyTo')}&lt;/h3&gt;\n                        &lt;p className=\"text-white/80 text-center max-w-xs\"&gt;{t('context.copyToCurrentFolder')}&lt;/p&gt;\n                      &lt;/div&gt;\n                      \n                      {/* Divider */}\n                      &lt;div className=\"w-1 bg-white/20\"&gt;&lt;/div&gt;\n                      \n                      {/* Move section */}\n                      &lt;div \n                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'move' ? 'bg-green-600/80' : 'bg-green-600/50 hover:bg-green-600/70'}&#96;}\n                      &gt;\n                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📁&lt;/div&gt;\n                        &lt;h3 className=\"text-white text-2xl font-bold mb-2\"&gt;{t('context.moveTo')}&lt;/h3&gt;\n                        &lt;p className=\"text-white/80 text-center max-w-xs\"&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "lineNumber": 4596
          },
          {
            "text": "                      &lt;div ",
            "lineNumber": 4597
          },
          {
            "text": "                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'copy' ? 'bg-blue-600/80' : 'bg-blue-600/50 hover:bg-blue-600/70'}&#96;}",
            "lineNumber": 4598
          },
          {
            "text": "                      &gt;",
            "lineNumber": 4599
          },
          {
            "text": "                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📋&lt;/div&gt;",
            "lineNumber": 4600
          },
          {
            "text": "                        &lt;h3 className=\"text-white text-2xl font-bold mb-2\"&gt;{t('context.copyTo')}&lt;/h3&gt;",
            "lineNumber": 4601
          },
          {
            "text": "                        &lt;p className=\"text-white/80 text-center max-w-xs\"&gt;{t('context.copyToCurrentFolder')}&lt;/p&gt;",
            "lineNumber": 4602
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4603
          },
          {
            "text": "                      ",
            "lineNumber": 4604
          },
          {
            "text": "                      {/* Divider */}",
            "lineNumber": 4605
          },
          {
            "text": "                      &lt;div className=\"w-1 bg-white/20\"&gt;&lt;/div&gt;",
            "lineNumber": 4606
          },
          {
            "text": "                      ",
            "lineNumber": 4607
          },
          {
            "text": "                      {/* Move section */}",
            "lineNumber": 4608
          },
          {
            "text": "                      &lt;div ",
            "lineNumber": 4609
          },
          {
            "text": "                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'move' ? 'bg-green-600/80' : 'bg-green-600/50 hover:bg-green-600/70'}&#96;}",
            "lineNumber": 4610
          },
          {
            "text": "                      &gt;",
            "lineNumber": 4611
          },
          {
            "text": "                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📁&lt;/div&gt;",
            "lineNumber": 4612
          },
          {
            "text": "                        &lt;h3 className=\"text-white text-2xl font-bold mb-2\"&gt;{t('context.moveTo')}&lt;/h3&gt;",
            "lineNumber": 4613
          },
          {
            "text": "                        &lt;p className=\"text-white/80 text-center max-w-xs\"&gt;",
            "lineNumber": 4614
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.3101300001144409
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 16,
            "column": 1
          },
          "endPosition": {
            "line": 126,
            "column": 1
          }
        },
        "contents": "const TreeNode: React.FC&lt;TreeProps&gt; = ({ files, nodeId, currentFolderId, expandedIds, onToggle, onNavigate, onContextMenu, onDrop, depth = 0 }) =&gt; {\n  const node = files[nodeId];\n  const [isDragOver, setIsDragOver] = useState(false);\n\n  if (!node || node.type !== FileType.FOLDER) return null;\n\n  const isRoot = depth === 0;\n  const isSelected = nodeId === currentFolderId;\n  const expanded = expandedIds.includes(nodeId);\n  \n  const folderChildren = node.children?.filter(childId =&gt; files[childId]?.type === FileType.FOLDER) || [];\n\n  const handleToggle = (e: React.MouseEvent) =&gt; {\n    e.stopPropagation();\n    onToggle(nodeId);\n  };\n\n  const handleClick = () =&gt; {\n    onNavigate(nodeId);\n  };\n\n  const handleContextMenu = (e: React.MouseEvent) =&gt; {\n    onContextMenu(e, isRoot ? 'root-folder' : 'file', nodeId);\n  };\n\n  const handleDragOver = (e: React.DragEvent) =&gt; {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(true);\n    e.dataTransfer.dropEffect = 'move';\n  };\n\n  const handleDragLeave = (e: React.DragEvent) =&gt; {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) =&gt; {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n    \n    const data = e.dataTransfer.getData('application/json');\n    if (data) {\n      try {\n        const sourceIds = JSON.parse(data);\n        if (Array.isArray(sourceIds) &amp;&amp; sourceIds.length &gt; 0) {\n          onDrop(nodeId, sourceIds);\n        }\n      } catch (err) {\n        console.error('Failed to parse drop data', err);\n      }\n    }\n  };\n\n  const Icon = isRoot \n    ? HardDrive \n    : (node.category === 'book' ? Book : node.category === 'sequence' ? Film : Folder);\n\n  const iconColorClass = isSelected ? 'text-white' : (\n      node.category === 'book' ? 'text-amber-500' :\n      node.category === 'sequence' ? 'text-purple-500' :\n      'text-blue-500 dark:text-blue-400'\n  );\n\n  return (\n    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const TreeNode: React.FC&lt;TreeProps&gt; = ({ files, nodeId, currentFolderId, expandedIds, onToggle, onNavigate, onContextMenu, onDrop, depth = 0 }) =&gt; {",
            "lineNumber": 19
          },
          {
            "text": "  const node = files[nodeId];",
            "lineNumber": 20
          },
          {
            "text": "  const [isDragOver, setIsDragOver] = useState(false);",
            "lineNumber": 21
          },
          {
            "lineNumber": 22
          },
          {
            "text": "  if (!node || node.type !== FileType.FOLDER) return null;",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "  const isRoot = depth === 0;",
            "lineNumber": 25
          },
          {
            "text": "  const isSelected = nodeId === currentFolderId;",
            "lineNumber": 26
          },
          {
            "text": "  const expanded = expandedIds.includes(nodeId);",
            "lineNumber": 27
          },
          {
            "text": "  ",
            "lineNumber": 28
          },
          {
            "text": "  const folderChildren = node.children?.filter(childId =&gt; files[childId]?.type === FileType.FOLDER) || [];",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "  const handleToggle = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 31
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 32
          },
          {
            "text": "    onToggle(nodeId);",
            "lineNumber": 33
          },
          {
            "text": "  };",
            "lineNumber": 34
          },
          {
            "lineNumber": 35
          },
          {
            "text": "  const handleClick = () =&gt; {",
            "lineNumber": 36
          },
          {
            "text": "    onNavigate(nodeId);",
            "lineNumber": 37
          },
          {
            "text": "  };",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "  const handleContextMenu = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 40
          },
          {
            "text": "    onContextMenu(e, isRoot ? 'root-folder' : 'file', nodeId);",
            "lineNumber": 41
          },
          {
            "text": "  };",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "  const handleDragOver = (e: React.DragEvent) =&gt; {",
            "lineNumber": 44
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 45
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 46
          },
          {
            "text": "    setIsDragOver(true);",
            "lineNumber": 47
          },
          {
            "text": "    e.dataTransfer.dropEffect = 'move';",
            "lineNumber": 48
          },
          {
            "text": "  };",
            "lineNumber": 49
          },
          {
            "lineNumber": 50
          },
          {
            "text": "  const handleDragLeave = (e: React.DragEvent) =&gt; {",
            "lineNumber": 51
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 52
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 53
          },
          {
            "text": "    setIsDragOver(false);",
            "lineNumber": 54
          },
          {
            "text": "  };",
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "  const handleDrop = (e: React.DragEvent) =&gt; {",
            "lineNumber": 57
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 58
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 59
          },
          {
            "text": "    setIsDragOver(false);",
            "lineNumber": 60
          },
          {
            "text": "    ",
            "lineNumber": 61
          },
          {
            "text": "    const data = e.dataTransfer.getData('application/json');",
            "lineNumber": 62
          },
          {
            "text": "    if (data) {",
            "lineNumber": 63
          },
          {
            "text": "      try {",
            "lineNumber": 64
          },
          {
            "text": "        const sourceIds = JSON.parse(data);",
            "lineNumber": 65
          },
          {
            "text": "        if (Array.isArray(sourceIds) &amp;&amp; sourceIds.length &gt; 0) {",
            "lineNumber": 66
          },
          {
            "text": "          onDrop(nodeId, sourceIds);",
            "lineNumber": 67
          },
          {
            "text": "        }",
            "lineNumber": 68
          },
          {
            "text": "      } catch (err) {",
            "lineNumber": 69
          },
          {
            "text": "        console.error('Failed to parse drop data', err);",
            "lineNumber": 70
          },
          {
            "text": "      }",
            "lineNumber": 71
          },
          {
            "text": "    }",
            "lineNumber": 72
          },
          {
            "text": "  };",
            "lineNumber": 73
          },
          {
            "lineNumber": 74
          },
          {
            "text": "  const Icon = isRoot ",
            "lineNumber": 75
          },
          {
            "text": "    ? HardDrive ",
            "lineNumber": 76
          },
          {
            "text": "    : (node.category === 'book' ? Book : node.category === 'sequence' ? Film : Folder);",
            "lineNumber": 77
          },
          {
            "lineNumber": 78
          },
          {
            "text": "  const iconColorClass = isSelected ? 'text-white' : (",
            "lineNumber": 79
          },
          {
            "text": "      node.category === 'book' ? 'text-amber-500' :",
            "lineNumber": 80
          },
          {
            "text": "      node.category === 'sequence' ? 'text-purple-500' :",
            "lineNumber": 81
          },
          {
            "text": "      'text-blue-500 dark:text-blue-400'",
            "lineNumber": 82
          },
          {
            "text": "  );",
            "lineNumber": 83
          },
          {
            "lineNumber": 84
          },
          {
            "text": "  return (",
            "lineNumber": 85
          },
          {
            "text": "    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300",
            "lineNumber": 86
          },
          {
            "text": ";",
            "lineNumber": 127
          }
        ]
      },
      "score": 0.3081969916820526
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nconst allDescriptions = \njoin(' ');\n                          \n                          // Extract all texts\n                          const allTexts: string[] = [];\n                          allResults.forEach(r =&gt; {\n                              if (r.translatedText) allTexts.push(r.translatedText);\n                              else if (r.extractedText) allTexts.push(r.extractedText);\n                          });\n                          \n                          // Create a coherent fallback summary\n                          if (allDescriptions) {\n                              summary += isChinese ? \n                                  &#96;本文件夹包含多张图片，主要内容是：${allDescriptions.substring(0, 500)}${allDescriptions.length &gt; 500 ? '...' : ''}&#96; :\n                                  &#96;This folder contains multiple images, with main content: ${allDescriptions.substring(0, 500)}${allDescriptions.length &gt; 500 ? '...' : ''}&#96;;\n                          }\n                          \n                          if (allTexts.length &gt; 0) {\n                              summary += isChinese ? &#96;\\n\\n提取到的文字内容：${allTexts.join('; ').substring(0, 300)}${allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96; :\n                                  &#96;\\n\\nExtracted text content: ${allTexts.join('; ').substring(0, 300)}${allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96;;\n                          }\n                      }\n                      \n                      // Update folder description with AI-generated story\n                      setState(prev =&gt; ({\n                          ...prev,\n                          files: {\n                              ...prev.files,\n                              [folderId]: {\n                                  ...prev.files[folderId],\n)\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3622
          },
          {
            "text": "const allDescriptions = ",
            "lineNumber": 4339
          },
          {
            "text": "join(' ');",
            "lineNumber": 4342
          },
          {
            "text": "                          ",
            "lineNumber": 4343
          },
          {
            "text": "                          // Extract all texts",
            "lineNumber": 4344
          },
          {
            "text": "                          const allTexts: string[] = [];",
            "lineNumber": 4345
          },
          {
            "text": "                          allResults.forEach(r =&gt; {",
            "lineNumber": 4346
          },
          {
            "text": "                              if (r.translatedText) allTexts.push(r.translatedText);",
            "lineNumber": 4347
          },
          {
            "text": "                              else if (r.extractedText) allTexts.push(r.extractedText);",
            "lineNumber": 4348
          },
          {
            "text": "                          });",
            "lineNumber": 4349
          },
          {
            "text": "                          ",
            "lineNumber": 4350
          },
          {
            "text": "                          // Create a coherent fallback summary",
            "lineNumber": 4351
          },
          {
            "text": "                          if (allDescriptions) {",
            "lineNumber": 4352
          },
          {
            "text": "                              summary += isChinese ? ",
            "lineNumber": 4353
          },
          {
            "text": "                                  &#96;本文件夹包含多张图片，主要内容是：${allDescriptions.substring(0, 500)}${allDescriptions.length &gt; 500 ? '...' : ''}&#96; :",
            "lineNumber": 4354
          },
          {
            "text": "                                  &#96;This folder contains multiple images, with main content: ${allDescriptions.substring(0, 500)}${allDescriptions.length &gt; 500 ? '...' : ''}&#96;;",
            "lineNumber": 4355
          },
          {
            "text": "                          }",
            "lineNumber": 4356
          },
          {
            "text": "                          ",
            "lineNumber": 4357
          },
          {
            "text": "                          if (allTexts.length &gt; 0) {",
            "lineNumber": 4358
          },
          {
            "text": "                              summary += isChinese ? &#96;\\n\\n提取到的文字内容：${allTexts.join('; ').substring(0, 300)}${allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96; :",
            "lineNumber": 4359
          },
          {
            "text": "                                  &#96;\\n\\nExtracted text content: ${allTexts.join('; ').substring(0, 300)}${allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96;;",
            "lineNumber": 4360
          },
          {
            "text": "                          }",
            "lineNumber": 4361
          },
          {
            "text": "                      }",
            "lineNumber": 4362
          },
          {
            "text": "                      ",
            "lineNumber": 4363
          },
          {
            "text": "                      // Update folder description with AI-generated story",
            "lineNumber": 4364
          },
          {
            "text": "                      setState(prev =&gt; ({",
            "lineNumber": 4365
          },
          {
            "text": "                          ...prev,",
            "lineNumber": 4366
          },
          {
            "text": "                          files: {",
            "lineNumber": 4367
          },
          {
            "text": "                              ...prev.files,",
            "lineNumber": 4368
          },
          {
            "text": "                              [folderId]: {",
            "lineNumber": 4369
          },
          {
            "text": "                                  ...prev.files[folderId],",
            "lineNumber": 4370
          },
          {
            "text": ")",
            "lineNumber": 4374
          },
          {
            "text": ";",
            "lineNumber": 4388
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.3064589500427246
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1477
          },
          "endPosition": {
            "line": 1958,
            "column": 1
          }
        },
        "contents": "export const FileGrid: React.FC&lt;FileGridProps&gt; = \n\n  onBackgroundContextMenu,\n  people,\n  groupedTags,\n  onPersonClick,\n  onPersonContextMenu,\n  onPersonDoubleClick,\n  onStartRenamePerson,\n  onTagClick,\n  onTagContextMenu,\n  onTagDoubleClick,\n  groupedFiles = [],\n  groupBy = 'none',\n  collapsedGroups = {},\n  onToggleGroup,\n  isSelecting,\n  selectionBox,\n  t,\n  onThumbnailSizeChange,\n  onUpdateFile,\n  settings,\n  onScrollTopChange\n}) =&gt; {\n  // #region agent log\n  // Removed debug logs\n  // #endregion\n\n  const [dragTargetId, setDragTargetId] = useState&lt;string | null&gt;(null);\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const FileGrid: React.FC&lt;FileGridProps&gt; = ",
            "lineNumber": 1478
          },
          {
            "lineNumber": 1501
          },
          {
            "text": "  onBackgroundContextMenu,",
            "lineNumber": 1502
          },
          {
            "text": "  people,",
            "lineNumber": 1503
          },
          {
            "text": "  groupedTags,",
            "lineNumber": 1504
          },
          {
            "text": "  onPersonClick,",
            "lineNumber": 1505
          },
          {
            "text": "  onPersonContextMenu,",
            "lineNumber": 1506
          },
          {
            "text": "  onPersonDoubleClick,",
            "lineNumber": 1507
          },
          {
            "text": "  onStartRenamePerson,",
            "lineNumber": 1508
          },
          {
            "text": "  onTagClick,",
            "lineNumber": 1509
          },
          {
            "text": "  onTagContextMenu,",
            "lineNumber": 1510
          },
          {
            "text": "  onTagDoubleClick,",
            "lineNumber": 1511
          },
          {
            "text": "  groupedFiles = [],",
            "lineNumber": 1512
          },
          {
            "text": "  groupBy = 'none',",
            "lineNumber": 1513
          },
          {
            "text": "  collapsedGroups = {},",
            "lineNumber": 1514
          },
          {
            "text": "  onToggleGroup,",
            "lineNumber": 1515
          },
          {
            "text": "  isSelecting,",
            "lineNumber": 1516
          },
          {
            "text": "  selectionBox,",
            "lineNumber": 1517
          },
          {
            "text": "  t,",
            "lineNumber": 1518
          },
          {
            "text": "  onThumbnailSizeChange,",
            "lineNumber": 1519
          },
          {
            "text": "  onUpdateFile,",
            "lineNumber": 1520
          },
          {
            "text": "  settings,",
            "lineNumber": 1521
          },
          {
            "text": "  onScrollTopChange",
            "lineNumber": 1522
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 1523
          },
          {
            "text": "  // #region agent log",
            "lineNumber": 1524
          },
          {
            "text": "  // Removed debug logs",
            "lineNumber": 1525
          },
          {
            "text": "  // #endregion",
            "lineNumber": 1526
          },
          {
            "lineNumber": 1527
          },
          {
            "text": "  const [dragTargetId, setDragTargetId] = useState&lt;string | null&gt;(null);",
            "lineNumber": 1528
          },
          {
            "text": ";",
            "lineNumber": 1959
          }
        ]
      },
      "score": 0.30590370297431946
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 40
          },
          "endPosition": {
            "line": 105,
            "column": 1
          }
        },
        "contents": "const ClearPersonModal = \n\"&gt; \n        {peopleList.map((p: Person) =&gt; { \n          const coverFile = files[p.coverFileId]; \n          const hasCover = !!coverFile; \n          const isSelected = selectedPeople.includes(p.id); \n          return ( \n            &lt;div key={p.id} onClick={() =&gt; handleTogglePerson(p.id)} className={&#96;flex items-center p-2 rounded cursor-pointer group ${isSelected ? 'bg-blue-50 dark:bg-blue-900/30 border-l-2 border-blue-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}&#96;}&gt; \n              &lt;div className=\"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 overflow-hidden mr-3 flex items-center justify-center\"&gt;\n                {hasCover ? (/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */&lt;div className=\"w-full h-full flex items-center justify-center bg-gray-300 dark:bg-gray-700\"&gt;&lt;User size={14} className=\"text-gray-400 dark:text-gray-500\" /&gt;&lt;/div&gt;) : (\n                  &lt;User size={14} className=\"text-gray-400 dark:text-gray-500\" /&gt;\n                )}\n              &lt;/div&gt; \n              &lt;span className=\"text-sm text-gray-800 dark:text-gray-200 flex-1\"&gt;{p.name}&lt;/span&gt; \n              &lt;div className={&#96;w-4 h-4 rounded border-2 flex items-center justify-center ${isSelected ? 'border-blue-500 bg-blue-500' : 'border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800'}&#96;}&gt; \n                {isSelected &amp;&amp; &lt;Check size={12} className=\"text-white\" /&gt;} \n              &lt;/div&gt; \n            &lt;/div&gt; \n          ); \n        })}\n      &lt;/div&gt; \n      &lt;div className=\"flex justify-end space-x-2\"&gt; \n        &lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;{t('settings.cancel')}&lt;/button&gt; \n        \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 41,
                "column": 1
              },
              "endPosition": {
                "line": 41,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 41,
                "column": 7
              },
              "endPosition": {
                "line": 41,
                "column": 26
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const ClearPersonModal = ",
            "lineNumber": 41
          },
          {
            "text": "\"&gt; ",
            "lineNumber": 80
          },
          {
            "text": "        {peopleList.map((p: Person) =&gt; { ",
            "lineNumber": 81
          },
          {
            "text": "          const coverFile = files[p.coverFileId]; ",
            "lineNumber": 82
          },
          {
            "text": "          const hasCover = !!coverFile; ",
            "lineNumber": 83
          },
          {
            "text": "          const isSelected = selectedPeople.includes(p.id); ",
            "lineNumber": 84
          },
          {
            "text": "          return ( ",
            "lineNumber": 85
          },
          {
            "text": "            &lt;div key={p.id} onClick={() =&gt; handleTogglePerson(p.id)} className={&#96;flex items-center p-2 rounded cursor-pointer group ${isSelected ? 'bg-blue-50 dark:bg-blue-900/30 border-l-2 border-blue-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}&#96;}&gt; ",
            "lineNumber": 86
          },
          {
            "text": "              &lt;div className=\"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 overflow-hidden mr-3 flex items-center justify-center\"&gt;",
            "lineNumber": 87
          },
          {
            "text": "                {hasCover ? (/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */&lt;div className=\"w-full h-full flex items-center justify-center bg-gray-300 dark:bg-gray-700\"&gt;&lt;User size={14} className=\"text-gray-400 dark:text-gray-500\" /&gt;&lt;/div&gt;) : (",
            "lineNumber": 88
          },
          {
            "text": "                  &lt;User size={14} className=\"text-gray-400 dark:text-gray-500\" /&gt;",
            "lineNumber": 89
          },
          {
            "text": "                )}",
            "lineNumber": 90
          },
          {
            "text": "              &lt;/div&gt; ",
            "lineNumber": 91
          },
          {
            "text": "              &lt;span className=\"text-sm text-gray-800 dark:text-gray-200 flex-1\"&gt;{p.name}&lt;/span&gt; ",
            "lineNumber": 92
          },
          {
            "text": "              &lt;div className={&#96;w-4 h-4 rounded border-2 flex items-center justify-center ${isSelected ? 'border-blue-500 bg-blue-500' : 'border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800'}&#96;}&gt; ",
            "lineNumber": 93
          },
          {
            "text": "                {isSelected &amp;&amp; &lt;Check size={12} className=\"text-white\" /&gt;} ",
            "lineNumber": 94
          },
          {
            "text": "              &lt;/div&gt; ",
            "lineNumber": 95
          },
          {
            "text": "            &lt;/div&gt; ",
            "lineNumber": 96
          },
          {
            "text": "          ); ",
            "lineNumber": 97
          },
          {
            "text": "        })}",
            "lineNumber": 98
          },
          {
            "text": "      &lt;/div&gt; ",
            "lineNumber": 99
          },
          {
            "text": "      &lt;div className=\"flex justify-end space-x-2\"&gt; ",
            "lineNumber": 100
          },
          {
            "text": "        &lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;{t('settings.cancel')}&lt;/button&gt; ",
            "lineNumber": 101
          },
          {
            "text": "        ",
            "lineNumber": 102
          },
          {
            "text": ";",
            "lineNumber": 106
          }
        ]
      },
      "score": 0.3030005991458893
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nprev =&gt; (\n,\n                              [folderId]: {\n                                  ...prev.files[folderId],\n                                  description: summary\n                              }\n                          }\n                      }));\n                  }\n              }\n          }\n          \n          showToast(t('settings.aiAnalyzeSuccess'));\n\n      }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3622
          },
          {
            "text": "prev =&gt; (",
            "lineNumber": 4365
          },
          {
            "text": ",",
            "lineNumber": 4368
          },
          {
            "text": "                              [folderId]: {",
            "lineNumber": 4369
          },
          {
            "text": "                                  ...prev.files[folderId],",
            "lineNumber": 4370
          },
          {
            "text": "                                  description: summary",
            "lineNumber": 4371
          },
          {
            "text": "                              }",
            "lineNumber": 4372
          },
          {
            "text": "                          }",
            "lineNumber": 4373
          },
          {
            "text": "                      }));",
            "lineNumber": 4374
          },
          {
            "text": "                  }",
            "lineNumber": 4375
          },
          {
            "text": "              }",
            "lineNumber": 4376
          },
          {
            "text": "          }",
            "lineNumber": 4377
          },
          {
            "text": "          ",
            "lineNumber": 4378
          },
          {
            "text": "          showToast(t('settings.aiAnalyzeSuccess'));",
            "lineNumber": 4379
          },
          {
            "lineNumber": 4380
          },
          {
            "text": "      }",
            "lineNumber": 4381
          },
          {
            "text": ";",
            "lineNumber": 4388
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.3017663061618805
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\n\n                              t={t}\n                          /&gt;\n                      );\n                  }\n\n                  return (\n                      &lt;ImageViewer\n                          file={state.files[activeTab.viewingFileId]}\n                          sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)} \n                          files={state.files}\n                          layout={state.layout}\n                          slideshowConfig={state.slideshowConfig}\n                          onLayoutToggle={(part) =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, [part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible']: !s.layout[part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible'] } }))}\n                          onClose={closeViewer}\n                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}\n                          onPrev={() =&gt; handleViewerNavigate('prev')}\n                          onNavigateBack={goBack}\n                          onNavigateForward={goForward}\n                          canGoBack={activeTab.history.currentIndex &gt; 0}\n                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}\n                          onDelete={(id) =&gt; requestDelete([id])}\n                          onViewInExplorer={handleViewInExplorer}\n                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}\n                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}\n                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}\n                          searchQuery={activeTab.searchQuery}\n                          onSearch={handleViewerSearch}\n                          searchScope={activeTab.searchScope}\n                          onSearchScopeChange=\n              }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4453
          },
          {
            "lineNumber": 4468
          },
          {
            "text": "                              t={t}",
            "lineNumber": 4469
          },
          {
            "text": "                          /&gt;",
            "lineNumber": 4470
          },
          {
            "text": "                      );",
            "lineNumber": 4471
          },
          {
            "text": "                  }",
            "lineNumber": 4472
          },
          {
            "lineNumber": 4473
          },
          {
            "text": "                  return (",
            "lineNumber": 4474
          },
          {
            "text": "                      &lt;ImageViewer",
            "lineNumber": 4475
          },
          {
            "text": "                          file={state.files[activeTab.viewingFileId]}",
            "lineNumber": 4476
          },
          {
            "text": "                          sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)} ",
            "lineNumber": 4477
          },
          {
            "text": "                          files={state.files}",
            "lineNumber": 4478
          },
          {
            "text": "                          layout={state.layout}",
            "lineNumber": 4479
          },
          {
            "text": "                          slideshowConfig={state.slideshowConfig}",
            "lineNumber": 4480
          },
          {
            "text": "                          onLayoutToggle={(part) =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, [part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible']: !s.layout[part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible'] } }))}",
            "lineNumber": 4481
          },
          {
            "text": "                          onClose={closeViewer}",
            "lineNumber": 4482
          },
          {
            "text": "                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}",
            "lineNumber": 4483
          },
          {
            "text": "                          onPrev={() =&gt; handleViewerNavigate('prev')}",
            "lineNumber": 4484
          },
          {
            "text": "                          onNavigateBack={goBack}",
            "lineNumber": 4485
          },
          {
            "text": "                          onNavigateForward={goForward}",
            "lineNumber": 4486
          },
          {
            "text": "                          canGoBack={activeTab.history.currentIndex &gt; 0}",
            "lineNumber": 4487
          },
          {
            "text": "                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}",
            "lineNumber": 4488
          },
          {
            "text": "                          onDelete={(id) =&gt; requestDelete([id])}",
            "lineNumber": 4489
          },
          {
            "text": "                          onViewInExplorer={handleViewInExplorer}",
            "lineNumber": 4490
          },
          {
            "text": "                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4491
          },
          {
            "text": "                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4492
          },
          {
            "text": "                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}",
            "lineNumber": 4493
          },
          {
            "text": "                          searchQuery={activeTab.searchQuery}",
            "lineNumber": 4494
          },
          {
            "text": "                          onSearch={handleViewerSearch}",
            "lineNumber": 4495
          },
          {
            "text": "                          searchScope={activeTab.searchScope}",
            "lineNumber": 4496
          },
          {
            "text": "                          onSearchScopeChange=",
            "lineNumber": 4497
          },
          {
            "text": "              }",
            "lineNumber": 4509
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.29983028769493103
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 246
          },
          "endPosition": {
            "line": 1381,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \n&lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/&gt;\n                    )}\n                    &lt;div&gt;\n                        &lt;div className=\"text-xs text-gray-500 dark:text-gray-500 mb-0.5 flex items-center\"&gt;&lt;Calendar size={10} className=\"mr-1\"/&gt; {t('meta.created')}&lt;/div&gt;\n                        &lt;div className=\"text-xs text-gray-800 dark:text-gray-200 font-mono\"&gt;{file.createdAt ? new Date(file.createdAt).toLocaleDateString() : '-'}&lt;/div&gt;\n                    &lt;/div&gt;\n                    &lt;div&gt;\n                        &lt;div className=\"text-xs text-gray-500 dark:text-gray-500 mb-0.5 flex items-center\"&gt;&lt;Clock size={10} className=\"mr-1\"/&gt; {t('meta.updated')}&lt;/div&gt;\n                        &lt;div className=\"text-xs text-gray-800 dark:text-gray-200 font-mono\"&gt;{file.updatedAt ? new Date(file.updatedAt).toLocaleString() : '-'}&lt;/div&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n        )}\n\n        {/* Folder Category Selector */}\n        {((file &amp;&amp; file.type === FileType.FOLDER) || (isMulti &amp;&amp; selectedFileIds.every(id =&gt; files[id]?.type === FileType.FOLDER))) &amp;&amp; (\n            &lt;CategorySelector \n                current={file ? file.category : (selectedFileIds.every(id =&gt; files[id]?.category === 'book') ? 'book' : 'general')}\n                onChange={handleCategoryChange}\n                t={t}\n            /&gt;\n        )}\n\n        {/* Tags Section */}\n        {!isMulti &amp;&amp; file &amp;&amp; file.type !== FileType.FOLDER &amp;&amp; (\n            &lt;div&gt;\n                &lt;div className=\"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 flex items-center\"&gt;\n                    &lt;Tag size={12} className=\"mr-1.5\"/&gt; {t('meta.tags')}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 247
          },
          {
            "text": "&lt;/div&gt;",
            "lineNumber": 1163
          },
          {
            "text": "                            &lt;/div&gt;",
            "lineNumber": 1164
          },
          {
            "text": "                        &lt;/&gt;",
            "lineNumber": 1165
          },
          {
            "text": "                    )}",
            "lineNumber": 1166
          },
          {
            "text": "                    &lt;div&gt;",
            "lineNumber": 1167
          },
          {
            "text": "                        &lt;div className=\"text-xs text-gray-500 dark:text-gray-500 mb-0.5 flex items-center\"&gt;&lt;Calendar size={10} className=\"mr-1\"/&gt; {t('meta.created')}&lt;/div&gt;",
            "lineNumber": 1168
          },
          {
            "text": "                        &lt;div className=\"text-xs text-gray-800 dark:text-gray-200 font-mono\"&gt;{file.createdAt ? new Date(file.createdAt).toLocaleDateString() : '-'}&lt;/div&gt;",
            "lineNumber": 1169
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 1170
          },
          {
            "text": "                    &lt;div&gt;",
            "lineNumber": 1171
          },
          {
            "text": "                        &lt;div className=\"text-xs text-gray-500 dark:text-gray-500 mb-0.5 flex items-center\"&gt;&lt;Clock size={10} className=\"mr-1\"/&gt; {t('meta.updated')}&lt;/div&gt;",
            "lineNumber": 1172
          },
          {
            "text": "                        &lt;div className=\"text-xs text-gray-800 dark:text-gray-200 font-mono\"&gt;{file.updatedAt ? new Date(file.updatedAt).toLocaleString() : '-'}&lt;/div&gt;",
            "lineNumber": 1173
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 1174
          },
          {
            "text": "                &lt;/div&gt;",
            "lineNumber": 1175
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 1176
          },
          {
            "text": "        )}",
            "lineNumber": 1177
          },
          {
            "lineNumber": 1178
          },
          {
            "text": "        {/* Folder Category Selector */}",
            "lineNumber": 1179
          },
          {
            "text": "        {((file &amp;&amp; file.type === FileType.FOLDER) || (isMulti &amp;&amp; selectedFileIds.every(id =&gt; files[id]?.type === FileType.FOLDER))) &amp;&amp; (",
            "lineNumber": 1180
          },
          {
            "text": "            &lt;CategorySelector ",
            "lineNumber": 1181
          },
          {
            "text": "                current={file ? file.category : (selectedFileIds.every(id =&gt; files[id]?.category === 'book') ? 'book' : 'general')}",
            "lineNumber": 1182
          },
          {
            "text": "                onChange={handleCategoryChange}",
            "lineNumber": 1183
          },
          {
            "text": "                t={t}",
            "lineNumber": 1184
          },
          {
            "text": "            /&gt;",
            "lineNumber": 1185
          },
          {
            "text": "        )}",
            "lineNumber": 1186
          },
          {
            "lineNumber": 1187
          },
          {
            "text": "        {/* Tags Section */}",
            "lineNumber": 1188
          },
          {
            "text": "        {!isMulti &amp;&amp; file &amp;&amp; file.type !== FileType.FOLDER &amp;&amp; (",
            "lineNumber": 1189
          },
          {
            "text": "            &lt;div&gt;",
            "lineNumber": 1190
          },
          {
            "text": "                &lt;div className=\"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 flex items-center\"&gt;",
            "lineNumber": 1191
          },
          {
            "text": "                    &lt;Tag size={12} className=\"mr-1.5\"/&gt; {t('meta.tags')}",
            "lineNumber": 1192
          },
          {
            "text": ";",
            "lineNumber": 1382
          }
        ]
      },
      "score": 0.29520630836486816
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 512
          },
          "endPosition": {
            "line": 679,
            "column": 1
          }
        },
        "contents": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {\nconst handleMouseEnter = (e: React.MouseEvent, tag: string) =&gt; {\n\n    \n    hoverTimerRef.current = setTimeout(() =&gt; {\n      const rect = target.getBoundingClientRect();\n      const PREVIEW_WIDTH = 256; \n      const PREVIEW_HEIGHT = 120;\n      \n      let left = rect.left + (rect.width / 2) - (PREVIEW_WIDTH / 2);\n      let top = rect.bottom + 10;\n\n      if (left &lt; 10) left = 10;\n      if (left + PREVIEW_WIDTH &gt; window.innerWidth) left = window.innerWidth - PREVIEW_WIDTH - 10;\n      if (top + PREVIEW_HEIGHT &gt; window.innerHeight) top = rect.top - PREVIEW_HEIGHT - 10;\n\n      setHoveredTagPos({ top, left });\n      setHoveredTag(tag);\n    }, 600);\n  }, []);\n\n  const handleMouseLeave = useCallback(() =&gt; {\n    if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);\n    setHoveredTag(null);\n    setHoveredTagPos(null);\n  }, []);\n\n  return (\n    &lt;div className=\"relative\"&gt;\n      {/* 字母索引栏 */}\n      {keys.length &gt; 0 &amp;&amp; (\n        &lt;div className=\"fixed top-1/2 transform -translate-y-1/2 z-20 bg-white/80 dark:bg-gray-950/80 backdrop-blur-sm rounded-full px-1 py-2 shadow-md border border-gray-200 dark:border-gray-800 transition-all duration-300\"\n             style={{ \n               right: 'calc(20px + var(--metadata-panel-width, 0px))',\n               transform: 'translateY(-50%) translateY(10px)' // 向下调整10px，使其居中\n             }}\n             onMouseEnter={() =&gt; {\n              // 鼠标悬停时，确保索引栏显示在最前面\n              const metadataPanel = document.querySelector('.metadata-panel-container') as HTMLElement | null;\n              if (metadataPanel) {\n                metadataPanel.style.zIndex = '10';\n              }\n            }}\n            onMouseLeave={() =&gt; {\n              // 鼠标离开时，恢复详情面板的z-index\n              const metadataPanel = document.querySelector('.metadata-panel-container');\n            }\n}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 498,
                "column": 17
              },
              "endPosition": {
                "line": 499,
                "column": 13
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {",
            "lineNumber": 513
          },
          {
            "text": "const handleMouseEnter = (e: React.MouseEvent, tag: string) =&gt; {",
            "lineNumber": 538
          },
          {
            "lineNumber": 540
          },
          {
            "text": "    ",
            "lineNumber": 541
          },
          {
            "text": "    hoverTimerRef.current = setTimeout(() =&gt; {",
            "lineNumber": 542
          },
          {
            "text": "      const rect = target.getBoundingClientRect();",
            "lineNumber": 543
          },
          {
            "text": "      const PREVIEW_WIDTH = 256; ",
            "lineNumber": 544
          },
          {
            "text": "      const PREVIEW_HEIGHT = 120;",
            "lineNumber": 545
          },
          {
            "text": "      ",
            "lineNumber": 546
          },
          {
            "text": "      let left = rect.left + (rect.width / 2) - (PREVIEW_WIDTH / 2);",
            "lineNumber": 547
          },
          {
            "text": "      let top = rect.bottom + 10;",
            "lineNumber": 548
          },
          {
            "lineNumber": 549
          },
          {
            "text": "      if (left &lt; 10) left = 10;",
            "lineNumber": 550
          },
          {
            "text": "      if (left + PREVIEW_WIDTH &gt; window.innerWidth) left = window.innerWidth - PREVIEW_WIDTH - 10;",
            "lineNumber": 551
          },
          {
            "text": "      if (top + PREVIEW_HEIGHT &gt; window.innerHeight) top = rect.top - PREVIEW_HEIGHT - 10;",
            "lineNumber": 552
          },
          {
            "lineNumber": 553
          },
          {
            "text": "      setHoveredTagPos({ top, left });",
            "lineNumber": 554
          },
          {
            "text": "      setHoveredTag(tag);",
            "lineNumber": 555
          },
          {
            "text": "    }, 600);",
            "lineNumber": 556
          },
          {
            "text": "  }, []);",
            "lineNumber": 557
          },
          {
            "lineNumber": 558
          },
          {
            "text": "  const handleMouseLeave = useCallback(() =&gt; {",
            "lineNumber": 559
          },
          {
            "text": "    if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);",
            "lineNumber": 560
          },
          {
            "text": "    setHoveredTag(null);",
            "lineNumber": 561
          },
          {
            "text": "    setHoveredTagPos(null);",
            "lineNumber": 562
          },
          {
            "text": "  }, []);",
            "lineNumber": 563
          },
          {
            "lineNumber": 564
          },
          {
            "text": "  return (",
            "lineNumber": 565
          },
          {
            "text": "    &lt;div className=\"relative\"&gt;",
            "lineNumber": 566
          },
          {
            "text": "      {/* 字母索引栏 */}",
            "lineNumber": 567
          },
          {
            "text": "      {keys.length &gt; 0 &amp;&amp; (",
            "lineNumber": 568
          },
          {
            "text": "        &lt;div className=\"fixed top-1/2 transform -translate-y-1/2 z-20 bg-white/80 dark:bg-gray-950/80 backdrop-blur-sm rounded-full px-1 py-2 shadow-md border border-gray-200 dark:border-gray-800 transition-all duration-300\"",
            "lineNumber": 569
          },
          {
            "text": "             style={{ ",
            "lineNumber": 570
          },
          {
            "text": "               right: 'calc(20px + var(--metadata-panel-width, 0px))',",
            "lineNumber": 571
          },
          {
            "text": "               transform: 'translateY(-50%) translateY(10px)' // 向下调整10px，使其居中",
            "lineNumber": 572
          },
          {
            "text": "             }}",
            "lineNumber": 573
          },
          {
            "text": "             onMouseEnter={() =&gt; {",
            "lineNumber": 574
          },
          {
            "text": "              // 鼠标悬停时，确保索引栏显示在最前面",
            "lineNumber": 575
          },
          {
            "text": "              const metadataPanel = document.querySelector('.metadata-panel-container') as HTMLElement | null;",
            "lineNumber": 576
          },
          {
            "text": "              if (metadataPanel) {",
            "lineNumber": 577
          },
          {
            "text": "                metadataPanel.style.zIndex = '10';",
            "lineNumber": 578
          },
          {
            "text": "              }",
            "lineNumber": 579
          },
          {
            "text": "            }}",
            "lineNumber": 580
          },
          {
            "text": "            onMouseLeave={() =&gt; {",
            "lineNumber": 581
          },
          {
            "text": "              // 鼠标离开时，恢复详情面板的z-index",
            "lineNumber": 582
          },
          {
            "text": "              const metadataPanel = document.querySelector('.metadata-panel-container');",
            "lineNumber": 583
          },
          {
            "text": "            }",
            "lineNumber": 587
          },
          {
            "text": "}",
            "lineNumber": 675
          },
          {
            "text": ";",
            "lineNumber": 680
          }
        ]
      },
      "score": 0.2935400903224945
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 18
          },
          "endPosition": {
            "line": 137,
            "column": 1
          }
        },
        "contents": "const TreeNode: React.FC&lt;TreeProps&gt; = \n\n\n  return (\n    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300\"&gt;\n      &lt;div \n        className={&#96;flex items-center py-1 px-2 cursor-pointer transition-colors border border-transparent group relative\n          ${isSelected ? 'bg-blue-600 text-white border-l-4 border-blue-300 shadow-md' : 'hover:bg-gray-200 dark:hover:bg-gray-800'}\n          ${isDragOver ? 'bg-blue-100 dark:bg-blue-900 border-blue-500 dark:border-blue-400' : ''}\n        &#96;}\n        style={{ paddingLeft: &#96;${depth * 12 + 8}px&#96; }}\n        onClick={handleClick}\n        onContextMenu={handleContextMenu}\n        onDragOver={handleDragOver}\n        onDragLeave={handleDragLeave}\n        onDrop={handleDrop}\n      &gt;\n        &lt;div \n          className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\"\n          onClick={handleToggle}\n        &gt;\n          {folderChildren.length &gt; 0 ? (\n            expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;\n          ) : &lt;div className=\"w-[14px]\" /&gt;}\n        &lt;/div&gt;\n        &lt;Icon size={16} className={&#96;mr-2 ${iconColorClass}&#96;} /&gt;\n        &lt;span className=\"truncate pointer-events-none flex-1\"&gt;{node.name}&lt;/span&gt;\n      &lt;/div&gt;\n\n      {expanded &amp;&amp; folderChildren.map(childId =&gt; (\n        &lt;TreeNode \n          key={childId}\n          files={files}\n          nodeId={childId}\n          currentFolderId={currentFolderId}\n          expandedIds={expandedIds}\n          onToggle={onToggle}\n          onNavigate={onNavigate}\n          onContextMenu={onContextMenu}\n          onDrop={onDrop}\n          depth={depth + 1}\n        /&gt;\n      ))}\n    &lt;/div&gt;\n  );\n};\n\ninterface PeopleSectionProps {\n  people: Record&lt;string, Person&gt;;\n;\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 19,
                "column": 1
              },
              "endPosition": {
                "line": 19,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 19,
                "column": 7
              },
              "endPosition": {
                "line": 19,
                "column": 39
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TreeNode: React.FC&lt;TreeProps&gt; = ",
            "lineNumber": 19
          },
          {
            "lineNumber": 83
          },
          {
            "lineNumber": 84
          },
          {
            "text": "  return (",
            "lineNumber": 85
          },
          {
            "text": "    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300\"&gt;",
            "lineNumber": 86
          },
          {
            "text": "      &lt;div ",
            "lineNumber": 87
          },
          {
            "text": "        className={&#96;flex items-center py-1 px-2 cursor-pointer transition-colors border border-transparent group relative",
            "lineNumber": 88
          },
          {
            "text": "          ${isSelected ? 'bg-blue-600 text-white border-l-4 border-blue-300 shadow-md' : 'hover:bg-gray-200 dark:hover:bg-gray-800'}",
            "lineNumber": 89
          },
          {
            "text": "          ${isDragOver ? 'bg-blue-100 dark:bg-blue-900 border-blue-500 dark:border-blue-400' : ''}",
            "lineNumber": 90
          },
          {
            "text": "        &#96;}",
            "lineNumber": 91
          },
          {
            "text": "        style={{ paddingLeft: &#96;${depth * 12 + 8}px&#96; }}",
            "lineNumber": 92
          },
          {
            "text": "        onClick={handleClick}",
            "lineNumber": 93
          },
          {
            "text": "        onContextMenu={handleContextMenu}",
            "lineNumber": 94
          },
          {
            "text": "        onDragOver={handleDragOver}",
            "lineNumber": 95
          },
          {
            "text": "        onDragLeave={handleDragLeave}",
            "lineNumber": 96
          },
          {
            "text": "        onDrop={handleDrop}",
            "lineNumber": 97
          },
          {
            "text": "      &gt;",
            "lineNumber": 98
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 99
          },
          {
            "text": "          className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\"",
            "lineNumber": 100
          },
          {
            "text": "          onClick={handleToggle}",
            "lineNumber": 101
          },
          {
            "text": "        &gt;",
            "lineNumber": 102
          },
          {
            "text": "          {folderChildren.length &gt; 0 ? (",
            "lineNumber": 103
          },
          {
            "text": "            expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;",
            "lineNumber": 104
          },
          {
            "text": "          ) : &lt;div className=\"w-[14px]\" /&gt;}",
            "lineNumber": 105
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 106
          },
          {
            "text": "        &lt;Icon size={16} className={&#96;mr-2 ${iconColorClass}&#96;} /&gt;",
            "lineNumber": 107
          },
          {
            "text": "        &lt;span className=\"truncate pointer-events-none flex-1\"&gt;{node.name}&lt;/span&gt;",
            "lineNumber": 108
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 109
          },
          {
            "lineNumber": 110
          },
          {
            "text": "      {expanded &amp;&amp; folderChildren.map(childId =&gt; (",
            "lineNumber": 111
          },
          {
            "text": "        &lt;TreeNode ",
            "lineNumber": 112
          },
          {
            "text": "          key={childId}",
            "lineNumber": 113
          },
          {
            "text": "          files={files}",
            "lineNumber": 114
          },
          {
            "text": "          nodeId={childId}",
            "lineNumber": 115
          },
          {
            "text": "          currentFolderId={currentFolderId}",
            "lineNumber": 116
          },
          {
            "text": "          expandedIds={expandedIds}",
            "lineNumber": 117
          },
          {
            "text": "          onToggle={onToggle}",
            "lineNumber": 118
          },
          {
            "text": "          onNavigate={onNavigate}",
            "lineNumber": 119
          },
          {
            "text": "          onContextMenu={onContextMenu}",
            "lineNumber": 120
          },
          {
            "text": "          onDrop={onDrop}",
            "lineNumber": 121
          },
          {
            "text": "          depth={depth + 1}",
            "lineNumber": 122
          },
          {
            "text": "        /&gt;",
            "lineNumber": 123
          },
          {
            "text": "      ))}",
            "lineNumber": 124
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 125
          },
          {
            "text": "  );",
            "lineNumber": 126
          },
          {
            "text": "};",
            "lineNumber": 127
          },
          {
            "lineNumber": 128
          },
          {
            "text": "interface PeopleSectionProps {",
            "lineNumber": 129,
            "isSignature": true
          },
          {
            "text": "  people: Record&lt;string, Person&gt;;",
            "lineNumber": 130
          },
          {
            "text": ";",
            "lineNumber": 137,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 138,
            "isSignature": true
          }
        ]
      },
      "score": 0.2909952402114868
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\types.ts",
        "range": {
          "startPosition": {
            "line": 183
          },
          "endPosition": {
            "line": 216,
            "column": 1
          }
        },
        "contents": "export interface HistoryItem {\n;\n  viewMode: 'browser' | 'tags-overview' | 'people-overview';\n  searchQuery: string;\n  searchScope: SearchScope;\n  activeTags: string[];\n  activePersonId: string | null;\n  aiFilter?: AiSearchFilter | null;\n  scrollTop?: number;\n}\n\nexport interface TabState {\n  id: string;\n  folderId: string;\n  viewingFileId: string | null;\n  viewMode: 'browser' | 'tags-overview' | 'people-overview'; \n  layoutMode: LayoutMode;\n  searchQuery: string;\n  searchScope: SearchScope;\n  aiFilter?: AiSearchFilter | null;\n  activeTags: string[];\n  activePersonId: string | null;\n  dateFilter: DateFilter;\n  selectedFileIds: string[];\n  lastSelectedId: string | null;\n  selectedTagIds: string[];\n  selectedPersonIds: string[];\n;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export interface HistoryItem {",
            "lineNumber": 184,
            "isSignature": true
          },
          {
            "text": ";",
            "lineNumber": 186
          },
          {
            "text": "  viewMode: 'browser' | 'tags-overview' | 'people-overview';",
            "lineNumber": 187
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 188
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 189
          },
          {
            "text": "  activeTags: string[];",
            "lineNumber": 190
          },
          {
            "text": "  activePersonId: string | null;",
            "lineNumber": 191
          },
          {
            "text": "  aiFilter?: AiSearchFilter | null;",
            "lineNumber": 192
          },
          {
            "text": "  scrollTop?: number;",
            "lineNumber": 193,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 194,
            "isSignature": true
          },
          {
            "lineNumber": 195
          },
          {
            "text": "export interface TabState {",
            "lineNumber": 196,
            "isSignature": true
          },
          {
            "text": "  id: string;",
            "lineNumber": 197
          },
          {
            "text": "  folderId: string;",
            "lineNumber": 198
          },
          {
            "text": "  viewingFileId: string | null;",
            "lineNumber": 199
          },
          {
            "text": "  viewMode: 'browser' | 'tags-overview' | 'people-overview'; ",
            "lineNumber": 200
          },
          {
            "text": "  layoutMode: LayoutMode;",
            "lineNumber": 201
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 202
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 203
          },
          {
            "text": "  aiFilter?: AiSearchFilter | null;",
            "lineNumber": 204
          },
          {
            "text": "  activeTags: string[];",
            "lineNumber": 205
          },
          {
            "text": "  activePersonId: string | null;",
            "lineNumber": 206
          },
          {
            "text": "  dateFilter: DateFilter;",
            "lineNumber": 207
          },
          {
            "text": "  selectedFileIds: string[];",
            "lineNumber": 208
          },
          {
            "text": "  lastSelectedId: string | null;",
            "lineNumber": 209
          },
          {
            "text": "  selectedTagIds: string[];",
            "lineNumber": 210
          },
          {
            "text": "  selectedPersonIds: string[];",
            "lineNumber": 211
          },
          {
            "text": ";",
            "lineNumber": 216,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 217,
            "isSignature": true
          }
        ]
      },
      "score": 0.28668975830078125
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 107
          },
          "endPosition": {
            "line": 253,
            "column": 1
          }
        },
        "contents": "const FolderPickerModal = \nconst findMatchingFolders =  {\n    // 如果搜索框为空，返回 null，表示不需要过滤\n    if (!searchQuery.trim()) {\n      return null;\n    }\n    \n    const matchingFolders = new Set&lt;string&gt;();\n    const query = searchQuery.toLowerCase();\n    \n    // 递归遍历文件夹树，查找匹配的文件夹\n    const traverse = (nodeId: string) =&gt; {\n      const node = files[nodeId];\n      if (!node || node.type !== FileType.FOLDER) return;\n      \n      // 检查当前文件夹是否匹配搜索条件\n      const matches = node.name.toLowerCase().includes(query);\n      \n      // 获取子文件夹\n      const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];\n      \n      // 检查是否有子文件夹匹配\n      let hasMatchingChild = false;\n      for (const childId of folderChildren) {\n        traverse(childId);\n        if (matchingFolders.has(childId)) {\n          hasMatchingChild = true;\n        }\n      }\n      \n      // 如果当前文件夹匹配或有匹配的子文件夹，添加到结果中\n      if (matches || hasMatchingChild) {\n        matchingFolders.add(nodeId);\n      }\n    };\n    \n    // 从所有根目录开始遍历\n    roots.forEach((rootId: string) =&gt; traverse(rootId));\n    \n    return matchingFolders;\n  };\n  \n  // 递归渲染文件夹树，支持搜索过滤\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 108,
                "column": 1
              },
              "endPosition": {
                "line": 108,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 108,
                "column": 7
              },
              "endPosition": {
                "line": 108,
                "column": 27
              }
            },
            {
              "startPosition": {
                "line": 127,
                "column": 3
              },
              "endPosition": {
                "line": 127,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 127,
                "column": 9
              },
              "endPosition": {
                "line": 127,
                "column": 31
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ",
            "lineNumber": 108
          },
          {
            "text": "const findMatchingFolders =  {",
            "lineNumber": 127
          },
          {
            "text": "    // 如果搜索框为空，返回 null，表示不需要过滤",
            "lineNumber": 128
          },
          {
            "text": "    if (!searchQuery.trim()) {",
            "lineNumber": 129
          },
          {
            "text": "      return null;",
            "lineNumber": 130
          },
          {
            "text": "    }",
            "lineNumber": 131
          },
          {
            "text": "    ",
            "lineNumber": 132
          },
          {
            "text": "    const matchingFolders = new Set&lt;string&gt;();",
            "lineNumber": 133
          },
          {
            "text": "    const query = searchQuery.toLowerCase();",
            "lineNumber": 134
          },
          {
            "text": "    ",
            "lineNumber": 135
          },
          {
            "text": "    // 递归遍历文件夹树，查找匹配的文件夹",
            "lineNumber": 136
          },
          {
            "text": "    const traverse = (nodeId: string) =&gt; {",
            "lineNumber": 137
          },
          {
            "text": "      const node = files[nodeId];",
            "lineNumber": 138
          },
          {
            "text": "      if (!node || node.type !== FileType.FOLDER) return;",
            "lineNumber": 139
          },
          {
            "text": "      ",
            "lineNumber": 140
          },
          {
            "text": "      // 检查当前文件夹是否匹配搜索条件",
            "lineNumber": 141
          },
          {
            "text": "      const matches = node.name.toLowerCase().includes(query);",
            "lineNumber": 142
          },
          {
            "text": "      ",
            "lineNumber": 143
          },
          {
            "text": "      // 获取子文件夹",
            "lineNumber": 144
          },
          {
            "text": "      const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];",
            "lineNumber": 145
          },
          {
            "text": "      ",
            "lineNumber": 146
          },
          {
            "text": "      // 检查是否有子文件夹匹配",
            "lineNumber": 147
          },
          {
            "text": "      let hasMatchingChild = false;",
            "lineNumber": 148
          },
          {
            "text": "      for (const childId of folderChildren) {",
            "lineNumber": 149
          },
          {
            "text": "        traverse(childId);",
            "lineNumber": 150
          },
          {
            "text": "        if (matchingFolders.has(childId)) {",
            "lineNumber": 151
          },
          {
            "text": "          hasMatchingChild = true;",
            "lineNumber": 152
          },
          {
            "text": "        }",
            "lineNumber": 153
          },
          {
            "text": "      }",
            "lineNumber": 154
          },
          {
            "text": "      ",
            "lineNumber": 155
          },
          {
            "text": "      // 如果当前文件夹匹配或有匹配的子文件夹，添加到结果中",
            "lineNumber": 156
          },
          {
            "text": "      if (matches || hasMatchingChild) {",
            "lineNumber": 157
          },
          {
            "text": "        matchingFolders.add(nodeId);",
            "lineNumber": 158
          },
          {
            "text": "      }",
            "lineNumber": 159
          },
          {
            "text": "    };",
            "lineNumber": 160
          },
          {
            "text": "    ",
            "lineNumber": 161
          },
          {
            "text": "    // 从所有根目录开始遍历",
            "lineNumber": 162
          },
          {
            "text": "    roots.forEach((rootId: string) =&gt; traverse(rootId));",
            "lineNumber": 163
          },
          {
            "text": "    ",
            "lineNumber": 164
          },
          {
            "text": "    return matchingFolders;",
            "lineNumber": 165
          },
          {
            "text": "  };",
            "lineNumber": 166
          },
          {
            "text": "  ",
            "lineNumber": 167
          },
          {
            "text": "  // 递归渲染文件夹树，支持搜索过滤",
            "lineNumber": 168
          },
          {
            "text": ";",
            "lineNumber": 254
          }
        ]
      },
      "score": 0.2856450080871582
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 512
          },
          "endPosition": {
            "line": 679,
            "column": 1
          }
        },
        "contents": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {\n\n              &lt;p&gt;{t('sidebar.noTagsFound')}&lt;/p&gt;\n          &lt;/div&gt;\n      )}\n      {keys.map((group: string) =&gt; {\n          const tagsInGroup = groupedTags[group];\n          return (\n              &lt;div id={&#96;tag-group-${group}&#96;} key={group} className=\"mb-8 scroll-mt-4\"&gt;\n                   &lt;div className=\"flex items-center mb-0 border-b border-gray-100 dark:border-gray-800 pt-3 pb-3 sticky top-0 bg-white/95 dark:bg-gray-950/95 z-10 backdrop-blur-sm transition-colors h-16\"&gt;\n                       &lt;div className=\"w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-lg mr-3 shadow-sm border border-blue-100 dark:border-blue-900/50\"&gt;\n                          {group}\n                       &lt;/div&gt;\n                       &lt;span className=\"text-xs font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wider\"&gt;\n                          {tagsInGroup.length} {t('context.items')}\n                       &lt;/span&gt;\n                   &lt;/div&gt;\n                   &lt;div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3\"&gt;\n                       {tagsInGroup.map((tag: string) =&gt; {\n                           const count = tagCounts[tag] || 0;\n                           const isSelected = selectedTagIds.includes(tag);\n                           return (\n                              &lt;TagItem\n                       }\n      }\n}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {",
            "lineNumber": 513
          },
          {
            "lineNumber": 612
          },
          {
            "text": "              &lt;p&gt;{t('sidebar.noTagsFound')}&lt;/p&gt;",
            "lineNumber": 613
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 614
          },
          {
            "text": "      )}",
            "lineNumber": 615
          },
          {
            "text": "      {keys.map((group: string) =&gt; {",
            "lineNumber": 616
          },
          {
            "text": "          const tagsInGroup = groupedTags[group];",
            "lineNumber": 617
          },
          {
            "text": "          return (",
            "lineNumber": 618
          },
          {
            "text": "              &lt;div id={&#96;tag-group-${group}&#96;} key={group} className=\"mb-8 scroll-mt-4\"&gt;",
            "lineNumber": 619
          },
          {
            "text": "                   &lt;div className=\"flex items-center mb-0 border-b border-gray-100 dark:border-gray-800 pt-3 pb-3 sticky top-0 bg-white/95 dark:bg-gray-950/95 z-10 backdrop-blur-sm transition-colors h-16\"&gt;",
            "lineNumber": 620
          },
          {
            "text": "                       &lt;div className=\"w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-lg mr-3 shadow-sm border border-blue-100 dark:border-blue-900/50\"&gt;",
            "lineNumber": 621
          },
          {
            "text": "                          {group}",
            "lineNumber": 622
          },
          {
            "text": "                       &lt;/div&gt;",
            "lineNumber": 623
          },
          {
            "text": "                       &lt;span className=\"text-xs font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wider\"&gt;",
            "lineNumber": 624
          },
          {
            "text": "                          {tagsInGroup.length} {t('context.items')}",
            "lineNumber": 625
          },
          {
            "text": "                       &lt;/span&gt;",
            "lineNumber": 626
          },
          {
            "text": "                   &lt;/div&gt;",
            "lineNumber": 627
          },
          {
            "text": "                   &lt;div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3\"&gt;",
            "lineNumber": 628
          },
          {
            "text": "                       {tagsInGroup.map((tag: string) =&gt; {",
            "lineNumber": 629
          },
          {
            "text": "                           const count = tagCounts[tag] || 0;",
            "lineNumber": 630
          },
          {
            "text": "                           const isSelected = selectedTagIds.includes(tag);",
            "lineNumber": 631
          },
          {
            "text": "                           return (",
            "lineNumber": 632
          },
          {
            "text": "                              &lt;TagItem",
            "lineNumber": 633
          },
          {
            "text": "                       }",
            "lineNumber": 645
          },
          {
            "text": "      }",
            "lineNumber": 649
          },
          {
            "text": "}",
            "lineNumber": 675
          },
          {
            "text": ";",
            "lineNumber": 680
          }
        ]
      },
      "score": 0.28362786769866943
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n \n                onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })} \n                onPerformSearch={handlePerformSearch} \n                onSetToolbarQuery={setToolbarQuery} \n                onLayoutModeChange={(mode) =&gt; updateActiveTab({ layoutMode: mode })} \n                onSortOptionChange={(opt) =&gt; setState(s =&gt; ({ ...s, sortBy: opt }))} \n                onSortDirectionChange={() =&gt; setState(s =&gt; ({ ...s, sortDirection: s.sortDirection === 'asc' ? 'desc' : 'asc' }))} \n                onThumbnailSizeChange={(size) =&gt; setState(s =&gt; ({ ...s, thumbnailSize: size }))} \n                onToggleMetadata={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isMetadataVisible: !s.layout.isMetadataVisible } }))} \n                onToggleSettings={toggleSettings} \n                onUpdateDateFilter={(f) =&gt; updateActiveTab({ dateFilter: f })} \n                groupBy={groupBy}\n                onGroupByChange={setGroupBy}\n                isAISearchEnabled={state.settings.search.isAISearchEnabled}\n                onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}\n                onRememberFolderSettings={activeTab.viewMode === 'browser' ? handleRememberFolderSettings : undefined}\n                hasFolderSettings={activeTab.viewMode === 'browser' ? !!state.folderSettings[activeTab.folderId] : false}\n                t={t} \n              /&gt;\n              {/* ... (Filter UI, same as before) ... */}\n              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start || activeTab.activePersonId || activeTab.aiFilter) &amp;&amp; ( \n                  &lt;div className=\"flex items-center px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 space-x-2 overflow-x-auto shrink-0 z-20\"&gt;\n                      &lt;div className=\"flex items-center text-xs text-gray-500 dark:text-gray-400 mr-2 shrink-0\"&gt;\n                          &lt;Filter size={12} className=\"mr-1\"/&gt; {t('context.filters')}\n                      &lt;/div&gt;\n                      \n                      \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": " ",
            "lineNumber": 4525
          },
          {
            "text": "                onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })} ",
            "lineNumber": 4526
          },
          {
            "text": "                onPerformSearch={handlePerformSearch} ",
            "lineNumber": 4527
          },
          {
            "text": "                onSetToolbarQuery={setToolbarQuery} ",
            "lineNumber": 4528
          },
          {
            "text": "                onLayoutModeChange={(mode) =&gt; updateActiveTab({ layoutMode: mode })} ",
            "lineNumber": 4529
          },
          {
            "text": "                onSortOptionChange={(opt) =&gt; setState(s =&gt; ({ ...s, sortBy: opt }))} ",
            "lineNumber": 4530
          },
          {
            "text": "                onSortDirectionChange={() =&gt; setState(s =&gt; ({ ...s, sortDirection: s.sortDirection === 'asc' ? 'desc' : 'asc' }))} ",
            "lineNumber": 4531
          },
          {
            "text": "                onThumbnailSizeChange={(size) =&gt; setState(s =&gt; ({ ...s, thumbnailSize: size }))} ",
            "lineNumber": 4532
          },
          {
            "text": "                onToggleMetadata={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isMetadataVisible: !s.layout.isMetadataVisible } }))} ",
            "lineNumber": 4533
          },
          {
            "text": "                onToggleSettings={toggleSettings} ",
            "lineNumber": 4534
          },
          {
            "text": "                onUpdateDateFilter={(f) =&gt; updateActiveTab({ dateFilter: f })} ",
            "lineNumber": 4535
          },
          {
            "text": "                groupBy={groupBy}",
            "lineNumber": 4536
          },
          {
            "text": "                onGroupByChange={setGroupBy}",
            "lineNumber": 4537
          },
          {
            "text": "                isAISearchEnabled={state.settings.search.isAISearchEnabled}",
            "lineNumber": 4538
          },
          {
            "text": "                onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}",
            "lineNumber": 4539
          },
          {
            "text": "                onRememberFolderSettings={activeTab.viewMode === 'browser' ? handleRememberFolderSettings : undefined}",
            "lineNumber": 4540
          },
          {
            "text": "                hasFolderSettings={activeTab.viewMode === 'browser' ? !!state.folderSettings[activeTab.folderId] : false}",
            "lineNumber": 4541
          },
          {
            "text": "                t={t} ",
            "lineNumber": 4542
          },
          {
            "text": "              /&gt;",
            "lineNumber": 4543
          },
          {
            "text": "              {/* ... (Filter UI, same as before) ... */}",
            "lineNumber": 4544
          },
          {
            "text": "              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start || activeTab.activePersonId || activeTab.aiFilter) &amp;&amp; ( ",
            "lineNumber": 4545
          },
          {
            "text": "                  &lt;div className=\"flex items-center px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 space-x-2 overflow-x-auto shrink-0 z-20\"&gt;",
            "lineNumber": 4546
          },
          {
            "text": "                      &lt;div className=\"flex items-center text-xs text-gray-500 dark:text-gray-400 mr-2 shrink-0\"&gt;",
            "lineNumber": 4547
          },
          {
            "text": "                          &lt;Filter size={12} className=\"mr-1\"/&gt; {t('context.filters')}",
            "lineNumber": 4548
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4549
          },
          {
            "text": "                      ",
            "lineNumber": 4550
          },
          {
            "text": "                      ",
            "lineNumber": 4551
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.2765173017978668
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nfor (let fileIndex = 0; fileIndex &lt; imageFileIds.length; fileIndex++) {\n\n              updateTask(taskId, { current: currentStep + 4, currentStep: t('tasks.updatingDescription') });\n              \n              // Step 5: Add tags\n              updateTask(taskId, { current: currentStep + 5, currentStep: t('tasks.addingTags') });\n              const currentTags = file.tags || [];\n              const newTags = Array.from(new Set([...currentTags, ...aiData.tags]));\n\n              // Step 6: Save all AI data\n              updateTask(taskId, { current: currentStep + 6, currentStep: t('tasks.savingData') });\n              const updatedFile = {\n                  ...file,\n                  aiData,\n                  tags: newTags,\n                  description: file.description ? file.description : aiData.description\n              };\n\n              setState(prev =&gt; ({\n                  ...prev,\n                  people: currentPeople, // Always use the latest shared currentPeople\n                  files: {\n                      ...prev.files,\n)\n          }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 4154,
                "column": 3
              },
              "endPosition": {
                "line": 4154,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 4154,
                "column": 9
              },
              "endPosition": {
                "line": 4154,
                "column": 40
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3622
          },
          {
            "text": "for (let fileIndex = 0; fileIndex &lt; imageFileIds.length; fileIndex++) {",
            "lineNumber": 4045
          },
          {
            "lineNumber": 4190
          },
          {
            "text": "              updateTask(taskId, { current: currentStep + 4, currentStep: t('tasks.updatingDescription') });",
            "lineNumber": 4191
          },
          {
            "text": "              ",
            "lineNumber": 4192
          },
          {
            "text": "              // Step 5: Add tags",
            "lineNumber": 4193
          },
          {
            "text": "              updateTask(taskId, { current: currentStep + 5, currentStep: t('tasks.addingTags') });",
            "lineNumber": 4194
          },
          {
            "text": "              const currentTags = file.tags || [];",
            "lineNumber": 4195
          },
          {
            "text": "              const newTags = Array.from(new Set([...currentTags, ...aiData.tags]));",
            "lineNumber": 4196
          },
          {
            "lineNumber": 4197
          },
          {
            "text": "              // Step 6: Save all AI data",
            "lineNumber": 4198
          },
          {
            "text": "              updateTask(taskId, { current: currentStep + 6, currentStep: t('tasks.savingData') });",
            "lineNumber": 4199
          },
          {
            "text": "              const updatedFile = {",
            "lineNumber": 4200
          },
          {
            "text": "                  ...file,",
            "lineNumber": 4201
          },
          {
            "text": "                  aiData,",
            "lineNumber": 4202
          },
          {
            "text": "                  tags: newTags,",
            "lineNumber": 4203
          },
          {
            "text": "                  description: file.description ? file.description : aiData.description",
            "lineNumber": 4204
          },
          {
            "text": "              };",
            "lineNumber": 4205
          },
          {
            "lineNumber": 4206
          },
          {
            "text": "              setState(prev =&gt; ({",
            "lineNumber": 4207
          },
          {
            "text": "                  ...prev,",
            "lineNumber": 4208
          },
          {
            "text": "                  people: currentPeople, // Always use the latest shared currentPeople",
            "lineNumber": 4209
          },
          {
            "text": "                  files: {",
            "lineNumber": 4210
          },
          {
            "text": "                      ...prev.files,",
            "lineNumber": 4211
          },
          {
            "text": ")",
            "lineNumber": 4214
          },
          {
            "text": "          }",
            "lineNumber": 4215
          },
          {
            "text": ";",
            "lineNumber": 4388
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.2763468623161316
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5028,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n{t('context.allTagsOverview')}&lt;/span&gt;\n                      &lt;/div&gt;\n                      &lt;div className=\"flex-1 flex justify-end\"&gt;\n                        &lt;div className=\"relative\" style={{ width: '250px' }}&gt;\n                          &lt;div className={&#96;flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border ${tagSearchQuery ? 'border-blue-500 shadow-sm' : 'border-transparent'}&#96;}&gt;\n                            &lt;Search size={14} className=\"mr-2 text-gray-400\" /&gt;\n                            &lt;input\n                              type=\"text\"\n                              placeholder={t('search.placeholder')}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "{t('context.allTagsOverview')}&lt;/span&gt;",
            "lineNumber": 4624
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4625
          },
          {
            "text": "                      &lt;div className=\"flex-1 flex justify-end\"&gt;",
            "lineNumber": 4626
          },
          {
            "text": "                        &lt;div className=\"relative\" style={{ width: '250px' }}&gt;",
            "lineNumber": 4627
          },
          {
            "text": "                          &lt;div className={&#96;flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border ${tagSearchQuery ? 'border-blue-500 shadow-sm' : 'border-transparent'}&#96;}&gt;",
            "lineNumber": 4628
          },
          {
            "text": "                            &lt;Search size={14} className=\"mr-2 text-gray-400\" /&gt;",
            "lineNumber": 4629
          },
          {
            "text": "                            &lt;input",
            "lineNumber": 4630
          },
          {
            "text": "                              type=\"text\"",
            "lineNumber": 4631
          },
          {
            "text": "                              placeholder={t('search.placeholder')}",
            "lineNumber": 4632
          },
          {
            "text": ";",
            "lineNumber": 5029
          }
        ]
      },
      "score": 0.2757504880428314
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 246
          },
          "endPosition": {
            "line": 1381,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst colors = \n);\n\n  const folderDetails = useMemo(() =&gt; {\n    if (file &amp;&amp; file.type === FileType.FOLDER) {\n        const types: Record&lt;string, number&gt; = {};\n        let totalFiles = 0;\n        let subFolderCount = 0;\n        \n        const stack = [file.id];\n        \n        while(stack.length) {\n            const currentId = stack.pop()!;\n            const node = files[currentId];\n            if (!node) continue;\n            \n            if (currentId !== file.id) {\n                if (node.type === FileType.FOLDER) {\n                    subFolderCount++;\n                } else if (node.type === FileType.IMAGE) {\n                    totalFiles++;\n                    const fmt = node.meta?.format.toUpperCase() || 'OTHER';\n                    types[fmt] = (types[fmt] || 0) + 1;\n                }\n            }\n\n            if (node.children) {\n                stack.push(...node.children);\n            }\n        }\n        \n        return { types, totalFiles, subFolderCount };\n    }\n    return null;\n  }, [file, files]);\n\n  const folderStats = useMemo(() =&gt; {\n    if (file &amp;&amp; file.type === FileType.FOLDER) {\n      return getFolderStats(files, file.id);\n    }\n    return null;\n  }, [file, files]);\n\n  const folderPreviewImages = useMemo(() =&gt; {\n    if (file &amp;&amp; file.type === FileType.FOLDER) {\n        // Custom logic for Tauri to use Asset Protocol\n        const found: string[] = [];\n        const queue = [...(file.children || [])];\n        let head = 0;\n        let iterations = 0;\n        const maxIterations = 200;\n\n        while (head &lt; queue.length &amp;&amp; found.length &lt; 3 &amp;&amp; iterations &lt; maxIterations) {\n            const id = queue[head++];\n            iterations++;\n            const node = files[id];\n            if (!node) continue;\n            \n            if (node.type === FileType.IMAGE &amp;&amp; node.path) {\n                found.push(convertFileSrc(node.path));\n            } else if (node.type === FileType.FOLDER &amp;&amp; node.children) {\n                queue.push(...node.children);\n            }\n        }\n        return found;\n    }\n    return [];\n  }, [file, files]);\n\n  const typeColors: Record&lt;string, string&gt; = {\n      \n  };\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 247
          },
          {
            "text": "const colors = ",
            "lineNumber": 418
          },
          {
            "text": ");",
            "lineNumber": 432
          },
          {
            "lineNumber": 433
          },
          {
            "text": "  const folderDetails = useMemo(() =&gt; {",
            "lineNumber": 434
          },
          {
            "text": "    if (file &amp;&amp; file.type === FileType.FOLDER) {",
            "lineNumber": 435
          },
          {
            "text": "        const types: Record&lt;string, number&gt; = {};",
            "lineNumber": 436
          },
          {
            "text": "        let totalFiles = 0;",
            "lineNumber": 437
          },
          {
            "text": "        let subFolderCount = 0;",
            "lineNumber": 438
          },
          {
            "text": "        ",
            "lineNumber": 439
          },
          {
            "text": "        const stack = [file.id];",
            "lineNumber": 440
          },
          {
            "text": "        ",
            "lineNumber": 441
          },
          {
            "text": "        while(stack.length) {",
            "lineNumber": 442
          },
          {
            "text": "            const currentId = stack.pop()!;",
            "lineNumber": 443
          },
          {
            "text": "            const node = files[currentId];",
            "lineNumber": 444
          },
          {
            "text": "            if (!node) continue;",
            "lineNumber": 445
          },
          {
            "text": "            ",
            "lineNumber": 446
          },
          {
            "text": "            if (currentId !== file.id) {",
            "lineNumber": 447
          },
          {
            "text": "                if (node.type === FileType.FOLDER) {",
            "lineNumber": 448
          },
          {
            "text": "                    subFolderCount++;",
            "lineNumber": 449
          },
          {
            "text": "                } else if (node.type === FileType.IMAGE) {",
            "lineNumber": 450
          },
          {
            "text": "                    totalFiles++;",
            "lineNumber": 451
          },
          {
            "text": "                    const fmt = node.meta?.format.toUpperCase() || 'OTHER';",
            "lineNumber": 452
          },
          {
            "text": "                    types[fmt] = (types[fmt] || 0) + 1;",
            "lineNumber": 453
          },
          {
            "text": "                }",
            "lineNumber": 454
          },
          {
            "text": "            }",
            "lineNumber": 455
          },
          {
            "lineNumber": 456
          },
          {
            "text": "            if (node.children) {",
            "lineNumber": 457
          },
          {
            "text": "                stack.push(...node.children);",
            "lineNumber": 458
          },
          {
            "text": "            }",
            "lineNumber": 459
          },
          {
            "text": "        }",
            "lineNumber": 460
          },
          {
            "text": "        ",
            "lineNumber": 461
          },
          {
            "text": "        return { types, totalFiles, subFolderCount };",
            "lineNumber": 462
          },
          {
            "text": "    }",
            "lineNumber": 463
          },
          {
            "text": "    return null;",
            "lineNumber": 464
          },
          {
            "text": "  }, [file, files]);",
            "lineNumber": 465
          },
          {
            "lineNumber": 466
          },
          {
            "text": "  const folderStats = useMemo(() =&gt; {",
            "lineNumber": 467
          },
          {
            "text": "    if (file &amp;&amp; file.type === FileType.FOLDER) {",
            "lineNumber": 468
          },
          {
            "text": "      return getFolderStats(files, file.id);",
            "lineNumber": 469
          },
          {
            "text": "    }",
            "lineNumber": 470
          },
          {
            "text": "    return null;",
            "lineNumber": 471
          },
          {
            "text": "  }, [file, files]);",
            "lineNumber": 472
          },
          {
            "lineNumber": 473
          },
          {
            "text": "  const folderPreviewImages = useMemo(() =&gt; {",
            "lineNumber": 474
          },
          {
            "text": "    if (file &amp;&amp; file.type === FileType.FOLDER) {",
            "lineNumber": 475
          },
          {
            "text": "        // Custom logic for Tauri to use Asset Protocol",
            "lineNumber": 476
          },
          {
            "text": "        const found: string[] = [];",
            "lineNumber": 477
          },
          {
            "text": "        const queue = [...(file.children || [])];",
            "lineNumber": 478
          },
          {
            "text": "        let head = 0;",
            "lineNumber": 479
          },
          {
            "text": "        let iterations = 0;",
            "lineNumber": 480
          },
          {
            "text": "        const maxIterations = 200;",
            "lineNumber": 481
          },
          {
            "lineNumber": 482
          },
          {
            "text": "        while (head &lt; queue.length &amp;&amp; found.length &lt; 3 &amp;&amp; iterations &lt; maxIterations) {",
            "lineNumber": 483
          },
          {
            "text": "            const id = queue[head++];",
            "lineNumber": 484
          },
          {
            "text": "            iterations++;",
            "lineNumber": 485
          },
          {
            "text": "            const node = files[id];",
            "lineNumber": 486
          },
          {
            "text": "            if (!node) continue;",
            "lineNumber": 487
          },
          {
            "text": "            ",
            "lineNumber": 488
          },
          {
            "text": "            if (node.type === FileType.IMAGE &amp;&amp; node.path) {",
            "lineNumber": 489
          },
          {
            "text": "                found.push(convertFileSrc(node.path));",
            "lineNumber": 490
          },
          {
            "text": "            } else if (node.type === FileType.FOLDER &amp;&amp; node.children) {",
            "lineNumber": 491
          },
          {
            "text": "                queue.push(...node.children);",
            "lineNumber": 492
          },
          {
            "text": "            }",
            "lineNumber": 493
          },
          {
            "text": "        }",
            "lineNumber": 494
          },
          {
            "text": "        return found;",
            "lineNumber": 495
          },
          {
            "text": "    }",
            "lineNumber": 496
          },
          {
            "text": "    return [];",
            "lineNumber": 497
          },
          {
            "text": "  }, [file, files]);",
            "lineNumber": 498
          },
          {
            "lineNumber": 499
          },
          {
            "text": "  const typeColors: Record&lt;string, string&gt; = {",
            "lineNumber": 500
          },
          {
            "text": "      ",
            "lineNumber": 501
          },
          {
            "text": "  };",
            "lineNumber": 510
          },
          {
            "text": ";",
            "lineNumber": 1382
          }
        ]
      },
      "score": 0.27524346113204956
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\types.ts",
        "range": {
          "startPosition": {
            "line": 195
          },
          "endPosition": {
            "line": 251,
            "column": 1
          }
        },
        "contents": "export interface TabState {\n\n  history: {\n    stack: HistoryItem[];\n    currentIndex: number;\n  };\n  scrollTop: number;\n}\n\nexport type SettingsCategory = 'general' | 'appearance' | 'network' | 'storage' | 'ai';\n\nexport interface AppState {\n  roots: string[];\n  files: Record&lt;string, FileNode&gt;;\n  people: Record&lt;string, Person&gt;;\n  expandedFolderIds: string[];\n  tabs: TabState[];\n  activeTabId: string;\n  sortBy: SortOption;\n  sortDirection: SortDirection;\n  thumbnailSize: number;\n  renamingId: string | null;\n  clipboard: {\n    action: 'copy' | 'move' | null;\n    items: { type: 'file' | 'tag', ids: string[] }; \n  };\n  customTags: string[];\n  folderSettings: Record&lt;string, FolderSettings&gt;; // 文件夹ID -&gt; 文件夹设置\n  layout: {\n    isSidebarVisible: boolean;\n    isMetadataVisible: boolean;\n  };\n  slideshowConfig: SlideshowConfig;\n  settings: AppSettings;\n  isSettingsOpen: boolean;\n  settingsCategory: SettingsCategory;\n;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export interface TabState {",
            "lineNumber": 196,
            "isSignature": true
          },
          {
            "lineNumber": 211
          },
          {
            "text": "  history: {",
            "lineNumber": 212
          },
          {
            "text": "    stack: HistoryItem[];",
            "lineNumber": 213
          },
          {
            "text": "    currentIndex: number;",
            "lineNumber": 214
          },
          {
            "text": "  };",
            "lineNumber": 215
          },
          {
            "text": "  scrollTop: number;",
            "lineNumber": 216,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 217,
            "isSignature": true
          },
          {
            "lineNumber": 218
          },
          {
            "text": "export type SettingsCategory = 'general' | 'appearance' | 'network' | 'storage' | 'ai';",
            "lineNumber": 219,
            "isSignature": true
          },
          {
            "lineNumber": 220
          },
          {
            "text": "export interface AppState {",
            "lineNumber": 221,
            "isSignature": true
          },
          {
            "text": "  roots: string[];",
            "lineNumber": 222
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 223
          },
          {
            "text": "  people: Record&lt;string, Person&gt;;",
            "lineNumber": 224
          },
          {
            "text": "  expandedFolderIds: string[];",
            "lineNumber": 225
          },
          {
            "text": "  tabs: TabState[];",
            "lineNumber": 226
          },
          {
            "text": "  activeTabId: string;",
            "lineNumber": 227
          },
          {
            "text": "  sortBy: SortOption;",
            "lineNumber": 228
          },
          {
            "text": "  sortDirection: SortDirection;",
            "lineNumber": 229
          },
          {
            "text": "  thumbnailSize: number;",
            "lineNumber": 230
          },
          {
            "text": "  renamingId: string | null;",
            "lineNumber": 231
          },
          {
            "text": "  clipboard: {",
            "lineNumber": 232
          },
          {
            "text": "    action: 'copy' | 'move' | null;",
            "lineNumber": 233
          },
          {
            "text": "    items: { type: 'file' | 'tag', ids: string[] }; ",
            "lineNumber": 234
          },
          {
            "text": "  };",
            "lineNumber": 235
          },
          {
            "text": "  customTags: string[];",
            "lineNumber": 236
          },
          {
            "text": "  folderSettings: Record&lt;string, FolderSettings&gt;; // 文件夹ID -&gt; 文件夹设置",
            "lineNumber": 237
          },
          {
            "text": "  layout: {",
            "lineNumber": 238
          },
          {
            "text": "    isSidebarVisible: boolean;",
            "lineNumber": 239
          },
          {
            "text": "    isMetadataVisible: boolean;",
            "lineNumber": 240
          },
          {
            "text": "  };",
            "lineNumber": 241
          },
          {
            "text": "  slideshowConfig: SlideshowConfig;",
            "lineNumber": 242
          },
          {
            "text": "  settings: AppSettings;",
            "lineNumber": 243
          },
          {
            "text": "  isSettingsOpen: boolean;",
            "lineNumber": 244
          },
          {
            "text": "  settingsCategory: SettingsCategory;",
            "lineNumber": 245
          },
          {
            "text": ";",
            "lineNumber": 251,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 252,
            "isSignature": true
          }
        ]
      },
      "score": 0.27412089705467224
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


增强文件夹选择器模态框中的选中样式：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/App.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "isSelected.*bg-blue",
  "path": "src/components/FileGrid.tsx",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "isSelected.*bg-blue",
    "path": "src/components/FileGrid.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/components/FileGrid.tsx",
              "matches": [
                {
                  "lineNumber": 495,
                  "content": "      className={&#96;tag-item rounded-lg p-4 border cursor-pointer group transition-all relative ${isSelected ? 'bg-blue-100 dark:bg-blue-900/40 border-blue-500' : 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500'}&#96;}"
                },
                {
                  "lineNumber": 505,
                  "content": "        &lt;span className={&#96;${isSelected ? 'bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200' : 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300'} text-xs px-2 py-0.5 rounded-full&#96;}&gt;{count}&lt;/span&gt;"
                },
                {
                  "lineNumber": 508,
                  "content": "      {isSelected &amp;&amp; (&lt;div className=\"absolute top-2 left-2 w-2 h-2 bg-blue-500 rounded-full\"&gt;&lt;/div&gt;)}"
                },
                {
                  "lineNumber": 710,
                  "content": "            ${isSelected ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500 border-l-4 shadow-md' : 'bg-white dark:bg-gray-900 border-transparent hover:bg-gray-50 dark:hover:bg-gray-800/50'}"
                },
                {
                  "lineNumber": 916,
                  "content": "          className={&#96;font-bold text-base truncate transition-colors px-2 rounded-md ${isSelected ? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30' : 'text-gray-800 dark:text-gray-100 group-hover:text-blue-600 dark:group-hover:text-blue-400'}&#96;}"
                }
              ]
            }
          ],
          "totalLines": 5,
          "totalMatchedLines": 5
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


增强其他选中状态的视觉标识：


---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "007ac895-13e5-4d8a-bad9-49a7dd705faa"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "0c668864-1e68-4a7d-a86b-40041fbb4fc3"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "e1468952-33c1-4822-9715-8ad8cfd0c7ad"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "PersonCard.*isSelected",
  "path": "src/components/FileGrid.tsx",
  "contextAfter": 5,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "PersonCard.*isSelected",
    "path": "src/components/FileGrid.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {}
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


检查 PersonCard 的选中样式：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "ClearPersonModal.*isSelected",
  "path": "src/App.tsx",
  "contextAfter": 10,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "ClearPersonModal.*isSelected",
    "path": "src/App.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {}
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


增强 PersonCard 的选中样式：


---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "144aec1e-3d80-4478-a15c-a2bc612aa5cd"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "7bf3a630-7a8a-415e-b590-0999c81f6eb4"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "4a92f052-3ce3-485d-b2cd-2e711afddced"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "ClearPersonModal",
  "path": "src/App.tsx",
  "contextAfter": 20,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "ClearPersonModal",
    "path": "src/App.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/App.tsx",
              "matches": [
                {
                  "lineNumber": 41,
                  "content": "const ClearPersonModal = ({ files, fileIds, people, onConfirm, onClose, t }: any) =&gt; {"
                },
                {
                  "lineNumber": 42,
                  "content": "  // Get all unique people from selected files",
                  "isContextLine": true
                },
                {
                  "lineNumber": 43,
                  "content": "  const allPeople = new Set&lt;string&gt;();",
                  "isContextLine": true
                },
                {
                  "lineNumber": 44,
                  "content": "  fileIds.forEach((fileId: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 45,
                  "content": "    const file = files[fileId];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 46,
                  "content": "    if (file &amp;&amp; file.type === FileType.IMAGE &amp;&amp; file.aiData?.faces) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 47,
                  "content": "      file.aiData.faces.forEach((face: AiFace) =&gt; allPeople.add(face.personId));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 48,
                  "content": "    }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 49,
                  "content": "  });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 50,
                  "isContextLine": true
                },
                {
                  "lineNumber": 51,
                  "content": "  const peopleList = Array.from(allPeople).map(personId =&gt; people[personId]).filter(Boolean);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 52,
                  "content": "  const [selectedPeople, setSelectedPeople] = useState&lt;string[]&gt;(peopleList.map(p =&gt; p.id));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 53,
                  "isContextLine": true
                },
                {
                  "lineNumber": 54,
                  "content": "  const handleTogglePerson = (personId: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 55,
                  "content": "    setSelectedPeople(prev =&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 56,
                  "content": "      prev.includes(personId)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 57,
                  "content": "        ? prev.filter(id =&gt; id !== personId)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 58,
                  "content": "        : [...prev, personId]",
                  "isContextLine": true
                },
                {
                  "lineNumber": 59,
                  "content": "    );",
                  "isContextLine": true
                },
                {
                  "lineNumber": 60,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 61,
                  "isContextLine": true
                },
                {
                  "lineNumber": 4816,
                  "content": "          &lt;ClearPersonModal"
                },
                {
                  "lineNumber": 4817,
                  "content": "              files={state.files}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4818,
                  "content": "              fileIds={state.activeModal.data.fileIds}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4819,
                  "content": "              people={state.people}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4820,
                  "content": "              onConfirm={(personIds: string[]) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4821,
                  "content": "                  handleClearPersonInfo(state.activeModal.data.fileIds, personIds);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4822,
                  "content": "                  setState(s =&gt; ({ ...s, activeModal: { type: null } }));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4823,
                  "content": "                  showToast(t('context.saved'));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4824,
                  "content": "              }}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4825,
                  "content": "              onClose={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: null } }))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4826,
                  "content": "              t={t}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4827,
                  "content": "          /&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4828,
                  "content": "      )}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4829,
                  "content": "      &lt;/div&gt;)}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4830,
                  "isContextLine": true
                },
                {
                  "lineNumber": 4831,
                  "content": "      {state.isSettingsOpen &amp;&amp; ( &lt;SettingsModal state={state} onClose={() =&gt; setState(s =&gt; ({ ...s, isSettingsOpen: false }))} onUpdateSettings={(updates) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4832,
                  "content": "          setState(s =&gt; ({ ...s, ...updates }));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4833,
                  "content": "      }} onUpdateSettingsData={(updates) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4834,
                  "content": "          setState(s =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4835,
                  "content": "              const newSettings = { ...s.settings, ...updates };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4836,
                  "content": "              return { ...s, settings: newSettings };",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 42,
          "totalMatchedLines": 2
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


检查并增强 ClearPersonModal 中的选中样式：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/App.tsx</summary>

</details>
</tool-use>

---



---


增强 ClearPersonModal 中的选中样式：


---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "0e512282-e6f3-4eee-aa56-4ba4abbbc8fd"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "src/components/FileGrid.tsx",
    "src/components/TreeSidebar.tsx",
    "src/App.tsx"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "src/components/FileGrid.tsx"
    },
    {
      "relativeWorkspacePath": "src/components/TreeSidebar.tsx"
    },
    {
      "relativeWorkspacePath": "src/App.tsx"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


已增强选中状态的视觉标识。主要改进：

## 改进内容

1. **列表视图 (FileListItem)**
   - 添加左侧 4px 蓝色边框条
   - 增强背景色对比度
   - 添加阴影效果

2. **网格视图 (FileCard)**
   - 边框宽度从 1px 增加到 2px
   - Ring 效果从 ring-2 增加到 ring-4
   - 添加蓝色阴影
   - 选中标记图标从 5x5 增大到 6x6，并添加 ring 效果

3. **文件夹树 (TreeNode)**
   - 添加左侧 4px 蓝色边框条
   - 添加阴影效果

4. **文件夹选择器模态框 (FolderPickerModal)**
   - 添加左侧 4px 蓝色边框条
   - 增强背景色和文字颜色对比度
   - 添加阴影和加粗文字

5. **标签 (TagItem)**
   - 边框宽度增加到 2px
   - 添加 ring-2 效果
   - 选中标记从 2x2 增大到 3x3，并添加 ring

6. **人物卡片 (PersonCard)**
   - 缩放从 scale-105 增加到 scale-110
   - 添加 ring-4 效果
   - 增强选中标记的视觉效果

7. **清除人物信息模态框 (ClearPersonModal)**
   - 添加左侧 4px 蓝色边框条
   - 增强背景色对比度
   - 复选框增大，文字颜色增强

所有选中状态现在都有更明显的视觉区分，通过边框、阴影、ring 效果和颜色对比来实现。

---

_**User**_

当在右键菜单选中这个DOM Path: div#root > div.w-full h-full flex flex-col bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 overflow-hidden font-.an. tran.ition-color. duration-300 > div.fixed bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-md .hadow-xl text-.m py-1 text-gray-800 dark:text-gray-200 min-w-[180px] z-[60] max-h-[80vh] overflow-y-auto > div.px-4 py-2 hover:bg-blue-600 hover:text-white cur.or-pointer flex item.-center[1]
Position: top=286px, left=943px, width=236px, height=36px
React Component: App
HTML Element: <div class="px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center">在系统文件管理器中查看</div> 的时候，会打开所选文件/文件夹在系统文件夹中所在的目录。

---

_**Agent (model default, mode Agent)**_



---


查看相关代码，确认“在系统文件管理器中查看”功能是否正确实现：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/api/tauri-bridge.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "openPath",
  "path": "src/api/tauri-bridge.ts",
  "contextAfter": 10,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "openPath",
    "path": "src/api/tauri-bridge.ts",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/api/tauri-bridge.ts",
              "matches": [
                {
                  "lineNumber": 347,
                  "content": "export const openPath = async (path: string, isFile?: boolean): Promise&lt;void&gt; =&gt; {"
                },
                {
                  "lineNumber": 348,
                  "content": "  try {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 349,
                  "content": "    await invoke('open_path', { path, isFile });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 350,
                  "content": "  } catch (error) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 351,
                  "content": "    console.error('Failed to open path:', error);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 352,
                  "content": "  }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 353,
                  "content": "};",
                  "isContextLine": true
                },
                {
                  "lineNumber": 354,
                  "isContextLine": true
                },
                {
                  "lineNumber": 355,
                  "content": "/**",
                  "isContextLine": true
                },
                {
                  "lineNumber": 356,
                  "content": " * 创建新文件夹",
                  "isContextLine": true
                },
                {
                  "lineNumber": 357,
                  "content": " * @param path 要创建的文件夹路径",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 11,
          "totalMatchedLines": 1
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "在系统文件管理器中查看 handleViewInExplorer context menu",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n \n                   onDragOver={handleDragOver}\n                   onDragLeave={handleDragLeave}\n                   onDragEnter={handleDragEnter}\n                   onDrop={handleExternalFileDrop}\n              &gt;\n                {/* Drag and drop overlay */}\n                {isDragOver &amp;&amp; !isInternalDragRef.current &amp;&amp; (\n                  &lt;div className=\"absolute inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm z-50 pointer-events-none\"&gt;\n                    &lt;div className=\"w-full h-full flex\"&gt;\n                      {/* Copy section */}\n                      &lt;div \n                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'copy' ? 'bg-blue-600/80' : 'bg-blue-600/50 hover:bg-blue-600/70'}&#96;}\n                      &gt;\n                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📋&lt;/div&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": " ",
            "lineNumber": 4612
          },
          {
            "text": "                   onDragOver={handleDragOver}",
            "lineNumber": 4613
          },
          {
            "text": "                   onDragLeave={handleDragLeave}",
            "lineNumber": 4614
          },
          {
            "text": "                   onDragEnter={handleDragEnter}",
            "lineNumber": 4615
          },
          {
            "text": "                   onDrop={handleExternalFileDrop}",
            "lineNumber": 4616
          },
          {
            "text": "              &gt;",
            "lineNumber": 4617
          },
          {
            "text": "                {/* Drag and drop overlay */}",
            "lineNumber": 4618
          },
          {
            "text": "                {isDragOver &amp;&amp; !isInternalDragRef.current &amp;&amp; (",
            "lineNumber": 4619
          },
          {
            "text": "                  &lt;div className=\"absolute inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm z-50 pointer-events-none\"&gt;",
            "lineNumber": 4620
          },
          {
            "text": "                    &lt;div className=\"w-full h-full flex\"&gt;",
            "lineNumber": 4621
          },
          {
            "text": "                      {/* Copy section */}",
            "lineNumber": 4622
          },
          {
            "text": "                      &lt;div ",
            "lineNumber": 4623
          },
          {
            "text": "                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'copy' ? 'bg-blue-600/80' : 'bg-blue-600/50 hover:bg-blue-600/70'}&#96;}",
            "lineNumber": 4624
          },
          {
            "text": "                      &gt;",
            "lineNumber": 4625
          },
          {
            "text": "                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📋&lt;/div&gt;",
            "lineNumber": 4626
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.5372475981712341
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n\"\n              &gt;\n                &lt;ChevronLeft size={32} /&gt;\n              &lt;/button&gt;\n            &lt;/div&gt;\n            &lt;div className=\"absolute inset-y-0 right-0 w-24 flex items-center justify-end pr-2 opacity-0 hover:opacity-100 transition-opacity duration-300 bg-gradient-to-l from-black/30 to-transparent z-10 pointer-events-auto\"&gt;\n              &lt;button \n                onClick={(e) =&gt; { e.stopPropagation(); handleNext(); }}\n                className=\"p-3 rounded-full bg-black/50 text-white/80 hover:bg-black/80 hover:text-white backdrop-blur-sm transform transition-transform active:scale-95\"\n              &gt;\n                &lt;ChevronRight size={32} /&gt;\n              &lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/&gt;\n        )}\n      &lt;/div&gt;\n\n      {contextMenu.visible &amp;&amp; (\n        &lt;div \n          className=\"fixed bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-md shadow-xl text-sm py-1 text-gray-800 dark:text-gray-200 min-w-[220px] z-[60] max-h-[80vh] overflow-y-auto animate-zoom-in\"\n          style={{ \n            top: contextMenu.y + 350 &gt; window.innerHeight ? 'auto' : contextMenu.y,\n            bottom: contextMenu.y + 350 &gt; window.innerHeight ? window.innerHeight - contextMenu.y : 'auto',\n            left: Math.min(contextMenu.x, window.innerWidth - 240)\n          }}\n          onMouseDown={(e) =&gt; e.stopPropagation()}\n        &gt;\n          &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleOriginalSize(); setContextMenu({...contextMenu, visible: false}); }}&gt;\n             &lt;Maximize size={14} className=\"mr-2 opacity-70\"/&gt; {t('viewer.original')}\n          &lt;/div&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "text": "\"",
            "lineNumber": 632
          },
          {
            "text": "              &gt;",
            "lineNumber": 633
          },
          {
            "text": "                &lt;ChevronLeft size={32} /&gt;",
            "lineNumber": 634
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 635
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 636
          },
          {
            "text": "            &lt;div className=\"absolute inset-y-0 right-0 w-24 flex items-center justify-end pr-2 opacity-0 hover:opacity-100 transition-opacity duration-300 bg-gradient-to-l from-black/30 to-transparent z-10 pointer-events-auto\"&gt;",
            "lineNumber": 637
          },
          {
            "text": "              &lt;button ",
            "lineNumber": 638
          },
          {
            "text": "                onClick={(e) =&gt; { e.stopPropagation(); handleNext(); }}",
            "lineNumber": 639
          },
          {
            "text": "                className=\"p-3 rounded-full bg-black/50 text-white/80 hover:bg-black/80 hover:text-white backdrop-blur-sm transform transition-transform active:scale-95\"",
            "lineNumber": 640
          },
          {
            "text": "              &gt;",
            "lineNumber": 641
          },
          {
            "text": "                &lt;ChevronRight size={32} /&gt;",
            "lineNumber": 642
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 643
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 644
          },
          {
            "text": "          &lt;/&gt;",
            "lineNumber": 645
          },
          {
            "text": "        )}",
            "lineNumber": 646
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 647
          },
          {
            "lineNumber": 648
          },
          {
            "text": "      {contextMenu.visible &amp;&amp; (",
            "lineNumber": 649
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 650
          },
          {
            "text": "          className=\"fixed bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-md shadow-xl text-sm py-1 text-gray-800 dark:text-gray-200 min-w-[220px] z-[60] max-h-[80vh] overflow-y-auto animate-zoom-in\"",
            "lineNumber": 651
          },
          {
            "text": "          style={{ ",
            "lineNumber": 652
          },
          {
            "text": "            top: contextMenu.y + 350 &gt; window.innerHeight ? 'auto' : contextMenu.y,",
            "lineNumber": 653
          },
          {
            "text": "            bottom: contextMenu.y + 350 &gt; window.innerHeight ? window.innerHeight - contextMenu.y : 'auto',",
            "lineNumber": 654
          },
          {
            "text": "            left: Math.min(contextMenu.x, window.innerWidth - 240)",
            "lineNumber": 655
          },
          {
            "text": "          }}",
            "lineNumber": 656
          },
          {
            "text": "          onMouseDown={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 657
          },
          {
            "text": "        &gt;",
            "lineNumber": 658
          },
          {
            "text": "          &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleOriginalSize(); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 659
          },
          {
            "text": "             &lt;Maximize size={14} className=\"mr-2 opacity-70\"/&gt; {t('viewer.original')}",
            "lineNumber": 660
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 661
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.4760456681251526
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst onPerformSearch = async \n activeTab.searchScope, activeTab.activeTags, null, 0);\n      }\n  };\n\n  const handlePerformSearch = onPerformSearch;\n\n  const handleViewerSearch = (query: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', query, activeTab.searchScope, activeTab.activeTags, null, 0);\n  const enterTagView = (tagName: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'tag', [tagName], null, 0);\n  const enterTagsOverview = () =&gt; pushHistory(activeTab.folderId, null, 'tags-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);\n  const enterPeopleOverview = () =&gt; pushHistory(activeTab.folderId, null, 'people-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);\n  const enterPersonView = (personId: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'all', [], personId, 0);\n  const handleClearTagFilter = (tagToRemove: string) =&gt; updateActiveTab(prev =&gt; ({ activeTags: prev.activeTags.filter(t =&gt; t !== tagToRemove) }));\n  const handleClearAllTags = () =&gt; updateActiveTab({ activeTags: [] });\n  const handleClearPersonFilter = () =&gt; updateActiveTab({ activePersonId: null });\n  \n  const handleRenameSubmit = async (value: string, id: string) =&gt; {\n      value = value.trim();\n      const file = state.files[id];\n      if (!value || value === file.name) { setState(s =&gt; ({ ...s, renamingId: null })); return; }\n      if (file.path) {\n          try {\n              const separator = file.path.includes('/') ? '/' : '\\\\';\n              const parentPath = file.path.substring(0, file.path.lastIndexOf(separator));\n              const newPath = &#96;${parentPath}${separator}${value}&#96;;\n              \n              // Use appropriate renameFile function based on environment\n              const isTauriEnv = isTauriEnvironment();\n              if (isTauriEnv) {\n                  await renameFile(file.path, newPath);\n              } else if (window.electron) {\n                  await window.electron.renameFile(file.path, newPath);\n              } else {\n                  throw new Error(\"No file system access available\");\n              }\n              \n              await handleRefresh();\n              setState(s =&gt; ({ ...s, renamingId: null }));\n          }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const onPerformSearch = async ",
            "lineNumber": 3105
          },
          {
            "text": " activeTab.searchScope, activeTab.activeTags, null, 0);",
            "lineNumber": 3109
          },
          {
            "text": "      }",
            "lineNumber": 3110
          },
          {
            "text": "  };",
            "lineNumber": 3111
          },
          {
            "lineNumber": 3112
          },
          {
            "text": "  const handlePerformSearch = onPerformSearch;",
            "lineNumber": 3113
          },
          {
            "lineNumber": 3114
          },
          {
            "text": "  const handleViewerSearch = (query: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', query, activeTab.searchScope, activeTab.activeTags, null, 0);",
            "lineNumber": 3115
          },
          {
            "text": "  const enterTagView = (tagName: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'tag', [tagName], null, 0);",
            "lineNumber": 3116
          },
          {
            "text": "  const enterTagsOverview = () =&gt; pushHistory(activeTab.folderId, null, 'tags-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);",
            "lineNumber": 3117
          },
          {
            "text": "  const enterPeopleOverview = () =&gt; pushHistory(activeTab.folderId, null, 'people-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);",
            "lineNumber": 3118
          },
          {
            "text": "  const enterPersonView = (personId: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'all', [], personId, 0);",
            "lineNumber": 3119
          },
          {
            "text": "  const handleClearTagFilter = (tagToRemove: string) =&gt; updateActiveTab(prev =&gt; ({ activeTags: prev.activeTags.filter(t =&gt; t !== tagToRemove) }));",
            "lineNumber": 3120
          },
          {
            "text": "  const handleClearAllTags = () =&gt; updateActiveTab({ activeTags: [] });",
            "lineNumber": 3121
          },
          {
            "text": "  const handleClearPersonFilter = () =&gt; updateActiveTab({ activePersonId: null });",
            "lineNumber": 3122
          },
          {
            "text": "  ",
            "lineNumber": 3123
          },
          {
            "text": "  const handleRenameSubmit = async (value: string, id: string) =&gt; {",
            "lineNumber": 3124
          },
          {
            "text": "      value = value.trim();",
            "lineNumber": 3125
          },
          {
            "text": "      const file = state.files[id];",
            "lineNumber": 3126
          },
          {
            "text": "      if (!value || value === file.name) { setState(s =&gt; ({ ...s, renamingId: null })); return; }",
            "lineNumber": 3127
          },
          {
            "text": "      if (file.path) {",
            "lineNumber": 3128
          },
          {
            "text": "          try {",
            "lineNumber": 3129
          },
          {
            "text": "              const separator = file.path.includes('/') ? '/' : '\\\\';",
            "lineNumber": 3130
          },
          {
            "text": "              const parentPath = file.path.substring(0, file.path.lastIndexOf(separator));",
            "lineNumber": 3131
          },
          {
            "text": "              const newPath = &#96;${parentPath}${separator}${value}&#96;;",
            "lineNumber": 3132
          },
          {
            "text": "              ",
            "lineNumber": 3133
          },
          {
            "text": "              // Use appropriate renameFile function based on environment",
            "lineNumber": 3134
          },
          {
            "text": "              const isTauriEnv = isTauriEnvironment();",
            "lineNumber": 3135
          },
          {
            "text": "              if (isTauriEnv) {",
            "lineNumber": 3136
          },
          {
            "text": "                  await renameFile(file.path, newPath);",
            "lineNumber": 3137
          },
          {
            "text": "              } else if (window.electron) {",
            "lineNumber": 3138
          },
          {
            "text": "                  await window.electron.renameFile(file.path, newPath);",
            "lineNumber": 3139
          },
          {
            "text": "              } else {",
            "lineNumber": 3140
          },
          {
            "text": "                  throw new Error(\"No file system access available\");",
            "lineNumber": 3141
          },
          {
            "text": "              }",
            "lineNumber": 3142
          },
          {
            "text": "              ",
            "lineNumber": 3143
          },
          {
            "text": "              await handleRefresh();",
            "lineNumber": 3144
          },
          {
            "text": "              setState(s =&gt; ({ ...s, renamingId: null }));",
            "lineNumber": 3145
          },
          {
            "text": "          }",
            "lineNumber": 3146
          },
          {
            "text": ";",
            "lineNumber": 3154
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.4134092330932617
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleDropOnFolder = \n \n      \n      // 重置标记 \n      isInternalDragRef.current = false; \n  };\n  \n  const handleContextMenu = (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'background' | 'tab' | 'person', id: string) =&gt; { \n    e.preventDefault(); e.stopPropagation(); \n    let menuType: any = null; \n    if (type === 'file') { \n      if (!activeTab.selectedFileIds.includes(id)) { \n        updateActiveTab({ selectedFileIds: [id], lastSelectedId: id }); \n        menuType = state.files[id].type === FileType.FOLDER ? 'folder-single' : 'file-single'; \n      } else { \n        if (activeTab.selectedFileIds.length &gt; 1) { \n          // 检查所有选中的项目类型\n          const selectedItems = activeTab.selectedFileIds.map(fileId =&gt; state.files[fileId]);\n          const allAreFolders = selectedItems.every(item =&gt; item &amp;&amp; item.type === FileType.FOLDER);\n          const allAreFiles = selectedItems.every(item =&gt; item &amp;&amp; item.type !== FileType.FOLDER);\n          \n          if (allAreFolders) {\n            menuType = 'folder-multi';\n          } else if (allAreFiles) {\n            menuType = 'file-multi';\n          } else {\n            // 混合类型，使用 file-multi 作为默认值\n            menuType = 'file-multi';\n          }\n        } else { \n          menuType = state.files[id].type === FileType.FOLDER ? 'folder-single' : 'file-single'; \n        } \n      } \n    } \n    else if (type === 'tag') { if (!activeTab.selectedTagIds.includes(id)) { updateActiveTab({ selectedTagIds: [id] }); menuType = 'tag-single'; } else { menuType = activeTab.selectedTagIds.length &gt; 1 ? 'tag-multi' : 'tag-single'; } } \n    else if (type === 'tag-background') { menuType = 'tag-background'; } \n    else if (type === 'root-folder') { menuType = 'root-folder'; } \n    else if (type === 'tab') { menuType = 'tab'; }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleDropOnFolder = ",
            "lineNumber": 3224
          },
          {
            "text": " ",
            "lineNumber": 3240
          },
          {
            "text": "      ",
            "lineNumber": 3241
          },
          {
            "text": "      // 重置标记 ",
            "lineNumber": 3242
          },
          {
            "text": "      isInternalDragRef.current = false; ",
            "lineNumber": 3243
          },
          {
            "text": "  };",
            "lineNumber": 3244
          },
          {
            "text": "  ",
            "lineNumber": 3245
          },
          {
            "text": "  const handleContextMenu = (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'background' | 'tab' | 'person', id: string) =&gt; { ",
            "lineNumber": 3246
          },
          {
            "text": "    e.preventDefault(); e.stopPropagation(); ",
            "lineNumber": 3247
          },
          {
            "text": "    let menuType: any = null; ",
            "lineNumber": 3248
          },
          {
            "text": "    if (type === 'file') { ",
            "lineNumber": 3249
          },
          {
            "text": "      if (!activeTab.selectedFileIds.includes(id)) { ",
            "lineNumber": 3250
          },
          {
            "text": "        updateActiveTab({ selectedFileIds: [id], lastSelectedId: id }); ",
            "lineNumber": 3251
          },
          {
            "text": "        menuType = state.files[id].type === FileType.FOLDER ? 'folder-single' : 'file-single'; ",
            "lineNumber": 3252
          },
          {
            "text": "      } else { ",
            "lineNumber": 3253
          },
          {
            "text": "        if (activeTab.selectedFileIds.length &gt; 1) { ",
            "lineNumber": 3254
          },
          {
            "text": "          // 检查所有选中的项目类型",
            "lineNumber": 3255
          },
          {
            "text": "          const selectedItems = activeTab.selectedFileIds.map(fileId =&gt; state.files[fileId]);",
            "lineNumber": 3256
          },
          {
            "text": "          const allAreFolders = selectedItems.every(item =&gt; item &amp;&amp; item.type === FileType.FOLDER);",
            "lineNumber": 3257
          },
          {
            "text": "          const allAreFiles = selectedItems.every(item =&gt; item &amp;&amp; item.type !== FileType.FOLDER);",
            "lineNumber": 3258
          },
          {
            "text": "          ",
            "lineNumber": 3259
          },
          {
            "text": "          if (allAreFolders) {",
            "lineNumber": 3260
          },
          {
            "text": "            menuType = 'folder-multi';",
            "lineNumber": 3261
          },
          {
            "text": "          } else if (allAreFiles) {",
            "lineNumber": 3262
          },
          {
            "text": "            menuType = 'file-multi';",
            "lineNumber": 3263
          },
          {
            "text": "          } else {",
            "lineNumber": 3264
          },
          {
            "text": "            // 混合类型，使用 file-multi 作为默认值",
            "lineNumber": 3265
          },
          {
            "text": "            menuType = 'file-multi';",
            "lineNumber": 3266
          },
          {
            "text": "          }",
            "lineNumber": 3267
          },
          {
            "text": "        } else { ",
            "lineNumber": 3268
          },
          {
            "text": "          menuType = state.files[id].type === FileType.FOLDER ? 'folder-single' : 'file-single'; ",
            "lineNumber": 3269
          },
          {
            "text": "        } ",
            "lineNumber": 3270
          },
          {
            "text": "      } ",
            "lineNumber": 3271
          },
          {
            "text": "    } ",
            "lineNumber": 3272
          },
          {
            "text": "    else if (type === 'tag') { if (!activeTab.selectedTagIds.includes(id)) { updateActiveTab({ selectedTagIds: [id] }); menuType = 'tag-single'; } else { menuType = activeTab.selectedTagIds.length &gt; 1 ? 'tag-multi' : 'tag-single'; } } ",
            "lineNumber": 3273
          },
          {
            "text": "    else if (type === 'tag-background') { menuType = 'tag-background'; } ",
            "lineNumber": 3274
          },
          {
            "text": "    else if (type === 'root-folder') { menuType = 'root-folder'; } ",
            "lineNumber": 3275
          },
          {
            "text": "    else if (type === 'tab') { menuType = 'tab'; }",
            "lineNumber": 3276
          },
          {
            "text": ";",
            "lineNumber": 3280
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.37437328696250916
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n loadingInfo={loadingInfo} /&gt;\n      {/* ... (SVG filters) ... */}\n      &lt;svg style={{ display: 'none' }}&gt;&lt;defs&gt;&lt;filter id=\"channel-r\"&gt;&lt;feColorMatrix type=\"matrix\" values=\"1 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0\" /&gt;&lt;/filter&gt;&lt;filter id=\"channel-g\"&gt;&lt;feColorMatrix type=\"matrix\" values=\"0 0 0 0 0  0 1 0 0 0  0 0 0 0 0  0 0 0 1 0\" /&gt;&lt;/filter&gt;&lt;filter id=\"channel-b\"&gt;&lt;feColorMatrix type=\"matrix\" values=\"0 0 0 0 0  0 0 0 0 0  0 0 1 0 0  0 0 0 1 0\" /&gt;&lt;/filter&gt;&lt;filter id=\"channel-l\"&gt;&lt;feColorMatrix type=\"saturate\" values=\"0\" /&gt;&lt;/filter&gt;&lt;/defs&gt;&lt;/svg&gt;\n      &lt;TabBar tabs={state.tabs} activeTabId={state.activeTabId} files={state.files} onSwitchTab={handleSwitchTab} onCloseTab={handleCloseTab} onNewTab={handleNewTab} onContextMenu={(e, id) =&gt; handleContextMenu(e, 'tab', id)} t={t} showWindowControls={!showSplash} /&gt;\n      &lt;div className=\"flex-1 flex overflow-hidden relative transition-all duration-300 ease-[cubic-bezier(0.25,0.1,0.25,1)]\"&gt;\n        &lt;div className={&#96;bg-gray-50 dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 flex flex-col transition-all duration-300 shrink-0 z-40 ${state.layout.isSidebarVisible ? 'w-64 translate-x-0 opacity-100' : 'w-0 -translate-x-full opacity-0 overflow-hidden'}&#96;}&gt;\n          &lt;Sidebar roots={state.roots} files={state.files} people={state.people} customTags={state.customTags} currentFolderId={activeTab.folderId} expandedIds={state.expandedFolderIds} tasks={state.tasks} onToggle={handleToggleFolder} onNavigate={handleNavigateFolder} onTagSelect={enterTagView} onNavigateAllTags={enterTagsOverview} onPersonSelect={enterPersonView} onNavigateAllPeople={enterPeopleOverview} onContextMenu={handleContextMenu} onDrop={(targetId, sourceIds) =&gt; handleMoveFiles(sourceIds, targetId)} onDropOnTag={handleDropOnTag} isCreatingTag={isCreatingTag} onStartCreateTag={handleCreateNewTag} onSaveNewTag={handleSaveNewTag} onCancelCreateTag={handleCancelCreateTag} onOpenSettings={toggleSettings} onRestoreTask={onRestoreTask} onStartRenamePerson={onStartRenamePerson} onCreatePerson={handleCreatePerson} t={t} /&gt;\n        &lt;/div&gt;\n        \n        &lt;div className=\"flex-1 flex flex-col min-w-0 relative bg-white dark:bg-gray-950\"&gt;\n          {activeTab.viewingFileId &amp;&amp; (\n              (() =&gt; {\n                  const viewingFile = state.files[activeTab.viewingFileId];\n                  const parentFolder = viewingFile &amp;&amp; viewingFile.parentId ? state.files[viewingFile.parentId] : null;\n                  \n                  if (parentFolder &amp;&amp; parentFolder.category === 'sequence') {\n                      return (\n                          &lt;SequenceViewer\n                              file={viewingFile}\n                              folder={parentFolder}\n                              files={state.files}\n                              sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)}\n                              onClose={closeViewer}\n                              onNavigate={handleViewerJump}\n                              isSidebarOpen={state.layout.isSidebarVisible}\n                              onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))}\n                              onDelete={(id) =&gt; requestDelete([id])}\n                              t={t}\n                          /&gt;\n                      );\n                  }\n              }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": " loadingInfo={loadingInfo} /&gt;",
            "lineNumber": 4468
          },
          {
            "text": "      {/* ... (SVG filters) ... */}",
            "lineNumber": 4469
          },
          {
            "text": "      &lt;svg style={{ display: 'none' }}&gt;&lt;defs&gt;&lt;filter id=\"channel-r\"&gt;&lt;feColorMatrix type=\"matrix\" values=\"1 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0\" /&gt;&lt;/filter&gt;&lt;filter id=\"channel-g\"&gt;&lt;feColorMatrix type=\"matrix\" values=\"0 0 0 0 0  0 1 0 0 0  0 0 0 0 0  0 0 0 1 0\" /&gt;&lt;/filter&gt;&lt;filter id=\"channel-b\"&gt;&lt;feColorMatrix type=\"matrix\" values=\"0 0 0 0 0  0 0 0 0 0  0 0 1 0 0  0 0 0 1 0\" /&gt;&lt;/filter&gt;&lt;filter id=\"channel-l\"&gt;&lt;feColorMatrix type=\"saturate\" values=\"0\" /&gt;&lt;/filter&gt;&lt;/defs&gt;&lt;/svg&gt;",
            "lineNumber": 4470
          },
          {
            "text": "      &lt;TabBar tabs={state.tabs} activeTabId={state.activeTabId} files={state.files} onSwitchTab={handleSwitchTab} onCloseTab={handleCloseTab} onNewTab={handleNewTab} onContextMenu={(e, id) =&gt; handleContextMenu(e, 'tab', id)} t={t} showWindowControls={!showSplash} /&gt;",
            "lineNumber": 4471
          },
          {
            "text": "      &lt;div className=\"flex-1 flex overflow-hidden relative transition-all duration-300 ease-[cubic-bezier(0.25,0.1,0.25,1)]\"&gt;",
            "lineNumber": 4472
          },
          {
            "text": "        &lt;div className={&#96;bg-gray-50 dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 flex flex-col transition-all duration-300 shrink-0 z-40 ${state.layout.isSidebarVisible ? 'w-64 translate-x-0 opacity-100' : 'w-0 -translate-x-full opacity-0 overflow-hidden'}&#96;}&gt;",
            "lineNumber": 4473
          },
          {
            "text": "          &lt;Sidebar roots={state.roots} files={state.files} people={state.people} customTags={state.customTags} currentFolderId={activeTab.folderId} expandedIds={state.expandedFolderIds} tasks={state.tasks} onToggle={handleToggleFolder} onNavigate={handleNavigateFolder} onTagSelect={enterTagView} onNavigateAllTags={enterTagsOverview} onPersonSelect={enterPersonView} onNavigateAllPeople={enterPeopleOverview} onContextMenu={handleContextMenu} onDrop={(targetId, sourceIds) =&gt; handleMoveFiles(sourceIds, targetId)} onDropOnTag={handleDropOnTag} isCreatingTag={isCreatingTag} onStartCreateTag={handleCreateNewTag} onSaveNewTag={handleSaveNewTag} onCancelCreateTag={handleCancelCreateTag} onOpenSettings={toggleSettings} onRestoreTask={onRestoreTask} onStartRenamePerson={onStartRenamePerson} onCreatePerson={handleCreatePerson} t={t} /&gt;",
            "lineNumber": 4474
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 4475
          },
          {
            "text": "        ",
            "lineNumber": 4476
          },
          {
            "text": "        &lt;div className=\"flex-1 flex flex-col min-w-0 relative bg-white dark:bg-gray-950\"&gt;",
            "lineNumber": 4477
          },
          {
            "text": "          {activeTab.viewingFileId &amp;&amp; (",
            "lineNumber": 4478
          },
          {
            "text": "              (() =&gt; {",
            "lineNumber": 4479
          },
          {
            "text": "                  const viewingFile = state.files[activeTab.viewingFileId];",
            "lineNumber": 4480
          },
          {
            "text": "                  const parentFolder = viewingFile &amp;&amp; viewingFile.parentId ? state.files[viewingFile.parentId] : null;",
            "lineNumber": 4481
          },
          {
            "text": "                  ",
            "lineNumber": 4482
          },
          {
            "text": "                  if (parentFolder &amp;&amp; parentFolder.category === 'sequence') {",
            "lineNumber": 4483
          },
          {
            "text": "                      return (",
            "lineNumber": 4484
          },
          {
            "text": "                          &lt;SequenceViewer",
            "lineNumber": 4485
          },
          {
            "text": "                              file={viewingFile}",
            "lineNumber": 4486
          },
          {
            "text": "                              folder={parentFolder}",
            "lineNumber": 4487
          },
          {
            "text": "                              files={state.files}",
            "lineNumber": 4488
          },
          {
            "text": "                              sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)}",
            "lineNumber": 4489
          },
          {
            "text": "                              onClose={closeViewer}",
            "lineNumber": 4490
          },
          {
            "text": "                              onNavigate={handleViewerJump}",
            "lineNumber": 4491
          },
          {
            "text": "                              isSidebarOpen={state.layout.isSidebarVisible}",
            "lineNumber": 4492
          },
          {
            "text": "                              onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))}",
            "lineNumber": 4493
          },
          {
            "text": "                              onDelete={(id) =&gt; requestDelete([id])}",
            "lineNumber": 4494
          },
          {
            "text": "                              t={t}",
            "lineNumber": 4495
          },
          {
            "text": "                          /&gt;",
            "lineNumber": 4496
          },
          {
            "text": "                      );",
            "lineNumber": 4497
          },
          {
            "text": "                  }",
            "lineNumber": 4498
          },
          {
            "text": "              }",
            "lineNumber": 4535
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.35369324684143066
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\ntag =&gt; (\n\n                                  &lt;/div&gt;\n                                ))}\n                              &lt;/div&gt;\n                            );\n                          })()}\n                        &lt;/div&gt;\n                      &lt;/div&gt;\n                    &lt;/div&gt;\n                  ) : activeTab.viewMode === 'people-overview' ? (\n                    &lt;div className=\"flex items-center w-full justify-between\"&gt;\n                      &lt;div className=\"flex items-center\"&gt;\n                        &lt;User size={12} className=\"mr-1\"/&gt;\n                        &lt;span&gt;{t('context.allPeople')}&lt;/span&gt;\n                      &lt;/div&gt;\n                      &lt;div className=\"text-[10px] opacity-60\"&gt;\n                        {Object.keys(state.people).length} {t('context.items')}\n                      &lt;/div&gt;\n                    &lt;/div&gt;\n                  ) : (\n                    &lt;div\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4673
          },
          {
            "text": "tag =&gt; (",
            "lineNumber": 4696
          },
          {
            "lineNumber": 4702
          },
          {
            "text": "                                  &lt;/div&gt;",
            "lineNumber": 4703
          },
          {
            "text": "                                ))}",
            "lineNumber": 4704
          },
          {
            "text": "                              &lt;/div&gt;",
            "lineNumber": 4705
          },
          {
            "text": "                            );",
            "lineNumber": 4706
          },
          {
            "text": "                          })()}",
            "lineNumber": 4707
          },
          {
            "text": "                        &lt;/div&gt;",
            "lineNumber": 4708
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4709
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 4710
          },
          {
            "text": "                  ) : activeTab.viewMode === 'people-overview' ? (",
            "lineNumber": 4711
          },
          {
            "text": "                    &lt;div className=\"flex items-center w-full justify-between\"&gt;",
            "lineNumber": 4712
          },
          {
            "text": "                      &lt;div className=\"flex items-center\"&gt;",
            "lineNumber": 4713
          },
          {
            "text": "                        &lt;User size={12} className=\"mr-1\"/&gt;",
            "lineNumber": 4714
          },
          {
            "text": "                        &lt;span&gt;{t('context.allPeople')}&lt;/span&gt;",
            "lineNumber": 4715
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4716
          },
          {
            "text": "                      &lt;div className=\"text-[10px] opacity-60\"&gt;",
            "lineNumber": 4717
          },
          {
            "text": "                        {Object.keys(state.people).length} {t('context.items')}",
            "lineNumber": 4718
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4719
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 4720
          },
          {
            "text": "                  ) : (",
            "lineNumber": 4721
          },
          {
            "text": "                    &lt;div",
            "lineNumber": 4722
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.32550281286239624
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n                &lt;/div&gt;\n                &lt;div className=\"flex-1 overflow-hidden relative\" id=\"file-grid-container\"&gt;\n                  {displayFileIds.length === 0 &amp;&amp; activeTab.viewMode === 'browser' ? (\n                     &lt;div className=\"w-full h-full flex flex-col items-center justify-center text-gray-400\" onMouseDown={handleMouseDown} onContextMenu={(e) =&gt; handleContextMenu(e, 'background', '')}&gt;\n                        &lt;div className=\"text-6xl mb-4 opacity-20\"&gt;&lt;FolderOpen/&gt;&lt;/div&gt;\n                        &lt;p&gt;{t('context.noFiles')}&lt;/p&gt;\n                     &lt;/div&gt;\n                  ) :  (\n                    &lt;FileGrid \n                        displayFileIds={displayFileIds} \n                        files={state.files} \n                        activeTab={activeTab} \n                        renamingId={state.renamingId} \n                        thumbnailSize={state.thumbnailSize} \n                        resourceRoot={state.settings.paths.resourceRoot}\n                        cachePath={state.settings.paths.cacheRoot || (state.settings.paths.resourceRoot ? &#96;${state.settings.paths.resourceRoot}${state.settings.paths.resourceRoot.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96; : undefined)} \n                        hoverPlayingId={hoverPlayingId} \n                        onSetHoverPlayingId={setHoverPlayingId} \n                        onFileClick={handleFileClick}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "lineNumber": 4733
          },
          {
            "text": "                &lt;/div&gt;",
            "lineNumber": 4734
          },
          {
            "text": "                &lt;div className=\"flex-1 overflow-hidden relative\" id=\"file-grid-container\"&gt;",
            "lineNumber": 4735
          },
          {
            "text": "                  {displayFileIds.length === 0 &amp;&amp; activeTab.viewMode === 'browser' ? (",
            "lineNumber": 4736
          },
          {
            "text": "                     &lt;div className=\"w-full h-full flex flex-col items-center justify-center text-gray-400\" onMouseDown={handleMouseDown} onContextMenu={(e) =&gt; handleContextMenu(e, 'background', '')}&gt;",
            "lineNumber": 4737
          },
          {
            "text": "                        &lt;div className=\"text-6xl mb-4 opacity-20\"&gt;&lt;FolderOpen/&gt;&lt;/div&gt;",
            "lineNumber": 4738
          },
          {
            "text": "                        &lt;p&gt;{t('context.noFiles')}&lt;/p&gt;",
            "lineNumber": 4739
          },
          {
            "text": "                     &lt;/div&gt;",
            "lineNumber": 4740
          },
          {
            "text": "                  ) :  (",
            "lineNumber": 4741
          },
          {
            "text": "                    &lt;FileGrid ",
            "lineNumber": 4742
          },
          {
            "text": "                        displayFileIds={displayFileIds} ",
            "lineNumber": 4743
          },
          {
            "text": "                        files={state.files} ",
            "lineNumber": 4744
          },
          {
            "text": "                        activeTab={activeTab} ",
            "lineNumber": 4745
          },
          {
            "text": "                        renamingId={state.renamingId} ",
            "lineNumber": 4746
          },
          {
            "text": "                        thumbnailSize={state.thumbnailSize} ",
            "lineNumber": 4747
          },
          {
            "text": "                        resourceRoot={state.settings.paths.resourceRoot}",
            "lineNumber": 4748
          },
          {
            "text": "                        cachePath={state.settings.paths.cacheRoot || (state.settings.paths.resourceRoot ? &#96;${state.settings.paths.resourceRoot}${state.settings.paths.resourceRoot.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96; : undefined)} ",
            "lineNumber": 4749
          },
          {
            "text": "                        hoverPlayingId={hoverPlayingId} ",
            "lineNumber": 4750
          },
          {
            "text": "                        onSetHoverPlayingId={setHoverPlayingId} ",
            "lineNumber": 4751
          },
          {
            "text": "                        onFileClick={handleFileClick}",
            "lineNumber": 4752
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.32104960083961487
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleExternalFileDrop = async \n\n      \n      setDragFiles(null);\n  };\n\n  const handleFileClick = (e: React.MouseEvent, id: string) =&gt; {\n    e.stopPropagation();\n    \n    // 关闭右键菜单\n    closeContextMenu();\n    \n    // If we just finished a selection box operation, don't process the click\n    if (isSelecting) return;\n    \n    const isCtrl = e.ctrlKey || e.metaKey; // Ctrl for Windows/Linux, Command for macOS\n    const isShift = e.shiftKey;\n    \n    let newSelectedFileIds: string[];\n    let newLastSelectedId: string = id;\n    \n    if (isCtrl) {\n      // Ctrl+Click: Toggle selection of this file\n      if (activeTab.selectedFileIds.includes(id)) {\n        // Remove from selection\n        newSelectedFileIds = activeTab.selectedFileIds.filter(fileId =&gt; fileId !== id);\n      } else {\n        // Add to selection\n        newSelectedFileIds = [...activeTab.selectedFileIds, id];\n      }\n    } else if (isShift &amp;&amp; activeTab.lastSelectedId &amp;&amp; activeTab.selectedFileIds.length &gt; 0) {\n      // Shift+Click: Select range from last selected to current\n      const currentFolderId = activeTab.folderId;\n      let allFiles: string[] = [];\n      \n      if (activeTab.searchQuery) {\n        // Search results view\n        allFiles = displayFileIds;\n      } else {\n        // Folder view - use displayFileIds which already contains the sorted and filtered list of files to display\n        allFiles = displayFileIds;\n      }\n      \n      const lastIndex = allFiles.indexOf(activeTab.lastSelectedId);\n      const currentIndex = allFiles.indexOf(id);\n      \n      if (lastIndex !== -1 &amp;&amp; currentIndex !== -1) {\n        const start = Math.min(lastIndex, currentIndex);\n        const end = Math.max(lastIndex, currentIndex);\n        newSelectedFileIds = allFiles.slice(start, end + 1);\n      } else {\n        newSelectedFileIds = [id];\n      }\n    } else {\n      // Normal click: Select only this file\n      newSelectedFileIds = [id];\n    }\n    \n    updateActiveTab({ \n        selectedFileIds: newSelectedFileIds, \n        lastSelectedId: newLastSelectedId \n    });\n  };\n\n  const handleMouseDown = (e: React.MouseEvent) =&gt; {\n    // 关闭右键菜单\n    closeContextMenu();\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleExternalFileDrop = async ",
            "lineNumber": 1721
          },
          {
            "lineNumber": 1759
          },
          {
            "text": "      ",
            "lineNumber": 1760
          },
          {
            "text": "      setDragFiles(null);",
            "lineNumber": 1761
          },
          {
            "text": "  };",
            "lineNumber": 1762
          },
          {
            "lineNumber": 1763
          },
          {
            "text": "  const handleFileClick = (e: React.MouseEvent, id: string) =&gt; {",
            "lineNumber": 1764
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 1765
          },
          {
            "text": "    ",
            "lineNumber": 1766
          },
          {
            "text": "    // 关闭右键菜单",
            "lineNumber": 1767
          },
          {
            "text": "    closeContextMenu();",
            "lineNumber": 1768
          },
          {
            "text": "    ",
            "lineNumber": 1769
          },
          {
            "text": "    // If we just finished a selection box operation, don't process the click",
            "lineNumber": 1770
          },
          {
            "text": "    if (isSelecting) return;",
            "lineNumber": 1771
          },
          {
            "text": "    ",
            "lineNumber": 1772
          },
          {
            "text": "    const isCtrl = e.ctrlKey || e.metaKey; // Ctrl for Windows/Linux, Command for macOS",
            "lineNumber": 1773
          },
          {
            "text": "    const isShift = e.shiftKey;",
            "lineNumber": 1774
          },
          {
            "text": "    ",
            "lineNumber": 1775
          },
          {
            "text": "    let newSelectedFileIds: string[];",
            "lineNumber": 1776
          },
          {
            "text": "    let newLastSelectedId: string = id;",
            "lineNumber": 1777
          },
          {
            "text": "    ",
            "lineNumber": 1778
          },
          {
            "text": "    if (isCtrl) {",
            "lineNumber": 1779
          },
          {
            "text": "      // Ctrl+Click: Toggle selection of this file",
            "lineNumber": 1780
          },
          {
            "text": "      if (activeTab.selectedFileIds.includes(id)) {",
            "lineNumber": 1781
          },
          {
            "text": "        // Remove from selection",
            "lineNumber": 1782
          },
          {
            "text": "        newSelectedFileIds = activeTab.selectedFileIds.filter(fileId =&gt; fileId !== id);",
            "lineNumber": 1783
          },
          {
            "text": "      } else {",
            "lineNumber": 1784
          },
          {
            "text": "        // Add to selection",
            "lineNumber": 1785
          },
          {
            "text": "        newSelectedFileIds = [...activeTab.selectedFileIds, id];",
            "lineNumber": 1786
          },
          {
            "text": "      }",
            "lineNumber": 1787
          },
          {
            "text": "    } else if (isShift &amp;&amp; activeTab.lastSelectedId &amp;&amp; activeTab.selectedFileIds.length &gt; 0) {",
            "lineNumber": 1788
          },
          {
            "text": "      // Shift+Click: Select range from last selected to current",
            "lineNumber": 1789
          },
          {
            "text": "      const currentFolderId = activeTab.folderId;",
            "lineNumber": 1790
          },
          {
            "text": "      let allFiles: string[] = [];",
            "lineNumber": 1791
          },
          {
            "text": "      ",
            "lineNumber": 1792
          },
          {
            "text": "      if (activeTab.searchQuery) {",
            "lineNumber": 1793
          },
          {
            "text": "        // Search results view",
            "lineNumber": 1794
          },
          {
            "text": "        allFiles = displayFileIds;",
            "lineNumber": 1795
          },
          {
            "text": "      } else {",
            "lineNumber": 1796
          },
          {
            "text": "        // Folder view - use displayFileIds which already contains the sorted and filtered list of files to display",
            "lineNumber": 1797
          },
          {
            "text": "        allFiles = displayFileIds;",
            "lineNumber": 1798
          },
          {
            "text": "      }",
            "lineNumber": 1799
          },
          {
            "text": "      ",
            "lineNumber": 1800
          },
          {
            "text": "      const lastIndex = allFiles.indexOf(activeTab.lastSelectedId);",
            "lineNumber": 1801
          },
          {
            "text": "      const currentIndex = allFiles.indexOf(id);",
            "lineNumber": 1802
          },
          {
            "text": "      ",
            "lineNumber": 1803
          },
          {
            "text": "      if (lastIndex !== -1 &amp;&amp; currentIndex !== -1) {",
            "lineNumber": 1804
          },
          {
            "text": "        const start = Math.min(lastIndex, currentIndex);",
            "lineNumber": 1805
          },
          {
            "text": "        const end = Math.max(lastIndex, currentIndex);",
            "lineNumber": 1806
          },
          {
            "text": "        newSelectedFileIds = allFiles.slice(start, end + 1);",
            "lineNumber": 1807
          },
          {
            "text": "      } else {",
            "lineNumber": 1808
          },
          {
            "text": "        newSelectedFileIds = [id];",
            "lineNumber": 1809
          },
          {
            "text": "      }",
            "lineNumber": 1810
          },
          {
            "text": "    } else {",
            "lineNumber": 1811
          },
          {
            "text": "      // Normal click: Select only this file",
            "lineNumber": 1812
          },
          {
            "text": "      newSelectedFileIds = [id];",
            "lineNumber": 1813
          },
          {
            "text": "    }",
            "lineNumber": 1814
          },
          {
            "text": "    ",
            "lineNumber": 1815
          },
          {
            "text": "    updateActiveTab({ ",
            "lineNumber": 1816
          },
          {
            "text": "        selectedFileIds: newSelectedFileIds, ",
            "lineNumber": 1817
          },
          {
            "text": "        lastSelectedId: newLastSelectedId ",
            "lineNumber": 1818
          },
          {
            "text": "    });",
            "lineNumber": 1819
          },
          {
            "text": "  };",
            "lineNumber": 1820
          },
          {
            "lineNumber": 1821
          },
          {
            "text": "  const handleMouseDown = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 1822
          },
          {
            "text": "    // 关闭右键菜单",
            "lineNumber": 1823
          },
          {
            "text": "    closeContextMenu();",
            "lineNumber": 1824
          },
          {
            "text": ";",
            "lineNumber": 1855
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.3115975856781006
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\n\n                              t={t}\n                          /&gt;\n                      );\n                  }\n\n                  return (\n                      &lt;ImageViewer\n                          file={state.files[activeTab.viewingFileId]}\n                          sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)} \n                          files={state.files}\n                          layout={state.layout}\n                          slideshowConfig={state.slideshowConfig}\n                          onLayoutToggle={(part) =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, [part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible']: !s.layout[part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible'] } }))}\n                          onClose={closeViewer}\n                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}\n                          onPrev={() =&gt; handleViewerNavigate('prev')}\n                          onNavigateBack={goBack}\n                          onNavigateForward={goForward}\n                          canGoBack={activeTab.history.currentIndex &gt; 0}\n                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}\n                          onDelete={(id) =&gt; requestDelete([id])}\n                          onViewInExplorer={handleViewInExplorer}\n                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}\n                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}\n                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}\n                          searchQuery={activeTab.searchQuery}\n                          onSearch={handleViewerSearch}\n                          searchScope={activeTab.searchScope}\n                          onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })}\n                          onUpdateSlideshowConfig={(cfg) =&gt; setState(s =&gt; ({ ...s, slideshowConfig: cfg }))}\n                          onPasteTags={(id) =&gt; handlePasteTags([id])}\n                          onEditTags={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'edit-tags', data: { fileId: activeTab.viewingFileId } } }))}\n                          onCopyTags={() =&gt; handleCopyTags([activeTab.viewingFileId!])}\n              }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4479
          },
          {
            "lineNumber": 4494
          },
          {
            "text": "                              t={t}",
            "lineNumber": 4495
          },
          {
            "text": "                          /&gt;",
            "lineNumber": 4496
          },
          {
            "text": "                      );",
            "lineNumber": 4497
          },
          {
            "text": "                  }",
            "lineNumber": 4498
          },
          {
            "lineNumber": 4499
          },
          {
            "text": "                  return (",
            "lineNumber": 4500
          },
          {
            "text": "                      &lt;ImageViewer",
            "lineNumber": 4501
          },
          {
            "text": "                          file={state.files[activeTab.viewingFileId]}",
            "lineNumber": 4502
          },
          {
            "text": "                          sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)} ",
            "lineNumber": 4503
          },
          {
            "text": "                          files={state.files}",
            "lineNumber": 4504
          },
          {
            "text": "                          layout={state.layout}",
            "lineNumber": 4505
          },
          {
            "text": "                          slideshowConfig={state.slideshowConfig}",
            "lineNumber": 4506
          },
          {
            "text": "                          onLayoutToggle={(part) =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, [part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible']: !s.layout[part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible'] } }))}",
            "lineNumber": 4507
          },
          {
            "text": "                          onClose={closeViewer}",
            "lineNumber": 4508
          },
          {
            "text": "                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}",
            "lineNumber": 4509
          },
          {
            "text": "                          onPrev={() =&gt; handleViewerNavigate('prev')}",
            "lineNumber": 4510
          },
          {
            "text": "                          onNavigateBack={goBack}",
            "lineNumber": 4511
          },
          {
            "text": "                          onNavigateForward={goForward}",
            "lineNumber": 4512
          },
          {
            "text": "                          canGoBack={activeTab.history.currentIndex &gt; 0}",
            "lineNumber": 4513
          },
          {
            "text": "                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}",
            "lineNumber": 4514
          },
          {
            "text": "                          onDelete={(id) =&gt; requestDelete([id])}",
            "lineNumber": 4515
          },
          {
            "text": "                          onViewInExplorer={handleViewInExplorer}",
            "lineNumber": 4516
          },
          {
            "text": "                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4517
          },
          {
            "text": "                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4518
          },
          {
            "text": "                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}",
            "lineNumber": 4519
          },
          {
            "text": "                          searchQuery={activeTab.searchQuery}",
            "lineNumber": 4520
          },
          {
            "text": "                          onSearch={handleViewerSearch}",
            "lineNumber": 4521
          },
          {
            "text": "                          searchScope={activeTab.searchScope}",
            "lineNumber": 4522
          },
          {
            "text": "                          onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })}",
            "lineNumber": 4523
          },
          {
            "text": "                          onUpdateSlideshowConfig={(cfg) =&gt; setState(s =&gt; ({ ...s, slideshowConfig: cfg }))}",
            "lineNumber": 4524
          },
          {
            "text": "                          onPasteTags={(id) =&gt; handlePasteTags([id])}",
            "lineNumber": 4525
          },
          {
            "text": "                          onEditTags={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'edit-tags', data: { fileId: activeTab.viewingFileId } } }))}",
            "lineNumber": 4526
          },
          {
            "text": "                          onCopyTags={() =&gt; handleCopyTags([activeTab.viewingFileId!])}",
            "lineNumber": 4527
          },
          {
            "text": "              }",
            "lineNumber": 4535
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.3101541996002197
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n                      \n                      {/* Divider */}\n                      &lt;div className=\"w-1 bg-white/20\"&gt;&lt;/div&gt;\n                      \n                      {/* Move section */}\n                      &lt;div \n                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'move' ? 'bg-green-600/80' : 'bg-green-600/50 hover:bg-green-600/70'}&#96;}\n                      &gt;\n                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📁&lt;/div&gt;\n                        &lt;h3 className=\"text-white text-2xl font-bold mb-2\"&gt;{t('context.moveTo')}&lt;/h3&gt;\n                        &lt;p className=\"text-white/80 text-center max-w-xs\"&gt;{t('context.moveToCurrentFolder')}&lt;/p&gt;\n                      &lt;/div&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                )}\n                &lt;div className=\"h-14 flex items-center justify-between px-4 text-xs text-gray-500 dark:text-gray-400 border-b border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-950/50 backdrop-blur shrink-0 relative z-20\"&gt;\n                  {activeTab.viewMode === 'tags-overview' ? (\n                    &lt;div className=\"flex items-center w-full\"&gt;\n                      &lt;div className=\"flex items-center\"&gt;\n                        &lt;Tag size={12} className=\"mr-1\"/&gt;\n                        &lt;span className=\"font-medium\"&gt;{t('context.allTagsOverview')}&lt;/span&gt;\n                      &lt;/div&gt;\n                      &lt;div className=\"flex-1 flex justify-end\"&gt;\n                        &lt;div className=\"relative\" style={{ width: '250px' }}&gt;\n                          &lt;div className={&#96;flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border ${tagSearchQuery ? 'border-blue-500 shadow-sm' : 'border-transparent'}&#96;}&gt;\n                            &lt;Search size={14} className=\"mr-2 text-gray-400\" /&gt;\n                            &lt;input\n                              type=\"text\"\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "lineNumber": 4629
          },
          {
            "text": "                      ",
            "lineNumber": 4630
          },
          {
            "text": "                      {/* Divider */}",
            "lineNumber": 4631
          },
          {
            "text": "                      &lt;div className=\"w-1 bg-white/20\"&gt;&lt;/div&gt;",
            "lineNumber": 4632
          },
          {
            "text": "                      ",
            "lineNumber": 4633
          },
          {
            "text": "                      {/* Move section */}",
            "lineNumber": 4634
          },
          {
            "text": "                      &lt;div ",
            "lineNumber": 4635
          },
          {
            "text": "                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'move' ? 'bg-green-600/80' : 'bg-green-600/50 hover:bg-green-600/70'}&#96;}",
            "lineNumber": 4636
          },
          {
            "text": "                      &gt;",
            "lineNumber": 4637
          },
          {
            "text": "                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📁&lt;/div&gt;",
            "lineNumber": 4638
          },
          {
            "text": "                        &lt;h3 className=\"text-white text-2xl font-bold mb-2\"&gt;{t('context.moveTo')}&lt;/h3&gt;",
            "lineNumber": 4639
          },
          {
            "text": "                        &lt;p className=\"text-white/80 text-center max-w-xs\"&gt;{t('context.moveToCurrentFolder')}&lt;/p&gt;",
            "lineNumber": 4640
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4641
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 4642
          },
          {
            "text": "                  &lt;/div&gt;",
            "lineNumber": 4643
          },
          {
            "text": "                )}",
            "lineNumber": 4644
          },
          {
            "text": "                &lt;div className=\"h-14 flex items-center justify-between px-4 text-xs text-gray-500 dark:text-gray-400 border-b border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-950/50 backdrop-blur shrink-0 relative z-20\"&gt;",
            "lineNumber": 4645
          },
          {
            "text": "                  {activeTab.viewMode === 'tags-overview' ? (",
            "lineNumber": 4646
          },
          {
            "text": "                    &lt;div className=\"flex items-center w-full\"&gt;",
            "lineNumber": 4647
          },
          {
            "text": "                      &lt;div className=\"flex items-center\"&gt;",
            "lineNumber": 4648
          },
          {
            "text": "                        &lt;Tag size={12} className=\"mr-1\"/&gt;",
            "lineNumber": 4649
          },
          {
            "text": "                        &lt;span className=\"font-medium\"&gt;{t('context.allTagsOverview')}&lt;/span&gt;",
            "lineNumber": 4650
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4651
          },
          {
            "text": "                      &lt;div className=\"flex-1 flex justify-end\"&gt;",
            "lineNumber": 4652
          },
          {
            "text": "                        &lt;div className=\"relative\" style={{ width: '250px' }}&gt;",
            "lineNumber": 4653
          },
          {
            "text": "                          &lt;div className={&#96;flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border ${tagSearchQuery ? 'border-blue-500 shadow-sm' : 'border-transparent'}&#96;}&gt;",
            "lineNumber": 4654
          },
          {
            "text": "                            &lt;Search size={14} className=\"mr-2 text-gray-400\" /&gt;",
            "lineNumber": 4655
          },
          {
            "text": "                            &lt;input",
            "lineNumber": 4656
          },
          {
            "text": "                              type=\"text\"",
            "lineNumber": 4657
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.31000420451164246
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nfor (let fileIndex = 0; fileIndex &lt; imageFileIds.length; fileIndex++) {\nprev =&gt; (\n\n                  files: {\n                      ...prev.files,\n                      [fileId]: updatedFile\n                  }\n              }));\n          }\n          \n          // If folderId is provided, summarize all results and update folder description\n          if (folderId) {\n              updateTask(taskId, { current: totalSteps, currentStep: t('tasks.summarizing') });\n              const folder = state.files[folderId];\n              if (folder) {\n                  // Prepare all content (descriptions, extracted text, translated text) into a single text block\n                  const allContent = allResults\n                      .map((result, index) =&gt; {\n                          let content = &#96;Image ${index + 1}: ${result.description || 'No description'}&#96;;\n                          if (result.extractedText) {\n                              content += &#96;\\nExtracted Text: ${result.extractedText}&#96;;\n                          }\n                          if (result.translatedText) {\n                              content += &#96;\\nTranslated Text: ${result.translatedText}&#96;;\n                          }\n                          return content;\n                      })\n                      .join('\\n\\n');\n                  \n                  if (allContent)\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 4216,
                "column": 15
              },
              "endPosition": {
                "line": 4216,
                "column": 15
              }
            },
            {
              "startPosition": {
                "line": 4216,
                "column": 16
              },
              "endPosition": {
                "line": 4217,
                "column": 19
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3648
          },
          {
            "text": "for (let fileIndex = 0; fileIndex &lt; imageFileIds.length; fileIndex++) {",
            "lineNumber": 4071
          },
          {
            "text": "prev =&gt; (",
            "lineNumber": 4233
          },
          {
            "lineNumber": 4235
          },
          {
            "text": "                  files: {",
            "lineNumber": 4236
          },
          {
            "text": "                      ...prev.files,",
            "lineNumber": 4237
          },
          {
            "text": "                      [fileId]: updatedFile",
            "lineNumber": 4238
          },
          {
            "text": "                  }",
            "lineNumber": 4239
          },
          {
            "text": "              }));",
            "lineNumber": 4240
          },
          {
            "text": "          }",
            "lineNumber": 4241
          },
          {
            "text": "          ",
            "lineNumber": 4242
          },
          {
            "text": "          // If folderId is provided, summarize all results and update folder description",
            "lineNumber": 4243
          },
          {
            "text": "          if (folderId) {",
            "lineNumber": 4244
          },
          {
            "text": "              updateTask(taskId, { current: totalSteps, currentStep: t('tasks.summarizing') });",
            "lineNumber": 4245
          },
          {
            "text": "              const folder = state.files[folderId];",
            "lineNumber": 4246
          },
          {
            "text": "              if (folder) {",
            "lineNumber": 4247
          },
          {
            "text": "                  // Prepare all content (descriptions, extracted text, translated text) into a single text block",
            "lineNumber": 4248
          },
          {
            "text": "                  const allContent = allResults",
            "lineNumber": 4249
          },
          {
            "text": "                      .map((result, index) =&gt; {",
            "lineNumber": 4250
          },
          {
            "text": "                          let content = &#96;Image ${index + 1}: ${result.description || 'No description'}&#96;;",
            "lineNumber": 4251
          },
          {
            "text": "                          if (result.extractedText) {",
            "lineNumber": 4252
          },
          {
            "text": "                              content += &#96;\\nExtracted Text: ${result.extractedText}&#96;;",
            "lineNumber": 4253
          },
          {
            "text": "                          }",
            "lineNumber": 4254
          },
          {
            "text": "                          if (result.translatedText) {",
            "lineNumber": 4255
          },
          {
            "text": "                              content += &#96;\\nTranslated Text: ${result.translatedText}&#96;;",
            "lineNumber": 4256
          },
          {
            "text": "                          }",
            "lineNumber": 4257
          },
          {
            "text": "                          return content;",
            "lineNumber": 4258
          },
          {
            "text": "                      })",
            "lineNumber": 4259
          },
          {
            "text": "                      .join('\\n\\n');",
            "lineNumber": 4260
          },
          {
            "text": "                  ",
            "lineNumber": 4261
          },
          {
            "text": "                  if (allContent)",
            "lineNumber": 4262
          },
          {
            "text": ";",
            "lineNumber": 4414
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.3084903061389923
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n 'bg-blue-600/50 hover:bg-blue-600/70'}&#96;}\n                      &gt;\n                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📋&lt;/div&gt;\n                        &lt;h3 className=\"text-white text-2xl font-bold mb-2\"&gt;{t('context.copyTo')}&lt;/h3&gt;\n                        &lt;p className=\"text-white/80 text-center max-w-xs\"&gt;{t('context.copyToCurrentFolder')}&lt;/p&gt;\n                      &lt;/div&gt;\n                      \n                      {/* Divider */}\n                      &lt;div className=\"w-1 bg-white/20\"&gt;&lt;/div&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": " 'bg-blue-600/50 hover:bg-blue-600/70'}&#96;}",
            "lineNumber": 4624
          },
          {
            "text": "                      &gt;",
            "lineNumber": 4625
          },
          {
            "text": "                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📋&lt;/div&gt;",
            "lineNumber": 4626
          },
          {
            "text": "                        &lt;h3 className=\"text-white text-2xl font-bold mb-2\"&gt;{t('context.copyTo')}&lt;/h3&gt;",
            "lineNumber": 4627
          },
          {
            "text": "                        &lt;p className=\"text-white/80 text-center max-w-xs\"&gt;{t('context.copyToCurrentFolder')}&lt;/p&gt;",
            "lineNumber": 4628
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4629
          },
          {
            "text": "                      ",
            "lineNumber": 4630
          },
          {
            "text": "                      {/* Divider */}",
            "lineNumber": 4631
          },
          {
            "text": "                      &lt;div className=\"w-1 bg-white/20\"&gt;&lt;/div&gt;",
            "lineNumber": 4632
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.2980329990386963
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleRenameSubmit = async \n\n              }\n              \n              await handleRefresh();\n              setState(s =&gt; ({ ...s, renamingId: null }));\n          } catch (e) {\n              console.error(\"Rename failed\", e);\n              showToast(\"Rename failed\");\n          }\n      } else {\n          handleUpdateFile(id, { name: value });\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 3111,
                "column": 3
              },
              "endPosition": {
                "line": 3111,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 3111,
                "column": 9
              },
              "endPosition": {
                "line": 3111,
                "column": 29
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleRenameSubmit = async ",
            "lineNumber": 3124
          },
          {
            "lineNumber": 3141
          },
          {
            "text": "              }",
            "lineNumber": 3142
          },
          {
            "text": "              ",
            "lineNumber": 3143
          },
          {
            "text": "              await handleRefresh();",
            "lineNumber": 3144
          },
          {
            "text": "              setState(s =&gt; ({ ...s, renamingId: null }));",
            "lineNumber": 3145
          },
          {
            "text": "          } catch (e) {",
            "lineNumber": 3146
          },
          {
            "text": "              console.error(\"Rename failed\", e);",
            "lineNumber": 3147
          },
          {
            "text": "              showToast(\"Rename failed\");",
            "lineNumber": 3148
          },
          {
            "text": "          }",
            "lineNumber": 3149
          },
          {
            "text": "      } else {",
            "lineNumber": 3150
          },
          {
            "text": "          handleUpdateFile(id, { name: value });",
            "lineNumber": 3151
          },
          {
            "text": ";",
            "lineNumber": 3154
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.29662013053894043
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n() =&gt; { ({...contextMenu, visible: false}); }}&gt;\n             &lt;Maximize size={14} className=\"mr-2 opacity-70\"/&gt; {t('viewer.original')}\n          &lt;/div&gt;\n          &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleFitWindow(); setContextMenu({...contextMenu, visible: false}); }}&gt;\n             &lt;Minimize size={14} className=\"mr-2 opacity-70\"/&gt; {t('viewer.fit')}\n          &lt;/div&gt;\n          \n          &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;\n\n          &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { onViewInExplorer(file.id); setContextMenu({...contextMenu, visible: false}); }}&gt;\n             &lt;ExternalLink size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.viewInExplorer')}\n          &lt;/div&gt;\n          {(() =&gt; {\n            const parentId = file.parentId;\n            const isUnavailable = activeTab.viewMode === 'browser' &amp;&amp; activeTab.folderId === parentId;\n            return (\n              &lt;div \n                className={&#96;px-4 py-2 flex items-center ${isUnavailable ? 'text-gray-400 cursor-default' : 'hover:bg-blue-600 hover:text-white cursor-pointer'}&#96;} \n                onClick={() =&gt; { \n                  if (!isUnavailable &amp;&amp; parentId) { \n                    onNavigateToFolder(parentId); \n                    setContextMenu({...contextMenu, visible: false}); \n                  }\n                }}\n              &gt;\n                &lt;FolderOpen size={14} className={&#96;mr-2 opacity-70 ${isUnavailable ? 'opacity-40' : 'opacity-70'}&#96;}/&gt; \n                {t('context.openFolder')}\n              &lt;/div&gt;\n            );\n          }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "text": "() =&gt; { ({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 659
          },
          {
            "text": "             &lt;Maximize size={14} className=\"mr-2 opacity-70\"/&gt; {t('viewer.original')}",
            "lineNumber": 660
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 661
          },
          {
            "text": "          &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleFitWindow(); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 662
          },
          {
            "text": "             &lt;Minimize size={14} className=\"mr-2 opacity-70\"/&gt; {t('viewer.fit')}",
            "lineNumber": 663
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 664
          },
          {
            "text": "          ",
            "lineNumber": 665
          },
          {
            "text": "          &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;",
            "lineNumber": 666
          },
          {
            "lineNumber": 667
          },
          {
            "text": "          &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { onViewInExplorer(file.id); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 668
          },
          {
            "text": "             &lt;ExternalLink size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.viewInExplorer')}",
            "lineNumber": 669
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 670
          },
          {
            "text": "          {(() =&gt; {",
            "lineNumber": 671
          },
          {
            "text": "            const parentId = file.parentId;",
            "lineNumber": 672
          },
          {
            "text": "            const isUnavailable = activeTab.viewMode === 'browser' &amp;&amp; activeTab.folderId === parentId;",
            "lineNumber": 673
          },
          {
            "text": "            return (",
            "lineNumber": 674
          },
          {
            "text": "              &lt;div ",
            "lineNumber": 675
          },
          {
            "text": "                className={&#96;px-4 py-2 flex items-center ${isUnavailable ? 'text-gray-400 cursor-default' : 'hover:bg-blue-600 hover:text-white cursor-pointer'}&#96;} ",
            "lineNumber": 676
          },
          {
            "text": "                onClick={() =&gt; { ",
            "lineNumber": 677
          },
          {
            "text": "                  if (!isUnavailable &amp;&amp; parentId) { ",
            "lineNumber": 678
          },
          {
            "text": "                    onNavigateToFolder(parentId); ",
            "lineNumber": 679
          },
          {
            "text": "                    setContextMenu({...contextMenu, visible: false}); ",
            "lineNumber": 680
          },
          {
            "text": "                  }",
            "lineNumber": 681
          },
          {
            "text": "                }}",
            "lineNumber": 682
          },
          {
            "text": "              &gt;",
            "lineNumber": 683
          },
          {
            "text": "                &lt;FolderOpen size={14} className={&#96;mr-2 opacity-70 ${isUnavailable ? 'opacity-40' : 'opacity-70'}&#96;}/&gt; ",
            "lineNumber": 684
          },
          {
            "text": "                {t('context.openFolder')}",
            "lineNumber": 685
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 686
          },
          {
            "text": "            );",
            "lineNumber": 687
          },
          {
            "text": "          }",
            "lineNumber": 688
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.292275995016098
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 246
          },
          "endPosition": {
            "line": 1381,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \n(e) =&gt; {\n (e.key === 'Enter') {\n                            handleUpdateMeta();\n                        }\n                    }}\n                    placeholder=\"https://...\"\n                    className=\"flex-1 bg-transparent border-none py-2 px-3 text-sm text-blue-600 dark:text-blue-400 placeholder-gray-400 focus:outline-none\"\n                /&gt;\n                {(isMulti ? batchSource : source) &amp;&amp; (\n                    &lt;button \n                      onClick={() =&gt; window.electron?.openExternal(isMulti ? batchSource : source)}\n                      className=\"p-2 text-gray-400 hover:text-blue-500\"\n                      title={t('meta.openSource')}\n                    &gt;\n                        &lt;ExternalLink size={14} /&gt;\n                    &lt;/button&gt;\n                )}\n            &lt;/div&gt;\n            {isMulti &amp;&amp; (\n                &lt;div className=\"mt-3 space-y-2 max-h-40 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-200 dark:scrollbar-thumb-gray-700 pr-1\"&gt;\n                    {selectedFileIds.map(id =&gt; {\n                        const f = files[id];\n                        if (!f || !f.sourceUrl) return null;\n                        return (\n                            &lt;div key={id} className=\"flex items-center text-xs group bg-gray-50 dark:bg-gray-800/50 p-1.5 rounded border border-transparent hover:border-gray-200 dark:hover:border-gray-700 transition-colors\"&gt;\n                                &lt;div className=\"text-gray-500 dark:text-gray-400 w-20 truncate mr-2 font-medium shrink-0\" title={f.name}&gt;{f.name}&lt;/div&gt;\n                                &lt;button \n                                    onClick=\n                    }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 247
          },
          {
            "text": "(e) =&gt; {",
            "lineNumber": 1300
          },
          {
            "text": " (e.key === 'Enter') {",
            "lineNumber": 1301
          },
          {
            "text": "                            handleUpdateMeta();",
            "lineNumber": 1302
          },
          {
            "text": "                        }",
            "lineNumber": 1303
          },
          {
            "text": "                    }}",
            "lineNumber": 1304
          },
          {
            "text": "                    placeholder=\"https://...\"",
            "lineNumber": 1305
          },
          {
            "text": "                    className=\"flex-1 bg-transparent border-none py-2 px-3 text-sm text-blue-600 dark:text-blue-400 placeholder-gray-400 focus:outline-none\"",
            "lineNumber": 1306
          },
          {
            "text": "                /&gt;",
            "lineNumber": 1307
          },
          {
            "text": "                {(isMulti ? batchSource : source) &amp;&amp; (",
            "lineNumber": 1308
          },
          {
            "text": "                    &lt;button ",
            "lineNumber": 1309
          },
          {
            "text": "                      onClick={() =&gt; window.electron?.openExternal(isMulti ? batchSource : source)}",
            "lineNumber": 1310
          },
          {
            "text": "                      className=\"p-2 text-gray-400 hover:text-blue-500\"",
            "lineNumber": 1311
          },
          {
            "text": "                      title={t('meta.openSource')}",
            "lineNumber": 1312
          },
          {
            "text": "                    &gt;",
            "lineNumber": 1313
          },
          {
            "text": "                        &lt;ExternalLink size={14} /&gt;",
            "lineNumber": 1314
          },
          {
            "text": "                    &lt;/button&gt;",
            "lineNumber": 1315
          },
          {
            "text": "                )}",
            "lineNumber": 1316
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 1317
          },
          {
            "text": "            {isMulti &amp;&amp; (",
            "lineNumber": 1318
          },
          {
            "text": "                &lt;div className=\"mt-3 space-y-2 max-h-40 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-200 dark:scrollbar-thumb-gray-700 pr-1\"&gt;",
            "lineNumber": 1319
          },
          {
            "text": "                    {selectedFileIds.map(id =&gt; {",
            "lineNumber": 1320
          },
          {
            "text": "                        const f = files[id];",
            "lineNumber": 1321
          },
          {
            "text": "                        if (!f || !f.sourceUrl) return null;",
            "lineNumber": 1322
          },
          {
            "text": "                        return (",
            "lineNumber": 1323
          },
          {
            "text": "                            &lt;div key={id} className=\"flex items-center text-xs group bg-gray-50 dark:bg-gray-800/50 p-1.5 rounded border border-transparent hover:border-gray-200 dark:hover:border-gray-700 transition-colors\"&gt;",
            "lineNumber": 1324
          },
          {
            "text": "                                &lt;div className=\"text-gray-500 dark:text-gray-400 w-20 truncate mr-2 font-medium shrink-0\" title={f.name}&gt;{f.name}&lt;/div&gt;",
            "lineNumber": 1325
          },
          {
            "text": "                                &lt;button ",
            "lineNumber": 1326
          },
          {
            "text": "                                    onClick=",
            "lineNumber": 1327
          },
          {
            "text": "                    }",
            "lineNumber": 1335
          },
          {
            "text": ";",
            "lineNumber": 1382
          }
        ]
      },
      "score": 0.2759298086166382
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n \n                        onDragStart={handleDragStart} \n                        onDragEnd={handleDragEnd} \n                        onDropOnFolder={handleDropOnFolder} \n                        settings={state.settings}\n                        onDropExternal={(targetId, paths) =&gt; {\n                            // 1. 核心检查：如果是内部发起的拖拽 (isInternalDragRef.current = true)\n                            // 即使走到了 onDropExternal 通道，我们也把它强行扭转为“移动”操作\n                            if (isInternalDragRef.current) {\n                                handleMoveFiles(activeTab.selectedFileIds, targetId);\n                            } else {\n                                // 2. 确实是外部文件，执行复制\n                                if (window.electron) {\n                                     startTask('copy', [], t('tasks.copying'));\n                                     window.electron.copyExternalFiles(targetId, paths).then(() =&gt; {\n                                         showToast(t('context.copied'));\n                                         handleRefresh();\n                                     });\n                                }\n                            }\n                            \n                            // 别忘了重置\n                            \n                        }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": " ",
            "lineNumber": 4757
          },
          {
            "text": "                        onDragStart={handleDragStart} ",
            "lineNumber": 4758
          },
          {
            "text": "                        onDragEnd={handleDragEnd} ",
            "lineNumber": 4759
          },
          {
            "text": "                        onDropOnFolder={handleDropOnFolder} ",
            "lineNumber": 4760
          },
          {
            "text": "                        settings={state.settings}",
            "lineNumber": 4761
          },
          {
            "text": "                        onDropExternal={(targetId, paths) =&gt; {",
            "lineNumber": 4762
          },
          {
            "text": "                            // 1. 核心检查：如果是内部发起的拖拽 (isInternalDragRef.current = true)",
            "lineNumber": 4763
          },
          {
            "text": "                            // 即使走到了 onDropExternal 通道，我们也把它强行扭转为“移动”操作",
            "lineNumber": 4764
          },
          {
            "text": "                            if (isInternalDragRef.current) {",
            "lineNumber": 4765
          },
          {
            "text": "                                handleMoveFiles(activeTab.selectedFileIds, targetId);",
            "lineNumber": 4766
          },
          {
            "text": "                            } else {",
            "lineNumber": 4767
          },
          {
            "text": "                                // 2. 确实是外部文件，执行复制",
            "lineNumber": 4768
          },
          {
            "text": "                                if (window.electron) {",
            "lineNumber": 4769
          },
          {
            "text": "                                     startTask('copy', [], t('tasks.copying'));",
            "lineNumber": 4770
          },
          {
            "text": "                                     window.electron.copyExternalFiles(targetId, paths).then(() =&gt; {",
            "lineNumber": 4771
          },
          {
            "text": "                                         showToast(t('context.copied'));",
            "lineNumber": 4772
          },
          {
            "text": "                                         handleRefresh();",
            "lineNumber": 4773
          },
          {
            "text": "                                     });",
            "lineNumber": 4774
          },
          {
            "text": "                                }",
            "lineNumber": 4775
          },
          {
            "text": "                            }",
            "lineNumber": 4776
          },
          {
            "text": "                            ",
            "lineNumber": 4777
          },
          {
            "text": "                            // 别忘了重置",
            "lineNumber": 4778
          },
          {
            "text": "                            ",
            "lineNumber": 4779
          },
          {
            "text": "                        }",
            "lineNumber": 4780
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.27590954303741455
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1272
          },
          "endPosition": {
            "line": 1428,
            "column": 1
          }
        },
        "contents": "const useLayout = \n =&gt; {\n  const aspectRatios = useMemo(() =&gt; {\n    const ratios: Record&lt;string, number&gt; = {};\n    if (viewMode === 'browser') {\n      items.forEach(id =&gt; {\n        const file = files[id];\n        ratios[id] = file?.meta?.width &amp;&amp; file?.meta?.height \n          ? file.meta.width / file.meta.height \n          : (file?.type === FileType.FOLDER ? 1 : 1);\n      });\n    }\n    return ratios;\n  }, [items, files, viewMode]);\n\n  return useMemo(() =&gt; {\n    const layout: LayoutItem[] = [];\n    let totalHeight = 0;\n    const GAP = 16;\n    const PADDING = 24;\n    \n    // Ensure we have a reasonable width. If containerWidth is 0 (initial render), fall back to window width.\n    const safeContainerWidth = containerWidth &gt; 0 ? containerWidth : (typeof window !== 'undefined' ? window.innerWidth - 300 : 1200); \n    const availableWidth = Math.max(100, safeContainerWidth - (PADDING * 2));\n\n    if (viewMode === 'browser') {\n        if (layoutMode === 'list') {\n            const itemHeight = 44;\n            items.forEach((id, index) =&gt; {\n                layout.push({ id, x: PADDING, y: PADDING + index * itemHeight, width: availableWidth, height: itemHeight });\n            });\n            totalHeight = PADDING + items.length * itemHeight;\n        } else if (layoutMode === 'grid') {\n            const minColWidth = thumbnailSize;\n            const cols = Math.max(1, Math.floor((availableWidth + GAP) / (minColWidth + GAP)));\n            const itemWidth = (availableWidth - (cols - 1) * GAP) / cols;\n            const itemHeight = itemWidth + 40;\n\n            items.forEach((id, index) =&gt; {\n                const row = Math.floor(index / cols);\n                const col = index % cols;\n                layout.push({\n                    id,\n                    x: PADDING + col * (itemWidth + GAP),\n                    y: PADDING + row * (itemHeight + GAP),\n                    width: itemWidth,\n                    height: itemHeight\n                });\n            });\n            const rows = Math.ceil(items.length / cols);\n            totalHeight = PADDING + rows * (itemHeight + GAP);\n        } else if (layoutMode === 'adaptive') {\n            let currentRow: any[] = [];\n            let currentWidth = 0;\n            let y = PADDING;\n            const targetHeight = thumbnailSize;\n\n            items.forEach((id, index) =&gt; {\n                const aspect = aspectRatios[id];\n                const w = targetHeight * aspect;\n                \n                if (currentWidth + w + GAP &gt; availableWidth) {\n                    const scale = (availableWidth - (currentRow.length - 1) * GAP) / currentWidth;\n                    const rowHeight = targetHeight * scale;\n            }\n  }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const useLayout = ",
            "lineNumber": 1273
          },
          {
            "text": " =&gt; {",
            "lineNumber": 1282
          },
          {
            "text": "  const aspectRatios = useMemo(() =&gt; {",
            "lineNumber": 1283
          },
          {
            "text": "    const ratios: Record&lt;string, number&gt; = {};",
            "lineNumber": 1284
          },
          {
            "text": "    if (viewMode === 'browser') {",
            "lineNumber": 1285
          },
          {
            "text": "      items.forEach(id =&gt; {",
            "lineNumber": 1286
          },
          {
            "text": "        const file = files[id];",
            "lineNumber": 1287
          },
          {
            "text": "        ratios[id] = file?.meta?.width &amp;&amp; file?.meta?.height ",
            "lineNumber": 1288
          },
          {
            "text": "          ? file.meta.width / file.meta.height ",
            "lineNumber": 1289
          },
          {
            "text": "          : (file?.type === FileType.FOLDER ? 1 : 1);",
            "lineNumber": 1290
          },
          {
            "text": "      });",
            "lineNumber": 1291
          },
          {
            "text": "    }",
            "lineNumber": 1292
          },
          {
            "text": "    return ratios;",
            "lineNumber": 1293
          },
          {
            "text": "  }, [items, files, viewMode]);",
            "lineNumber": 1294
          },
          {
            "lineNumber": 1295
          },
          {
            "text": "  return useMemo(() =&gt; {",
            "lineNumber": 1296
          },
          {
            "text": "    const layout: LayoutItem[] = [];",
            "lineNumber": 1297
          },
          {
            "text": "    let totalHeight = 0;",
            "lineNumber": 1298
          },
          {
            "text": "    const GAP = 16;",
            "lineNumber": 1299
          },
          {
            "text": "    const PADDING = 24;",
            "lineNumber": 1300
          },
          {
            "text": "    ",
            "lineNumber": 1301
          },
          {
            "text": "    // Ensure we have a reasonable width. If containerWidth is 0 (initial render), fall back to window width.",
            "lineNumber": 1302
          },
          {
            "text": "    const safeContainerWidth = containerWidth &gt; 0 ? containerWidth : (typeof window !== 'undefined' ? window.innerWidth - 300 : 1200); ",
            "lineNumber": 1303
          },
          {
            "text": "    const availableWidth = Math.max(100, safeContainerWidth - (PADDING * 2));",
            "lineNumber": 1304
          },
          {
            "lineNumber": 1305
          },
          {
            "text": "    if (viewMode === 'browser') {",
            "lineNumber": 1306
          },
          {
            "text": "        if (layoutMode === 'list') {",
            "lineNumber": 1307
          },
          {
            "text": "            const itemHeight = 44;",
            "lineNumber": 1308
          },
          {
            "text": "            items.forEach((id, index) =&gt; {",
            "lineNumber": 1309
          },
          {
            "text": "                layout.push({ id, x: PADDING, y: PADDING + index * itemHeight, width: availableWidth, height: itemHeight });",
            "lineNumber": 1310
          },
          {
            "text": "            });",
            "lineNumber": 1311
          },
          {
            "text": "            totalHeight = PADDING + items.length * itemHeight;",
            "lineNumber": 1312
          },
          {
            "text": "        } else if (layoutMode === 'grid') {",
            "lineNumber": 1313
          },
          {
            "text": "            const minColWidth = thumbnailSize;",
            "lineNumber": 1314
          },
          {
            "text": "            const cols = Math.max(1, Math.floor((availableWidth + GAP) / (minColWidth + GAP)));",
            "lineNumber": 1315
          },
          {
            "text": "            const itemWidth = (availableWidth - (cols - 1) * GAP) / cols;",
            "lineNumber": 1316
          },
          {
            "text": "            const itemHeight = itemWidth + 40;",
            "lineNumber": 1317
          },
          {
            "lineNumber": 1318
          },
          {
            "text": "            items.forEach((id, index) =&gt; {",
            "lineNumber": 1319
          },
          {
            "text": "                const row = Math.floor(index / cols);",
            "lineNumber": 1320
          },
          {
            "text": "                const col = index % cols;",
            "lineNumber": 1321
          },
          {
            "text": "                layout.push({",
            "lineNumber": 1322
          },
          {
            "text": "                    id,",
            "lineNumber": 1323
          },
          {
            "text": "                    x: PADDING + col * (itemWidth + GAP),",
            "lineNumber": 1324
          },
          {
            "text": "                    y: PADDING + row * (itemHeight + GAP),",
            "lineNumber": 1325
          },
          {
            "text": "                    width: itemWidth,",
            "lineNumber": 1326
          },
          {
            "text": "                    height: itemHeight",
            "lineNumber": 1327
          },
          {
            "text": "                });",
            "lineNumber": 1328
          },
          {
            "text": "            });",
            "lineNumber": 1329
          },
          {
            "text": "            const rows = Math.ceil(items.length / cols);",
            "lineNumber": 1330
          },
          {
            "text": "            totalHeight = PADDING + rows * (itemHeight + GAP);",
            "lineNumber": 1331
          },
          {
            "text": "        } else if (layoutMode === 'adaptive') {",
            "lineNumber": 1332
          },
          {
            "text": "            let currentRow: any[] = [];",
            "lineNumber": 1333
          },
          {
            "text": "            let currentWidth = 0;",
            "lineNumber": 1334
          },
          {
            "text": "            let y = PADDING;",
            "lineNumber": 1335
          },
          {
            "text": "            const targetHeight = thumbnailSize;",
            "lineNumber": 1336
          },
          {
            "lineNumber": 1337
          },
          {
            "text": "            items.forEach((id, index) =&gt; {",
            "lineNumber": 1338
          },
          {
            "text": "                const aspect = aspectRatios[id];",
            "lineNumber": 1339
          },
          {
            "text": "                const w = targetHeight * aspect;",
            "lineNumber": 1340
          },
          {
            "text": "                ",
            "lineNumber": 1341
          },
          {
            "text": "                if (currentWidth + w + GAP &gt; availableWidth) {",
            "lineNumber": 1342
          },
          {
            "text": "                    const scale = (availableWidth - (currentRow.length - 1) * GAP) / currentWidth;",
            "lineNumber": 1343
          },
          {
            "text": "                    const rowHeight = targetHeight * scale;",
            "lineNumber": 1344
          },
          {
            "text": "            }",
            "lineNumber": 1360
          },
          {
            "text": "  }",
            "lineNumber": 1428
          },
          {
            "text": ";",
            "lineNumber": 1429
          }
        ]
      },
      "score": 0.2756423056125641
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n \n                        onSetHoverPlayingId={setHoverPlayingId} \n                        onFileClick={handleFileClick} \n                        onFileDoubleClick={(id) =&gt; state.files[id]?.type === FileType.FOLDER ? handleNavigateFolder(id) : enterViewer(id)} \n                        onContextMenu={(e, id) =&gt; handleContextMenu(e, 'file', id)} \n                        onRenameSubmit={handleRenameSubmit} \n                        onRenameCancel={() =&gt; setState(s =&gt; ({ ...s, renamingId: null }))} \n                        onStartRename={startRename} \n                        onDragStart={handleDragStart} \n                        onDragEnd={handleDragEnd}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": " ",
            "lineNumber": 4750
          },
          {
            "text": "                        onSetHoverPlayingId={setHoverPlayingId} ",
            "lineNumber": 4751
          },
          {
            "text": "                        onFileClick={handleFileClick} ",
            "lineNumber": 4752
          },
          {
            "text": "                        onFileDoubleClick={(id) =&gt; state.files[id]?.type === FileType.FOLDER ? handleNavigateFolder(id) : enterViewer(id)} ",
            "lineNumber": 4753
          },
          {
            "text": "                        onContextMenu={(e, id) =&gt; handleContextMenu(e, 'file', id)} ",
            "lineNumber": 4754
          },
          {
            "text": "                        onRenameSubmit={handleRenameSubmit} ",
            "lineNumber": 4755
          },
          {
            "text": "                        onRenameCancel={() =&gt; setState(s =&gt; ({ ...s, renamingId: null }))} ",
            "lineNumber": 4756
          },
          {
            "text": "                        onStartRename={startRename} ",
            "lineNumber": 4757
          },
          {
            "text": "                        onDragStart={handleDragStart} ",
            "lineNumber": 4758
          },
          {
            "text": "                        onDragEnd={handleDragEnd}",
            "lineNumber": 4759
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.2730942368507385
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n&gt;&lt;X size={12}/&gt;&lt;/button&gt;\n                          &lt;/div&gt;\n                      )}\n                      \n                      {activeTab.activeTags.map(tag =&gt; (\n                          &lt;div key={tag} className=\"flex items-center bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded-full text-xs border border-blue-200 dark:border-blue-800 whitespace-nowrap\"&gt;\n                              &lt;span&gt;{tag}&lt;/span&gt;\n                              &lt;button onClick={() =&gt; handleClearTagFilter(tag)} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;\n                          &lt;/div&gt;\n                      ))}\n                      \n                      &lt;button onClick={() =&gt; { handleClearAllTags(); handleClearPersonFilter(); updateActiveTab({ dateFilter: { start: null, end: null, mode: 'created' as const }, aiFilter: null }); }} className=\"text-xs text-gray-500 hover:text-red-500 underline ml-2 whitespace-nowrap\"&gt;{t('context.clearAll')}&lt;/button&gt;\n                  &lt;/div&gt;\n              )}\n              \n              &lt;div className=\"flex-1 flex flex-col relative bg-white dark:bg-gray-950 overflow-hidden\" \n                   onDragOver={handleDragOver}\n                   onDragLeave={handleDragLeave}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "&gt;&lt;X size={12}/&gt;&lt;/button&gt;",
            "lineNumber": 4597
          },
          {
            "text": "                          &lt;/div&gt;",
            "lineNumber": 4598
          },
          {
            "text": "                      )}",
            "lineNumber": 4599
          },
          {
            "text": "                      ",
            "lineNumber": 4600
          },
          {
            "text": "                      {activeTab.activeTags.map(tag =&gt; (",
            "lineNumber": 4601
          },
          {
            "text": "                          &lt;div key={tag} className=\"flex items-center bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded-full text-xs border border-blue-200 dark:border-blue-800 whitespace-nowrap\"&gt;",
            "lineNumber": 4602
          },
          {
            "text": "                              &lt;span&gt;{tag}&lt;/span&gt;",
            "lineNumber": 4603
          },
          {
            "text": "                              &lt;button onClick={() =&gt; handleClearTagFilter(tag)} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;",
            "lineNumber": 4604
          },
          {
            "text": "                          &lt;/div&gt;",
            "lineNumber": 4605
          },
          {
            "text": "                      ))}",
            "lineNumber": 4606
          },
          {
            "text": "                      ",
            "lineNumber": 4607
          },
          {
            "text": "                      &lt;button onClick={() =&gt; { handleClearAllTags(); handleClearPersonFilter(); updateActiveTab({ dateFilter: { start: null, end: null, mode: 'created' as const }, aiFilter: null }); }} className=\"text-xs text-gray-500 hover:text-red-500 underline ml-2 whitespace-nowrap\"&gt;{t('context.clearAll')}&lt;/button&gt;",
            "lineNumber": 4608
          },
          {
            "text": "                  &lt;/div&gt;",
            "lineNumber": 4609
          },
          {
            "text": "              )}",
            "lineNumber": 4610
          },
          {
            "text": "              ",
            "lineNumber": 4611
          },
          {
            "text": "              &lt;div className=\"flex-1 flex flex-col relative bg-white dark:bg-gray-950 overflow-hidden\" ",
            "lineNumber": 4612
          },
          {
            "text": "                   onDragOver={handleDragOver}",
            "lineNumber": 4613
          },
          {
            "text": "                   onDragLeave={handleDragLeave}",
            "lineNumber": 4614
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.2709771394729614
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\n(f: any) =&gt; {\n {\n                                f.tags.forEach((t: string) =&gt; allTags.add(t));\n                              }\n                            });\n                            state.customTags.forEach(t =&gt; allTags.add(t));\n                            \n                            const allTagsList = Array.from(allTags);\n                            const filteredTags = allTagsList.filter(tag =&gt; \n                              tag.toLowerCase().includes(tagSearchQuery.toLowerCase())\n                            );\n                            \n                            // 只有当有多个匹配标签或者当前搜索词与匹配标签不完全相同时才显示下拉列表\n                            const shouldShow = tagSearchQuery &amp;&amp; \n                                              filteredTags.length &gt; 0 &amp;&amp; \n                                              !(filteredTags.length === 1 &amp;&amp; filteredTags[0] === tagSearchQuery);\n                            \n                            if (!shouldShow) return null;\n                            \n                            return (\n                              &lt;div className=\"absolute top-full left-0 right-0 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 mt-1 rounded-lg shadow-xl z-50 max-h-40 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600\"&gt;\n                                {filteredTags.map(tag =&gt; (\n                                  &lt;div \n                                    key={tag} \n                                    className=\"px-4 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 text-sm cursor-pointer text-gray-800 dark:text-gray-200\"\n                                    onClick={() =&gt; setTagSearchQuery(tag)}\n                                  &gt;\n                                    {tag}\n                                )\n                          }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 4656,
                "column": 540
              },
              "endPosition": {
                "line": 4657,
                "column": 21
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4673
          },
          {
            "text": "(f: any) =&gt; {",
            "lineNumber": 4675
          },
          {
            "text": " {",
            "lineNumber": 4676
          },
          {
            "text": "                                f.tags.forEach((t: string) =&gt; allTags.add(t));",
            "lineNumber": 4677
          },
          {
            "text": "                              }",
            "lineNumber": 4678
          },
          {
            "text": "                            });",
            "lineNumber": 4679
          },
          {
            "text": "                            state.customTags.forEach(t =&gt; allTags.add(t));",
            "lineNumber": 4680
          },
          {
            "text": "                            ",
            "lineNumber": 4681
          },
          {
            "text": "                            const allTagsList = Array.from(allTags);",
            "lineNumber": 4682
          },
          {
            "text": "                            const filteredTags = allTagsList.filter(tag =&gt; ",
            "lineNumber": 4683
          },
          {
            "text": "                              tag.toLowerCase().includes(tagSearchQuery.toLowerCase())",
            "lineNumber": 4684
          },
          {
            "text": "                            );",
            "lineNumber": 4685
          },
          {
            "text": "                            ",
            "lineNumber": 4686
          },
          {
            "text": "                            // 只有当有多个匹配标签或者当前搜索词与匹配标签不完全相同时才显示下拉列表",
            "lineNumber": 4687
          },
          {
            "text": "                            const shouldShow = tagSearchQuery &amp;&amp; ",
            "lineNumber": 4688
          },
          {
            "text": "                                              filteredTags.length &gt; 0 &amp;&amp; ",
            "lineNumber": 4689
          },
          {
            "text": "                                              !(filteredTags.length === 1 &amp;&amp; filteredTags[0] === tagSearchQuery);",
            "lineNumber": 4690
          },
          {
            "text": "                            ",
            "lineNumber": 4691
          },
          {
            "text": "                            if (!shouldShow) return null;",
            "lineNumber": 4692
          },
          {
            "text": "                            ",
            "lineNumber": 4693
          },
          {
            "text": "                            return (",
            "lineNumber": 4694
          },
          {
            "text": "                              &lt;div className=\"absolute top-full left-0 right-0 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 mt-1 rounded-lg shadow-xl z-50 max-h-40 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600\"&gt;",
            "lineNumber": 4695
          },
          {
            "text": "                                {filteredTags.map(tag =&gt; (",
            "lineNumber": 4696
          },
          {
            "text": "                                  &lt;div ",
            "lineNumber": 4697
          },
          {
            "text": "                                    key={tag} ",
            "lineNumber": 4698
          },
          {
            "text": "                                    className=\"px-4 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 text-sm cursor-pointer text-gray-800 dark:text-gray-200\"",
            "lineNumber": 4699
          },
          {
            "text": "                                    onClick={() =&gt; setTagSearchQuery(tag)}",
            "lineNumber": 4700
          },
          {
            "text": "                                  &gt;",
            "lineNumber": 4701
          },
          {
            "text": "                                    {tag}",
            "lineNumber": 4702
          },
          {
            "text": "                                )",
            "lineNumber": 4704
          },
          {
            "text": "                          }",
            "lineNumber": 4707
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.26750659942626953
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\SequenceViewer.tsx",
        "range": {
          "startPosition": {
            "line": 22
          },
          "endPosition": {
            "line": 617,
            "column": 1
          }
        },
        "contents": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = \nconst handleMouseMove = \n\n      setDragStart({ x: e.clientX, y: e.clientY });\n    }\n  };\n\n  const handleMouseUp = () =&gt; setIsDragging(false);\n\n  const handleReset = () =&gt; {\n    setScale(1);\n    setPosition({ x: 0, y: 0 });\n  };\n\n  const handleOriginal = () =&gt; setScale(1);\n\n  const handleScrub = (e: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {\n    const newIndex = parseInt(e.target.value);\n    onNavigate(validFileIds[newIndex]);\n    if (isPlaying) setIsPlaying(false);\n  };\n\n  const handlePrev = () =&gt; {\n    const prevIndex = (currentIndex - 1 + totalFrames) % totalFrames;\n    onNavigate(validFileIds[prevIndex]);\n    setIsPlaying(false);\n  };\n\n  const handleNext = () =&gt; {\n    const nextIndex = (currentIndex + 1) % totalFrames;\n    onNavigate(validFileIds[nextIndex]);\n    setIsPlaying(false);\n  };\n\n  const togglePlay = () =&gt; setIsPlaying(prev =&gt; !prev);\n\n  const handleContextMenu = (e: React.MouseEvent) =&gt; {\n    e.preventDefault();\n    setContextMenu({ visible: true, x: e.clientX, y: e.clientY });\n  };\n\n  const handleDeleteRequest = () =&gt; {\n    setContextMenu({ ...contextMenu, visible: false });\n    setShowDeleteConfirm(true);\n  };\n\n  const handleDeleteConfirm = () =&gt; {\n    if (onDelete &amp;&amp; currentFile) {\n      onDelete(currentFile.id);\n    }\n    setShowDeleteConfirm(false);\n  };\n\n  return (\n    &lt;div \n        className={&#96;fixed top-10 right-0 bottom-0 z-[45] bg-gray-50 dark:bg-gray-950 flex text-gray-900 dark:text-gray-100 overflow-hidden font-sans transition-all duration-300 ${isSidebarOpen ? 'left-64' : 'left-0'}&#96;}\n        onClick={() =&gt; setContextMenu({ ...contextMenu, visible: false })}\n    &gt;\n      \n      {/* Main Content Area */}\n      &lt;div className=\"flex-1 flex flex-col relative h-full\"&gt;\n        {/* Header */}\n        &lt;div className=\"h-14 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between px-4 shrink-0 z-20 shadow-sm transition-colors\"&gt;\n           &lt;div className=\"flex items-center space-x-3 overflow-hidden\"&gt;\n              &lt;button \n                onClick={onToggleSidebar} \n                className={&#96;p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${isSidebarOpen ? 'text-blue-500 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}&#96;}\n                title={t('viewer.toggleSidebar')}\n              &gt;\n                &lt;Sidebar size={20} /&gt;\n              &lt;/button&gt;\n              &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 22,
                "column": 1
              },
              "endPosition": {
                "line": 22,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 8
              },
              "endPosition": {
                "line": 22,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 14
              },
              "endPosition": {
                "line": 22,
                "column": 62
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = ",
            "lineNumber": 23
          },
          {
            "text": "const handleMouseMove = ",
            "lineNumber": 219
          },
          {
            "lineNumber": 224
          },
          {
            "text": "      setDragStart({ x: e.clientX, y: e.clientY });",
            "lineNumber": 225
          },
          {
            "text": "    }",
            "lineNumber": 226
          },
          {
            "text": "  };",
            "lineNumber": 227
          },
          {
            "lineNumber": 228
          },
          {
            "text": "  const handleMouseUp = () =&gt; setIsDragging(false);",
            "lineNumber": 229
          },
          {
            "lineNumber": 230
          },
          {
            "text": "  const handleReset = () =&gt; {",
            "lineNumber": 231
          },
          {
            "text": "    setScale(1);",
            "lineNumber": 232
          },
          {
            "text": "    setPosition({ x: 0, y: 0 });",
            "lineNumber": 233
          },
          {
            "text": "  };",
            "lineNumber": 234
          },
          {
            "lineNumber": 235
          },
          {
            "text": "  const handleOriginal = () =&gt; setScale(1);",
            "lineNumber": 236
          },
          {
            "lineNumber": 237
          },
          {
            "text": "  const handleScrub = (e: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {",
            "lineNumber": 238
          },
          {
            "text": "    const newIndex = parseInt(e.target.value);",
            "lineNumber": 239
          },
          {
            "text": "    onNavigate(validFileIds[newIndex]);",
            "lineNumber": 240
          },
          {
            "text": "    if (isPlaying) setIsPlaying(false);",
            "lineNumber": 241
          },
          {
            "text": "  };",
            "lineNumber": 242
          },
          {
            "lineNumber": 243
          },
          {
            "text": "  const handlePrev = () =&gt; {",
            "lineNumber": 244
          },
          {
            "text": "    const prevIndex = (currentIndex - 1 + totalFrames) % totalFrames;",
            "lineNumber": 245
          },
          {
            "text": "    onNavigate(validFileIds[prevIndex]);",
            "lineNumber": 246
          },
          {
            "text": "    setIsPlaying(false);",
            "lineNumber": 247
          },
          {
            "text": "  };",
            "lineNumber": 248
          },
          {
            "lineNumber": 249
          },
          {
            "text": "  const handleNext = () =&gt; {",
            "lineNumber": 250
          },
          {
            "text": "    const nextIndex = (currentIndex + 1) % totalFrames;",
            "lineNumber": 251
          },
          {
            "text": "    onNavigate(validFileIds[nextIndex]);",
            "lineNumber": 252
          },
          {
            "text": "    setIsPlaying(false);",
            "lineNumber": 253
          },
          {
            "text": "  };",
            "lineNumber": 254
          },
          {
            "lineNumber": 255
          },
          {
            "text": "  const togglePlay = () =&gt; setIsPlaying(prev =&gt; !prev);",
            "lineNumber": 256
          },
          {
            "lineNumber": 257
          },
          {
            "text": "  const handleContextMenu = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 258
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 259
          },
          {
            "text": "    setContextMenu({ visible: true, x: e.clientX, y: e.clientY });",
            "lineNumber": 260
          },
          {
            "text": "  };",
            "lineNumber": 261
          },
          {
            "lineNumber": 262
          },
          {
            "text": "  const handleDeleteRequest = () =&gt; {",
            "lineNumber": 263
          },
          {
            "text": "    setContextMenu({ ...contextMenu, visible: false });",
            "lineNumber": 264
          },
          {
            "text": "    setShowDeleteConfirm(true);",
            "lineNumber": 265
          },
          {
            "text": "  };",
            "lineNumber": 266
          },
          {
            "lineNumber": 267
          },
          {
            "text": "  const handleDeleteConfirm = () =&gt; {",
            "lineNumber": 268
          },
          {
            "text": "    if (onDelete &amp;&amp; currentFile) {",
            "lineNumber": 269
          },
          {
            "text": "      onDelete(currentFile.id);",
            "lineNumber": 270
          },
          {
            "text": "    }",
            "lineNumber": 271
          },
          {
            "text": "    setShowDeleteConfirm(false);",
            "lineNumber": 272
          },
          {
            "text": "  };",
            "lineNumber": 273
          },
          {
            "lineNumber": 274
          },
          {
            "text": "  return (",
            "lineNumber": 275
          },
          {
            "text": "    &lt;div ",
            "lineNumber": 276
          },
          {
            "text": "        className={&#96;fixed top-10 right-0 bottom-0 z-[45] bg-gray-50 dark:bg-gray-950 flex text-gray-900 dark:text-gray-100 overflow-hidden font-sans transition-all duration-300 ${isSidebarOpen ? 'left-64' : 'left-0'}&#96;}",
            "lineNumber": 277
          },
          {
            "text": "        onClick={() =&gt; setContextMenu({ ...contextMenu, visible: false })}",
            "lineNumber": 278
          },
          {
            "text": "    &gt;",
            "lineNumber": 279
          },
          {
            "text": "      ",
            "lineNumber": 280
          },
          {
            "text": "      {/* Main Content Area */}",
            "lineNumber": 281
          },
          {
            "text": "      &lt;div className=\"flex-1 flex flex-col relative h-full\"&gt;",
            "lineNumber": 282
          },
          {
            "text": "        {/* Header */}",
            "lineNumber": 283
          },
          {
            "text": "        &lt;div className=\"h-14 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between px-4 shrink-0 z-20 shadow-sm transition-colors\"&gt;",
            "lineNumber": 284
          },
          {
            "text": "           &lt;div className=\"flex items-center space-x-3 overflow-hidden\"&gt;",
            "lineNumber": 285
          },
          {
            "text": "              &lt;button ",
            "lineNumber": 286
          },
          {
            "text": "                onClick={onToggleSidebar} ",
            "lineNumber": 287
          },
          {
            "text": "                className={&#96;p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${isSidebarOpen ? 'text-blue-500 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}&#96;}",
            "lineNumber": 288
          },
          {
            "text": "                title={t('viewer.toggleSidebar')}",
            "lineNumber": 289
          },
          {
            "text": "              &gt;",
            "lineNumber": 290
          },
          {
            "text": "                &lt;Sidebar size={20} /&gt;",
            "lineNumber": 291
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 292
          },
          {
            "text": "              &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;",
            "lineNumber": 293
          },
          {
            "text": ";",
            "lineNumber": 618
          }
        ]
      },
      "score": 0.26716774702072144
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 246
          },
          "endPosition": {
            "line": 1381,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \n\"&gt;\n                                    &lt;button \n                                        onClick={() =&gt; onUpdate(file.id, { aiData: undefined })} \n                                        className=\"flex items-center px-3 py-1.5 bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-400 text-white rounded-md font-medium transition-colors text-sm\"\n                                        title={t('meta.clearAiData')}\n                                    &gt;\n                                        &lt;X size={12} className=\"mr-1.5\"/&gt; {t('meta.clear')}\n                                    &lt;/button&gt;\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        )\n                    )}\n                &lt;/div&gt;\n            )\n        )}\n\n        {/* Open Folder Button */}\n        {!isMulti &amp;&amp; file &amp;&amp; (\n            &lt;button\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 247
          },
          {
            "text": "\"&gt;",
            "lineNumber": 1100
          },
          {
            "text": "                                    &lt;button ",
            "lineNumber": 1101
          },
          {
            "text": "                                        onClick={() =&gt; onUpdate(file.id, { aiData: undefined })} ",
            "lineNumber": 1102
          },
          {
            "text": "                                        className=\"flex items-center px-3 py-1.5 bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-400 text-white rounded-md font-medium transition-colors text-sm\"",
            "lineNumber": 1103
          },
          {
            "text": "                                        title={t('meta.clearAiData')}",
            "lineNumber": 1104
          },
          {
            "text": "                                    &gt;",
            "lineNumber": 1105
          },
          {
            "text": "                                        &lt;X size={12} className=\"mr-1.5\"/&gt; {t('meta.clear')}",
            "lineNumber": 1106
          },
          {
            "text": "                                    &lt;/button&gt;",
            "lineNumber": 1107
          },
          {
            "text": "                                &lt;/div&gt;",
            "lineNumber": 1108
          },
          {
            "text": "                            &lt;/div&gt;",
            "lineNumber": 1109
          },
          {
            "text": "                        )",
            "lineNumber": 1110
          },
          {
            "text": "                    )}",
            "lineNumber": 1111
          },
          {
            "text": "                &lt;/div&gt;",
            "lineNumber": 1112
          },
          {
            "text": "            )",
            "lineNumber": 1113
          },
          {
            "text": "        )}",
            "lineNumber": 1114
          },
          {
            "lineNumber": 1115
          },
          {
            "text": "        {/* Open Folder Button */}",
            "lineNumber": 1116
          },
          {
            "text": "        {!isMulti &amp;&amp; file &amp;&amp; (",
            "lineNumber": 1117
          },
          {
            "text": "            &lt;button",
            "lineNumber": 1118
          },
          {
            "text": ";",
            "lineNumber": 1382
          }
        ]
      },
      "score": 0.26085150241851807
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleViewerJump =  {\n      updateActiveTab(prev =&gt; {\n          const newStack = [...prev.history.stack];\n          if (prev.history.currentIndex &gt;= 0 &amp;&amp; prev.history.currentIndex &lt; newStack.length) {\n              newStack[prev.history.currentIndex] = { ...newStack[prev.history.currentIndex], viewingId: fileId };\n          }\n          return { viewingFileId: fileId, selectedFileIds: [fileId], lastSelectedId: fileId, history: { ...prev.history, stack: newStack } };\n      });\n  };\n  \n  const performAiSearch = async (query: string) =&gt; {\n      if (!query.trim()) {\n          pushHistory(activeTab.folderId, null, 'browser', '', activeTab.searchScope, activeTab.activeTags, null, 0, null);\n          return;\n      }\n\n      const taskId = startTask('ai', [], t('settings.aiSmartSearchThinking'), false);\n      showToast(t('settings.aiSmartSearchThinking'));\n\n      try {\n          const aiConfig = state.settings.ai;\n          const prompt = &#96;\n          Analyze this search query for a photo gallery: \"${query}\".\n          Extract search intent and criteria into a JSON object.\n          Return ONLY JSON.\n          \n          Expected JSON Structure:\n          {\n            \"keywords\": string[], // Synonyms, objects, tags\n            \"colors\": string[], // Hex codes or color names\n            \"people\": string[], // Names of people\n            \"description\": string // A concise description of what to look for (optional)\n          }\n          &#96;;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleViewerJump =  {",
            "lineNumber": 2999
          },
          {
            "text": "      updateActiveTab(prev =&gt; {",
            "lineNumber": 3000
          },
          {
            "text": "          const newStack = [...prev.history.stack];",
            "lineNumber": 3001
          },
          {
            "text": "          if (prev.history.currentIndex &gt;= 0 &amp;&amp; prev.history.currentIndex &lt; newStack.length) {",
            "lineNumber": 3002
          },
          {
            "text": "              newStack[prev.history.currentIndex] = { ...newStack[prev.history.currentIndex], viewingId: fileId };",
            "lineNumber": 3003
          },
          {
            "text": "          }",
            "lineNumber": 3004
          },
          {
            "text": "          return { viewingFileId: fileId, selectedFileIds: [fileId], lastSelectedId: fileId, history: { ...prev.history, stack: newStack } };",
            "lineNumber": 3005
          },
          {
            "text": "      });",
            "lineNumber": 3006
          },
          {
            "text": "  };",
            "lineNumber": 3007
          },
          {
            "text": "  ",
            "lineNumber": 3008
          },
          {
            "text": "  const performAiSearch = async (query: string) =&gt; {",
            "lineNumber": 3009
          },
          {
            "text": "      if (!query.trim()) {",
            "lineNumber": 3010
          },
          {
            "text": "          pushHistory(activeTab.folderId, null, 'browser', '', activeTab.searchScope, activeTab.activeTags, null, 0, null);",
            "lineNumber": 3011
          },
          {
            "text": "          return;",
            "lineNumber": 3012
          },
          {
            "text": "      }",
            "lineNumber": 3013
          },
          {
            "lineNumber": 3014
          },
          {
            "text": "      const taskId = startTask('ai', [], t('settings.aiSmartSearchThinking'), false);",
            "lineNumber": 3015
          },
          {
            "text": "      showToast(t('settings.aiSmartSearchThinking'));",
            "lineNumber": 3016
          },
          {
            "lineNumber": 3017
          },
          {
            "text": "      try {",
            "lineNumber": 3018
          },
          {
            "text": "          const aiConfig = state.settings.ai;",
            "lineNumber": 3019
          },
          {
            "text": "          const prompt = &#96;",
            "lineNumber": 3020
          },
          {
            "text": "          Analyze this search query for a photo gallery: \"${query}\".",
            "lineNumber": 3021
          },
          {
            "text": "          Extract search intent and criteria into a JSON object.",
            "lineNumber": 3022
          },
          {
            "text": "          Return ONLY JSON.",
            "lineNumber": 3023
          },
          {
            "text": "          ",
            "lineNumber": 3024
          },
          {
            "text": "          Expected JSON Structure:",
            "lineNumber": 3025
          },
          {
            "text": "          {",
            "lineNumber": 3026
          },
          {
            "text": "            \"keywords\": string[], // Synonyms, objects, tags",
            "lineNumber": 3027
          },
          {
            "text": "            \"colors\": string[], // Hex codes or color names",
            "lineNumber": 3028
          },
          {
            "text": "            \"people\": string[], // Names of people",
            "lineNumber": 3029
          },
          {
            "text": "            \"description\": string // A concise description of what to look for (optional)",
            "lineNumber": 3030
          },
          {
            "text": "          }",
            "lineNumber": 3031
          },
          {
            "text": "          &#96;;",
            "lineNumber": 3032
          },
          {
            "text": ";",
            "lineNumber": 3103
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.26078200340270996
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\SequenceViewer.tsx",
        "range": {
          "startPosition": {
            "line": 22
          },
          "endPosition": {
            "line": 617,
            "column": 1
          }
        },
        "contents": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = \n{t('sequence.prev')}\n            &lt;/div&gt;\n            &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;\n            &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleOriginal(); setContextMenu({...contextMenu, visible: false}); }}&gt;\n                &lt;Maximize size={14} className=\"mr-2\"/&gt; {t('sequence.original')}\n            &lt;/div&gt;\n            &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleReset(); setContextMenu({...contextMenu, visible: false}); }}&gt;\n                &lt;Minimize size={14} className=\"mr-2\"/&gt; {t('sequence.fit')}\n            &lt;/div&gt;\n            &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;\n            &lt;div className=\"px-4 py-2 hover:bg-red-600 hover:text-white text-red-500 dark:text-red-400 cursor-pointer flex items-center\" onClick={handleDeleteRequest}&gt;\n                &lt;Trash2 size={14} className=\"mr-2\"/&gt; {t('context.delete')}\n            &lt;/div&gt;\n        &lt;/div&gt;\n      )}\n\n      {/* Context Menu Backdrop */}\n      {contextMenu.visible &amp;&amp; (\n          &lt;div className=\"fixed inset-0 z-[59]\" onClick={() =&gt; setContextMenu({...contextMenu, visible: false})}&gt;&lt;/div&gt;\n      )}\n\n      {/* Delete Confirmation Modal */}\n      {showDeleteConfirm &amp;&amp; (\n          &lt;div className=\"fixed inset-0 z-[100] bg-black/50 flex items-center justify-center p-4\"&gt;\n              &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl max-w-sm w-full animate-zoom-in\"&gt;\n                  &lt;div className=\"flex items-center mb-4 text-orange-500\"&gt;\n                      &lt;AlertTriangle className=\"mr-2\" /&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 22,
                "column": 1
              },
              "endPosition": {
                "line": 22,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 8
              },
              "endPosition": {
                "line": 22,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 14
              },
              "endPosition": {
                "line": 22,
                "column": 62
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = ",
            "lineNumber": 23
          },
          {
            "text": "{t('sequence.prev')}",
            "lineNumber": 565
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 566
          },
          {
            "text": "            &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;",
            "lineNumber": 567
          },
          {
            "text": "            &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleOriginal(); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 568
          },
          {
            "text": "                &lt;Maximize size={14} className=\"mr-2\"/&gt; {t('sequence.original')}",
            "lineNumber": 569
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 570
          },
          {
            "text": "            &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleReset(); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 571
          },
          {
            "text": "                &lt;Minimize size={14} className=\"mr-2\"/&gt; {t('sequence.fit')}",
            "lineNumber": 572
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 573
          },
          {
            "text": "            &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;",
            "lineNumber": 574
          },
          {
            "text": "            &lt;div className=\"px-4 py-2 hover:bg-red-600 hover:text-white text-red-500 dark:text-red-400 cursor-pointer flex items-center\" onClick={handleDeleteRequest}&gt;",
            "lineNumber": 575
          },
          {
            "text": "                &lt;Trash2 size={14} className=\"mr-2\"/&gt; {t('context.delete')}",
            "lineNumber": 576
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 577
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 578
          },
          {
            "text": "      )}",
            "lineNumber": 579
          },
          {
            "lineNumber": 580
          },
          {
            "text": "      {/* Context Menu Backdrop */}",
            "lineNumber": 581
          },
          {
            "text": "      {contextMenu.visible &amp;&amp; (",
            "lineNumber": 582
          },
          {
            "text": "          &lt;div className=\"fixed inset-0 z-[59]\" onClick={() =&gt; setContextMenu({...contextMenu, visible: false})}&gt;&lt;/div&gt;",
            "lineNumber": 583
          },
          {
            "text": "      )}",
            "lineNumber": 584
          },
          {
            "lineNumber": 585
          },
          {
            "text": "      {/* Delete Confirmation Modal */}",
            "lineNumber": 586
          },
          {
            "text": "      {showDeleteConfirm &amp;&amp; (",
            "lineNumber": 587
          },
          {
            "text": "          &lt;div className=\"fixed inset-0 z-[100] bg-black/50 flex items-center justify-center p-4\"&gt;",
            "lineNumber": 588
          },
          {
            "text": "              &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl max-w-sm w-full animate-zoom-in\"&gt;",
            "lineNumber": 589
          },
          {
            "text": "                  &lt;div className=\"flex items-center mb-4 text-orange-500\"&gt;",
            "lineNumber": 590
          },
          {
            "text": "                      &lt;AlertTriangle className=\"mr-2\" /&gt;",
            "lineNumber": 591
          },
          {
            "text": ";",
            "lineNumber": 618
          }
        ]
      },
      "score": 0.26045823097229004
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5054,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\n\n                          onEditTags={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'edit-tags', data: { fileId: activeTab.viewingFileId } } }))}\n                          onCopyTags={() =&gt; handleCopyTags([activeTab.viewingFileId!])}\n                          onAIAnalysis={(id) =&gt; handleAIAnalysis([id])}\n                          isAISearchEnabled={state.settings.search.isAISearchEnabled}\n                          onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}\n                          t={t}\n                          activeTab={activeTab}\n                      /&gt;\n                  );\n              })()\n          )}\n          {!activeTab.viewingFileId &amp;&amp; (\n            &lt;&gt;\n              &lt;TopBar \n                activeTab={activeTab} \n                state={state} \n                toolbarQuery={toolbarQuery} \n                groupedTags={groupedTags} \n                tagSearchQuery={tagSearchQuery} \n                onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))} \n                onGoBack={goBack} \n                onGoForward={goForward} \n                onNavigateUp={handleNavigateUp} \n                onSetTagSearchQuery={setTagSearchQuery} \n                onTagClick={handleTagClick} \n                onRefresh={handleRefresh}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4479
          },
          {
            "lineNumber": 4525
          },
          {
            "text": "                          onEditTags={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'edit-tags', data: { fileId: activeTab.viewingFileId } } }))}",
            "lineNumber": 4526
          },
          {
            "text": "                          onCopyTags={() =&gt; handleCopyTags([activeTab.viewingFileId!])}",
            "lineNumber": 4527
          },
          {
            "text": "                          onAIAnalysis={(id) =&gt; handleAIAnalysis([id])}",
            "lineNumber": 4528
          },
          {
            "text": "                          isAISearchEnabled={state.settings.search.isAISearchEnabled}",
            "lineNumber": 4529
          },
          {
            "text": "                          onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}",
            "lineNumber": 4530
          },
          {
            "text": "                          t={t}",
            "lineNumber": 4531
          },
          {
            "text": "                          activeTab={activeTab}",
            "lineNumber": 4532
          },
          {
            "text": "                      /&gt;",
            "lineNumber": 4533
          },
          {
            "text": "                  );",
            "lineNumber": 4534
          },
          {
            "text": "              })()",
            "lineNumber": 4535
          },
          {
            "text": "          )}",
            "lineNumber": 4536
          },
          {
            "text": "          {!activeTab.viewingFileId &amp;&amp; (",
            "lineNumber": 4537
          },
          {
            "text": "            &lt;&gt;",
            "lineNumber": 4538
          },
          {
            "text": "              &lt;TopBar ",
            "lineNumber": 4539
          },
          {
            "text": "                activeTab={activeTab} ",
            "lineNumber": 4540
          },
          {
            "text": "                state={state} ",
            "lineNumber": 4541
          },
          {
            "text": "                toolbarQuery={toolbarQuery} ",
            "lineNumber": 4542
          },
          {
            "text": "                groupedTags={groupedTags} ",
            "lineNumber": 4543
          },
          {
            "text": "                tagSearchQuery={tagSearchQuery} ",
            "lineNumber": 4544
          },
          {
            "text": "                onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))} ",
            "lineNumber": 4545
          },
          {
            "text": "                onGoBack={goBack} ",
            "lineNumber": 4546
          },
          {
            "text": "                onGoForward={goForward} ",
            "lineNumber": 4547
          },
          {
            "text": "                onNavigateUp={handleNavigateUp} ",
            "lineNumber": 4548
          },
          {
            "text": "                onSetTagSearchQuery={setTagSearchQuery} ",
            "lineNumber": 4549
          },
          {
            "text": "                onTagClick={handleTagClick} ",
            "lineNumber": 4550
          },
          {
            "text": "                onRefresh={handleRefresh}",
            "lineNumber": 4551
          },
          {
            "text": ";",
            "lineNumber": 5055
          }
        ]
      },
      "score": 0.26010555028915405
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


检查 Rust 后端的 `open_path` 实现，确认是否正确处理文件选择：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src-tauri/src/main.rs</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "open_path",
  "path": "src-tauri/src/main.rs",
  "contextAfter": 30,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "open_path",
    "path": "src-tauri/src/main.rs",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src-tauri/src/main.rs",
              "matches": [
                {
                  "lineNumber": 536,
                  "content": "async fn open_path(path: String, is_file: Option&lt;bool&gt;) -&gt; Result&lt;(), String&gt; {"
                },
                {
                  "lineNumber": 537,
                  "content": "    use std::process::Command;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 538,
                  "content": "    use std::path::Path;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 539,
                  "isContextLine": true
                },
                {
                  "lineNumber": 540,
                  "content": "    let path_obj = Path::new(&amp;path);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 541,
                  "content": "    let is_file_path = is_file.unwrap_or_else(|| path_obj.is_file());",
                  "isContextLine": true
                },
                {
                  "lineNumber": 542,
                  "isContextLine": true
                },
                {
                  "lineNumber": 543,
                  "content": "    let result = if cfg!(windows) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 544,
                  "content": "        if is_file_path {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 545,
                  "content": "            // Windows: 打开文件夹并选中文件",
                  "isContextLine": true
                },
                {
                  "lineNumber": 546,
                  "content": "            // explorer /select,文件路径（注意：逗号后面不能有空格）",
                  "isContextLine": true
                },
                {
                  "lineNumber": 547,
                  "content": "            Command::new(\"explorer\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 548,
                  "content": "                .arg(format!(\"/select,{}\", &amp;path))",
                  "isContextLine": true
                },
                {
                  "lineNumber": 549,
                  "content": "                .spawn()",
                  "isContextLine": true
                },
                {
                  "lineNumber": 550,
                  "content": "                .map(|_| ())",
                  "isContextLine": true
                },
                {
                  "lineNumber": 551,
                  "content": "        } else {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 552,
                  "content": "            // Windows: 打开文件夹",
                  "isContextLine": true
                },
                {
                  "lineNumber": 553,
                  "content": "            Command::new(\"explorer\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 554,
                  "content": "                .args([&amp;path])",
                  "isContextLine": true
                },
                {
                  "lineNumber": 555,
                  "content": "                .spawn()",
                  "isContextLine": true
                },
                {
                  "lineNumber": 556,
                  "content": "                .map(|_| ())",
                  "isContextLine": true
                },
                {
                  "lineNumber": 557,
                  "content": "        }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 558,
                  "content": "    } else if cfg!(target_os = \"macos\") {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 559,
                  "content": "        if is_file_path {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 560,
                  "content": "            // macOS: 打开文件所在的文件夹并选中文件",
                  "isContextLine": true
                },
                {
                  "lineNumber": 561,
                  "content": "            Command::new(\"open\")",
                  "isContextLine": true
                },
                {
                  "lineNumber": 562,
                  "content": "                .args([\"-R\", &amp;path])",
                  "isContextLine": true
                },
                {
                  "lineNumber": 563,
                  "content": "                .spawn()",
                  "isContextLine": true
                },
                {
                  "lineNumber": 564,
                  "content": "                .map(|_| ())",
                  "isContextLine": true
                },
                {
                  "lineNumber": 565,
                  "content": "        } else {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 566,
                  "content": "            // macOS: 打开文件夹",
                  "isContextLine": true
                },
                {
                  "lineNumber": 820,
                  "content": "            open_path,"
                },
                {
                  "lineNumber": 821,
                  "content": "            create_folder,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 822,
                  "content": "            rename_file,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 823,
                  "content": "            delete_file",
                  "isContextLine": true
                },
                {
                  "lineNumber": 824,
                  "content": "        ])",
                  "isContextLine": true
                },
                {
                  "lineNumber": 825,
                  "content": "        .run(tauri::generate_context!())",
                  "isContextLine": true
                },
                {
                  "lineNumber": 826,
                  "content": "        .expect(\"error while running tauri application\");",
                  "isContextLine": true
                },
                {
                  "lineNumber": 827,
                  "content": "}",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 39,
          "totalMatchedLines": 2
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


查看完整的 Rust 实现：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src-tauri/src/main.rs</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/App.tsx</summary>

</details>
</tool-use>

---



---


修复逻辑：应检查是否为文件夹，而不是是否为图片。将所有非文件夹项视为文件：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/types.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "enum FileType",
  "path": "src/types.ts",
  "contextAfter": 5,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "enum FileType",
    "path": "src/types.ts",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/types.ts",
              "matches": [
                {
                  "lineNumber": 2,
                  "content": "export enum FileType {"
                },
                {
                  "lineNumber": 3,
                  "content": "  IMAGE = 'image',",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4,
                  "content": "  FOLDER = 'folder',",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5,
                  "content": "  UNKNOWN = 'unknown'",
                  "isContextLine": true
                },
                {
                  "lineNumber": 6,
                  "content": "}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 7,
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 6,
          "totalMatchedLines": 1
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "030f0832-3672-4425-84bc-b148c2148439"
}
```
Status: **completed**


</details>
</tool-use>

---



---


已修复逻辑：将所有非文件夹项视为文件。当前代码：

- 文件夹：`isFile = false`，Rust 端直接打开文件夹
- 图片或其他文件：`isFile = true`，Rust 端打开文件所在目录并选中该文件

验证逻辑是否正确：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src-tauri/src/main.rs</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "src/App.tsx"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "src/App.tsx"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


代码逻辑正确。修改后的实现：

## 修改说明

将判断从 `file.type === FileType.IMAGE` 改为 `file.type !== FileType.FOLDER`，这样：

1. **文件夹（FileType.FOLDER）**：
   - `isFile = false`
   - Rust 端直接打开该文件夹（Windows: `explorer 路径`，macOS: `open 路径`）

2. **文件（FileType.IMAGE 或 FileType.UNKNOWN）**：
   - `isFile = true`
   - Rust 端打开文件所在目录并选中该文件：
     - Windows: `explorer /select,文件路径`
     - macOS: `open -R 文件路径`
     - Linux: 打开父目录

这样，右键菜单中的“在系统文件管理器中查看”会：
- 文件夹：直接打开该文件夹
- 文件：打开文件所在目录并选中该文件

代码已更新，可以测试。

---

_**User**_

目前打开文件夹的路径逻辑有点问题，当我选中文件夹右键在系统文件管理器中查看这个选项时，打开的却是固定的C:\Users\Misaki\Documents文件夹，而当我选中文件右键在系统文件管理器中查看这个选项时，则打开的是桌面文件夹，确保选择这个选项时候，打开的是所选文件或者文件夹当前所在的文件夹，而不是文档和桌面。

---

_**Agent (model default, mode Agent)**_



---


检查代码，确认路径传递是否正确：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/App.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "handleViewInExplorer|在系统文件管理器中查看",
  "path": "src/App.tsx",
  "contextBefore": 5,
  "contextAfter": 5,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "handleViewInExplorer|在系统文件管理器中查看",
    "path": "src/App.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/App.tsx",
              "matches": [
                {
                  "lineNumber": 3504,
                  "content": "          setState(prev =&gt; ({ ...prev, tasks: prev.tasks.filter(t =&gt; t.id !== taskId) }));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3505,
                  "content": "          showToast(t('tasks.thumbnailsGenerated'));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3506,
                  "content": "      }, 1000);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3507,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3508,
                  "isContextLine": true
                },
                {
                  "lineNumber": 3509,
                  "content": "  const handleViewInExplorer = async (id: string) =&gt; {"
                },
                {
                  "lineNumber": 3510,
                  "content": "    const file = state.files[id];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3511,
                  "content": "    if (!file?.path) return;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3512,
                  "isContextLine": true
                },
                {
                  "lineNumber": 3513,
                  "content": "    try {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3514,
                  "content": "      if (isTauriEnvironment()) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4512,
                  "content": "                          onNavigateBack={goBack}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4513,
                  "content": "                          onNavigateForward={goForward}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4514,
                  "content": "                          canGoBack={activeTab.history.currentIndex &gt; 0}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4515,
                  "content": "                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4516,
                  "content": "                          onDelete={(id) =&gt; requestDelete([id])}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4517,
                  "content": "                          onViewInExplorer={handleViewInExplorer}"
                },
                {
                  "lineNumber": 4518,
                  "content": "                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4519,
                  "content": "                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4520,
                  "content": "                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4521,
                  "content": "                          searchQuery={activeTab.searchQuery}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4522,
                  "content": "                          onSearch={handleViewerSearch}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4885,
                  "content": "                        &lt;Layout size={14} className=\"mr-2 opacity-70\"/&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4886,
                  "content": "                        {contextMenu.type === 'folder-single' ? t('context.openFolderInNewTab') : t('context.openInNewTab')}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4887,
                  "content": "                    &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4888,
                  "content": "                )}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4889,
                  "isContextLine": true
                },
                {
                  "lineNumber": 4890,
                  "content": "                &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleViewInExplorer(contextMenu.targetId!); closeContextMenu(); }}&gt;&lt;ExternalLink size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.viewInExplorer')}&lt;/div&gt;"
                },
                {
                  "lineNumber": 4891,
                  "content": "                {contextMenu.type === 'file-single' &amp;&amp; state.files[contextMenu.targetId!] &amp;&amp; ( (() =&gt; { const file = state.files[contextMenu.targetId!]; const parentId = file.parentId; const isUnavailable = activeTab.viewMode === 'browser' &amp;&amp; activeTab.folderId === parentId; return ( &lt;div className={&#96;px-4 py-2 flex items-center ${isUnavailable ? 'text-gray-400 cursor-default' : 'hover:bg-blue-600 hover:text-white cursor-pointer'}&#96;} onClick={() =&gt; { if (!isUnavailable &amp;&amp; parentId) { enterFolder(parentId); closeContextMenu(); } }}&gt;{t('context.openFolder')}&lt;/div&gt; ); })() )}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4892,
                  "content": "                &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4893,
                  "isContextLine": true
                },
                {
                  "lineNumber": 4894,
                  "content": "                &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer\" onClick={() =&gt; { setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: activeTab.selectedFileIds.length &gt; 0 ? activeTab.selectedFileIds : contextMenu.targetId ? [contextMenu.targetId] : [] } } })); closeContextMenu(); }}&gt;{t('context.copyTo')}&lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4895,
                  "content": "                &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer\" onClick={() =&gt; { setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: activeTab.selectedFileIds.length &gt; 0 ? activeTab.selectedFileIds : contextMenu.targetId ? [contextMenu.targetId] : [] } } })); closeContextMenu(); }}&gt;{t('context.moveTo')}&lt;/div&gt;",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 33,
          "totalMatchedLines": 3
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "在系统文件管理器中查看 context menu onContextMenu",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst onPerformSearch = async \n activeTab.searchScope, activeTab.activeTags, null, 0);\n      }\n  };\n\n  const handlePerformSearch = onPerformSearch;\n\n  const handleViewerSearch = (query: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', query, activeTab.searchScope, activeTab.activeTags, null, 0);\n  const enterTagView = (tagName: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'tag', [tagName], null, 0);\n  const enterTagsOverview = () =&gt; pushHistory(activeTab.folderId, null, 'tags-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);\n  const enterPeopleOverview = () =&gt; pushHistory(activeTab.folderId, null, 'people-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);\n  const enterPersonView = (personId: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'all', [], personId, 0);\n  const handleClearTagFilter = (tagToRemove: string) =&gt; updateActiveTab(prev =&gt; ({ activeTags: prev.activeTags.filter(t =&gt; t !== tagToRemove) }));\n  const handleClearAllTags = () =&gt; updateActiveTab({ activeTags: [] });\n  const handleClearPersonFilter = () =&gt; updateActiveTab({ activePersonId: null });\n  \n  const handleRenameSubmit = async (value: string, id: string) =&gt; {\n      value = value.trim();\n      const file = state.files[id];\n      if (!value || value === file.name) { setState(s =&gt; ({ ...s, renamingId: null })); return; }\n      if (file.path) {\n          try {\n              const separator = file.path.includes('/') ? '/' : '\\\\';\n              const parentPath = file.path.substring(0, file.path.lastIndexOf(separator));\n              const newPath = &#96;${parentPath}${separator}${value}&#96;;\n              \n              // Use appropriate renameFile function based on environment\n              const isTauriEnv = isTauriEnvironment();\n              if (isTauriEnv) {\n                  await renameFile(file.path, newPath);\n              } else if (window.electron) {\n                  await window.electron.renameFile(file.path, newPath);\n              } else {\n                  throw new Error(\"No file system access available\");\n              }\n              \n              await handleRefresh();\n              setState(s =&gt; ({ ...s, renamingId: null }));\n          }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const onPerformSearch = async ",
            "lineNumber": 3105
          },
          {
            "text": " activeTab.searchScope, activeTab.activeTags, null, 0);",
            "lineNumber": 3109
          },
          {
            "text": "      }",
            "lineNumber": 3110
          },
          {
            "text": "  };",
            "lineNumber": 3111
          },
          {
            "lineNumber": 3112
          },
          {
            "text": "  const handlePerformSearch = onPerformSearch;",
            "lineNumber": 3113
          },
          {
            "lineNumber": 3114
          },
          {
            "text": "  const handleViewerSearch = (query: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', query, activeTab.searchScope, activeTab.activeTags, null, 0);",
            "lineNumber": 3115
          },
          {
            "text": "  const enterTagView = (tagName: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'tag', [tagName], null, 0);",
            "lineNumber": 3116
          },
          {
            "text": "  const enterTagsOverview = () =&gt; pushHistory(activeTab.folderId, null, 'tags-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);",
            "lineNumber": 3117
          },
          {
            "text": "  const enterPeopleOverview = () =&gt; pushHistory(activeTab.folderId, null, 'people-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);",
            "lineNumber": 3118
          },
          {
            "text": "  const enterPersonView = (personId: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'all', [], personId, 0);",
            "lineNumber": 3119
          },
          {
            "text": "  const handleClearTagFilter = (tagToRemove: string) =&gt; updateActiveTab(prev =&gt; ({ activeTags: prev.activeTags.filter(t =&gt; t !== tagToRemove) }));",
            "lineNumber": 3120
          },
          {
            "text": "  const handleClearAllTags = () =&gt; updateActiveTab({ activeTags: [] });",
            "lineNumber": 3121
          },
          {
            "text": "  const handleClearPersonFilter = () =&gt; updateActiveTab({ activePersonId: null });",
            "lineNumber": 3122
          },
          {
            "text": "  ",
            "lineNumber": 3123
          },
          {
            "text": "  const handleRenameSubmit = async (value: string, id: string) =&gt; {",
            "lineNumber": 3124
          },
          {
            "text": "      value = value.trim();",
            "lineNumber": 3125
          },
          {
            "text": "      const file = state.files[id];",
            "lineNumber": 3126
          },
          {
            "text": "      if (!value || value === file.name) { setState(s =&gt; ({ ...s, renamingId: null })); return; }",
            "lineNumber": 3127
          },
          {
            "text": "      if (file.path) {",
            "lineNumber": 3128
          },
          {
            "text": "          try {",
            "lineNumber": 3129
          },
          {
            "text": "              const separator = file.path.includes('/') ? '/' : '\\\\';",
            "lineNumber": 3130
          },
          {
            "text": "              const parentPath = file.path.substring(0, file.path.lastIndexOf(separator));",
            "lineNumber": 3131
          },
          {
            "text": "              const newPath = &#96;${parentPath}${separator}${value}&#96;;",
            "lineNumber": 3132
          },
          {
            "text": "              ",
            "lineNumber": 3133
          },
          {
            "text": "              // Use appropriate renameFile function based on environment",
            "lineNumber": 3134
          },
          {
            "text": "              const isTauriEnv = isTauriEnvironment();",
            "lineNumber": 3135
          },
          {
            "text": "              if (isTauriEnv) {",
            "lineNumber": 3136
          },
          {
            "text": "                  await renameFile(file.path, newPath);",
            "lineNumber": 3137
          },
          {
            "text": "              } else if (window.electron) {",
            "lineNumber": 3138
          },
          {
            "text": "                  await window.electron.renameFile(file.path, newPath);",
            "lineNumber": 3139
          },
          {
            "text": "              } else {",
            "lineNumber": 3140
          },
          {
            "text": "                  throw new Error(\"No file system access available\");",
            "lineNumber": 3141
          },
          {
            "text": "              }",
            "lineNumber": 3142
          },
          {
            "text": "              ",
            "lineNumber": 3143
          },
          {
            "text": "              await handleRefresh();",
            "lineNumber": 3144
          },
          {
            "text": "              setState(s =&gt; ({ ...s, renamingId: null }));",
            "lineNumber": 3145
          },
          {
            "text": "          }",
            "lineNumber": 3146
          },
          {
            "text": ";",
            "lineNumber": 3154
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.5166400671005249
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n              \n              &lt;div className=\"flex-1 flex flex-col relative bg-white dark:bg-gray-950 overflow-hidden\" \n                   onDragOver={handleDragOver}\n                   onDragLeave={handleDragLeave}\n                   onDragEnter={handleDragEnter}\n                   onDrop={handleExternalFileDrop}\n              &gt;\n                {/* Drag and drop overlay */}\n                {isDragOver &amp;&amp; !isInternalDragRef.current &amp;&amp; (\n                  &lt;div className=\"absolute inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm z-50 pointer-events-none\"&gt;\n                    &lt;div className=\"w-full h-full flex\"&gt;\n                      {/* Copy section */}\n                      &lt;div \n                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'copy' ? 'bg-blue-600/80' : 'bg-blue-600/50 hover:bg-blue-600/70'}&#96;}\n                      &gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "lineNumber": 4611
          },
          {
            "text": "              ",
            "lineNumber": 4612
          },
          {
            "text": "              &lt;div className=\"flex-1 flex flex-col relative bg-white dark:bg-gray-950 overflow-hidden\" ",
            "lineNumber": 4613
          },
          {
            "text": "                   onDragOver={handleDragOver}",
            "lineNumber": 4614
          },
          {
            "text": "                   onDragLeave={handleDragLeave}",
            "lineNumber": 4615
          },
          {
            "text": "                   onDragEnter={handleDragEnter}",
            "lineNumber": 4616
          },
          {
            "text": "                   onDrop={handleExternalFileDrop}",
            "lineNumber": 4617
          },
          {
            "text": "              &gt;",
            "lineNumber": 4618
          },
          {
            "text": "                {/* Drag and drop overlay */}",
            "lineNumber": 4619
          },
          {
            "text": "                {isDragOver &amp;&amp; !isInternalDragRef.current &amp;&amp; (",
            "lineNumber": 4620
          },
          {
            "text": "                  &lt;div className=\"absolute inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm z-50 pointer-events-none\"&gt;",
            "lineNumber": 4621
          },
          {
            "text": "                    &lt;div className=\"w-full h-full flex\"&gt;",
            "lineNumber": 4622
          },
          {
            "text": "                      {/* Copy section */}",
            "lineNumber": 4623
          },
          {
            "text": "                      &lt;div ",
            "lineNumber": 4624
          },
          {
            "text": "                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'copy' ? 'bg-blue-600/80' : 'bg-blue-600/50 hover:bg-blue-600/70'}&#96;}",
            "lineNumber": 4625
          },
          {
            "text": "                      &gt;",
            "lineNumber": 4626
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.4776991605758667
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n\"\n              &gt;\n                &lt;ChevronLeft size={32} /&gt;\n              &lt;/button&gt;\n            &lt;/div&gt;\n            &lt;div className=\"absolute inset-y-0 right-0 w-24 flex items-center justify-end pr-2 opacity-0 hover:opacity-100 transition-opacity duration-300 bg-gradient-to-l from-black/30 to-transparent z-10 pointer-events-auto\"&gt;\n              &lt;button \n                onClick={(e) =&gt; { e.stopPropagation(); handleNext(); }}\n                className=\"p-3 rounded-full bg-black/50 text-white/80 hover:bg-black/80 hover:text-white backdrop-blur-sm transform transition-transform active:scale-95\"\n              &gt;\n                &lt;ChevronRight size={32} /&gt;\n              &lt;/button&gt;\n            &lt;/div&gt;\n          &lt;/&gt;\n        )}\n      &lt;/div&gt;\n\n      {contextMenu.visible &amp;&amp; (\n        &lt;div \n          className=\"fixed bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-md shadow-xl text-sm py-1 text-gray-800 dark:text-gray-200 min-w-[220px] z-[60] max-h-[80vh] overflow-y-auto animate-zoom-in\"\n          style={{ \n            top: contextMenu.y + 350 &gt; window.innerHeight ? 'auto' : contextMenu.y,\n            bottom: contextMenu.y + 350 &gt; window.innerHeight ? window.innerHeight - contextMenu.y : 'auto',\n            left: Math.min(contextMenu.x, window.innerWidth - 240)\n          }}\n          onMouseDown={(e) =&gt; e.stopPropagation()}\n        &gt;\n          &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleOriginalSize(); setContextMenu({...contextMenu, visible: false}); }}&gt;\n             &lt;Maximize size={14} className=\"mr-2 opacity-70\"/&gt; {t('viewer.original')}\n          &lt;/div&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "text": "\"",
            "lineNumber": 632
          },
          {
            "text": "              &gt;",
            "lineNumber": 633
          },
          {
            "text": "                &lt;ChevronLeft size={32} /&gt;",
            "lineNumber": 634
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 635
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 636
          },
          {
            "text": "            &lt;div className=\"absolute inset-y-0 right-0 w-24 flex items-center justify-end pr-2 opacity-0 hover:opacity-100 transition-opacity duration-300 bg-gradient-to-l from-black/30 to-transparent z-10 pointer-events-auto\"&gt;",
            "lineNumber": 637
          },
          {
            "text": "              &lt;button ",
            "lineNumber": 638
          },
          {
            "text": "                onClick={(e) =&gt; { e.stopPropagation(); handleNext(); }}",
            "lineNumber": 639
          },
          {
            "text": "                className=\"p-3 rounded-full bg-black/50 text-white/80 hover:bg-black/80 hover:text-white backdrop-blur-sm transform transition-transform active:scale-95\"",
            "lineNumber": 640
          },
          {
            "text": "              &gt;",
            "lineNumber": 641
          },
          {
            "text": "                &lt;ChevronRight size={32} /&gt;",
            "lineNumber": 642
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 643
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 644
          },
          {
            "text": "          &lt;/&gt;",
            "lineNumber": 645
          },
          {
            "text": "        )}",
            "lineNumber": 646
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 647
          },
          {
            "lineNumber": 648
          },
          {
            "text": "      {contextMenu.visible &amp;&amp; (",
            "lineNumber": 649
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 650
          },
          {
            "text": "          className=\"fixed bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-md shadow-xl text-sm py-1 text-gray-800 dark:text-gray-200 min-w-[220px] z-[60] max-h-[80vh] overflow-y-auto animate-zoom-in\"",
            "lineNumber": 651
          },
          {
            "text": "          style={{ ",
            "lineNumber": 652
          },
          {
            "text": "            top: contextMenu.y + 350 &gt; window.innerHeight ? 'auto' : contextMenu.y,",
            "lineNumber": 653
          },
          {
            "text": "            bottom: contextMenu.y + 350 &gt; window.innerHeight ? window.innerHeight - contextMenu.y : 'auto',",
            "lineNumber": 654
          },
          {
            "text": "            left: Math.min(contextMenu.x, window.innerWidth - 240)",
            "lineNumber": 655
          },
          {
            "text": "          }}",
            "lineNumber": 656
          },
          {
            "text": "          onMouseDown={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 657
          },
          {
            "text": "        &gt;",
            "lineNumber": 658
          },
          {
            "text": "          &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleOriginalSize(); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 659
          },
          {
            "text": "             &lt;Maximize size={14} className=\"mr-2 opacity-70\"/&gt; {t('viewer.original')}",
            "lineNumber": 660
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 661
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.46737825870513916
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n      {/* 启动界面 */}\n      &lt;SplashScreen isVisible={showSplash} loadingInfo={loadingInfo} /&gt;\n      {/* ... (SVG filters) ... */}\n      &lt;svg style={{ display: 'none' }}&gt;&lt;defs&gt;&lt;filter id=\"channel-r\"&gt;&lt;feColorMatrix type=\"matrix\" values=\"1 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0\" /&gt;&lt;/filter&gt;&lt;filter id=\"channel-g\"&gt;&lt;feColorMatrix type=\"matrix\" values=\"0 0 0 0 0  0 1 0 0 0  0 0 0 0 0  0 0 0 1 0\" /&gt;&lt;/filter&gt;&lt;filter id=\"channel-b\"&gt;&lt;feColorMatrix type=\"matrix\" values=\"0 0 0 0 0  0 0 0 0 0  0 0 1 0 0  0 0 0 1 0\" /&gt;&lt;/filter&gt;&lt;filter id=\"channel-l\"&gt;&lt;feColorMatrix type=\"saturate\" values=\"0\" /&gt;&lt;/filter&gt;&lt;/defs&gt;&lt;/svg&gt;\n      &lt;TabBar tabs={state.tabs} activeTabId={state.activeTabId} files={state.files} onSwitchTab={handleSwitchTab} onCloseTab={handleCloseTab} onNewTab={handleNewTab} onContextMenu={(e, id) =&gt; handleContextMenu(e, 'tab', id)} t={t} showWindowControls={!showSplash} /&gt;\n      &lt;div className=\"flex-1 flex overflow-hidden relative transition-all duration-300 ease-[cubic-bezier(0.25,0.1,0.25,1)]\"&gt;\n        &lt;div className={&#96;bg-gray-50 dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 flex flex-col transition-all duration-300 shrink-0 z-40 ${state.layout.isSidebarVisible ? 'w-64 translate-x-0 opacity-100' : 'w-0 -translate-x-full opacity-0 overflow-hidden'}&#96;}&gt;\n          &lt;Sidebar roots={state.roots} files={state.files} people={state.people} customTags={state.customTags} currentFolderId={activeTab.folderId} expandedIds={state.expandedFolderIds} tasks={state.tasks} onToggle={handleToggleFolder} onNavigate={handleNavigateFolder} onTagSelect={enterTagView} onNavigateAllTags={enterTagsOverview} onPersonSelect={enterPersonView} onNavigateAllPeople={enterPeopleOverview} onContextMenu={handleContextMenu} onDrop={(targetId, sourceIds) =&gt; handleMoveFiles(sourceIds, targetId)} onDropOnTag={handleDropOnTag} isCreatingTag={isCreatingTag} onStartCreateTag={handleCreateNewTag} onSaveNewTag={handleSaveNewTag} onCancelCreateTag={handleCancelCreateTag} onOpenSettings={toggleSettings} onRestoreTask={onRestoreTask} onStartRenamePerson={onStartRenamePerson} onCreatePerson={handleCreatePerson} t={t} /&gt;\n        &lt;/div&gt;\n        \n        &lt;div className=\"flex-1 flex flex-col min-w-0 relative bg-white dark:bg-gray-950\"&gt;\n          {activeTab.viewingFileId &amp;&amp; (\n              (() =&gt; {\n                  const viewingFile = state.files[activeTab.viewingFileId];\n                  const parentFolder = viewingFile &amp;&amp; viewingFile.parentId ? state.files[viewingFile.parentId] : null;\n                  \n                  if (parentFolder &amp;&amp; parentFolder.category === 'sequence') {\n                      return (\n                          &lt;SequenceViewer\n                              file={viewingFile}\n                              folder={parentFolder}\n                              files={state.files}\n                              sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)}\n                              onClose={closeViewer}\n                              onNavigate={handleViewerJump}\n                              isSidebarOpen={state.layout.isSidebarVisible}\n                              onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))}\n                              onDelete={(id) =&gt; requestDelete([id])}\n                              t={t}\n                          /&gt;\n              }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "lineNumber": 4467
          },
          {
            "text": "      {/* 启动界面 */}",
            "lineNumber": 4468
          },
          {
            "text": "      &lt;SplashScreen isVisible={showSplash} loadingInfo={loadingInfo} /&gt;",
            "lineNumber": 4469
          },
          {
            "text": "      {/* ... (SVG filters) ... */}",
            "lineNumber": 4470
          },
          {
            "text": "      &lt;svg style={{ display: 'none' }}&gt;&lt;defs&gt;&lt;filter id=\"channel-r\"&gt;&lt;feColorMatrix type=\"matrix\" values=\"1 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0\" /&gt;&lt;/filter&gt;&lt;filter id=\"channel-g\"&gt;&lt;feColorMatrix type=\"matrix\" values=\"0 0 0 0 0  0 1 0 0 0  0 0 0 0 0  0 0 0 1 0\" /&gt;&lt;/filter&gt;&lt;filter id=\"channel-b\"&gt;&lt;feColorMatrix type=\"matrix\" values=\"0 0 0 0 0  0 0 0 0 0  0 0 1 0 0  0 0 0 1 0\" /&gt;&lt;/filter&gt;&lt;filter id=\"channel-l\"&gt;&lt;feColorMatrix type=\"saturate\" values=\"0\" /&gt;&lt;/filter&gt;&lt;/defs&gt;&lt;/svg&gt;",
            "lineNumber": 4471
          },
          {
            "text": "      &lt;TabBar tabs={state.tabs} activeTabId={state.activeTabId} files={state.files} onSwitchTab={handleSwitchTab} onCloseTab={handleCloseTab} onNewTab={handleNewTab} onContextMenu={(e, id) =&gt; handleContextMenu(e, 'tab', id)} t={t} showWindowControls={!showSplash} /&gt;",
            "lineNumber": 4472
          },
          {
            "text": "      &lt;div className=\"flex-1 flex overflow-hidden relative transition-all duration-300 ease-[cubic-bezier(0.25,0.1,0.25,1)]\"&gt;",
            "lineNumber": 4473
          },
          {
            "text": "        &lt;div className={&#96;bg-gray-50 dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 flex flex-col transition-all duration-300 shrink-0 z-40 ${state.layout.isSidebarVisible ? 'w-64 translate-x-0 opacity-100' : 'w-0 -translate-x-full opacity-0 overflow-hidden'}&#96;}&gt;",
            "lineNumber": 4474
          },
          {
            "text": "          &lt;Sidebar roots={state.roots} files={state.files} people={state.people} customTags={state.customTags} currentFolderId={activeTab.folderId} expandedIds={state.expandedFolderIds} tasks={state.tasks} onToggle={handleToggleFolder} onNavigate={handleNavigateFolder} onTagSelect={enterTagView} onNavigateAllTags={enterTagsOverview} onPersonSelect={enterPersonView} onNavigateAllPeople={enterPeopleOverview} onContextMenu={handleContextMenu} onDrop={(targetId, sourceIds) =&gt; handleMoveFiles(sourceIds, targetId)} onDropOnTag={handleDropOnTag} isCreatingTag={isCreatingTag} onStartCreateTag={handleCreateNewTag} onSaveNewTag={handleSaveNewTag} onCancelCreateTag={handleCancelCreateTag} onOpenSettings={toggleSettings} onRestoreTask={onRestoreTask} onStartRenamePerson={onStartRenamePerson} onCreatePerson={handleCreatePerson} t={t} /&gt;",
            "lineNumber": 4475
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 4476
          },
          {
            "text": "        ",
            "lineNumber": 4477
          },
          {
            "text": "        &lt;div className=\"flex-1 flex flex-col min-w-0 relative bg-white dark:bg-gray-950\"&gt;",
            "lineNumber": 4478
          },
          {
            "text": "          {activeTab.viewingFileId &amp;&amp; (",
            "lineNumber": 4479
          },
          {
            "text": "              (() =&gt; {",
            "lineNumber": 4480
          },
          {
            "text": "                  const viewingFile = state.files[activeTab.viewingFileId];",
            "lineNumber": 4481
          },
          {
            "text": "                  const parentFolder = viewingFile &amp;&amp; viewingFile.parentId ? state.files[viewingFile.parentId] : null;",
            "lineNumber": 4482
          },
          {
            "text": "                  ",
            "lineNumber": 4483
          },
          {
            "text": "                  if (parentFolder &amp;&amp; parentFolder.category === 'sequence') {",
            "lineNumber": 4484
          },
          {
            "text": "                      return (",
            "lineNumber": 4485
          },
          {
            "text": "                          &lt;SequenceViewer",
            "lineNumber": 4486
          },
          {
            "text": "                              file={viewingFile}",
            "lineNumber": 4487
          },
          {
            "text": "                              folder={parentFolder}",
            "lineNumber": 4488
          },
          {
            "text": "                              files={state.files}",
            "lineNumber": 4489
          },
          {
            "text": "                              sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)}",
            "lineNumber": 4490
          },
          {
            "text": "                              onClose={closeViewer}",
            "lineNumber": 4491
          },
          {
            "text": "                              onNavigate={handleViewerJump}",
            "lineNumber": 4492
          },
          {
            "text": "                              isSidebarOpen={state.layout.isSidebarVisible}",
            "lineNumber": 4493
          },
          {
            "text": "                              onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))}",
            "lineNumber": 4494
          },
          {
            "text": "                              onDelete={(id) =&gt; requestDelete([id])}",
            "lineNumber": 4495
          },
          {
            "text": "                              t={t}",
            "lineNumber": 4496
          },
          {
            "text": "                          /&gt;",
            "lineNumber": 4497
          },
          {
            "text": "              }",
            "lineNumber": 4536
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.4626609981060028
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n() =&gt; { ({...contextMenu, visible: false}); }}&gt;\n             &lt;Maximize size={14} className=\"mr-2 opacity-70\"/&gt; {t('viewer.original')}\n          &lt;/div&gt;\n          &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleFitWindow(); setContextMenu({...contextMenu, visible: false}); }}&gt;\n             &lt;Minimize size={14} className=\"mr-2 opacity-70\"/&gt; {t('viewer.fit')}\n          &lt;/div&gt;\n          \n          &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;\n\n          &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { onViewInExplorer(file.id); setContextMenu({...contextMenu, visible: false}); }}&gt;\n             &lt;ExternalLink size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.viewInExplorer')}\n          &lt;/div&gt;\n          {(() =&gt; {\n            const parentId = file.parentId;\n            const isUnavailable = activeTab.viewMode === 'browser' &amp;&amp; activeTab.folderId === parentId;\n            return (\n              &lt;div \n                className={&#96;px-4 py-2 flex items-center ${isUnavailable ? 'text-gray-400 cursor-default' : 'hover:bg-blue-600 hover:text-white cursor-pointer'}&#96;} \n                onClick={() =&gt; { \n                  if (!isUnavailable &amp;&amp; parentId) { \n                    onNavigateToFolder(parentId); \n                    setContextMenu({...contextMenu, visible: false}); \n                  }\n                }}\n              &gt;\n                &lt;FolderOpen size={14} className={&#96;mr-2 opacity-70 ${isUnavailable ? 'opacity-40' : 'opacity-70'}&#96;}/&gt; \n                {t('context.openFolder')}\n              &lt;/div&gt;\n            );\n          }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "text": "() =&gt; { ({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 659
          },
          {
            "text": "             &lt;Maximize size={14} className=\"mr-2 opacity-70\"/&gt; {t('viewer.original')}",
            "lineNumber": 660
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 661
          },
          {
            "text": "          &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleFitWindow(); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 662
          },
          {
            "text": "             &lt;Minimize size={14} className=\"mr-2 opacity-70\"/&gt; {t('viewer.fit')}",
            "lineNumber": 663
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 664
          },
          {
            "text": "          ",
            "lineNumber": 665
          },
          {
            "text": "          &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;",
            "lineNumber": 666
          },
          {
            "lineNumber": 667
          },
          {
            "text": "          &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { onViewInExplorer(file.id); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 668
          },
          {
            "text": "             &lt;ExternalLink size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.viewInExplorer')}",
            "lineNumber": 669
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 670
          },
          {
            "text": "          {(() =&gt; {",
            "lineNumber": 671
          },
          {
            "text": "            const parentId = file.parentId;",
            "lineNumber": 672
          },
          {
            "text": "            const isUnavailable = activeTab.viewMode === 'browser' &amp;&amp; activeTab.folderId === parentId;",
            "lineNumber": 673
          },
          {
            "text": "            return (",
            "lineNumber": 674
          },
          {
            "text": "              &lt;div ",
            "lineNumber": 675
          },
          {
            "text": "                className={&#96;px-4 py-2 flex items-center ${isUnavailable ? 'text-gray-400 cursor-default' : 'hover:bg-blue-600 hover:text-white cursor-pointer'}&#96;} ",
            "lineNumber": 676
          },
          {
            "text": "                onClick={() =&gt; { ",
            "lineNumber": 677
          },
          {
            "text": "                  if (!isUnavailable &amp;&amp; parentId) { ",
            "lineNumber": 678
          },
          {
            "text": "                    onNavigateToFolder(parentId); ",
            "lineNumber": 679
          },
          {
            "text": "                    setContextMenu({...contextMenu, visible: false}); ",
            "lineNumber": 680
          },
          {
            "text": "                  }",
            "lineNumber": 681
          },
          {
            "text": "                }}",
            "lineNumber": 682
          },
          {
            "text": "              &gt;",
            "lineNumber": 683
          },
          {
            "text": "                &lt;FolderOpen size={14} className={&#96;mr-2 opacity-70 ${isUnavailable ? 'opacity-40' : 'opacity-70'}&#96;}/&gt; ",
            "lineNumber": 684
          },
          {
            "text": "                {t('context.openFolder')}",
            "lineNumber": 685
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 686
          },
          {
            "text": "            );",
            "lineNumber": 687
          },
          {
            "text": "          }",
            "lineNumber": 688
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.40657010674476624
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\ntag =&gt; (\n\n                                  &lt;/div&gt;\n                                ))}\n                              &lt;/div&gt;\n                            );\n                          })()}\n                        &lt;/div&gt;\n                      &lt;/div&gt;\n                    &lt;/div&gt;\n                  ) : activeTab.viewMode === 'people-overview' ? (\n                    &lt;div className=\"flex items-center w-full justify-between\"&gt;\n                      &lt;div className=\"flex items-center\"&gt;\n                        &lt;User size={12} className=\"mr-1\"/&gt;\n                        &lt;span&gt;{t('context.allPeople')}&lt;/span&gt;\n                      &lt;/div&gt;\n                      &lt;div className=\"text-[10px] opacity-60\"&gt;\n                        {Object.keys(state.people).length} {t('context.items')}\n                      &lt;/div&gt;\n                    &lt;/div&gt;\n                  ) : (\n                    &lt;div\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4674
          },
          {
            "text": "tag =&gt; (",
            "lineNumber": 4697
          },
          {
            "lineNumber": 4703
          },
          {
            "text": "                                  &lt;/div&gt;",
            "lineNumber": 4704
          },
          {
            "text": "                                ))}",
            "lineNumber": 4705
          },
          {
            "text": "                              &lt;/div&gt;",
            "lineNumber": 4706
          },
          {
            "text": "                            );",
            "lineNumber": 4707
          },
          {
            "text": "                          })()}",
            "lineNumber": 4708
          },
          {
            "text": "                        &lt;/div&gt;",
            "lineNumber": 4709
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4710
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 4711
          },
          {
            "text": "                  ) : activeTab.viewMode === 'people-overview' ? (",
            "lineNumber": 4712
          },
          {
            "text": "                    &lt;div className=\"flex items-center w-full justify-between\"&gt;",
            "lineNumber": 4713
          },
          {
            "text": "                      &lt;div className=\"flex items-center\"&gt;",
            "lineNumber": 4714
          },
          {
            "text": "                        &lt;User size={12} className=\"mr-1\"/&gt;",
            "lineNumber": 4715
          },
          {
            "text": "                        &lt;span&gt;{t('context.allPeople')}&lt;/span&gt;",
            "lineNumber": 4716
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4717
          },
          {
            "text": "                      &lt;div className=\"text-[10px] opacity-60\"&gt;",
            "lineNumber": 4718
          },
          {
            "text": "                        {Object.keys(state.people).length} {t('context.items')}",
            "lineNumber": 4719
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4720
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 4721
          },
          {
            "text": "                  ) : (",
            "lineNumber": 4722
          },
          {
            "text": "                    &lt;div",
            "lineNumber": 4723
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.4038175940513611
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n                &lt;/div&gt;\n                &lt;div className=\"flex-1 overflow-hidden relative\" id=\"file-grid-container\"&gt;\n                  {displayFileIds.length === 0 &amp;&amp; activeTab.viewMode === 'browser' ? (\n                     &lt;div className=\"w-full h-full flex flex-col items-center justify-center text-gray-400\" onMouseDown={handleMouseDown} onContextMenu={(e) =&gt; handleContextMenu(e, 'background', '')}&gt;\n                        &lt;div className=\"text-6xl mb-4 opacity-20\"&gt;&lt;FolderOpen/&gt;&lt;/div&gt;\n                        &lt;p&gt;{t('context.noFiles')}&lt;/p&gt;\n                     &lt;/div&gt;\n                  ) :  (\n                    &lt;FileGrid \n                        displayFileIds={displayFileIds} \n                        files={state.files} \n                        activeTab={activeTab} \n                        renamingId={state.renamingId} \n                        thumbnailSize={state.thumbnailSize} \n                        resourceRoot={state.settings.paths.resourceRoot}\n                        cachePath={state.settings.paths.cacheRoot || (state.settings.paths.resourceRoot ? &#96;${state.settings.paths.resourceRoot}${state.settings.paths.resourceRoot.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96; : undefined)} \n                        hoverPlayingId={hoverPlayingId} \n                        onSetHoverPlayingId={setHoverPlayingId}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "lineNumber": 4734
          },
          {
            "text": "                &lt;/div&gt;",
            "lineNumber": 4735
          },
          {
            "text": "                &lt;div className=\"flex-1 overflow-hidden relative\" id=\"file-grid-container\"&gt;",
            "lineNumber": 4736
          },
          {
            "text": "                  {displayFileIds.length === 0 &amp;&amp; activeTab.viewMode === 'browser' ? (",
            "lineNumber": 4737
          },
          {
            "text": "                     &lt;div className=\"w-full h-full flex flex-col items-center justify-center text-gray-400\" onMouseDown={handleMouseDown} onContextMenu={(e) =&gt; handleContextMenu(e, 'background', '')}&gt;",
            "lineNumber": 4738
          },
          {
            "text": "                        &lt;div className=\"text-6xl mb-4 opacity-20\"&gt;&lt;FolderOpen/&gt;&lt;/div&gt;",
            "lineNumber": 4739
          },
          {
            "text": "                        &lt;p&gt;{t('context.noFiles')}&lt;/p&gt;",
            "lineNumber": 4740
          },
          {
            "text": "                     &lt;/div&gt;",
            "lineNumber": 4741
          },
          {
            "text": "                  ) :  (",
            "lineNumber": 4742
          },
          {
            "text": "                    &lt;FileGrid ",
            "lineNumber": 4743
          },
          {
            "text": "                        displayFileIds={displayFileIds} ",
            "lineNumber": 4744
          },
          {
            "text": "                        files={state.files} ",
            "lineNumber": 4745
          },
          {
            "text": "                        activeTab={activeTab} ",
            "lineNumber": 4746
          },
          {
            "text": "                        renamingId={state.renamingId} ",
            "lineNumber": 4747
          },
          {
            "text": "                        thumbnailSize={state.thumbnailSize} ",
            "lineNumber": 4748
          },
          {
            "text": "                        resourceRoot={state.settings.paths.resourceRoot}",
            "lineNumber": 4749
          },
          {
            "text": "                        cachePath={state.settings.paths.cacheRoot || (state.settings.paths.resourceRoot ? &#96;${state.settings.paths.resourceRoot}${state.settings.paths.resourceRoot.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96; : undefined)} ",
            "lineNumber": 4750
          },
          {
            "text": "                        hoverPlayingId={hoverPlayingId} ",
            "lineNumber": 4751
          },
          {
            "text": "                        onSetHoverPlayingId={setHoverPlayingId}",
            "lineNumber": 4752
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.39521175622940063
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 681
          },
          "endPosition": {
            "line": 831,
            "column": 1
          }
        },
        "contents": "const FileListItem = ({\n  file,\n  isSelected,\n  renamingId,\n  onFileClick,\n  onFileDoubleClick,\n  onContextMenu,\n  onStartRename,\n  onRenameSubmit,\n  onRenameCancel,\n  onDragStart,\n  onDragEnd,\n  onDragOver,\n  onDragLeave,\n  onDropOnFolder,\n  onDropExternal,\n  t,\n  dragTargetId,\n  resourceRoot,\n  cachePath\n}: any) =&gt; {\n(e) =&gt; {\n\n            }\n        }}\n    &gt;\n        &lt;div className=\"flex-1 flex items-center overflow-hidden min-w-0 pointer-events-none\"&gt;\n            {file.type === FileType.FOLDER ? (\n            &lt;Folder className=\"text-blue-500 mr-3 shrink-0\" size={18} /&gt;\n            ) : (\n            &lt;div className=\"w-6 h-6 mr-3 bg-gray-200 dark:bg-gray-700 rounded overflow-hidden shrink-0 relative\"&gt;\n                {file.type === FileType.IMAGE ? (\n                    &lt;div className=\"w-full h-full\"&gt;\n                        &lt;ImageThumbnail\n                            src={''}\n                            alt={file.name}\n                            isSelected={false}\n                            filePath={file.path}\n                            modified={file.updatedAt}\n                            size={file.size}\n                            isHovering={false}\n                            fileMeta={file.meta}\n                            resourceRoot={resourceRoot}\n                            cachePath={cachePath}\n                        /&gt;\n                    &lt;/div&gt;\n                ) : (\n                    &lt;div className=\"w-full h-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center\"&gt;\n                        &lt;ImageIcon className=\"text-gray-400 dark:text-gray-500\" size={14} /&gt;\n                    &lt;/div&gt;\n                )}\n            &lt;/div&gt;\n            )\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FileListItem = ({",
            "lineNumber": 682
          },
          {
            "text": "  file,",
            "lineNumber": 683
          },
          {
            "text": "  isSelected,",
            "lineNumber": 684
          },
          {
            "text": "  renamingId,",
            "lineNumber": 685
          },
          {
            "text": "  onFileClick,",
            "lineNumber": 686
          },
          {
            "text": "  onFileDoubleClick,",
            "lineNumber": 687
          },
          {
            "text": "  onContextMenu,",
            "lineNumber": 688
          },
          {
            "text": "  onStartRename,",
            "lineNumber": 689
          },
          {
            "text": "  onRenameSubmit,",
            "lineNumber": 690
          },
          {
            "text": "  onRenameCancel,",
            "lineNumber": 691
          },
          {
            "text": "  onDragStart,",
            "lineNumber": 692
          },
          {
            "text": "  onDragEnd,",
            "lineNumber": 693
          },
          {
            "text": "  onDragOver,",
            "lineNumber": 694
          },
          {
            "text": "  onDragLeave,",
            "lineNumber": 695
          },
          {
            "text": "  onDropOnFolder,",
            "lineNumber": 696
          },
          {
            "text": "  onDropExternal,",
            "lineNumber": 697
          },
          {
            "text": "  t,",
            "lineNumber": 698
          },
          {
            "text": "  dragTargetId,",
            "lineNumber": 699
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 700
          },
          {
            "text": "  cachePath",
            "lineNumber": 701
          },
          {
            "text": "}: any) =&gt; {",
            "lineNumber": 702
          },
          {
            "text": "(e) =&gt; {",
            "lineNumber": 729
          },
          {
            "lineNumber": 772
          },
          {
            "text": "            }",
            "lineNumber": 773
          },
          {
            "text": "        }}",
            "lineNumber": 774
          },
          {
            "text": "    &gt;",
            "lineNumber": 775
          },
          {
            "text": "        &lt;div className=\"flex-1 flex items-center overflow-hidden min-w-0 pointer-events-none\"&gt;",
            "lineNumber": 776
          },
          {
            "text": "            {file.type === FileType.FOLDER ? (",
            "lineNumber": 777
          },
          {
            "text": "            &lt;Folder className=\"text-blue-500 mr-3 shrink-0\" size={18} /&gt;",
            "lineNumber": 778
          },
          {
            "text": "            ) : (",
            "lineNumber": 779
          },
          {
            "text": "            &lt;div className=\"w-6 h-6 mr-3 bg-gray-200 dark:bg-gray-700 rounded overflow-hidden shrink-0 relative\"&gt;",
            "lineNumber": 780
          },
          {
            "text": "                {file.type === FileType.IMAGE ? (",
            "lineNumber": 781
          },
          {
            "text": "                    &lt;div className=\"w-full h-full\"&gt;",
            "lineNumber": 782
          },
          {
            "text": "                        &lt;ImageThumbnail",
            "lineNumber": 783
          },
          {
            "text": "                            src={''}",
            "lineNumber": 784
          },
          {
            "text": "                            alt={file.name}",
            "lineNumber": 785
          },
          {
            "text": "                            isSelected={false}",
            "lineNumber": 786
          },
          {
            "text": "                            filePath={file.path}",
            "lineNumber": 787
          },
          {
            "text": "                            modified={file.updatedAt}",
            "lineNumber": 788
          },
          {
            "text": "                            size={file.size}",
            "lineNumber": 789
          },
          {
            "text": "                            isHovering={false}",
            "lineNumber": 790
          },
          {
            "text": "                            fileMeta={file.meta}",
            "lineNumber": 791
          },
          {
            "text": "                            resourceRoot={resourceRoot}",
            "lineNumber": 792
          },
          {
            "text": "                            cachePath={cachePath}",
            "lineNumber": 793
          },
          {
            "text": "                        /&gt;",
            "lineNumber": 794
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 795
          },
          {
            "text": "                ) : (",
            "lineNumber": 796
          },
          {
            "text": "                    &lt;div className=\"w-full h-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center\"&gt;",
            "lineNumber": 797
          },
          {
            "text": "                        &lt;ImageIcon className=\"text-gray-400 dark:text-gray-500\" size={14} /&gt;",
            "lineNumber": 798
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 799
          },
          {
            "text": "                )}",
            "lineNumber": 800
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 801
          },
          {
            "text": "            )",
            "lineNumber": 802
          },
          {
            "text": "};",
            "lineNumber": 832
          }
        ]
      },
      "score": 0.3942888081073761
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\n\n                              t={t}\n                          /&gt;\n                      );\n                  }\n\n                  return (\n                      &lt;ImageViewer\n                          file={state.files[activeTab.viewingFileId]}\n                          sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)} \n                          files={state.files}\n                          layout={state.layout}\n                          slideshowConfig={state.slideshowConfig}\n                          onLayoutToggle={(part) =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, [part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible']: !s.layout[part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible'] } }))}\n                          onClose={closeViewer}\n                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}\n                          onPrev={() =&gt; handleViewerNavigate('prev')}\n                          onNavigateBack={goBack}\n                          onNavigateForward={goForward}\n                          canGoBack={activeTab.history.currentIndex &gt; 0}\n                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}\n                          onDelete={(id) =&gt; requestDelete([id])}\n                          onViewInExplorer={handleViewInExplorer}\n                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}\n                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}\n                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}\n                          searchQuery={activeTab.searchQuery}\n                          onSearch={handleViewerSearch}\n                          searchScope={activeTab.searchScope}\n                          onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })}\n                          onUpdateSlideshowConfig={(cfg) =&gt; setState(s =&gt; ({ ...s, slideshowConfig: cfg }))}\n                          onPasteTags={(id) =&gt; handlePasteTags([id])}\n                          onEditTags={() =&gt; setState\n              }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4480
          },
          {
            "lineNumber": 4495
          },
          {
            "text": "                              t={t}",
            "lineNumber": 4496
          },
          {
            "text": "                          /&gt;",
            "lineNumber": 4497
          },
          {
            "text": "                      );",
            "lineNumber": 4498
          },
          {
            "text": "                  }",
            "lineNumber": 4499
          },
          {
            "lineNumber": 4500
          },
          {
            "text": "                  return (",
            "lineNumber": 4501
          },
          {
            "text": "                      &lt;ImageViewer",
            "lineNumber": 4502
          },
          {
            "text": "                          file={state.files[activeTab.viewingFileId]}",
            "lineNumber": 4503
          },
          {
            "text": "                          sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)} ",
            "lineNumber": 4504
          },
          {
            "text": "                          files={state.files}",
            "lineNumber": 4505
          },
          {
            "text": "                          layout={state.layout}",
            "lineNumber": 4506
          },
          {
            "text": "                          slideshowConfig={state.slideshowConfig}",
            "lineNumber": 4507
          },
          {
            "text": "                          onLayoutToggle={(part) =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, [part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible']: !s.layout[part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible'] } }))}",
            "lineNumber": 4508
          },
          {
            "text": "                          onClose={closeViewer}",
            "lineNumber": 4509
          },
          {
            "text": "                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}",
            "lineNumber": 4510
          },
          {
            "text": "                          onPrev={() =&gt; handleViewerNavigate('prev')}",
            "lineNumber": 4511
          },
          {
            "text": "                          onNavigateBack={goBack}",
            "lineNumber": 4512
          },
          {
            "text": "                          onNavigateForward={goForward}",
            "lineNumber": 4513
          },
          {
            "text": "                          canGoBack={activeTab.history.currentIndex &gt; 0}",
            "lineNumber": 4514
          },
          {
            "text": "                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}",
            "lineNumber": 4515
          },
          {
            "text": "                          onDelete={(id) =&gt; requestDelete([id])}",
            "lineNumber": 4516
          },
          {
            "text": "                          onViewInExplorer={handleViewInExplorer}",
            "lineNumber": 4517
          },
          {
            "text": "                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4518
          },
          {
            "text": "                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4519
          },
          {
            "text": "                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}",
            "lineNumber": 4520
          },
          {
            "text": "                          searchQuery={activeTab.searchQuery}",
            "lineNumber": 4521
          },
          {
            "text": "                          onSearch={handleViewerSearch}",
            "lineNumber": 4522
          },
          {
            "text": "                          searchScope={activeTab.searchScope}",
            "lineNumber": 4523
          },
          {
            "text": "                          onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })}",
            "lineNumber": 4524
          },
          {
            "text": "                          onUpdateSlideshowConfig={(cfg) =&gt; setState(s =&gt; ({ ...s, slideshowConfig: cfg }))}",
            "lineNumber": 4525
          },
          {
            "text": "                          onPasteTags={(id) =&gt; handlePasteTags([id])}",
            "lineNumber": 4526
          },
          {
            "text": "                          onEditTags={() =&gt; setState",
            "lineNumber": 4527
          },
          {
            "text": "              }",
            "lineNumber": 4536
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.3935840129852295
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n                      &lt;div \n                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'copy' ? 'bg-blue-600/80' : 'bg-blue-600/50 hover:bg-blue-600/70'}&#96;}\n                      &gt;\n                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📋&lt;/div&gt;\n                        &lt;h3 className=\"text-white text-2xl font-bold mb-2\"&gt;{t('context.copyTo')}&lt;/h3&gt;\n                        &lt;p className=\"text-white/80 text-center max-w-xs\"&gt;{t('context.copyToCurrentFolder')}&lt;/p&gt;\n                      &lt;/div&gt;\n                      \n                      {/* Divider */}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "lineNumber": 4623
          },
          {
            "text": "                      &lt;div ",
            "lineNumber": 4624
          },
          {
            "text": "                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'copy' ? 'bg-blue-600/80' : 'bg-blue-600/50 hover:bg-blue-600/70'}&#96;}",
            "lineNumber": 4625
          },
          {
            "text": "                      &gt;",
            "lineNumber": 4626
          },
          {
            "text": "                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📋&lt;/div&gt;",
            "lineNumber": 4627
          },
          {
            "text": "                        &lt;h3 className=\"text-white text-2xl font-bold mb-2\"&gt;{t('context.copyTo')}&lt;/h3&gt;",
            "lineNumber": 4628
          },
          {
            "text": "                        &lt;p className=\"text-white/80 text-center max-w-xs\"&gt;{t('context.copyToCurrentFolder')}&lt;/p&gt;",
            "lineNumber": 4629
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4630
          },
          {
            "text": "                      ",
            "lineNumber": 4631
          },
          {
            "text": "                      {/* Divider */}",
            "lineNumber": 4632
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.392805814743042
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleRenameSubmit = async \n\n              }\n              \n              await handleRefresh();\n              setState(s =&gt; ({ ...s, renamingId: null }));\n          } catch (e) {\n              console.error(\"Rename failed\", e);\n              showToast(\"Rename failed\");\n          }\n      } else {\n          handleUpdateFile(id, { name: value });\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 3111,
                "column": 3
              },
              "endPosition": {
                "line": 3111,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 3111,
                "column": 9
              },
              "endPosition": {
                "line": 3111,
                "column": 29
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleRenameSubmit = async ",
            "lineNumber": 3124
          },
          {
            "lineNumber": 3141
          },
          {
            "text": "              }",
            "lineNumber": 3142
          },
          {
            "text": "              ",
            "lineNumber": 3143
          },
          {
            "text": "              await handleRefresh();",
            "lineNumber": 3144
          },
          {
            "text": "              setState(s =&gt; ({ ...s, renamingId: null }));",
            "lineNumber": 3145
          },
          {
            "text": "          } catch (e) {",
            "lineNumber": 3146
          },
          {
            "text": "              console.error(\"Rename failed\", e);",
            "lineNumber": 3147
          },
          {
            "text": "              showToast(\"Rename failed\");",
            "lineNumber": 3148
          },
          {
            "text": "          }",
            "lineNumber": 3149
          },
          {
            "text": "      } else {",
            "lineNumber": 3150
          },
          {
            "text": "          handleUpdateFile(id, { name: value });",
            "lineNumber": 3151
          },
          {
            "text": ";",
            "lineNumber": 3154
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.3881944417953491
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nname}&lt;/span&gt;\n                              &lt;button onClick={() =&gt; handleClearPersonFilter()} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;\n                          &lt;/div&gt;\n                      )}\n                      \n                      {activeTab.activeTags.map(tag =&gt; (\n                          &lt;div key={tag} className=\"flex items-center bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded-full text-xs border border-blue-200 dark:border-blue-800 whitespace-nowrap\"&gt;\n                              &lt;span&gt;{tag}&lt;/span&gt;\n                              &lt;button onClick={() =&gt; handleClearTagFilter(tag)} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;\n                          &lt;/div&gt;\n                      ))}\n                      \n                      &lt;button onClick={() =&gt; { handleClearAllTags(); handleClearPersonFilter(); updateActiveTab({ dateFilter: { start: null, end: null, mode: 'created' as const }, aiFilter: null }); }} className=\"text-xs text-gray-500 hover:text-red-500 underline ml-2 whitespace-nowrap\"&gt;{t('context.clearAll')}&lt;/button&gt;\n                  &lt;/div&gt;\n              )}\n              \n              &lt;div className=\"flex-1 flex flex-col relative bg-white dark:bg-gray-950 overflow-hidden\" \n                   onDragOver={handleDragOver}\n                   onDragLeave={handleDragLeave}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "name}&lt;/span&gt;",
            "lineNumber": 4597
          },
          {
            "text": "                              &lt;button onClick={() =&gt; handleClearPersonFilter()} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;",
            "lineNumber": 4598
          },
          {
            "text": "                          &lt;/div&gt;",
            "lineNumber": 4599
          },
          {
            "text": "                      )}",
            "lineNumber": 4600
          },
          {
            "text": "                      ",
            "lineNumber": 4601
          },
          {
            "text": "                      {activeTab.activeTags.map(tag =&gt; (",
            "lineNumber": 4602
          },
          {
            "text": "                          &lt;div key={tag} className=\"flex items-center bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded-full text-xs border border-blue-200 dark:border-blue-800 whitespace-nowrap\"&gt;",
            "lineNumber": 4603
          },
          {
            "text": "                              &lt;span&gt;{tag}&lt;/span&gt;",
            "lineNumber": 4604
          },
          {
            "text": "                              &lt;button onClick={() =&gt; handleClearTagFilter(tag)} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;",
            "lineNumber": 4605
          },
          {
            "text": "                          &lt;/div&gt;",
            "lineNumber": 4606
          },
          {
            "text": "                      ))}",
            "lineNumber": 4607
          },
          {
            "text": "                      ",
            "lineNumber": 4608
          },
          {
            "text": "                      &lt;button onClick={() =&gt; { handleClearAllTags(); handleClearPersonFilter(); updateActiveTab({ dateFilter: { start: null, end: null, mode: 'created' as const }, aiFilter: null }); }} className=\"text-xs text-gray-500 hover:text-red-500 underline ml-2 whitespace-nowrap\"&gt;{t('context.clearAll')}&lt;/button&gt;",
            "lineNumber": 4609
          },
          {
            "text": "                  &lt;/div&gt;",
            "lineNumber": 4610
          },
          {
            "text": "              )}",
            "lineNumber": 4611
          },
          {
            "text": "              ",
            "lineNumber": 4612
          },
          {
            "text": "              &lt;div className=\"flex-1 flex flex-col relative bg-white dark:bg-gray-950 overflow-hidden\" ",
            "lineNumber": 4613
          },
          {
            "text": "                   onDragOver={handleDragOver}",
            "lineNumber": 4614
          },
          {
            "text": "                   onDragLeave={handleDragLeave}",
            "lineNumber": 4615
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.3877995014190674
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 449
          },
          "endPosition": {
            "line": 510,
            "column": 1
          }
        },
        "contents": "export const InlineRenameInput = \n\n\n  useEffect(() =&gt; {\n    if (inputRef.current) {\n      inputRef.current.focus();\n      const lastDot = defaultValue.lastIndexOf('.');\n      if (lastDot &gt; 0) {\n        inputRef.current.setSelectionRange(0, lastDot);\n      } else {\n        inputRef.current.select();\n      }\n    }\n  }, []);\n\n  const handleKeyDown = (e: React.KeyboardEvent) =&gt; {\n    if (e.key === 'Enter') {\n      e.stopPropagation();\n      onCommit(inputRef.current?.value || defaultValue);\n    }\n    if (e.key === 'Escape') {\n      e.stopPropagation();\n      onCancel();\n    }\n  };\n\n  return (\n    &lt;input\n      ref={inputRef}\n      type=\"text\"\n      defaultValue={defaultValue}\n      onBlur={(e) =&gt; onCommit(e.target.value)}\n      onKeyDown={handleKeyDown}\n      onClick={(e) =&gt; e.stopPropagation()}\n      onMouseDown={(e) =&gt; e.stopPropagation()}\n      className=\"w-full text-center text-xs font-bold bg-white dark:bg-gray-700 border border-blue-500 rounded px-1 py-0.5 focus:outline-none shadow-sm cursor-text\"\n    /&gt;\n  );\n};\n\nconst TagItem = React.memo(({ tag, count, isSelected, onTagClick, onTagDoubleClick, onTagContextMenu, handleMouseEnter, handleMouseLeave }: any) =&gt; {\n  return (\n    &lt;div \n      key={tag} \n      data-tag={tag}\n      className={&#96;tag-item rounded-lg p-4 border-2 cursor-pointer group transition-all relative ${isSelected ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500 shadow-lg ring-2 ring-blue-300/50 dark:ring-blue-700/50' : 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500'}&#96;} \n      onClick={(e) =&gt; { e.stopPropagation(); onTagClick &amp;&amp; onTagClick(tag, e); }}\n      onMouseDown={(e) =&gt; e.stopPropagation()}\n      onDoubleClick={() =&gt; onTagDoubleClick &amp;&amp; onTagDoubleClick(tag)} \n      onContextMenu={(e) =&gt; onTagContextMenu &amp;&amp; onTagContextMenu(e, tag)}\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export const InlineRenameInput = ",
            "lineNumber": 450
          },
          {
            "lineNumber": 451
          },
          {
            "lineNumber": 452
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 453
          },
          {
            "text": "    if (inputRef.current) {",
            "lineNumber": 454
          },
          {
            "text": "      inputRef.current.focus();",
            "lineNumber": 455
          },
          {
            "text": "      const lastDot = defaultValue.lastIndexOf('.');",
            "lineNumber": 456
          },
          {
            "text": "      if (lastDot &gt; 0) {",
            "lineNumber": 457
          },
          {
            "text": "        inputRef.current.setSelectionRange(0, lastDot);",
            "lineNumber": 458
          },
          {
            "text": "      } else {",
            "lineNumber": 459
          },
          {
            "text": "        inputRef.current.select();",
            "lineNumber": 460
          },
          {
            "text": "      }",
            "lineNumber": 461
          },
          {
            "text": "    }",
            "lineNumber": 462
          },
          {
            "text": "  }, []);",
            "lineNumber": 463
          },
          {
            "lineNumber": 464
          },
          {
            "text": "  const handleKeyDown = (e: React.KeyboardEvent) =&gt; {",
            "lineNumber": 465
          },
          {
            "text": "    if (e.key === 'Enter') {",
            "lineNumber": 466
          },
          {
            "text": "      e.stopPropagation();",
            "lineNumber": 467
          },
          {
            "text": "      onCommit(inputRef.current?.value || defaultValue);",
            "lineNumber": 468
          },
          {
            "text": "    }",
            "lineNumber": 469
          },
          {
            "text": "    if (e.key === 'Escape') {",
            "lineNumber": 470
          },
          {
            "text": "      e.stopPropagation();",
            "lineNumber": 471
          },
          {
            "text": "      onCancel();",
            "lineNumber": 472
          },
          {
            "text": "    }",
            "lineNumber": 473
          },
          {
            "text": "  };",
            "lineNumber": 474
          },
          {
            "lineNumber": 475
          },
          {
            "text": "  return (",
            "lineNumber": 476
          },
          {
            "text": "    &lt;input",
            "lineNumber": 477
          },
          {
            "text": "      ref={inputRef}",
            "lineNumber": 478
          },
          {
            "text": "      type=\"text\"",
            "lineNumber": 479
          },
          {
            "text": "      defaultValue={defaultValue}",
            "lineNumber": 480
          },
          {
            "text": "      onBlur={(e) =&gt; onCommit(e.target.value)}",
            "lineNumber": 481
          },
          {
            "text": "      onKeyDown={handleKeyDown}",
            "lineNumber": 482
          },
          {
            "text": "      onClick={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 483
          },
          {
            "text": "      onMouseDown={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 484
          },
          {
            "text": "      className=\"w-full text-center text-xs font-bold bg-white dark:bg-gray-700 border border-blue-500 rounded px-1 py-0.5 focus:outline-none shadow-sm cursor-text\"",
            "lineNumber": 485
          },
          {
            "text": "    /&gt;",
            "lineNumber": 486
          },
          {
            "text": "  );",
            "lineNumber": 487
          },
          {
            "text": "};",
            "lineNumber": 488
          },
          {
            "lineNumber": 489
          },
          {
            "text": "const TagItem = React.memo(({ tag, count, isSelected, onTagClick, onTagDoubleClick, onTagContextMenu, handleMouseEnter, handleMouseLeave }: any) =&gt; {",
            "lineNumber": 490
          },
          {
            "text": "  return (",
            "lineNumber": 491
          },
          {
            "text": "    &lt;div ",
            "lineNumber": 492
          },
          {
            "text": "      key={tag} ",
            "lineNumber": 493
          },
          {
            "text": "      data-tag={tag}",
            "lineNumber": 494
          },
          {
            "text": "      className={&#96;tag-item rounded-lg p-4 border-2 cursor-pointer group transition-all relative ${isSelected ? 'bg-blue-100 dark:bg-blue-900/50 border-blue-500 shadow-lg ring-2 ring-blue-300/50 dark:ring-blue-700/50' : 'bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-500'}&#96;} ",
            "lineNumber": 495
          },
          {
            "text": "      onClick={(e) =&gt; { e.stopPropagation(); onTagClick &amp;&amp; onTagClick(tag, e); }}",
            "lineNumber": 496
          },
          {
            "text": "      onMouseDown={(e) =&gt; e.stopPropagation()}",
            "lineNumber": 497
          },
          {
            "text": "      onDoubleClick={() =&gt; onTagDoubleClick &amp;&amp; onTagDoubleClick(tag)} ",
            "lineNumber": 498
          },
          {
            "text": "      onContextMenu={(e) =&gt; onTagContextMenu &amp;&amp; onTagContextMenu(e, tag)}",
            "lineNumber": 499
          },
          {
            "text": "};",
            "lineNumber": 511
          }
        ]
      },
      "score": 0.38282549381256104
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n                      \n                      {/* Divider */}\n                      &lt;div className=\"w-1 bg-white/20\"&gt;&lt;/div&gt;\n                      \n                      {/* Move section */}\n                      &lt;div \n                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'move' ? 'bg-green-600/80' : 'bg-green-600/50 hover:bg-green-600/70'}&#96;}\n                      &gt;\n                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📁&lt;/div&gt;\n                        &lt;h3 className=\"text-white text-2xl font-bold mb-2\"&gt;{t('context.moveTo')}&lt;/h3&gt;\n                        &lt;p className=\"text-white/80 text-center max-w-xs\"&gt;{t('context.moveToCurrentFolder')}&lt;/p&gt;\n                      &lt;/div&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n                )}\n                &lt;div className=\"h-14 flex items-center justify-between px-4 text-xs text-gray-500 dark:text-gray-400 border-b border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-950/50 backdrop-blur shrink-0 relative z-20\"&gt;\n                  {activeTab.viewMode === 'tags-overview' ? (\n                    &lt;div className=\"flex items-center w-full\"&gt;\n                      &lt;div className=\"flex items-center\"&gt;\n                        &lt;Tag size={12} className=\"mr-1\"/&gt;\n                        &lt;span className=\"font-medium\"&gt;{t('context.allTagsOverview')}&lt;/span&gt;\n                      &lt;/div&gt;\n                      &lt;div className=\"flex-1 flex justify-end\"&gt;\n                        &lt;div className=\"relative\" style={{ width: '250px' }}&gt;\n                          &lt;div className={&#96;flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border ${tagSearchQuery ? 'border-blue-500 shadow-sm' : 'border-transparent'}&#96;}&gt;\n                            &lt;Search size={14} className=\"mr-2 text-gray-400\" /&gt;\n                            &lt;input\n                              type=\"text\"\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "lineNumber": 4630
          },
          {
            "text": "                      ",
            "lineNumber": 4631
          },
          {
            "text": "                      {/* Divider */}",
            "lineNumber": 4632
          },
          {
            "text": "                      &lt;div className=\"w-1 bg-white/20\"&gt;&lt;/div&gt;",
            "lineNumber": 4633
          },
          {
            "text": "                      ",
            "lineNumber": 4634
          },
          {
            "text": "                      {/* Move section */}",
            "lineNumber": 4635
          },
          {
            "text": "                      &lt;div ",
            "lineNumber": 4636
          },
          {
            "text": "                        className={&#96;flex-1 flex flex-col items-center justify-center transition-all duration-200 pointer-events-auto cursor-pointer ${dragAction === 'move' ? 'bg-green-600/80' : 'bg-green-600/50 hover:bg-green-600/70'}&#96;}",
            "lineNumber": 4637
          },
          {
            "text": "                      &gt;",
            "lineNumber": 4638
          },
          {
            "text": "                        &lt;div className=\"text-white text-6xl mb-4\"&gt;📁&lt;/div&gt;",
            "lineNumber": 4639
          },
          {
            "text": "                        &lt;h3 className=\"text-white text-2xl font-bold mb-2\"&gt;{t('context.moveTo')}&lt;/h3&gt;",
            "lineNumber": 4640
          },
          {
            "text": "                        &lt;p className=\"text-white/80 text-center max-w-xs\"&gt;{t('context.moveToCurrentFolder')}&lt;/p&gt;",
            "lineNumber": 4641
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4642
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 4643
          },
          {
            "text": "                  &lt;/div&gt;",
            "lineNumber": 4644
          },
          {
            "text": "                )}",
            "lineNumber": 4645
          },
          {
            "text": "                &lt;div className=\"h-14 flex items-center justify-between px-4 text-xs text-gray-500 dark:text-gray-400 border-b border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-950/50 backdrop-blur shrink-0 relative z-20\"&gt;",
            "lineNumber": 4646
          },
          {
            "text": "                  {activeTab.viewMode === 'tags-overview' ? (",
            "lineNumber": 4647
          },
          {
            "text": "                    &lt;div className=\"flex items-center w-full\"&gt;",
            "lineNumber": 4648
          },
          {
            "text": "                      &lt;div className=\"flex items-center\"&gt;",
            "lineNumber": 4649
          },
          {
            "text": "                        &lt;Tag size={12} className=\"mr-1\"/&gt;",
            "lineNumber": 4650
          },
          {
            "text": "                        &lt;span className=\"font-medium\"&gt;{t('context.allTagsOverview')}&lt;/span&gt;",
            "lineNumber": 4651
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4652
          },
          {
            "text": "                      &lt;div className=\"flex-1 flex justify-end\"&gt;",
            "lineNumber": 4653
          },
          {
            "text": "                        &lt;div className=\"relative\" style={{ width: '250px' }}&gt;",
            "lineNumber": 4654
          },
          {
            "text": "                          &lt;div className={&#96;flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border ${tagSearchQuery ? 'border-blue-500 shadow-sm' : 'border-transparent'}&#96;}&gt;",
            "lineNumber": 4655
          },
          {
            "text": "                            &lt;Search size={14} className=\"mr-2 text-gray-400\" /&gt;",
            "lineNumber": 4656
          },
          {
            "text": "                            &lt;input",
            "lineNumber": 4657
          },
          {
            "text": "                              type=\"text\"",
            "lineNumber": 4658
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.3764303922653198
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1126
          },
          "endPosition": {
            "line": 1247,
            "column": 1
          }
        },
        "contents": "const GroupContent = ({\n  group,\n  files,\n  activeTab,\n  renamingId,\n  thumbnailSize,\n  hoverPlayingId,\n  dragTargetId,\n  handleFileClick,\n  handleFileDoubleClick,\n  handleContextMenu,\n  handleStartRename,\n  handleRenameSubmit,\n  handleRenameCancel,\n  handleSetHoverPlayingId,\n  handleDragStart,\n  handleDragEnd,\n  handleDragOverFolder,\n  handleDragLeaveFolder,\n  handleDropOnFolderWrapper,\n  settings,\n  containerRect,\n  t,\n  resourceRoot,\n  cachePath\n}: any) =&gt; {\n (\n        // List layout\n        &lt;div className=\"overflow-hidden\"&gt;\n          {group.fileIds.map((id: string) =&gt; {\n            const file = files[id];\n            if (!file) return null;\n            return (\n              &lt;FileListItem\n                  key={file.id}\n                  file={file}\n                  isSelected={activeTab.selectedFileIds.includes(file.id)}\n                  renamingId={renamingId}\n                  onFileClick={handleFileClick}\n                  onFileDoubleClick={handleFileDoubleClick}\n                  onContextMenu={handleContextMenu}\n                  onStartRename={handleStartRename}\n                  onRenameSubmit={handleRenameSubmit}\n                  onRenameCancel={handleRenameCancel}\n                  onDragStart={handleDragStart}\n                  onDragEnd={handleDragEnd}\n                  onDragOver={(e: React.DragEvent) =&gt; handleDragOverFolder(e, file.id)}\n                  onDragLeave={(e: React.DragEvent) =&gt; handleDragLeaveFolder(e, file.id)}\n                  onDropOnFolder={handleDropOnFolderWrapper}\n                  onDropExternal={null}\n                  t={t}\n                  dragTargetId={dragTargetId}\n                  resourceRoot={effectiveResourceRoot}\n                  cachePath={effectiveCachePath}\n              /&gt;\n            );\n          })}\n        &lt;/div&gt;\n      ) : (\n        // Grid, adaptive, or masonry layout\n        &lt;div \n          className=\"relative\" \n          style={{ \n            width: '100%', \n            height: layout.reduce((max, item) =&gt; Math.max(max, item.y + item.height), 0) \n          }}\n        &gt;\n          {layout.map((item) =&gt; {\n            const file = files[item.id];\n            if (!file) return null;\n            \n            return (\n              &lt;FileCard\n                    key={file.id}\n                    file={file}\n                    files={files}\n          }\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const GroupContent = ({",
            "lineNumber": 1127
          },
          {
            "text": "  group,",
            "lineNumber": 1128
          },
          {
            "text": "  files,",
            "lineNumber": 1129
          },
          {
            "text": "  activeTab,",
            "lineNumber": 1130
          },
          {
            "text": "  renamingId,",
            "lineNumber": 1131
          },
          {
            "text": "  thumbnailSize,",
            "lineNumber": 1132
          },
          {
            "text": "  hoverPlayingId,",
            "lineNumber": 1133
          },
          {
            "text": "  dragTargetId,",
            "lineNumber": 1134
          },
          {
            "text": "  handleFileClick,",
            "lineNumber": 1135
          },
          {
            "text": "  handleFileDoubleClick,",
            "lineNumber": 1136
          },
          {
            "text": "  handleContextMenu,",
            "lineNumber": 1137
          },
          {
            "text": "  handleStartRename,",
            "lineNumber": 1138
          },
          {
            "text": "  handleRenameSubmit,",
            "lineNumber": 1139
          },
          {
            "text": "  handleRenameCancel,",
            "lineNumber": 1140
          },
          {
            "text": "  handleSetHoverPlayingId,",
            "lineNumber": 1141
          },
          {
            "text": "  handleDragStart,",
            "lineNumber": 1142
          },
          {
            "text": "  handleDragEnd,",
            "lineNumber": 1143
          },
          {
            "text": "  handleDragOverFolder,",
            "lineNumber": 1144
          },
          {
            "text": "  handleDragLeaveFolder,",
            "lineNumber": 1145
          },
          {
            "text": "  handleDropOnFolderWrapper,",
            "lineNumber": 1146
          },
          {
            "text": "  settings,",
            "lineNumber": 1147
          },
          {
            "text": "  containerRect,",
            "lineNumber": 1148
          },
          {
            "text": "  t,",
            "lineNumber": 1149
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 1150
          },
          {
            "text": "  cachePath",
            "lineNumber": 1151
          },
          {
            "text": "}: any) =&gt; {",
            "lineNumber": 1152
          },
          {
            "text": " (",
            "lineNumber": 1169
          },
          {
            "text": "        // List layout",
            "lineNumber": 1170
          },
          {
            "text": "        &lt;div className=\"overflow-hidden\"&gt;",
            "lineNumber": 1171
          },
          {
            "text": "          {group.fileIds.map((id: string) =&gt; {",
            "lineNumber": 1172
          },
          {
            "text": "            const file = files[id];",
            "lineNumber": 1173
          },
          {
            "text": "            if (!file) return null;",
            "lineNumber": 1174
          },
          {
            "text": "            return (",
            "lineNumber": 1175
          },
          {
            "text": "              &lt;FileListItem",
            "lineNumber": 1176
          },
          {
            "text": "                  key={file.id}",
            "lineNumber": 1177
          },
          {
            "text": "                  file={file}",
            "lineNumber": 1178
          },
          {
            "text": "                  isSelected={activeTab.selectedFileIds.includes(file.id)}",
            "lineNumber": 1179
          },
          {
            "text": "                  renamingId={renamingId}",
            "lineNumber": 1180
          },
          {
            "text": "                  onFileClick={handleFileClick}",
            "lineNumber": 1181
          },
          {
            "text": "                  onFileDoubleClick={handleFileDoubleClick}",
            "lineNumber": 1182
          },
          {
            "text": "                  onContextMenu={handleContextMenu}",
            "lineNumber": 1183
          },
          {
            "text": "                  onStartRename={handleStartRename}",
            "lineNumber": 1184
          },
          {
            "text": "                  onRenameSubmit={handleRenameSubmit}",
            "lineNumber": 1185
          },
          {
            "text": "                  onRenameCancel={handleRenameCancel}",
            "lineNumber": 1186
          },
          {
            "text": "                  onDragStart={handleDragStart}",
            "lineNumber": 1187
          },
          {
            "text": "                  onDragEnd={handleDragEnd}",
            "lineNumber": 1188
          },
          {
            "text": "                  onDragOver={(e: React.DragEvent) =&gt; handleDragOverFolder(e, file.id)}",
            "lineNumber": 1189
          },
          {
            "text": "                  onDragLeave={(e: React.DragEvent) =&gt; handleDragLeaveFolder(e, file.id)}",
            "lineNumber": 1190
          },
          {
            "text": "                  onDropOnFolder={handleDropOnFolderWrapper}",
            "lineNumber": 1191
          },
          {
            "text": "                  onDropExternal={null}",
            "lineNumber": 1192
          },
          {
            "text": "                  t={t}",
            "lineNumber": 1193
          },
          {
            "text": "                  dragTargetId={dragTargetId}",
            "lineNumber": 1194
          },
          {
            "text": "                  resourceRoot={effectiveResourceRoot}",
            "lineNumber": 1195
          },
          {
            "text": "                  cachePath={effectiveCachePath}",
            "lineNumber": 1196
          },
          {
            "text": "              /&gt;",
            "lineNumber": 1197
          },
          {
            "text": "            );",
            "lineNumber": 1198
          },
          {
            "text": "          })}",
            "lineNumber": 1199
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 1200
          },
          {
            "text": "      ) : (",
            "lineNumber": 1201
          },
          {
            "text": "        // Grid, adaptive, or masonry layout",
            "lineNumber": 1202
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 1203
          },
          {
            "text": "          className=\"relative\" ",
            "lineNumber": 1204
          },
          {
            "text": "          style={{ ",
            "lineNumber": 1205
          },
          {
            "text": "            width: '100%', ",
            "lineNumber": 1206
          },
          {
            "text": "            height: layout.reduce((max, item) =&gt; Math.max(max, item.y + item.height), 0) ",
            "lineNumber": 1207
          },
          {
            "text": "          }}",
            "lineNumber": 1208
          },
          {
            "text": "        &gt;",
            "lineNumber": 1209
          },
          {
            "text": "          {layout.map((item) =&gt; {",
            "lineNumber": 1210
          },
          {
            "text": "            const file = files[item.id];",
            "lineNumber": 1211
          },
          {
            "text": "            if (!file) return null;",
            "lineNumber": 1212
          },
          {
            "text": "            ",
            "lineNumber": 1213
          },
          {
            "text": "            return (",
            "lineNumber": 1214
          },
          {
            "text": "              &lt;FileCard",
            "lineNumber": 1215
          },
          {
            "text": "                    key={file.id}",
            "lineNumber": 1216
          },
          {
            "text": "                    file={file}",
            "lineNumber": 1217
          },
          {
            "text": "                    files={files}",
            "lineNumber": 1218
          },
          {
            "text": "          }",
            "lineNumber": 1243
          },
          {
            "text": "};",
            "lineNumber": 1248
          }
        ]
      },
      "score": 0.3763557970523834
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleExternalFileDrop = async \n\n      \n      setDragFiles(null);\n  };\n\n  const handleFileClick = (e: React.MouseEvent, id: string) =&gt; {\n    e.stopPropagation();\n    \n    // 关闭右键菜单\n    closeContextMenu();\n    \n    // If we just finished a selection box operation, don't process the click\n    if (isSelecting) return;\n    \n    const isCtrl = e.ctrlKey || e.metaKey; // Ctrl for Windows/Linux, Command for macOS\n    const isShift = e.shiftKey;\n    \n    let newSelectedFileIds: string[];\n    let newLastSelectedId: string = id;\n    \n    if (isCtrl) {\n      // Ctrl+Click: Toggle selection of this file\n      if (activeTab.selectedFileIds.includes(id)) {\n        // Remove from selection\n        newSelectedFileIds = activeTab.selectedFileIds.filter(fileId =&gt; fileId !== id);\n      } else {\n        // Add to selection\n        newSelectedFileIds = [...activeTab.selectedFileIds, id];\n      }\n    } else if (isShift &amp;&amp; activeTab.lastSelectedId &amp;&amp; activeTab.selectedFileIds.length &gt; 0) {\n      // Shift+Click: Select range from last selected to current\n      const currentFolderId = activeTab.folderId;\n      let allFiles: string[] = [];\n      \n      if (activeTab.searchQuery) {\n        // Search results view\n        allFiles = displayFileIds;\n      } else {\n        // Folder view - use displayFileIds which already contains the sorted and filtered list of files to display\n        allFiles = displayFileIds;\n      }\n      \n      const lastIndex = allFiles.indexOf(activeTab.lastSelectedId);\n      const currentIndex = allFiles.indexOf(id);\n      \n      if (lastIndex !== -1 &amp;&amp; currentIndex !== -1) {\n        const start = Math.min(lastIndex, currentIndex);\n        const end = Math.max(lastIndex, currentIndex);\n        newSelectedFileIds = allFiles.slice(start, end + 1);\n      } else {\n        newSelectedFileIds = [id];\n      }\n    } else {\n      // Normal click: Select only this file\n      newSelectedFileIds = [id];\n    }\n    \n    updateActiveTab({ \n        selectedFileIds: newSelectedFileIds, \n        lastSelectedId: newLastSelectedId \n    });\n  };\n\n  const handleMouseDown = (e: React.MouseEvent) =&gt; {\n    // 关闭右键菜单\n    closeContextMenu();\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleExternalFileDrop = async ",
            "lineNumber": 1721
          },
          {
            "lineNumber": 1759
          },
          {
            "text": "      ",
            "lineNumber": 1760
          },
          {
            "text": "      setDragFiles(null);",
            "lineNumber": 1761
          },
          {
            "text": "  };",
            "lineNumber": 1762
          },
          {
            "lineNumber": 1763
          },
          {
            "text": "  const handleFileClick = (e: React.MouseEvent, id: string) =&gt; {",
            "lineNumber": 1764
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 1765
          },
          {
            "text": "    ",
            "lineNumber": 1766
          },
          {
            "text": "    // 关闭右键菜单",
            "lineNumber": 1767
          },
          {
            "text": "    closeContextMenu();",
            "lineNumber": 1768
          },
          {
            "text": "    ",
            "lineNumber": 1769
          },
          {
            "text": "    // If we just finished a selection box operation, don't process the click",
            "lineNumber": 1770
          },
          {
            "text": "    if (isSelecting) return;",
            "lineNumber": 1771
          },
          {
            "text": "    ",
            "lineNumber": 1772
          },
          {
            "text": "    const isCtrl = e.ctrlKey || e.metaKey; // Ctrl for Windows/Linux, Command for macOS",
            "lineNumber": 1773
          },
          {
            "text": "    const isShift = e.shiftKey;",
            "lineNumber": 1774
          },
          {
            "text": "    ",
            "lineNumber": 1775
          },
          {
            "text": "    let newSelectedFileIds: string[];",
            "lineNumber": 1776
          },
          {
            "text": "    let newLastSelectedId: string = id;",
            "lineNumber": 1777
          },
          {
            "text": "    ",
            "lineNumber": 1778
          },
          {
            "text": "    if (isCtrl) {",
            "lineNumber": 1779
          },
          {
            "text": "      // Ctrl+Click: Toggle selection of this file",
            "lineNumber": 1780
          },
          {
            "text": "      if (activeTab.selectedFileIds.includes(id)) {",
            "lineNumber": 1781
          },
          {
            "text": "        // Remove from selection",
            "lineNumber": 1782
          },
          {
            "text": "        newSelectedFileIds = activeTab.selectedFileIds.filter(fileId =&gt; fileId !== id);",
            "lineNumber": 1783
          },
          {
            "text": "      } else {",
            "lineNumber": 1784
          },
          {
            "text": "        // Add to selection",
            "lineNumber": 1785
          },
          {
            "text": "        newSelectedFileIds = [...activeTab.selectedFileIds, id];",
            "lineNumber": 1786
          },
          {
            "text": "      }",
            "lineNumber": 1787
          },
          {
            "text": "    } else if (isShift &amp;&amp; activeTab.lastSelectedId &amp;&amp; activeTab.selectedFileIds.length &gt; 0) {",
            "lineNumber": 1788
          },
          {
            "text": "      // Shift+Click: Select range from last selected to current",
            "lineNumber": 1789
          },
          {
            "text": "      const currentFolderId = activeTab.folderId;",
            "lineNumber": 1790
          },
          {
            "text": "      let allFiles: string[] = [];",
            "lineNumber": 1791
          },
          {
            "text": "      ",
            "lineNumber": 1792
          },
          {
            "text": "      if (activeTab.searchQuery) {",
            "lineNumber": 1793
          },
          {
            "text": "        // Search results view",
            "lineNumber": 1794
          },
          {
            "text": "        allFiles = displayFileIds;",
            "lineNumber": 1795
          },
          {
            "text": "      } else {",
            "lineNumber": 1796
          },
          {
            "text": "        // Folder view - use displayFileIds which already contains the sorted and filtered list of files to display",
            "lineNumber": 1797
          },
          {
            "text": "        allFiles = displayFileIds;",
            "lineNumber": 1798
          },
          {
            "text": "      }",
            "lineNumber": 1799
          },
          {
            "text": "      ",
            "lineNumber": 1800
          },
          {
            "text": "      const lastIndex = allFiles.indexOf(activeTab.lastSelectedId);",
            "lineNumber": 1801
          },
          {
            "text": "      const currentIndex = allFiles.indexOf(id);",
            "lineNumber": 1802
          },
          {
            "text": "      ",
            "lineNumber": 1803
          },
          {
            "text": "      if (lastIndex !== -1 &amp;&amp; currentIndex !== -1) {",
            "lineNumber": 1804
          },
          {
            "text": "        const start = Math.min(lastIndex, currentIndex);",
            "lineNumber": 1805
          },
          {
            "text": "        const end = Math.max(lastIndex, currentIndex);",
            "lineNumber": 1806
          },
          {
            "text": "        newSelectedFileIds = allFiles.slice(start, end + 1);",
            "lineNumber": 1807
          },
          {
            "text": "      } else {",
            "lineNumber": 1808
          },
          {
            "text": "        newSelectedFileIds = [id];",
            "lineNumber": 1809
          },
          {
            "text": "      }",
            "lineNumber": 1810
          },
          {
            "text": "    } else {",
            "lineNumber": 1811
          },
          {
            "text": "      // Normal click: Select only this file",
            "lineNumber": 1812
          },
          {
            "text": "      newSelectedFileIds = [id];",
            "lineNumber": 1813
          },
          {
            "text": "    }",
            "lineNumber": 1814
          },
          {
            "text": "    ",
            "lineNumber": 1815
          },
          {
            "text": "    updateActiveTab({ ",
            "lineNumber": 1816
          },
          {
            "text": "        selectedFileIds: newSelectedFileIds, ",
            "lineNumber": 1817
          },
          {
            "text": "        lastSelectedId: newLastSelectedId ",
            "lineNumber": 1818
          },
          {
            "text": "    });",
            "lineNumber": 1819
          },
          {
            "text": "  };",
            "lineNumber": 1820
          },
          {
            "lineNumber": 1821
          },
          {
            "text": "  const handleMouseDown = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 1822
          },
          {
            "text": "    // 关闭右键菜单",
            "lineNumber": 1823
          },
          {
            "text": "    closeContextMenu();",
            "lineNumber": 1824
          },
          {
            "text": ";",
            "lineNumber": 1855
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.37357988953590393
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleCreateFolder = async \nprev =&gt; (\n\n              files: { ...prev.files, [newId]: newFolder },\n              roots: [...prev.roots, newId],\n              renamingId: newId\n          }));\n          return;\n      }\n      \n      const parent = state.files[parentId];\n      if (!parent) return;\n      const baseName = t('context.newFolder');\n      let name = baseName;\n      if (parent.path) {\n          try {\n              let counter = 1;\n              const children = parent.children?.map(id =&gt; state.files[id]) || [];\n              while (children.some(c =&gt; c.name === name)) { name = &#96;${baseName} (${counter++})&#96;; }\n              const separator = parent.path.includes('/') ? '/' : '\\\\';\n              const newPath = &#96;${parent.path}${separator}${name}&#96;;\n              \n              // Use appropriate createFolder function based on environment\n              const isTauriEnv = isTauriEnvironment();\n              if (isTauriEnv) {\n                  await createFolder(newPath);\n              } else if (window.electron) {\n                  await window.electron.createFolder(newPath);\n              } else {\n                  throw new Error(\"No file system access available\");\n              }\n              \n              await handleRefresh();\n              \n              // Find the newly created folder and set it to renaming state\n              setState(prev =&gt; {\n                  const parentFolder = prev.files[parentId];\n                  if (parentFolder?.children) {\n                      // Get all children files\n                      const childFiles = parentFolder.children.map(id =&gt; prev.files[id]);\n                      // Find the folder with the matching name we just created\n                      const newFolder = childFiles.find(file =&gt; file?.name === name &amp;&amp; file?.type === FileType.FOLDER);\n                      if (newFolder) {\n                          return { ...prev, renamingId: newFolder.id };\n                      }\n                  }\n                  return prev;\n              });\n          } catch (error) { console.error(error); showToast(\"Error creating folder\"); }\n      } else {\n          let counter = 1;\n          const children = parent.children?.map(id =&gt; state.files[id]) || [];\n          while (children.some(c =&gt; c.name === name)) { name = &#96;${baseName} (${counter++})&#96;; }\n          const newId = Math.random().toString(36).substr(2, 9);\n          const newFolder: FileNode = {\n              id: newId,\n              parentId: parentId,\n              name,\n              type: FileType.FOLDER,\n              path: '',\n              children: [],\n              tags: [],\n          };\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "const handleCreateFolder = async ",
            "lineNumber": 3286
          },
          {
            "text": "prev =&gt; (",
            "lineNumber": 3315
          },
          {
            "lineNumber": 3316
          },
          {
            "text": "              files: { ...prev.files, [newId]: newFolder },",
            "lineNumber": 3317
          },
          {
            "text": "              roots: [...prev.roots, newId],",
            "lineNumber": 3318
          },
          {
            "text": "              renamingId: newId",
            "lineNumber": 3319
          },
          {
            "text": "          }));",
            "lineNumber": 3320
          },
          {
            "text": "          return;",
            "lineNumber": 3321
          },
          {
            "text": "      }",
            "lineNumber": 3322
          },
          {
            "text": "      ",
            "lineNumber": 3323
          },
          {
            "text": "      const parent = state.files[parentId];",
            "lineNumber": 3324
          },
          {
            "text": "      if (!parent) return;",
            "lineNumber": 3325
          },
          {
            "text": "      const baseName = t('context.newFolder');",
            "lineNumber": 3326
          },
          {
            "text": "      let name = baseName;",
            "lineNumber": 3327
          },
          {
            "text": "      if (parent.path) {",
            "lineNumber": 3328
          },
          {
            "text": "          try {",
            "lineNumber": 3329
          },
          {
            "text": "              let counter = 1;",
            "lineNumber": 3330
          },
          {
            "text": "              const children = parent.children?.map(id =&gt; state.files[id]) || [];",
            "lineNumber": 3331
          },
          {
            "text": "              while (children.some(c =&gt; c.name === name)) { name = &#96;${baseName} (${counter++})&#96;; }",
            "lineNumber": 3332
          },
          {
            "text": "              const separator = parent.path.includes('/') ? '/' : '\\\\';",
            "lineNumber": 3333
          },
          {
            "text": "              const newPath = &#96;${parent.path}${separator}${name}&#96;;",
            "lineNumber": 3334
          },
          {
            "text": "              ",
            "lineNumber": 3335
          },
          {
            "text": "              // Use appropriate createFolder function based on environment",
            "lineNumber": 3336
          },
          {
            "text": "              const isTauriEnv = isTauriEnvironment();",
            "lineNumber": 3337
          },
          {
            "text": "              if (isTauriEnv) {",
            "lineNumber": 3338
          },
          {
            "text": "                  await createFolder(newPath);",
            "lineNumber": 3339
          },
          {
            "text": "              } else if (window.electron) {",
            "lineNumber": 3340
          },
          {
            "text": "                  await window.electron.createFolder(newPath);",
            "lineNumber": 3341
          },
          {
            "text": "              } else {",
            "lineNumber": 3342
          },
          {
            "text": "                  throw new Error(\"No file system access available\");",
            "lineNumber": 3343
          },
          {
            "text": "              }",
            "lineNumber": 3344
          },
          {
            "text": "              ",
            "lineNumber": 3345
          },
          {
            "text": "              await handleRefresh();",
            "lineNumber": 3346
          },
          {
            "text": "              ",
            "lineNumber": 3347
          },
          {
            "text": "              // Find the newly created folder and set it to renaming state",
            "lineNumber": 3348
          },
          {
            "text": "              setState(prev =&gt; {",
            "lineNumber": 3349
          },
          {
            "text": "                  const parentFolder = prev.files[parentId];",
            "lineNumber": 3350
          },
          {
            "text": "                  if (parentFolder?.children) {",
            "lineNumber": 3351
          },
          {
            "text": "                      // Get all children files",
            "lineNumber": 3352
          },
          {
            "text": "                      const childFiles = parentFolder.children.map(id =&gt; prev.files[id]);",
            "lineNumber": 3353
          },
          {
            "text": "                      // Find the folder with the matching name we just created",
            "lineNumber": 3354
          },
          {
            "text": "                      const newFolder = childFiles.find(file =&gt; file?.name === name &amp;&amp; file?.type === FileType.FOLDER);",
            "lineNumber": 3355
          },
          {
            "text": "                      if (newFolder) {",
            "lineNumber": 3356
          },
          {
            "text": "                          return { ...prev, renamingId: newFolder.id };",
            "lineNumber": 3357
          },
          {
            "text": "                      }",
            "lineNumber": 3358
          },
          {
            "text": "                  }",
            "lineNumber": 3359
          },
          {
            "text": "                  return prev;",
            "lineNumber": 3360
          },
          {
            "text": "              });",
            "lineNumber": 3361
          },
          {
            "text": "          } catch (error) { console.error(error); showToast(\"Error creating folder\"); }",
            "lineNumber": 3362
          },
          {
            "text": "      } else {",
            "lineNumber": 3363
          },
          {
            "text": "          let counter = 1;",
            "lineNumber": 3364
          },
          {
            "text": "          const children = parent.children?.map(id =&gt; state.files[id]) || [];",
            "lineNumber": 3365
          },
          {
            "text": "          while (children.some(c =&gt; c.name === name)) { name = &#96;${baseName} (${counter++})&#96;; }",
            "lineNumber": 3366
          },
          {
            "text": "          const newId = Math.random().toString(36).substr(2, 9);",
            "lineNumber": 3367
          },
          {
            "text": "          const newFolder: FileNode = {",
            "lineNumber": 3368
          },
          {
            "text": "              id: newId,",
            "lineNumber": 3369
          },
          {
            "text": "              parentId: parentId,",
            "lineNumber": 3370
          },
          {
            "text": "              name,",
            "lineNumber": 3371
          },
          {
            "text": "              type: FileType.FOLDER,",
            "lineNumber": 3372
          },
          {
            "text": "              path: '',",
            "lineNumber": 3373
          },
          {
            "text": "              children: [],",
            "lineNumber": 3374
          },
          {
            "text": "              tags: [],",
            "lineNumber": 3375
          },
          {
            "text": "          };",
            "lineNumber": 3378
          },
          {
            "text": ";",
            "lineNumber": 3387
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.3651426434516907
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\n((f: any) =&gt; {\n                              if (f.tags) {\n                                f.tags.forEach((t: string) =&gt; allTags.add(t));\n                              }\n                            });\n                            state.customTags.forEach(t =&gt; allTags.add(t));\n                            \n                            const allTagsList = Array.from(allTags);\n                            const filteredTags = allTagsList.filter(tag =&gt; \n                              tag.toLowerCase().includes(tagSearchQuery.toLowerCase())\n                            );\n                            \n                            // 只有当有多个匹配标签或者当前搜索词与匹配标签不完全相同时才显示下拉列表\n                            const shouldShow = tagSearchQuery &amp;&amp; \n                                              filteredTags.length &gt; 0 &amp;&amp; \n                                              !(filteredTags.length === 1 &amp;&amp; filteredTags[0] === tagSearchQuery);\n                            \n                            if (!shouldShow) return null;\n                            \n                            return (\n                              &lt;div className=\"absolute top-full left-0 right-0 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 mt-1 rounded-lg shadow-xl z-50 max-h-40 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600\"&gt;\n                                {filteredTags.map(tag =&gt; (\n                                  &lt;div \n                                    key={tag} \n                                    className=\"px-4 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 text-sm cursor-pointer text-gray-800 dark:text-gray-200\"\n                                    onClick={() =&gt; setTagSearchQuery(tag)}\n                                  &gt;\n                                    {tag}\n                                )\n                          }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 4656,
                "column": 540
              },
              "endPosition": {
                "line": 4657,
                "column": 21
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4674
          },
          {
            "text": "((f: any) =&gt; {",
            "lineNumber": 4676
          },
          {
            "text": "                              if (f.tags) {",
            "lineNumber": 4677
          },
          {
            "text": "                                f.tags.forEach((t: string) =&gt; allTags.add(t));",
            "lineNumber": 4678
          },
          {
            "text": "                              }",
            "lineNumber": 4679
          },
          {
            "text": "                            });",
            "lineNumber": 4680
          },
          {
            "text": "                            state.customTags.forEach(t =&gt; allTags.add(t));",
            "lineNumber": 4681
          },
          {
            "text": "                            ",
            "lineNumber": 4682
          },
          {
            "text": "                            const allTagsList = Array.from(allTags);",
            "lineNumber": 4683
          },
          {
            "text": "                            const filteredTags = allTagsList.filter(tag =&gt; ",
            "lineNumber": 4684
          },
          {
            "text": "                              tag.toLowerCase().includes(tagSearchQuery.toLowerCase())",
            "lineNumber": 4685
          },
          {
            "text": "                            );",
            "lineNumber": 4686
          },
          {
            "text": "                            ",
            "lineNumber": 4687
          },
          {
            "text": "                            // 只有当有多个匹配标签或者当前搜索词与匹配标签不完全相同时才显示下拉列表",
            "lineNumber": 4688
          },
          {
            "text": "                            const shouldShow = tagSearchQuery &amp;&amp; ",
            "lineNumber": 4689
          },
          {
            "text": "                                              filteredTags.length &gt; 0 &amp;&amp; ",
            "lineNumber": 4690
          },
          {
            "text": "                                              !(filteredTags.length === 1 &amp;&amp; filteredTags[0] === tagSearchQuery);",
            "lineNumber": 4691
          },
          {
            "text": "                            ",
            "lineNumber": 4692
          },
          {
            "text": "                            if (!shouldShow) return null;",
            "lineNumber": 4693
          },
          {
            "text": "                            ",
            "lineNumber": 4694
          },
          {
            "text": "                            return (",
            "lineNumber": 4695
          },
          {
            "text": "                              &lt;div className=\"absolute top-full left-0 right-0 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 mt-1 rounded-lg shadow-xl z-50 max-h-40 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600\"&gt;",
            "lineNumber": 4696
          },
          {
            "text": "                                {filteredTags.map(tag =&gt; (",
            "lineNumber": 4697
          },
          {
            "text": "                                  &lt;div ",
            "lineNumber": 4698
          },
          {
            "text": "                                    key={tag} ",
            "lineNumber": 4699
          },
          {
            "text": "                                    className=\"px-4 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 text-sm cursor-pointer text-gray-800 dark:text-gray-200\"",
            "lineNumber": 4700
          },
          {
            "text": "                                    onClick={() =&gt; setTagSearchQuery(tag)}",
            "lineNumber": 4701
          },
          {
            "text": "                                  &gt;",
            "lineNumber": 4702
          },
          {
            "text": "                                    {tag}",
            "lineNumber": 4703
          },
          {
            "text": "                                )",
            "lineNumber": 4705
          },
          {
            "text": "                          }",
            "lineNumber": 4708
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.35653141140937805
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1477
          },
          "endPosition": {
            "line": 1958,
            "column": 1
          }
        },
        "contents": "export const FileGrid: React.FC&lt;FileGridProps&gt; = \n\n  onBackgroundContextMenu,\n  people,\n  groupedTags,\n  onPersonClick,\n  onPersonContextMenu,\n  onPersonDoubleClick,\n  onStartRenamePerson,\n  onTagClick,\n  onTagContextMenu,\n  onTagDoubleClick,\n  groupedFiles = [],\n  groupBy = 'none',\n  collapsedGroups = {},\n  onToggleGroup,\n  isSelecting,\n  selectionBox,\n  t,\n  onThumbnailSizeChange,\n  onUpdateFile,\n  settings,\n  onScrollTopChange\n}) =&gt; {\n  // #region agent log\n  // Removed debug logs\n  // #endregion\n\n  const [dragTargetId, setDragTargetId] = useState&lt;string | null&gt;(null);\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const FileGrid: React.FC&lt;FileGridProps&gt; = ",
            "lineNumber": 1478
          },
          {
            "lineNumber": 1501
          },
          {
            "text": "  onBackgroundContextMenu,",
            "lineNumber": 1502
          },
          {
            "text": "  people,",
            "lineNumber": 1503
          },
          {
            "text": "  groupedTags,",
            "lineNumber": 1504
          },
          {
            "text": "  onPersonClick,",
            "lineNumber": 1505
          },
          {
            "text": "  onPersonContextMenu,",
            "lineNumber": 1506
          },
          {
            "text": "  onPersonDoubleClick,",
            "lineNumber": 1507
          },
          {
            "text": "  onStartRenamePerson,",
            "lineNumber": 1508
          },
          {
            "text": "  onTagClick,",
            "lineNumber": 1509
          },
          {
            "text": "  onTagContextMenu,",
            "lineNumber": 1510
          },
          {
            "text": "  onTagDoubleClick,",
            "lineNumber": 1511
          },
          {
            "text": "  groupedFiles = [],",
            "lineNumber": 1512
          },
          {
            "text": "  groupBy = 'none',",
            "lineNumber": 1513
          },
          {
            "text": "  collapsedGroups = {},",
            "lineNumber": 1514
          },
          {
            "text": "  onToggleGroup,",
            "lineNumber": 1515
          },
          {
            "text": "  isSelecting,",
            "lineNumber": 1516
          },
          {
            "text": "  selectionBox,",
            "lineNumber": 1517
          },
          {
            "text": "  t,",
            "lineNumber": 1518
          },
          {
            "text": "  onThumbnailSizeChange,",
            "lineNumber": 1519
          },
          {
            "text": "  onUpdateFile,",
            "lineNumber": 1520
          },
          {
            "text": "  settings,",
            "lineNumber": 1521
          },
          {
            "text": "  onScrollTopChange",
            "lineNumber": 1522
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 1523
          },
          {
            "text": "  // #region agent log",
            "lineNumber": 1524
          },
          {
            "text": "  // Removed debug logs",
            "lineNumber": 1525
          },
          {
            "text": "  // #endregion",
            "lineNumber": 1526
          },
          {
            "lineNumber": 1527
          },
          {
            "text": "  const [dragTargetId, setDragTargetId] = useState&lt;string | null&gt;(null);",
            "lineNumber": 1528
          },
          {
            "text": ";",
            "lineNumber": 1959
          }
        ]
      },
      "score": 0.35360050201416016
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n{() =&gt; setState(s =&gt; ({ ...s, renamingId: null }))} \n                        onStartRename={startRename} \n                        onDragStart={handleDragStart} \n                        onDragEnd={handleDragEnd} \n                        onDropOnFolder={handleDropOnFolder} \n                        settings={state.settings}\n                        onDropExternal={(targetId, paths) =&gt; {\n                            // 1. 核心检查：如果是内部发起的拖拽 (isInternalDragRef.current = true)\n                            // 即使走到了 onDropExternal 通道，我们也把它强行扭转为“移动”操作\n                            if (isInternalDragRef.current) {\n                                handleMoveFiles(activeTab.selectedFileIds, targetId);\n                            } else {\n                                // 2. 确实是外部文件，执行复制\n                                if (window.electron) {\n                                     startTask('copy', [], t('tasks.copying'));\n                                     window.electron.copyExternalFiles(targetId, paths).then(() =&gt; {\n                                         showToast(t('context.copied'));\n                                         handleRefresh();\n                                     });\n                                }\n                            }\n                            \n                            \n                        }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": "{() =&gt; setState(s =&gt; ({ ...s, renamingId: null }))} ",
            "lineNumber": 4757
          },
          {
            "text": "                        onStartRename={startRename} ",
            "lineNumber": 4758
          },
          {
            "text": "                        onDragStart={handleDragStart} ",
            "lineNumber": 4759
          },
          {
            "text": "                        onDragEnd={handleDragEnd} ",
            "lineNumber": 4760
          },
          {
            "text": "                        onDropOnFolder={handleDropOnFolder} ",
            "lineNumber": 4761
          },
          {
            "text": "                        settings={state.settings}",
            "lineNumber": 4762
          },
          {
            "text": "                        onDropExternal={(targetId, paths) =&gt; {",
            "lineNumber": 4763
          },
          {
            "text": "                            // 1. 核心检查：如果是内部发起的拖拽 (isInternalDragRef.current = true)",
            "lineNumber": 4764
          },
          {
            "text": "                            // 即使走到了 onDropExternal 通道，我们也把它强行扭转为“移动”操作",
            "lineNumber": 4765
          },
          {
            "text": "                            if (isInternalDragRef.current) {",
            "lineNumber": 4766
          },
          {
            "text": "                                handleMoveFiles(activeTab.selectedFileIds, targetId);",
            "lineNumber": 4767
          },
          {
            "text": "                            } else {",
            "lineNumber": 4768
          },
          {
            "text": "                                // 2. 确实是外部文件，执行复制",
            "lineNumber": 4769
          },
          {
            "text": "                                if (window.electron) {",
            "lineNumber": 4770
          },
          {
            "text": "                                     startTask('copy', [], t('tasks.copying'));",
            "lineNumber": 4771
          },
          {
            "text": "                                     window.electron.copyExternalFiles(targetId, paths).then(() =&gt; {",
            "lineNumber": 4772
          },
          {
            "text": "                                         showToast(t('context.copied'));",
            "lineNumber": 4773
          },
          {
            "text": "                                         handleRefresh();",
            "lineNumber": 4774
          },
          {
            "text": "                                     });",
            "lineNumber": 4775
          },
          {
            "text": "                                }",
            "lineNumber": 4776
          },
          {
            "text": "                            }",
            "lineNumber": 4777
          },
          {
            "text": "                            ",
            "lineNumber": 4778
          },
          {
            "text": "                            ",
            "lineNumber": 4779
          },
          {
            "text": "                        }",
            "lineNumber": 4781
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.353283166885376
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\SequenceViewer.tsx",
        "range": {
          "startPosition": {
            "line": 22
          },
          "endPosition": {
            "line": 617,
            "column": 1
          }
        },
        "contents": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = \n\n              &gt;\n                &lt;Sidebar size={20} /&gt;\n              &lt;/button&gt;\n              &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;\n              &lt;Film className=\"text-purple-500\" size={20} /&gt;\n              &lt;span className=\"font-bold text-lg truncate\"&gt;{folder.name}&lt;/span&gt;\n              &lt;span className=\"text-sm text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full whitespace-nowrap border border-gray-200 dark:border-gray-700\"&gt;\n                 {currentFile?.name}\n              &lt;/span&gt;\n           &lt;/div&gt;\n           \n           &lt;div className=\"flex items-center space-x-2\"&gt;\n              {/* Zoom Controls */}\n              &lt;div className=\"flex items-center space-x-2 mr-4 w-32 hidden lg:flex\"&gt;\n                &lt;Minimize size={14} className=\"text-gray-500\" /&gt;\n                &lt;input \n                  type=\"range\" \n                  min=\"0.1\" \n                  max=\"8\" \n                  step=\"0.1\" \n                  value={scale}\n                  onChange={(e) =&gt; setScale(parseFloat(e.target.value))}\n                  className=\"flex-1 h-1 bg-gray-300 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer\"\n                /&gt;\n                &lt;Maximize size={14} className=\"text-gray-500\" /&gt;\n              &lt;/div&gt;\n\n              &lt;button onClick={handleOriginal} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('sequence.original')}&gt;\n                 &lt;span className=\"text-xs font-bold\"&gt;1:1&lt;/span&gt;\n              &lt;/button&gt;\n              &lt;button onClick={handleReset}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 22,
                "column": 1
              },
              "endPosition": {
                "line": 22,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 8
              },
              "endPosition": {
                "line": 22,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 14
              },
              "endPosition": {
                "line": 22,
                "column": 62
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = ",
            "lineNumber": 23
          },
          {
            "lineNumber": 289
          },
          {
            "text": "              &gt;",
            "lineNumber": 290
          },
          {
            "text": "                &lt;Sidebar size={20} /&gt;",
            "lineNumber": 291
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 292
          },
          {
            "text": "              &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;",
            "lineNumber": 293
          },
          {
            "text": "              &lt;Film className=\"text-purple-500\" size={20} /&gt;",
            "lineNumber": 294
          },
          {
            "text": "              &lt;span className=\"font-bold text-lg truncate\"&gt;{folder.name}&lt;/span&gt;",
            "lineNumber": 295
          },
          {
            "text": "              &lt;span className=\"text-sm text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full whitespace-nowrap border border-gray-200 dark:border-gray-700\"&gt;",
            "lineNumber": 296
          },
          {
            "text": "                 {currentFile?.name}",
            "lineNumber": 297
          },
          {
            "text": "              &lt;/span&gt;",
            "lineNumber": 298
          },
          {
            "text": "           &lt;/div&gt;",
            "lineNumber": 299
          },
          {
            "text": "           ",
            "lineNumber": 300
          },
          {
            "text": "           &lt;div className=\"flex items-center space-x-2\"&gt;",
            "lineNumber": 301
          },
          {
            "text": "              {/* Zoom Controls */}",
            "lineNumber": 302
          },
          {
            "text": "              &lt;div className=\"flex items-center space-x-2 mr-4 w-32 hidden lg:flex\"&gt;",
            "lineNumber": 303
          },
          {
            "text": "                &lt;Minimize size={14} className=\"text-gray-500\" /&gt;",
            "lineNumber": 304
          },
          {
            "text": "                &lt;input ",
            "lineNumber": 305
          },
          {
            "text": "                  type=\"range\" ",
            "lineNumber": 306
          },
          {
            "text": "                  min=\"0.1\" ",
            "lineNumber": 307
          },
          {
            "text": "                  max=\"8\" ",
            "lineNumber": 308
          },
          {
            "text": "                  step=\"0.1\" ",
            "lineNumber": 309
          },
          {
            "text": "                  value={scale}",
            "lineNumber": 310
          },
          {
            "text": "                  onChange={(e) =&gt; setScale(parseFloat(e.target.value))}",
            "lineNumber": 311
          },
          {
            "text": "                  className=\"flex-1 h-1 bg-gray-300 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer\"",
            "lineNumber": 312
          },
          {
            "text": "                /&gt;",
            "lineNumber": 313
          },
          {
            "text": "                &lt;Maximize size={14} className=\"text-gray-500\" /&gt;",
            "lineNumber": 314
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 315
          },
          {
            "lineNumber": 316
          },
          {
            "text": "              &lt;button onClick={handleOriginal} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('sequence.original')}&gt;",
            "lineNumber": 317
          },
          {
            "text": "                 &lt;span className=\"text-xs font-bold\"&gt;1:1&lt;/span&gt;",
            "lineNumber": 318
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 319
          },
          {
            "text": "              &lt;button onClick={handleReset}",
            "lineNumber": 320
          },
          {
            "text": ";",
            "lineNumber": 618
          }
        ]
      },
      "score": 0.3507041037082672
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1272
          },
          "endPosition": {
            "line": 1428,
            "column": 1
          }
        },
        "contents": "const useLayout = \n =&gt; {\n  const aspectRatios = useMemo(() =&gt; {\n    const ratios: Record&lt;string, number&gt; = {};\n    if (viewMode === 'browser') {\n      items.forEach(id =&gt; {\n        const file = files[id];\n        ratios[id] = file?.meta?.width &amp;&amp; file?.meta?.height \n          ? file.meta.width / file.meta.height \n          : (file?.type === FileType.FOLDER ? 1 : 1);\n      });\n    }\n    return ratios;\n  }, [items, files, viewMode]);\n\n  return useMemo(() =&gt; {\n    const layout: LayoutItem[] = [];\n    let totalHeight = 0;\n    const GAP = 16;\n    const PADDING = 24;\n    \n    // Ensure we have a reasonable width. If containerWidth is 0 (initial render), fall back to window width.\n    const safeContainerWidth = containerWidth &gt; 0 ? containerWidth : (typeof window !== 'undefined' ? window.innerWidth - 300 : 1200); \n    const availableWidth = Math.max(100, safeContainerWidth - (PADDING * 2));\n\n    if (viewMode === 'browser') {\n        if (layoutMode === 'list') {\n            const itemHeight = 44;\n            items.forEach((id, index) =&gt; {\n                layout.push({ id, x: PADDING, y: PADDING + index * itemHeight, width: availableWidth, height: itemHeight });\n            });\n            totalHeight = PADDING + items.length * itemHeight;\n        } else if (layoutMode === 'grid') {\n            const minColWidth = thumbnailSize;\n            const cols = Math.max(1, Math.floor((availableWidth + GAP) / (minColWidth + GAP)));\n            const itemWidth = (availableWidth - (cols - 1) * GAP) / cols;\n            const itemHeight = itemWidth + 40;\n\n            items.forEach((id, index) =&gt; {\n                const row = Math.floor(index / cols);\n                const col = index % cols;\n                layout.push({\n                    id,\n                    x: PADDING + col * (itemWidth + GAP),\n                    y: PADDING + row * (itemHeight + GAP),\n                    width: itemWidth,\n                    height: itemHeight\n                });\n            });\n            const rows = Math.ceil(items.length / cols);\n            totalHeight = PADDING + rows * (itemHeight + GAP);\n        } else if (layoutMode === 'adaptive') {\n            let currentRow: any[] = [];\n            let currentWidth = 0;\n            let y = PADDING;\n            const targetHeight = thumbnailSize;\n\n            items.forEach((id, index) =&gt; {\n                const aspect = aspectRatios[id];\n                const w = targetHeight * aspect;\n                \n                if (currentWidth + w + GAP &gt; availableWidth) {\n                    const scale = (availableWidth - (currentRow.length - 1) * GAP) / currentWidth;\n                    const rowHeight = targetHeight * scale;\n            }\n  }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const useLayout = ",
            "lineNumber": 1273
          },
          {
            "text": " =&gt; {",
            "lineNumber": 1282
          },
          {
            "text": "  const aspectRatios = useMemo(() =&gt; {",
            "lineNumber": 1283
          },
          {
            "text": "    const ratios: Record&lt;string, number&gt; = {};",
            "lineNumber": 1284
          },
          {
            "text": "    if (viewMode === 'browser') {",
            "lineNumber": 1285
          },
          {
            "text": "      items.forEach(id =&gt; {",
            "lineNumber": 1286
          },
          {
            "text": "        const file = files[id];",
            "lineNumber": 1287
          },
          {
            "text": "        ratios[id] = file?.meta?.width &amp;&amp; file?.meta?.height ",
            "lineNumber": 1288
          },
          {
            "text": "          ? file.meta.width / file.meta.height ",
            "lineNumber": 1289
          },
          {
            "text": "          : (file?.type === FileType.FOLDER ? 1 : 1);",
            "lineNumber": 1290
          },
          {
            "text": "      });",
            "lineNumber": 1291
          },
          {
            "text": "    }",
            "lineNumber": 1292
          },
          {
            "text": "    return ratios;",
            "lineNumber": 1293
          },
          {
            "text": "  }, [items, files, viewMode]);",
            "lineNumber": 1294
          },
          {
            "lineNumber": 1295
          },
          {
            "text": "  return useMemo(() =&gt; {",
            "lineNumber": 1296
          },
          {
            "text": "    const layout: LayoutItem[] = [];",
            "lineNumber": 1297
          },
          {
            "text": "    let totalHeight = 0;",
            "lineNumber": 1298
          },
          {
            "text": "    const GAP = 16;",
            "lineNumber": 1299
          },
          {
            "text": "    const PADDING = 24;",
            "lineNumber": 1300
          },
          {
            "text": "    ",
            "lineNumber": 1301
          },
          {
            "text": "    // Ensure we have a reasonable width. If containerWidth is 0 (initial render), fall back to window width.",
            "lineNumber": 1302
          },
          {
            "text": "    const safeContainerWidth = containerWidth &gt; 0 ? containerWidth : (typeof window !== 'undefined' ? window.innerWidth - 300 : 1200); ",
            "lineNumber": 1303
          },
          {
            "text": "    const availableWidth = Math.max(100, safeContainerWidth - (PADDING * 2));",
            "lineNumber": 1304
          },
          {
            "lineNumber": 1305
          },
          {
            "text": "    if (viewMode === 'browser') {",
            "lineNumber": 1306
          },
          {
            "text": "        if (layoutMode === 'list') {",
            "lineNumber": 1307
          },
          {
            "text": "            const itemHeight = 44;",
            "lineNumber": 1308
          },
          {
            "text": "            items.forEach((id, index) =&gt; {",
            "lineNumber": 1309
          },
          {
            "text": "                layout.push({ id, x: PADDING, y: PADDING + index * itemHeight, width: availableWidth, height: itemHeight });",
            "lineNumber": 1310
          },
          {
            "text": "            });",
            "lineNumber": 1311
          },
          {
            "text": "            totalHeight = PADDING + items.length * itemHeight;",
            "lineNumber": 1312
          },
          {
            "text": "        } else if (layoutMode === 'grid') {",
            "lineNumber": 1313
          },
          {
            "text": "            const minColWidth = thumbnailSize;",
            "lineNumber": 1314
          },
          {
            "text": "            const cols = Math.max(1, Math.floor((availableWidth + GAP) / (minColWidth + GAP)));",
            "lineNumber": 1315
          },
          {
            "text": "            const itemWidth = (availableWidth - (cols - 1) * GAP) / cols;",
            "lineNumber": 1316
          },
          {
            "text": "            const itemHeight = itemWidth + 40;",
            "lineNumber": 1317
          },
          {
            "lineNumber": 1318
          },
          {
            "text": "            items.forEach((id, index) =&gt; {",
            "lineNumber": 1319
          },
          {
            "text": "                const row = Math.floor(index / cols);",
            "lineNumber": 1320
          },
          {
            "text": "                const col = index % cols;",
            "lineNumber": 1321
          },
          {
            "text": "                layout.push({",
            "lineNumber": 1322
          },
          {
            "text": "                    id,",
            "lineNumber": 1323
          },
          {
            "text": "                    x: PADDING + col * (itemWidth + GAP),",
            "lineNumber": 1324
          },
          {
            "text": "                    y: PADDING + row * (itemHeight + GAP),",
            "lineNumber": 1325
          },
          {
            "text": "                    width: itemWidth,",
            "lineNumber": 1326
          },
          {
            "text": "                    height: itemHeight",
            "lineNumber": 1327
          },
          {
            "text": "                });",
            "lineNumber": 1328
          },
          {
            "text": "            });",
            "lineNumber": 1329
          },
          {
            "text": "            const rows = Math.ceil(items.length / cols);",
            "lineNumber": 1330
          },
          {
            "text": "            totalHeight = PADDING + rows * (itemHeight + GAP);",
            "lineNumber": 1331
          },
          {
            "text": "        } else if (layoutMode === 'adaptive') {",
            "lineNumber": 1332
          },
          {
            "text": "            let currentRow: any[] = [];",
            "lineNumber": 1333
          },
          {
            "text": "            let currentWidth = 0;",
            "lineNumber": 1334
          },
          {
            "text": "            let y = PADDING;",
            "lineNumber": 1335
          },
          {
            "text": "            const targetHeight = thumbnailSize;",
            "lineNumber": 1336
          },
          {
            "lineNumber": 1337
          },
          {
            "text": "            items.forEach((id, index) =&gt; {",
            "lineNumber": 1338
          },
          {
            "text": "                const aspect = aspectRatios[id];",
            "lineNumber": 1339
          },
          {
            "text": "                const w = targetHeight * aspect;",
            "lineNumber": 1340
          },
          {
            "text": "                ",
            "lineNumber": 1341
          },
          {
            "text": "                if (currentWidth + w + GAP &gt; availableWidth) {",
            "lineNumber": 1342
          },
          {
            "text": "                    const scale = (availableWidth - (currentRow.length - 1) * GAP) / currentWidth;",
            "lineNumber": 1343
          },
          {
            "text": "                    const rowHeight = targetHeight * scale;",
            "lineNumber": 1344
          },
          {
            "text": "            }",
            "lineNumber": 1360
          },
          {
            "text": "  }",
            "lineNumber": 1428
          },
          {
            "text": ";",
            "lineNumber": 1429
          }
        ]
      },
      "score": 0.3499518632888794
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 16,
            "column": 1
          },
          "endPosition": {
            "line": 126,
            "column": 1
          }
        },
        "contents": "const TreeNode: React.FC&lt;TreeProps&gt; = ({ files, nodeId, currentFolderId, expandedIds, onToggle, onNavigate, onContextMenu, onDrop, depth = 0 }) =&gt; {\n  const node = files[nodeId];\n  const [isDragOver, setIsDragOver] = useState(false);\n\n  if (!node || node.type !== FileType.FOLDER) return null;\n\n  const isRoot = depth === 0;\n  const isSelected = nodeId === currentFolderId;\n  const expanded = expandedIds.includes(nodeId);\n  \n  const folderChildren = node.children?.filter(childId =&gt; files[childId]?.type === FileType.FOLDER) || [];\n\n  const handleToggle = (e: React.MouseEvent) =&gt; {\n    e.stopPropagation();\n    onToggle(nodeId);\n  };\n\n  const handleClick = () =&gt; {\n    onNavigate(nodeId);\n  };\n\n  const handleContextMenu = (e: React.MouseEvent) =&gt; {\n    onContextMenu(e, isRoot ? 'root-folder' : 'file', nodeId);\n  };\n\n  const handleDragOver = (e: React.DragEvent) =&gt; {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(true);\n    e.dataTransfer.dropEffect = 'move';\n  };\n\n  const handleDragLeave = (e: React.DragEvent) =&gt; {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) =&gt; {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n    \n    const data = e.dataTransfer.getData('application/json');\n    if (data) {\n      try {\n        const sourceIds = JSON.parse(data);\n        if (Array.isArray(sourceIds) &amp;&amp; sourceIds.length &gt; 0) {\n          onDrop(nodeId, sourceIds);\n        }\n      } catch (err) {\n        console.error('Failed to parse drop data', err);\n      }\n    }\n  };\n\n  const Icon = isRoot \n    ? HardDrive \n    : (node.category === 'book' ? Book : node.category === 'sequence' ? Film : Folder);\n\n  const iconColorClass = isSelected ? 'text-white' : (\n      node.category === 'book' ? 'text-amber-500' :\n      node.category === 'sequence' ? 'text-purple-500' :\n      'text-blue-500 dark:text-blue-400'\n  );\n\n  return (\n    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const TreeNode: React.FC&lt;TreeProps&gt; = ({ files, nodeId, currentFolderId, expandedIds, onToggle, onNavigate, onContextMenu, onDrop, depth = 0 }) =&gt; {",
            "lineNumber": 19
          },
          {
            "text": "  const node = files[nodeId];",
            "lineNumber": 20
          },
          {
            "text": "  const [isDragOver, setIsDragOver] = useState(false);",
            "lineNumber": 21
          },
          {
            "lineNumber": 22
          },
          {
            "text": "  if (!node || node.type !== FileType.FOLDER) return null;",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "  const isRoot = depth === 0;",
            "lineNumber": 25
          },
          {
            "text": "  const isSelected = nodeId === currentFolderId;",
            "lineNumber": 26
          },
          {
            "text": "  const expanded = expandedIds.includes(nodeId);",
            "lineNumber": 27
          },
          {
            "text": "  ",
            "lineNumber": 28
          },
          {
            "text": "  const folderChildren = node.children?.filter(childId =&gt; files[childId]?.type === FileType.FOLDER) || [];",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "  const handleToggle = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 31
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 32
          },
          {
            "text": "    onToggle(nodeId);",
            "lineNumber": 33
          },
          {
            "text": "  };",
            "lineNumber": 34
          },
          {
            "lineNumber": 35
          },
          {
            "text": "  const handleClick = () =&gt; {",
            "lineNumber": 36
          },
          {
            "text": "    onNavigate(nodeId);",
            "lineNumber": 37
          },
          {
            "text": "  };",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "  const handleContextMenu = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 40
          },
          {
            "text": "    onContextMenu(e, isRoot ? 'root-folder' : 'file', nodeId);",
            "lineNumber": 41
          },
          {
            "text": "  };",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "  const handleDragOver = (e: React.DragEvent) =&gt; {",
            "lineNumber": 44
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 45
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 46
          },
          {
            "text": "    setIsDragOver(true);",
            "lineNumber": 47
          },
          {
            "text": "    e.dataTransfer.dropEffect = 'move';",
            "lineNumber": 48
          },
          {
            "text": "  };",
            "lineNumber": 49
          },
          {
            "lineNumber": 50
          },
          {
            "text": "  const handleDragLeave = (e: React.DragEvent) =&gt; {",
            "lineNumber": 51
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 52
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 53
          },
          {
            "text": "    setIsDragOver(false);",
            "lineNumber": 54
          },
          {
            "text": "  };",
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "  const handleDrop = (e: React.DragEvent) =&gt; {",
            "lineNumber": 57
          },
          {
            "text": "    e.preventDefault();",
            "lineNumber": 58
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 59
          },
          {
            "text": "    setIsDragOver(false);",
            "lineNumber": 60
          },
          {
            "text": "    ",
            "lineNumber": 61
          },
          {
            "text": "    const data = e.dataTransfer.getData('application/json');",
            "lineNumber": 62
          },
          {
            "text": "    if (data) {",
            "lineNumber": 63
          },
          {
            "text": "      try {",
            "lineNumber": 64
          },
          {
            "text": "        const sourceIds = JSON.parse(data);",
            "lineNumber": 65
          },
          {
            "text": "        if (Array.isArray(sourceIds) &amp;&amp; sourceIds.length &gt; 0) {",
            "lineNumber": 66
          },
          {
            "text": "          onDrop(nodeId, sourceIds);",
            "lineNumber": 67
          },
          {
            "text": "        }",
            "lineNumber": 68
          },
          {
            "text": "      } catch (err) {",
            "lineNumber": 69
          },
          {
            "text": "        console.error('Failed to parse drop data', err);",
            "lineNumber": 70
          },
          {
            "text": "      }",
            "lineNumber": 71
          },
          {
            "text": "    }",
            "lineNumber": 72
          },
          {
            "text": "  };",
            "lineNumber": 73
          },
          {
            "lineNumber": 74
          },
          {
            "text": "  const Icon = isRoot ",
            "lineNumber": 75
          },
          {
            "text": "    ? HardDrive ",
            "lineNumber": 76
          },
          {
            "text": "    : (node.category === 'book' ? Book : node.category === 'sequence' ? Film : Folder);",
            "lineNumber": 77
          },
          {
            "lineNumber": 78
          },
          {
            "text": "  const iconColorClass = isSelected ? 'text-white' : (",
            "lineNumber": 79
          },
          {
            "text": "      node.category === 'book' ? 'text-amber-500' :",
            "lineNumber": 80
          },
          {
            "text": "      node.category === 'sequence' ? 'text-purple-500' :",
            "lineNumber": 81
          },
          {
            "text": "      'text-blue-500 dark:text-blue-400'",
            "lineNumber": 82
          },
          {
            "text": "  );",
            "lineNumber": 83
          },
          {
            "lineNumber": 84
          },
          {
            "text": "  return (",
            "lineNumber": 85
          },
          {
            "text": "    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300",
            "lineNumber": 86
          },
          {
            "text": ";",
            "lineNumber": 127
          }
        ]
      },
      "score": 0.348294734954834
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 509
          },
          "endPosition": {
            "line": 5055,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n undefined)} \n                        hoverPlayingId={hoverPlayingId} \n                        onSetHoverPlayingId={setHoverPlayingId} \n                        onFileClick={handleFileClick} \n                        onFileDoubleClick={(id) =&gt; state.files[id]?.type === FileType.FOLDER ? handleNavigateFolder(id) : enterViewer(id)} \n                        onContextMenu={(e, id) =&gt; handleContextMenu(e, 'file', id)} \n                        onRenameSubmit={handleRenameSubmit} \n                        onRenameCancel={() =&gt; setState(s =&gt; ({ ...s, renamingId: null }))} \n                        onStartRename={startRename} \n                        onDragStart={handleDragStart}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 510
          },
          {
            "text": " undefined)} ",
            "lineNumber": 4750
          },
          {
            "text": "                        hoverPlayingId={hoverPlayingId} ",
            "lineNumber": 4751
          },
          {
            "text": "                        onSetHoverPlayingId={setHoverPlayingId} ",
            "lineNumber": 4752
          },
          {
            "text": "                        onFileClick={handleFileClick} ",
            "lineNumber": 4753
          },
          {
            "text": "                        onFileDoubleClick={(id) =&gt; state.files[id]?.type === FileType.FOLDER ? handleNavigateFolder(id) : enterViewer(id)} ",
            "lineNumber": 4754
          },
          {
            "text": "                        onContextMenu={(e, id) =&gt; handleContextMenu(e, 'file', id)} ",
            "lineNumber": 4755
          },
          {
            "text": "                        onRenameSubmit={handleRenameSubmit} ",
            "lineNumber": 4756
          },
          {
            "text": "                        onRenameCancel={() =&gt; setState(s =&gt; ({ ...s, renamingId: null }))} ",
            "lineNumber": 4757
          },
          {
            "text": "                        onStartRename={startRename} ",
            "lineNumber": 4758
          },
          {
            "text": "                        onDragStart={handleDragStart}",
            "lineNumber": 4759
          },
          {
            "text": ";",
            "lineNumber": 5056
          }
        ]
      },
      "score": 0.3482019305229187
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\SequenceViewer.tsx",
        "range": {
          "startPosition": {
            "line": 22
          },
          "endPosition": {
            "line": 617,
            "column": 1
          }
        },
        "contents": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = \n{t('sequence.prev')}\n            &lt;/div&gt;\n            &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;\n            &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleOriginal(); setContextMenu({...contextMenu, visible: false}); }}&gt;\n                &lt;Maximize size={14} className=\"mr-2\"/&gt; {t('sequence.original')}\n            &lt;/div&gt;\n            &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleReset(); setContextMenu({...contextMenu, visible: false}); }}&gt;\n                &lt;Minimize size={14} className=\"mr-2\"/&gt; {t('sequence.fit')}\n            &lt;/div&gt;\n            &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;\n            &lt;div className=\"px-4 py-2 hover:bg-red-600 hover:text-white text-red-500 dark:text-red-400 cursor-pointer flex items-center\" onClick={handleDeleteRequest}&gt;\n                &lt;Trash2 size={14} className=\"mr-2\"/&gt; {t('context.delete')}\n            &lt;/div&gt;\n        &lt;/div&gt;\n      )}\n\n      {/* Context Menu Backdrop */}\n      {contextMenu.visible &amp;&amp; (\n          &lt;div className=\"fixed inset-0 z-[59]\" onClick={() =&gt; setContextMenu({...contextMenu, visible: false})}&gt;&lt;/div&gt;\n      )}\n\n      {/* Delete Confirmation Modal */}\n      {showDeleteConfirm &amp;&amp; (\n          &lt;div className=\"fixed inset-0 z-[100] bg-black/50 flex items-center justify-center p-4\"&gt;\n              &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl max-w-sm w-full animate-zoom-in\"&gt;\n                  &lt;div className=\"flex items-center mb-4 text-orange-500\"&gt;\n                      &lt;AlertTriangle className=\"mr-2\" /&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 22,
                "column": 1
              },
              "endPosition": {
                "line": 22,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 8
              },
              "endPosition": {
                "line": 22,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 14
              },
              "endPosition": {
                "line": 22,
                "column": 62
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = ",
            "lineNumber": 23
          },
          {
            "text": "{t('sequence.prev')}",
            "lineNumber": 565
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 566
          },
          {
            "text": "            &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;",
            "lineNumber": 567
          },
          {
            "text": "            &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleOriginal(); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 568
          },
          {
            "text": "                &lt;Maximize size={14} className=\"mr-2\"/&gt; {t('sequence.original')}",
            "lineNumber": 569
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 570
          },
          {
            "text": "            &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { handleReset(); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 571
          },
          {
            "text": "                &lt;Minimize size={14} className=\"mr-2\"/&gt; {t('sequence.fit')}",
            "lineNumber": 572
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 573
          },
          {
            "text": "            &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;",
            "lineNumber": 574
          },
          {
            "text": "            &lt;div className=\"px-4 py-2 hover:bg-red-600 hover:text-white text-red-500 dark:text-red-400 cursor-pointer flex items-center\" onClick={handleDeleteRequest}&gt;",
            "lineNumber": 575
          },
          {
            "text": "                &lt;Trash2 size={14} className=\"mr-2\"/&gt; {t('context.delete')}",
            "lineNumber": 576
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 577
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 578
          },
          {
            "text": "      )}",
            "lineNumber": 579
          },
          {
            "lineNumber": 580
          },
          {
            "text": "      {/* Context Menu Backdrop */}",
            "lineNumber": 581
          },
          {
            "text": "      {contextMenu.visible &amp;&amp; (",
            "lineNumber": 582
          },
          {
            "text": "          &lt;div className=\"fixed inset-0 z-[59]\" onClick={() =&gt; setContextMenu({...contextMenu, visible: false})}&gt;&lt;/div&gt;",
            "lineNumber": 583
          },
          {
            "text": "      )}",
            "lineNumber": 584
          },
          {
            "lineNumber": 585
          },
          {
            "text": "      {/* Delete Confirmation Modal */}",
            "lineNumber": 586
          },
          {
            "text": "      {showDeleteConfirm &amp;&amp; (",
            "lineNumber": 587
          },
          {
            "text": "          &lt;div className=\"fixed inset-0 z-[100] bg-black/50 flex items-center justify-center p-4\"&gt;",
            "lineNumber": 588
          },
          {
            "text": "              &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl max-w-sm w-full animate-zoom-in\"&gt;",
            "lineNumber": 589
          },
          {
            "text": "                  &lt;div className=\"flex items-center mb-4 text-orange-500\"&gt;",
            "lineNumber": 590
          },
          {
            "text": "                      &lt;AlertTriangle className=\"mr-2\" /&gt;",
            "lineNumber": 591
          },
          {
            "text": ";",
            "lineNumber": 618
          }
        ]
      },
      "score": 0.34504279494285583
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


检查 Rust 后端的实现，并添加调试信息以查看实际传递的路径：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src-tauri/src/main.rs</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/api/tauri-bridge.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_command_v2">
<details><summary>Tool use: **run_terminal_command_v2** • Run command: cd "c:\Users\Misaki\Desktop\git\aurora-gallery-tauri" && grep -n "Documents\|Desktop" src-tauri/src/main.rs | head -20</summary>

```bash
cd "c:\Users\Misaki\Desktop\git\aurora-gallery-tauri" && grep -n "Documents\|Desktop" src-tauri/src/main.rs | head -20
```

```
����λ�� C:\Users\Misaki\AppData\Local\Temp\ps-script-9eceec1a-70a0-48ec-a8b3-404721544f31.ps1:81 �ַ�: 55
+ cd "c:\Users\Misaki\Desktop\git\aurora-gallery-tauri" &amp;&amp; grep -n "Doc ...
+                                                       ~~
��ǡ�&amp;&amp;�����Ǵ˰汾�е���Ч���ָ�����
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
    + FullyQualifiedErrorId : InvalidEndOfLine
 

```
</details>
</tool-use>

---



---


添加调试日志查看实际传递的路径值，并检查是否有路径处理问题：


---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "caadef96-7952-40fb-87b2-d04213f7db88"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "5774912d-d479-472d-bba7-1090eeca627e"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src-tauri/src/main.rs</summary>

</details>
</tool-use>

---



---


检查 Rust 后端，添加更详细的日志并确保路径正确性：


---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "c2947734-2689-4a09-a034-edf4e9f4c5fc"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "src-tauri/src/main.rs"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "src-tauri/src/main.rs"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


检查是否还有其他路径处理问题，并优化代码：


---

<tool-use data-tool-type="shell" data-tool-name="run_terminal_command_v2">
<details><summary>Tool use: **run_terminal_command_v2** • Run command: cd "c:\Users\Misaki\Desktop\git\aurora-gallery-tauri" && cargo check --manifest-path src-tauri/Cargo.toml 2>&1 | Select-Object -First 30</summary>

```bash
cd "c:\Users\Misaki\Desktop\git\aurora-gallery-tauri" && cargo check --manifest-path src-tauri/Cargo.toml 2>&1 | Select-Object -First 30
```

```
����λ�� C:\Users\Misaki\AppData\Local\Temp\ps-script-9e5cb891-dc3c-4bbf-a072-7c92502122fe.ps1:81 �ַ�: 55
+ cd "c:\Users\Misaki\Desktop\git\aurora-gallery-tauri" &amp;&amp; cargo check  ...
+                                                       ~~
��ǡ�&amp;&amp;�����Ǵ˰汾�е���Ч���ָ�����
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
    + FullyQualifiedErrorId : InvalidEndOfLine
 

```
</details>
</tool-use>

---



---


修正 Windows explorer 命令的路径格式，并优化代码：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src-tauri/src/main.rs</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "d0cdf968-7606-4f50-841d-c4db4f2c19b3"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src-tauri/src/main.rs</summary>

</details>
</tool-use>

---



---


移除 Windows explorer 命令中路径的引号，因为 `/select,` 参数不接受引号：


---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "a9e4bbb8-2185-4513-8e48-5c59ab3f32eb"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "src-tauri/src/main.rs"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "src-tauri/src/main.rs"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


## 修改总结

1. **前端代码 (src/App.tsx 和 src/api/tauri-bridge.ts)**
   - 添加调试日志，查看实际传递的路径
   - 确保传递正确的 `isFile` 参数

2. **Rust 后端 (src-tauri/src/main.rs)**
   - 路径存在性检查：执行前验证路径是否存在
   - 路径规范化：
     - 相对路径转换为绝对路径
     - 规范化路径分隔符（Windows 使用反斜杠）
   - Windows explorer 命令优化：
     - 对于文件：使用 `/select,路径` 格式
     - 对于包含空格的路径，使用引号包裹
   - 添加调试日志：记录实际执行的命令

现在代码应该能正确处理：
- 文件夹：直接打开所选文件夹
- 文件：打开文件所在目录并选中该文件

请测试一下。如果仍有问题，请查看控制台日志（浏览器和 Rust 后端），日志会显示实际传递和使用的路径。

---

_**User**_

对于文件的逻辑是对了，但是文件夹还有一些问题，这是我对一个文件夹选择在系统文件管理器中查看的一个后台信息。
open_path: path=E:/资源/Deal_of_Desire_11_16, normalized_path=E:\资源\Deal_of_Desire_11_16, is_file=Some(false), is_file_path=false
Windows explorer command (folder): explorer E:\资源\Deal_of_Desire_11_16
我希望打开的是这个文件夹所在的目录位置，也就是 E:\资源。

---

