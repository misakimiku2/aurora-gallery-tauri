<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 42bf66fa-f098-451a-ae80-e0da7aa82fc9 (2025-12-19 19:01Z) -->

# 人物界面搜索框限制 (2025-12-19 19:01Z)

_**User**_

当切换到人物界面时，最顶部的搜索框限制为只能搜索人物面板下的人物。离开人物主面板则恢复原有的搜索功能。

---

_**Agent (model default, mode Agent)**_



---


查看代码结构，了解搜索框和人物界面的实现。


---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "搜索框组件实现 search input",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n\n          &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-2\"&gt;&lt;/div&gt;\n          &lt;button \n            onClick={onNavigateBack} disabled={!canGoBack}\n            className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30 text-gray-500 dark:text-gray-400\"\n            title={t('viewer.back')}\n          &gt;\n            &lt;ArrowLeft size={18} /&gt;\n          &lt;/button&gt;\n          &lt;button \n            onClick={onNavigateForward} disabled={!canGoForward}\n            className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30 text-gray-500 dark:text-gray-400\"\n            title={t('viewer.forward')}\n          &gt;\n            &lt;ArrowRight size={18} /&gt;\n          &lt;/button&gt;\n        &lt;/div&gt;\n\n        &lt;div className=\"flex-1 text-center truncate px-4 font-medium text-gray-800 dark:text-gray-200 flex justify-center items-center\"&gt;\n          {showSearch ? (\n            &lt;div className=\"relative w-full max-w-[672px] animate-fade-in\"&gt;\n              &lt;div className={&#96;flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border overflow-hidden ${isAISearchEnabled ? 'border-purple-500 shadow-sm shadow-purple-500/20' : localQuery ? 'border-blue-500 shadow-sm' : 'border-transparent'}&#96;}&gt;\n                 &lt;div className=\"relative flex-shrink-0\"&gt;\n                   &lt;button \n                     ref={scopeBtnRef}\n                     type=\"button\"\n                     onClick={toggleScopeMenu}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "lineNumber": 467
          },
          {
            "text": "          &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-2\"&gt;&lt;/div&gt;",
            "lineNumber": 468
          },
          {
            "text": "          &lt;button ",
            "lineNumber": 469
          },
          {
            "text": "            onClick={onNavigateBack} disabled={!canGoBack}",
            "lineNumber": 470
          },
          {
            "text": "            className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30 text-gray-500 dark:text-gray-400\"",
            "lineNumber": 471
          },
          {
            "text": "            title={t('viewer.back')}",
            "lineNumber": 472
          },
          {
            "text": "          &gt;",
            "lineNumber": 473
          },
          {
            "text": "            &lt;ArrowLeft size={18} /&gt;",
            "lineNumber": 474
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 475
          },
          {
            "text": "          &lt;button ",
            "lineNumber": 476
          },
          {
            "text": "            onClick={onNavigateForward} disabled={!canGoForward}",
            "lineNumber": 477
          },
          {
            "text": "            className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30 text-gray-500 dark:text-gray-400\"",
            "lineNumber": 478
          },
          {
            "text": "            title={t('viewer.forward')}",
            "lineNumber": 479
          },
          {
            "text": "          &gt;",
            "lineNumber": 480
          },
          {
            "text": "            &lt;ArrowRight size={18} /&gt;",
            "lineNumber": 481
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 482
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 483
          },
          {
            "lineNumber": 484
          },
          {
            "text": "        &lt;div className=\"flex-1 text-center truncate px-4 font-medium text-gray-800 dark:text-gray-200 flex justify-center items-center\"&gt;",
            "lineNumber": 485
          },
          {
            "text": "          {showSearch ? (",
            "lineNumber": 486
          },
          {
            "text": "            &lt;div className=\"relative w-full max-w-[672px] animate-fade-in\"&gt;",
            "lineNumber": 487
          },
          {
            "text": "              &lt;div className={&#96;flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border overflow-hidden ${isAISearchEnabled ? 'border-purple-500 shadow-sm shadow-purple-500/20' : localQuery ? 'border-blue-500 shadow-sm' : 'border-transparent'}&#96;}&gt;",
            "lineNumber": 488
          },
          {
            "text": "                 &lt;div className=\"relative flex-shrink-0\"&gt;",
            "lineNumber": 489
          },
          {
            "text": "                   &lt;button ",
            "lineNumber": 490
          },
          {
            "text": "                     ref={scopeBtnRef}",
            "lineNumber": 491
          },
          {
            "text": "                     type=\"button\"",
            "lineNumber": 492
          },
          {
            "text": "                     onClick={toggleScopeMenu}",
            "lineNumber": 493
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.5309559106826782
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 444
          },
          "endPosition": {
            "line": 799,
            "column": 1
          }
        },
        "contents": "export const TopBar: React.FC&lt;TopBarProps&gt; = \n\n            )}\n          &lt;/div&gt;\n\n          &lt;Search size={16} className={&#96;mr-2 flex-shrink-0 ${isAISearchEnabled ? 'text-purple-500' : 'text-gray-400'}&#96;} /&gt;\n          \n          &lt;input\n            ref={searchInputRef}\n            type=\"text\"\n            id=\"toolbar-search-input\"\n            name=\"toolbar-search-input\"\n            className=\"bg-transparent border-none focus:outline-none text-sm w-full text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 min-w-0\"\n            placeholder={isAISearchEnabled ? t('settings.aiSmartSearch') : t('search.placeholder')}\n            value={toolbarQuery}\n            onChange={(e) =&gt; onSetToolbarQuery(e.target.value)}\n            onKeyDown={handleKeyDown}\n          /&gt;\n\n          &lt;div className=\"flex items-center space-x-1 ml-2 flex-shrink-0\"&gt;\n             {toolbarQuery &amp;&amp; (\n                &lt;button onClick={() =&gt; { onSetToolbarQuery(''); onPerformSearch(''); }} className=\"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-400 flex-shrink-0\"&gt;\n                  &lt;X size={14} /&gt;\n                &lt;/button&gt;\n             )}\n              \n             &lt;button \n                onClick={onToggleAISearch}\n                className={&#96;p-1.5 rounded-full transition-colors ${isAISearchEnabled ? 'bg-purple-100 text-purple-600 dark:bg-purple-900/40 dark:text-purple-300' : 'hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-400'}&#96;}\n                title={t('settings.aiSmartSearch')}\n             &gt;\n                &lt;Brain size={16} /&gt;\n             &lt;/button&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n\n      {/* Right: Tools &amp; Settings */}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 443,
                "column": 1
              },
              "endPosition": {
                "line": 443,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 8
              },
              "endPosition": {
                "line": 443,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 14
              },
              "endPosition": {
                "line": 443,
                "column": 46
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const TopBar: React.FC&lt;TopBarProps&gt; = ",
            "lineNumber": 445
          },
          {
            "lineNumber": 558
          },
          {
            "text": "            )}",
            "lineNumber": 559
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 560
          },
          {
            "lineNumber": 561
          },
          {
            "text": "          &lt;Search size={16} className={&#96;mr-2 flex-shrink-0 ${isAISearchEnabled ? 'text-purple-500' : 'text-gray-400'}&#96;} /&gt;",
            "lineNumber": 562
          },
          {
            "text": "          ",
            "lineNumber": 563
          },
          {
            "text": "          &lt;input",
            "lineNumber": 564
          },
          {
            "text": "            ref={searchInputRef}",
            "lineNumber": 565
          },
          {
            "text": "            type=\"text\"",
            "lineNumber": 566
          },
          {
            "text": "            id=\"toolbar-search-input\"",
            "lineNumber": 567
          },
          {
            "text": "            name=\"toolbar-search-input\"",
            "lineNumber": 568
          },
          {
            "text": "            className=\"bg-transparent border-none focus:outline-none text-sm w-full text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 min-w-0\"",
            "lineNumber": 569
          },
          {
            "text": "            placeholder={isAISearchEnabled ? t('settings.aiSmartSearch') : t('search.placeholder')}",
            "lineNumber": 570
          },
          {
            "text": "            value={toolbarQuery}",
            "lineNumber": 571
          },
          {
            "text": "            onChange={(e) =&gt; onSetToolbarQuery(e.target.value)}",
            "lineNumber": 572
          },
          {
            "text": "            onKeyDown={handleKeyDown}",
            "lineNumber": 573
          },
          {
            "text": "          /&gt;",
            "lineNumber": 574
          },
          {
            "lineNumber": 575
          },
          {
            "text": "          &lt;div className=\"flex items-center space-x-1 ml-2 flex-shrink-0\"&gt;",
            "lineNumber": 576
          },
          {
            "text": "             {toolbarQuery &amp;&amp; (",
            "lineNumber": 577
          },
          {
            "text": "                &lt;button onClick={() =&gt; { onSetToolbarQuery(''); onPerformSearch(''); }} className=\"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-400 flex-shrink-0\"&gt;",
            "lineNumber": 578
          },
          {
            "text": "                  &lt;X size={14} /&gt;",
            "lineNumber": 579
          },
          {
            "text": "                &lt;/button&gt;",
            "lineNumber": 580
          },
          {
            "text": "             )}",
            "lineNumber": 581
          },
          {
            "text": "              ",
            "lineNumber": 582
          },
          {
            "text": "             &lt;button ",
            "lineNumber": 583
          },
          {
            "text": "                onClick={onToggleAISearch}",
            "lineNumber": 584
          },
          {
            "text": "                className={&#96;p-1.5 rounded-full transition-colors ${isAISearchEnabled ? 'bg-purple-100 text-purple-600 dark:bg-purple-900/40 dark:text-purple-300' : 'hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-400'}&#96;}",
            "lineNumber": 585
          },
          {
            "text": "                title={t('settings.aiSmartSearch')}",
            "lineNumber": 586
          },
          {
            "text": "             &gt;",
            "lineNumber": 587
          },
          {
            "text": "                &lt;Brain size={16} /&gt;",
            "lineNumber": 588
          },
          {
            "text": "             &lt;/button&gt;",
            "lineNumber": 589
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 590
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 591
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 592
          },
          {
            "lineNumber": 593
          },
          {
            "text": "      {/* Right: Tools &amp; Settings */}",
            "lineNumber": 594
          },
          {
            "text": ";",
            "lineNumber": 800
          }
        ]
      },
      "score": 0.5031516551971436
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 197
          },
          "endPosition": {
            "line": 799,
            "column": 1
          }
        },
        "contents": "const CalendarWidget = \n\n  );\n};\n\nexport const TopBar: React.FC&lt;TopBarProps&gt; = ({\n  activeTab,\n  state,\n  toolbarQuery,\n  groupedTags,\n  tagSearchQuery,\n  onToggleSidebar,\n  onGoBack,\n  onGoForward,\n  onNavigateUp,\n  onSetTagSearchQuery,\n  onTagClick,\n  onRefresh,\n  onSearchScopeChange,\n  onPerformSearch,\n  onSetToolbarQuery,\n  onLayoutModeChange,\n  onSortOptionChange,\n  onSortDirectionChange,\n  onThumbnailSizeChange,\n  onToggleMetadata,\n  onToggleSettings,\n  onUpdateDateFilter,\n  groupBy,\n  onGroupByChange,\n  isAISearchEnabled,\n  onToggleAISearch,\n  onRememberFolderSettings,\n  hasFolderSettings,\n  t\n}) =&gt; {\n  const [scopeMenuOpen, setScopeMenuOpen] = useState(false);\n  const [viewMenuOpen, setViewMenuOpen] = useState(false);\n  const [sortMenuOpen, setSortMenuOpen] = useState(false);\n  const [filterMenuOpen, setFilterMenuOpen] = useState(false);\n  const [tagsMenuOpen, setTagsMenuOpen] = useState(false);\n  const searchInputRef = useRef&lt;HTMLInputElement&gt;(null);\n\n  const getScopeIcon = (scope: SearchScope) =&gt; {\n    switch (scope) {\n      case 'file': return &lt;FileText size={14} /&gt;;\n      case 'tag': return &lt;Tag size={14} /&gt;;\n      case 'folder': return &lt;Folder size={14} /&gt;;\n      default: return &lt;Globe size={14} /&gt;;\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) =&gt; {\n    if (e.key === 'Enter') {\n      onPerformSearch(toolbarQuery);\n    }\n  };\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const CalendarWidget = ",
            "lineNumber": 198
          },
          {
            "lineNumber": 441
          },
          {
            "text": "  );",
            "lineNumber": 442
          },
          {
            "text": "};",
            "lineNumber": 443
          },
          {
            "lineNumber": 444
          },
          {
            "text": "export const TopBar: React.FC&lt;TopBarProps&gt; = ({",
            "lineNumber": 445
          },
          {
            "text": "  activeTab,",
            "lineNumber": 446
          },
          {
            "text": "  state,",
            "lineNumber": 447
          },
          {
            "text": "  toolbarQuery,",
            "lineNumber": 448
          },
          {
            "text": "  groupedTags,",
            "lineNumber": 449
          },
          {
            "text": "  tagSearchQuery,",
            "lineNumber": 450
          },
          {
            "text": "  onToggleSidebar,",
            "lineNumber": 451
          },
          {
            "text": "  onGoBack,",
            "lineNumber": 452
          },
          {
            "text": "  onGoForward,",
            "lineNumber": 453
          },
          {
            "text": "  onNavigateUp,",
            "lineNumber": 454
          },
          {
            "text": "  onSetTagSearchQuery,",
            "lineNumber": 455
          },
          {
            "text": "  onTagClick,",
            "lineNumber": 456
          },
          {
            "text": "  onRefresh,",
            "lineNumber": 457
          },
          {
            "text": "  onSearchScopeChange,",
            "lineNumber": 458
          },
          {
            "text": "  onPerformSearch,",
            "lineNumber": 459
          },
          {
            "text": "  onSetToolbarQuery,",
            "lineNumber": 460
          },
          {
            "text": "  onLayoutModeChange,",
            "lineNumber": 461
          },
          {
            "text": "  onSortOptionChange,",
            "lineNumber": 462
          },
          {
            "text": "  onSortDirectionChange,",
            "lineNumber": 463
          },
          {
            "text": "  onThumbnailSizeChange,",
            "lineNumber": 464
          },
          {
            "text": "  onToggleMetadata,",
            "lineNumber": 465
          },
          {
            "text": "  onToggleSettings,",
            "lineNumber": 466
          },
          {
            "text": "  onUpdateDateFilter,",
            "lineNumber": 467
          },
          {
            "text": "  groupBy,",
            "lineNumber": 468
          },
          {
            "text": "  onGroupByChange,",
            "lineNumber": 469
          },
          {
            "text": "  isAISearchEnabled,",
            "lineNumber": 470
          },
          {
            "text": "  onToggleAISearch,",
            "lineNumber": 471
          },
          {
            "text": "  onRememberFolderSettings,",
            "lineNumber": 472
          },
          {
            "text": "  hasFolderSettings,",
            "lineNumber": 473
          },
          {
            "text": "  t",
            "lineNumber": 474
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 475
          },
          {
            "text": "  const [scopeMenuOpen, setScopeMenuOpen] = useState(false);",
            "lineNumber": 476
          },
          {
            "text": "  const [viewMenuOpen, setViewMenuOpen] = useState(false);",
            "lineNumber": 477
          },
          {
            "text": "  const [sortMenuOpen, setSortMenuOpen] = useState(false);",
            "lineNumber": 478
          },
          {
            "text": "  const [filterMenuOpen, setFilterMenuOpen] = useState(false);",
            "lineNumber": 479
          },
          {
            "text": "  const [tagsMenuOpen, setTagsMenuOpen] = useState(false);",
            "lineNumber": 480
          },
          {
            "text": "  const searchInputRef = useRef&lt;HTMLInputElement&gt;(null);",
            "lineNumber": 481
          },
          {
            "lineNumber": 482
          },
          {
            "text": "  const getScopeIcon = (scope: SearchScope) =&gt; {",
            "lineNumber": 483
          },
          {
            "text": "    switch (scope) {",
            "lineNumber": 484
          },
          {
            "text": "      case 'file': return &lt;FileText size={14} /&gt;;",
            "lineNumber": 485
          },
          {
            "text": "      case 'tag': return &lt;Tag size={14} /&gt;;",
            "lineNumber": 486
          },
          {
            "text": "      case 'folder': return &lt;Folder size={14} /&gt;;",
            "lineNumber": 487
          },
          {
            "text": "      default: return &lt;Globe size={14} /&gt;;",
            "lineNumber": 488
          },
          {
            "text": "    }",
            "lineNumber": 489
          },
          {
            "text": "  };",
            "lineNumber": 490
          },
          {
            "lineNumber": 491
          },
          {
            "text": "  const handleKeyDown = (e: React.KeyboardEvent) =&gt; {",
            "lineNumber": 492
          },
          {
            "text": "    if (e.key === 'Enter') {",
            "lineNumber": 493
          },
          {
            "text": "      onPerformSearch(toolbarQuery);",
            "lineNumber": 494
          },
          {
            "text": "    }",
            "lineNumber": 495
          },
          {
            "text": "  };",
            "lineNumber": 496
          },
          {
            "text": ";",
            "lineNumber": 800
          }
        ]
      },
      "score": 0.4653683304786682
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 43
          },
          "endPosition": {
            "line": 195,
            "column": 1
          }
        },
        "contents": "const TagsWidget = \nconst suggestedTags = \n [allTags, localSearchQuery, isFocused]);\n  \n  const keys = Object.keys(filteredGroupedTags).sort();\n  const totalTags = Object.values(filteredGroupedTags).reduce((acc, curr) =&gt; acc + curr.length, 0);\n\n  return (\n    &lt;div className=\"flex flex-col select-none bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-2xl overflow-hidden w-80 max-h-[400px] font-sans border border-gray-200 dark:border-gray-700 z-50\"&gt;\n      &lt;div className=\"px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\"&gt;\n        &lt;div className=\"flex items-center justify-between mb-3\"&gt;\n          &lt;span className=\"font-bold text-sm tracking-wide\"&gt;{t('sidebar.allTags')}&lt;/span&gt;\n          &lt;span className=\"text-xs text-gray-500 dark:text-gray-400 bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded-full\"&gt;\n            {totalTags}\n          &lt;/span&gt;\n        &lt;/div&gt;\n        &lt;div className=\"relative\"&gt;\n          &lt;Search size={14} className=\"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400\" /&gt;\n          &lt;input\n            type=\"text\"\n            id=\"tag-search-input\"\n            name=\"tag-search-input\"\n            placeholder={t('search.placeholder')}\n            value={localSearchQuery}\n            onChange={(e) =&gt; {\n              setLocalSearchQuery(e.target.value);\n              onSetTagSearchQuery(e.target.value);\n            }}\n            onFocus={() =&gt; setIsFocused(true)}\n            onBlur={() =&gt; {\n              // 延迟关闭，以便点击建议项时能触发点击事件\n              setTimeout(() =&gt; setIsFocused(false), 200);\n            }}\n            className=\"w-full pl-8 pr-2 py-1.5 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          /&gt;\n          {localSearchQuery &amp;&amp;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 42,
                "column": 1
              },
              "endPosition": {
                "line": 42,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 42,
                "column": 7
              },
              "endPosition": {
                "line": 42,
                "column": 20
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsWidget = ",
            "lineNumber": 44
          },
          {
            "text": "const suggestedTags = ",
            "lineNumber": 79
          },
          {
            "text": " [allTags, localSearchQuery, isFocused]);",
            "lineNumber": 85
          },
          {
            "text": "  ",
            "lineNumber": 86
          },
          {
            "text": "  const keys = Object.keys(filteredGroupedTags).sort();",
            "lineNumber": 87
          },
          {
            "text": "  const totalTags = Object.values(filteredGroupedTags).reduce((acc, curr) =&gt; acc + curr.length, 0);",
            "lineNumber": 88
          },
          {
            "lineNumber": 89
          },
          {
            "text": "  return (",
            "lineNumber": 90
          },
          {
            "text": "    &lt;div className=\"flex flex-col select-none bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-2xl overflow-hidden w-80 max-h-[400px] font-sans border border-gray-200 dark:border-gray-700 z-50\"&gt;",
            "lineNumber": 91
          },
          {
            "text": "      &lt;div className=\"px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\"&gt;",
            "lineNumber": 92
          },
          {
            "text": "        &lt;div className=\"flex items-center justify-between mb-3\"&gt;",
            "lineNumber": 93
          },
          {
            "text": "          &lt;span className=\"font-bold text-sm tracking-wide\"&gt;{t('sidebar.allTags')}&lt;/span&gt;",
            "lineNumber": 94
          },
          {
            "text": "          &lt;span className=\"text-xs text-gray-500 dark:text-gray-400 bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded-full\"&gt;",
            "lineNumber": 95
          },
          {
            "text": "            {totalTags}",
            "lineNumber": 96
          },
          {
            "text": "          &lt;/span&gt;",
            "lineNumber": 97
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 98
          },
          {
            "text": "        &lt;div className=\"relative\"&gt;",
            "lineNumber": 99
          },
          {
            "text": "          &lt;Search size={14} className=\"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400\" /&gt;",
            "lineNumber": 100
          },
          {
            "text": "          &lt;input",
            "lineNumber": 101
          },
          {
            "text": "            type=\"text\"",
            "lineNumber": 102
          },
          {
            "text": "            id=\"tag-search-input\"",
            "lineNumber": 103
          },
          {
            "text": "            name=\"tag-search-input\"",
            "lineNumber": 104
          },
          {
            "text": "            placeholder={t('search.placeholder')}",
            "lineNumber": 105
          },
          {
            "text": "            value={localSearchQuery}",
            "lineNumber": 106
          },
          {
            "text": "            onChange={(e) =&gt; {",
            "lineNumber": 107
          },
          {
            "text": "              setLocalSearchQuery(e.target.value);",
            "lineNumber": 108
          },
          {
            "text": "              onSetTagSearchQuery(e.target.value);",
            "lineNumber": 109
          },
          {
            "text": "            }}",
            "lineNumber": 110
          },
          {
            "text": "            onFocus={() =&gt; setIsFocused(true)}",
            "lineNumber": 111
          },
          {
            "text": "            onBlur={() =&gt; {",
            "lineNumber": 112
          },
          {
            "text": "              // 延迟关闭，以便点击建议项时能触发点击事件",
            "lineNumber": 113
          },
          {
            "text": "              setTimeout(() =&gt; setIsFocused(false), 200);",
            "lineNumber": 114
          },
          {
            "text": "            }}",
            "lineNumber": 115
          },
          {
            "text": "            className=\"w-full pl-8 pr-2 py-1.5 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"",
            "lineNumber": 116
          },
          {
            "text": "          /&gt;",
            "lineNumber": 117
          },
          {
            "text": "          {localSearchQuery &amp;&amp;",
            "lineNumber": 118
          },
          {
            "text": ";",
            "lineNumber": 196
          }
        ]
      },
      "score": 0.43821489810943604
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst performAiSearch = async \n\n          const prompt = &#96;\n          Analyze this search query for a photo gallery: \"${query}\".\n          Extract search intent and criteria into a JSON object.\n          Return ONLY JSON.\n          \n          Expected JSON Structure:\n          {\n            \"keywords\": string[], // Synonyms, objects, tags\n            \"colors\": string[], // Hex codes or color names\n            \"people\": string[], // Names of people\n            \"description\": string // A concise description of what to look for (optional)\n          }\n          &#96;;\n\n          let result: any = null;\n          \n          // Same logic as handleAIAnalysis but for search\n          if (aiConfig.provider === 'openai') {\n              const body = {\n                  model: aiConfig.openai.model,\n                  messages: [{ role: \"user\", content: prompt }],\n                  max_tokens: 500\n              };\n              try {\n                  const res = await fetch(&#96;${aiConfig.openai.endpoint}/chat/completions&#96;, {\n                      method: 'POST',\n                      headers: { 'Content-Type': 'application/json', 'Authorization': &#96;Bearer ${aiConfig.openai.apiKey}&#96; },\n                      body: JSON.stringify(body)\n                  });\n                  const resData = await res.json();\n                  if (resData?.choices?.[0]?.message?.content) { \n                      try { result = JSON.parse(resData.choices[0].message.content); } catch(e){} \n                  }\n              } catch (e) {\n                  console.error('AI search failed:', e);\n              }\n          } else if (aiConfig.provider === 'ollama') {\n              const body = { model: aiConfig.ollama.model, prompt: prompt, stream: false, format: \"json\" };\n              try {\n                  const res = await fetch(&#96;${aiConfig.ollama.endpoint}/api/generate&#96;, {\n                      method: 'POST',\n                      headers: { 'Content-Type': 'application/json' },\n                      body: JSON.stringify(body)\n                  });\n                  const resData = await res.json();\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 2892,
                "column": 3
              },
              "endPosition": {
                "line": 2892,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 2892,
                "column": 9
              },
              "endPosition": {
                "line": 2892,
                "column": 33
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const performAiSearch = async ",
            "lineNumber": 2947
          },
          {
            "lineNumber": 2957
          },
          {
            "text": "          const prompt = &#96;",
            "lineNumber": 2958
          },
          {
            "text": "          Analyze this search query for a photo gallery: \"${query}\".",
            "lineNumber": 2959
          },
          {
            "text": "          Extract search intent and criteria into a JSON object.",
            "lineNumber": 2960
          },
          {
            "text": "          Return ONLY JSON.",
            "lineNumber": 2961
          },
          {
            "text": "          ",
            "lineNumber": 2962
          },
          {
            "text": "          Expected JSON Structure:",
            "lineNumber": 2963
          },
          {
            "text": "          {",
            "lineNumber": 2964
          },
          {
            "text": "            \"keywords\": string[], // Synonyms, objects, tags",
            "lineNumber": 2965
          },
          {
            "text": "            \"colors\": string[], // Hex codes or color names",
            "lineNumber": 2966
          },
          {
            "text": "            \"people\": string[], // Names of people",
            "lineNumber": 2967
          },
          {
            "text": "            \"description\": string // A concise description of what to look for (optional)",
            "lineNumber": 2968
          },
          {
            "text": "          }",
            "lineNumber": 2969
          },
          {
            "text": "          &#96;;",
            "lineNumber": 2970
          },
          {
            "lineNumber": 2971
          },
          {
            "text": "          let result: any = null;",
            "lineNumber": 2972
          },
          {
            "text": "          ",
            "lineNumber": 2973
          },
          {
            "text": "          // Same logic as handleAIAnalysis but for search",
            "lineNumber": 2974
          },
          {
            "text": "          if (aiConfig.provider === 'openai') {",
            "lineNumber": 2975
          },
          {
            "text": "              const body = {",
            "lineNumber": 2976
          },
          {
            "text": "                  model: aiConfig.openai.model,",
            "lineNumber": 2977
          },
          {
            "text": "                  messages: [{ role: \"user\", content: prompt }],",
            "lineNumber": 2978
          },
          {
            "text": "                  max_tokens: 500",
            "lineNumber": 2979
          },
          {
            "text": "              };",
            "lineNumber": 2980
          },
          {
            "text": "              try {",
            "lineNumber": 2981
          },
          {
            "text": "                  const res = await fetch(&#96;${aiConfig.openai.endpoint}/chat/completions&#96;, {",
            "lineNumber": 2982
          },
          {
            "text": "                      method: 'POST',",
            "lineNumber": 2983
          },
          {
            "text": "                      headers: { 'Content-Type': 'application/json', 'Authorization': &#96;Bearer ${aiConfig.openai.apiKey}&#96; },",
            "lineNumber": 2984
          },
          {
            "text": "                      body: JSON.stringify(body)",
            "lineNumber": 2985
          },
          {
            "text": "                  });",
            "lineNumber": 2986
          },
          {
            "text": "                  const resData = await res.json();",
            "lineNumber": 2987
          },
          {
            "text": "                  if (resData?.choices?.[0]?.message?.content) { ",
            "lineNumber": 2988
          },
          {
            "text": "                      try { result = JSON.parse(resData.choices[0].message.content); } catch(e){} ",
            "lineNumber": 2989
          },
          {
            "text": "                  }",
            "lineNumber": 2990
          },
          {
            "text": "              } catch (e) {",
            "lineNumber": 2991
          },
          {
            "text": "                  console.error('AI search failed:', e);",
            "lineNumber": 2992
          },
          {
            "text": "              }",
            "lineNumber": 2993
          },
          {
            "text": "          } else if (aiConfig.provider === 'ollama') {",
            "lineNumber": 2994
          },
          {
            "text": "              const body = { model: aiConfig.ollama.model, prompt: prompt, stream: false, format: \"json\" };",
            "lineNumber": 2995
          },
          {
            "text": "              try {",
            "lineNumber": 2996
          },
          {
            "text": "                  const res = await fetch(&#96;${aiConfig.ollama.endpoint}/api/generate&#96;, {",
            "lineNumber": 2997
          },
          {
            "text": "                      method: 'POST',",
            "lineNumber": 2998
          },
          {
            "text": "                      headers: { 'Content-Type': 'application/json' },",
            "lineNumber": 2999
          },
          {
            "text": "                      body: JSON.stringify(body)",
            "lineNumber": 3000
          },
          {
            "text": "                  });",
            "lineNumber": 3001
          },
          {
            "text": "                  const resData = await res.json();",
            "lineNumber": 3002
          },
          {
            "text": ";",
            "lineNumber": 3054
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.40412724018096924
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \n catch (err) {\n          console.error(err);\n          showToast(\"AI Analysis Failed\");\n      } finally {\n          updateTask(taskId, { status: 'completed', currentStep: t('tasks.completed') });\n          setTimeout(() =&gt; setState(prev =&gt; ({ ...prev, tasks: prev.tasks.filter(t =&gt; t.id !== taskId) })), 1000);\n      }\n  };\n  \n  // Function to analyze all files in a folder\n  const handleFolderAIAnalysis = async (folderId: string) =&gt; {\n      // Get all image files in the folder and check their AI analysis status\n      const getAllImageFilesInFolder = (folderId: string): { id: string; analyzed: boolean }[] =&gt; {\n          const folder = state.files[folderId];\n          if (!folder) return [];\n          \n          let imageFiles: { id: string; analyzed: boolean }[] = [];\n          \n          if (folder.children) {\n              for (const childId of folder.children) {\n                  const child = state.files[childId];\n                  if (child) {\n                      if (child.type === FileType.FOLDER) {\n                          // Recursively get files from subfolders\n                          imageFiles = [...imageFiles, ...getAllImageFilesInFolder(childId)];\n                      } else if (child.type === FileType.IMAGE) {\n                          // Check if image has been analyzed\n                          const analyzed = !!child.aiData?.analyzed;\n                          imageFiles.push({ id: childId, analyzed });\n                      }\n                  }\n              }\n          }\n;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3593
          },
          {
            "text": " catch (err) {",
            "lineNumber": 4379
          },
          {
            "text": "          console.error(err);",
            "lineNumber": 4380
          },
          {
            "text": "          showToast(\"AI Analysis Failed\");",
            "lineNumber": 4381
          },
          {
            "text": "      } finally {",
            "lineNumber": 4382
          },
          {
            "text": "          updateTask(taskId, { status: 'completed', currentStep: t('tasks.completed') });",
            "lineNumber": 4383
          },
          {
            "text": "          setTimeout(() =&gt; setState(prev =&gt; ({ ...prev, tasks: prev.tasks.filter(t =&gt; t.id !== taskId) })), 1000);",
            "lineNumber": 4384
          },
          {
            "text": "      }",
            "lineNumber": 4385
          },
          {
            "text": "  };",
            "lineNumber": 4386
          },
          {
            "text": "  ",
            "lineNumber": 4387
          },
          {
            "text": "  // Function to analyze all files in a folder",
            "lineNumber": 4388
          },
          {
            "text": "  const handleFolderAIAnalysis = async (folderId: string) =&gt; {",
            "lineNumber": 4389
          },
          {
            "text": "      // Get all image files in the folder and check their AI analysis status",
            "lineNumber": 4390
          },
          {
            "text": "      const getAllImageFilesInFolder = (folderId: string): { id: string; analyzed: boolean }[] =&gt; {",
            "lineNumber": 4391
          },
          {
            "text": "          const folder = state.files[folderId];",
            "lineNumber": 4392
          },
          {
            "text": "          if (!folder) return [];",
            "lineNumber": 4393
          },
          {
            "text": "          ",
            "lineNumber": 4394
          },
          {
            "text": "          let imageFiles: { id: string; analyzed: boolean }[] = [];",
            "lineNumber": 4395
          },
          {
            "text": "          ",
            "lineNumber": 4396
          },
          {
            "text": "          if (folder.children) {",
            "lineNumber": 4397
          },
          {
            "text": "              for (const childId of folder.children) {",
            "lineNumber": 4398
          },
          {
            "text": "                  const child = state.files[childId];",
            "lineNumber": 4399
          },
          {
            "text": "                  if (child) {",
            "lineNumber": 4400
          },
          {
            "text": "                      if (child.type === FileType.FOLDER) {",
            "lineNumber": 4401
          },
          {
            "text": "                          // Recursively get files from subfolders",
            "lineNumber": 4402
          },
          {
            "text": "                          imageFiles = [...imageFiles, ...getAllImageFilesInFolder(childId)];",
            "lineNumber": 4403
          },
          {
            "text": "                      } else if (child.type === FileType.IMAGE) {",
            "lineNumber": 4404
          },
          {
            "text": "                          // Check if image has been analyzed",
            "lineNumber": 4405
          },
          {
            "text": "                          const analyzed = !!child.aiData?.analyzed;",
            "lineNumber": 4406
          },
          {
            "text": "                          imageFiles.push({ id: childId, analyzed });",
            "lineNumber": 4407
          },
          {
            "text": "                      }",
            "lineNumber": 4408
          },
          {
            "text": "                  }",
            "lineNumber": 4409
          },
          {
            "text": "              }",
            "lineNumber": 4410
          },
          {
            "text": "          }",
            "lineNumber": 4411
          },
          {
            "text": ";",
            "lineNumber": 4414
          },
          {
            "text": ";",
            "lineNumber": 4435
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.38342368602752686
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleRefresh = async \nprev =&gt; {\n([fileId, newFile]) =&gt; {\n\n                      } else {\n                          // New file, add as-is\n                          mergedFiles[fileId] = newFile;\n                      }\n                  });\n                  \n                  return { ...prev, files: mergedFiles };\n              });\n          } catch (e) {\n              console.error(\"Failed to refresh directory\", e);\n          }\n      } else if (folder) {\n          // Handle virtual folders with no actual path\n          setState(prev =&gt; {\n              // Force a complete re-render by updating the folder's lastRefresh timestamp\n              const files = { ...prev.files };\n              files[targetFolderId] = {\n                  ...folder,\n                  // Add a lastRefresh timestamp to force a re-render\n                  lastRefresh: Date.now()\n              };\n              \n              return { ...prev, files };\n          });\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 3
              },
              "endPosition": {
                "line": 1305,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 9
              },
              "endPosition": {
                "line": 1305,
                "column": 26
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 34
              },
              "endPosition": {
                "line": 1306,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleRefresh = async ",
            "lineNumber": 1346
          },
          {
            "text": "prev =&gt; {",
            "lineNumber": 1355
          },
          {
            "text": "([fileId, newFile]) =&gt; {",
            "lineNumber": 1377
          },
          {
            "lineNumber": 1395
          },
          {
            "text": "                      } else {",
            "lineNumber": 1396
          },
          {
            "text": "                          // New file, add as-is",
            "lineNumber": 1397
          },
          {
            "text": "                          mergedFiles[fileId] = newFile;",
            "lineNumber": 1398
          },
          {
            "text": "                      }",
            "lineNumber": 1399
          },
          {
            "text": "                  });",
            "lineNumber": 1400
          },
          {
            "text": "                  ",
            "lineNumber": 1401
          },
          {
            "text": "                  return { ...prev, files: mergedFiles };",
            "lineNumber": 1402
          },
          {
            "text": "              });",
            "lineNumber": 1403
          },
          {
            "text": "          } catch (e) {",
            "lineNumber": 1404
          },
          {
            "text": "              console.error(\"Failed to refresh directory\", e);",
            "lineNumber": 1405
          },
          {
            "text": "          }",
            "lineNumber": 1406
          },
          {
            "text": "      } else if (folder) {",
            "lineNumber": 1407
          },
          {
            "text": "          // Handle virtual folders with no actual path",
            "lineNumber": 1408
          },
          {
            "text": "          setState(prev =&gt; {",
            "lineNumber": 1409
          },
          {
            "text": "              // Force a complete re-render by updating the folder's lastRefresh timestamp",
            "lineNumber": 1410
          },
          {
            "text": "              const files = { ...prev.files };",
            "lineNumber": 1411
          },
          {
            "text": "              files[targetFolderId] = {",
            "lineNumber": 1412
          },
          {
            "text": "                  ...folder,",
            "lineNumber": 1413
          },
          {
            "text": "                  // Add a lastRefresh timestamp to force a re-render",
            "lineNumber": 1414
          },
          {
            "text": "                  lastRefresh: Date.now()",
            "lineNumber": 1415
          },
          {
            "text": "              };",
            "lineNumber": 1416
          },
          {
            "text": "              ",
            "lineNumber": 1417
          },
          {
            "text": "              return { ...prev, files };",
            "lineNumber": 1418
          },
          {
            "text": "          });",
            "lineNumber": 1419
          },
          {
            "text": ";",
            "lineNumber": 1421
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3734382390975952
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 11
          },
          "endPosition": {
            "line": 195,
            "column": 1
          }
        },
        "contents": "interface TopBarProps {\n\n  t: (key: string) =&gt; string;\n}\n\nconst TagsWidget = ({ groupedTags, onTagClick, t, tagSearchQuery, onSetTagSearchQuery }: { groupedTags: Record&lt;string, string[]&gt;, onTagClick: (tag: string, e: React.MouseEvent) =&gt; void, t: (key: string) =&gt; string, tagSearchQuery: string, onSetTagSearchQuery: (query: string) =&gt; void }) =&gt; {\n  const [localSearchQuery, setLocalSearchQuery] = React.useState(tagSearchQuery);\n  const [isFocused, setIsFocused] = React.useState(false);\n  \n  // 当外部tagSearchQuery变化时，更新本地状态\n  React.useEffect(() =&gt; {\n    setLocalSearchQuery(tagSearchQuery);\n  }, [tagSearchQuery]);\n  \n  // 获取所有标签列表，用于智能联想\n  const allTags = React.useMemo(() =&gt; {\n    const tagsSet = new Set&lt;string&gt;();\n    Object.values(groupedTags).forEach(tags =&gt; {\n      tags.forEach(tag =&gt; tagsSet.add(tag));\n    });\n    return Array.from(tagsSet);\n  }, [groupedTags]);\n  \n  // 过滤标签，只显示匹配搜索条件的标签\n  const filteredGroupedTags = React.useMemo(() =&gt; {\n    if (!localSearchQuery) return groupedTags;\n    \n    const filtered: Record&lt;string, string[]&gt; = {};\n    Object.entries(groupedTags).forEach(([key, tags]) =&gt; {\n      const matchingTags = tags.filter(tag =&gt; \n        tag.toLowerCase().includes(localSearchQuery.toLowerCase())\n      );\n      if (matchingTags.length &gt; 0) {\n        filtered[key] = matchingTags;\n      }\n    });\n    return filtered;\n  }, [groupedTags, localSearchQuery]);\n  \n  // 智能联想的标签列表\n  const suggestedTags = React.useMemo(() =&gt; {\n    if (!localSearchQuery || !isFocused) return [];\n    return allTags\n      .filter(tag =&gt; tag.toLowerCase().includes(localSearchQuery.toLowerCase()))\n      .sort()\n      .slice(0, 10);\n  }, [allTags, localSearchQuery, isFocused]);\n  \n  const keys = Object.keys(filteredGroupedTags).sort();\n  const totalTags = Object.values(filteredGroupedTags).reduce;\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "interface TopBarProps {",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "lineNumber": 40
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 41,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 42,
            "isSignature": true
          },
          {
            "lineNumber": 43
          },
          {
            "text": "const TagsWidget = ({ groupedTags, onTagClick, t, tagSearchQuery, onSetTagSearchQuery }: { groupedTags: Record&lt;string, string[]&gt;, onTagClick: (tag: string, e: React.MouseEvent) =&gt; void, t: (key: string) =&gt; string, tagSearchQuery: string, onSetTagSearchQuery: (query: string) =&gt; void }) =&gt; {",
            "lineNumber": 44
          },
          {
            "text": "  const [localSearchQuery, setLocalSearchQuery] = React.useState(tagSearchQuery);",
            "lineNumber": 45
          },
          {
            "text": "  const [isFocused, setIsFocused] = React.useState(false);",
            "lineNumber": 46
          },
          {
            "text": "  ",
            "lineNumber": 47
          },
          {
            "text": "  // 当外部tagSearchQuery变化时，更新本地状态",
            "lineNumber": 48
          },
          {
            "text": "  React.useEffect(() =&gt; {",
            "lineNumber": 49
          },
          {
            "text": "    setLocalSearchQuery(tagSearchQuery);",
            "lineNumber": 50
          },
          {
            "text": "  }, [tagSearchQuery]);",
            "lineNumber": 51
          },
          {
            "text": "  ",
            "lineNumber": 52
          },
          {
            "text": "  // 获取所有标签列表，用于智能联想",
            "lineNumber": 53
          },
          {
            "text": "  const allTags = React.useMemo(() =&gt; {",
            "lineNumber": 54
          },
          {
            "text": "    const tagsSet = new Set&lt;string&gt;();",
            "lineNumber": 55
          },
          {
            "text": "    Object.values(groupedTags).forEach(tags =&gt; {",
            "lineNumber": 56
          },
          {
            "text": "      tags.forEach(tag =&gt; tagsSet.add(tag));",
            "lineNumber": 57
          },
          {
            "text": "    });",
            "lineNumber": 58
          },
          {
            "text": "    return Array.from(tagsSet);",
            "lineNumber": 59
          },
          {
            "text": "  }, [groupedTags]);",
            "lineNumber": 60
          },
          {
            "text": "  ",
            "lineNumber": 61
          },
          {
            "text": "  // 过滤标签，只显示匹配搜索条件的标签",
            "lineNumber": 62
          },
          {
            "text": "  const filteredGroupedTags = React.useMemo(() =&gt; {",
            "lineNumber": 63
          },
          {
            "text": "    if (!localSearchQuery) return groupedTags;",
            "lineNumber": 64
          },
          {
            "text": "    ",
            "lineNumber": 65
          },
          {
            "text": "    const filtered: Record&lt;string, string[]&gt; = {};",
            "lineNumber": 66
          },
          {
            "text": "    Object.entries(groupedTags).forEach(([key, tags]) =&gt; {",
            "lineNumber": 67
          },
          {
            "text": "      const matchingTags = tags.filter(tag =&gt; ",
            "lineNumber": 68
          },
          {
            "text": "        tag.toLowerCase().includes(localSearchQuery.toLowerCase())",
            "lineNumber": 69
          },
          {
            "text": "      );",
            "lineNumber": 70
          },
          {
            "text": "      if (matchingTags.length &gt; 0) {",
            "lineNumber": 71
          },
          {
            "text": "        filtered[key] = matchingTags;",
            "lineNumber": 72
          },
          {
            "text": "      }",
            "lineNumber": 73
          },
          {
            "text": "    });",
            "lineNumber": 74
          },
          {
            "text": "    return filtered;",
            "lineNumber": 75
          },
          {
            "text": "  }, [groupedTags, localSearchQuery]);",
            "lineNumber": 76
          },
          {
            "text": "  ",
            "lineNumber": 77
          },
          {
            "text": "  // 智能联想的标签列表",
            "lineNumber": 78
          },
          {
            "text": "  const suggestedTags = React.useMemo(() =&gt; {",
            "lineNumber": 79
          },
          {
            "text": "    if (!localSearchQuery || !isFocused) return [];",
            "lineNumber": 80
          },
          {
            "text": "    return allTags",
            "lineNumber": 81
          },
          {
            "text": "      .filter(tag =&gt; tag.toLowerCase().includes(localSearchQuery.toLowerCase()))",
            "lineNumber": 82
          },
          {
            "text": "      .sort()",
            "lineNumber": 83
          },
          {
            "text": "      .slice(0, 10);",
            "lineNumber": 84
          },
          {
            "text": "  }, [allTags, localSearchQuery, isFocused]);",
            "lineNumber": 85
          },
          {
            "text": "  ",
            "lineNumber": 86
          },
          {
            "text": "  const keys = Object.keys(filteredGroupedTags).sort();",
            "lineNumber": 87
          },
          {
            "text": "  const totalTags = Object.values(filteredGroupedTags).reduce;",
            "lineNumber": 88
          },
          {
            "text": ";",
            "lineNumber": 196
          }
        ]
      },
      "score": 0.36543285846710205
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 444
          },
          "endPosition": {
            "line": 799,
            "column": 1
          }
        },
        "contents": "export const TopBar: React.FC&lt;TopBarProps&gt; = \n\"\n            &gt;\n              {getScopeIcon(activeTab.searchScope)}\n              &lt;ChevronDown size={12} className=\"ml-1 opacity-70\"/&gt;\n            &lt;/button&gt;\n            {scopeMenuOpen &amp;&amp; (\n              &lt;&gt;\n                &lt;div className=\"fixed inset-0 z-40\" onClick={() =&gt; setScopeMenuOpen(false)}&gt;&lt;/div&gt;\n                &lt;div className=\"absolute top-full left-0 mt-2 w-40 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl z-50 py-1 overflow-hidden animate-fade-in\"&gt;\n                  {[\n                    { id: 'all', icon: Globe, label: t('search.scopeAll') },\n                    { id: 'file', icon: FileText, label: t('search.scopeFile') },\n                    { id: 'tag', icon: Tag, label: t('search.scopeTag') },\n                    { id: 'folder', icon: Folder, label: t('search.scopeFolder') }\n                  ].map((opt) =&gt; (\n                    &lt;button\n                      key={opt.id}\n                      onClick={() =&gt; { onSearchScopeChange(opt.id as SearchScope); setScopeMenuOpen(false); }}\n                      className={&#96;w-full text-left px-3 py-2 text-xs flex items-center hover:bg-blue-50 dark:hover:bg-blue-900/20 ${activeTab.searchScope === opt.id ? 'text-blue-600 dark:text-blue-400 font-bold' : 'text-gray-700 dark:text-gray-300'}&#96;}\n                    &gt;\n                      &lt;opt.icon size={14} className=\"mr-2\"/&gt; {opt.label}\n                    &lt;/button&gt;\n                  ))}\n                &lt;/div&gt;\n              &lt;/&gt;\n            )}\n          &lt;/div&gt;\n\n          &lt;Search size={16}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 443,
                "column": 1
              },
              "endPosition": {
                "line": 443,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 8
              },
              "endPosition": {
                "line": 443,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 14
              },
              "endPosition": {
                "line": 443,
                "column": 46
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const TopBar: React.FC&lt;TopBarProps&gt; = ",
            "lineNumber": 445
          },
          {
            "text": "\"",
            "lineNumber": 534
          },
          {
            "text": "            &gt;",
            "lineNumber": 535
          },
          {
            "text": "              {getScopeIcon(activeTab.searchScope)}",
            "lineNumber": 536
          },
          {
            "text": "              &lt;ChevronDown size={12} className=\"ml-1 opacity-70\"/&gt;",
            "lineNumber": 537
          },
          {
            "text": "            &lt;/button&gt;",
            "lineNumber": 538
          },
          {
            "text": "            {scopeMenuOpen &amp;&amp; (",
            "lineNumber": 539
          },
          {
            "text": "              &lt;&gt;",
            "lineNumber": 540
          },
          {
            "text": "                &lt;div className=\"fixed inset-0 z-40\" onClick={() =&gt; setScopeMenuOpen(false)}&gt;&lt;/div&gt;",
            "lineNumber": 541
          },
          {
            "text": "                &lt;div className=\"absolute top-full left-0 mt-2 w-40 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl z-50 py-1 overflow-hidden animate-fade-in\"&gt;",
            "lineNumber": 542
          },
          {
            "text": "                  {[",
            "lineNumber": 543
          },
          {
            "text": "                    { id: 'all', icon: Globe, label: t('search.scopeAll') },",
            "lineNumber": 544
          },
          {
            "text": "                    { id: 'file', icon: FileText, label: t('search.scopeFile') },",
            "lineNumber": 545
          },
          {
            "text": "                    { id: 'tag', icon: Tag, label: t('search.scopeTag') },",
            "lineNumber": 546
          },
          {
            "text": "                    { id: 'folder', icon: Folder, label: t('search.scopeFolder') }",
            "lineNumber": 547
          },
          {
            "text": "                  ].map((opt) =&gt; (",
            "lineNumber": 548
          },
          {
            "text": "                    &lt;button",
            "lineNumber": 549
          },
          {
            "text": "                      key={opt.id}",
            "lineNumber": 550
          },
          {
            "text": "                      onClick={() =&gt; { onSearchScopeChange(opt.id as SearchScope); setScopeMenuOpen(false); }}",
            "lineNumber": 551
          },
          {
            "text": "                      className={&#96;w-full text-left px-3 py-2 text-xs flex items-center hover:bg-blue-50 dark:hover:bg-blue-900/20 ${activeTab.searchScope === opt.id ? 'text-blue-600 dark:text-blue-400 font-bold' : 'text-gray-700 dark:text-gray-300'}&#96;}",
            "lineNumber": 552
          },
          {
            "text": "                    &gt;",
            "lineNumber": 553
          },
          {
            "text": "                      &lt;opt.icon size={14} className=\"mr-2\"/&gt; {opt.label}",
            "lineNumber": 554
          },
          {
            "text": "                    &lt;/button&gt;",
            "lineNumber": 555
          },
          {
            "text": "                  ))}",
            "lineNumber": 556
          },
          {
            "text": "                &lt;/div&gt;",
            "lineNumber": 557
          },
          {
            "text": "              &lt;/&gt;",
            "lineNumber": 558
          },
          {
            "text": "            )}",
            "lineNumber": 559
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 560
          },
          {
            "lineNumber": 561
          },
          {
            "text": "          &lt;Search size={16}",
            "lineNumber": 562
          },
          {
            "text": ";",
            "lineNumber": 800
          }
        ]
      },
      "score": 0.35651683807373047
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nconst res = await \n { 'Content-Type': 'application/json' },\n                                  body: JSON.stringify(body)\n                              });\n                              const resData = await res.json();\n                              if (resData?.response) { \n                                  summary = resData.response;\n                              }\n                          } else if (aiConfig.provider === 'lmstudio') {\n                              let endpoint = aiConfig.lmstudio.endpoint.replace(/\\/+$/, '');\n                              if (!endpoint.endsWith('/v1')) endpoint += '/v1';\n                              const body = {\n                                  model: aiConfig.lmstudio.model,\n                                  messages: [{ role: \"user\", content: analysisPrompt }],\n                                  max_tokens: 1500,\n                                  temperature: 0.7,\n                                  stream: false\n                              };\n                              const res = await fetch(&#96;${endpoint}/chat/completions&#96;, {\n                                  method: 'POST',\n                                  headers: { 'Content-Type': 'application/json' },\n                                  body: JSON.stringify(body)\n                              });\n                              const resData = await res.json();\n                              if (resData?.choices?.[0]?.message?.content) { \n                                  summary = resData.choices[0].message.content;\n                              }\n                          }\n                          \n                          // If AI failed to generate analysis, fall back to a better summary that doesn't list individual images\n                          if (!summary) {\n                              const isChinese = state.settings.language === 'zh';\n                              summary = isChinese ? &#96;## 图片分析汇总\\n\\n&#96; : &#96;## Image Analysis Summary\\n\\n&#96;;\n                              \n                              // Extract all descriptions without numbering\n                              const allDescriptions = allResults\n                                  .map(r =&gt; r.description || '')\n\n;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3593
          },
          {
            "text": "const res = await ",
            "lineNumber": 4270
          },
          {
            "text": " { 'Content-Type': 'application/json' },",
            "lineNumber": 4272
          },
          {
            "text": "                                  body: JSON.stringify(body)",
            "lineNumber": 4273
          },
          {
            "text": "                              });",
            "lineNumber": 4274
          },
          {
            "text": "                              const resData = await res.json();",
            "lineNumber": 4275
          },
          {
            "text": "                              if (resData?.response) { ",
            "lineNumber": 4276
          },
          {
            "text": "                                  summary = resData.response;",
            "lineNumber": 4277
          },
          {
            "text": "                              }",
            "lineNumber": 4278
          },
          {
            "text": "                          } else if (aiConfig.provider === 'lmstudio') {",
            "lineNumber": 4279
          },
          {
            "text": "                              let endpoint = aiConfig.lmstudio.endpoint.replace(/\\/+$/, '');",
            "lineNumber": 4280
          },
          {
            "text": "                              if (!endpoint.endsWith('/v1')) endpoint += '/v1';",
            "lineNumber": 4281
          },
          {
            "text": "                              const body = {",
            "lineNumber": 4282
          },
          {
            "text": "                                  model: aiConfig.lmstudio.model,",
            "lineNumber": 4283
          },
          {
            "text": "                                  messages: [{ role: \"user\", content: analysisPrompt }],",
            "lineNumber": 4284
          },
          {
            "text": "                                  max_tokens: 1500,",
            "lineNumber": 4285
          },
          {
            "text": "                                  temperature: 0.7,",
            "lineNumber": 4286
          },
          {
            "text": "                                  stream: false",
            "lineNumber": 4287
          },
          {
            "text": "                              };",
            "lineNumber": 4288
          },
          {
            "text": "                              const res = await fetch(&#96;${endpoint}/chat/completions&#96;, {",
            "lineNumber": 4289
          },
          {
            "text": "                                  method: 'POST',",
            "lineNumber": 4290
          },
          {
            "text": "                                  headers: { 'Content-Type': 'application/json' },",
            "lineNumber": 4291
          },
          {
            "text": "                                  body: JSON.stringify(body)",
            "lineNumber": 4292
          },
          {
            "text": "                              });",
            "lineNumber": 4293
          },
          {
            "text": "                              const resData = await res.json();",
            "lineNumber": 4294
          },
          {
            "text": "                              if (resData?.choices?.[0]?.message?.content) { ",
            "lineNumber": 4295
          },
          {
            "text": "                                  summary = resData.choices[0].message.content;",
            "lineNumber": 4296
          },
          {
            "text": "                              }",
            "lineNumber": 4297
          },
          {
            "text": "                          }",
            "lineNumber": 4298
          },
          {
            "text": "                          ",
            "lineNumber": 4299
          },
          {
            "text": "                          // If AI failed to generate analysis, fall back to a better summary that doesn't list individual images",
            "lineNumber": 4300
          },
          {
            "text": "                          if (!summary) {",
            "lineNumber": 4301
          },
          {
            "text": "                              const isChinese = state.settings.language === 'zh';",
            "lineNumber": 4302
          },
          {
            "text": "                              summary = isChinese ? &#96;## 图片分析汇总\\n\\n&#96; : &#96;## Image Analysis Summary\\n\\n&#96;;",
            "lineNumber": 4303
          },
          {
            "text": "                              ",
            "lineNumber": 4304
          },
          {
            "text": "                              // Extract all descriptions without numbering",
            "lineNumber": 4305
          },
          {
            "text": "                              const allDescriptions = allResults",
            "lineNumber": 4306
          },
          {
            "text": "                                  .map(r =&gt; r.description || '')",
            "lineNumber": 4307
          },
          {
            "lineNumber": 4308
          },
          {
            "text": ";",
            "lineNumber": 4309
          },
          {
            "text": ";",
            "lineNumber": 4386
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.355566143989563
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 43
          },
          "endPosition": {
            "line": 195,
            "column": 1
          }
        },
        "contents": "const TagsWidget = \n\n            className=\"w-full pl-8 pr-2 py-1.5 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          /&gt;\n          {localSearchQuery &amp;&amp; (\n            &lt;button\n              onClick={() =&gt; {\n                setLocalSearchQuery('');\n                onSetTagSearchQuery('');\n              }}\n              className=\"absolute right-2.5 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n            &gt;\n              &lt;X size={14} /&gt;\n            &lt;/button&gt;\n          )}\n          \n          {/* 智能联想下拉列表 */}\n          {suggestedTags.length &gt; 0 &amp;&amp; (\n            &lt;div className=\"absolute top-full left-0 right-0 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 mt-1 rounded-lg shadow-xl z-50 max-h-40 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600\"&gt;\n              {suggestedTags.map(tag =&gt; (\n                &lt;div \n                  key={tag} \n                  className=\"px-4 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 text-sm cursor-pointer text-gray-800 dark:text-gray-200\"\n                  onClick={() =&gt; {\n                    setLocalSearchQuery(tag);\n                    onSetTagSearchQuery(tag);\n                  }}\n                &gt;\n                  {tag}\n                &lt;/div&gt;\n              ))}\n            &lt;/div&gt;\n          )}\n        &lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div className=\"flex-1 flex overflow-hidden\"&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 42,
                "column": 1
              },
              "endPosition": {
                "line": 42,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 42,
                "column": 7
              },
              "endPosition": {
                "line": 42,
                "column": 20
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsWidget = ",
            "lineNumber": 44
          },
          {
            "lineNumber": 115
          },
          {
            "text": "            className=\"w-full pl-8 pr-2 py-1.5 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"",
            "lineNumber": 116
          },
          {
            "text": "          /&gt;",
            "lineNumber": 117
          },
          {
            "text": "          {localSearchQuery &amp;&amp; (",
            "lineNumber": 118
          },
          {
            "text": "            &lt;button",
            "lineNumber": 119
          },
          {
            "text": "              onClick={() =&gt; {",
            "lineNumber": 120
          },
          {
            "text": "                setLocalSearchQuery('');",
            "lineNumber": 121
          },
          {
            "text": "                onSetTagSearchQuery('');",
            "lineNumber": 122
          },
          {
            "text": "              }}",
            "lineNumber": 123
          },
          {
            "text": "              className=\"absolute right-2.5 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"",
            "lineNumber": 124
          },
          {
            "text": "            &gt;",
            "lineNumber": 125
          },
          {
            "text": "              &lt;X size={14} /&gt;",
            "lineNumber": 126
          },
          {
            "text": "            &lt;/button&gt;",
            "lineNumber": 127
          },
          {
            "text": "          )}",
            "lineNumber": 128
          },
          {
            "text": "          ",
            "lineNumber": 129
          },
          {
            "text": "          {/* 智能联想下拉列表 */}",
            "lineNumber": 130
          },
          {
            "text": "          {suggestedTags.length &gt; 0 &amp;&amp; (",
            "lineNumber": 131
          },
          {
            "text": "            &lt;div className=\"absolute top-full left-0 right-0 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 mt-1 rounded-lg shadow-xl z-50 max-h-40 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600\"&gt;",
            "lineNumber": 132
          },
          {
            "text": "              {suggestedTags.map(tag =&gt; (",
            "lineNumber": 133
          },
          {
            "text": "                &lt;div ",
            "lineNumber": 134
          },
          {
            "text": "                  key={tag} ",
            "lineNumber": 135
          },
          {
            "text": "                  className=\"px-4 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 text-sm cursor-pointer text-gray-800 dark:text-gray-200\"",
            "lineNumber": 136
          },
          {
            "text": "                  onClick={() =&gt; {",
            "lineNumber": 137
          },
          {
            "text": "                    setLocalSearchQuery(tag);",
            "lineNumber": 138
          },
          {
            "text": "                    onSetTagSearchQuery(tag);",
            "lineNumber": 139
          },
          {
            "text": "                  }}",
            "lineNumber": 140
          },
          {
            "text": "                &gt;",
            "lineNumber": 141
          },
          {
            "text": "                  {tag}",
            "lineNumber": 142
          },
          {
            "text": "                &lt;/div&gt;",
            "lineNumber": 143
          },
          {
            "text": "              ))}",
            "lineNumber": 144
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 145
          },
          {
            "text": "          )}",
            "lineNumber": 146
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 147
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 148
          },
          {
            "text": "      &lt;div className=\"flex-1 flex overflow-hidden\"&gt;",
            "lineNumber": 149
          },
          {
            "text": ";",
            "lineNumber": 196
          }
        ]
      },
      "score": 0.3501431941986084
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst goForward = \n(prevTab =&gt; { \n          if (prevTab.history.currentIndex &lt; prevTab.history.stack.length - 1) { \n              const newIndex = prevTab.history.currentIndex + 1; \n              const step = prevTab.history.stack[newIndex]; \n              return { folderId: step.folderId, viewingFileId: step.viewingId, viewMode: step.viewMode, searchQuery: step.searchQuery, searchScope: step.searchScope, activeTags: step.activeTags || [], activePersonId: step.activePersonId, aiFilter: step.aiFilter, scrollTop: step.scrollTop || 0, selectedFileIds: step.viewingId ? [step.viewingId] : [], selectedPersonIds: [], selectedTagIds: [], history: { ...prevTab.history, currentIndex: newIndex } }; \n          } \n          return {}; \n      }); \n  };\n  \n  const closeViewer = () =&gt; { \n      if (activeTab.history.stack[activeTab.history.currentIndex].viewingId) { \n          pushHistory(activeTab.folderId, null, activeTab.viewMode, activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, activeTab.activePersonId, activeTab.scrollTop, activeTab.aiFilter); \n      } else { \n          updateActiveTab({ viewingFileId: null }); \n      } \n  };\n  \n  const enterViewer = (fileId: string) =&gt; {\n      const scrollTop = selectionRef.current?.scrollTop || 0;\n      pushHistory(activeTab.folderId, fileId, 'browser', activeTab.searchQuery\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const goForward = ",
            "lineNumber": 2880
          },
          {
            "text": "(prevTab =&gt; { ",
            "lineNumber": 2881
          },
          {
            "text": "          if (prevTab.history.currentIndex &lt; prevTab.history.stack.length - 1) { ",
            "lineNumber": 2882
          },
          {
            "text": "              const newIndex = prevTab.history.currentIndex + 1; ",
            "lineNumber": 2883
          },
          {
            "text": "              const step = prevTab.history.stack[newIndex]; ",
            "lineNumber": 2884
          },
          {
            "text": "              return { folderId: step.folderId, viewingFileId: step.viewingId, viewMode: step.viewMode, searchQuery: step.searchQuery, searchScope: step.searchScope, activeTags: step.activeTags || [], activePersonId: step.activePersonId, aiFilter: step.aiFilter, scrollTop: step.scrollTop || 0, selectedFileIds: step.viewingId ? [step.viewingId] : [], selectedPersonIds: [], selectedTagIds: [], history: { ...prevTab.history, currentIndex: newIndex } }; ",
            "lineNumber": 2885
          },
          {
            "text": "          } ",
            "lineNumber": 2886
          },
          {
            "text": "          return {}; ",
            "lineNumber": 2887
          },
          {
            "text": "      }); ",
            "lineNumber": 2888
          },
          {
            "text": "  };",
            "lineNumber": 2889
          },
          {
            "text": "  ",
            "lineNumber": 2890
          },
          {
            "text": "  const closeViewer = () =&gt; { ",
            "lineNumber": 2891
          },
          {
            "text": "      if (activeTab.history.stack[activeTab.history.currentIndex].viewingId) { ",
            "lineNumber": 2892
          },
          {
            "text": "          pushHistory(activeTab.folderId, null, activeTab.viewMode, activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, activeTab.activePersonId, activeTab.scrollTop, activeTab.aiFilter); ",
            "lineNumber": 2893
          },
          {
            "text": "      } else { ",
            "lineNumber": 2894
          },
          {
            "text": "          updateActiveTab({ viewingFileId: null }); ",
            "lineNumber": 2895
          },
          {
            "text": "      } ",
            "lineNumber": 2896
          },
          {
            "text": "  };",
            "lineNumber": 2897
          },
          {
            "text": "  ",
            "lineNumber": 2898
          },
          {
            "text": "  const enterViewer = (fileId: string) =&gt; {",
            "lineNumber": 2899
          },
          {
            "text": "      const scrollTop = selectionRef.current?.scrollTop || 0;",
            "lineNumber": 2900
          },
          {
            "text": "      pushHistory(activeTab.folderId, fileId, 'browser', activeTab.searchQuery",
            "lineNumber": 2901
          },
          {
            "text": ";",
            "lineNumber": 2902
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3485548496246338
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n() =&gt; {\n\n\n    return () =&gt; {\n      container.removeEventListener('wheel', handleWheel);\n    };\n  }, [slideshowActive]);\n\n  useEffect(() =&gt; {\n    let intervalId: ReturnType&lt;typeof setTimeout&gt;;\n    if (slideshowActive) {\n      intervalId = setInterval(() =&gt; {\n        onNext(slideshowConfig.isRandom);\n      }, slideshowConfig.interval);\n    }\n    return () =&gt; clearInterval(intervalId);\n  }, [slideshowActive, onNext, slideshowConfig]);\n\n  const toggleFullscreen = async () =&gt; {\n    if (!document.fullscreenElement) {\n      await rootRef.current?.requestFullscreen();\n      setIsFullscreen(true);\n    } else {\n      await document.exitFullscreen();\n      setIsFullscreen(false);\n    }\n  };\n\n  const handleSearchSubmit = () =&gt; {\n    onSearch(localQuery);\n  };\n\n  const toggleScopeMenu = (e: React.MouseEvent) =&gt; {\n    e.stopPropagation();\n    if (!scopeMenuOpen &amp;&amp; scopeBtnRef.current) {\n       const rect = scopeBtnRef.current.getBoundingClientRect();\n       setScopeMenuPos({ top: rect.bottom + 8, left: rect.left });\n    }\n    setScopeMenuOpen(!scopeMenuOpen);\n  };\n\n  const handleCopyImage = async () =&gt; {\n      try {\n          if (!file.path) return;\n          \n          // Read file as base64 and convert to blob\n          const { readFileAsBase64 } = await import('../api/tauri-bridge');\n          const dataUrl = await readFileAsBase64(file.path);\n          if (!dataUrl) return;\n          \n          // Convert data URL to blob\n          const response = await fetch(dataUrl);\n          const blob = await response.blob();\n          await navigator.clipboard.write([\n              new ClipboardItem({\n                  [blob.type]: blob\n              })\n          ]);\n      } catch (err) {\n          console.error('Failed to copy image: ', err);\n      }\n  };\n\n  useEffect(() =&gt; {\n    const handleKeyDown = (e: KeyboardEvent) =&gt; {\n      if (showSearch &amp;&amp; document.activeElement === searchInputRef.current)\n;\n  }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 253
          },
          {
            "lineNumber": 275
          },
          {
            "lineNumber": 276
          },
          {
            "text": "    return () =&gt; {",
            "lineNumber": 277
          },
          {
            "text": "      container.removeEventListener('wheel', handleWheel);",
            "lineNumber": 278
          },
          {
            "text": "    };",
            "lineNumber": 279
          },
          {
            "text": "  }, [slideshowActive]);",
            "lineNumber": 280
          },
          {
            "lineNumber": 281
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 282
          },
          {
            "text": "    let intervalId: ReturnType&lt;typeof setTimeout&gt;;",
            "lineNumber": 283
          },
          {
            "text": "    if (slideshowActive) {",
            "lineNumber": 284
          },
          {
            "text": "      intervalId = setInterval(() =&gt; {",
            "lineNumber": 285
          },
          {
            "text": "        onNext(slideshowConfig.isRandom);",
            "lineNumber": 286
          },
          {
            "text": "      }, slideshowConfig.interval);",
            "lineNumber": 287
          },
          {
            "text": "    }",
            "lineNumber": 288
          },
          {
            "text": "    return () =&gt; clearInterval(intervalId);",
            "lineNumber": 289
          },
          {
            "text": "  }, [slideshowActive, onNext, slideshowConfig]);",
            "lineNumber": 290
          },
          {
            "lineNumber": 291
          },
          {
            "text": "  const toggleFullscreen = async () =&gt; {",
            "lineNumber": 292
          },
          {
            "text": "    if (!document.fullscreenElement) {",
            "lineNumber": 293
          },
          {
            "text": "      await rootRef.current?.requestFullscreen();",
            "lineNumber": 294
          },
          {
            "text": "      setIsFullscreen(true);",
            "lineNumber": 295
          },
          {
            "text": "    } else {",
            "lineNumber": 296
          },
          {
            "text": "      await document.exitFullscreen();",
            "lineNumber": 297
          },
          {
            "text": "      setIsFullscreen(false);",
            "lineNumber": 298
          },
          {
            "text": "    }",
            "lineNumber": 299
          },
          {
            "text": "  };",
            "lineNumber": 300
          },
          {
            "lineNumber": 301
          },
          {
            "text": "  const handleSearchSubmit = () =&gt; {",
            "lineNumber": 302
          },
          {
            "text": "    onSearch(localQuery);",
            "lineNumber": 303
          },
          {
            "text": "  };",
            "lineNumber": 304
          },
          {
            "lineNumber": 305
          },
          {
            "text": "  const toggleScopeMenu = (e: React.MouseEvent) =&gt; {",
            "lineNumber": 306
          },
          {
            "text": "    e.stopPropagation();",
            "lineNumber": 307
          },
          {
            "text": "    if (!scopeMenuOpen &amp;&amp; scopeBtnRef.current) {",
            "lineNumber": 308
          },
          {
            "text": "       const rect = scopeBtnRef.current.getBoundingClientRect();",
            "lineNumber": 309
          },
          {
            "text": "       setScopeMenuPos({ top: rect.bottom + 8, left: rect.left });",
            "lineNumber": 310
          },
          {
            "text": "    }",
            "lineNumber": 311
          },
          {
            "text": "    setScopeMenuOpen(!scopeMenuOpen);",
            "lineNumber": 312
          },
          {
            "text": "  };",
            "lineNumber": 313
          },
          {
            "lineNumber": 314
          },
          {
            "text": "  const handleCopyImage = async () =&gt; {",
            "lineNumber": 315
          },
          {
            "text": "      try {",
            "lineNumber": 316
          },
          {
            "text": "          if (!file.path) return;",
            "lineNumber": 317
          },
          {
            "text": "          ",
            "lineNumber": 318
          },
          {
            "text": "          // Read file as base64 and convert to blob",
            "lineNumber": 319
          },
          {
            "text": "          const { readFileAsBase64 } = await import('../api/tauri-bridge');",
            "lineNumber": 320
          },
          {
            "text": "          const dataUrl = await readFileAsBase64(file.path);",
            "lineNumber": 321
          },
          {
            "text": "          if (!dataUrl) return;",
            "lineNumber": 322
          },
          {
            "text": "          ",
            "lineNumber": 323
          },
          {
            "text": "          // Convert data URL to blob",
            "lineNumber": 324
          },
          {
            "text": "          const response = await fetch(dataUrl);",
            "lineNumber": 325
          },
          {
            "text": "          const blob = await response.blob();",
            "lineNumber": 326
          },
          {
            "text": "          await navigator.clipboard.write([",
            "lineNumber": 327
          },
          {
            "text": "              new ClipboardItem({",
            "lineNumber": 328
          },
          {
            "text": "                  [blob.type]: blob",
            "lineNumber": 329
          },
          {
            "text": "              })",
            "lineNumber": 330
          },
          {
            "text": "          ]);",
            "lineNumber": 331
          },
          {
            "text": "      } catch (err) {",
            "lineNumber": 332
          },
          {
            "text": "          console.error('Failed to copy image: ', err);",
            "lineNumber": 333
          },
          {
            "text": "      }",
            "lineNumber": 334
          },
          {
            "text": "  };",
            "lineNumber": 335
          },
          {
            "lineNumber": 336
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 337
          },
          {
            "text": "    const handleKeyDown = (e: KeyboardEvent) =&gt; {",
            "lineNumber": 338
          },
          {
            "text": "      if (showSearch &amp;&amp; document.activeElement === searchInputRef.current)",
            "lineNumber": 339
          },
          {
            "text": ";",
            "lineNumber": 356
          },
          {
            "text": "  }",
            "lineNumber": 359
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.3389849066734314
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleRefresh = async \nprev =&gt; {\n\n                  // Add a lastRefresh timestamp to force a re-render\n                  lastRefresh: Date.now()\n              };\n              \n              return { ...prev, files };\n          });\n      }\n  };\n\n  // ... (keep drag and drop, clicks, etc.)\n  // Drag over handler for the main container\n  const handleDragOver = (e: React.DragEvent) =&gt; {\n      e.preventDefault();\n      // 避免在此处使用 e.stopPropagation()，因为这会阻止事件流向子组件，导致子组件的拖拽逻辑失效 (如文件夹高亮)。\n\n      // Only show overlay for file browser view mode\n      if (activeTab.viewMode !== 'browser') {\n          if (isDragOver) {\n              setIsDragOver(false);\n          }\n          return;\n      }\n\n      // 1. 【内部拖拽检查】: 如果是内部拖拽，强制保持外部界面隐藏\n      if (isInternalDragRef.current) {\n          // 关键：如果状态已经是 isDragOver=true，则立即关闭它，防止闪烁\n          if (isDragOver) {\n              setIsDragOver(false);\n          }\n          // 允许事件向下传递，但不再执行下面的外部拖拽检测逻辑\n          return;\n      }\n\n      // 2. 【外部拖拽检查】: 检查是否有 Files 类型\n      if (e.dataTransfer.types.includes('Files')) {\n          // 关键：只有状态是 false 时才设置为 true，减少不必要的 state 更新\n          if (!isDragOver) {\n              setIsDragOver(true);\n          }\n          \n          // 计算复制/移动动作的逻辑\n          const container = e.currentTarget as HTMLElement;\n          const rect = container.getBoundingClientRect();\n          const x = e.clientX - rect.left;\n          if (x &lt; rect.width / 2) setDragAction('copy');\n          else setDragAction('move');\n          \n      } else {\n          // 如果拖拽的内容不是文件 (例如：拖拽文本或URL)\n          // 关键：只有状态是 true 时才设置为 false\n          if (isDragOver) {\n              setIsDragOver(false);\n          }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 3
              },
              "endPosition": {
                "line": 1305,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 9
              },
              "endPosition": {
                "line": 1305,
                "column": 26
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 34
              },
              "endPosition": {
                "line": 1306,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 1412,
                "column": 22
              },
              "endPosition": {
                "line": 1412,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 1412,
                "column": 40
              },
              "endPosition": {
                "line": 1413,
                "column": 13
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleRefresh = async ",
            "lineNumber": 1346
          },
          {
            "text": "prev =&gt; {",
            "lineNumber": 1409
          },
          {
            "lineNumber": 1413
          },
          {
            "text": "                  // Add a lastRefresh timestamp to force a re-render",
            "lineNumber": 1414
          },
          {
            "text": "                  lastRefresh: Date.now()",
            "lineNumber": 1415
          },
          {
            "text": "              };",
            "lineNumber": 1416
          },
          {
            "text": "              ",
            "lineNumber": 1417
          },
          {
            "text": "              return { ...prev, files };",
            "lineNumber": 1418
          },
          {
            "text": "          });",
            "lineNumber": 1419
          },
          {
            "text": "      }",
            "lineNumber": 1420
          },
          {
            "text": "  };",
            "lineNumber": 1421
          },
          {
            "lineNumber": 1422
          },
          {
            "text": "  // ... (keep drag and drop, clicks, etc.)",
            "lineNumber": 1423
          },
          {
            "text": "  // Drag over handler for the main container",
            "lineNumber": 1424
          },
          {
            "text": "  const handleDragOver = (e: React.DragEvent) =&gt; {",
            "lineNumber": 1425
          },
          {
            "text": "      e.preventDefault();",
            "lineNumber": 1426
          },
          {
            "text": "      // 避免在此处使用 e.stopPropagation()，因为这会阻止事件流向子组件，导致子组件的拖拽逻辑失效 (如文件夹高亮)。",
            "lineNumber": 1427
          },
          {
            "lineNumber": 1428
          },
          {
            "text": "      // Only show overlay for file browser view mode",
            "lineNumber": 1429
          },
          {
            "text": "      if (activeTab.viewMode !== 'browser') {",
            "lineNumber": 1430
          },
          {
            "text": "          if (isDragOver) {",
            "lineNumber": 1431
          },
          {
            "text": "              setIsDragOver(false);",
            "lineNumber": 1432
          },
          {
            "text": "          }",
            "lineNumber": 1433
          },
          {
            "text": "          return;",
            "lineNumber": 1434
          },
          {
            "text": "      }",
            "lineNumber": 1435
          },
          {
            "lineNumber": 1436
          },
          {
            "text": "      // 1. 【内部拖拽检查】: 如果是内部拖拽，强制保持外部界面隐藏",
            "lineNumber": 1437
          },
          {
            "text": "      if (isInternalDragRef.current) {",
            "lineNumber": 1438
          },
          {
            "text": "          // 关键：如果状态已经是 isDragOver=true，则立即关闭它，防止闪烁",
            "lineNumber": 1439
          },
          {
            "text": "          if (isDragOver) {",
            "lineNumber": 1440
          },
          {
            "text": "              setIsDragOver(false);",
            "lineNumber": 1441
          },
          {
            "text": "          }",
            "lineNumber": 1442
          },
          {
            "text": "          // 允许事件向下传递，但不再执行下面的外部拖拽检测逻辑",
            "lineNumber": 1443
          },
          {
            "text": "          return;",
            "lineNumber": 1444
          },
          {
            "text": "      }",
            "lineNumber": 1445
          },
          {
            "lineNumber": 1446
          },
          {
            "text": "      // 2. 【外部拖拽检查】: 检查是否有 Files 类型",
            "lineNumber": 1447
          },
          {
            "text": "      if (e.dataTransfer.types.includes('Files')) {",
            "lineNumber": 1448
          },
          {
            "text": "          // 关键：只有状态是 false 时才设置为 true，减少不必要的 state 更新",
            "lineNumber": 1449
          },
          {
            "text": "          if (!isDragOver) {",
            "lineNumber": 1450
          },
          {
            "text": "              setIsDragOver(true);",
            "lineNumber": 1451
          },
          {
            "text": "          }",
            "lineNumber": 1452
          },
          {
            "text": "          ",
            "lineNumber": 1453
          },
          {
            "text": "          // 计算复制/移动动作的逻辑",
            "lineNumber": 1454
          },
          {
            "text": "          const container = e.currentTarget as HTMLElement;",
            "lineNumber": 1455
          },
          {
            "text": "          const rect = container.getBoundingClientRect();",
            "lineNumber": 1456
          },
          {
            "text": "          const x = e.clientX - rect.left;",
            "lineNumber": 1457
          },
          {
            "text": "          if (x &lt; rect.width / 2) setDragAction('copy');",
            "lineNumber": 1458
          },
          {
            "text": "          else setDragAction('move');",
            "lineNumber": 1459
          },
          {
            "text": "          ",
            "lineNumber": 1460
          },
          {
            "text": "      } else {",
            "lineNumber": 1461
          },
          {
            "text": "          // 如果拖拽的内容不是文件 (例如：拖拽文本或URL)",
            "lineNumber": 1462
          },
          {
            "text": "          // 关键：只有状态是 true 时才设置为 false",
            "lineNumber": 1463
          },
          {
            "text": "          if (isDragOver) {",
            "lineNumber": 1464
          },
          {
            "text": "              setIsDragOver(false);",
            "lineNumber": 1465
          },
          {
            "text": "          }",
            "lineNumber": 1466
          },
          {
            "text": ";",
            "lineNumber": 1468
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.33590778708457947
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n\n          &lt;/div&gt;\n\n          &lt;button onClick={handleOriginalSize} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('viewer.original')}&gt;\n             &lt;span className=\"text-xs font-bold\"&gt;1:1&lt;/span&gt;\n          &lt;/button&gt;\n          &lt;button onClick={handleReset} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400\" title={t('viewer.fit')}&gt;\n            &lt;Maximize size={18} /&gt;\n          &lt;/button&gt;\n          &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1 hidden sm:block\"&gt;&lt;/div&gt;\n          &lt;button onClick={() =&gt; rotate(-90)} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('viewer.rotateLeft')}&gt;\n            &lt;RotateCcw size={18} /&gt;\n          &lt;/button&gt;\n          &lt;button onClick={() =&gt; rotate(90)} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('viewer.rotateRight')}&gt;\n            &lt;RotateCw size={18} /&gt;\n          &lt;/button&gt;\n          &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;\n          \n          &lt;button \n            onClick={() =&gt; setShowSearch(!showSearch)} \n            className={&#96;p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 ${showSearch || localQuery ? 'text-blue-500 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}&#96;} \n            title={t('viewer.search')}\n          &gt;\n            &lt;Search size={18} /&gt;\n          &lt;/button&gt;\n          \n          &lt;button \n            onClick={() =&gt; onLayoutToggle('metadata')}\n            className={&#96;p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 ${layout.isMetadataVisible ? 'text-blue-500 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}&#96;}\n            title={t('viewer.toggleMeta')}\n          &gt;\n            &lt;PanelRight size={18} /&gt;\n          &lt;/button&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n\n      &lt;div \n        ref={containerRef}\n        className={&#96;flex-1 overflow-hidden relative cursor-grab active:cursor-grabbing transition-colors duration-300 \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "lineNumber": 545
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 546
          },
          {
            "lineNumber": 547
          },
          {
            "text": "          &lt;button onClick={handleOriginalSize} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('viewer.original')}&gt;",
            "lineNumber": 548
          },
          {
            "text": "             &lt;span className=\"text-xs font-bold\"&gt;1:1&lt;/span&gt;",
            "lineNumber": 549
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 550
          },
          {
            "text": "          &lt;button onClick={handleReset} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400\" title={t('viewer.fit')}&gt;",
            "lineNumber": 551
          },
          {
            "text": "            &lt;Maximize size={18} /&gt;",
            "lineNumber": 552
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 553
          },
          {
            "text": "          &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1 hidden sm:block\"&gt;&lt;/div&gt;",
            "lineNumber": 554
          },
          {
            "text": "          &lt;button onClick={() =&gt; rotate(-90)} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('viewer.rotateLeft')}&gt;",
            "lineNumber": 555
          },
          {
            "text": "            &lt;RotateCcw size={18} /&gt;",
            "lineNumber": 556
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 557
          },
          {
            "text": "          &lt;button onClick={() =&gt; rotate(90)} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('viewer.rotateRight')}&gt;",
            "lineNumber": 558
          },
          {
            "text": "            &lt;RotateCw size={18} /&gt;",
            "lineNumber": 559
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 560
          },
          {
            "text": "          &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;",
            "lineNumber": 561
          },
          {
            "text": "          ",
            "lineNumber": 562
          },
          {
            "text": "          &lt;button ",
            "lineNumber": 563
          },
          {
            "text": "            onClick={() =&gt; setShowSearch(!showSearch)} ",
            "lineNumber": 564
          },
          {
            "text": "            className={&#96;p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 ${showSearch || localQuery ? 'text-blue-500 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}&#96;} ",
            "lineNumber": 565
          },
          {
            "text": "            title={t('viewer.search')}",
            "lineNumber": 566
          },
          {
            "text": "          &gt;",
            "lineNumber": 567
          },
          {
            "text": "            &lt;Search size={18} /&gt;",
            "lineNumber": 568
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 569
          },
          {
            "text": "          ",
            "lineNumber": 570
          },
          {
            "text": "          &lt;button ",
            "lineNumber": 571
          },
          {
            "text": "            onClick={() =&gt; onLayoutToggle('metadata')}",
            "lineNumber": 572
          },
          {
            "text": "            className={&#96;p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 ${layout.isMetadataVisible ? 'text-blue-500 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}&#96;}",
            "lineNumber": 573
          },
          {
            "text": "            title={t('viewer.toggleMeta')}",
            "lineNumber": 574
          },
          {
            "text": "          &gt;",
            "lineNumber": 575
          },
          {
            "text": "            &lt;PanelRight size={18} /&gt;",
            "lineNumber": 576
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 577
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 578
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 579
          },
          {
            "lineNumber": 580
          },
          {
            "text": "      &lt;div ",
            "lineNumber": 581
          },
          {
            "text": "        ref={containerRef}",
            "lineNumber": 582
          },
          {
            "text": "        className={&#96;flex-1 overflow-hidden relative cursor-grab active:cursor-grabbing transition-colors duration-300 ",
            "lineNumber": 583
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.33396080136299133
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 1,
            "column": 68
          },
          "endPosition": {
            "line": 41,
            "column": 1
          }
        },
        "contents": "import { TabState, AppState, SearchScope, LayoutMode, SortOption, DateFilter, GroupByOption } from '../types';\nimport { \n  Sidebar, ChevronLeft, ChevronRight, ArrowUp, RefreshCw, \n  Search, Sliders, Filter, LayoutGrid, List, Grid, LayoutTemplate, \n  ArrowDownUp, Calendar, PanelRight, X, Brain, Tag, \n  FileText, Folder, Globe, ChevronDown, Check, Sun, Moon, Monitor,\n  ChevronUp\n} from 'lucide-react';\n\ninterface TopBarProps {\n  activeTab: TabState;\n  state: AppState;\n  toolbarQuery: string;\n  groupedTags: Record&lt;string, string[]&gt;;\n  tagSearchQuery: string;\n  onToggleSidebar: () =&gt; void;\n  onGoBack: () =&gt; void;\n  onGoForward: () =&gt; void;\n  onNavigateUp: () =&gt; void;\n  onSetTagSearchQuery: (query: string) =&gt; void;\n  onTagClick: (tag: string, e: React.MouseEvent) =&gt; void;\n  onRefresh: () =&gt; void;\n  onSearchScopeChange: (scope: SearchScope) =&gt; void;\n  onPerformSearch: (query: string) =&gt; void;\n  onSetToolbarQuery: (query: string) =&gt; void;\n  onLayoutModeChange: (mode: LayoutMode) =&gt; void;\n  onSortOptionChange: (option: SortOption) =&gt; void;\n  onSortDirectionChange: () =&gt; void;\n  onThumbnailSizeChange: (size: number) =&gt; void;\n  onToggleMetadata: () =&gt; void;\n  onToggleSettings: () =&gt; void;\n  onUpdateDateFilter: (filter: DateFilter) =&gt; void;\n  groupBy: GroupByOption;\n  onGroupByChange: (option: GroupByOption) =&gt; void;\n  isAISearchEnabled: boolean;\n  onToggleAISearch: () =&gt; void;\n  onRememberFolderSettings?: () =&gt; void;\n  hasFolderSettings?: boolean;\n  t: (key: string) =&gt; string;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import { TabState, AppState, SearchScope, LayoutMode, SortOption, DateFilter, GroupByOption } from '../types';",
            "lineNumber": 3
          },
          {
            "text": "import { ",
            "lineNumber": 4
          },
          {
            "text": "  Sidebar, ChevronLeft, ChevronRight, ArrowUp, RefreshCw, ",
            "lineNumber": 5
          },
          {
            "text": "  Search, Sliders, Filter, LayoutGrid, List, Grid, LayoutTemplate, ",
            "lineNumber": 6
          },
          {
            "text": "  ArrowDownUp, Calendar, PanelRight, X, Brain, Tag, ",
            "lineNumber": 7
          },
          {
            "text": "  FileText, Folder, Globe, ChevronDown, Check, Sun, Moon, Monitor,",
            "lineNumber": 8
          },
          {
            "text": "  ChevronUp",
            "lineNumber": 9
          },
          {
            "text": "} from 'lucide-react';",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "interface TopBarProps {",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "text": "  activeTab: TabState;",
            "lineNumber": 13
          },
          {
            "text": "  state: AppState;",
            "lineNumber": 14
          },
          {
            "text": "  toolbarQuery: string;",
            "lineNumber": 15
          },
          {
            "text": "  groupedTags: Record&lt;string, string[]&gt;;",
            "lineNumber": 16
          },
          {
            "text": "  tagSearchQuery: string;",
            "lineNumber": 17
          },
          {
            "text": "  onToggleSidebar: () =&gt; void;",
            "lineNumber": 18
          },
          {
            "text": "  onGoBack: () =&gt; void;",
            "lineNumber": 19
          },
          {
            "text": "  onGoForward: () =&gt; void;",
            "lineNumber": 20
          },
          {
            "text": "  onNavigateUp: () =&gt; void;",
            "lineNumber": 21
          },
          {
            "text": "  onSetTagSearchQuery: (query: string) =&gt; void;",
            "lineNumber": 22
          },
          {
            "text": "  onTagClick: (tag: string, e: React.MouseEvent) =&gt; void;",
            "lineNumber": 23
          },
          {
            "text": "  onRefresh: () =&gt; void;",
            "lineNumber": 24
          },
          {
            "text": "  onSearchScopeChange: (scope: SearchScope) =&gt; void;",
            "lineNumber": 25
          },
          {
            "text": "  onPerformSearch: (query: string) =&gt; void;",
            "lineNumber": 26
          },
          {
            "text": "  onSetToolbarQuery: (query: string) =&gt; void;",
            "lineNumber": 27
          },
          {
            "text": "  onLayoutModeChange: (mode: LayoutMode) =&gt; void;",
            "lineNumber": 28
          },
          {
            "text": "  onSortOptionChange: (option: SortOption) =&gt; void;",
            "lineNumber": 29
          },
          {
            "text": "  onSortDirectionChange: () =&gt; void;",
            "lineNumber": 30
          },
          {
            "text": "  onThumbnailSizeChange: (size: number) =&gt; void;",
            "lineNumber": 31
          },
          {
            "text": "  onToggleMetadata: () =&gt; void;",
            "lineNumber": 32
          },
          {
            "text": "  onToggleSettings: () =&gt; void;",
            "lineNumber": 33
          },
          {
            "text": "  onUpdateDateFilter: (filter: DateFilter) =&gt; void;",
            "lineNumber": 34
          },
          {
            "text": "  groupBy: GroupByOption;",
            "lineNumber": 35
          },
          {
            "text": "  onGroupByChange: (option: GroupByOption) =&gt; void;",
            "lineNumber": 36
          },
          {
            "text": "  isAISearchEnabled: boolean;",
            "lineNumber": 37
          },
          {
            "text": "  onToggleAISearch: () =&gt; void;",
            "lineNumber": 38
          },
          {
            "text": "  onRememberFolderSettings?: () =&gt; void;",
            "lineNumber": 39
          },
          {
            "text": "  hasFolderSettings?: boolean;",
            "lineNumber": 40
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 41,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 42,
            "isSignature": true
          }
        ]
      },
      "score": 0.33237960934638977
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst groupedFiles = () =&gt; {\nid =&gt; {\n\n      if (!groups[key]) groups[key] = []; groups[key].push(id);\n    });\n    return Object.entries(groups).map(([title, ids]) =&gt; ({ id: title, title, fileIds: ids })).sort((a, b) =&gt; a.title.localeCompare(b.title));\n  }, [displayFileIds, groupBy, state.files, t]);\n\n  // ... (keep handleOpenFolder and handleRefresh)\n  const handleOpenFolder = async () =&gt; { \n      try { \n          const path = await openDirectory(); \n          if (path) { \n                  // 确保缓存目录存在（在资源根目录下创建 .Aurora_Cache 文件夹）\n                  if (isTauriEnvironment()) {\n                      const cachePath = &#96;${path}${path.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96;;\n                      await ensureDirectory(cachePath);\n                  }\n                  \n                  const result = await scanDirectory(path, true); \n                  setState(prev =&gt; { \n                      const newRoots = Array.from(new Set([...prev.roots, ...result.roots])); \n                      const newFiles = { ...prev.files, ...result.files }; \n                      const updatedTabs = prev.tabs.map(t =&gt; t.id === prev.activeTabId ? { ...t, folderId: result.roots[0], history: { stack: [{ folderId: result.roots[0], viewingId: null, viewMode: 'browser' as const, searchQuery: '', searchScope: 'all' as SearchScope, activeTags: [], activePersonId: null }], currentIndex: 0 } } : t); \n                      \n                      return { \n                          ...prev, \n                          roots: newRoots, \n                          files: newFiles, \n                          expandedFolderIds: [...prev.expandedFolderIds, ...result.roots], \n                          tabs: updatedTabs,\n                          settings: {\n                              ...prev.settings,\n                              paths: {\n                                  ...prev.settings.paths,\n                                  resourceRoot: path\n                              }\n                          }\n                      }; \n                  }); \n              } \n          } catch (e) { console.error(\"Failed to open directory\", e); } \n  };\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 3
              },
              "endPosition": {
                "line": 1305,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 9
              },
              "endPosition": {
                "line": 1305,
                "column": 26
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const groupedFiles = () =&gt; {",
            "lineNumber": 1283
          },
          {
            "text": "id =&gt; {",
            "lineNumber": 1286
          },
          {
            "lineNumber": 1304
          },
          {
            "text": "      if (!groups[key]) groups[key] = []; groups[key].push(id);",
            "lineNumber": 1305
          },
          {
            "text": "    });",
            "lineNumber": 1306
          },
          {
            "text": "    return Object.entries(groups).map(([title, ids]) =&gt; ({ id: title, title, fileIds: ids })).sort((a, b) =&gt; a.title.localeCompare(b.title));",
            "lineNumber": 1307
          },
          {
            "text": "  }, [displayFileIds, groupBy, state.files, t]);",
            "lineNumber": 1308
          },
          {
            "lineNumber": 1309
          },
          {
            "text": "  // ... (keep handleOpenFolder and handleRefresh)",
            "lineNumber": 1310
          },
          {
            "text": "  const handleOpenFolder = async () =&gt; { ",
            "lineNumber": 1311
          },
          {
            "text": "      try { ",
            "lineNumber": 1312
          },
          {
            "text": "          const path = await openDirectory(); ",
            "lineNumber": 1313
          },
          {
            "text": "          if (path) { ",
            "lineNumber": 1314
          },
          {
            "text": "                  // 确保缓存目录存在（在资源根目录下创建 .Aurora_Cache 文件夹）",
            "lineNumber": 1315
          },
          {
            "text": "                  if (isTauriEnvironment()) {",
            "lineNumber": 1316
          },
          {
            "text": "                      const cachePath = &#96;${path}${path.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96;;",
            "lineNumber": 1317
          },
          {
            "text": "                      await ensureDirectory(cachePath);",
            "lineNumber": 1318
          },
          {
            "text": "                  }",
            "lineNumber": 1319
          },
          {
            "text": "                  ",
            "lineNumber": 1320
          },
          {
            "text": "                  const result = await scanDirectory(path, true); ",
            "lineNumber": 1321
          },
          {
            "text": "                  setState(prev =&gt; { ",
            "lineNumber": 1322
          },
          {
            "text": "                      const newRoots = Array.from(new Set([...prev.roots, ...result.roots])); ",
            "lineNumber": 1323
          },
          {
            "text": "                      const newFiles = { ...prev.files, ...result.files }; ",
            "lineNumber": 1324
          },
          {
            "text": "                      const updatedTabs = prev.tabs.map(t =&gt; t.id === prev.activeTabId ? { ...t, folderId: result.roots[0], history: { stack: [{ folderId: result.roots[0], viewingId: null, viewMode: 'browser' as const, searchQuery: '', searchScope: 'all' as SearchScope, activeTags: [], activePersonId: null }], currentIndex: 0 } } : t); ",
            "lineNumber": 1325
          },
          {
            "text": "                      ",
            "lineNumber": 1326
          },
          {
            "text": "                      return { ",
            "lineNumber": 1327
          },
          {
            "text": "                          ...prev, ",
            "lineNumber": 1328
          },
          {
            "text": "                          roots: newRoots, ",
            "lineNumber": 1329
          },
          {
            "text": "                          files: newFiles, ",
            "lineNumber": 1330
          },
          {
            "text": "                          expandedFolderIds: [...prev.expandedFolderIds, ...result.roots], ",
            "lineNumber": 1331
          },
          {
            "text": "                          tabs: updatedTabs,",
            "lineNumber": 1332
          },
          {
            "text": "                          settings: {",
            "lineNumber": 1333
          },
          {
            "text": "                              ...prev.settings,",
            "lineNumber": 1334
          },
          {
            "text": "                              paths: {",
            "lineNumber": 1335
          },
          {
            "text": "                                  ...prev.settings.paths,",
            "lineNumber": 1336
          },
          {
            "text": "                                  resourceRoot: path",
            "lineNumber": 1337
          },
          {
            "text": "                              }",
            "lineNumber": 1338
          },
          {
            "text": "                          }",
            "lineNumber": 1339
          },
          {
            "text": "                      }; ",
            "lineNumber": 1340
          },
          {
            "text": "                  }); ",
            "lineNumber": 1341
          },
          {
            "text": "              } ",
            "lineNumber": 1342
          },
          {
            "text": "          } catch (e) { console.error(\"Failed to open directory\", e); } ",
            "lineNumber": 1343
          },
          {
            "text": "  };",
            "lineNumber": 1344
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3304814100265503
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 109
          },
          "endPosition": {
            "line": 255,
            "column": 2
          }
        },
        "contents": "const FolderPickerModal = \nconst renderTree = \n\n    );\n  };\n  \n  const matchingFolders = findMatchingFolders();\n  \n  return (\n    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in\"&gt;\n      &lt;h3 className=\"font-bold text-lg mb-2 text-gray-900 dark:text-white\"&gt;\n        {type === 'copy-to-folder' ? t('context.copyTo') : t('context.moveTo')}\n      &lt;/h3&gt;\n      \n      {/* 搜索框 */}\n      &lt;div className=\"relative mb-4\"&gt;\n        &lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;\n        &lt;input\n          type=\"text\"\n          id=\"folder-picker-search\"\n          name=\"folder-picker-search\"\n          className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\"\n          placeholder={t('search.placeholder')}\n          value={searchQuery}\n          onChange={(e) =&gt; setSearchQuery(e.target.value)}\n          autoFocus\n        /&gt;\n        {searchQuery &amp;&amp; (\n          &lt;button\n            className=\"absolute right-2.5 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n            onClick={() =&gt; setSearchQuery('')}\n          &gt;\n            &lt;X size={14} /&gt;\n          &lt;/button&gt;\n        )}\n      &lt;/div&gt;\n      \n      &lt;div className=\"flex-1 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded mb-4 p-2 bg-gray-50 dark:bg-gray-900/50\"&gt;\n        {roots.map((rootId: string) =&gt; renderTree(rootId, 0, matchingFolders))}\n      &lt;/div&gt;\n      &lt;div className=\"flex justify-end space-x-2\"&gt;\n        &lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;\n          {t('settings.cancel')}\n        &lt;/button&gt;\n        &lt;button \n          onClick={() =&gt; currentId &amp;&amp; onConfirm(currentId)} \n          disabled={!currentId}\n          className=\"bg-blue-600 disabled:opacity-50 text-white px-3 py-1.5 rounded hover:bg-blue-700 text-sm\"\n        &gt;\n          {t('settings.confirm')}\n        &lt;/button&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  );\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 108,
                "column": 1
              },
              "endPosition": {
                "line": 108,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 108,
                "column": 7
              },
              "endPosition": {
                "line": 108,
                "column": 27
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ",
            "lineNumber": 110
          },
          {
            "text": "const renderTree = ",
            "lineNumber": 171
          },
          {
            "lineNumber": 204
          },
          {
            "text": "    );",
            "lineNumber": 205
          },
          {
            "text": "  };",
            "lineNumber": 206
          },
          {
            "text": "  ",
            "lineNumber": 207
          },
          {
            "text": "  const matchingFolders = findMatchingFolders();",
            "lineNumber": 208
          },
          {
            "text": "  ",
            "lineNumber": 209
          },
          {
            "text": "  return (",
            "lineNumber": 210
          },
          {
            "text": "    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in\"&gt;",
            "lineNumber": 211
          },
          {
            "text": "      &lt;h3 className=\"font-bold text-lg mb-2 text-gray-900 dark:text-white\"&gt;",
            "lineNumber": 212
          },
          {
            "text": "        {type === 'copy-to-folder' ? t('context.copyTo') : t('context.moveTo')}",
            "lineNumber": 213
          },
          {
            "text": "      &lt;/h3&gt;",
            "lineNumber": 214
          },
          {
            "text": "      ",
            "lineNumber": 215
          },
          {
            "text": "      {/* 搜索框 */}",
            "lineNumber": 216
          },
          {
            "text": "      &lt;div className=\"relative mb-4\"&gt;",
            "lineNumber": 217
          },
          {
            "text": "        &lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;",
            "lineNumber": 218
          },
          {
            "text": "        &lt;input",
            "lineNumber": 219
          },
          {
            "text": "          type=\"text\"",
            "lineNumber": 220
          },
          {
            "text": "          id=\"folder-picker-search\"",
            "lineNumber": 221
          },
          {
            "text": "          name=\"folder-picker-search\"",
            "lineNumber": 222
          },
          {
            "text": "          className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\"",
            "lineNumber": 223
          },
          {
            "text": "          placeholder={t('search.placeholder')}",
            "lineNumber": 224
          },
          {
            "text": "          value={searchQuery}",
            "lineNumber": 225
          },
          {
            "text": "          onChange={(e) =&gt; setSearchQuery(e.target.value)}",
            "lineNumber": 226
          },
          {
            "text": "          autoFocus",
            "lineNumber": 227
          },
          {
            "text": "        /&gt;",
            "lineNumber": 228
          },
          {
            "text": "        {searchQuery &amp;&amp; (",
            "lineNumber": 229
          },
          {
            "text": "          &lt;button",
            "lineNumber": 230
          },
          {
            "text": "            className=\"absolute right-2.5 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"",
            "lineNumber": 231
          },
          {
            "text": "            onClick={() =&gt; setSearchQuery('')}",
            "lineNumber": 232
          },
          {
            "text": "          &gt;",
            "lineNumber": 233
          },
          {
            "text": "            &lt;X size={14} /&gt;",
            "lineNumber": 234
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 235
          },
          {
            "text": "        )}",
            "lineNumber": 236
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 237
          },
          {
            "text": "      ",
            "lineNumber": 238
          },
          {
            "text": "      &lt;div className=\"flex-1 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded mb-4 p-2 bg-gray-50 dark:bg-gray-900/50\"&gt;",
            "lineNumber": 239
          },
          {
            "text": "        {roots.map((rootId: string) =&gt; renderTree(rootId, 0, matchingFolders))}",
            "lineNumber": 240
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 241
          },
          {
            "text": "      &lt;div className=\"flex justify-end space-x-2\"&gt;",
            "lineNumber": 242
          },
          {
            "text": "        &lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;",
            "lineNumber": 243
          },
          {
            "text": "          {t('settings.cancel')}",
            "lineNumber": 244
          },
          {
            "text": "        &lt;/button&gt;",
            "lineNumber": 245
          },
          {
            "text": "        &lt;button ",
            "lineNumber": 246
          },
          {
            "text": "          onClick={() =&gt; currentId &amp;&amp; onConfirm(currentId)} ",
            "lineNumber": 247
          },
          {
            "text": "          disabled={!currentId}",
            "lineNumber": 248
          },
          {
            "text": "          className=\"bg-blue-600 disabled:opacity-50 text-white px-3 py-1.5 rounded hover:bg-blue-700 text-sm\"",
            "lineNumber": 249
          },
          {
            "text": "        &gt;",
            "lineNumber": 250
          },
          {
            "text": "          {t('settings.confirm')}",
            "lineNumber": 251
          },
          {
            "text": "        &lt;/button&gt;",
            "lineNumber": 252
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 253
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 254
          },
          {
            "text": "  );",
            "lineNumber": 255
          },
          {
            "text": "};",
            "lineNumber": 256
          }
        ]
      },
      "score": 0.3153391480445862
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleFolderAIAnalysis = async \nconst getAllImageFilesInFolder = \n\n                          imageFiles.push({ id: childId, analyzed });\n                      }\n                  }\n              }\n          }\n          \n          return imageFiles;\n      };\n      \n      // Get all image files with their analysis status\n      const allImageFiles = getAllImageFilesInFolder(folderId);\n      \n      // Filter out non-image files and get all image IDs\n      const allImageIds = allImageFiles.map(file =&gt; file.id);\n      \n      if (allImageIds.length === 0) return;\n      \n      // Get IDs of images that haven't been analyzed yet\n      const unanalyzedImageIds = allImageFiles.filter(file =&gt; !file.analyzed).map(file =&gt; file.id);\n      \n      if (unanalyzedImageIds.length &gt; 0) {\n          // If there are unanalyzed images, analyze them first\n          await handleAIAnalysis(unanalyzedImageIds, folderId);\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleFolderAIAnalysis = async ",
            "lineNumber": 4389
          },
          {
            "text": "const getAllImageFilesInFolder = ",
            "lineNumber": 4391
          },
          {
            "lineNumber": 4406
          },
          {
            "text": "                          imageFiles.push({ id: childId, analyzed });",
            "lineNumber": 4407
          },
          {
            "text": "                      }",
            "lineNumber": 4408
          },
          {
            "text": "                  }",
            "lineNumber": 4409
          },
          {
            "text": "              }",
            "lineNumber": 4410
          },
          {
            "text": "          }",
            "lineNumber": 4411
          },
          {
            "text": "          ",
            "lineNumber": 4412
          },
          {
            "text": "          return imageFiles;",
            "lineNumber": 4413
          },
          {
            "text": "      };",
            "lineNumber": 4414
          },
          {
            "text": "      ",
            "lineNumber": 4415
          },
          {
            "text": "      // Get all image files with their analysis status",
            "lineNumber": 4416
          },
          {
            "text": "      const allImageFiles = getAllImageFilesInFolder(folderId);",
            "lineNumber": 4417
          },
          {
            "text": "      ",
            "lineNumber": 4418
          },
          {
            "text": "      // Filter out non-image files and get all image IDs",
            "lineNumber": 4419
          },
          {
            "text": "      const allImageIds = allImageFiles.map(file =&gt; file.id);",
            "lineNumber": 4420
          },
          {
            "text": "      ",
            "lineNumber": 4421
          },
          {
            "text": "      if (allImageIds.length === 0) return;",
            "lineNumber": 4422
          },
          {
            "text": "      ",
            "lineNumber": 4423
          },
          {
            "text": "      // Get IDs of images that haven't been analyzed yet",
            "lineNumber": 4424
          },
          {
            "text": "      const unanalyzedImageIds = allImageFiles.filter(file =&gt; !file.analyzed).map(file =&gt; file.id);",
            "lineNumber": 4425
          },
          {
            "text": "      ",
            "lineNumber": 4426
          },
          {
            "text": "      if (unanalyzedImageIds.length &gt; 0) {",
            "lineNumber": 4427
          },
          {
            "text": "          // If there are unanalyzed images, analyze them first",
            "lineNumber": 4428
          },
          {
            "text": "          await handleAIAnalysis(unanalyzedImageIds, folderId);",
            "lineNumber": 4429
          },
          {
            "text": ";",
            "lineNumber": 4435
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3055957853794098
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n\n                     type=\"button\"\n                     onClick={toggleScopeMenu}\n                     className=\"flex items-center text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 mr-2 pr-2 border-r border-gray-300 dark:border-gray-700 whitespace-nowrap\"\n                   &gt;\n                     {getScopeIcon()}\n                     &lt;ChevronDown size={12} className=\"ml-1 opacity-70\"/&gt;\n                   &lt;/button&gt;\n                 &lt;/div&gt;\n                &lt;Search size={16} className={&#96;mr-2 flex-shrink-0 ${isAISearchEnabled ? 'text-purple-500' : 'text-gray-400'}&#96;} /&gt;\n                &lt;input\n                  ref={searchInputRef}\n                  type=\"text\"\n                  value={localQuery}\n                  onChange={(e) =&gt; setLocalQuery(e.target.value)}\n                  placeholder={isAISearchEnabled ? t('settings.aiSmartSearch') : t('search.placeholder')}\n                  className=\"bg-transparent border-none flex-1 focus:outline-none text-sm text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 min-w-0\"\n                  onKeyDown={(e) =&gt; { if (e.key === 'Enter') handleSearchSubmit(); }}\n                /&gt;\n                &lt;div className=\"flex items-center space-x-1 ml-2 flex-shrink-0\"&gt;\n                  {localQuery &amp;&amp; (\n                    &lt;button onClick={() =&gt; { setLocalQuery(''); onSearch(''); }} className=\"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-400 flex-shrink-0\"&gt;\n                      &lt;X size={14} /&gt;\n                    &lt;/button&gt;\n                  )}\n                  &lt;button \n                    onClick={onToggleAISearch}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "lineNumber": 491
          },
          {
            "text": "                     type=\"button\"",
            "lineNumber": 492
          },
          {
            "text": "                     onClick={toggleScopeMenu}",
            "lineNumber": 493
          },
          {
            "text": "                     className=\"flex items-center text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 mr-2 pr-2 border-r border-gray-300 dark:border-gray-700 whitespace-nowrap\"",
            "lineNumber": 494
          },
          {
            "text": "                   &gt;",
            "lineNumber": 495
          },
          {
            "text": "                     {getScopeIcon()}",
            "lineNumber": 496
          },
          {
            "text": "                     &lt;ChevronDown size={12} className=\"ml-1 opacity-70\"/&gt;",
            "lineNumber": 497
          },
          {
            "text": "                   &lt;/button&gt;",
            "lineNumber": 498
          },
          {
            "text": "                 &lt;/div&gt;",
            "lineNumber": 499
          },
          {
            "text": "                &lt;Search size={16} className={&#96;mr-2 flex-shrink-0 ${isAISearchEnabled ? 'text-purple-500' : 'text-gray-400'}&#96;} /&gt;",
            "lineNumber": 500
          },
          {
            "text": "                &lt;input",
            "lineNumber": 501
          },
          {
            "text": "                  ref={searchInputRef}",
            "lineNumber": 502
          },
          {
            "text": "                  type=\"text\"",
            "lineNumber": 503
          },
          {
            "text": "                  value={localQuery}",
            "lineNumber": 504
          },
          {
            "text": "                  onChange={(e) =&gt; setLocalQuery(e.target.value)}",
            "lineNumber": 505
          },
          {
            "text": "                  placeholder={isAISearchEnabled ? t('settings.aiSmartSearch') : t('search.placeholder')}",
            "lineNumber": 506
          },
          {
            "text": "                  className=\"bg-transparent border-none flex-1 focus:outline-none text-sm text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 min-w-0\"",
            "lineNumber": 507
          },
          {
            "text": "                  onKeyDown={(e) =&gt; { if (e.key === 'Enter') handleSearchSubmit(); }}",
            "lineNumber": 508
          },
          {
            "text": "                /&gt;",
            "lineNumber": 509
          },
          {
            "text": "                &lt;div className=\"flex items-center space-x-1 ml-2 flex-shrink-0\"&gt;",
            "lineNumber": 510
          },
          {
            "text": "                  {localQuery &amp;&amp; (",
            "lineNumber": 511
          },
          {
            "text": "                    &lt;button onClick={() =&gt; { setLocalQuery(''); onSearch(''); }} className=\"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-400 flex-shrink-0\"&gt;",
            "lineNumber": 512
          },
          {
            "text": "                      &lt;X size={14} /&gt;",
            "lineNumber": 513
          },
          {
            "text": "                    &lt;/button&gt;",
            "lineNumber": 514
          },
          {
            "text": "                  )}",
            "lineNumber": 515
          },
          {
            "text": "                  &lt;button ",
            "lineNumber": 516
          },
          {
            "text": "                    onClick={onToggleAISearch}",
            "lineNumber": 517
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.2983897030353546
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n\n          \n          &lt;div className=\"px-4 py-2 hover:bg-purple-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { onAIAnalysis(file.id); setContextMenu({...contextMenu, visible: false}); }}&gt;\n             &lt;Brain size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.aiAnalyze')}\n          &lt;/div&gt;\n          \n          &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;\n          \n          &lt;div \n            className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center justify-between\"\n            onClick={() =&gt; { setShowSlideshowSettings(true); setContextMenu({...contextMenu, visible: false}); }}\n          &gt;\n            &lt;div className=\"flex items-center\"&gt;\n                &lt;Settings size={14} className=\"mr-2\"/&gt;\n                {t('context.slideshowSettings')}\n            &lt;/div&gt;\n          &lt;/div&gt;\n          &lt;div \n            className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center justify-between\"\n            onClick={toggleSlideshow}\n          &gt;\n            &lt;div className=\"flex items-center\"&gt;\n                {slideshowActive ? &lt;Square size={14} className=\"mr-2\"/&gt; : &lt;Play size={14} className=\"mr-2\"/&gt;}\n                {slideshowActive ? t('context.stopSlideshow') : t('context.startSlideshow')}\n            &lt;/div&gt;\n          &lt;/div&gt;\n          \n          &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;\n          \n          &lt;div className=\"px-4 py-2 hover:bg-red-600 hover:text-white text-red-500 dark:text-red-400 cursor-pointer flex items-center\" onClick={() =&gt; { onDelete(file.id); setContextMenu({...contextMenu, visible: false}); }}&gt;\n             &lt;Trash2 size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.delete')}\n          &lt;/div&gt;\n        &lt;/div&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "lineNumber": 712
          },
          {
            "text": "          ",
            "lineNumber": 713
          },
          {
            "text": "          &lt;div className=\"px-4 py-2 hover:bg-purple-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { onAIAnalysis(file.id); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 714
          },
          {
            "text": "             &lt;Brain size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.aiAnalyze')}",
            "lineNumber": 715
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 716
          },
          {
            "text": "          ",
            "lineNumber": 717
          },
          {
            "text": "          &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;",
            "lineNumber": 718
          },
          {
            "text": "          ",
            "lineNumber": 719
          },
          {
            "text": "          &lt;div ",
            "lineNumber": 720
          },
          {
            "text": "            className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center justify-between\"",
            "lineNumber": 721
          },
          {
            "text": "            onClick={() =&gt; { setShowSlideshowSettings(true); setContextMenu({...contextMenu, visible: false}); }}",
            "lineNumber": 722
          },
          {
            "text": "          &gt;",
            "lineNumber": 723
          },
          {
            "text": "            &lt;div className=\"flex items-center\"&gt;",
            "lineNumber": 724
          },
          {
            "text": "                &lt;Settings size={14} className=\"mr-2\"/&gt;",
            "lineNumber": 725
          },
          {
            "text": "                {t('context.slideshowSettings')}",
            "lineNumber": 726
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 727
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 728
          },
          {
            "text": "          &lt;div ",
            "lineNumber": 729
          },
          {
            "text": "            className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center justify-between\"",
            "lineNumber": 730
          },
          {
            "text": "            onClick={toggleSlideshow}",
            "lineNumber": 731
          },
          {
            "text": "          &gt;",
            "lineNumber": 732
          },
          {
            "text": "            &lt;div className=\"flex items-center\"&gt;",
            "lineNumber": 733
          },
          {
            "text": "                {slideshowActive ? &lt;Square size={14} className=\"mr-2\"/&gt; : &lt;Play size={14} className=\"mr-2\"/&gt;}",
            "lineNumber": 734
          },
          {
            "text": "                {slideshowActive ? t('context.stopSlideshow') : t('context.startSlideshow')}",
            "lineNumber": 735
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 736
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 737
          },
          {
            "text": "          ",
            "lineNumber": 738
          },
          {
            "text": "          &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;",
            "lineNumber": 739
          },
          {
            "text": "          ",
            "lineNumber": 740
          },
          {
            "text": "          &lt;div className=\"px-4 py-2 hover:bg-red-600 hover:text-white text-red-500 dark:text-red-400 cursor-pointer flex items-center\" onClick={() =&gt; { onDelete(file.id); setContextMenu({...contextMenu, visible: false}); }}&gt;",
            "lineNumber": 741
          },
          {
            "text": "             &lt;Trash2 size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.delete')}",
            "lineNumber": 742
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 743
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 744
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.2940535545349121
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 444
          },
          "endPosition": {
            "line": 799,
            "column": 1
          }
        },
        "contents": "export const TopBar: React.FC&lt;TopBarProps&gt; = \nconst handleKeyDown =  {\n    if (e.key === 'Enter') {\n      onPerformSearch(toolbarQuery);\n    }\n  };\n\n  return (\n    &lt;div className=\"h-14 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 flex items-center px-4 justify-between shrink-0 z-30 space-x-4\"&gt;\n      {/* Left: Navigation */}\n      &lt;div className=\"flex items-center space-x-2 min-w-fit\"&gt;\n        &lt;button onClick={onToggleSidebar} className={&#96;p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 ${state.layout.isSidebarVisible ? 'text-gray-600 dark:text-gray-300' : 'text-gray-400'}&#96;} title={t('viewer.toggleSidebar')}&gt;\n          &lt;Sidebar size={18} /&gt;\n        &lt;/button&gt;\n        &lt;div className=\"flex space-x-1\"&gt;\n          &lt;button onClick={onGoBack} disabled={activeTab.history.currentIndex &lt;= 0} className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30 text-gray-600 dark:text-gray-300\"&gt;\n            &lt;ChevronLeft size={18} /&gt;\n          &lt;/button&gt;\n          &lt;button onClick={onGoForward} disabled={activeTab.history.currentIndex &gt;= activeTab.history.stack.length - 1} className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30 text-gray-600 dark:text-gray-300\"&gt;\n            &lt;ChevronRight size={18} /&gt;\n          &lt;/button&gt;\n          &lt;button onClick={onNavigateUp} className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-300\" title={t('viewer.up')}&gt;\n            &lt;ArrowUp size={18} /&gt;\n          &lt;/button&gt;\n        &lt;/div&gt;\n        &lt;button onClick={() =&gt; onRefresh()} className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-300\" title={t('context.refresh')}&gt;\n          &lt;RefreshCw size={16} /&gt;\n        &lt;/button&gt;\n      &lt;/div&gt;\n\n      {/* Center: Search */}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 443,
                "column": 1
              },
              "endPosition": {
                "line": 443,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 8
              },
              "endPosition": {
                "line": 443,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 14
              },
              "endPosition": {
                "line": 443,
                "column": 46
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const TopBar: React.FC&lt;TopBarProps&gt; = ",
            "lineNumber": 445
          },
          {
            "text": "const handleKeyDown =  {",
            "lineNumber": 492
          },
          {
            "text": "    if (e.key === 'Enter') {",
            "lineNumber": 493
          },
          {
            "text": "      onPerformSearch(toolbarQuery);",
            "lineNumber": 494
          },
          {
            "text": "    }",
            "lineNumber": 495
          },
          {
            "text": "  };",
            "lineNumber": 496
          },
          {
            "lineNumber": 497
          },
          {
            "text": "  return (",
            "lineNumber": 498
          },
          {
            "text": "    &lt;div className=\"h-14 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 flex items-center px-4 justify-between shrink-0 z-30 space-x-4\"&gt;",
            "lineNumber": 499
          },
          {
            "text": "      {/* Left: Navigation */}",
            "lineNumber": 500
          },
          {
            "text": "      &lt;div className=\"flex items-center space-x-2 min-w-fit\"&gt;",
            "lineNumber": 501
          },
          {
            "text": "        &lt;button onClick={onToggleSidebar} className={&#96;p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 ${state.layout.isSidebarVisible ? 'text-gray-600 dark:text-gray-300' : 'text-gray-400'}&#96;} title={t('viewer.toggleSidebar')}&gt;",
            "lineNumber": 502
          },
          {
            "text": "          &lt;Sidebar size={18} /&gt;",
            "lineNumber": 503
          },
          {
            "text": "        &lt;/button&gt;",
            "lineNumber": 504
          },
          {
            "text": "        &lt;div className=\"flex space-x-1\"&gt;",
            "lineNumber": 505
          },
          {
            "text": "          &lt;button onClick={onGoBack} disabled={activeTab.history.currentIndex &lt;= 0} className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30 text-gray-600 dark:text-gray-300\"&gt;",
            "lineNumber": 506
          },
          {
            "text": "            &lt;ChevronLeft size={18} /&gt;",
            "lineNumber": 507
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 508
          },
          {
            "text": "          &lt;button onClick={onGoForward} disabled={activeTab.history.currentIndex &gt;= activeTab.history.stack.length - 1} className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30 text-gray-600 dark:text-gray-300\"&gt;",
            "lineNumber": 509
          },
          {
            "text": "            &lt;ChevronRight size={18} /&gt;",
            "lineNumber": 510
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 511
          },
          {
            "text": "          &lt;button onClick={onNavigateUp} className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-300\" title={t('viewer.up')}&gt;",
            "lineNumber": 512
          },
          {
            "text": "            &lt;ArrowUp size={18} /&gt;",
            "lineNumber": 513
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 514
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 515
          },
          {
            "text": "        &lt;button onClick={() =&gt; onRefresh()} className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-300\" title={t('context.refresh')}&gt;",
            "lineNumber": 516
          },
          {
            "text": "          &lt;RefreshCw size={16} /&gt;",
            "lineNumber": 517
          },
          {
            "text": "        &lt;/button&gt;",
            "lineNumber": 518
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 519
          },
          {
            "lineNumber": 520
          },
          {
            "text": "      {/* Center: Search */}",
            "lineNumber": 521
          },
          {
            "text": ";",
            "lineNumber": 800
          }
        ]
      },
      "score": 0.2918589115142822
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \n\n                      const isChinese = state.settings.language === 'zh';\n                      const outputLanguage = isChinese ? '中文' : 'English';\n                      \n                      // Create prompt for AI to understand and provide detailed summary of the folder content\n                      const analysisPrompt = isChinese ? \n                      &#96;请根据以下所有图片的描述、提取到的文字和翻译后的文字，详细分析这个文件夹内的图片内容以及这些文字说了个什么事情？\\n\\n${allContent}\\n\\n请严格遵守以下要求：\\n1. ❌绝对禁止直接罗列单张图片的描述信息，例如\"图片1：...图片2：...\"这样的格式\\n2. ✅必须将所有图片的描述信息结合成一个整体进行分析，形成连贯的整体描述\\n3. ✅详细说明这些图片和文字所描述的整体事件、主题或故事\\n4. ✅如果你发现有提取到的文字，请优先使用翻译后的文字（如果有），否则使用提取到的文字，提炼重要内容并对此进行讲解\\n5. ✅请用清晰、有条理的语言进行分析和总结，不要过于简洁\\n6. ✅你的回答应该像是对整个文件夹内容的总体概括，而不是对每张图片的单独描述&#96; :\n                      &#96;Based on all the image descriptions, extracted text, and translated text below, please analyze in detail what these images are about and what story or information the text conveys.\\n\\n${allContent}\\n\\nPlease strictly follow these requirements:\\n1. ❌ ABSOLUTELY DO NOT directly list individual image descriptions, such as \"Image 1: ... Image 2: ...\" format\\n2. ✅ Must combine all image descriptions into a single coherent analysis, forming a continuous overall description\\n3. ✅ Provide a detailed explanation of the overall events, themes, or stories described in these images and text\\n4. ✅ If you find any extracted text, please prioritize using translated text (if available), otherwise use the extracted text, extract important content and explain it\\n5. ✅ Use clear, structured language for analysis and summary, avoid being too concise\\n6. ✅ Your answer should be an overall summary of the entire folder content, not a separate description of each image&#96;;\n                      \n                      try {\n                          let result: any = null;\n                          \n                          if (aiConfig.provider === 'openai') {\n                              const body = {\n                                  model: aiConfig.openai.model,\n                                  messages: [{ role: \"user\", content: analysisPrompt }],\n                                  max_tokens: 1500,\n                                  temperature: 0.7\n                              };\n                              const res = await fetch(&#96;${aiConfig.openai.endpoint}/chat/completions&#96;, {\n                                  method: 'POST',\n                                  headers: { 'Content-Type': 'application/json', 'Authorization': &#96;Bearer ${aiConfig.openai.apiKey}&#96; },\n                                  body: JSON.stringify(body)\n                              });\n                              const resData = await res.json();\n                              if (resData?.choices?.[0]?.message?.content) { \n                                  summary = resData.choices[0].message.content;\n                              }\n                          }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 4216,
                "column": 15
              },
              "endPosition": {
                "line": 4216,
                "column": 15
              }
            },
            {
              "startPosition": {
                "line": 4216,
                "column": 16
              },
              "endPosition": {
                "line": 4217,
                "column": 19
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3593
          },
          {
            "lineNumber": 4235
          },
          {
            "text": "                      const isChinese = state.settings.language === 'zh';",
            "lineNumber": 4236
          },
          {
            "text": "                      const outputLanguage = isChinese ? '中文' : 'English';",
            "lineNumber": 4237
          },
          {
            "text": "                      ",
            "lineNumber": 4238
          },
          {
            "text": "                      // Create prompt for AI to understand and provide detailed summary of the folder content",
            "lineNumber": 4239
          },
          {
            "text": "                      const analysisPrompt = isChinese ? ",
            "lineNumber": 4240
          },
          {
            "text": "                      &#96;请根据以下所有图片的描述、提取到的文字和翻译后的文字，详细分析这个文件夹内的图片内容以及这些文字说了个什么事情？\\n\\n${allContent}\\n\\n请严格遵守以下要求：\\n1. ❌绝对禁止直接罗列单张图片的描述信息，例如\"图片1：...图片2：...\"这样的格式\\n2. ✅必须将所有图片的描述信息结合成一个整体进行分析，形成连贯的整体描述\\n3. ✅详细说明这些图片和文字所描述的整体事件、主题或故事\\n4. ✅如果你发现有提取到的文字，请优先使用翻译后的文字（如果有），否则使用提取到的文字，提炼重要内容并对此进行讲解\\n5. ✅请用清晰、有条理的语言进行分析和总结，不要过于简洁\\n6. ✅你的回答应该像是对整个文件夹内容的总体概括，而不是对每张图片的单独描述&#96; :",
            "lineNumber": 4241
          },
          {
            "text": "                      &#96;Based on all the image descriptions, extracted text, and translated text below, please analyze in detail what these images are about and what story or information the text conveys.\\n\\n${allContent}\\n\\nPlease strictly follow these requirements:\\n1. ❌ ABSOLUTELY DO NOT directly list individual image descriptions, such as \"Image 1: ... Image 2: ...\" format\\n2. ✅ Must combine all image descriptions into a single coherent analysis, forming a continuous overall description\\n3. ✅ Provide a detailed explanation of the overall events, themes, or stories described in these images and text\\n4. ✅ If you find any extracted text, please prioritize using translated text (if available), otherwise use the extracted text, extract important content and explain it\\n5. ✅ Use clear, structured language for analysis and summary, avoid being too concise\\n6. ✅ Your answer should be an overall summary of the entire folder content, not a separate description of each image&#96;;",
            "lineNumber": 4242
          },
          {
            "text": "                      ",
            "lineNumber": 4243
          },
          {
            "text": "                      try {",
            "lineNumber": 4244
          },
          {
            "text": "                          let result: any = null;",
            "lineNumber": 4245
          },
          {
            "text": "                          ",
            "lineNumber": 4246
          },
          {
            "text": "                          if (aiConfig.provider === 'openai') {",
            "lineNumber": 4247
          },
          {
            "text": "                              const body = {",
            "lineNumber": 4248
          },
          {
            "text": "                                  model: aiConfig.openai.model,",
            "lineNumber": 4249
          },
          {
            "text": "                                  messages: [{ role: \"user\", content: analysisPrompt }],",
            "lineNumber": 4250
          },
          {
            "text": "                                  max_tokens: 1500,",
            "lineNumber": 4251
          },
          {
            "text": "                                  temperature: 0.7",
            "lineNumber": 4252
          },
          {
            "text": "                              };",
            "lineNumber": 4253
          },
          {
            "text": "                              const res = await fetch(&#96;${aiConfig.openai.endpoint}/chat/completions&#96;, {",
            "lineNumber": 4254
          },
          {
            "text": "                                  method: 'POST',",
            "lineNumber": 4255
          },
          {
            "text": "                                  headers: { 'Content-Type': 'application/json', 'Authorization': &#96;Bearer ${aiConfig.openai.apiKey}&#96; },",
            "lineNumber": 4256
          },
          {
            "text": "                                  body: JSON.stringify(body)",
            "lineNumber": 4257
          },
          {
            "text": "                              });",
            "lineNumber": 4258
          },
          {
            "text": "                              const resData = await res.json();",
            "lineNumber": 4259
          },
          {
            "text": "                              if (resData?.choices?.[0]?.message?.content) { ",
            "lineNumber": 4260
          },
          {
            "text": "                                  summary = resData.choices[0].message.content;",
            "lineNumber": 4261
          },
          {
            "text": "                              }",
            "lineNumber": 4262
          },
          {
            "text": "                          }",
            "lineNumber": 4263
          },
          {
            "text": ";",
            "lineNumber": 4386
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.29094409942626953
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 109
          },
          "endPosition": {
            "line": 255,
            "column": 1
          }
        },
        "contents": "const FolderPickerModal = \n\n  \n  // 查找所有匹配的文件夹及其祖先文件夹\n  const findMatchingFolders = (): Set&lt;string&gt; | null =&gt; {\n    // 如果搜索框为空，返回 null，表示不需要过滤\n    if (!searchQuery.trim()) {\n      return null;\n    }\n    \n    const matchingFolders = new Set&lt;string&gt;();\n    const query = searchQuery.toLowerCase();\n    \n    // 递归遍历文件夹树，查找匹配的文件夹\n    const traverse = (nodeId: string) =&gt; {\n      const node = files[nodeId];\n      if (!node || node.type !== FileType.FOLDER) return;\n      \n      // 检查当前文件夹是否匹配搜索条件\n      const matches = node.name.toLowerCase().includes(query);\n      \n      // 获取子文件夹\n      const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];\n      \n      // 检查是否有子文件夹匹配\n      let hasMatchingChild = false;\n      for (const childId of folderChildren) {\n        traverse(childId);\n        if (matchingFolders.has(childId)) {\n          hasMatchingChild = true;\n        }\n      }\n      \n      // 如果当前文件夹匹配或有匹配的子文件夹，添加到结果中\n      if (matches || hasMatchingChild) {\n        matchingFolders.add(nodeId);\n      }\n    };\n    \n    // 从所有根目录开始遍历\n    roots.forEach((rootId: string) =&gt; traverse(rootId));\n    \n    return matchingFolders;\n  };\n  \n  // 递归渲染文件夹树，支持搜索过滤\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 108,
                "column": 1
              },
              "endPosition": {
                "line": 108,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 108,
                "column": 7
              },
              "endPosition": {
                "line": 108,
                "column": 27
              }
            },
            {
              "startPosition": {
                "line": 127,
                "column": 3
              },
              "endPosition": {
                "line": 127,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 127,
                "column": 9
              },
              "endPosition": {
                "line": 127,
                "column": 31
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ",
            "lineNumber": 110
          },
          {
            "lineNumber": 126
          },
          {
            "text": "  ",
            "lineNumber": 127
          },
          {
            "text": "  // 查找所有匹配的文件夹及其祖先文件夹",
            "lineNumber": 128
          },
          {
            "text": "  const findMatchingFolders = (): Set&lt;string&gt; | null =&gt; {",
            "lineNumber": 129
          },
          {
            "text": "    // 如果搜索框为空，返回 null，表示不需要过滤",
            "lineNumber": 130
          },
          {
            "text": "    if (!searchQuery.trim()) {",
            "lineNumber": 131
          },
          {
            "text": "      return null;",
            "lineNumber": 132
          },
          {
            "text": "    }",
            "lineNumber": 133
          },
          {
            "text": "    ",
            "lineNumber": 134
          },
          {
            "text": "    const matchingFolders = new Set&lt;string&gt;();",
            "lineNumber": 135
          },
          {
            "text": "    const query = searchQuery.toLowerCase();",
            "lineNumber": 136
          },
          {
            "text": "    ",
            "lineNumber": 137
          },
          {
            "text": "    // 递归遍历文件夹树，查找匹配的文件夹",
            "lineNumber": 138
          },
          {
            "text": "    const traverse = (nodeId: string) =&gt; {",
            "lineNumber": 139
          },
          {
            "text": "      const node = files[nodeId];",
            "lineNumber": 140
          },
          {
            "text": "      if (!node || node.type !== FileType.FOLDER) return;",
            "lineNumber": 141
          },
          {
            "text": "      ",
            "lineNumber": 142
          },
          {
            "text": "      // 检查当前文件夹是否匹配搜索条件",
            "lineNumber": 143
          },
          {
            "text": "      const matches = node.name.toLowerCase().includes(query);",
            "lineNumber": 144
          },
          {
            "text": "      ",
            "lineNumber": 145
          },
          {
            "text": "      // 获取子文件夹",
            "lineNumber": 146
          },
          {
            "text": "      const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];",
            "lineNumber": 147
          },
          {
            "text": "      ",
            "lineNumber": 148
          },
          {
            "text": "      // 检查是否有子文件夹匹配",
            "lineNumber": 149
          },
          {
            "text": "      let hasMatchingChild = false;",
            "lineNumber": 150
          },
          {
            "text": "      for (const childId of folderChildren) {",
            "lineNumber": 151
          },
          {
            "text": "        traverse(childId);",
            "lineNumber": 152
          },
          {
            "text": "        if (matchingFolders.has(childId)) {",
            "lineNumber": 153
          },
          {
            "text": "          hasMatchingChild = true;",
            "lineNumber": 154
          },
          {
            "text": "        }",
            "lineNumber": 155
          },
          {
            "text": "      }",
            "lineNumber": 156
          },
          {
            "text": "      ",
            "lineNumber": 157
          },
          {
            "text": "      // 如果当前文件夹匹配或有匹配的子文件夹，添加到结果中",
            "lineNumber": 158
          },
          {
            "text": "      if (matches || hasMatchingChild) {",
            "lineNumber": 159
          },
          {
            "text": "        matchingFolders.add(nodeId);",
            "lineNumber": 160
          },
          {
            "text": "      }",
            "lineNumber": 161
          },
          {
            "text": "    };",
            "lineNumber": 162
          },
          {
            "text": "    ",
            "lineNumber": 163
          },
          {
            "text": "    // 从所有根目录开始遍历",
            "lineNumber": 164
          },
          {
            "text": "    roots.forEach((rootId: string) =&gt; traverse(rootId));",
            "lineNumber": 165
          },
          {
            "text": "    ",
            "lineNumber": 166
          },
          {
            "text": "    return matchingFolders;",
            "lineNumber": 167
          },
          {
            "text": "  };",
            "lineNumber": 168
          },
          {
            "text": "  ",
            "lineNumber": 169
          },
          {
            "text": "  // 递归渲染文件夹树，支持搜索过滤",
            "lineNumber": 170
          },
          {
            "text": ";",
            "lineNumber": 256
          }
        ]
      },
      "score": 0.28951311111450195
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 444
          },
          "endPosition": {
            "line": 799,
            "column": 1
          }
        },
        "contents": "export const TopBar: React.FC&lt;TopBarProps&gt; = \n\" title={t('context.refresh')}&gt;\n          &lt;RefreshCw size={16} /&gt;\n        &lt;/button&gt;\n      &lt;/div&gt;\n\n      {/* Center: Search */}\n      &lt;div className=\"flex-1 max-w-2xl relative\"&gt;\n        &lt;div className={&#96;flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border overflow-hidden ${\n          isAISearchEnabled \n            ? 'border-purple-500 shadow-sm shadow-purple-500/20' \n            : activeTab.searchQuery \n              ? 'border-blue-500 shadow-sm' \n              : 'border-transparent'\n        }&#96;}&gt;\n          \n          &lt;div className=\"relative flex-shrink-0\"&gt;\n            &lt;button \n              onClick={() =&gt; setScopeMenuOpen(!scopeMenuOpen)}\n              className=\"flex items-center text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 mr-2 pr-2 border-r border-gray-300 dark:border-gray-700 whitespace-nowrap\"\n            &gt;\n              {getScopeIcon(activeTab.searchScope)}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 443,
                "column": 1
              },
              "endPosition": {
                "line": 443,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 8
              },
              "endPosition": {
                "line": 443,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 14
              },
              "endPosition": {
                "line": 443,
                "column": 46
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const TopBar: React.FC&lt;TopBarProps&gt; = ",
            "lineNumber": 445
          },
          {
            "text": "\" title={t('context.refresh')}&gt;",
            "lineNumber": 516
          },
          {
            "text": "          &lt;RefreshCw size={16} /&gt;",
            "lineNumber": 517
          },
          {
            "text": "        &lt;/button&gt;",
            "lineNumber": 518
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 519
          },
          {
            "lineNumber": 520
          },
          {
            "text": "      {/* Center: Search */}",
            "lineNumber": 521
          },
          {
            "text": "      &lt;div className=\"flex-1 max-w-2xl relative\"&gt;",
            "lineNumber": 522
          },
          {
            "text": "        &lt;div className={&#96;flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border overflow-hidden ${",
            "lineNumber": 523
          },
          {
            "text": "          isAISearchEnabled ",
            "lineNumber": 524
          },
          {
            "text": "            ? 'border-purple-500 shadow-sm shadow-purple-500/20' ",
            "lineNumber": 525
          },
          {
            "text": "            : activeTab.searchQuery ",
            "lineNumber": 526
          },
          {
            "text": "              ? 'border-blue-500 shadow-sm' ",
            "lineNumber": 527
          },
          {
            "text": "              : 'border-transparent'",
            "lineNumber": 528
          },
          {
            "text": "        }&#96;}&gt;",
            "lineNumber": 529
          },
          {
            "text": "          ",
            "lineNumber": 530
          },
          {
            "text": "          &lt;div className=\"relative flex-shrink-0\"&gt;",
            "lineNumber": 531
          },
          {
            "text": "            &lt;button ",
            "lineNumber": 532
          },
          {
            "text": "              onClick={() =&gt; setScopeMenuOpen(!scopeMenuOpen)}",
            "lineNumber": 533
          },
          {
            "text": "              className=\"flex items-center text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 mr-2 pr-2 border-r border-gray-300 dark:border-gray-700 whitespace-nowrap\"",
            "lineNumber": 534
          },
          {
            "text": "            &gt;",
            "lineNumber": 535
          },
          {
            "text": "              {getScopeIcon(activeTab.searchScope)}",
            "lineNumber": 536
          },
          {
            "text": ";",
            "lineNumber": 800
          }
        ]
      },
      "score": 0.2863532304763794
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "人物界面面板 character panel",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n              &lt;TopBar \n                activeTab={activeTab} \n                state={state} \n                toolbarQuery={toolbarQuery} \n                groupedTags={groupedTags} \n                tagSearchQuery={tagSearchQuery} \n                onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))} \n                onGoBack={goBack} \n                onGoForward={goForward} \n                onNavigateUp={handleNavigateUp} \n                onSetTagSearchQuery={setTagSearchQuery} \n                onTagClick={handleTagClick} \n                onRefresh={handleRefresh} \n                onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })} \n                onPerformSearch={handlePerformSearch} \n                onSetToolbarQuery={setToolbarQuery} \n                onLayoutModeChange={(mode) =&gt; updateActiveTab({ layoutMode: mode })} \n                onSortOptionChange={(opt) =&gt; setState(s =&gt; ({ ...s, sortBy: opt }))} \n                onSortDirectionChange={() =&gt; setState(s =&gt; ({ ...s, sortDirection: s.sortDirection === 'asc' ? 'desc' : 'asc' }))} \n                onThumbnailSizeChange={(size) =&gt; setState(s =&gt; ({ ...s, thumbnailSize: size }))} \n                onToggleMetadata={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isMetadataVisible: !s.layout.isMetadataVisible } }))} \n                onToggleSettings={toggleSettings} \n                onUpdateDateFilter={(f) =&gt; updateActiveTab({ dateFilter: f })} \n                groupBy={groupBy}\n                onGroupByChange={setGroupBy}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "lineNumber": 4525
          },
          {
            "text": "              &lt;TopBar ",
            "lineNumber": 4526
          },
          {
            "text": "                activeTab={activeTab} ",
            "lineNumber": 4527
          },
          {
            "text": "                state={state} ",
            "lineNumber": 4528
          },
          {
            "text": "                toolbarQuery={toolbarQuery} ",
            "lineNumber": 4529
          },
          {
            "text": "                groupedTags={groupedTags} ",
            "lineNumber": 4530
          },
          {
            "text": "                tagSearchQuery={tagSearchQuery} ",
            "lineNumber": 4531
          },
          {
            "text": "                onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))} ",
            "lineNumber": 4532
          },
          {
            "text": "                onGoBack={goBack} ",
            "lineNumber": 4533
          },
          {
            "text": "                onGoForward={goForward} ",
            "lineNumber": 4534
          },
          {
            "text": "                onNavigateUp={handleNavigateUp} ",
            "lineNumber": 4535
          },
          {
            "text": "                onSetTagSearchQuery={setTagSearchQuery} ",
            "lineNumber": 4536
          },
          {
            "text": "                onTagClick={handleTagClick} ",
            "lineNumber": 4537
          },
          {
            "text": "                onRefresh={handleRefresh} ",
            "lineNumber": 4538
          },
          {
            "text": "                onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })} ",
            "lineNumber": 4539
          },
          {
            "text": "                onPerformSearch={handlePerformSearch} ",
            "lineNumber": 4540
          },
          {
            "text": "                onSetToolbarQuery={setToolbarQuery} ",
            "lineNumber": 4541
          },
          {
            "text": "                onLayoutModeChange={(mode) =&gt; updateActiveTab({ layoutMode: mode })} ",
            "lineNumber": 4542
          },
          {
            "text": "                onSortOptionChange={(opt) =&gt; setState(s =&gt; ({ ...s, sortBy: opt }))} ",
            "lineNumber": 4543
          },
          {
            "text": "                onSortDirectionChange={() =&gt; setState(s =&gt; ({ ...s, sortDirection: s.sortDirection === 'asc' ? 'desc' : 'asc' }))} ",
            "lineNumber": 4544
          },
          {
            "text": "                onThumbnailSizeChange={(size) =&gt; setState(s =&gt; ({ ...s, thumbnailSize: size }))} ",
            "lineNumber": 4545
          },
          {
            "text": "                onToggleMetadata={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isMetadataVisible: !s.layout.isMetadataVisible } }))} ",
            "lineNumber": 4546
          },
          {
            "text": "                onToggleSettings={toggleSettings} ",
            "lineNumber": 4547
          },
          {
            "text": "                onUpdateDateFilter={(f) =&gt; updateActiveTab({ dateFilter: f })} ",
            "lineNumber": 4548
          },
          {
            "text": "                groupBy={groupBy}",
            "lineNumber": 4549
          },
          {
            "text": "                onGroupByChange={setGroupBy}",
            "lineNumber": 4550
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3675110340118408
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst chartData = () =&gt; {\n\n \n            color: typeColors['FOLDER'] || defaultColor\n        });\n    }\n    \n    Object.entries(folderDetails.types).forEach(([type, count]) =&gt; {\n        data.push({ \n            label: type, \n            value: count, \n            color: typeColors[type] || defaultColor\n        });\n    });\n    \n    return data.sort((a, b) =&gt; b.value - a.value);\n  }, [folderDetails, t]);\n  \n  const personStats = useMemo(() =&gt; {\n    if (!person) return null;\n    let totalSize = 0;\n    let count = 0;\n    Object.values(files).forEach((f: FileNode) =&gt; {\n        if (f.type === FileType.IMAGE &amp;&amp; f.aiData?.faces.some(face =&gt; face.personId === person.id)) {\n            totalSize += f.meta?.sizeKb || 0;\n            count++;\n        }\n    });\n    return { totalSize, count };\n  },;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "const chartData = () =&gt; {",
            "lineNumber": 642
          },
          {
            "lineNumber": 647
          },
          {
            "text": " ",
            "lineNumber": 649
          },
          {
            "text": "            color: typeColors['FOLDER'] || defaultColor",
            "lineNumber": 650
          },
          {
            "text": "        });",
            "lineNumber": 651
          },
          {
            "text": "    }",
            "lineNumber": 652
          },
          {
            "text": "    ",
            "lineNumber": 653
          },
          {
            "text": "    Object.entries(folderDetails.types).forEach(([type, count]) =&gt; {",
            "lineNumber": 654
          },
          {
            "text": "        data.push({ ",
            "lineNumber": 655
          },
          {
            "text": "            label: type, ",
            "lineNumber": 656
          },
          {
            "text": "            value: count, ",
            "lineNumber": 657
          },
          {
            "text": "            color: typeColors[type] || defaultColor",
            "lineNumber": 658
          },
          {
            "text": "        });",
            "lineNumber": 659
          },
          {
            "text": "    });",
            "lineNumber": 660
          },
          {
            "text": "    ",
            "lineNumber": 661
          },
          {
            "text": "    return data.sort((a, b) =&gt; b.value - a.value);",
            "lineNumber": 662
          },
          {
            "text": "  }, [folderDetails, t]);",
            "lineNumber": 663
          },
          {
            "text": "  ",
            "lineNumber": 664
          },
          {
            "text": "  const personStats = useMemo(() =&gt; {",
            "lineNumber": 665
          },
          {
            "text": "    if (!person) return null;",
            "lineNumber": 666
          },
          {
            "text": "    let totalSize = 0;",
            "lineNumber": 667
          },
          {
            "text": "    let count = 0;",
            "lineNumber": 668
          },
          {
            "text": "    Object.values(files).forEach((f: FileNode) =&gt; {",
            "lineNumber": 669
          },
          {
            "text": "        if (f.type === FileType.IMAGE &amp;&amp; f.aiData?.faces.some(face =&gt; face.personId === person.id)) {",
            "lineNumber": 670
          },
          {
            "text": "            totalSize += f.meta?.sizeKb || 0;",
            "lineNumber": 671
          },
          {
            "text": "            count++;",
            "lineNumber": 672
          },
          {
            "text": "        }",
            "lineNumber": 673
          },
          {
            "text": "    });",
            "lineNumber": 674
          },
          {
            "text": "    return { totalSize, count };",
            "lineNumber": 675
          },
          {
            "text": "  },;",
            "lineNumber": 676
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.363301157951355
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 152
          },
          "endPosition": {
            "line": 291,
            "column": 2
          }
        },
        "contents": "const extractPalette = async \n(resolve) =&gt; {\n() =&gt; {\n\n                \n                // Pass 2: Relax slightly only if we have very few colors\n                if (finalPalette.length &lt; 5) {\n                    for (const c of sorted) {\n                        if (finalPalette.length &gt;= 8) break;\n                        addColor(c, 30);\n                    }\n                }\n                \n                // We DO NOT force 8 colors. If we only found 4 distinct ones, we return 4.\n\n                resolve(finalPalette.map(p =&gt; p.hex));\n                \n            } catch(e) {\n                console.error(\"Pixel access failed\", e);\n                resolve([]);\n            }\n        };\n        img.onerror = () =&gt; resolve([]);\n    });\n};\n\nconst CategorySelector = ({ current, onChange, t }: any) =&gt; (\n  &lt;div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-800\"&gt;\n      &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2\"&gt;{t('meta.folderCategory')}&lt;/div&gt;\n      &lt;div className=\"flex bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl gap-2\"&gt;\n          {['general', 'book', 'sequence'].map((cat) =&gt; {\n              const isActive = current === cat;\n              return (\n                  &lt;button\n                      key={cat}\n                      onClick={() =&gt; onChange(cat)}\n                      className={&#96;flex-1 flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all ${\n                          isActive\n                          ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-md ring-1 ring-black/5 dark:ring-white/10' \n                          : 'text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-100'\n                      }&#96;}\n                  &gt;\n                      {cat === 'general' &amp;&amp; &lt;Folder size={20} className={&#96;mb-1.5 ${isActive ? 'fill-blue-100 dark:fill-blue-900/30' : ''}&#96;}/&gt;}\n                      {cat === 'book' &amp;&amp; &lt;Book size={20} className={&#96;mb-1.5 ${isActive ? 'fill-amber-100 dark:fill-amber-900/30' : ''}&#96;}/&gt;}\n                      {cat === 'sequence' &amp;&amp; &lt;Film size={20} className={&#96;mb-1.5 ${isActive ? 'fill-purple-100 dark:fill-purple-900/30' : ''}&#96;}/&gt;}\n                      {t(&#96;meta.cat${cat.charAt(0).toUpperCase() + cat.slice(1)}&#96;)}\n                  &lt;/button&gt;\n              );\n          })}\n      &lt;/div&gt;\n  &lt;/div&gt;\n);",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const extractPalette = async ",
            "lineNumber": 153
          },
          {
            "text": "(resolve) =&gt; {",
            "lineNumber": 154
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 158
          },
          {
            "lineNumber": 244
          },
          {
            "text": "                ",
            "lineNumber": 245
          },
          {
            "text": "                // Pass 2: Relax slightly only if we have very few colors",
            "lineNumber": 246
          },
          {
            "text": "                if (finalPalette.length &lt; 5) {",
            "lineNumber": 247
          },
          {
            "text": "                    for (const c of sorted) {",
            "lineNumber": 248
          },
          {
            "text": "                        if (finalPalette.length &gt;= 8) break;",
            "lineNumber": 249
          },
          {
            "text": "                        addColor(c, 30);",
            "lineNumber": 250
          },
          {
            "text": "                    }",
            "lineNumber": 251
          },
          {
            "text": "                }",
            "lineNumber": 252
          },
          {
            "text": "                ",
            "lineNumber": 253
          },
          {
            "text": "                // We DO NOT force 8 colors. If we only found 4 distinct ones, we return 4.",
            "lineNumber": 254
          },
          {
            "lineNumber": 255
          },
          {
            "text": "                resolve(finalPalette.map(p =&gt; p.hex));",
            "lineNumber": 256
          },
          {
            "text": "                ",
            "lineNumber": 257
          },
          {
            "text": "            } catch(e) {",
            "lineNumber": 258
          },
          {
            "text": "                console.error(\"Pixel access failed\", e);",
            "lineNumber": 259
          },
          {
            "text": "                resolve([]);",
            "lineNumber": 260
          },
          {
            "text": "            }",
            "lineNumber": 261
          },
          {
            "text": "        };",
            "lineNumber": 262
          },
          {
            "text": "        img.onerror = () =&gt; resolve([]);",
            "lineNumber": 263
          },
          {
            "text": "    });",
            "lineNumber": 264
          },
          {
            "text": "};",
            "lineNumber": 265
          },
          {
            "lineNumber": 266
          },
          {
            "text": "const CategorySelector = ({ current, onChange, t }: any) =&gt; (",
            "lineNumber": 267
          },
          {
            "text": "  &lt;div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-800\"&gt;",
            "lineNumber": 268
          },
          {
            "text": "      &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2\"&gt;{t('meta.folderCategory')}&lt;/div&gt;",
            "lineNumber": 269
          },
          {
            "text": "      &lt;div className=\"flex bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl gap-2\"&gt;",
            "lineNumber": 270
          },
          {
            "text": "          {['general', 'book', 'sequence'].map((cat) =&gt; {",
            "lineNumber": 271
          },
          {
            "text": "              const isActive = current === cat;",
            "lineNumber": 272
          },
          {
            "text": "              return (",
            "lineNumber": 273
          },
          {
            "text": "                  &lt;button",
            "lineNumber": 274
          },
          {
            "text": "                      key={cat}",
            "lineNumber": 275
          },
          {
            "text": "                      onClick={() =&gt; onChange(cat)}",
            "lineNumber": 276
          },
          {
            "text": "                      className={&#96;flex-1 flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all ${",
            "lineNumber": 277
          },
          {
            "text": "                          isActive",
            "lineNumber": 278
          },
          {
            "text": "                          ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-md ring-1 ring-black/5 dark:ring-white/10' ",
            "lineNumber": 279
          },
          {
            "text": "                          : 'text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-100'",
            "lineNumber": 280
          },
          {
            "text": "                      }&#96;}",
            "lineNumber": 281
          },
          {
            "text": "                  &gt;",
            "lineNumber": 282
          },
          {
            "text": "                      {cat === 'general' &amp;&amp; &lt;Folder size={20} className={&#96;mb-1.5 ${isActive ? 'fill-blue-100 dark:fill-blue-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 283
          },
          {
            "text": "                      {cat === 'book' &amp;&amp; &lt;Book size={20} className={&#96;mb-1.5 ${isActive ? 'fill-amber-100 dark:fill-amber-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 284
          },
          {
            "text": "                      {cat === 'sequence' &amp;&amp; &lt;Film size={20} className={&#96;mb-1.5 ${isActive ? 'fill-purple-100 dark:fill-purple-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 285
          },
          {
            "text": "                      {t(&#96;meta.cat${cat.charAt(0).toUpperCase() + cat.slice(1)}&#96;)}",
            "lineNumber": 286
          },
          {
            "text": "                  &lt;/button&gt;",
            "lineNumber": 287
          },
          {
            "text": "              );",
            "lineNumber": 288
          },
          {
            "text": "          })}",
            "lineNumber": 289
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 290
          },
          {
            "text": "  &lt;/div&gt;",
            "lineNumber": 291
          },
          {
            "text": ");",
            "lineNumber": 292
          }
        ]
      },
      "score": 0.35113129019737244
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst personStats = () =&gt; {\n(f: FileNode) =&gt; {\n\n            count++;\n        }\n    });\n    return { totalSize, count };\n  }, [person, files]);\n  \n  const batchStats = useMemo(() =&gt; {\n    if (!isMulti) return null;\n    const selectedNodes = selectedFileIds.map(id =&gt; files[id]).filter(Boolean);\n    \n    let totalSize = 0;\n    const typeCount: Record&lt;string, number&gt; = {};\n    const allTags = new Set&lt;string&gt;();\n\n    selectedNodes.forEach(node =&gt; {\n        if (node.type === FileType.IMAGE) {\n            totalSize += node.meta?.sizeKb || 0;\n            const fmt = node.meta?.format.toUpperCase() || 'UNKNOWN';\n            typeCount[fmt] = (typeCount[fmt] || 0) + 1;\n        } else {\n            typeCount['FOLDER'] = (typeCount['FOLDER'] || 0) + 1;\n            const fs = getFolderStats(files, node.id);\n            totalSize += fs.size;\n        }\n        node.tags.forEach(t =&gt; allTags.add(t));\n    });\n\n    return { totalSize, typeCount, allTags: Array.from(allTags).sort() };\n  },;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "const personStats = () =&gt; {",
            "lineNumber": 665
          },
          {
            "text": "(f: FileNode) =&gt; {",
            "lineNumber": 669
          },
          {
            "lineNumber": 671
          },
          {
            "text": "            count++;",
            "lineNumber": 672
          },
          {
            "text": "        }",
            "lineNumber": 673
          },
          {
            "text": "    });",
            "lineNumber": 674
          },
          {
            "text": "    return { totalSize, count };",
            "lineNumber": 675
          },
          {
            "text": "  }, [person, files]);",
            "lineNumber": 676
          },
          {
            "text": "  ",
            "lineNumber": 677
          },
          {
            "text": "  const batchStats = useMemo(() =&gt; {",
            "lineNumber": 678
          },
          {
            "text": "    if (!isMulti) return null;",
            "lineNumber": 679
          },
          {
            "text": "    const selectedNodes = selectedFileIds.map(id =&gt; files[id]).filter(Boolean);",
            "lineNumber": 680
          },
          {
            "text": "    ",
            "lineNumber": 681
          },
          {
            "text": "    let totalSize = 0;",
            "lineNumber": 682
          },
          {
            "text": "    const typeCount: Record&lt;string, number&gt; = {};",
            "lineNumber": 683
          },
          {
            "text": "    const allTags = new Set&lt;string&gt;();",
            "lineNumber": 684
          },
          {
            "lineNumber": 685
          },
          {
            "text": "    selectedNodes.forEach(node =&gt; {",
            "lineNumber": 686
          },
          {
            "text": "        if (node.type === FileType.IMAGE) {",
            "lineNumber": 687
          },
          {
            "text": "            totalSize += node.meta?.sizeKb || 0;",
            "lineNumber": 688
          },
          {
            "text": "            const fmt = node.meta?.format.toUpperCase() || 'UNKNOWN';",
            "lineNumber": 689
          },
          {
            "text": "            typeCount[fmt] = (typeCount[fmt] || 0) + 1;",
            "lineNumber": 690
          },
          {
            "text": "        } else {",
            "lineNumber": 691
          },
          {
            "text": "            typeCount['FOLDER'] = (typeCount['FOLDER'] || 0) + 1;",
            "lineNumber": 692
          },
          {
            "text": "            const fs = getFolderStats(files, node.id);",
            "lineNumber": 693
          },
          {
            "text": "            totalSize += fs.size;",
            "lineNumber": 694
          },
          {
            "text": "        }",
            "lineNumber": 695
          },
          {
            "text": "        node.tags.forEach(t =&gt; allTags.add(t));",
            "lineNumber": 696
          },
          {
            "text": "    });",
            "lineNumber": 697
          },
          {
            "lineNumber": 698
          },
          {
            "text": "    return { totalSize, typeCount, allTags: Array.from(allTags).sort() };",
            "lineNumber": 699
          },
          {
            "text": "  },;",
            "lineNumber": 700
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.3427462875843048
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst handleRemoveTag = \nid =&gt; {\n\n              }\n          });\n      } else if (file) {\n          onUpdate(file.id, { tags: file.tags.filter(t =&gt; t !== tag) });\n      }\n  };\n\n  const copyToClipboard = (text: string) =&gt; {\n      navigator.clipboard.writeText(text);\n      setToast({ msg: t('context.copied'), visible: true });\n      setTimeout(() =&gt; setToast({ msg: '', visible: false }), 2000);\n  };\n\n  const handleCategoryChange = (category: 'general' | 'book' | 'sequence') =&gt; {\n      if (isMulti) {\n          selectedFileIds.forEach(id =&gt; {\n              if (files[id]?.type === FileType.FOLDER) {\n                  onUpdate(id, { category });\n              }\n          });\n      } else if (file &amp;&amp; file.type === FileType.FOLDER) {\n          onUpdate(file.id, { category });\n      }\n  };\n\n  if (person) {\n      const coverFile = files[person.coverFileId];\n      const coverUrl = coverFile?.path ? convertFileSrc(coverFile.path) : null;\n\n      return (\n        &lt;div className=\"h-full flex flex-col bg-white dark:bg-gray-900 overflow-y-auto custom-scrollbar relative\"&gt;\n          \n          {/* Hero Header */}\n          &lt;div className=\"relative\"&gt;\n             {/* Blurred Background */}\n             &lt;div className=\"absolute inset-0 overflow-hidden h-40 z-0\"&gt;\n                {coverUrl ? (\n                    &lt;img src={coverUrl}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "const handleRemoveTag = ",
            "lineNumber": 766
          },
          {
            "text": "id =&gt; {",
            "lineNumber": 768
          },
          {
            "lineNumber": 771
          },
          {
            "text": "              }",
            "lineNumber": 772
          },
          {
            "text": "          });",
            "lineNumber": 773
          },
          {
            "text": "      } else if (file) {",
            "lineNumber": 774
          },
          {
            "text": "          onUpdate(file.id, { tags: file.tags.filter(t =&gt; t !== tag) });",
            "lineNumber": 775
          },
          {
            "text": "      }",
            "lineNumber": 776
          },
          {
            "text": "  };",
            "lineNumber": 777
          },
          {
            "lineNumber": 778
          },
          {
            "text": "  const copyToClipboard = (text: string) =&gt; {",
            "lineNumber": 779
          },
          {
            "text": "      navigator.clipboard.writeText(text);",
            "lineNumber": 780
          },
          {
            "text": "      setToast({ msg: t('context.copied'), visible: true });",
            "lineNumber": 781
          },
          {
            "text": "      setTimeout(() =&gt; setToast({ msg: '', visible: false }), 2000);",
            "lineNumber": 782
          },
          {
            "text": "  };",
            "lineNumber": 783
          },
          {
            "lineNumber": 784
          },
          {
            "text": "  const handleCategoryChange = (category: 'general' | 'book' | 'sequence') =&gt; {",
            "lineNumber": 785
          },
          {
            "text": "      if (isMulti) {",
            "lineNumber": 786
          },
          {
            "text": "          selectedFileIds.forEach(id =&gt; {",
            "lineNumber": 787
          },
          {
            "text": "              if (files[id]?.type === FileType.FOLDER) {",
            "lineNumber": 788
          },
          {
            "text": "                  onUpdate(id, { category });",
            "lineNumber": 789
          },
          {
            "text": "              }",
            "lineNumber": 790
          },
          {
            "text": "          });",
            "lineNumber": 791
          },
          {
            "text": "      } else if (file &amp;&amp; file.type === FileType.FOLDER) {",
            "lineNumber": 792
          },
          {
            "text": "          onUpdate(file.id, { category });",
            "lineNumber": 793
          },
          {
            "text": "      }",
            "lineNumber": 794
          },
          {
            "text": "  };",
            "lineNumber": 795
          },
          {
            "lineNumber": 796
          },
          {
            "text": "  if (person) {",
            "lineNumber": 797
          },
          {
            "text": "      const coverFile = files[person.coverFileId];",
            "lineNumber": 798
          },
          {
            "text": "      const coverUrl = coverFile?.path ? convertFileSrc(coverFile.path) : null;",
            "lineNumber": 799
          },
          {
            "lineNumber": 800
          },
          {
            "text": "      return (",
            "lineNumber": 801
          },
          {
            "text": "        &lt;div className=\"h-full flex flex-col bg-white dark:bg-gray-900 overflow-y-auto custom-scrollbar relative\"&gt;",
            "lineNumber": 802
          },
          {
            "text": "          ",
            "lineNumber": 803
          },
          {
            "text": "          {/* Hero Header */}",
            "lineNumber": 804
          },
          {
            "text": "          &lt;div className=\"relative\"&gt;",
            "lineNumber": 805
          },
          {
            "text": "             {/* Blurred Background */}",
            "lineNumber": 806
          },
          {
            "text": "             &lt;div className=\"absolute inset-0 overflow-hidden h-40 z-0\"&gt;",
            "lineNumber": 807
          },
          {
            "text": "                {coverUrl ? (",
            "lineNumber": 808
          },
          {
            "text": "                    &lt;img src={coverUrl}",
            "lineNumber": 809
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.3386116921901703
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst batchStats = () =&gt; {\n\n\n    return { totalSize, typeCount, allTags: Array.from(allTags).sort() };\n  }, [selectedFileIds, files]);\n\n  const batchChartData = useMemo(() =&gt; {\n      if (!batchStats) return [];\n      const data: { label: string; value: number; color: string }[] = [];\n\n      Object.entries(batchStats.typeCount).forEach(([type, count]) =&gt; {\n          let label = type;\n          let colorKey = type;\n          if (type === 'FOLDER') {\n              label = t('meta.folderType');\n              colorKey = 'FOLDER';\n          }\n          data.push({\n              label: label,\n              value: count,\n              color: typeColors[colorKey] || defaultColor\n          });\n      });\n\n      return data.sort((a, b) =&gt; b.value - a.value);\n  }, [batchStats, t]);\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "const batchStats = () =&gt; {",
            "lineNumber": 678
          },
          {
            "lineNumber": 697
          },
          {
            "lineNumber": 698
          },
          {
            "text": "    return { totalSize, typeCount, allTags: Array.from(allTags).sort() };",
            "lineNumber": 699
          },
          {
            "text": "  }, [selectedFileIds, files]);",
            "lineNumber": 700
          },
          {
            "lineNumber": 701
          },
          {
            "text": "  const batchChartData = useMemo(() =&gt; {",
            "lineNumber": 702
          },
          {
            "text": "      if (!batchStats) return [];",
            "lineNumber": 703
          },
          {
            "text": "      const data: { label: string; value: number; color: string }[] = [];",
            "lineNumber": 704
          },
          {
            "lineNumber": 705
          },
          {
            "text": "      Object.entries(batchStats.typeCount).forEach(([type, count]) =&gt; {",
            "lineNumber": 706
          },
          {
            "text": "          let label = type;",
            "lineNumber": 707
          },
          {
            "text": "          let colorKey = type;",
            "lineNumber": 708
          },
          {
            "text": "          if (type === 'FOLDER') {",
            "lineNumber": 709
          },
          {
            "text": "              label = t('meta.folderType');",
            "lineNumber": 710
          },
          {
            "text": "              colorKey = 'FOLDER';",
            "lineNumber": 711
          },
          {
            "text": "          }",
            "lineNumber": 712
          },
          {
            "text": "          data.push({",
            "lineNumber": 713
          },
          {
            "text": "              label: label,",
            "lineNumber": 714
          },
          {
            "text": "              value: count,",
            "lineNumber": 715
          },
          {
            "text": "              color: typeColors[colorKey] || defaultColor",
            "lineNumber": 716
          },
          {
            "text": "          });",
            "lineNumber": 717
          },
          {
            "text": "      });",
            "lineNumber": 718
          },
          {
            "lineNumber": 719
          },
          {
            "text": "      return data.sort((a, b) =&gt; b.value - a.value);",
            "lineNumber": 720
          },
          {
            "text": "  }, [batchStats, t]);",
            "lineNumber": 721
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.31575846672058105
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n\n          &lt;/div&gt;\n\n          &lt;button onClick={handleOriginalSize} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('viewer.original')}&gt;\n             &lt;span className=\"text-xs font-bold\"&gt;1:1&lt;/span&gt;\n          &lt;/button&gt;\n          &lt;button onClick={handleReset} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400\" title={t('viewer.fit')}&gt;\n            &lt;Maximize size={18} /&gt;\n          &lt;/button&gt;\n          &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1 hidden sm:block\"&gt;&lt;/div&gt;\n          &lt;button onClick={() =&gt; rotate(-90)} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('viewer.rotateLeft')}&gt;\n            &lt;RotateCcw size={18} /&gt;\n          &lt;/button&gt;\n          &lt;button onClick={() =&gt; rotate(90)} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('viewer.rotateRight')}&gt;\n            &lt;RotateCw size={18} /&gt;\n          &lt;/button&gt;\n          &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;\n          \n          &lt;button \n            onClick={() =&gt; setShowSearch(!showSearch)} \n            className={&#96;p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 ${showSearch || localQuery ? 'text-blue-500 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}&#96;} \n            title={t('viewer.search')}\n          &gt;\n            &lt;Search size={18} /&gt;\n          &lt;/button&gt;\n          \n          &lt;button \n            onClick={() =&gt; onLayoutToggle('metadata')}\n            className={&#96;p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 ${layout.isMetadataVisible ? 'text-blue-500 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}&#96;}\n            title={t('viewer.toggleMeta')}\n          &gt;\n            &lt;PanelRight size={18} /&gt;\n          &lt;/button&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n\n      &lt;div \n        ref={containerRef}\n        className={&#96;flex-1 overflow-hidden relative cursor-grab active:cursor-grabbing transition-colors duration-300 \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "lineNumber": 545
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 546
          },
          {
            "lineNumber": 547
          },
          {
            "text": "          &lt;button onClick={handleOriginalSize} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('viewer.original')}&gt;",
            "lineNumber": 548
          },
          {
            "text": "             &lt;span className=\"text-xs font-bold\"&gt;1:1&lt;/span&gt;",
            "lineNumber": 549
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 550
          },
          {
            "text": "          &lt;button onClick={handleReset} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400\" title={t('viewer.fit')}&gt;",
            "lineNumber": 551
          },
          {
            "text": "            &lt;Maximize size={18} /&gt;",
            "lineNumber": 552
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 553
          },
          {
            "text": "          &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1 hidden sm:block\"&gt;&lt;/div&gt;",
            "lineNumber": 554
          },
          {
            "text": "          &lt;button onClick={() =&gt; rotate(-90)} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('viewer.rotateLeft')}&gt;",
            "lineNumber": 555
          },
          {
            "text": "            &lt;RotateCcw size={18} /&gt;",
            "lineNumber": 556
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 557
          },
          {
            "text": "          &lt;button onClick={() =&gt; rotate(90)} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('viewer.rotateRight')}&gt;",
            "lineNumber": 558
          },
          {
            "text": "            &lt;RotateCw size={18} /&gt;",
            "lineNumber": 559
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 560
          },
          {
            "text": "          &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;",
            "lineNumber": 561
          },
          {
            "text": "          ",
            "lineNumber": 562
          },
          {
            "text": "          &lt;button ",
            "lineNumber": 563
          },
          {
            "text": "            onClick={() =&gt; setShowSearch(!showSearch)} ",
            "lineNumber": 564
          },
          {
            "text": "            className={&#96;p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 ${showSearch || localQuery ? 'text-blue-500 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}&#96;} ",
            "lineNumber": 565
          },
          {
            "text": "            title={t('viewer.search')}",
            "lineNumber": 566
          },
          {
            "text": "          &gt;",
            "lineNumber": 567
          },
          {
            "text": "            &lt;Search size={18} /&gt;",
            "lineNumber": 568
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 569
          },
          {
            "text": "          ",
            "lineNumber": 570
          },
          {
            "text": "          &lt;button ",
            "lineNumber": 571
          },
          {
            "text": "            onClick={() =&gt; onLayoutToggle('metadata')}",
            "lineNumber": 572
          },
          {
            "text": "            className={&#96;p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 ${layout.isMetadataVisible ? 'text-blue-500 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}&#96;}",
            "lineNumber": 573
          },
          {
            "text": "            title={t('viewer.toggleMeta')}",
            "lineNumber": 574
          },
          {
            "text": "          &gt;",
            "lineNumber": 575
          },
          {
            "text": "            &lt;PanelRight size={18} /&gt;",
            "lineNumber": 576
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 577
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 578
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 579
          },
          {
            "lineNumber": 580
          },
          {
            "text": "      &lt;div ",
            "lineNumber": 581
          },
          {
            "text": "        ref={containerRef}",
            "lineNumber": 582
          },
          {
            "text": "        className={&#96;flex-1 overflow-hidden relative cursor-grab active:cursor-grabbing transition-colors duration-300 ",
            "lineNumber": 583
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.2934015393257141
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "column": 62
          },
          "endPosition": {
            "line": 38,
            "column": 1
          }
        },
        "contents": "import React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';\n\n// 辅助函数：深度查找文件夹内的图片\nconst findImagesDeeply = (\n    rootFolder: FileNode, \n    allFiles: Record&lt;string, FileNode&gt;, \n    limit: number = 3\n): FileNode[] =&gt; {\n    const images: FileNode[] = [];\n    // 使用栈进行 DFS\n    const stack: string[] = [...(rootFolder.children || [])];\n    const visited = new Set&lt;string&gt;(); // 防止循环引用\n    \n    // 设置一个遍历上限，防止超大文件夹卡死 UI\n    let traversalCount = 0;\n    const MAX_TRAVERSAL = 200;\n\n    while (stack.length &gt; 0 &amp;&amp; images.length &lt; limit &amp;&amp; traversalCount &lt; MAX_TRAVERSAL) {\n        const id = stack.pop()!;\n        if (visited.has(id)) continue;\n        visited.add(id);\n        traversalCount++;\n\n        const node = allFiles[id];\n    }\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "// 辅助函数：深度查找文件夹内的图片",
            "lineNumber": 4
          },
          {
            "text": "const findImagesDeeply = (",
            "lineNumber": 5
          },
          {
            "text": "    rootFolder: FileNode, ",
            "lineNumber": 6
          },
          {
            "text": "    allFiles: Record&lt;string, FileNode&gt;, ",
            "lineNumber": 7
          },
          {
            "text": "    limit: number = 3",
            "lineNumber": 8
          },
          {
            "text": "): FileNode[] =&gt; {",
            "lineNumber": 9
          },
          {
            "text": "    const images: FileNode[] = [];",
            "lineNumber": 10
          },
          {
            "text": "    // 使用栈进行 DFS",
            "lineNumber": 11
          },
          {
            "text": "    const stack: string[] = [...(rootFolder.children || [])];",
            "lineNumber": 12
          },
          {
            "text": "    const visited = new Set&lt;string&gt;(); // 防止循环引用",
            "lineNumber": 13
          },
          {
            "text": "    ",
            "lineNumber": 14
          },
          {
            "text": "    // 设置一个遍历上限，防止超大文件夹卡死 UI",
            "lineNumber": 15
          },
          {
            "text": "    let traversalCount = 0;",
            "lineNumber": 16
          },
          {
            "text": "    const MAX_TRAVERSAL = 200;",
            "lineNumber": 17
          },
          {
            "lineNumber": 18
          },
          {
            "text": "    while (stack.length &gt; 0 &amp;&amp; images.length &lt; limit &amp;&amp; traversalCount &lt; MAX_TRAVERSAL) {",
            "lineNumber": 19
          },
          {
            "text": "        const id = stack.pop()!;",
            "lineNumber": 20
          },
          {
            "text": "        if (visited.has(id)) continue;",
            "lineNumber": 21
          },
          {
            "text": "        visited.add(id);",
            "lineNumber": 22
          },
          {
            "text": "        traversalCount++;",
            "lineNumber": 23
          },
          {
            "lineNumber": 24
          },
          {
            "text": "        const node = allFiles[id];",
            "lineNumber": 25
          },
          {
            "text": "    }",
            "lineNumber": 33
          },
          {
            "text": ";",
            "lineNumber": 39
          }
        ]
      },
      "score": 0.2932054400444031
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst batchChartData = () =&gt; {\n\n\n      return data.sort((a, b) =&gt; b.value - a.value);\n  }, [batchStats, t]);\n\n  const handleUpdateMeta = () =&gt; {\n    if (isMulti) {\n        selectedFileIds.forEach(id =&gt; {\n            const updates: Partial&lt;FileNode&gt; = {};\n            if (!isDescMixed &amp;&amp; batchDesc) updates.description = batchDesc;\n            if (!isSourceMixed &amp;&amp; batchSource) updates.sourceUrl = batchSource;\n            if (Object.keys(updates).length &gt; 0) onUpdate(id, updates);\n        });\n    } else if (file) {\n        onUpdate(file.id, { name, description: desc, sourceUrl: source });\n    }\n    setShowSavedDesc(true);\n    setShowSavedSource(true);\n    setTimeout(() =&gt; {\n        setShowSavedDesc(false);\n        setShowSavedSource(false);\n    }, 2000);\n  };\n\n  const handleUpdatePersonMeta = () =&gt; {\n      if (person &amp;&amp; onUpdatePerson) {\n          onUpdatePerson\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "const batchChartData = () =&gt; {",
            "lineNumber": 702
          },
          {
            "lineNumber": 718
          },
          {
            "lineNumber": 719
          },
          {
            "text": "      return data.sort((a, b) =&gt; b.value - a.value);",
            "lineNumber": 720
          },
          {
            "text": "  }, [batchStats, t]);",
            "lineNumber": 721
          },
          {
            "lineNumber": 722
          },
          {
            "text": "  const handleUpdateMeta = () =&gt; {",
            "lineNumber": 723
          },
          {
            "text": "    if (isMulti) {",
            "lineNumber": 724
          },
          {
            "text": "        selectedFileIds.forEach(id =&gt; {",
            "lineNumber": 725
          },
          {
            "text": "            const updates: Partial&lt;FileNode&gt; = {};",
            "lineNumber": 726
          },
          {
            "text": "            if (!isDescMixed &amp;&amp; batchDesc) updates.description = batchDesc;",
            "lineNumber": 727
          },
          {
            "text": "            if (!isSourceMixed &amp;&amp; batchSource) updates.sourceUrl = batchSource;",
            "lineNumber": 728
          },
          {
            "text": "            if (Object.keys(updates).length &gt; 0) onUpdate(id, updates);",
            "lineNumber": 729
          },
          {
            "text": "        });",
            "lineNumber": 730
          },
          {
            "text": "    } else if (file) {",
            "lineNumber": 731
          },
          {
            "text": "        onUpdate(file.id, { name, description: desc, sourceUrl: source });",
            "lineNumber": 732
          },
          {
            "text": "    }",
            "lineNumber": 733
          },
          {
            "text": "    setShowSavedDesc(true);",
            "lineNumber": 734
          },
          {
            "text": "    setShowSavedSource(true);",
            "lineNumber": 735
          },
          {
            "text": "    setTimeout(() =&gt; {",
            "lineNumber": 736
          },
          {
            "text": "        setShowSavedDesc(false);",
            "lineNumber": 737
          },
          {
            "text": "        setShowSavedSource(false);",
            "lineNumber": 738
          },
          {
            "text": "    }, 2000);",
            "lineNumber": 739
          },
          {
            "text": "  };",
            "lineNumber": 740
          },
          {
            "lineNumber": 741
          },
          {
            "text": "  const handleUpdatePersonMeta = () =&gt; {",
            "lineNumber": 742
          },
          {
            "text": "      if (person &amp;&amp; onUpdatePerson) {",
            "lineNumber": 743
          },
          {
            "text": "          onUpdatePerson",
            "lineNumber": 744
          },
          {
            "text": ";",
            "lineNumber": 748
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.2906738519668579
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 467
          },
          "endPosition": {
            "line": 584,
            "column": 1
          }
        },
        "contents": "export const Sidebar: React.FC&lt;{\n  roots: string[];\n  files: Record&lt;string, FileNode&gt;;\n  people: Record&lt;string, Person&gt;;\n  customTags: string[];\n  currentFolderId: string;\n  expandedIds: string[];\n  tasks?: TaskProgress[];\n  onToggle: (id: string) =&gt; void;\n  onNavigate: (id: string) =&gt; void;\n  onTagSelect: (tag: string) =&gt; void;\n  onNavigateAllTags: () =&gt; void;\n  onPersonSelect: (personId: string) =&gt; void;\n  onNavigateAllPeople: () =&gt; void;\n  onContextMenu: (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'person', id: string) =&gt; void;\n  onDrop: (targetId: string, sourceIds: string[]) =&gt; void;\n  onDropOnTag: (tag: string, sourceIds: string[]) =&gt; void;\n  isCreatingTag: boolean;\n  onStartCreateTag: () =&gt; void;\n  onSaveNewTag: (tag: string) =&gt; void;\n  onCancelCreateTag: () =&gt; void;\n  onOpenSettings: () =&gt; void;\n  onRestoreTask: (taskId: string) =&gt; void;\n  onStartRenamePerson: (personId: string) =&gt; void;\n  onCreatePerson: () =&gt; void;\n  t: (key: string) =&gt; string;\n}&gt; =  {\n  \n  const minimizedTasks = tasks ? tasks.filter(task =&gt; task.minimized &amp;&amp; task.status === 'running') : [];\n\n  return (\n    &lt;div className=\"w-full h-full flex flex-col\"&gt;\n      &lt;div className=\"p-3 font-bold text-gray-500 dark:text-gray-400 text-xs uppercase tracking-wider border-b border-gray-200 dark:border-gray-800\"&gt;\n        {t('sidebar.catalog')}\n      &lt;/div&gt;\n      &lt;div className=\"flex-1 overflow-y-auto scrollbar-thin\"&gt;\n        {roots.map(rootId =&gt; (\n          &lt;TreeNode \n            key={rootId}\n            files={files}\n            nodeId={rootId}\n            currentFolderId={currentFolderId}\n            expandedIds={expandedIds}\n            onToggle={onToggle}\n            onNavigate={onNavigate}\n            onContextMenu={onContextMenu}\n            onDrop={onDrop}\n          /&gt;\n        ))}\n        \n        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;\n        \n        &lt;PeopleSection \n           people={people}\n           files={files}\n           onPersonSelect={onPersonSelect}\n           onNavigateAllPeople={onNavigateAllPeople}\n           onContextMenu={onContextMenu}\n           onStartRenamePerson={onStartRenamePerson}\n           onCreatePerson={onCreatePerson}\n           t={t}\n        /&gt;\n\n        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;\n        \n        &lt;TagSection \n          files={files} \n          customTags={customTags}\n          onTagSelect={onTagSelect} \n          onNavigateAllTags={onNavigateAllTags} \n          onContextMenu={onContextMenu}\n          isCreatingTag={isCreatingTag}\n          onStartCreateTag={onStartCreateTag}\n          onSaveNewTag={onSaveNewTag}\n          onCancelCreateTag={onCancelCreateTag}\n          onDropOnTag={onDropOnTag}\n          t={t}\n        /&gt;\n      &lt;/div&gt;\n      \n      {minimizedTasks.length &gt; 0 &amp;&amp;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 468,
                "column": 1
              },
              "endPosition": {
                "line": 468,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 468,
                "column": 8
              },
              "endPosition": {
                "line": 468,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 468,
                "column": 14
              },
              "endPosition": {
                "line": 494,
                "column": 6
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const Sidebar: React.FC&lt;{",
            "lineNumber": 468
          },
          {
            "text": "  roots: string[];",
            "lineNumber": 469
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 470
          },
          {
            "text": "  people: Record&lt;string, Person&gt;;",
            "lineNumber": 471
          },
          {
            "text": "  customTags: string[];",
            "lineNumber": 472
          },
          {
            "text": "  currentFolderId: string;",
            "lineNumber": 473
          },
          {
            "text": "  expandedIds: string[];",
            "lineNumber": 474
          },
          {
            "text": "  tasks?: TaskProgress[];",
            "lineNumber": 475
          },
          {
            "text": "  onToggle: (id: string) =&gt; void;",
            "lineNumber": 476
          },
          {
            "text": "  onNavigate: (id: string) =&gt; void;",
            "lineNumber": 477
          },
          {
            "text": "  onTagSelect: (tag: string) =&gt; void;",
            "lineNumber": 478
          },
          {
            "text": "  onNavigateAllTags: () =&gt; void;",
            "lineNumber": 479
          },
          {
            "text": "  onPersonSelect: (personId: string) =&gt; void;",
            "lineNumber": 480
          },
          {
            "text": "  onNavigateAllPeople: () =&gt; void;",
            "lineNumber": 481
          },
          {
            "text": "  onContextMenu: (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'person', id: string) =&gt; void;",
            "lineNumber": 482
          },
          {
            "text": "  onDrop: (targetId: string, sourceIds: string[]) =&gt; void;",
            "lineNumber": 483
          },
          {
            "text": "  onDropOnTag: (tag: string, sourceIds: string[]) =&gt; void;",
            "lineNumber": 484
          },
          {
            "text": "  isCreatingTag: boolean;",
            "lineNumber": 485
          },
          {
            "text": "  onStartCreateTag: () =&gt; void;",
            "lineNumber": 486
          },
          {
            "text": "  onSaveNewTag: (tag: string) =&gt; void;",
            "lineNumber": 487
          },
          {
            "text": "  onCancelCreateTag: () =&gt; void;",
            "lineNumber": 488
          },
          {
            "text": "  onOpenSettings: () =&gt; void;",
            "lineNumber": 489
          },
          {
            "text": "  onRestoreTask: (taskId: string) =&gt; void;",
            "lineNumber": 490
          },
          {
            "text": "  onStartRenamePerson: (personId: string) =&gt; void;",
            "lineNumber": 491
          },
          {
            "text": "  onCreatePerson: () =&gt; void;",
            "lineNumber": 492
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 493
          },
          {
            "text": "}&gt; =  {",
            "lineNumber": 494
          },
          {
            "text": "  ",
            "lineNumber": 495
          },
          {
            "text": "  const minimizedTasks = tasks ? tasks.filter(task =&gt; task.minimized &amp;&amp; task.status === 'running') : [];",
            "lineNumber": 496
          },
          {
            "lineNumber": 497
          },
          {
            "text": "  return (",
            "lineNumber": 498
          },
          {
            "text": "    &lt;div className=\"w-full h-full flex flex-col\"&gt;",
            "lineNumber": 499
          },
          {
            "text": "      &lt;div className=\"p-3 font-bold text-gray-500 dark:text-gray-400 text-xs uppercase tracking-wider border-b border-gray-200 dark:border-gray-800\"&gt;",
            "lineNumber": 500
          },
          {
            "text": "        {t('sidebar.catalog')}",
            "lineNumber": 501
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 502
          },
          {
            "text": "      &lt;div className=\"flex-1 overflow-y-auto scrollbar-thin\"&gt;",
            "lineNumber": 503
          },
          {
            "text": "        {roots.map(rootId =&gt; (",
            "lineNumber": 504
          },
          {
            "text": "          &lt;TreeNode ",
            "lineNumber": 505
          },
          {
            "text": "            key={rootId}",
            "lineNumber": 506
          },
          {
            "text": "            files={files}",
            "lineNumber": 507
          },
          {
            "text": "            nodeId={rootId}",
            "lineNumber": 508
          },
          {
            "text": "            currentFolderId={currentFolderId}",
            "lineNumber": 509
          },
          {
            "text": "            expandedIds={expandedIds}",
            "lineNumber": 510
          },
          {
            "text": "            onToggle={onToggle}",
            "lineNumber": 511
          },
          {
            "text": "            onNavigate={onNavigate}",
            "lineNumber": 512
          },
          {
            "text": "            onContextMenu={onContextMenu}",
            "lineNumber": 513
          },
          {
            "text": "            onDrop={onDrop}",
            "lineNumber": 514
          },
          {
            "text": "          /&gt;",
            "lineNumber": 515
          },
          {
            "text": "        ))}",
            "lineNumber": 516
          },
          {
            "text": "        ",
            "lineNumber": 517
          },
          {
            "text": "        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;",
            "lineNumber": 518
          },
          {
            "text": "        ",
            "lineNumber": 519
          },
          {
            "text": "        &lt;PeopleSection ",
            "lineNumber": 520
          },
          {
            "text": "           people={people}",
            "lineNumber": 521
          },
          {
            "text": "           files={files}",
            "lineNumber": 522
          },
          {
            "text": "           onPersonSelect={onPersonSelect}",
            "lineNumber": 523
          },
          {
            "text": "           onNavigateAllPeople={onNavigateAllPeople}",
            "lineNumber": 524
          },
          {
            "text": "           onContextMenu={onContextMenu}",
            "lineNumber": 525
          },
          {
            "text": "           onStartRenamePerson={onStartRenamePerson}",
            "lineNumber": 526
          },
          {
            "text": "           onCreatePerson={onCreatePerson}",
            "lineNumber": 527
          },
          {
            "text": "           t={t}",
            "lineNumber": 528
          },
          {
            "text": "        /&gt;",
            "lineNumber": 529
          },
          {
            "lineNumber": 530
          },
          {
            "text": "        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;",
            "lineNumber": 531
          },
          {
            "text": "        ",
            "lineNumber": 532
          },
          {
            "text": "        &lt;TagSection ",
            "lineNumber": 533
          },
          {
            "text": "          files={files} ",
            "lineNumber": 534
          },
          {
            "text": "          customTags={customTags}",
            "lineNumber": 535
          },
          {
            "text": "          onTagSelect={onTagSelect} ",
            "lineNumber": 536
          },
          {
            "text": "          onNavigateAllTags={onNavigateAllTags} ",
            "lineNumber": 537
          },
          {
            "text": "          onContextMenu={onContextMenu}",
            "lineNumber": 538
          },
          {
            "text": "          isCreatingTag={isCreatingTag}",
            "lineNumber": 539
          },
          {
            "text": "          onStartCreateTag={onStartCreateTag}",
            "lineNumber": 540
          },
          {
            "text": "          onSaveNewTag={onSaveNewTag}",
            "lineNumber": 541
          },
          {
            "text": "          onCancelCreateTag={onCancelCreateTag}",
            "lineNumber": 542
          },
          {
            "text": "          onDropOnTag={onDropOnTag}",
            "lineNumber": 543
          },
          {
            "text": "          t={t}",
            "lineNumber": 544
          },
          {
            "text": "        /&gt;",
            "lineNumber": 545
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 546
          },
          {
            "text": "      ",
            "lineNumber": 547
          },
          {
            "text": "      {minimizedTasks.length &gt; 0 &amp;&amp;",
            "lineNumber": 548
          },
          {
            "text": ";",
            "lineNumber": 585
          }
        ]
      },
      "score": 0.27210450172424316
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 1,
            "column": 80
          },
          "endPosition": {
            "line": 17,
            "column": 73
          }
        },
        "contents": ";\nimport { invoke } from '@tauri-apps/api/core';\nimport { Sidebar } from './components/TreeSidebar';\nimport { MetadataPanel } from './components/MetadataPanel';\nimport { ImageViewer } from './components/ImageViewer';\nimport { SequenceViewer } from './components/SequenceViewer';\nimport { TabBar } from './components/TabBar';\nimport { TopBar } from './components/TopBar';\nimport { FileGrid, InlineRenameInput } from './components/FileGrid';\nimport { SettingsModal } from './components/SettingsModal';\nimport { AuroraLogo } from './components/Logo';\nimport { CloseConfirmationModal } from './components/CloseConfirmationModal';\nimport { initializeFileSystem, formatSize } from './utils/mockFileSystem';\nimport { translations } from './utils/translations';\nimport { scanDirectory, openDirectory, saveUserData as tauriSaveUserData, loadUserData as tauriLoadUserData, getDefaultPaths as tauriGetDefaultPaths, ensureDirectory, createFolder, renameFile, deleteFile, getThumbnail, hideWindow, showWindow, exitApp, copyFile, moveFile } from './api/tauri-bridge';\nimport { AppState, FileNode, FileType, SlideshowConfig, AppSettings, SearchScope, SortOption, TabState, LayoutMode, SUPPORTED_EXTENSIONS, DateFilter, SettingsCategory, AiData, TaskProgress, Person, HistoryItem, AiFace, GroupByOption, FileGroup, DeletionTask, AiSearchFilter } from './types';\nimport { Search, Folder, Image as ImageIcon, ArrowUp, X, FolderOpen, Tag,",
        "signatures": {},
        "detailedLines": [
          {
            "text": ";",
            "lineNumber": 2
          },
          {
            "text": "import { invoke } from '@tauri-apps/api/core';",
            "lineNumber": 3
          },
          {
            "text": "import { Sidebar } from './components/TreeSidebar';",
            "lineNumber": 4
          },
          {
            "text": "import { MetadataPanel } from './components/MetadataPanel';",
            "lineNumber": 5
          },
          {
            "text": "import { ImageViewer } from './components/ImageViewer';",
            "lineNumber": 6
          },
          {
            "text": "import { SequenceViewer } from './components/SequenceViewer';",
            "lineNumber": 7
          },
          {
            "text": "import { TabBar } from './components/TabBar';",
            "lineNumber": 8
          },
          {
            "text": "import { TopBar } from './components/TopBar';",
            "lineNumber": 9
          },
          {
            "text": "import { FileGrid, InlineRenameInput } from './components/FileGrid';",
            "lineNumber": 10
          },
          {
            "text": "import { SettingsModal } from './components/SettingsModal';",
            "lineNumber": 11
          },
          {
            "text": "import { AuroraLogo } from './components/Logo';",
            "lineNumber": 12
          },
          {
            "text": "import { CloseConfirmationModal } from './components/CloseConfirmationModal';",
            "lineNumber": 13
          },
          {
            "text": "import { initializeFileSystem, formatSize } from './utils/mockFileSystem';",
            "lineNumber": 14
          },
          {
            "text": "import { translations } from './utils/translations';",
            "lineNumber": 15
          },
          {
            "text": "import { scanDirectory, openDirectory, saveUserData as tauriSaveUserData, loadUserData as tauriLoadUserData, getDefaultPaths as tauriGetDefaultPaths, ensureDirectory, createFolder, renameFile, deleteFile, getThumbnail, hideWindow, showWindow, exitApp, copyFile, moveFile } from './api/tauri-bridge';",
            "lineNumber": 16
          },
          {
            "text": "import { AppState, FileNode, FileType, SlideshowConfig, AppSettings, SearchScope, SortOption, TabState, LayoutMode, SUPPORTED_EXTENSIONS, DateFilter, SettingsCategory, AiData, TaskProgress, Person, HistoryItem, AiFace, GroupByOption, FileGroup, DeletionTask, AiSearchFilter } from './types';",
            "lineNumber": 17
          },
          {
            "text": "import { Search, Folder, Image as ImageIcon, ArrowUp, X, FolderOpen, Tag,",
            "lineNumber": 18
          }
        ]
      },
      "score": 0.2719992399215698
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\SequenceViewer.tsx",
        "range": {
          "startPosition": {
            "line": 22
          },
          "endPosition": {
            "line": 617,
            "column": 1
          }
        },
        "contents": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = \n\n\n         &lt;div className=\"flex-1 overflow-y-auto p-4 space-y-6\"&gt;\n             {/* FPS Control */}\n             &lt;div&gt;\n                 &lt;div className=\"flex items-center text-gray-500 dark:text-gray-400 text-xs uppercase tracking-wider font-semibold mb-2\"&gt;\n                     &lt;Clock size={12} className=\"mr-1.5\" /&gt; {t('sequence.fps')}\n                 &lt;/div&gt;\n                 &lt;div className=\"flex flex-wrap gap-2\"&gt;\n                     {[12, 24, 30, 60].map(val =&gt; (\n                         &lt;button\n                            key={val}\n                            onClick={() =&gt; setFps(val)}\n                            className={&#96;flex-1 py-1.5 px-3 rounded text-xs font-bold border transition-all ${\n                                fps === val \n                                ? 'bg-purple-100 dark:bg-purple-900/30 border-purple-500 text-purple-600 dark:text-purple-300' \n                                : 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 hover:border-purple-300'\n                            }&#96;}\n                         &gt;\n                     )\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 22,
                "column": 1
              },
              "endPosition": {
                "line": 22,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 8
              },
              "endPosition": {
                "line": 22,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 14
              },
              "endPosition": {
                "line": 22,
                "column": 62
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = ",
            "lineNumber": 23
          },
          {
            "lineNumber": 466
          },
          {
            "lineNumber": 467
          },
          {
            "text": "         &lt;div className=\"flex-1 overflow-y-auto p-4 space-y-6\"&gt;",
            "lineNumber": 468
          },
          {
            "text": "             {/* FPS Control */}",
            "lineNumber": 469
          },
          {
            "text": "             &lt;div&gt;",
            "lineNumber": 470
          },
          {
            "text": "                 &lt;div className=\"flex items-center text-gray-500 dark:text-gray-400 text-xs uppercase tracking-wider font-semibold mb-2\"&gt;",
            "lineNumber": 471
          },
          {
            "text": "                     &lt;Clock size={12} className=\"mr-1.5\" /&gt; {t('sequence.fps')}",
            "lineNumber": 472
          },
          {
            "text": "                 &lt;/div&gt;",
            "lineNumber": 473
          },
          {
            "text": "                 &lt;div className=\"flex flex-wrap gap-2\"&gt;",
            "lineNumber": 474
          },
          {
            "text": "                     {[12, 24, 30, 60].map(val =&gt; (",
            "lineNumber": 475
          },
          {
            "text": "                         &lt;button",
            "lineNumber": 476
          },
          {
            "text": "                            key={val}",
            "lineNumber": 477
          },
          {
            "text": "                            onClick={() =&gt; setFps(val)}",
            "lineNumber": 478
          },
          {
            "text": "                            className={&#96;flex-1 py-1.5 px-3 rounded text-xs font-bold border transition-all ${",
            "lineNumber": 479
          },
          {
            "text": "                                fps === val ",
            "lineNumber": 480
          },
          {
            "text": "                                ? 'bg-purple-100 dark:bg-purple-900/30 border-purple-500 text-purple-600 dark:text-purple-300' ",
            "lineNumber": 481
          },
          {
            "text": "                                : 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 hover:border-purple-300'",
            "lineNumber": 482
          },
          {
            "text": "                            }&#96;}",
            "lineNumber": 483
          },
          {
            "text": "                         &gt;",
            "lineNumber": 484
          },
          {
            "text": "                     )",
            "lineNumber": 487
          },
          {
            "text": ";",
            "lineNumber": 618
          }
        ]
      },
      "score": 0.26808181405067444
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst handleUpdateMeta = \n\n 2000);\n  };\n\n  const handleUpdatePersonMeta = () =&gt; {\n      if (person &amp;&amp; onUpdatePerson) {\n          onUpdatePerson(person.id, { name: personName, description: personDesc });\n          setShowSavedPerson(true);\n          setTimeout(() =&gt; setShowSavedPerson(false), 2000);\n      }\n  };\n\n  const handleAddTag = (tag: string) =&gt; {\n      if (!tag.trim()) return;\n      const tagToAdd = tag.trim();\n      if (isMulti) {\n          selectedFileIds.forEach(id =&gt; {\n              const f = files[id];\n              if (f &amp;&amp; !f.tags.includes(tagToAdd)) {\n                  onUpdate(id, { tags: [...f.tags, tagToAdd] });\n              }\n          });\n      } else if (file &amp;&amp; !file.tags.includes(tagToAdd)) {\n          onUpdate(file.id, { tags: [...file.tags, tagToAdd] });\n      }\n      setNewTagInput('');\n  };\n\n  const handleRemoveTag = (tag: string) =&gt; {\n      if (isMulti) {\n          selectedFileIds.forEach(id =&gt; {\n              const f = files[id];\n              if (f) {\n                  onUpdate(id, { tags: f.tags.filter(t =&gt; t !== tag) });\n              }\n          });\n      } else if (file)\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "const handleUpdateMeta = ",
            "lineNumber": 723
          },
          {
            "lineNumber": 736
          },
          {
            "text": " 2000);",
            "lineNumber": 739
          },
          {
            "text": "  };",
            "lineNumber": 740
          },
          {
            "lineNumber": 741
          },
          {
            "text": "  const handleUpdatePersonMeta = () =&gt; {",
            "lineNumber": 742
          },
          {
            "text": "      if (person &amp;&amp; onUpdatePerson) {",
            "lineNumber": 743
          },
          {
            "text": "          onUpdatePerson(person.id, { name: personName, description: personDesc });",
            "lineNumber": 744
          },
          {
            "text": "          setShowSavedPerson(true);",
            "lineNumber": 745
          },
          {
            "text": "          setTimeout(() =&gt; setShowSavedPerson(false), 2000);",
            "lineNumber": 746
          },
          {
            "text": "      }",
            "lineNumber": 747
          },
          {
            "text": "  };",
            "lineNumber": 748
          },
          {
            "lineNumber": 749
          },
          {
            "text": "  const handleAddTag = (tag: string) =&gt; {",
            "lineNumber": 750
          },
          {
            "text": "      if (!tag.trim()) return;",
            "lineNumber": 751
          },
          {
            "text": "      const tagToAdd = tag.trim();",
            "lineNumber": 752
          },
          {
            "text": "      if (isMulti) {",
            "lineNumber": 753
          },
          {
            "text": "          selectedFileIds.forEach(id =&gt; {",
            "lineNumber": 754
          },
          {
            "text": "              const f = files[id];",
            "lineNumber": 755
          },
          {
            "text": "              if (f &amp;&amp; !f.tags.includes(tagToAdd)) {",
            "lineNumber": 756
          },
          {
            "text": "                  onUpdate(id, { tags: [...f.tags, tagToAdd] });",
            "lineNumber": 757
          },
          {
            "text": "              }",
            "lineNumber": 758
          },
          {
            "text": "          });",
            "lineNumber": 759
          },
          {
            "text": "      } else if (file &amp;&amp; !file.tags.includes(tagToAdd)) {",
            "lineNumber": 760
          },
          {
            "text": "          onUpdate(file.id, { tags: [...file.tags, tagToAdd] });",
            "lineNumber": 761
          },
          {
            "text": "      }",
            "lineNumber": 762
          },
          {
            "text": "      setNewTagInput('');",
            "lineNumber": 763
          },
          {
            "text": "  };",
            "lineNumber": 764
          },
          {
            "lineNumber": 765
          },
          {
            "text": "  const handleRemoveTag = (tag: string) =&gt; {",
            "lineNumber": 766
          },
          {
            "text": "      if (isMulti) {",
            "lineNumber": 767
          },
          {
            "text": "          selectedFileIds.forEach(id =&gt; {",
            "lineNumber": 768
          },
          {
            "text": "              const f = files[id];",
            "lineNumber": 769
          },
          {
            "text": "              if (f) {",
            "lineNumber": 770
          },
          {
            "text": "                  onUpdate(id, { tags: f.tags.filter(t =&gt; t !== tag) });",
            "lineNumber": 771
          },
          {
            "text": "              }",
            "lineNumber": 772
          },
          {
            "text": "          });",
            "lineNumber": 773
          },
          {
            "text": "      } else if (file)",
            "lineNumber": 774
          },
          {
            "text": ";",
            "lineNumber": 777
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.26461589336395264
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\SequenceViewer.tsx",
        "range": {
          "startPosition": {
            "line": 22
          },
          "endPosition": {
            "line": 617,
            "column": 1
          }
        },
        "contents": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = \n\" title={t('sequence.original')}&gt;\n                 &lt;span className=\"text-xs font-bold\"&gt;1:1&lt;/span&gt;\n              &lt;/button&gt;\n              &lt;button onClick={handleReset} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400\" title={t('sequence.fit')}&gt;\n                &lt;Maximize size={18} /&gt;\n              &lt;/button&gt;\n              &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;\n\n              &lt;button \n                onClick={() =&gt; setShowDetails(!showDetails)} \n                className={&#96;p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${showDetails ? 'text-blue-500 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}&#96;}\n                title={t('viewer.toggleMeta')}\n              &gt;\n                &lt;PanelRight size={20} /&gt;\n              &lt;/button&gt;\n              &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;\n              &lt;button onClick={onClose} className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors text-gray-500 dark:text-gray-400 hover:text-red-500 dark:hover:text-red-400\"&gt;\n                  &lt;X size={24} /&gt;\n              &lt;/button&gt;\n           &lt;/div&gt;\n        &lt;/div&gt;\n\n        {/* Viewer Canvas */}\n        &lt;div \n            className=\"flex-1 relative flex items-center justify-center bg-gray-200 dark:bg-[#121212] overflow-hidden p-4 cursor-grab active:cursor-grabbing\"\n            onWheel={handleWheel}\n            onMouseDown={handleMouseDown}\n            onMouseMove={handleMouseMove}\n            onMouseUp={handleMouseUp}\n            onMouseLeave={handleMouseUp}\n            onContextMenu={handleContextMenu}\n        &gt;\n           {currentFile &amp;&amp; currentFile.path ? (\n               &lt;img \n                 src={convertFileSrc(currentFile.path)} \n                 className=\"max-h-full max-w-full object-contain shadow-lg pointer-events-none transition-transform duration-75\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 22,
                "column": 1
              },
              "endPosition": {
                "line": 22,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 8
              },
              "endPosition": {
                "line": 22,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 14
              },
              "endPosition": {
                "line": 22,
                "column": 62
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = ",
            "lineNumber": 23
          },
          {
            "text": "\" title={t('sequence.original')}&gt;",
            "lineNumber": 317
          },
          {
            "text": "                 &lt;span className=\"text-xs font-bold\"&gt;1:1&lt;/span&gt;",
            "lineNumber": 318
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 319
          },
          {
            "text": "              &lt;button onClick={handleReset} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400\" title={t('sequence.fit')}&gt;",
            "lineNumber": 320
          },
          {
            "text": "                &lt;Maximize size={18} /&gt;",
            "lineNumber": 321
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 322
          },
          {
            "text": "              &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;",
            "lineNumber": 323
          },
          {
            "lineNumber": 324
          },
          {
            "text": "              &lt;button ",
            "lineNumber": 325
          },
          {
            "text": "                onClick={() =&gt; setShowDetails(!showDetails)} ",
            "lineNumber": 326
          },
          {
            "text": "                className={&#96;p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${showDetails ? 'text-blue-500 dark:text-blue-400' : 'text-gray-500 dark:text-gray-400'}&#96;}",
            "lineNumber": 327
          },
          {
            "text": "                title={t('viewer.toggleMeta')}",
            "lineNumber": 328
          },
          {
            "text": "              &gt;",
            "lineNumber": 329
          },
          {
            "text": "                &lt;PanelRight size={20} /&gt;",
            "lineNumber": 330
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 331
          },
          {
            "text": "              &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;",
            "lineNumber": 332
          },
          {
            "text": "              &lt;button onClick={onClose} className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors text-gray-500 dark:text-gray-400 hover:text-red-500 dark:hover:text-red-400\"&gt;",
            "lineNumber": 333
          },
          {
            "text": "                  &lt;X size={24} /&gt;",
            "lineNumber": 334
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 335
          },
          {
            "text": "           &lt;/div&gt;",
            "lineNumber": 336
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 337
          },
          {
            "lineNumber": 338
          },
          {
            "text": "        {/* Viewer Canvas */}",
            "lineNumber": 339
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 340
          },
          {
            "text": "            className=\"flex-1 relative flex items-center justify-center bg-gray-200 dark:bg-[#121212] overflow-hidden p-4 cursor-grab active:cursor-grabbing\"",
            "lineNumber": 341
          },
          {
            "text": "            onWheel={handleWheel}",
            "lineNumber": 342
          },
          {
            "text": "            onMouseDown={handleMouseDown}",
            "lineNumber": 343
          },
          {
            "text": "            onMouseMove={handleMouseMove}",
            "lineNumber": 344
          },
          {
            "text": "            onMouseUp={handleMouseUp}",
            "lineNumber": 345
          },
          {
            "text": "            onMouseLeave={handleMouseUp}",
            "lineNumber": 346
          },
          {
            "text": "            onContextMenu={handleContextMenu}",
            "lineNumber": 347
          },
          {
            "text": "        &gt;",
            "lineNumber": 348
          },
          {
            "text": "           {currentFile &amp;&amp; currentFile.path ? (",
            "lineNumber": 349
          },
          {
            "text": "               &lt;img ",
            "lineNumber": 350
          },
          {
            "text": "                 src={convertFileSrc(currentFile.path)} ",
            "lineNumber": 351
          },
          {
            "text": "                 className=\"max-h-full max-w-full object-contain shadow-lg pointer-events-none transition-transform duration-75",
            "lineNumber": 352
          },
          {
            "text": ";",
            "lineNumber": 618
          }
        ]
      },
      "score": 0.26292186975479126
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst colors = (() =&gt; {\n    if (!file) return [];\n    \n    // Prioritize locally extracted palette because it now has smart filtering\n    if (file.meta?.palette &amp;&amp; file.meta.palette.length &gt; 0) {\n        return file.meta.palette;\n    }\n    \n    // Fallback to AI data if local palette is missing\n    if (file.aiData?.dominantColors &amp;&amp; file.aiData.dominantColors.length &gt; 0) {\n        return file.aiData.dominantColors;\n    }\n    \n    return [];\n  }, [file]);\n\n  const folderDetails = useMemo(() =&gt; {\n    if (file &amp;&amp; file.type === FileType.FOLDER) {\n        const types: Record&lt;string, number&gt; = {};\n        let totalFiles = 0;\n        let subFolderCount = 0;\n        \n        const stack = [file.id];\n        \n        while(stack.length) {\n            const currentId = stack.pop()!;\n            const node = files[currentId];\n            if (!node) continue;\n            \n            if (currentId !== file.id) {\n                if (node.type === FileType.FOLDER) {\n                    subFolderCount++;\n                } else if (node.type === FileType.IMAGE) {\n                    totalFiles++;\n                    const fmt = node.meta?.format.toUpperCase() || 'OTHER';\n                    types[fmt] = (types[fmt] || 0) + 1;\n                }\n            }\n\n            if (node.children) {\n                stack.push(...node.children);\n            }\n        }\n        \n        return { types, totalFiles, subFolderCount };\n    }\n    return null;\n  }, [file, files]);\n\n  const folderStats = useMemo(() =&gt; {\n    if (file &amp;&amp; file.type === FileType.FOLDER) {\n      return getFolderStats(files, file.id);\n    }\n    return null;\n  }, [file, files]);\n\n  // 获取或初始化全局缓存 (与FileGrid.tsx共享)\n  const getGlobalCache = () =&gt; {\n    const win = window as any;\n    return win.__AURORA_THUMBNAIL_CACHE__ || null;\n  };\n\n  // 文件夹预览图，与主界面保持一致\n  const [folderPreviewImages, setFolderPreviewImages] = useState&lt;string[]&gt;([]);\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "const colors = (() =&gt; {",
            "lineNumber": 493
          },
          {
            "text": "    if (!file) return [];",
            "lineNumber": 494
          },
          {
            "text": "    ",
            "lineNumber": 495
          },
          {
            "text": "    // Prioritize locally extracted palette because it now has smart filtering",
            "lineNumber": 496
          },
          {
            "text": "    if (file.meta?.palette &amp;&amp; file.meta.palette.length &gt; 0) {",
            "lineNumber": 497
          },
          {
            "text": "        return file.meta.palette;",
            "lineNumber": 498
          },
          {
            "text": "    }",
            "lineNumber": 499
          },
          {
            "text": "    ",
            "lineNumber": 500
          },
          {
            "text": "    // Fallback to AI data if local palette is missing",
            "lineNumber": 501
          },
          {
            "text": "    if (file.aiData?.dominantColors &amp;&amp; file.aiData.dominantColors.length &gt; 0) {",
            "lineNumber": 502
          },
          {
            "text": "        return file.aiData.dominantColors;",
            "lineNumber": 503
          },
          {
            "text": "    }",
            "lineNumber": 504
          },
          {
            "text": "    ",
            "lineNumber": 505
          },
          {
            "text": "    return [];",
            "lineNumber": 506
          },
          {
            "text": "  }, [file]);",
            "lineNumber": 507
          },
          {
            "lineNumber": 508
          },
          {
            "text": "  const folderDetails = useMemo(() =&gt; {",
            "lineNumber": 509
          },
          {
            "text": "    if (file &amp;&amp; file.type === FileType.FOLDER) {",
            "lineNumber": 510
          },
          {
            "text": "        const types: Record&lt;string, number&gt; = {};",
            "lineNumber": 511
          },
          {
            "text": "        let totalFiles = 0;",
            "lineNumber": 512
          },
          {
            "text": "        let subFolderCount = 0;",
            "lineNumber": 513
          },
          {
            "text": "        ",
            "lineNumber": 514
          },
          {
            "text": "        const stack = [file.id];",
            "lineNumber": 515
          },
          {
            "text": "        ",
            "lineNumber": 516
          },
          {
            "text": "        while(stack.length) {",
            "lineNumber": 517
          },
          {
            "text": "            const currentId = stack.pop()!;",
            "lineNumber": 518
          },
          {
            "text": "            const node = files[currentId];",
            "lineNumber": 519
          },
          {
            "text": "            if (!node) continue;",
            "lineNumber": 520
          },
          {
            "text": "            ",
            "lineNumber": 521
          },
          {
            "text": "            if (currentId !== file.id) {",
            "lineNumber": 522
          },
          {
            "text": "                if (node.type === FileType.FOLDER) {",
            "lineNumber": 523
          },
          {
            "text": "                    subFolderCount++;",
            "lineNumber": 524
          },
          {
            "text": "                } else if (node.type === FileType.IMAGE) {",
            "lineNumber": 525
          },
          {
            "text": "                    totalFiles++;",
            "lineNumber": 526
          },
          {
            "text": "                    const fmt = node.meta?.format.toUpperCase() || 'OTHER';",
            "lineNumber": 527
          },
          {
            "text": "                    types[fmt] = (types[fmt] || 0) + 1;",
            "lineNumber": 528
          },
          {
            "text": "                }",
            "lineNumber": 529
          },
          {
            "text": "            }",
            "lineNumber": 530
          },
          {
            "lineNumber": 531
          },
          {
            "text": "            if (node.children) {",
            "lineNumber": 532
          },
          {
            "text": "                stack.push(...node.children);",
            "lineNumber": 533
          },
          {
            "text": "            }",
            "lineNumber": 534
          },
          {
            "text": "        }",
            "lineNumber": 535
          },
          {
            "text": "        ",
            "lineNumber": 536
          },
          {
            "text": "        return { types, totalFiles, subFolderCount };",
            "lineNumber": 537
          },
          {
            "text": "    }",
            "lineNumber": 538
          },
          {
            "text": "    return null;",
            "lineNumber": 539
          },
          {
            "text": "  }, [file, files]);",
            "lineNumber": 540
          },
          {
            "lineNumber": 541
          },
          {
            "text": "  const folderStats = useMemo(() =&gt; {",
            "lineNumber": 542
          },
          {
            "text": "    if (file &amp;&amp; file.type === FileType.FOLDER) {",
            "lineNumber": 543
          },
          {
            "text": "      return getFolderStats(files, file.id);",
            "lineNumber": 544
          },
          {
            "text": "    }",
            "lineNumber": 545
          },
          {
            "text": "    return null;",
            "lineNumber": 546
          },
          {
            "text": "  }, [file, files]);",
            "lineNumber": 547
          },
          {
            "lineNumber": 548
          },
          {
            "text": "  // 获取或初始化全局缓存 (与FileGrid.tsx共享)",
            "lineNumber": 549
          },
          {
            "text": "  const getGlobalCache = () =&gt; {",
            "lineNumber": 550
          },
          {
            "text": "    const win = window as any;",
            "lineNumber": 551
          },
          {
            "text": "    return win.__AURORA_THUMBNAIL_CACHE__ || null;",
            "lineNumber": 552
          },
          {
            "text": "  };",
            "lineNumber": 553
          },
          {
            "lineNumber": 554
          },
          {
            "text": "  // 文件夹预览图，与主界面保持一致",
            "lineNumber": 555
          },
          {
            "text": "  const [folderPreviewImages, setFolderPreviewImages] = useState&lt;string[]&gt;([]);",
            "lineNumber": 556
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.25112199783325195
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\types.ts",
        "range": {
          "startPosition": {
            "line": 195
          },
          "endPosition": {
            "line": 251,
            "column": 1
          }
        },
        "contents": "export interface TabState {\n\n  history: {\n    stack: HistoryItem[];\n    currentIndex: number;\n  };\n  scrollTop: number;\n}\n\nexport type SettingsCategory = 'general' | 'appearance' | 'network' | 'storage' | 'ai';\n\nexport interface AppState {\n  roots: string[];\n  files: Record&lt;string, FileNode&gt;;\n  people: Record&lt;string, Person&gt;;\n  expandedFolderIds: string[];\n  tabs: TabState[];\n  activeTabId: string;\n  sortBy: SortOption;\n  sortDirection: SortDirection;\n  thumbnailSize: number;\n  renamingId: string | null;\n  clipboard: {\n    action: 'copy' | 'move' | null;\n    items: { type: 'file' | 'tag', ids: string[] }; \n  };\n  customTags: string[];\n  folderSettings: Record&lt;string, FolderSettings&gt;; // 文件夹ID -&gt; 文件夹设置\n  layout: {\n    isSidebarVisible: boolean;\n    isMetadataVisible: boolean;\n  };\n  slideshowConfig: SlideshowConfig;\n  settings: AppSettings;\n  isSettingsOpen: boolean;\n  settingsCategory: SettingsCategory;\n;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export interface TabState {",
            "lineNumber": 196,
            "isSignature": true
          },
          {
            "lineNumber": 211
          },
          {
            "text": "  history: {",
            "lineNumber": 212
          },
          {
            "text": "    stack: HistoryItem[];",
            "lineNumber": 213
          },
          {
            "text": "    currentIndex: number;",
            "lineNumber": 214
          },
          {
            "text": "  };",
            "lineNumber": 215
          },
          {
            "text": "  scrollTop: number;",
            "lineNumber": 216,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 217,
            "isSignature": true
          },
          {
            "lineNumber": 218
          },
          {
            "text": "export type SettingsCategory = 'general' | 'appearance' | 'network' | 'storage' | 'ai';",
            "lineNumber": 219,
            "isSignature": true
          },
          {
            "lineNumber": 220
          },
          {
            "text": "export interface AppState {",
            "lineNumber": 221,
            "isSignature": true
          },
          {
            "text": "  roots: string[];",
            "lineNumber": 222
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 223
          },
          {
            "text": "  people: Record&lt;string, Person&gt;;",
            "lineNumber": 224
          },
          {
            "text": "  expandedFolderIds: string[];",
            "lineNumber": 225
          },
          {
            "text": "  tabs: TabState[];",
            "lineNumber": 226
          },
          {
            "text": "  activeTabId: string;",
            "lineNumber": 227
          },
          {
            "text": "  sortBy: SortOption;",
            "lineNumber": 228
          },
          {
            "text": "  sortDirection: SortDirection;",
            "lineNumber": 229
          },
          {
            "text": "  thumbnailSize: number;",
            "lineNumber": 230
          },
          {
            "text": "  renamingId: string | null;",
            "lineNumber": 231
          },
          {
            "text": "  clipboard: {",
            "lineNumber": 232
          },
          {
            "text": "    action: 'copy' | 'move' | null;",
            "lineNumber": 233
          },
          {
            "text": "    items: { type: 'file' | 'tag', ids: string[] }; ",
            "lineNumber": 234
          },
          {
            "text": "  };",
            "lineNumber": 235
          },
          {
            "text": "  customTags: string[];",
            "lineNumber": 236
          },
          {
            "text": "  folderSettings: Record&lt;string, FolderSettings&gt;; // 文件夹ID -&gt; 文件夹设置",
            "lineNumber": 237
          },
          {
            "text": "  layout: {",
            "lineNumber": 238
          },
          {
            "text": "    isSidebarVisible: boolean;",
            "lineNumber": 239
          },
          {
            "text": "    isMetadataVisible: boolean;",
            "lineNumber": 240
          },
          {
            "text": "  };",
            "lineNumber": 241
          },
          {
            "text": "  slideshowConfig: SlideshowConfig;",
            "lineNumber": 242
          },
          {
            "text": "  settings: AppSettings;",
            "lineNumber": 243
          },
          {
            "text": "  isSettingsOpen: boolean;",
            "lineNumber": 244
          },
          {
            "text": "  settingsCategory: SettingsCategory;",
            "lineNumber": 245
          },
          {
            "text": ";",
            "lineNumber": 251,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 252,
            "isSignature": true
          }
        ]
      },
      "score": 0.2488301396369934
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1490
          },
          "endPosition": {
            "line": 2018,
            "column": 1
          }
        },
        "contents": "interface FileGridProps {\n\n  selectionBox?: { startX: number; startY: number; currentX: number; currentY: number } | null;\n  t: (key: string) =&gt; string;\n  onThumbnailSizeChange?: (size: number) =&gt; void;\n  onUpdateFile?: (id: string, updates: Partial&lt;FileNode&gt;) =&gt; void;\n  settings?: import('../types').AppSettings;\n  onDragEnd?: (e: React.DragEvent) =&gt; void;\n  resourceRoot?: string;\n  cachePath?: string;\n  onScrollTopChange?: (scrollTop: number) =&gt; void;\n}\n\nexport const FileGrid: React.FC&lt;FileGridProps&gt; = ({\n  displayFileIds,\n  files,\n  activeTab,\n  renamingId,\n  thumbnailSize,\n  resourceRoot,\n  cachePath,\n  hoverPlayingId,\n  onSetHoverPlayingId,\n  onFileClick,\n  onFileDoubleClick,\n  onContextMenu,\n  onRenameSubmit,\n  onRenameCancel,\n  onStartRename,\n  onDragStart,\n  onDragEnd,\n  onDropOnFolder,\n  onDropExternal,\n  containerRef,\n  onMouseDown,\n  onMouseMove,\n  onMouseUp,\n  onBackgroundContextMenu,\n  people,\n  groupedTags,\n  onPersonClick,\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "interface FileGridProps {",
            "lineNumber": 1491,
            "isSignature": true
          },
          {
            "lineNumber": 1526
          },
          {
            "text": "  selectionBox?: { startX: number; startY: number; currentX: number; currentY: number } | null;",
            "lineNumber": 1527
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 1528
          },
          {
            "text": "  onThumbnailSizeChange?: (size: number) =&gt; void;",
            "lineNumber": 1529
          },
          {
            "text": "  onUpdateFile?: (id: string, updates: Partial&lt;FileNode&gt;) =&gt; void;",
            "lineNumber": 1530
          },
          {
            "text": "  settings?: import('../types').AppSettings;",
            "lineNumber": 1531
          },
          {
            "text": "  onDragEnd?: (e: React.DragEvent) =&gt; void;",
            "lineNumber": 1532
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 1533
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 1534
          },
          {
            "text": "  onScrollTopChange?: (scrollTop: number) =&gt; void;",
            "lineNumber": 1535,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 1536,
            "isSignature": true
          },
          {
            "lineNumber": 1537
          },
          {
            "text": "export const FileGrid: React.FC&lt;FileGridProps&gt; = ({",
            "lineNumber": 1538
          },
          {
            "text": "  displayFileIds,",
            "lineNumber": 1539
          },
          {
            "text": "  files,",
            "lineNumber": 1540
          },
          {
            "text": "  activeTab,",
            "lineNumber": 1541
          },
          {
            "text": "  renamingId,",
            "lineNumber": 1542
          },
          {
            "text": "  thumbnailSize,",
            "lineNumber": 1543
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 1544
          },
          {
            "text": "  cachePath,",
            "lineNumber": 1545
          },
          {
            "text": "  hoverPlayingId,",
            "lineNumber": 1546
          },
          {
            "text": "  onSetHoverPlayingId,",
            "lineNumber": 1547
          },
          {
            "text": "  onFileClick,",
            "lineNumber": 1548
          },
          {
            "text": "  onFileDoubleClick,",
            "lineNumber": 1549
          },
          {
            "text": "  onContextMenu,",
            "lineNumber": 1550
          },
          {
            "text": "  onRenameSubmit,",
            "lineNumber": 1551
          },
          {
            "text": "  onRenameCancel,",
            "lineNumber": 1552
          },
          {
            "text": "  onStartRename,",
            "lineNumber": 1553
          },
          {
            "text": "  onDragStart,",
            "lineNumber": 1554
          },
          {
            "text": "  onDragEnd,",
            "lineNumber": 1555
          },
          {
            "text": "  onDropOnFolder,",
            "lineNumber": 1556
          },
          {
            "text": "  onDropExternal,",
            "lineNumber": 1557
          },
          {
            "text": "  containerRef,",
            "lineNumber": 1558
          },
          {
            "text": "  onMouseDown,",
            "lineNumber": 1559
          },
          {
            "text": "  onMouseMove,",
            "lineNumber": 1560
          },
          {
            "text": "  onMouseUp,",
            "lineNumber": 1561
          },
          {
            "text": "  onBackgroundContextMenu,",
            "lineNumber": 1562
          },
          {
            "text": "  people,",
            "lineNumber": 1563
          },
          {
            "text": "  groupedTags,",
            "lineNumber": 1564
          },
          {
            "text": "  onPersonClick,",
            "lineNumber": 1565
          },
          {
            "text": ";",
            "lineNumber": 2019
          }
        ]
      },
      "score": 0.24472004175186157
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "column": 62
          },
          "endPosition": {
            "line": 45,
            "column": 1
          }
        },
        "contents": "import React, { useEffect, useRef, useState, useMemo } from 'react';\nimport { FileNode, SlideshowConfig, SearchScope } from '../types';\nimport { \n  X, ChevronLeft, ChevronRight, Search, Sidebar, PanelRight, \n  RotateCw, RotateCcw, Maximize, Minimize, ArrowLeft, ArrowRight, \n  Play, Square, Settings, Sliders, Globe, FileText, Tag, Folder as FolderIcon, ChevronDown, Loader2,\n  Copy, ExternalLink, Image as ImageIcon, Save, Brain, Move, Trash2, FolderOpen\n} from 'lucide-react';\n\ninterface ViewerProps {\n  file: FileNode;\n  prevFile?: FileNode; // Optional now, mostly legacy or direct neighbor specific\n  nextFile?: FileNode; // Optional now\n  sortedFileIds?: string[]; // New: Full list for calculating neighbors\n  files: Record&lt;string, FileNode&gt;;\n  layout: { isSidebarVisible: boolean; isMetadataVisible: boolean };\n  slideshowConfig: SlideshowConfig;\n  activeChannel?: 'original' | 'r' | 'g' | 'b' | 'l'; \n  onLayoutToggle: (part: 'sidebar' | 'metadata') =&gt; void;\n  onClose: () =&gt; void; \n  onNext: (random?: boolean) =&gt; void;\n  onPrev: () =&gt; void;\n  onNavigateBack: () =&gt; void;\n  onNavigateForward: () =&gt; void;\n  canGoBack: boolean;\n  canGoForward: boolean;\n  onDelete: (id: string) =&gt; void;\n  onViewInExplorer: (id: string) =&gt; void;\n  onCopyToFolder: (fileId: string) =&gt; void;\n  onMoveToFolder: (fileId: string) =&gt; void;\n  onNavigateToFolder: (folderId: string) =&gt; void;\n  searchQuery: string;\n  onSearch: (query: string) =&gt; void; \n  searchScope: SearchScope;\n  onSearchScopeChange: (scope: SearchScope) =&gt; void;\n  onUpdateSlideshowConfig: (config: SlideshowConfig) =&gt; void;\n  onPasteTags: (targetId: string) =&gt; void; \n  onEditTags: () =&gt; void;\n  onCopyTags: () =&gt; void;\n  onAIAnalysis: (fileId: string) =&gt; void;\n  isAISearchEnabled: boolean;\n  onToggleAISearch: () =&gt; void;\n  t: (key: string) =&gt; string;\n  activeTab: any; // Added for open folder availability check\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import React, { useEffect, useRef, useState, useMemo } from 'react';",
            "lineNumber": 2
          },
          {
            "text": "import { FileNode, SlideshowConfig, SearchScope } from '../types';",
            "lineNumber": 3
          },
          {
            "text": "import { ",
            "lineNumber": 4
          },
          {
            "text": "  X, ChevronLeft, ChevronRight, Search, Sidebar, PanelRight, ",
            "lineNumber": 5
          },
          {
            "text": "  RotateCw, RotateCcw, Maximize, Minimize, ArrowLeft, ArrowRight, ",
            "lineNumber": 6
          },
          {
            "text": "  Play, Square, Settings, Sliders, Globe, FileText, Tag, Folder as FolderIcon, ChevronDown, Loader2,",
            "lineNumber": 7
          },
          {
            "text": "  Copy, ExternalLink, Image as ImageIcon, Save, Brain, Move, Trash2, FolderOpen",
            "lineNumber": 8
          },
          {
            "text": "} from 'lucide-react';",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "interface ViewerProps {",
            "lineNumber": 11,
            "isSignature": true
          },
          {
            "text": "  file: FileNode;",
            "lineNumber": 12
          },
          {
            "text": "  prevFile?: FileNode; // Optional now, mostly legacy or direct neighbor specific",
            "lineNumber": 13
          },
          {
            "text": "  nextFile?: FileNode; // Optional now",
            "lineNumber": 14
          },
          {
            "text": "  sortedFileIds?: string[]; // New: Full list for calculating neighbors",
            "lineNumber": 15
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 16
          },
          {
            "text": "  layout: { isSidebarVisible: boolean; isMetadataVisible: boolean };",
            "lineNumber": 17
          },
          {
            "text": "  slideshowConfig: SlideshowConfig;",
            "lineNumber": 18
          },
          {
            "text": "  activeChannel?: 'original' | 'r' | 'g' | 'b' | 'l'; ",
            "lineNumber": 19
          },
          {
            "text": "  onLayoutToggle: (part: 'sidebar' | 'metadata') =&gt; void;",
            "lineNumber": 20
          },
          {
            "text": "  onClose: () =&gt; void; ",
            "lineNumber": 21
          },
          {
            "text": "  onNext: (random?: boolean) =&gt; void;",
            "lineNumber": 22
          },
          {
            "text": "  onPrev: () =&gt; void;",
            "lineNumber": 23
          },
          {
            "text": "  onNavigateBack: () =&gt; void;",
            "lineNumber": 24
          },
          {
            "text": "  onNavigateForward: () =&gt; void;",
            "lineNumber": 25
          },
          {
            "text": "  canGoBack: boolean;",
            "lineNumber": 26
          },
          {
            "text": "  canGoForward: boolean;",
            "lineNumber": 27
          },
          {
            "text": "  onDelete: (id: string) =&gt; void;",
            "lineNumber": 28
          },
          {
            "text": "  onViewInExplorer: (id: string) =&gt; void;",
            "lineNumber": 29
          },
          {
            "text": "  onCopyToFolder: (fileId: string) =&gt; void;",
            "lineNumber": 30
          },
          {
            "text": "  onMoveToFolder: (fileId: string) =&gt; void;",
            "lineNumber": 31
          },
          {
            "text": "  onNavigateToFolder: (folderId: string) =&gt; void;",
            "lineNumber": 32
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 33
          },
          {
            "text": "  onSearch: (query: string) =&gt; void; ",
            "lineNumber": 34
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 35
          },
          {
            "text": "  onSearchScopeChange: (scope: SearchScope) =&gt; void;",
            "lineNumber": 36
          },
          {
            "text": "  onUpdateSlideshowConfig: (config: SlideshowConfig) =&gt; void;",
            "lineNumber": 37
          },
          {
            "text": "  onPasteTags: (targetId: string) =&gt; void; ",
            "lineNumber": 38
          },
          {
            "text": "  onEditTags: () =&gt; void;",
            "lineNumber": 39
          },
          {
            "text": "  onCopyTags: () =&gt; void;",
            "lineNumber": 40
          },
          {
            "text": "  onAIAnalysis: (fileId: string) =&gt; void;",
            "lineNumber": 41
          },
          {
            "text": "  isAISearchEnabled: boolean;",
            "lineNumber": 42
          },
          {
            "text": "  onToggleAISearch: () =&gt; void;",
            "lineNumber": 43
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 44
          },
          {
            "text": "  activeTab: any; // Added for open folder availability check",
            "lineNumber": 45
          },
          {
            "text": "}",
            "lineNumber": 46,
            "isSignature": true
          }
        ]
      },
      "score": 0.24015559256076813
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 45,
            "column": 1
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "interface ContextMenuState {\n  x: number;\n  y: number;\n  visible: boolean;\n}\n\nexport const ImageViewer: React.FC&lt;ViewerProps&gt; = ({ \n  file, \n  prevFile: legacyPrev,\n  nextFile: legacyNext,\n  sortedFileIds,\n  files,\n  onClose, \n  onNext, \n  onPrev, \n  onDelete,\n  layout,\n  onLayoutToggle,\n  onNavigateBack,\n  onNavigateForward,\n  canGoBack,\n  canGoForward,\n  searchQuery,\n  onSearch,\n  searchScope,\n  onSearchScopeChange,\n  slideshowConfig,\n  onUpdateSlideshowConfig,\n  activeChannel = 'original',\n  onPasteTags,\n  onEditTags,\n  onCopyTags,\n  onViewInExplorer,\n  onCopyToFolder,\n  onMoveToFolder,\n  onNavigateToFolder,\n  onAIAnalysis,\n  isAISearchEnabled,\n  onToggleAISearch,\n  t,\n  activeTab\n}) =&gt; {\n  // 如果 file 不存在，关闭查看器\n  if (!file) {\n    onClose();\n    return null;\n  }\n  \n  const containerRef = useRef&lt;HTMLDivElement&gt;(null);\n  const rootRef = useRef&lt;HTMLDivElement&gt;(null);\n  const imgRef = useRef&lt;HTMLImageElement&gt;(null);\n  const searchInputRef = useRef&lt;HTMLInputElement&gt;(null);\n  const scopeBtnRef = useRef&lt;HTMLButtonElement&gt;(null);\n  \n  const [scale, setScale] = useState(1); \n  const [rotation, setRotation] = useState(0);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  \n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n  const [contextMenu, setContextMenu] = useState&lt;ContextMenuState&gt;({ x: 0, y: 0, visible: false });\n  const [slideshowActive, setSlideshowActive] = useState(false);\n  const [showSlideshowSettings, setShowSlideshowSettings] = useState(false);\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  const [showSearch, setShowSearch] = useState(false);\n  const [scopeMenuOpen, setScopeMenuOpen] = useState(false);\n  const [scopeMenuPos, setScopeMenuPos] = useState({ top: 0, left: 0 });\n  \n  const [localQuery, setLocalQuery] = useState(searchQuery);\n  const [animationClass, setAnimationClass] = useState('animate-zoom-in');\n  const lastFileIdRef = useRef(file.id);\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "interface ContextMenuState {",
            "lineNumber": 48,
            "isSignature": true
          },
          {
            "text": "  x: number;",
            "lineNumber": 49
          },
          {
            "text": "  y: number;",
            "lineNumber": 50
          },
          {
            "text": "  visible: boolean;",
            "lineNumber": 51,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 52,
            "isSignature": true
          },
          {
            "lineNumber": 53
          },
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ({ ",
            "lineNumber": 54
          },
          {
            "text": "  file, ",
            "lineNumber": 55
          },
          {
            "text": "  prevFile: legacyPrev,",
            "lineNumber": 56
          },
          {
            "text": "  nextFile: legacyNext,",
            "lineNumber": 57
          },
          {
            "text": "  sortedFileIds,",
            "lineNumber": 58
          },
          {
            "text": "  files,",
            "lineNumber": 59
          },
          {
            "text": "  onClose, ",
            "lineNumber": 60
          },
          {
            "text": "  onNext, ",
            "lineNumber": 61
          },
          {
            "text": "  onPrev, ",
            "lineNumber": 62
          },
          {
            "text": "  onDelete,",
            "lineNumber": 63
          },
          {
            "text": "  layout,",
            "lineNumber": 64
          },
          {
            "text": "  onLayoutToggle,",
            "lineNumber": 65
          },
          {
            "text": "  onNavigateBack,",
            "lineNumber": 66
          },
          {
            "text": "  onNavigateForward,",
            "lineNumber": 67
          },
          {
            "text": "  canGoBack,",
            "lineNumber": 68
          },
          {
            "text": "  canGoForward,",
            "lineNumber": 69
          },
          {
            "text": "  searchQuery,",
            "lineNumber": 70
          },
          {
            "text": "  onSearch,",
            "lineNumber": 71
          },
          {
            "text": "  searchScope,",
            "lineNumber": 72
          },
          {
            "text": "  onSearchScopeChange,",
            "lineNumber": 73
          },
          {
            "text": "  slideshowConfig,",
            "lineNumber": 74
          },
          {
            "text": "  onUpdateSlideshowConfig,",
            "lineNumber": 75
          },
          {
            "text": "  activeChannel = 'original',",
            "lineNumber": 76
          },
          {
            "text": "  onPasteTags,",
            "lineNumber": 77
          },
          {
            "text": "  onEditTags,",
            "lineNumber": 78
          },
          {
            "text": "  onCopyTags,",
            "lineNumber": 79
          },
          {
            "text": "  onViewInExplorer,",
            "lineNumber": 80
          },
          {
            "text": "  onCopyToFolder,",
            "lineNumber": 81
          },
          {
            "text": "  onMoveToFolder,",
            "lineNumber": 82
          },
          {
            "text": "  onNavigateToFolder,",
            "lineNumber": 83
          },
          {
            "text": "  onAIAnalysis,",
            "lineNumber": 84
          },
          {
            "text": "  isAISearchEnabled,",
            "lineNumber": 85
          },
          {
            "text": "  onToggleAISearch,",
            "lineNumber": 86
          },
          {
            "text": "  t,",
            "lineNumber": 87
          },
          {
            "text": "  activeTab",
            "lineNumber": 88
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 89
          },
          {
            "text": "  // 如果 file 不存在，关闭查看器",
            "lineNumber": 90
          },
          {
            "text": "  if (!file) {",
            "lineNumber": 91
          },
          {
            "text": "    onClose();",
            "lineNumber": 92
          },
          {
            "text": "    return null;",
            "lineNumber": 93
          },
          {
            "text": "  }",
            "lineNumber": 94
          },
          {
            "text": "  ",
            "lineNumber": 95
          },
          {
            "text": "  const containerRef = useRef&lt;HTMLDivElement&gt;(null);",
            "lineNumber": 96
          },
          {
            "text": "  const rootRef = useRef&lt;HTMLDivElement&gt;(null);",
            "lineNumber": 97
          },
          {
            "text": "  const imgRef = useRef&lt;HTMLImageElement&gt;(null);",
            "lineNumber": 98
          },
          {
            "text": "  const searchInputRef = useRef&lt;HTMLInputElement&gt;(null);",
            "lineNumber": 99
          },
          {
            "text": "  const scopeBtnRef = useRef&lt;HTMLButtonElement&gt;(null);",
            "lineNumber": 100
          },
          {
            "text": "  ",
            "lineNumber": 101
          },
          {
            "text": "  const [scale, setScale] = useState(1); ",
            "lineNumber": 102
          },
          {
            "text": "  const [rotation, setRotation] = useState(0);",
            "lineNumber": 103
          },
          {
            "text": "  const [position, setPosition] = useState({ x: 0, y: 0 });",
            "lineNumber": 104
          },
          {
            "text": "  ",
            "lineNumber": 105
          },
          {
            "text": "  const [isDragging, setIsDragging] = useState(false);",
            "lineNumber": 106
          },
          {
            "text": "  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });",
            "lineNumber": 107
          },
          {
            "text": "  const [contextMenu, setContextMenu] = useState&lt;ContextMenuState&gt;({ x: 0, y: 0, visible: false });",
            "lineNumber": 108
          },
          {
            "text": "  const [slideshowActive, setSlideshowActive] = useState(false);",
            "lineNumber": 109
          },
          {
            "text": "  const [showSlideshowSettings, setShowSlideshowSettings] = useState(false);",
            "lineNumber": 110
          },
          {
            "text": "  const [isFullscreen, setIsFullscreen] = useState(false);",
            "lineNumber": 111
          },
          {
            "text": "  const [showSearch, setShowSearch] = useState(false);",
            "lineNumber": 112
          },
          {
            "text": "  const [scopeMenuOpen, setScopeMenuOpen] = useState(false);",
            "lineNumber": 113
          },
          {
            "text": "  const [scopeMenuPos, setScopeMenuPos] = useState({ top: 0, left: 0 });",
            "lineNumber": 114
          },
          {
            "text": "  ",
            "lineNumber": 115
          },
          {
            "text": "  const [localQuery, setLocalQuery] = useState(searchQuery);",
            "lineNumber": 116
          },
          {
            "text": "  const [animationClass, setAnimationClass] = useState('animate-zoom-in');",
            "lineNumber": 117
          },
          {
            "text": "  const lastFileIdRef = useRef(file.id);",
            "lineNumber": 118
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.24003863334655762
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\SequenceViewer.tsx",
        "range": {
          "startPosition": {
            "line": 22
          },
          "endPosition": {
            "line": 617,
            "column": 1
          }
        },
        "contents": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = \n\n              &gt;\n                &lt;Sidebar size={20} /&gt;\n              &lt;/button&gt;\n              &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;\n              &lt;Film className=\"text-purple-500\" size={20} /&gt;\n              &lt;span className=\"font-bold text-lg truncate\"&gt;{folder.name}&lt;/span&gt;\n              &lt;span className=\"text-sm text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full whitespace-nowrap border border-gray-200 dark:border-gray-700\"&gt;\n                 {currentFile?.name}\n              &lt;/span&gt;\n           &lt;/div&gt;\n           \n           &lt;div className=\"flex items-center space-x-2\"&gt;\n              {/* Zoom Controls */}\n              &lt;div className=\"flex items-center space-x-2 mr-4 w-32 hidden lg:flex\"&gt;\n                &lt;Minimize size={14} className=\"text-gray-500\" /&gt;\n                &lt;input \n                  type=\"range\" \n                  min=\"0.1\" \n                  max=\"8\" \n                  step=\"0.1\" \n                  value={scale}\n                  onChange={(e) =&gt; setScale(parseFloat(e.target.value))}\n                  className=\"flex-1 h-1 bg-gray-300 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer\"\n                /&gt;\n                &lt;Maximize size={14} className=\"text-gray-500\" /&gt;\n              &lt;/div&gt;\n\n              &lt;button onClick={handleOriginal} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('sequence.original')}&gt;\n                 &lt;span className=\"text-xs font-bold\"&gt;1:1&lt;/span&gt;\n              &lt;/button&gt;\n              &lt;button onClick={handleReset}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 22,
                "column": 1
              },
              "endPosition": {
                "line": 22,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 8
              },
              "endPosition": {
                "line": 22,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 14
              },
              "endPosition": {
                "line": 22,
                "column": 62
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = ",
            "lineNumber": 23
          },
          {
            "lineNumber": 289
          },
          {
            "text": "              &gt;",
            "lineNumber": 290
          },
          {
            "text": "                &lt;Sidebar size={20} /&gt;",
            "lineNumber": 291
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 292
          },
          {
            "text": "              &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-1\"&gt;&lt;/div&gt;",
            "lineNumber": 293
          },
          {
            "text": "              &lt;Film className=\"text-purple-500\" size={20} /&gt;",
            "lineNumber": 294
          },
          {
            "text": "              &lt;span className=\"font-bold text-lg truncate\"&gt;{folder.name}&lt;/span&gt;",
            "lineNumber": 295
          },
          {
            "text": "              &lt;span className=\"text-sm text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full whitespace-nowrap border border-gray-200 dark:border-gray-700\"&gt;",
            "lineNumber": 296
          },
          {
            "text": "                 {currentFile?.name}",
            "lineNumber": 297
          },
          {
            "text": "              &lt;/span&gt;",
            "lineNumber": 298
          },
          {
            "text": "           &lt;/div&gt;",
            "lineNumber": 299
          },
          {
            "text": "           ",
            "lineNumber": 300
          },
          {
            "text": "           &lt;div className=\"flex items-center space-x-2\"&gt;",
            "lineNumber": 301
          },
          {
            "text": "              {/* Zoom Controls */}",
            "lineNumber": 302
          },
          {
            "text": "              &lt;div className=\"flex items-center space-x-2 mr-4 w-32 hidden lg:flex\"&gt;",
            "lineNumber": 303
          },
          {
            "text": "                &lt;Minimize size={14} className=\"text-gray-500\" /&gt;",
            "lineNumber": 304
          },
          {
            "text": "                &lt;input ",
            "lineNumber": 305
          },
          {
            "text": "                  type=\"range\" ",
            "lineNumber": 306
          },
          {
            "text": "                  min=\"0.1\" ",
            "lineNumber": 307
          },
          {
            "text": "                  max=\"8\" ",
            "lineNumber": 308
          },
          {
            "text": "                  step=\"0.1\" ",
            "lineNumber": 309
          },
          {
            "text": "                  value={scale}",
            "lineNumber": 310
          },
          {
            "text": "                  onChange={(e) =&gt; setScale(parseFloat(e.target.value))}",
            "lineNumber": 311
          },
          {
            "text": "                  className=\"flex-1 h-1 bg-gray-300 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer\"",
            "lineNumber": 312
          },
          {
            "text": "                /&gt;",
            "lineNumber": 313
          },
          {
            "text": "                &lt;Maximize size={14} className=\"text-gray-500\" /&gt;",
            "lineNumber": 314
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 315
          },
          {
            "lineNumber": 316
          },
          {
            "text": "              &lt;button onClick={handleOriginal} className=\"p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 hidden sm:block\" title={t('sequence.original')}&gt;",
            "lineNumber": 317
          },
          {
            "text": "                 &lt;span className=\"text-xs font-bold\"&gt;1:1&lt;/span&gt;",
            "lineNumber": 318
          },
          {
            "text": "              &lt;/button&gt;",
            "lineNumber": 319
          },
          {
            "text": "              &lt;button onClick={handleReset}",
            "lineNumber": 320
          },
          {
            "text": ";",
            "lineNumber": 618
          }
        ]
      },
      "score": 0.23915870487689972
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \n() =&gt; {\nid =&gt; {\n\n                                            }\n                                        });\n                                    }} \n                                    className=\"flex items-center px-3 py-1.5 bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-400 text-white rounded-md font-medium transition-colors text-sm\"\n                                    title={t('meta.clearAllAiData')}\n                                &gt;\n                                    &lt;X size={12} className=\"mr-1.5\"/&gt; {t('meta.clearAll')}\n                                &lt;/button&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    ) : (\n                        // Single file AI analysis details\n                        file &amp;&amp; file.aiData &amp;&amp; (\n                            &lt;div className=\"space-y-3\"&gt;\n                                &lt;div className=\"grid grid-cols-2 gap-2 text-xs\"&gt;\n                                    &lt;div className=\"bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;\n                                        &lt;div className=\"text-gray-400 mb-1\"&gt;{t('meta.aiScene')}&lt;/div&gt;\n                                        &lt;div className=\"font-medium text-gray-800 dark:text-gray-200\"&gt;{file.aiData.sceneCategory}&lt;/div&gt;\n                                    &lt;/div&gt;\n                                    &lt;div className=\"bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;\n                                        &lt;div className=\"text-gray-400 mb-1\"&gt;{t('meta.aiConfidence')}&lt;/div&gt;\n                                        &lt;div className=\"font-medium text-gray-800 dark:text-gray-200\"&gt;{Math.round(file.aiData.confidence * 100)}%&lt;/div&gt;\n                                    &lt;/div&gt;\n                                &lt;/div&gt;\n\n                                {file.aiData.faces.length &gt; 0 &amp;&amp; (\n                                    &lt;div&gt;\n                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1.5 flex items-center\"&gt;&lt;Smile size={10} className=\"mr-1\"/&gt; {t('meta.aiFaces')}&lt;/div&gt;\n                                        &lt;div className=\"flex flex-wrap gap-1.5\"&gt;\n                                            \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 1159
          },
          {
            "text": "id =&gt; {",
            "lineNumber": 1160
          },
          {
            "lineNumber": 1162
          },
          {
            "text": "                                            }",
            "lineNumber": 1163
          },
          {
            "text": "                                        });",
            "lineNumber": 1164
          },
          {
            "text": "                                    }} ",
            "lineNumber": 1165
          },
          {
            "text": "                                    className=\"flex items-center px-3 py-1.5 bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-400 text-white rounded-md font-medium transition-colors text-sm\"",
            "lineNumber": 1166
          },
          {
            "text": "                                    title={t('meta.clearAllAiData')}",
            "lineNumber": 1167
          },
          {
            "text": "                                &gt;",
            "lineNumber": 1168
          },
          {
            "text": "                                    &lt;X size={12} className=\"mr-1.5\"/&gt; {t('meta.clearAll')}",
            "lineNumber": 1169
          },
          {
            "text": "                                &lt;/button&gt;",
            "lineNumber": 1170
          },
          {
            "text": "                            &lt;/div&gt;",
            "lineNumber": 1171
          },
          {
            "text": "                        &lt;/div&gt;",
            "lineNumber": 1172
          },
          {
            "text": "                    ) : (",
            "lineNumber": 1173
          },
          {
            "text": "                        // Single file AI analysis details",
            "lineNumber": 1174
          },
          {
            "text": "                        file &amp;&amp; file.aiData &amp;&amp; (",
            "lineNumber": 1175
          },
          {
            "text": "                            &lt;div className=\"space-y-3\"&gt;",
            "lineNumber": 1176
          },
          {
            "text": "                                &lt;div className=\"grid grid-cols-2 gap-2 text-xs\"&gt;",
            "lineNumber": 1177
          },
          {
            "text": "                                    &lt;div className=\"bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;",
            "lineNumber": 1178
          },
          {
            "text": "                                        &lt;div className=\"text-gray-400 mb-1\"&gt;{t('meta.aiScene')}&lt;/div&gt;",
            "lineNumber": 1179
          },
          {
            "text": "                                        &lt;div className=\"font-medium text-gray-800 dark:text-gray-200\"&gt;{file.aiData.sceneCategory}&lt;/div&gt;",
            "lineNumber": 1180
          },
          {
            "text": "                                    &lt;/div&gt;",
            "lineNumber": 1181
          },
          {
            "text": "                                    &lt;div className=\"bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;",
            "lineNumber": 1182
          },
          {
            "text": "                                        &lt;div className=\"text-gray-400 mb-1\"&gt;{t('meta.aiConfidence')}&lt;/div&gt;",
            "lineNumber": 1183
          },
          {
            "text": "                                        &lt;div className=\"font-medium text-gray-800 dark:text-gray-200\"&gt;{Math.round(file.aiData.confidence * 100)}%&lt;/div&gt;",
            "lineNumber": 1184
          },
          {
            "text": "                                    &lt;/div&gt;",
            "lineNumber": 1185
          },
          {
            "text": "                                &lt;/div&gt;",
            "lineNumber": 1186
          },
          {
            "lineNumber": 1187
          },
          {
            "text": "                                {file.aiData.faces.length &gt; 0 &amp;&amp; (",
            "lineNumber": 1188
          },
          {
            "text": "                                    &lt;div&gt;",
            "lineNumber": 1189
          },
          {
            "text": "                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1.5 flex items-center\"&gt;&lt;Smile size={10} className=\"mr-1\"/&gt; {t('meta.aiFaces')}&lt;/div&gt;",
            "lineNumber": 1190
          },
          {
            "text": "                                        &lt;div className=\"flex flex-wrap gap-1.5\"&gt;",
            "lineNumber": 1191
          },
          {
            "text": "                                            ",
            "lineNumber": 1192
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.23690590262413025
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\SequenceViewer.tsx",
        "range": {
          "startPosition": {
            "line": 9
          },
          "endPosition": {
            "line": 617,
            "column": 1
          }
        },
        "contents": "interface SequenceViewerProps {\n\n  onDelete?: (id: string) =&gt; void;\n  t: (key: string) =&gt; string;\n}\n\nexport const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = ({\n  file,\n  folder,\n  files,\n  sortedFileIds,\n  onClose,\n  onNavigate,\n  isSidebarOpen,\n  onToggleSidebar,\n  onDelete,\n  t\n}) =&gt; {\n  // Config state\n  const [fps, setFps] = useState(24);\n  const [isLooping, setIsLooping] = useState(true);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [showDetails, setShowDetails] = useState(true);\n\n  // Zoom &amp; Pan State\n  const [scale, setScale] = useState(1);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n\n  // UI State\n  const [contextMenu, setContextMenu] = useState&lt;{ visible: boolean, x: number, y: number }&gt;({ visible: false, x: 0, y: 0 });\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n  // Removed async currentImageUrl state in favor of direct Asset Protocol usage\n  \n  // Context menu close handlers\n  useEffect(() =&gt; {\n    // 只有当菜单可见时才添加事件监听器\n    if (!contextMenu.visible) return;\n\n    const handleClick = () =&gt; {\n      setContextMenu({ ...contextMenu, visible: false });\n    };\n\n    const handleWheel = () =&gt; {\n      setContextMenu({ ...contextMenu, visible: false });\n    };\n\n    // 在下一个事件循环中添加事件监听器，确保能捕获到菜单显示后的点击事件\n    const timer = setTimeout(() =&gt; {\n      // 使用 capture 阶段确保能捕获到所有点击和滚动事件\n      document.addEventListener('mousedown', handleClick, true);\n      document.addEventListener('wheel', handleWheel, true);\n    }, 0);\n\n    return () =&gt; {\n      clearTimeout(timer);\n      document.removeEventListener('mousedown', handleClick, true);\n      document.removeEventListener('wheel', handleWheel, true);\n    };\n  }, [contextMenu.visible, contextMenu]);\n\n  // Filter valid images from the provided list\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "interface SequenceViewerProps {",
            "lineNumber": 10,
            "isSignature": true
          },
          {
            "lineNumber": 18
          },
          {
            "text": "  onDelete?: (id: string) =&gt; void;",
            "lineNumber": 19
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 20,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 21,
            "isSignature": true
          },
          {
            "lineNumber": 22
          },
          {
            "text": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = ({",
            "lineNumber": 23
          },
          {
            "text": "  file,",
            "lineNumber": 24
          },
          {
            "text": "  folder,",
            "lineNumber": 25
          },
          {
            "text": "  files,",
            "lineNumber": 26
          },
          {
            "text": "  sortedFileIds,",
            "lineNumber": 27
          },
          {
            "text": "  onClose,",
            "lineNumber": 28
          },
          {
            "text": "  onNavigate,",
            "lineNumber": 29
          },
          {
            "text": "  isSidebarOpen,",
            "lineNumber": 30
          },
          {
            "text": "  onToggleSidebar,",
            "lineNumber": 31
          },
          {
            "text": "  onDelete,",
            "lineNumber": 32
          },
          {
            "text": "  t",
            "lineNumber": 33
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 34
          },
          {
            "text": "  // Config state",
            "lineNumber": 35
          },
          {
            "text": "  const [fps, setFps] = useState(24);",
            "lineNumber": 36
          },
          {
            "text": "  const [isLooping, setIsLooping] = useState(true);",
            "lineNumber": 37
          },
          {
            "text": "  const [isPlaying, setIsPlaying] = useState(false);",
            "lineNumber": 38
          },
          {
            "text": "  const [showDetails, setShowDetails] = useState(true);",
            "lineNumber": 39
          },
          {
            "lineNumber": 40
          },
          {
            "text": "  // Zoom &amp; Pan State",
            "lineNumber": 41
          },
          {
            "text": "  const [scale, setScale] = useState(1);",
            "lineNumber": 42
          },
          {
            "text": "  const [position, setPosition] = useState({ x: 0, y: 0 });",
            "lineNumber": 43
          },
          {
            "text": "  const [isDragging, setIsDragging] = useState(false);",
            "lineNumber": 44
          },
          {
            "text": "  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });",
            "lineNumber": 45
          },
          {
            "lineNumber": 46
          },
          {
            "text": "  // UI State",
            "lineNumber": 47
          },
          {
            "text": "  const [contextMenu, setContextMenu] = useState&lt;{ visible: boolean, x: number, y: number }&gt;({ visible: false, x: 0, y: 0 });",
            "lineNumber": 48
          },
          {
            "text": "  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);",
            "lineNumber": 49
          },
          {
            "text": "  // Removed async currentImageUrl state in favor of direct Asset Protocol usage",
            "lineNumber": 50
          },
          {
            "text": "  ",
            "lineNumber": 51
          },
          {
            "text": "  // Context menu close handlers",
            "lineNumber": 52
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 53
          },
          {
            "text": "    // 只有当菜单可见时才添加事件监听器",
            "lineNumber": 54
          },
          {
            "text": "    if (!contextMenu.visible) return;",
            "lineNumber": 55
          },
          {
            "lineNumber": 56
          },
          {
            "text": "    const handleClick = () =&gt; {",
            "lineNumber": 57
          },
          {
            "text": "      setContextMenu({ ...contextMenu, visible: false });",
            "lineNumber": 58
          },
          {
            "text": "    };",
            "lineNumber": 59
          },
          {
            "lineNumber": 60
          },
          {
            "text": "    const handleWheel = () =&gt; {",
            "lineNumber": 61
          },
          {
            "text": "      setContextMenu({ ...contextMenu, visible: false });",
            "lineNumber": 62
          },
          {
            "text": "    };",
            "lineNumber": 63
          },
          {
            "lineNumber": 64
          },
          {
            "text": "    // 在下一个事件循环中添加事件监听器，确保能捕获到菜单显示后的点击事件",
            "lineNumber": 65
          },
          {
            "text": "    const timer = setTimeout(() =&gt; {",
            "lineNumber": 66
          },
          {
            "text": "      // 使用 capture 阶段确保能捕获到所有点击和滚动事件",
            "lineNumber": 67
          },
          {
            "text": "      document.addEventListener('mousedown', handleClick, true);",
            "lineNumber": 68
          },
          {
            "text": "      document.addEventListener('wheel', handleWheel, true);",
            "lineNumber": 69
          },
          {
            "text": "    }, 0);",
            "lineNumber": 70
          },
          {
            "lineNumber": 71
          },
          {
            "text": "    return () =&gt; {",
            "lineNumber": 72
          },
          {
            "text": "      clearTimeout(timer);",
            "lineNumber": 73
          },
          {
            "text": "      document.removeEventListener('mousedown', handleClick, true);",
            "lineNumber": 74
          },
          {
            "text": "      document.removeEventListener('wheel', handleWheel, true);",
            "lineNumber": 75
          },
          {
            "text": "    };",
            "lineNumber": 76
          },
          {
            "text": "  }, [contextMenu.visible, contextMenu]);",
            "lineNumber": 77
          },
          {
            "lineNumber": 78
          },
          {
            "text": "  // Filter valid images from the provided list",
            "lineNumber": 79
          },
          {
            "text": ";",
            "lineNumber": 618
          }
        ]
      },
      "score": 0.23421229422092438
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\SequenceViewer.tsx",
        "range": {
          "startPosition": {
            "line": 22
          },
          "endPosition": {
            "line": 617,
            "column": 1
          }
        },
        "contents": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = \n (\n               &lt;img \n                 src={convertFileSrc(currentFile.path)} \n                 className=\"max-h-full max-w-full object-contain shadow-lg pointer-events-none transition-transform duration-75\"\n                 style={{\n                    transform: &#96;translate(${position.x}px, ${position.y}px) scale(${scale})&#96;,\n                    transition: isDragging ? 'none' : 'transform 0.1s linear'\n                 }}\n                 alt=\"Frame\"\n                 draggable={false}\n                 loading=\"eager\"\n                 decoding=\"async\"\n               /&gt;\n           ) : currentFile ? (\n               &lt;div className=\"flex items-center justify-center\"&gt;\n                 &lt;Loader2 className=\"animate-spin text-gray-400\" size={32} /&gt;\n               &lt;/div&gt;\n           ) : null}\n        &lt;/div&gt;\n\n        {/* Bottom Control Bar */}\n        &lt;div className=\"h-28 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 flex items-center px-4 shrink-0 z-20\"&gt;\n            {/* Step Controls */}\n            &lt;div className=\"flex items-center space-x-2 mr-4 mb-2\"&gt;\n                &lt;button onClick={handlePrev} className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full text-gray-600 dark:text-gray-300\" title={t('sequence.prev')}&gt;\n                    &lt;ChevronLeft size={24} /&gt;\n                &lt;/button&gt;\n                &lt;button \n                    onClick={togglePlay} \n                    className=\"w-14 h-14 flex items-center justify-center bg-purple-600 hover:bg-purple-500 text-white rounded-full shadow-md transition-colors\"\n                    title={isPlaying ? t('sequence.pause') : t('sequence.play')}\n                &gt;\n                    {isPlaying ? &lt;Pause size={28} fill=\"currentColor\" /&gt; : &lt;Play size={28} fill=\"currentColor\" className=\"ml-1\" /&gt;}\n                &lt;/button&gt;\n                &lt;button onClick={handleNext} className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full text-gray-600 dark:text-gray-300\" title={t('sequence.next')}&gt;\n                    &lt;ChevronRight size={24} /&gt;\n                &lt;/button&gt;\n            &lt;/div&gt;\n\n            {/* Timeline Scrubbing */}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 22,
                "column": 1
              },
              "endPosition": {
                "line": 22,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 8
              },
              "endPosition": {
                "line": 22,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 22,
                "column": 14
              },
              "endPosition": {
                "line": 22,
                "column": 62
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const SequenceViewer: React.FC&lt;SequenceViewerProps&gt; = ",
            "lineNumber": 23
          },
          {
            "text": " (",
            "lineNumber": 349
          },
          {
            "text": "               &lt;img ",
            "lineNumber": 350
          },
          {
            "text": "                 src={convertFileSrc(currentFile.path)} ",
            "lineNumber": 351
          },
          {
            "text": "                 className=\"max-h-full max-w-full object-contain shadow-lg pointer-events-none transition-transform duration-75\"",
            "lineNumber": 352
          },
          {
            "text": "                 style={{",
            "lineNumber": 353
          },
          {
            "text": "                    transform: &#96;translate(${position.x}px, ${position.y}px) scale(${scale})&#96;,",
            "lineNumber": 354
          },
          {
            "text": "                    transition: isDragging ? 'none' : 'transform 0.1s linear'",
            "lineNumber": 355
          },
          {
            "text": "                 }}",
            "lineNumber": 356
          },
          {
            "text": "                 alt=\"Frame\"",
            "lineNumber": 357
          },
          {
            "text": "                 draggable={false}",
            "lineNumber": 358
          },
          {
            "text": "                 loading=\"eager\"",
            "lineNumber": 359
          },
          {
            "text": "                 decoding=\"async\"",
            "lineNumber": 360
          },
          {
            "text": "               /&gt;",
            "lineNumber": 361
          },
          {
            "text": "           ) : currentFile ? (",
            "lineNumber": 362
          },
          {
            "text": "               &lt;div className=\"flex items-center justify-center\"&gt;",
            "lineNumber": 363
          },
          {
            "text": "                 &lt;Loader2 className=\"animate-spin text-gray-400\" size={32} /&gt;",
            "lineNumber": 364
          },
          {
            "text": "               &lt;/div&gt;",
            "lineNumber": 365
          },
          {
            "text": "           ) : null}",
            "lineNumber": 366
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 367
          },
          {
            "lineNumber": 368
          },
          {
            "text": "        {/* Bottom Control Bar */}",
            "lineNumber": 369
          },
          {
            "text": "        &lt;div className=\"h-28 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 flex items-center px-4 shrink-0 z-20\"&gt;",
            "lineNumber": 370
          },
          {
            "text": "            {/* Step Controls */}",
            "lineNumber": 371
          },
          {
            "text": "            &lt;div className=\"flex items-center space-x-2 mr-4 mb-2\"&gt;",
            "lineNumber": 372
          },
          {
            "text": "                &lt;button onClick={handlePrev} className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full text-gray-600 dark:text-gray-300\" title={t('sequence.prev')}&gt;",
            "lineNumber": 373
          },
          {
            "text": "                    &lt;ChevronLeft size={24} /&gt;",
            "lineNumber": 374
          },
          {
            "text": "                &lt;/button&gt;",
            "lineNumber": 375
          },
          {
            "text": "                &lt;button ",
            "lineNumber": 376
          },
          {
            "text": "                    onClick={togglePlay} ",
            "lineNumber": 377
          },
          {
            "text": "                    className=\"w-14 h-14 flex items-center justify-center bg-purple-600 hover:bg-purple-500 text-white rounded-full shadow-md transition-colors\"",
            "lineNumber": 378
          },
          {
            "text": "                    title={isPlaying ? t('sequence.pause') : t('sequence.play')}",
            "lineNumber": 379
          },
          {
            "text": "                &gt;",
            "lineNumber": 380
          },
          {
            "text": "                    {isPlaying ? &lt;Pause size={28} fill=\"currentColor\" /&gt; : &lt;Play size={28} fill=\"currentColor\" className=\"ml-1\" /&gt;}",
            "lineNumber": 381
          },
          {
            "text": "                &lt;/button&gt;",
            "lineNumber": 382
          },
          {
            "text": "                &lt;button onClick={handleNext} className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full text-gray-600 dark:text-gray-300\" title={t('sequence.next')}&gt;",
            "lineNumber": 383
          },
          {
            "text": "                    &lt;ChevronRight size={24} /&gt;",
            "lineNumber": 384
          },
          {
            "text": "                &lt;/button&gt;",
            "lineNumber": 385
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 386
          },
          {
            "lineNumber": 387
          },
          {
            "text": "            {/* Timeline Scrubbing */}",
            "lineNumber": 388
          },
          {
            "text": ";",
            "lineNumber": 618
          }
        ]
      },
      "score": 0.23058830201625824
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 266
          },
          "endPosition": {
            "line": 319,
            "column": 1
          }
        },
        "contents": "const CategorySelector = \n(cat) =&gt; {\n\n                  &lt;/button&gt;\n              );\n          })}\n      &lt;/div&gt;\n  &lt;/div&gt;\n);\n\nconst DistributionChart = ({ data, totalFiles }: { data: { label: string, value: number, color: string }[], totalFiles: number }) =&gt; {\n    const max = Math.max(...data.map(d =&gt; d.value), 1);\n\n    return (\n        &lt;div className=\"space-y-3\"&gt;\n            {data.map((item) =&gt; (\n                &lt;div key={item.label} className=\"flex items-center text-xs group\"&gt;\n                    &lt;div className=\"w-20 text-gray-500 dark:text-gray-400 font-medium truncate shrink-0\" title={item.label}&gt;\n                        {item.label}\n                    &lt;/div&gt;\n                    &lt;div className=\"flex-1 mx-3 h-2 bg-gray-100 dark:bg-gray-700/50 rounded-full overflow-hidden\"&gt;\n                        &lt;div \n                            className={&#96;h-full rounded-full ${item.color} shadow-sm transition-all duration-700 ease-out&#96;}\n                            style={{ width: &#96;${(item.value / max) * 100}%&#96; }}\n                        /&gt;\n                    &lt;/div&gt;\n                    &lt;div className=\"w-12 text-right text-gray-700 dark:text-gray-300 font-mono font-medium\"&gt;\n                        {item.value}\n                    &lt;/div&gt;\n            )\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const CategorySelector = ",
            "lineNumber": 267
          },
          {
            "text": "(cat) =&gt; {",
            "lineNumber": 271
          },
          {
            "lineNumber": 286
          },
          {
            "text": "                  &lt;/button&gt;",
            "lineNumber": 287
          },
          {
            "text": "              );",
            "lineNumber": 288
          },
          {
            "text": "          })}",
            "lineNumber": 289
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 290
          },
          {
            "text": "  &lt;/div&gt;",
            "lineNumber": 291
          },
          {
            "text": ");",
            "lineNumber": 292
          },
          {
            "lineNumber": 293
          },
          {
            "text": "const DistributionChart = ({ data, totalFiles }: { data: { label: string, value: number, color: string }[], totalFiles: number }) =&gt; {",
            "lineNumber": 294
          },
          {
            "text": "    const max = Math.max(...data.map(d =&gt; d.value), 1);",
            "lineNumber": 295
          },
          {
            "lineNumber": 296
          },
          {
            "text": "    return (",
            "lineNumber": 297
          },
          {
            "text": "        &lt;div className=\"space-y-3\"&gt;",
            "lineNumber": 298
          },
          {
            "text": "            {data.map((item) =&gt; (",
            "lineNumber": 299
          },
          {
            "text": "                &lt;div key={item.label} className=\"flex items-center text-xs group\"&gt;",
            "lineNumber": 300
          },
          {
            "text": "                    &lt;div className=\"w-20 text-gray-500 dark:text-gray-400 font-medium truncate shrink-0\" title={item.label}&gt;",
            "lineNumber": 301
          },
          {
            "text": "                        {item.label}",
            "lineNumber": 302
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 303
          },
          {
            "text": "                    &lt;div className=\"flex-1 mx-3 h-2 bg-gray-100 dark:bg-gray-700/50 rounded-full overflow-hidden\"&gt;",
            "lineNumber": 304
          },
          {
            "text": "                        &lt;div ",
            "lineNumber": 305
          },
          {
            "text": "                            className={&#96;h-full rounded-full ${item.color} shadow-sm transition-all duration-700 ease-out&#96;}",
            "lineNumber": 306
          },
          {
            "text": "                            style={{ width: &#96;${(item.value / max) * 100}%&#96; }}",
            "lineNumber": 307
          },
          {
            "text": "                        /&gt;",
            "lineNumber": 308
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 309
          },
          {
            "text": "                    &lt;div className=\"w-12 text-right text-gray-700 dark:text-gray-300 font-mono font-medium\"&gt;",
            "lineNumber": 310
          },
          {
            "text": "                        {item.value}",
            "lineNumber": 311
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 312
          },
          {
            "text": "            )",
            "lineNumber": 314
          },
          {
            "text": ";",
            "lineNumber": 320
          }
        ]
      },
      "score": 0.22871613502502441
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n \n              /&gt;\n              {/* ... (Filter UI, same as before) ... */}\n              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start || activeTab.activePersonId || activeTab.aiFilter) &amp;&amp; ( \n                  &lt;div className=\"flex items-center px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 space-x-2 overflow-x-auto shrink-0 z-20\"&gt;\n                      &lt;div className=\"flex items-center text-xs text-gray-500 dark:text-gray-400 mr-2 shrink-0\"&gt;\n                          &lt;Filter size={12} className=\"mr-1\"/&gt; {t('context.filters')}\n                      &lt;/div&gt;\n                      \n                      {activeTab.aiFilter &amp;&amp; (\n                          &lt;div className=\"flex items-center bg-purple-100 dark:bg-purple-900/40 text-purple-800 dark:text-purple-200 px-2 py-0.5 rounded-full text-xs border border-purple-200 dark:border-purple-800 whitespace-nowrap\"&gt;\n                              &lt;Brain size={10} className=\"mr-1\"/&gt;\n                              &lt;span&gt;{t('settings.aiSmartSearch')}: \"{activeTab.aiFilter.originalQuery}\"&lt;/span&gt;\n                              &lt;button onClick={() =&gt; updateActiveTab({ aiFilter: null })} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;\n                          &lt;/div&gt;\n                      )}\n\n                      {activeTab.dateFilter.start &amp;&amp; (\n                          &lt;div className=\"flex items-center bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded-full text-xs border border-blue-200 dark:border-blue-800 whitespace-nowrap\"&gt;\n                              &lt;Calendar size={10} className=\"mr-1\"/&gt;\n                              &lt;span&gt;{new Date(activeTab.dateFilter.start).toLocaleDateString()} {activeTab.dateFilter.end ? &#96;- ${new Date(activeTab.dateFilter.end).toLocaleDateString()}&#96; : ''}&lt;/span&gt;\n                              &lt;button onClick={() =&gt; updateActiveTab({ dateFilter: { start: null, end: null, mode: 'created' as const } })} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;\n                          &lt;/div&gt;\n                      )}\n                      \n                      {activeTab.activePersonId &amp;&amp; state.people[activeTab.activePersonId] &amp;&amp; (\n                          &lt;div className=\"flex items-center bg-purple-100 dark:bg-purple-900/40 text-purple-800 dark:text-purple-200 px-2 py-0.5 rounded-full text-xs border border-purple-200 dark:border-purple-800 whitespace-nowrap\"&gt;\n                              &lt;Brain size={10} className=\"mr-1\"/&gt;\n                              &lt;span&gt;{state.people[activeTab.activePersonId].name}&lt;/span&gt;\n                              &lt;button onClick={() =&gt; handleClearPersonFilter()} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;\n                          &lt;/div&gt;\n                      )}\n                      \n                      {activeTab.activeTags.map(tag =&gt; (\n                          &lt;div key={tag} className=\"flex items-center bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded-full text-xs border border-blue-200 dark:border-blue-800 whitespace-nowrap\"&gt;\n                              &lt;span&gt;{tag}&lt;/span&gt;\n                              &lt;button onClick={() =&gt; handleClearTagFilter(tag)} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;\n                          &lt;/div&gt;\n                      ))}\n                      \n                      &lt;button onClick={() =&gt; { handleClearAllTags(); handleClearPersonFilter(); updateActiveTab({ dateFilter: { start: null, end: null, mode: 'created' as const }, aiFilter: null }); }} className=\"text-xs text-gray-500 hover:text-red-500 underline ml-2 whitespace-nowrap\"&gt;{t('context.clearAll')}&lt;/button&gt;\n                  &lt;/div&gt;\n              )}\n              \n              &lt;div className=\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": " ",
            "lineNumber": 4555
          },
          {
            "text": "              /&gt;",
            "lineNumber": 4556
          },
          {
            "text": "              {/* ... (Filter UI, same as before) ... */}",
            "lineNumber": 4557
          },
          {
            "text": "              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start || activeTab.activePersonId || activeTab.aiFilter) &amp;&amp; ( ",
            "lineNumber": 4558
          },
          {
            "text": "                  &lt;div className=\"flex items-center px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 space-x-2 overflow-x-auto shrink-0 z-20\"&gt;",
            "lineNumber": 4559
          },
          {
            "text": "                      &lt;div className=\"flex items-center text-xs text-gray-500 dark:text-gray-400 mr-2 shrink-0\"&gt;",
            "lineNumber": 4560
          },
          {
            "text": "                          &lt;Filter size={12} className=\"mr-1\"/&gt; {t('context.filters')}",
            "lineNumber": 4561
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4562
          },
          {
            "text": "                      ",
            "lineNumber": 4563
          },
          {
            "text": "                      {activeTab.aiFilter &amp;&amp; (",
            "lineNumber": 4564
          },
          {
            "text": "                          &lt;div className=\"flex items-center bg-purple-100 dark:bg-purple-900/40 text-purple-800 dark:text-purple-200 px-2 py-0.5 rounded-full text-xs border border-purple-200 dark:border-purple-800 whitespace-nowrap\"&gt;",
            "lineNumber": 4565
          },
          {
            "text": "                              &lt;Brain size={10} className=\"mr-1\"/&gt;",
            "lineNumber": 4566
          },
          {
            "text": "                              &lt;span&gt;{t('settings.aiSmartSearch')}: \"{activeTab.aiFilter.originalQuery}\"&lt;/span&gt;",
            "lineNumber": 4567
          },
          {
            "text": "                              &lt;button onClick={() =&gt; updateActiveTab({ aiFilter: null })} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;",
            "lineNumber": 4568
          },
          {
            "text": "                          &lt;/div&gt;",
            "lineNumber": 4569
          },
          {
            "text": "                      )}",
            "lineNumber": 4570
          },
          {
            "lineNumber": 4571
          },
          {
            "text": "                      {activeTab.dateFilter.start &amp;&amp; (",
            "lineNumber": 4572
          },
          {
            "text": "                          &lt;div className=\"flex items-center bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded-full text-xs border border-blue-200 dark:border-blue-800 whitespace-nowrap\"&gt;",
            "lineNumber": 4573
          },
          {
            "text": "                              &lt;Calendar size={10} className=\"mr-1\"/&gt;",
            "lineNumber": 4574
          },
          {
            "text": "                              &lt;span&gt;{new Date(activeTab.dateFilter.start).toLocaleDateString()} {activeTab.dateFilter.end ? &#96;- ${new Date(activeTab.dateFilter.end).toLocaleDateString()}&#96; : ''}&lt;/span&gt;",
            "lineNumber": 4575
          },
          {
            "text": "                              &lt;button onClick={() =&gt; updateActiveTab({ dateFilter: { start: null, end: null, mode: 'created' as const } })} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;",
            "lineNumber": 4576
          },
          {
            "text": "                          &lt;/div&gt;",
            "lineNumber": 4577
          },
          {
            "text": "                      )}",
            "lineNumber": 4578
          },
          {
            "text": "                      ",
            "lineNumber": 4579
          },
          {
            "text": "                      {activeTab.activePersonId &amp;&amp; state.people[activeTab.activePersonId] &amp;&amp; (",
            "lineNumber": 4580
          },
          {
            "text": "                          &lt;div className=\"flex items-center bg-purple-100 dark:bg-purple-900/40 text-purple-800 dark:text-purple-200 px-2 py-0.5 rounded-full text-xs border border-purple-200 dark:border-purple-800 whitespace-nowrap\"&gt;",
            "lineNumber": 4581
          },
          {
            "text": "                              &lt;Brain size={10} className=\"mr-1\"/&gt;",
            "lineNumber": 4582
          },
          {
            "text": "                              &lt;span&gt;{state.people[activeTab.activePersonId].name}&lt;/span&gt;",
            "lineNumber": 4583
          },
          {
            "text": "                              &lt;button onClick={() =&gt; handleClearPersonFilter()} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;",
            "lineNumber": 4584
          },
          {
            "text": "                          &lt;/div&gt;",
            "lineNumber": 4585
          },
          {
            "text": "                      )}",
            "lineNumber": 4586
          },
          {
            "text": "                      ",
            "lineNumber": 4587
          },
          {
            "text": "                      {activeTab.activeTags.map(tag =&gt; (",
            "lineNumber": 4588
          },
          {
            "text": "                          &lt;div key={tag} className=\"flex items-center bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded-full text-xs border border-blue-200 dark:border-blue-800 whitespace-nowrap\"&gt;",
            "lineNumber": 4589
          },
          {
            "text": "                              &lt;span&gt;{tag}&lt;/span&gt;",
            "lineNumber": 4590
          },
          {
            "text": "                              &lt;button onClick={() =&gt; handleClearTagFilter(tag)} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;",
            "lineNumber": 4591
          },
          {
            "text": "                          &lt;/div&gt;",
            "lineNumber": 4592
          },
          {
            "text": "                      ))}",
            "lineNumber": 4593
          },
          {
            "text": "                      ",
            "lineNumber": 4594
          },
          {
            "text": "                      &lt;button onClick={() =&gt; { handleClearAllTags(); handleClearPersonFilter(); updateActiveTab({ dateFilter: { start: null, end: null, mode: 'created' as const }, aiFilter: null }); }} className=\"text-xs text-gray-500 hover:text-red-500 underline ml-2 whitespace-nowrap\"&gt;{t('context.clearAll')}&lt;/button&gt;",
            "lineNumber": 4595
          },
          {
            "text": "                  &lt;/div&gt;",
            "lineNumber": 4596
          },
          {
            "text": "              )}",
            "lineNumber": 4597
          },
          {
            "text": "              ",
            "lineNumber": 4598
          },
          {
            "text": "              &lt;div className=",
            "lineNumber": 4599
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.2267989069223404
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/App.tsx</summary>

</details>
</tool-use>

---



---


查看人物界面相关代码：


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "人物|character|person",
  "path": "src/App.tsx",
  "caseInsensitive": true
}
```
Result:

```json
{
  "success": {
    "pattern": "人物|character|person",
    "path": "src/App.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/App.tsx",
              "matches": [
                {
                  "lineNumber": 17,
                  "content": "import { AppState, FileNode, FileType, SlideshowConfig, AppSettings, SearchScope, SortOption, TabState, LayoutMode, SUPPORTED_EXTENSIONS, DateFilter, SettingsCategory, AiData, TaskProgress, Person, HistoryItem, AiFace, GroupByOption, FileGroup, DeletionTask, AiSearchFilter } from './types';"
                },
                {
                  "lineNumber": 39,
                  "content": "const RenamePersonModal = ({ initialName, onConfirm, onClose, t }: any) =&gt; { const [val, setVal] = useState(initialName); return ( &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-80 animate-zoom-in\"&gt;&lt;h3 className=\"font-bold text-lg mb-4 text-gray-900 dark:text-white\"&gt;{t('context.renamePerson')}&lt;/h3&gt;&lt;input id=\"rename-person-input\" name=\"rename-person-input\" className=\"w-full border dark:border-gray-600 rounded p-2 mb-4 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500\" value={val} onChange={e =&gt; setVal(e.target.value)} onKeyDown={(e) =&gt; { if (e.key === 'Enter') { onConfirm(val); } }} autoFocus /&gt;&lt;div className=\"flex justify-end space-x-2\"&gt;&lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;{t('settings.cancel')}&lt;/button&gt;&lt;button onClick={() =&gt; onConfirm(val)} className=\"bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-700 text-sm\"&gt;{"
                },
                {
                  "lineNumber": 41,
                  "content": "const AddToPersonModal = ({ people, files, onConfirm, onClose, t }: any) =&gt; { const [search, setSearch] = useState(''); const filteredPeople = Object.values(people as Record&lt;string, Person&gt;).filter((p: Person) =&gt; p.name.toLowerCase().includes(search.toLowerCase())); return ( &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-80 max-h-[500px] flex flex-col animate-zoom-in\"&gt;&lt;h3 className=\"font-bold text-lg mb-4 text-gray-900 dark:text-white\"&gt;{t('context.selectPerson')}&lt;/h3&gt;&lt;div className=\"relative mb-3\"&gt;&lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;&lt;input id=\"add-to-person-search\" name=\"add-to-person-search\" className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\" placeholder={t('search.placeholder')} value={search} onChange={e =&gt; setSearch(e.target.value)} autoFocus /&gt;&lt;/div&gt;&lt;div className=\"flex-1 overflow-y-auto min-h-[200px] space-y-"
                },
                {
                  "lineNumber": 43,
                  "content": "const ClearPersonModal = ({ files, fileIds, people, onConfirm, onClose, t }: any) =&gt; {"
                },
                {
                  "lineNumber": 49,
                  "content": "      file.aiData.faces.forEach((face: AiFace) =&gt; allPeople.add(face.personId));"
                },
                {
                  "lineNumber": 53,
                  "content": "  const peopleList = Array.from(allPeople).map(personId =&gt; people[personId]).filter(Boolean);"
                },
                {
                  "lineNumber": 56,
                  "content": "  const handleTogglePerson = (personId: string) =&gt; {"
                },
                {
                  "lineNumber": 58,
                  "content": "      prev.includes(personId)"
                },
                {
                  "lineNumber": 59,
                  "content": "        ? prev.filter(id =&gt; id !== personId)"
                },
                {
                  "lineNumber": 60,
                  "content": "        : [...prev, personId]"
                },
                {
                  "lineNumber": 83,
                  "content": "        {peopleList.map((p: Person) =&gt; {"
                },
                {
                  "lineNumber": 88,
                  "content": "            &lt;div key={p.id} onClick={() =&gt; handleTogglePerson(p.id)} className={&#96;flex items-center p-2 rounded cursor-pointer group border border-transparent ${isSelected ? 'bg-blue-100 dark:bg-blue-900/50 border-l-4 border-blue-500 shadow-md font-semibold' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}&#96;}&gt;"
                },
                {
                  "lineNumber": 258,
                  "content": "const DUMMY_TAB: TabState = { id: 'dummy', folderId: '', viewingFileId: null, viewMode: 'browser' as const, layoutMode: 'grid', searchQuery: '', searchScope: 'all', activeTags: [], activePersonId: null, selectedFileIds: [], lastSelectedId: null, selectedTagIds: [], selectedPersonIds: [], dateFilter: { start: null, end: null, mode: 'created' }, history: { stack: [], currentIndex: -1 }, scrollTop: 0 };"
                },
                {
                  "lineNumber": 531,
                  "content": "            enhancePersonDescription: false,"
                },
                {
                  "lineNumber": 562,
                  "content": "  const [contextMenu, setContextMenu] = useState&lt;{ visible: boolean; x: number; y: number; type: 'file-single' | 'file-multi' | 'folder-single' | 'folder-multi' | 'tag-single' | 'tag-multi' | 'tag-background' | 'root-folder' | 'background' | 'tab' | 'person' | null; targetId?: string; }&gt;({ visible: false, x: 0, y: 0, type: null });"
                },
                {
                  "lineNumber": 828,
                  "content": "                                 defaultTab.history = { stack: [{ folderId: initialFolder, viewingId: null, viewMode: 'browser', searchQuery: '', searchScope: 'all', activeTags: [], activePersonId: null }], currentIndex: 0 };"
                },
                {
                  "lineNumber": 861,
                  "content": "                const defaultTab: TabState = { ...DUMMY_TAB, id: 'tab-default', folderId: initialFolder, history: { stack: [{ folderId: initialFolder, viewingId: null, viewMode: 'browser', searchQuery: '', searchScope: 'all', activeTags: [], activePersonId: null }], currentIndex: 0 } };"
                },
                {
                  "lineNumber": 1156,
                  "content": "    } else if (activeTab.activePersonId) {"
                },
                {
                  "lineNumber": 1157,
                  "content": "        // Optimized active person filter - use direct lookup"
                },
                {
                  "lineNumber": 1158,
                  "content": "        const personId = activeTab.activePersonId;"
                },
                {
                  "lineNumber": 1162,
                  "content": "            f.aiData.faces.some(face =&gt; face.personId === personId)"
                },
                {
                  "lineNumber": 1325,
                  "content": "                      const updatedTabs = prev.tabs.map(t =&gt; t.id === prev.activeTabId ? { ...t, folderId: result.roots[0], history: { stack: [{ folderId: result.roots[0], viewingId: null, viewMode: 'browser' as const, searchQuery: '', searchScope: 'all' as SearchScope, activeTags: [], activePersonId: null }], currentIndex: 0 } } : t);"
                },
                {
                  "lineNumber": 1633,
                  "content": "                updateActiveTab({ selectedPersonIds: [] });"
                },
                {
                  "lineNumber": 1747,
                  "content": "      // Person selection - optimized with efficient calculation"
                },
                {
                  "lineNumber": 1748,
                  "content": "      const selectedPersonIds: string[] = [];"
                },
                {
                  "lineNumber": 1763,
                  "content": "      // Check each person's position against selection box"
                },
                {
                  "lineNumber": 1764,
                  "content": "      allPeople.forEach((person, index) =&gt; {"
                },
                {
                  "lineNumber": 1768,
                  "content": "        // Calculate person position in viewport coordinates"
                },
                {
                  "lineNumber": 1769,
                  "content": "        const personLeft = containerRect.left + PADDING + col * (itemWidth + GAP);"
                },
                {
                  "lineNumber": 1770,
                  "content": "        const personTop = containerRect.top + PADDING + row * (itemHeight + GAP);"
                },
                {
                  "lineNumber": 1771,
                  "content": "        const personRight = personLeft + itemWidth;"
                },
                {
                  "lineNumber": 1772,
                  "content": "        const personBottom = personTop + itemHeight;"
                },
                {
                  "lineNumber": 1774,
                  "content": "        // Check if person overlaps with selection box"
                },
                {
                  "lineNumber": 1775,
                  "content": "        if (personLeft &lt; selectionRight &amp;&amp;"
                },
                {
                  "lineNumber": 1776,
                  "content": "            personRight &gt; selectionLeft &amp;&amp;"
                },
                {
                  "lineNumber": 1777,
                  "content": "            personTop &lt; selectionBottom &amp;&amp;"
                },
                {
                  "lineNumber": 1778,
                  "content": "            personBottom &gt; selectionTop) {"
                },
                {
                  "lineNumber": 1779,
                  "content": "          selectedPersonIds.push(person.id);"
                },
                {
                  "lineNumber": 1783,
                  "content": "      if (selectedPersonIds.length &gt; 0) {"
                },
                {
                  "lineNumber": 1784,
                  "content": "        updateActiveTab({ selectedPersonIds });"
                },
                {
                  "lineNumber": 1835,
                  "content": "        // Collect all affected person IDs"
                },
                {
                  "lineNumber": 1836,
                  "content": "        const allAffectedPersonIds = new Set&lt;string&gt;();"
                },
                {
                  "lineNumber": 1838,
                  "content": "        prevFaces.forEach(face =&gt; allAffectedPersonIds.add(face.personId));"
                },
                {
                  "lineNumber": 1839,
                  "content": "        currentFaces.forEach(face =&gt; allAffectedPersonIds.add(face.personId));"
                },
                {
                  "lineNumber": 1842,
                  "content": "        allAffectedPersonIds.forEach(personId =&gt; {"
                },
                {
                  "lineNumber": 1845,
                  "content": "          // Count files that contain this person"
                },
                {
                  "lineNumber": 1848,
                  "content": "              if (file.aiData.faces.some(face =&gt; face.personId === personId)) {"
                },
                {
                  "lineNumber": 1854,
                  "content": "          // Update the person's count"
                },
                {
                  "lineNumber": 1855,
                  "content": "          if (updatedPeople[personId]) {"
                },
                {
                  "lineNumber": 1856,
                  "content": "            updatedPeople[personId] = {"
                },
                {
                  "lineNumber": 1857,
                  "content": "              ...updatedPeople[personId],"
                },
                {
                  "lineNumber": 2308,
                  "content": "  const handlePersonClick = (personId: string, e: React.MouseEvent) =&gt; {"
                },
                {
                  "lineNumber": 2316,
                  "content": "      let newSelectedPersonIds: string[];"
                },
                {
                  "lineNumber": 2321,
                  "content": "      const allPersonIds = allPeople.map(person =&gt; person.id);"
                },
                {
                  "lineNumber": 2324,
                  "content": "        // Ctrl+Click: Toggle selection of this person"
                },
                {
                  "lineNumber": 2325,
                  "content": "        if (activeTab.selectedPersonIds.includes(personId)) {"
                },
                {
                  "lineNumber": 2327,
                  "content": "          newSelectedPersonIds = activeTab.selectedPersonIds.filter(id =&gt; id !== personId);"
                },
                {
                  "lineNumber": 2330,
                  "content": "          newSelectedPersonIds = [...activeTab.selectedPersonIds, personId];"
                },
                {
                  "lineNumber": 2332,
                  "content": "      } else if (isShift &amp;&amp; activeTab.selectedPersonIds.length &gt; 0) {"
                },
                {
                  "lineNumber": 2334,
                  "content": "        const lastSelectedPersonId = activeTab.selectedPersonIds[activeTab.selectedPersonIds.length - 1];"
                },
                {
                  "lineNumber": 2335,
                  "content": "        const lastIndex = allPersonIds.indexOf(lastSelectedPersonId);"
                },
                {
                  "lineNumber": 2336,
                  "content": "        const currentIndex = allPersonIds.indexOf(personId);"
                },
                {
                  "lineNumber": 2341,
                  "content": "          newSelectedPersonIds = allPersonIds.slice(start, end + 1);"
                },
                {
                  "lineNumber": 2343,
                  "content": "          newSelectedPersonIds = [personId];"
                },
                {
                  "lineNumber": 2346,
                  "content": "        // Normal click: Select only this person"
                },
                {
                  "lineNumber": 2347,
                  "content": "        newSelectedPersonIds = [personId];"
                },
                {
                  "lineNumber": 2350,
                  "content": "      updateActiveTab({ selectedPersonIds: newSelectedPersonIds });"
                },
                {
                  "lineNumber": 2406,
                  "content": "  const handleRenamePerson = (personId: string, newName: string) =&gt; {"
                },
                {
                  "lineNumber": 2412,
                  "content": "              [personId]: { ...prev.people[personId], name: newName }"
                },
                {
                  "lineNumber": 2418,
                  "content": "  const handleUpdatePerson = (personId: string, updates: Partial&lt;Person&gt;) =&gt; {"
                },
                {
                  "lineNumber": 2423,
                  "content": "              [personId]: { ...prev.people[personId], ...updates }"
                },
                {
                  "lineNumber": 2428,
                  "content": "  const handleCreatePerson = () =&gt; {"
                },
                {
                  "lineNumber": 2430,
                  "content": "      const newPerson: Person = {"
                },
                {
                  "lineNumber": 2432,
                  "content": "          name: t('context.newPersonDefault'),"
                },
                {
                  "lineNumber": 2439,
                  "content": "          people: { ...prev.people, [newId]: newPerson },"
                },
                {
                  "lineNumber": 2440,
                  "content": "          activeModal: { type: 'rename-person', data: { personId: newId } }"
                },
                {
                  "lineNumber": 2444,
                  "content": "  const handleDeletePerson = (personId: string | string[]) =&gt; {"
                },
                {
                  "lineNumber": 2448,
                  "content": "          // Handle both single person and multiple people deletion"
                },
                {
                  "lineNumber": 2449,
                  "content": "          const idsToDelete = typeof personId === 'string' ? [personId] : personId;"
                },
                {
                  "lineNumber": 2458,
                  "content": "  const handleManualAddPerson = (personId: string) =&gt; {"
                },
                {
                  "lineNumber": 2467,
                  "content": "          const person = newPeople[personId];"
                },
                {
                  "lineNumber": 2468,
                  "content": "          if (!person) return prev;"
                },
                {
                  "lineNumber": 2477,
                  "content": "                  if (!currentFaces.some(f =&gt; f.personId === personId)) {"
                },
                {
                  "lineNumber": 2480,
                  "content": "                          personId: personId,"
                },
                {
                  "lineNumber": 2481,
                  "content": "                          name: person.name,"
                },
                {
                  "lineNumber": 2504,
                  "content": "              // 一次性更新人物的count"
                },
                {
                  "lineNumber": 2505,
                  "content": "              newPeople[personId] = {"
                },
                {
                  "lineNumber": 2506,
                  "content": "                  ...person,"
                },
                {
                  "lineNumber": 2507,
                  "content": "                  count: person.count + countIncrease,"
                },
                {
                  "lineNumber": 2508,
                  "content": "                  coverFileId: person.coverFileId || fileIds[0]"
                },
                {
                  "lineNumber": 2569,
                  "content": "  // Enhanced handleClearPersonInfo to support selective clearing"
                },
                {
                  "lineNumber": 2570,
                  "content": "  const handleClearPersonInfo = (fileIds: string[], personIdsToClear?: string[]) =&gt; {"
                },
                {
                  "lineNumber": 2576,
                  "content": "          // 首先收集所有要清除的人脸所属的人物ID"
                },
                {
                  "lineNumber": 2577,
                  "content": "          const personIdsToUpdate = new Set&lt;string&gt;();"
                },
                {
                  "lineNumber": 2585,
                  "content": "                  if (personIdsToClear &amp;&amp; personIdsToClear.length &gt; 0) {"
                },
                {
                  "lineNumber": 2586,
                  "content": "                      // 选择性清除指定人物的人脸信息"
                },
                {
                  "lineNumber": 2587,
                  "content": "                      updatedFaces = file.aiData.faces.filter(face =&gt; !personIdsToClear.includes(face.personId));"
                },
                {
                  "lineNumber": 2595,
                  "content": "                      // 保存要更新的人物ID"
                },
                {
                  "lineNumber": 2597,
                  "content": "                          personIdsToUpdate.add(face.personId);"
                },
                {
                  "lineNumber": 2600,
                  "content": "                          personIdsToUpdate.add(face.personId);"
                },
                {
                  "lineNumber": 2611,
                  "content": "          // 更新受影响人物的count"
                },
                {
                  "lineNumber": 2613,
                  "content": "              // 重新计算所有受影响人物的count"
                },
                {
                  "lineNumber": 2614,
                  "content": "              personIdsToUpdate.forEach(personId =&gt; {"
                },
                {
                  "lineNumber": 2616,
                  "content": "                  // 遍历所有文件，计算包含该人物的文件数量"
                },
                {
                  "lineNumber": 2619,
                  "content": "                          if (file.aiData.faces.some(face =&gt; face.personId === personId)) {"
                },
                {
                  "lineNumber": 2624,
                  "content": "                  // 更新人物count"
                },
                {
                  "lineNumber": 2625,
                  "content": "                  if (newPeople[personId]) {"
                },
                {
                  "lineNumber": 2626,
                  "content": "                      newPeople[personId] = { ...newPeople[personId], count: newCount };"
                },
                {
                  "lineNumber": 2638,
                  "content": "  const onStartRenamePerson = (personId: string) =&gt; { setState(s =&gt; ({ ...s, activeModal: { type: 'rename-person', data: { personId } } })); };"
                },
                {
                  "lineNumber": 2640,
                  "content": "  const handleSetAvatar = (personId: string) =&gt; {"
                },
                {
                  "lineNumber": 2641,
                  "content": "      const person = state.people[personId];"
                },
                {
                  "lineNumber": 2642,
                  "content": "      if (person &amp;&amp; person.coverFileId) {"
                },
                {
                  "lineNumber": 2648,
                  "content": "                      personId: person.id,"
                },
                {
                  "lineNumber": 2649,
                  "content": "                      fileUrl: state.files[person.coverFileId]?.url,"
                },
                {
                  "lineNumber": 2650,
                  "content": "                      initialBox: person.faceBox"
                },
                {
                  "lineNumber": 2657,
                  "content": "  const handleSaveAvatarCrop = (personId: string, box: {x: number, y: number, w: number, h: number}) =&gt; {"
                },
                {
                  "lineNumber": 2658,
                  "content": "      handleUpdatePerson(personId, { faceBox: box });"
                },
                {
                  "lineNumber": 2714,
                  "content": "                           activePersonId: null"
                },
                {
                  "lineNumber": 2758,
                  "content": "  const pushHistory = (folderId: string, viewingId: string | null, viewMode: 'browser' | 'tags-overview' | 'people-overview' = 'browser', searchQuery: string = '', searchScope: SearchScope = 'all', activeTags: string[] = [], activePersonId: string | null = null, nextScrollTop: number = 0, aiFilter: AiSearchFilter | null | undefined = null) =&gt; {"
                },
                {
                  "lineNumber": 2765,
                  "content": "          const newStack = [...stackCopy.slice(0, prevTab.history.currentIndex + 1), { folderId, viewingId, viewMode, searchQuery, searchScope, activeTags, activePersonId, aiFilter, scrollTop: nextScrollTop }];"
                },
                {
                  "lineNumber": 2766,
                  "content": "          return { folderId, viewingFileId: viewingId, viewMode, searchQuery, searchScope, activeTags, activePersonId, aiFilter, scrollTop: nextScrollTop, selectedFileIds: viewingId ? [viewingId] : [], selectedPersonIds: [], selectedTagIds: [], history: { stack: newStack, currentIndex: newStack.length - 1 } };"
                },
                {
                  "lineNumber": 2875,
                  "content": "              return { folderId: step.folderId, viewingFileId: step.viewingId, viewMode: step.viewMode, searchQuery: step.searchQuery, searchScope: step.searchScope, activeTags: step.activeTags || [], activePersonId: step.activePersonId, aiFilter: step.aiFilter, scrollTop: step.scrollTop || 0, selectedFileIds: step.viewingId ? [step.viewingId] : [], selectedPersonIds: [], selectedTagIds: [], history: { ...prevTab.history, currentIndex: newIndex } };"
                },
                {
                  "lineNumber": 2885,
                  "content": "              return { folderId: step.folderId, viewingFileId: step.viewingId, viewMode: step.viewMode, searchQuery: step.searchQuery, searchScope: step.searchScope, activeTags: step.activeTags || [], activePersonId: step.activePersonId, aiFilter: step.aiFilter, scrollTop: step.scrollTop || 0, selectedFileIds: step.viewingId ? [step.viewingId] : [], selectedPersonIds: [], selectedTagIds: [], history: { ...prevTab.history, currentIndex: newIndex } };"
                },
                {
                  "lineNumber": 2893,
                  "content": "          pushHistory(activeTab.folderId, null, activeTab.viewMode, activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, activeTab.activePersonId, activeTab.scrollTop, activeTab.aiFilter);"
                },
                {
                  "lineNumber": 2901,
                  "content": "      pushHistory(activeTab.folderId, fileId, 'browser', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, activeTab.activePersonId, scrollTop, activeTab.aiFilter);"
                },
                {
                  "lineNumber": 3070,
                  "content": "  const enterPersonView = (personId: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'all', [], personId, 0);"
                },
                {
                  "lineNumber": 3073,
                  "content": "  const handleClearPersonFilter = () =&gt; updateActiveTab({ activePersonId: null });"
                },
                {
                  "lineNumber": 3195,
                  "content": "  const handleContextMenu = (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'background' | 'tab' | 'person', id: string) =&gt; {"
                },
                {
                  "lineNumber": 3226,
                  "content": "    else if (type === 'person') { menuType = 'person'; }"
                },
                {
                  "lineNumber": 3231,
                  "content": "  const handleNavigateUp = () =&gt; { if (activeTab.activePersonId) { enterPeopleOverview(); } else if (activeTab.viewMode === 'people-overview' || activeTab.viewMode === 'tags-overview') { enterFolder(activeTab.folderId); } else { const current = state.files[activeTab.folderId]; if (current &amp;&amp; current.parentId) { enterFolder(current.parentId); } } };"
                },
                {
                  "lineNumber": 3351,
                  "content": "          activePersonId: null,"
                },
                {
                  "lineNumber": 3355,
                  "content": "          selectedPersonIds: [],"
                },
                {
                  "lineNumber": 3360,
                  "content": "      newTab.history.stack = [{ folderId: newTab.folderId, viewingId: newTab.viewingFileId, viewMode: 'browser', searchQuery: '', searchScope: 'all', activeTags: [], activePersonId: null }];"
                },
                {
                  "lineNumber": 3482,
                  "content": "  const handleNewTab = () =&gt; { const newTab: TabState = { ...DUMMY_TAB, id: Math.random().toString(36).substr(2, 9), folderId: state.roots[0] || '' }; newTab.history = { stack: [{ folderId: newTab.folderId, viewingId: null, viewMode: 'browser', searchQuery: '', searchScope: 'all', activeTags: [], activePersonId: null }], currentIndex: 0 }; setState(prev =&gt; ({ ...prev, tabs: [...prev.tabs, newTab], activeTabId: newTab.id })); };"
                },
                {
                  "lineNumber": 3690,
                  "content": "                  const analysisPrompt = &#96;Based on the following image descriptions, translated text, and extracted text, provide a detailed analysis and summary of the content. Your output must be in ${targetLanguage}.\\n\\nPlease include the following elements:\\n1. Overall story or narrative connecting the images\\n2. Key characters and their actions\\n3. Important plot points or events\\n4. If there is any extracted text or dialogue, mention the key quotes and provide a brief analysis of their significance\\n5. If there are translated texts, analyze their content and significance\\n6. The overall theme or message conveyed by the images\\n\\nImage Descriptions:\\n${allDescriptions || 'No descriptions available'}\\n\\nTranslated Text (if any):\\n${allTranslatedText || 'No translated text available'}\\n\\nExtracted Text (if any):\\n${allExtractedText || 'No text extracted from images'}\\n\\nComprehensive Analysis:&#96;;"
                },
                {
                  "lineNumber": 3977,
                  "content": "      if (aiConfig.enhancePersonDescription) {"
                },
                {
                  "lineNumber": 3979,
                  "content": "          - description: string (请简单描述这张图里的内容。着重描述图片里的人物行为。并且对人物体型进行说明。)"
                },
                {
                  "lineNumber": 4135,
                  "content": "                      let personId = Object.keys(currentPeople).find(pid =&gt; currentPeople[pid].name.toLowerCase() === name.toLowerCase());"
                },
                {
                  "lineNumber": 4137,
                  "content": "                      if (!personId) {"
                },
                {
                  "lineNumber": 4139,
                  "content": "                              personId = Math.random().toString(36).substr(2, 9);"
                },
                {
                  "lineNumber": 4140,
                  "content": "                              currentPeople[personId] = {"
                },
                {
                  "lineNumber": 4141,
                  "content": "                                  id: personId,"
                },
                {
                  "lineNumber": 4151,
                  "content": "                      if (personId) {"
                },
                {
                  "lineNumber": 4154,
                  "content": "                              personId: personId,"
                },
                {
                  "lineNumber": 4160,
                  "content": "                          if (currentPeople[personId]) {"
                },
                {
                  "lineNumber": 4161,
                  "content": "                              currentPeople[personId] = {"
                },
                {
                  "lineNumber": 4162,
                  "content": "                                  ...currentPeople[personId],"
                },
                {
                  "lineNumber": 4163,
                  "content": "                                  count: currentPeople[personId].count + 1"
                },
                {
                  "lineNumber": 4461,
                  "content": "          &lt;Sidebar roots={state.roots} files={state.files} people={state.people} customTags={state.customTags} currentFolderId={activeTab.folderId} expandedIds={state.expandedFolderIds} tasks={state.tasks} onToggle={handleToggleFolder} onNavigate={handleNavigateFolder} onTagSelect={enterTagView} onNavigateAllTags={enterTagsOverview} onPersonSelect={enterPersonView} onNavigateAllPeople={enterPeopleOverview} onContextMenu={handleContextMenu} onDrop={(targetId, sourceIds) =&gt; handleMoveFiles(sourceIds, targetId)} onDropOnTag={handleDropOnTag} isCreatingTag={isCreatingTag} onStartCreateTag={handleCreateNewTag} onSaveNewTag={handleSaveNewTag} onCancelCreateTag={handleCancelCreateTag} onOpenSettings={toggleSettings} onRestoreTask={onRestoreTask} onStartRenamePerson={onStartRenamePerson} onCreatePerson={handleCreatePerson} t={t} /&gt;"
                },
                {
                  "lineNumber": 4558,
                  "content": "              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start || activeTab.activePersonId || activeTab.aiFilter) &amp;&amp; ("
                },
                {
                  "lineNumber": 4580,
                  "content": "                      {activeTab.activePersonId &amp;&amp; state.people[activeTab.activePersonId] &amp;&amp; ("
                },
                {
                  "lineNumber": 4583,
                  "content": "                              &lt;span&gt;{state.people[activeTab.activePersonId].name}&lt;/span&gt;"
                },
                {
                  "lineNumber": 4584,
                  "content": "                              &lt;button onClick={() =&gt; handleClearPersonFilter()} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;"
                },
                {
                  "lineNumber": 4595,
                  "content": "                      &lt;button onClick={() =&gt; { handleClearAllTags(); handleClearPersonFilter(); updateActiveTab({ dateFilter: { start: null, end: null, mode: 'created' as const }, aiFilter: null }); }} className=\"text-xs text-gray-500 hover:text-red-500 underline ml-2 whitespace-nowrap\"&gt;{t('context.clearAll')}&lt;/button&gt;"
                },
                {
                  "lineNumber": 4772,
                  "content": "                        onPersonClick={(pid, e) =&gt; handlePersonClick(pid, e)}"
                },
                {
                  "lineNumber": 4773,
                  "content": "                        onPersonContextMenu={(e, pid) =&gt; handleContextMenu(e, 'person', pid)}"
                },
                {
                  "lineNumber": 4774,
                  "content": "                        onPersonDoubleClick={(pid) =&gt; enterPersonView(pid)}"
                },
                {
                  "lineNumber": 4775,
                  "content": "                        onStartRenamePerson={(personId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'rename-person', data: { personId } } }))}"
                },
                {
                  "lineNumber": 4797,
                  "content": "          &lt;MetadataPanel files={state.files} selectedFileIds={activeTab.selectedFileIds} people={state.people} selectedPersonIds={activeTab.selectedPersonIds} onUpdate={handleUpdateFile} onUpdatePerson={handleUpdatePerson} onNavigateToFolder={handleNavigateFolder} onNavigateToTag={enterTagView} onSearch={handleViewerSearch} t={t} activeTab={activeTab} resourceRoot={state.settings.paths.resourceRoot} cachePath={state.settings.paths.cacheRoot || (state.settings.paths.resourceRoot ? &#96;${state.settings.paths.resourceRoot}${state.settings.paths.resourceRoot.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96; : undefined)} /&gt;"
                },
                {
                  "lineNumber": 4807,
                  "content": "      {state.activeModal.type &amp;&amp; ( &lt;div className=\"fixed inset-0 z-[100] bg-black/50 flex items-center justify-center p-4\"&gt;{state.activeModal.type === 'alert' &amp;&amp; state.activeModal.data &amp;&amp; ( &lt;AlertModal message={state.activeModal.data.message} onClose={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: null } }))} t={t} /&gt; )}{state.activeModal.type === 'add-to-person' &amp;&amp; ( &lt;AddToPersonModal people={state.people} files={state.files} onConfirm={handleManualAddPerson} onClose={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: null } }))} t={t} /&gt; )}{state.activeModal.type === 'rename-tag' &amp;&amp; state.activeModal.data &amp;&amp; ( &lt;RenameTagModal initialTag={state.activeModal.data.tag} onConfirm={handleRenameTag} onClose={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: null } }))} t={t} /&gt; )}{state.activeModal.type === 'batch-rename' &amp;&amp; ( &lt;BatchRenameModal count={activeTab.selectedFileIds.length} onConfirm={handleBatchRename} onClose={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: null } }))} t={t"
                },
                {
                  "lineNumber": 4812,
                  "content": "             onConfirm={(box: any) =&gt; handleSaveAvatarCrop(state.activeModal.data.personId, box)}"
                },
                {
                  "lineNumber": 4825,
                  "content": "      {state.activeModal.type === 'clear-person' &amp;&amp; state.activeModal.data &amp;&amp; ("
                },
                {
                  "lineNumber": 4826,
                  "content": "          &lt;ClearPersonModal"
                },
                {
                  "lineNumber": 4830,
                  "content": "              onConfirm={(personIds: string[]) =&gt; {"
                },
                {
                  "lineNumber": 4831,
                  "content": "                  handleClearPersonInfo(state.activeModal.data.fileIds, personIds);"
                },
                {
                  "lineNumber": 4915,
                  "content": "                {(contextMenu.type === 'file-single' || contextMenu.type === 'file-multi') &amp;&amp; Object.keys(state.people).length &gt; 0 &amp;&amp; ( &lt;&gt; &lt;div className=\"px-4 py-2 hover:bg-purple-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { setState(s =&gt; ({ ...s, activeModal: { type: 'add-to-person', data: null } })); closeContextMenu(); }}&gt;&lt;User size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.addToPerson')}&lt;/div&gt;&lt;div className=\"px-4 py-2 hover:bg-purple-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; {"
                },
                {
                  "lineNumber": 4925,
                  "content": "                                allPeople.add(face.personId);"
                },
                {
                  "lineNumber": 4938,
                  "content": "                        // Only one person or no person, just clear all"
                },
                {
                  "lineNumber": 4939,
                  "content": "                        handleClearPersonInfo(fileIds);"
                },
                {
                  "lineNumber": 4944,
                  "content": "                        setState(s =&gt; ({ ...s, activeModal: { type: 'clear-person', data: { fileIds } } }));"
                },
                {
                  "lineNumber": 4947,
                  "content": "                }}&gt;&lt;XCircle size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.clearPersonInfo')}&lt;/div&gt;&lt;/&gt; )}"
                },
                {
                  "lineNumber": 4995,
                  "content": "          {contextMenu.type === 'person' &amp;&amp; ( &lt;&gt;"
                },
                {
                  "lineNumber": 4996,
                  "content": "            {activeTab.selectedPersonIds.length &gt; 1 ? ("
                },
                {
                  "lineNumber": 4999,
                  "content": "                    setState(s =&gt; ({ ...s, activeModal: { type: 'confirm-delete-person', data: { personId: activeTab.selectedPersonIds } } }));"
                },
                {
                  "lineNumber": 5005,
                  "content": "                // Single person selected: show full menu"
                },
                {
                  "lineNumber": 5008,
                  "content": "                    &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer\" onClick={() =&gt; { enterPersonView(contextMenu.targetId!); closeContextMenu(); }}&gt;{t('context.viewTagged')}&lt;/div&gt;"
                },
                {
                  "lineNumber": 5010,
                  "content": "                    &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer flex items-center\" onClick={() =&gt; { setState(s =&gt; ({ ...s, activeModal: { type: 'rename-person', data: { personId: contextMenu.targetId! } } })); closeContextMenu(); }}&gt;&lt;Edit3 size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.renamePerson')}&lt;/div&gt;"
                },
                {
                  "lineNumber": 5013,
                  "content": "                        setState(s =&gt; ({ ...s, activeModal: { type: 'confirm-delete-person', data: { personId: contextMenu.targetId! } } }));"
                },
                {
                  "lineNumber": 5016,
                  "content": "                        &lt;Trash2 size={14} className=\"mr-2 opacity-70\"/&gt; {t('context.deletePerson')}"
                },
                {
                  "lineNumber": 5025,
                  "content": "              // 人物主界面：显示新建人物选项"
                },
                {
                  "lineNumber": 5026,
                  "content": "              &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer\" onClick={() =&gt; { handleCreatePerson(); closeContextMenu(); }}&gt;{t('context.newPerson')}&lt;/div&gt;"
                }
              ]
            }
          ],
          "totalLines": 181,
          "totalMatchedLines": 181
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "人物主面板切换 activeTab character tab",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nfor (let fileIndex = 0; fileIndex &lt; imageFileIds.length; fileIndex++) {\n\n              const newTags = Array.from(new Set([...currentTags, ...aiData.tags]));\n\n              // Step 6: Save all AI data\n              updateTask(taskId, { current: currentStep + 6, currentStep: t('tasks.savingData') });\n              const updatedFile = {\n                  ...file,\n                  aiData,\n                  tags: newTags,\n                  description: file.description ? file.description : aiData.description\n              };\n\n              setState(prev =&gt; ({\n                  ...prev,\n                  people: currentPeople, // Always use the latest shared currentPeople\n                  files: {\n                      ...prev.files,\n                      [fileId]: updatedFile\n                  }\n              }));\n          }\n          \n          // If folderId is provided, summarize all results and update folder description\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 4154,
                "column": 3
              },
              "endPosition": {
                "line": 4154,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 4154,
                "column": 9
              },
              "endPosition": {
                "line": 4154,
                "column": 40
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3593
          },
          {
            "text": "for (let fileIndex = 0; fileIndex &lt; imageFileIds.length; fileIndex++) {",
            "lineNumber": 4027
          },
          {
            "lineNumber": 4190
          },
          {
            "text": "              const newTags = Array.from(new Set([...currentTags, ...aiData.tags]));",
            "lineNumber": 4191
          },
          {
            "lineNumber": 4192
          },
          {
            "text": "              // Step 6: Save all AI data",
            "lineNumber": 4193
          },
          {
            "text": "              updateTask(taskId, { current: currentStep + 6, currentStep: t('tasks.savingData') });",
            "lineNumber": 4194
          },
          {
            "text": "              const updatedFile = {",
            "lineNumber": 4195
          },
          {
            "text": "                  ...file,",
            "lineNumber": 4196
          },
          {
            "text": "                  aiData,",
            "lineNumber": 4197
          },
          {
            "text": "                  tags: newTags,",
            "lineNumber": 4198
          },
          {
            "text": "                  description: file.description ? file.description : aiData.description",
            "lineNumber": 4199
          },
          {
            "text": "              };",
            "lineNumber": 4200
          },
          {
            "lineNumber": 4201
          },
          {
            "text": "              setState(prev =&gt; ({",
            "lineNumber": 4202
          },
          {
            "text": "                  ...prev,",
            "lineNumber": 4203
          },
          {
            "text": "                  people: currentPeople, // Always use the latest shared currentPeople",
            "lineNumber": 4204
          },
          {
            "text": "                  files: {",
            "lineNumber": 4205
          },
          {
            "text": "                      ...prev.files,",
            "lineNumber": 4206
          },
          {
            "text": "                      [fileId]: updatedFile",
            "lineNumber": 4207
          },
          {
            "text": "                  }",
            "lineNumber": 4208
          },
          {
            "text": "              }));",
            "lineNumber": 4209
          },
          {
            "text": "          }",
            "lineNumber": 4210
          },
          {
            "text": "          ",
            "lineNumber": 4211
          },
          {
            "text": "          // If folderId is provided, summarize all results and update folder description",
            "lineNumber": 4212
          },
          {
            "text": ";",
            "lineNumber": 4386
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3751790523529053
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\types.ts",
        "range": {
          "startPosition": {
            "line": 183
          },
          "endPosition": {
            "line": 216,
            "column": 1
          }
        },
        "contents": "export interface HistoryItem {\n;\n  viewMode: 'browser' | 'tags-overview' | 'people-overview';\n  searchQuery: string;\n  searchScope: SearchScope;\n  activeTags: string[];\n  activePersonId: string | null;\n  aiFilter?: AiSearchFilter | null;\n  scrollTop?: number;\n}\n\nexport interface TabState {\n  id: string;\n  folderId: string;\n  viewingFileId: string | null;\n  viewMode: 'browser' | 'tags-overview' | 'people-overview'; \n  layoutMode: LayoutMode;\n  searchQuery: string;\n  searchScope: SearchScope;\n  aiFilter?: AiSearchFilter | null;\n  activeTags: string[];\n  activePersonId: string | null;\n  dateFilter: DateFilter;\n  selectedFileIds: string[];\n  lastSelectedId: string | null;\n  selectedTagIds: string[];\n  selectedPersonIds: string[];\n;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export interface HistoryItem {",
            "lineNumber": 184,
            "isSignature": true
          },
          {
            "text": ";",
            "lineNumber": 186
          },
          {
            "text": "  viewMode: 'browser' | 'tags-overview' | 'people-overview';",
            "lineNumber": 187
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 188
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 189
          },
          {
            "text": "  activeTags: string[];",
            "lineNumber": 190
          },
          {
            "text": "  activePersonId: string | null;",
            "lineNumber": 191
          },
          {
            "text": "  aiFilter?: AiSearchFilter | null;",
            "lineNumber": 192
          },
          {
            "text": "  scrollTop?: number;",
            "lineNumber": 193,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 194,
            "isSignature": true
          },
          {
            "lineNumber": 195
          },
          {
            "text": "export interface TabState {",
            "lineNumber": 196,
            "isSignature": true
          },
          {
            "text": "  id: string;",
            "lineNumber": 197
          },
          {
            "text": "  folderId: string;",
            "lineNumber": 198
          },
          {
            "text": "  viewingFileId: string | null;",
            "lineNumber": 199
          },
          {
            "text": "  viewMode: 'browser' | 'tags-overview' | 'people-overview'; ",
            "lineNumber": 200
          },
          {
            "text": "  layoutMode: LayoutMode;",
            "lineNumber": 201
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 202
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 203
          },
          {
            "text": "  aiFilter?: AiSearchFilter | null;",
            "lineNumber": 204
          },
          {
            "text": "  activeTags: string[];",
            "lineNumber": 205
          },
          {
            "text": "  activePersonId: string | null;",
            "lineNumber": 206
          },
          {
            "text": "  dateFilter: DateFilter;",
            "lineNumber": 207
          },
          {
            "text": "  selectedFileIds: string[];",
            "lineNumber": 208
          },
          {
            "text": "  lastSelectedId: string | null;",
            "lineNumber": 209
          },
          {
            "text": "  selectedTagIds: string[];",
            "lineNumber": 210
          },
          {
            "text": "  selectedPersonIds: string[];",
            "lineNumber": 211
          },
          {
            "text": ";",
            "lineNumber": 216,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 217,
            "isSignature": true
          }
        ]
      },
      "score": 0.36518675088882446
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n\n  // ... (keep dimension loading, folder expanding, theme, sort, etc.)\n\n  \n  // Lazy load dimensions when file is selected\n  useEffect(() =&gt; {\n      // 目前仅在Tauri环境下支持延迟加载图片尺寸\n  }, [activeTab.selectedFileIds, activeTab.viewingFileId]);\n\n  useEffect(() =&gt; {\n    const currentFolderId = activeTab.folderId;\n    if (!currentFolderId) return;\n    setState(prev =&gt; {\n        const files = prev.files;\n        if (!files[currentFolderId]) return prev;\n        const ancestorsToExpand = new Set&lt;string&gt;();\n        let curr = files[currentFolderId];\n        while (curr &amp;&amp; curr.parentId) { ancestorsToExpand.add(curr.parentId); curr = files[curr.parentId]; }\n        if (ancestorsToExpand.size === 0) return prev;\n        const existingExpanded = new Set(prev.expandedFolderIds);\n        let changed = false;\n        ancestorsToExpand.forEach(id =&gt; { if (!existingExpanded.has(id)) { existingExpanded.add(id); changed = true; } });\n        if (!changed) return prev;\n        return { ...prev, expandedFolderIds: Array.from(existingExpanded) };\n    });\n  }, [activeTab.folderId]);\n\n  useEffect(() =&gt; {\n    const root = window.document.documentElement;\n    const applyTheme = () =&gt; {\n      const theme = state.settings.theme;\n      let isDark = false;\n      if (theme === 'dark') isDark = true;\n      else if (theme === 'light') isDark = false;\n      else { \n          if (window.matchMedia('(prefers-color-scheme: dark)').matches) isDark = true; \n          else isDark = false; \n      }\n      if (isDark) root.classList.add('dark');\n      else root.classList.remove('dark');\n    };\n    applyTheme();\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    const handleChange = () =&gt; { if (state.settings.theme === 'system') applyTheme(); };\n    mediaQuery.addEventListener('change', handleChange);\n    return () =&gt; mediaQuery.removeEventListener('change', handleChange);\n  }, [state.settings.theme]);\n\n  useEffect(() =&gt; { setToolbarQuery(activeTab.searchQuery); }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 655,
                "column": 3
              },
              "endPosition": {
                "line": 655,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 655,
                "column": 13
              },
              "endPosition": {
                "line": 656,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 712,
                "column": 3
              },
              "endPosition": {
                "line": 712,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 712,
                "column": 13
              },
              "endPosition": {
                "line": 713,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "lineNumber": 1006
          },
          {
            "lineNumber": 1007
          },
          {
            "text": "  // ... (keep dimension loading, folder expanding, theme, sort, etc.)",
            "lineNumber": 1008
          },
          {
            "lineNumber": 1009
          },
          {
            "text": "  ",
            "lineNumber": 1010
          },
          {
            "text": "  // Lazy load dimensions when file is selected",
            "lineNumber": 1011
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 1012
          },
          {
            "text": "      // 目前仅在Tauri环境下支持延迟加载图片尺寸",
            "lineNumber": 1013
          },
          {
            "text": "  }, [activeTab.selectedFileIds, activeTab.viewingFileId]);",
            "lineNumber": 1014
          },
          {
            "lineNumber": 1015
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 1016
          },
          {
            "text": "    const currentFolderId = activeTab.folderId;",
            "lineNumber": 1017
          },
          {
            "text": "    if (!currentFolderId) return;",
            "lineNumber": 1018
          },
          {
            "text": "    setState(prev =&gt; {",
            "lineNumber": 1019
          },
          {
            "text": "        const files = prev.files;",
            "lineNumber": 1020
          },
          {
            "text": "        if (!files[currentFolderId]) return prev;",
            "lineNumber": 1021
          },
          {
            "text": "        const ancestorsToExpand = new Set&lt;string&gt;();",
            "lineNumber": 1022
          },
          {
            "text": "        let curr = files[currentFolderId];",
            "lineNumber": 1023
          },
          {
            "text": "        while (curr &amp;&amp; curr.parentId) { ancestorsToExpand.add(curr.parentId); curr = files[curr.parentId]; }",
            "lineNumber": 1024
          },
          {
            "text": "        if (ancestorsToExpand.size === 0) return prev;",
            "lineNumber": 1025
          },
          {
            "text": "        const existingExpanded = new Set(prev.expandedFolderIds);",
            "lineNumber": 1026
          },
          {
            "text": "        let changed = false;",
            "lineNumber": 1027
          },
          {
            "text": "        ancestorsToExpand.forEach(id =&gt; { if (!existingExpanded.has(id)) { existingExpanded.add(id); changed = true; } });",
            "lineNumber": 1028
          },
          {
            "text": "        if (!changed) return prev;",
            "lineNumber": 1029
          },
          {
            "text": "        return { ...prev, expandedFolderIds: Array.from(existingExpanded) };",
            "lineNumber": 1030
          },
          {
            "text": "    });",
            "lineNumber": 1031
          },
          {
            "text": "  }, [activeTab.folderId]);",
            "lineNumber": 1032
          },
          {
            "lineNumber": 1033
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 1034
          },
          {
            "text": "    const root = window.document.documentElement;",
            "lineNumber": 1035
          },
          {
            "text": "    const applyTheme = () =&gt; {",
            "lineNumber": 1036
          },
          {
            "text": "      const theme = state.settings.theme;",
            "lineNumber": 1037
          },
          {
            "text": "      let isDark = false;",
            "lineNumber": 1038
          },
          {
            "text": "      if (theme === 'dark') isDark = true;",
            "lineNumber": 1039
          },
          {
            "text": "      else if (theme === 'light') isDark = false;",
            "lineNumber": 1040
          },
          {
            "text": "      else { ",
            "lineNumber": 1041
          },
          {
            "text": "          if (window.matchMedia('(prefers-color-scheme: dark)').matches) isDark = true; ",
            "lineNumber": 1042
          },
          {
            "text": "          else isDark = false; ",
            "lineNumber": 1043
          },
          {
            "text": "      }",
            "lineNumber": 1044
          },
          {
            "text": "      if (isDark) root.classList.add('dark');",
            "lineNumber": 1045
          },
          {
            "text": "      else root.classList.remove('dark');",
            "lineNumber": 1046
          },
          {
            "text": "    };",
            "lineNumber": 1047
          },
          {
            "text": "    applyTheme();",
            "lineNumber": 1048
          },
          {
            "text": "    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');",
            "lineNumber": 1049
          },
          {
            "text": "    const handleChange = () =&gt; { if (state.settings.theme === 'system') applyTheme(); };",
            "lineNumber": 1050
          },
          {
            "text": "    mediaQuery.addEventListener('change', handleChange);",
            "lineNumber": 1051
          },
          {
            "text": "    return () =&gt; mediaQuery.removeEventListener('change', handleChange);",
            "lineNumber": 1052
          },
          {
            "text": "  }, [state.settings.theme]);",
            "lineNumber": 1053
          },
          {
            "lineNumber": 1054
          },
          {
            "text": "  useEffect(() =&gt; { setToolbarQuery(activeTab.searchQuery); }",
            "lineNumber": 1055
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.34345659613609314
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\types.ts",
        "range": {
          "startPosition": {
            "line": 195
          },
          "endPosition": {
            "line": 251,
            "column": 1
          }
        },
        "contents": "export interface TabState {\n\n  history: {\n    stack: HistoryItem[];\n    currentIndex: number;\n  };\n  scrollTop: number;\n}\n\nexport type SettingsCategory = 'general' | 'appearance' | 'network' | 'storage' | 'ai';\n\nexport interface AppState {\n  roots: string[];\n  files: Record&lt;string, FileNode&gt;;\n  people: Record&lt;string, Person&gt;;\n  expandedFolderIds: string[];\n  tabs: TabState[];\n  activeTabId: string;\n  sortBy: SortOption;\n  sortDirection: SortDirection;\n  thumbnailSize: number;\n  renamingId: string | null;\n  clipboard: {\n    action: 'copy' | 'move' | null;\n    items: { type: 'file' | 'tag', ids: string[] }; \n  };\n  customTags: string[];\n  folderSettings: Record&lt;string, FolderSettings&gt;; // 文件夹ID -&gt; 文件夹设置\n  layout: {\n    isSidebarVisible: boolean;\n    isMetadataVisible: boolean;\n  };\n  slideshowConfig: SlideshowConfig;\n  settings: AppSettings;\n  isSettingsOpen: boolean;\n  settingsCategory: SettingsCategory;\n;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export interface TabState {",
            "lineNumber": 196,
            "isSignature": true
          },
          {
            "lineNumber": 211
          },
          {
            "text": "  history: {",
            "lineNumber": 212
          },
          {
            "text": "    stack: HistoryItem[];",
            "lineNumber": 213
          },
          {
            "text": "    currentIndex: number;",
            "lineNumber": 214
          },
          {
            "text": "  };",
            "lineNumber": 215
          },
          {
            "text": "  scrollTop: number;",
            "lineNumber": 216,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 217,
            "isSignature": true
          },
          {
            "lineNumber": 218
          },
          {
            "text": "export type SettingsCategory = 'general' | 'appearance' | 'network' | 'storage' | 'ai';",
            "lineNumber": 219,
            "isSignature": true
          },
          {
            "lineNumber": 220
          },
          {
            "text": "export interface AppState {",
            "lineNumber": 221,
            "isSignature": true
          },
          {
            "text": "  roots: string[];",
            "lineNumber": 222
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 223
          },
          {
            "text": "  people: Record&lt;string, Person&gt;;",
            "lineNumber": 224
          },
          {
            "text": "  expandedFolderIds: string[];",
            "lineNumber": 225
          },
          {
            "text": "  tabs: TabState[];",
            "lineNumber": 226
          },
          {
            "text": "  activeTabId: string;",
            "lineNumber": 227
          },
          {
            "text": "  sortBy: SortOption;",
            "lineNumber": 228
          },
          {
            "text": "  sortDirection: SortDirection;",
            "lineNumber": 229
          },
          {
            "text": "  thumbnailSize: number;",
            "lineNumber": 230
          },
          {
            "text": "  renamingId: string | null;",
            "lineNumber": 231
          },
          {
            "text": "  clipboard: {",
            "lineNumber": 232
          },
          {
            "text": "    action: 'copy' | 'move' | null;",
            "lineNumber": 233
          },
          {
            "text": "    items: { type: 'file' | 'tag', ids: string[] }; ",
            "lineNumber": 234
          },
          {
            "text": "  };",
            "lineNumber": 235
          },
          {
            "text": "  customTags: string[];",
            "lineNumber": 236
          },
          {
            "text": "  folderSettings: Record&lt;string, FolderSettings&gt;; // 文件夹ID -&gt; 文件夹设置",
            "lineNumber": 237
          },
          {
            "text": "  layout: {",
            "lineNumber": 238
          },
          {
            "text": "    isSidebarVisible: boolean;",
            "lineNumber": 239
          },
          {
            "text": "    isMetadataVisible: boolean;",
            "lineNumber": 240
          },
          {
            "text": "  };",
            "lineNumber": 241
          },
          {
            "text": "  slideshowConfig: SlideshowConfig;",
            "lineNumber": 242
          },
          {
            "text": "  settings: AppSettings;",
            "lineNumber": 243
          },
          {
            "text": "  isSettingsOpen: boolean;",
            "lineNumber": 244
          },
          {
            "text": "  settingsCategory: SettingsCategory;",
            "lineNumber": 245
          },
          {
            "text": ";",
            "lineNumber": 251,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 252,
            "isSignature": true
          }
        ]
      },
      "score": 0.33855950832366943
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n              &lt;TopBar \n                activeTab={activeTab} \n                state={state} \n                toolbarQuery={toolbarQuery} \n                groupedTags={groupedTags} \n                tagSearchQuery={tagSearchQuery} \n                onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))} \n                onGoBack={goBack} \n                onGoForward={goForward} \n                onNavigateUp={handleNavigateUp} \n                onSetTagSearchQuery={setTagSearchQuery} \n                onTagClick={handleTagClick} \n                onRefresh={handleRefresh} \n                onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })} \n                onPerformSearch={handlePerformSearch} \n                onSetToolbarQuery={setToolbarQuery} \n                onLayoutModeChange={(mode) =&gt; updateActiveTab({ layoutMode: mode })} \n                onSortOptionChange={(opt) =&gt; setState(s =&gt; ({ ...s, sortBy: opt }))} \n                onSortDirectionChange={() =&gt; setState(s =&gt; ({ ...s, sortDirection: s.sortDirection === 'asc' ? 'desc' : 'asc' }))} \n                onThumbnailSizeChange={(size) =&gt; setState(s =&gt; ({ ...s, thumbnailSize: size }))} \n                onToggleMetadata={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isMetadataVisible: !s.layout.isMetadataVisible } }))} \n                onToggleSettings={toggleSettings} \n                onUpdateDateFilter={(f) =&gt; updateActiveTab({ dateFilter: f })} \n                groupBy={groupBy}\n                onGroupByChange={setGroupBy}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "lineNumber": 4525
          },
          {
            "text": "              &lt;TopBar ",
            "lineNumber": 4526
          },
          {
            "text": "                activeTab={activeTab} ",
            "lineNumber": 4527
          },
          {
            "text": "                state={state} ",
            "lineNumber": 4528
          },
          {
            "text": "                toolbarQuery={toolbarQuery} ",
            "lineNumber": 4529
          },
          {
            "text": "                groupedTags={groupedTags} ",
            "lineNumber": 4530
          },
          {
            "text": "                tagSearchQuery={tagSearchQuery} ",
            "lineNumber": 4531
          },
          {
            "text": "                onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))} ",
            "lineNumber": 4532
          },
          {
            "text": "                onGoBack={goBack} ",
            "lineNumber": 4533
          },
          {
            "text": "                onGoForward={goForward} ",
            "lineNumber": 4534
          },
          {
            "text": "                onNavigateUp={handleNavigateUp} ",
            "lineNumber": 4535
          },
          {
            "text": "                onSetTagSearchQuery={setTagSearchQuery} ",
            "lineNumber": 4536
          },
          {
            "text": "                onTagClick={handleTagClick} ",
            "lineNumber": 4537
          },
          {
            "text": "                onRefresh={handleRefresh} ",
            "lineNumber": 4538
          },
          {
            "text": "                onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })} ",
            "lineNumber": 4539
          },
          {
            "text": "                onPerformSearch={handlePerformSearch} ",
            "lineNumber": 4540
          },
          {
            "text": "                onSetToolbarQuery={setToolbarQuery} ",
            "lineNumber": 4541
          },
          {
            "text": "                onLayoutModeChange={(mode) =&gt; updateActiveTab({ layoutMode: mode })} ",
            "lineNumber": 4542
          },
          {
            "text": "                onSortOptionChange={(opt) =&gt; setState(s =&gt; ({ ...s, sortBy: opt }))} ",
            "lineNumber": 4543
          },
          {
            "text": "                onSortDirectionChange={() =&gt; setState(s =&gt; ({ ...s, sortDirection: s.sortDirection === 'asc' ? 'desc' : 'asc' }))} ",
            "lineNumber": 4544
          },
          {
            "text": "                onThumbnailSizeChange={(size) =&gt; setState(s =&gt; ({ ...s, thumbnailSize: size }))} ",
            "lineNumber": 4545
          },
          {
            "text": "                onToggleMetadata={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isMetadataVisible: !s.layout.isMetadataVisible } }))} ",
            "lineNumber": 4546
          },
          {
            "text": "                onToggleSettings={toggleSettings} ",
            "lineNumber": 4547
          },
          {
            "text": "                onUpdateDateFilter={(f) =&gt; updateActiveTab({ dateFilter: f })} ",
            "lineNumber": 4548
          },
          {
            "text": "                groupBy={groupBy}",
            "lineNumber": 4549
          },
          {
            "text": "                onGroupByChange={setGroupBy}",
            "lineNumber": 4550
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.33752983808517456
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleCreateFolder = async \n\n          \n          // Find all root files to check for name conflicts\n          const rootFiles = state.roots.map(rootId =&gt; state.files[rootId]);\n          while (rootFiles.some(file =&gt; file?.name === name)) {\n              name = &#96;${baseName} (${counter++})&#96;;\n          }\n          \n          // Create new folder in root\n          const newId = Math.random().toString(36).substr(2, 9);\n          const newFolder: FileNode = {\n              id: newId,\n              parentId: null,\n              name,\n              type: FileType.FOLDER,\n              path: '',\n              children: [],\n              tags: [],\n              createdAt: new Date().toISOString(),\n              updatedAt: new Date().toISOString()\n          };\n          \n          setState(prev =&gt; ({\n              ...prev,\n              files: { ...prev.files, [newId]: newFolder },\n              roots: [...prev.roots, newId],\n              renamingId: newId\n          }));\n          return;\n      }\n      \n      const parent = state.files[parentId];\n      if (!parent) return;\n      const baseName = t('context.newFolder');\n      let name = baseName;\n      if (parent.path)\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleCreateFolder = async ",
            "lineNumber": 3235
          },
          {
            "lineNumber": 3242
          },
          {
            "text": "          ",
            "lineNumber": 3243
          },
          {
            "text": "          // Find all root files to check for name conflicts",
            "lineNumber": 3244
          },
          {
            "text": "          const rootFiles = state.roots.map(rootId =&gt; state.files[rootId]);",
            "lineNumber": 3245
          },
          {
            "text": "          while (rootFiles.some(file =&gt; file?.name === name)) {",
            "lineNumber": 3246
          },
          {
            "text": "              name = &#96;${baseName} (${counter++})&#96;;",
            "lineNumber": 3247
          },
          {
            "text": "          }",
            "lineNumber": 3248
          },
          {
            "text": "          ",
            "lineNumber": 3249
          },
          {
            "text": "          // Create new folder in root",
            "lineNumber": 3250
          },
          {
            "text": "          const newId = Math.random().toString(36).substr(2, 9);",
            "lineNumber": 3251
          },
          {
            "text": "          const newFolder: FileNode = {",
            "lineNumber": 3252
          },
          {
            "text": "              id: newId,",
            "lineNumber": 3253
          },
          {
            "text": "              parentId: null,",
            "lineNumber": 3254
          },
          {
            "text": "              name,",
            "lineNumber": 3255
          },
          {
            "text": "              type: FileType.FOLDER,",
            "lineNumber": 3256
          },
          {
            "text": "              path: '',",
            "lineNumber": 3257
          },
          {
            "text": "              children: [],",
            "lineNumber": 3258
          },
          {
            "text": "              tags: [],",
            "lineNumber": 3259
          },
          {
            "text": "              createdAt: new Date().toISOString(),",
            "lineNumber": 3260
          },
          {
            "text": "              updatedAt: new Date().toISOString()",
            "lineNumber": 3261
          },
          {
            "text": "          };",
            "lineNumber": 3262
          },
          {
            "text": "          ",
            "lineNumber": 3263
          },
          {
            "text": "          setState(prev =&gt; ({",
            "lineNumber": 3264
          },
          {
            "text": "              ...prev,",
            "lineNumber": 3265
          },
          {
            "text": "              files: { ...prev.files, [newId]: newFolder },",
            "lineNumber": 3266
          },
          {
            "text": "              roots: [...prev.roots, newId],",
            "lineNumber": 3267
          },
          {
            "text": "              renamingId: newId",
            "lineNumber": 3268
          },
          {
            "text": "          }));",
            "lineNumber": 3269
          },
          {
            "text": "          return;",
            "lineNumber": 3270
          },
          {
            "text": "      }",
            "lineNumber": 3271
          },
          {
            "text": "      ",
            "lineNumber": 3272
          },
          {
            "text": "      const parent = state.files[parentId];",
            "lineNumber": 3273
          },
          {
            "text": "      if (!parent) return;",
            "lineNumber": 3274
          },
          {
            "text": "      const baseName = t('context.newFolder');",
            "lineNumber": 3275
          },
          {
            "text": "      let name = baseName;",
            "lineNumber": 3276
          },
          {
            "text": "      if (parent.path)",
            "lineNumber": 3277
          },
          {
            "text": ";",
            "lineNumber": 3334
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.33659088611602783
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TabBar.tsx",
        "range": {
          "startPosition": {
            "line": 19
          },
          "endPosition": {
            "line": 229,
            "column": 1
          }
        },
        "contents": "export const TabBar: React.FC&lt;TabBarProps&gt; = \nconst getTabTitle = \n {\n                return parent.name;\n            }\n        }\n        return file?.name || t('app.viewing');\n    }\n    \n    if (tab.activeTags.length &gt; 0) return &#96;${tab.activeTags.length} ${t('app.filters')}&#96;;\n    return files[tab.folderId]?.name || t('app.folder');\n  };\n\n  const getTabIcon = (tab: TabState) =&gt; {\n    if (tab.viewMode === 'tags-overview') return &lt;Tag size={12} className=\"mr-1 text-purple-500\" /&gt;;\n    \n    if (tab.viewingFileId) {\n        const file = files[tab.viewingFileId];\n        if (file &amp;&amp; file.parentId) {\n            const parent = files[file.parentId];\n            if (parent?.category === 'book') {\n                return &lt;Book size={12} className=\"mr-1 text-amber-500\" /&gt;;\n            }\n            if (parent?.category === 'sequence') {\n                return &lt;Film size={12} className=\"mr-1 text-purple-500\" /&gt;;\n            }\n        }\n        return &lt;ImageIcon size={12} className=\"mr-1 text-green-500\" /&gt;;\n    }\n    \n    if (tab.activeTags.length &gt; 0) return &lt;Filter size={12} className=\"mr-1 text-amber-500\" /&gt;;\n    return &lt;Folder size={12} className=\"mr-1 text-blue-500\" /&gt;;\n  };\n\n  // Tauri window control functions\n  const handleMinimize = async () =&gt; {\n    try {\n      const window = getCurrentWindow();\n      await window.minimize();\n    } catch (error) {\n      console.error('Failed to minimize window:', error);\n    }\n  };\n\n  const handleMaximize = async () =&gt;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 17,
                "column": 1
              },
              "endPosition": {
                "line": 17,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 17,
                "column": 8
              },
              "endPosition": {
                "line": 17,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 17,
                "column": 14
              },
              "endPosition": {
                "line": 17,
                "column": 46
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const TabBar: React.FC&lt;TabBarProps&gt; = ",
            "lineNumber": 20
          },
          {
            "text": "const getTabTitle = ",
            "lineNumber": 84
          },
          {
            "text": " {",
            "lineNumber": 92
          },
          {
            "text": "                return parent.name;",
            "lineNumber": 93
          },
          {
            "text": "            }",
            "lineNumber": 94
          },
          {
            "text": "        }",
            "lineNumber": 95
          },
          {
            "text": "        return file?.name || t('app.viewing');",
            "lineNumber": 96
          },
          {
            "text": "    }",
            "lineNumber": 97
          },
          {
            "text": "    ",
            "lineNumber": 98
          },
          {
            "text": "    if (tab.activeTags.length &gt; 0) return &#96;${tab.activeTags.length} ${t('app.filters')}&#96;;",
            "lineNumber": 99
          },
          {
            "text": "    return files[tab.folderId]?.name || t('app.folder');",
            "lineNumber": 100
          },
          {
            "text": "  };",
            "lineNumber": 101
          },
          {
            "lineNumber": 102
          },
          {
            "text": "  const getTabIcon = (tab: TabState) =&gt; {",
            "lineNumber": 103
          },
          {
            "text": "    if (tab.viewMode === 'tags-overview') return &lt;Tag size={12} className=\"mr-1 text-purple-500\" /&gt;;",
            "lineNumber": 104
          },
          {
            "text": "    ",
            "lineNumber": 105
          },
          {
            "text": "    if (tab.viewingFileId) {",
            "lineNumber": 106
          },
          {
            "text": "        const file = files[tab.viewingFileId];",
            "lineNumber": 107
          },
          {
            "text": "        if (file &amp;&amp; file.parentId) {",
            "lineNumber": 108
          },
          {
            "text": "            const parent = files[file.parentId];",
            "lineNumber": 109
          },
          {
            "text": "            if (parent?.category === 'book') {",
            "lineNumber": 110
          },
          {
            "text": "                return &lt;Book size={12} className=\"mr-1 text-amber-500\" /&gt;;",
            "lineNumber": 111
          },
          {
            "text": "            }",
            "lineNumber": 112
          },
          {
            "text": "            if (parent?.category === 'sequence') {",
            "lineNumber": 113
          },
          {
            "text": "                return &lt;Film size={12} className=\"mr-1 text-purple-500\" /&gt;;",
            "lineNumber": 114
          },
          {
            "text": "            }",
            "lineNumber": 115
          },
          {
            "text": "        }",
            "lineNumber": 116
          },
          {
            "text": "        return &lt;ImageIcon size={12} className=\"mr-1 text-green-500\" /&gt;;",
            "lineNumber": 117
          },
          {
            "text": "    }",
            "lineNumber": 118
          },
          {
            "text": "    ",
            "lineNumber": 119
          },
          {
            "text": "    if (tab.activeTags.length &gt; 0) return &lt;Filter size={12} className=\"mr-1 text-amber-500\" /&gt;;",
            "lineNumber": 120
          },
          {
            "text": "    return &lt;Folder size={12} className=\"mr-1 text-blue-500\" /&gt;;",
            "lineNumber": 121
          },
          {
            "text": "  };",
            "lineNumber": 122
          },
          {
            "lineNumber": 123
          },
          {
            "text": "  // Tauri window control functions",
            "lineNumber": 124
          },
          {
            "text": "  const handleMinimize = async () =&gt; {",
            "lineNumber": 125
          },
          {
            "text": "    try {",
            "lineNumber": 126
          },
          {
            "text": "      const window = getCurrentWindow();",
            "lineNumber": 127
          },
          {
            "text": "      await window.minimize();",
            "lineNumber": 128
          },
          {
            "text": "    } catch (error) {",
            "lineNumber": 129
          },
          {
            "text": "      console.error('Failed to minimize window:', error);",
            "lineNumber": 130
          },
          {
            "text": "    }",
            "lineNumber": 131
          },
          {
            "text": "  };",
            "lineNumber": 132
          },
          {
            "lineNumber": 133
          },
          {
            "text": "  const handleMaximize = async () =&gt;",
            "lineNumber": 134
          },
          {
            "text": ";",
            "lineNumber": 144
          },
          {
            "text": ";",
            "lineNumber": 230
          }
        ]
      },
      "score": 0.33432483673095703
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n(targetId, paths) =&gt; {\n\n                            // 即使走到了 onDropExternal 通道，我们也把它强行扭转为“移动”操作\n                            if (isInternalDragRef.current) {\n                                handleMoveFiles(activeTab.selectedFileIds, targetId);\n                            } else {\n                                // 2. 确实是外部文件，执行复制\n                                // Tauri环境下使用Tauri API处理外部文件复制\n                                startTask('copy', [], t('tasks.copying'));\n                                showToast(t('context.copied'));\n                                handleRefresh();\n                            }\n                        }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "(targetId, paths) =&gt; {",
            "lineNumber": 4749
          },
          {
            "lineNumber": 4750
          },
          {
            "text": "                            // 即使走到了 onDropExternal 通道，我们也把它强行扭转为“移动”操作",
            "lineNumber": 4751
          },
          {
            "text": "                            if (isInternalDragRef.current) {",
            "lineNumber": 4752
          },
          {
            "text": "                                handleMoveFiles(activeTab.selectedFileIds, targetId);",
            "lineNumber": 4753
          },
          {
            "text": "                            } else {",
            "lineNumber": 4754
          },
          {
            "text": "                                // 2. 确实是外部文件，执行复制",
            "lineNumber": 4755
          },
          {
            "text": "                                // Tauri环境下使用Tauri API处理外部文件复制",
            "lineNumber": 4756
          },
          {
            "text": "                                startTask('copy', [], t('tasks.copying'));",
            "lineNumber": 4757
          },
          {
            "text": "                                showToast(t('context.copied'));",
            "lineNumber": 4758
          },
          {
            "text": "                                handleRefresh();",
            "lineNumber": 4759
          },
          {
            "text": "                            }",
            "lineNumber": 4760
          },
          {
            "text": "                        }",
            "lineNumber": 4764
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3325955867767334
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nconst res = await \n { 'Content-Type': 'application/json' },\n                                  body: JSON.stringify(body)\n                              });\n                              const resData = await res.json();\n                              if (resData?.response) { \n                                  summary = resData.response;\n                              }\n                          } else if (aiConfig.provider === 'lmstudio') {\n                              let endpoint = aiConfig.lmstudio.endpoint.replace(/\\/+$/, '');\n                              if (!endpoint.endsWith('/v1')) endpoint += '/v1';\n                              const body = {\n                                  model: aiConfig.lmstudio.model,\n                                  messages: [{ role: \"user\", content: analysisPrompt }],\n                                  max_tokens: 1500,\n                                  temperature: 0.7,\n                                  stream: false\n                              };\n                              const res = await fetch(&#96;${endpoint}/chat/completions&#96;, {\n                                  method: 'POST',\n                                  headers: { 'Content-Type': 'application/json' },\n                                  body: JSON.stringify(body)\n                              });\n                              const resData = await res.json();\n                              if (resData?.choices?.[0]?.message?.content) { \n                                  summary = resData.choices[0].message.content;\n                              }\n                          }\n                          \n                          // If AI failed to generate analysis, fall back to a better summary that doesn't list individual images\n                          if (!summary) {\n                              const isChinese = state.settings.language === 'zh';\n                              summary = isChinese ? &#96;## 图片分析汇总\\n\\n&#96; : &#96;## Image Analysis Summary\\n\\n&#96;;\n                              \n                              // Extract all descriptions without numbering\n                              const allDescriptions = allResults\n                                  .map(r =&gt; r.description || '')\n\n;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3593
          },
          {
            "text": "const res = await ",
            "lineNumber": 4270
          },
          {
            "text": " { 'Content-Type': 'application/json' },",
            "lineNumber": 4272
          },
          {
            "text": "                                  body: JSON.stringify(body)",
            "lineNumber": 4273
          },
          {
            "text": "                              });",
            "lineNumber": 4274
          },
          {
            "text": "                              const resData = await res.json();",
            "lineNumber": 4275
          },
          {
            "text": "                              if (resData?.response) { ",
            "lineNumber": 4276
          },
          {
            "text": "                                  summary = resData.response;",
            "lineNumber": 4277
          },
          {
            "text": "                              }",
            "lineNumber": 4278
          },
          {
            "text": "                          } else if (aiConfig.provider === 'lmstudio') {",
            "lineNumber": 4279
          },
          {
            "text": "                              let endpoint = aiConfig.lmstudio.endpoint.replace(/\\/+$/, '');",
            "lineNumber": 4280
          },
          {
            "text": "                              if (!endpoint.endsWith('/v1')) endpoint += '/v1';",
            "lineNumber": 4281
          },
          {
            "text": "                              const body = {",
            "lineNumber": 4282
          },
          {
            "text": "                                  model: aiConfig.lmstudio.model,",
            "lineNumber": 4283
          },
          {
            "text": "                                  messages: [{ role: \"user\", content: analysisPrompt }],",
            "lineNumber": 4284
          },
          {
            "text": "                                  max_tokens: 1500,",
            "lineNumber": 4285
          },
          {
            "text": "                                  temperature: 0.7,",
            "lineNumber": 4286
          },
          {
            "text": "                                  stream: false",
            "lineNumber": 4287
          },
          {
            "text": "                              };",
            "lineNumber": 4288
          },
          {
            "text": "                              const res = await fetch(&#96;${endpoint}/chat/completions&#96;, {",
            "lineNumber": 4289
          },
          {
            "text": "                                  method: 'POST',",
            "lineNumber": 4290
          },
          {
            "text": "                                  headers: { 'Content-Type': 'application/json' },",
            "lineNumber": 4291
          },
          {
            "text": "                                  body: JSON.stringify(body)",
            "lineNumber": 4292
          },
          {
            "text": "                              });",
            "lineNumber": 4293
          },
          {
            "text": "                              const resData = await res.json();",
            "lineNumber": 4294
          },
          {
            "text": "                              if (resData?.choices?.[0]?.message?.content) { ",
            "lineNumber": 4295
          },
          {
            "text": "                                  summary = resData.choices[0].message.content;",
            "lineNumber": 4296
          },
          {
            "text": "                              }",
            "lineNumber": 4297
          },
          {
            "text": "                          }",
            "lineNumber": 4298
          },
          {
            "text": "                          ",
            "lineNumber": 4299
          },
          {
            "text": "                          // If AI failed to generate analysis, fall back to a better summary that doesn't list individual images",
            "lineNumber": 4300
          },
          {
            "text": "                          if (!summary) {",
            "lineNumber": 4301
          },
          {
            "text": "                              const isChinese = state.settings.language === 'zh';",
            "lineNumber": 4302
          },
          {
            "text": "                              summary = isChinese ? &#96;## 图片分析汇总\\n\\n&#96; : &#96;## Image Analysis Summary\\n\\n&#96;;",
            "lineNumber": 4303
          },
          {
            "text": "                              ",
            "lineNumber": 4304
          },
          {
            "text": "                              // Extract all descriptions without numbering",
            "lineNumber": 4305
          },
          {
            "text": "                              const allDescriptions = allResults",
            "lineNumber": 4306
          },
          {
            "text": "                                  .map(r =&gt; r.description || '')",
            "lineNumber": 4307
          },
          {
            "lineNumber": 4308
          },
          {
            "text": ";",
            "lineNumber": 4309
          },
          {
            "text": ";",
            "lineNumber": 4386
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.32965660095214844
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TabBar.tsx",
        "range": {
          "startPosition": {
            "line": 6
          },
          "endPosition": {
            "line": 229,
            "column": 1
          }
        },
        "contents": "interface TabBarProps {\n\n  onCloseWindow: () =&gt; void;\n  t: (key: string) =&gt; string;\n  showWindowControls?: boolean;\n}\n\nexport const TabBar: React.FC&lt;TabBarProps&gt; = ({\n  tabs,\n  activeTabId,\n  files,\n  onSwitchTab,\n  onCloseTab,\n  onNewTab,\n  onContextMenu,\n  onCloseWindow,\n  t,\n  showWindowControls = true\n}) =&gt; {\n  const tabBarRef = useRef&lt;HTMLDivElement&gt;(null);\n  const [showControls, setShowControls] = useState(false);\n  const [isMaximized, setIsMaximized] = useState(false);\n\n  useEffect(() =&gt; {\n    // Only show custom window controls on Linux for Tauri.\n    // Windows uses titleBarOverlay (native controls), macOS uses traffic lights.\n    if (isTauriEnvironment()) {\n      const platform = (window as any).__TAURI__?.os?.platform || 'linux';\n      if (platform === 'linux') {\n        setShowControls(true);\n      } else {\n        setShowControls(false);\n      }\n    } else {\n        // Not Tauri (web mode), usually don't show window controls as browser has its own.\n        setShowControls(false);\n    }\n  }, []);\n\n  useEffect(() =&gt; {\n    // Listen for window maximize state changes in Tauri\n    if (isTauriEnvironment()) {\n      const checkMaximizeState = async () =&gt; {\n        try {\n          const window = getCurrentWindow();\n          const isMaximizedState = await window.isMaximized();\n          setIsMaximized(isMaximizedState);\n        } catch (error) {\n          console.error('Failed to check maximize state:', error);\n        }\n      };\n\n      // Initial check\n      checkMaximizeState();\n\n      // Set up event listener for window resize to check maximize state\n      const handleResize = () =&gt; {\n        checkMaximizeState();\n      };\n\n      window.addEventListener('resize', handleResize);\n      return () =&gt; window.removeEventListener('resize', handleResize);\n    }\n  },\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "interface TabBarProps {",
            "lineNumber": 7,
            "isSignature": true
          },
          {
            "lineNumber": 14
          },
          {
            "text": "  onCloseWindow: () =&gt; void;",
            "lineNumber": 15
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 16
          },
          {
            "text": "  showWindowControls?: boolean;",
            "lineNumber": 17,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 18,
            "isSignature": true
          },
          {
            "lineNumber": 19
          },
          {
            "text": "export const TabBar: React.FC&lt;TabBarProps&gt; = ({",
            "lineNumber": 20
          },
          {
            "text": "  tabs,",
            "lineNumber": 21
          },
          {
            "text": "  activeTabId,",
            "lineNumber": 22
          },
          {
            "text": "  files,",
            "lineNumber": 23
          },
          {
            "text": "  onSwitchTab,",
            "lineNumber": 24
          },
          {
            "text": "  onCloseTab,",
            "lineNumber": 25
          },
          {
            "text": "  onNewTab,",
            "lineNumber": 26
          },
          {
            "text": "  onContextMenu,",
            "lineNumber": 27
          },
          {
            "text": "  onCloseWindow,",
            "lineNumber": 28
          },
          {
            "text": "  t,",
            "lineNumber": 29
          },
          {
            "text": "  showWindowControls = true",
            "lineNumber": 30
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 31
          },
          {
            "text": "  const tabBarRef = useRef&lt;HTMLDivElement&gt;(null);",
            "lineNumber": 32
          },
          {
            "text": "  const [showControls, setShowControls] = useState(false);",
            "lineNumber": 33
          },
          {
            "text": "  const [isMaximized, setIsMaximized] = useState(false);",
            "lineNumber": 34
          },
          {
            "lineNumber": 35
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 36
          },
          {
            "text": "    // Only show custom window controls on Linux for Tauri.",
            "lineNumber": 37
          },
          {
            "text": "    // Windows uses titleBarOverlay (native controls), macOS uses traffic lights.",
            "lineNumber": 38
          },
          {
            "text": "    if (isTauriEnvironment()) {",
            "lineNumber": 39
          },
          {
            "text": "      const platform = (window as any).__TAURI__?.os?.platform || 'linux';",
            "lineNumber": 40
          },
          {
            "text": "      if (platform === 'linux') {",
            "lineNumber": 41
          },
          {
            "text": "        setShowControls(true);",
            "lineNumber": 42
          },
          {
            "text": "      } else {",
            "lineNumber": 43
          },
          {
            "text": "        setShowControls(false);",
            "lineNumber": 44
          },
          {
            "text": "      }",
            "lineNumber": 45
          },
          {
            "text": "    } else {",
            "lineNumber": 46
          },
          {
            "text": "        // Not Tauri (web mode), usually don't show window controls as browser has its own.",
            "lineNumber": 47
          },
          {
            "text": "        setShowControls(false);",
            "lineNumber": 48
          },
          {
            "text": "    }",
            "lineNumber": 49
          },
          {
            "text": "  }, []);",
            "lineNumber": 50
          },
          {
            "lineNumber": 51
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 52
          },
          {
            "text": "    // Listen for window maximize state changes in Tauri",
            "lineNumber": 53
          },
          {
            "text": "    if (isTauriEnvironment()) {",
            "lineNumber": 54
          },
          {
            "text": "      const checkMaximizeState = async () =&gt; {",
            "lineNumber": 55
          },
          {
            "text": "        try {",
            "lineNumber": 56
          },
          {
            "text": "          const window = getCurrentWindow();",
            "lineNumber": 57
          },
          {
            "text": "          const isMaximizedState = await window.isMaximized();",
            "lineNumber": 58
          },
          {
            "text": "          setIsMaximized(isMaximizedState);",
            "lineNumber": 59
          },
          {
            "text": "        } catch (error) {",
            "lineNumber": 60
          },
          {
            "text": "          console.error('Failed to check maximize state:', error);",
            "lineNumber": 61
          },
          {
            "text": "        }",
            "lineNumber": 62
          },
          {
            "text": "      };",
            "lineNumber": 63
          },
          {
            "lineNumber": 64
          },
          {
            "text": "      // Initial check",
            "lineNumber": 65
          },
          {
            "text": "      checkMaximizeState();",
            "lineNumber": 66
          },
          {
            "lineNumber": 67
          },
          {
            "text": "      // Set up event listener for window resize to check maximize state",
            "lineNumber": 68
          },
          {
            "text": "      const handleResize = () =&gt; {",
            "lineNumber": 69
          },
          {
            "text": "        checkMaximizeState();",
            "lineNumber": 70
          },
          {
            "text": "      };",
            "lineNumber": 71
          },
          {
            "lineNumber": 72
          },
          {
            "text": "      window.addEventListener('resize', handleResize);",
            "lineNumber": 73
          },
          {
            "text": "      return () =&gt; window.removeEventListener('resize', handleResize);",
            "lineNumber": 74
          },
          {
            "text": "    }",
            "lineNumber": 75
          },
          {
            "text": "  },",
            "lineNumber": 76
          },
          {
            "text": ";",
            "lineNumber": 230
          }
        ]
      },
      "score": 0.3224591016769409
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleCreateFolder = async \n\n      if (!parent) return;\n      const baseName = t('context.newFolder');\n      let name = baseName;\n      if (parent.path) {\n          try {\n              let counter = 1;\n              const children = parent.children?.map(id =&gt; state.files[id]) || [];\n              while (children.some(c =&gt; c.name === name)) { name = &#96;${baseName} (${counter++})&#96;; }\n              const separator = parent.path.includes('/') ? '/' : '\\\\';\n              const newPath = &#96;${parent.path}${separator}${name}&#96;;\n              \n              // Use appropriate createFolder function based on environment\n              const isTauriEnv = isTauriEnvironment();\n              if (isTauriEnv) {\n                  await createFolder(newPath);\n              } else {\n                  throw new Error(\"No file system access available\");\n              }\n              \n              await handleRefresh();\n              \n              // Find the newly created folder and set it to renaming state\n              setState(prev =&gt; {\n                  const parentFolder = prev.files[parentId];\n                  if (parentFolder?.children) {\n                      // Get all children files\n                      const childFiles = parentFolder.children.map(id =&gt; prev.files[id]);\n                      // Find the folder with the matching name we just created\n                      const newFolder = childFiles.find(file =&gt; file?.name === name &amp;&amp; file?.type === FileType.FOLDER);\n                      if (newFolder) {\n                          return { ...prev, renamingId: newFolder.id };\n                      }\n                  }\n                  return prev;\n              });\n          } catch (error) { console.error(error); showToast(\"Error creating folder\"); }\n      } else {\n          let counter = 1;\n          const children = parent.children?.map(id =&gt; state.files[id]) || [];\n          while (children.some(c =&gt; c.name === name)) { name = &#96;${baseName} (${counter++})&#96;; }\n          const newId = Math.random().toString(36).substr(2, 9);\n          const newFolder: FileNode = {\n              id: newId,\n              parentId: parentId,\n              name,\n              type: FileType.FOLDER\n          };\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleCreateFolder = async ",
            "lineNumber": 3235
          },
          {
            "lineNumber": 3273
          },
          {
            "text": "      if (!parent) return;",
            "lineNumber": 3274
          },
          {
            "text": "      const baseName = t('context.newFolder');",
            "lineNumber": 3275
          },
          {
            "text": "      let name = baseName;",
            "lineNumber": 3276
          },
          {
            "text": "      if (parent.path) {",
            "lineNumber": 3277
          },
          {
            "text": "          try {",
            "lineNumber": 3278
          },
          {
            "text": "              let counter = 1;",
            "lineNumber": 3279
          },
          {
            "text": "              const children = parent.children?.map(id =&gt; state.files[id]) || [];",
            "lineNumber": 3280
          },
          {
            "text": "              while (children.some(c =&gt; c.name === name)) { name = &#96;${baseName} (${counter++})&#96;; }",
            "lineNumber": 3281
          },
          {
            "text": "              const separator = parent.path.includes('/') ? '/' : '\\\\';",
            "lineNumber": 3282
          },
          {
            "text": "              const newPath = &#96;${parent.path}${separator}${name}&#96;;",
            "lineNumber": 3283
          },
          {
            "text": "              ",
            "lineNumber": 3284
          },
          {
            "text": "              // Use appropriate createFolder function based on environment",
            "lineNumber": 3285
          },
          {
            "text": "              const isTauriEnv = isTauriEnvironment();",
            "lineNumber": 3286
          },
          {
            "text": "              if (isTauriEnv) {",
            "lineNumber": 3287
          },
          {
            "text": "                  await createFolder(newPath);",
            "lineNumber": 3288
          },
          {
            "text": "              } else {",
            "lineNumber": 3289
          },
          {
            "text": "                  throw new Error(\"No file system access available\");",
            "lineNumber": 3290
          },
          {
            "text": "              }",
            "lineNumber": 3291
          },
          {
            "text": "              ",
            "lineNumber": 3292
          },
          {
            "text": "              await handleRefresh();",
            "lineNumber": 3293
          },
          {
            "text": "              ",
            "lineNumber": 3294
          },
          {
            "text": "              // Find the newly created folder and set it to renaming state",
            "lineNumber": 3295
          },
          {
            "text": "              setState(prev =&gt; {",
            "lineNumber": 3296
          },
          {
            "text": "                  const parentFolder = prev.files[parentId];",
            "lineNumber": 3297
          },
          {
            "text": "                  if (parentFolder?.children) {",
            "lineNumber": 3298
          },
          {
            "text": "                      // Get all children files",
            "lineNumber": 3299
          },
          {
            "text": "                      const childFiles = parentFolder.children.map(id =&gt; prev.files[id]);",
            "lineNumber": 3300
          },
          {
            "text": "                      // Find the folder with the matching name we just created",
            "lineNumber": 3301
          },
          {
            "text": "                      const newFolder = childFiles.find(file =&gt; file?.name === name &amp;&amp; file?.type === FileType.FOLDER);",
            "lineNumber": 3302
          },
          {
            "text": "                      if (newFolder) {",
            "lineNumber": 3303
          },
          {
            "text": "                          return { ...prev, renamingId: newFolder.id };",
            "lineNumber": 3304
          },
          {
            "text": "                      }",
            "lineNumber": 3305
          },
          {
            "text": "                  }",
            "lineNumber": 3306
          },
          {
            "text": "                  return prev;",
            "lineNumber": 3307
          },
          {
            "text": "              });",
            "lineNumber": 3308
          },
          {
            "text": "          } catch (error) { console.error(error); showToast(\"Error creating folder\"); }",
            "lineNumber": 3309
          },
          {
            "text": "      } else {",
            "lineNumber": 3310
          },
          {
            "text": "          let counter = 1;",
            "lineNumber": 3311
          },
          {
            "text": "          const children = parent.children?.map(id =&gt; state.files[id]) || [];",
            "lineNumber": 3312
          },
          {
            "text": "          while (children.some(c =&gt; c.name === name)) { name = &#96;${baseName} (${counter++})&#96;; }",
            "lineNumber": 3313
          },
          {
            "text": "          const newId = Math.random().toString(36).substr(2, 9);",
            "lineNumber": 3314
          },
          {
            "text": "          const newFolder: FileNode = {",
            "lineNumber": 3315
          },
          {
            "text": "              id: newId,",
            "lineNumber": 3316
          },
          {
            "text": "              parentId: parentId,",
            "lineNumber": 3317
          },
          {
            "text": "              name,",
            "lineNumber": 3318
          },
          {
            "text": "              type: FileType.FOLDER",
            "lineNumber": 3319
          },
          {
            "text": "          };",
            "lineNumber": 3325
          },
          {
            "text": ";",
            "lineNumber": 3334
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3211821913719177
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst requestDelete = \n\n    setState(prev =&gt; {\n        const newFiles = { ...prev.files };\n        ids.forEach(id =&gt; {\n             const file = newFiles[id];\n             if (file &amp;&amp; file.parentId &amp;&amp; newFiles[file.parentId]) {\n                 const parent = newFiles[file.parentId];\n                 newFiles[file.parentId] = { ...parent, children: parent.children?.filter(cid =&gt; cid !== id) };\n             }\n             delete newFiles[id];\n        });\n        \n        const updatedTabs = prev.tabs.map(t =&gt; {\n            // 如果当前标签页正在查看被删除的文件，清除 viewingFileId\n            const isViewingDeletedFile = t.viewingFileId &amp;&amp; ids.includes(t.viewingFileId);\n            return {\n                ...t,\n                selectedFileIds: t.selectedFileIds.filter(fid =&gt; !ids.includes(fid)),\n                viewingFileId: isViewingDeletedFile ? null : t.viewingFileId\n            };\n        });\n        \n        return { ...prev, files: newFiles, tabs: updatedTabs };\n    });\n    setDeletionTasks(prev =&gt; [...prev, newTask]);\n  };\n\n  const undoDelete = (taskId: string) =&gt; {\n      const task = deletionTasks.find(t =&gt; t.id === taskId);\n      if (!task) return;\n      setState(prev =&gt; {\n          const newFiles = { ...prev.files };\n          task.files.forEach(file =&gt; {\n              newFiles[file.id] = file;\n              if (file.parentId &amp;&amp; newFiles[file.parentId]) {\n                  const parent = newFiles[file.parentId];\n                  if (!parent.children?.includes(file.id))\n          }\n      }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const requestDelete = ",
            "lineNumber": 3105
          },
          {
            "lineNumber": 3109
          },
          {
            "text": "    setState(prev =&gt; {",
            "lineNumber": 3110
          },
          {
            "text": "        const newFiles = { ...prev.files };",
            "lineNumber": 3111
          },
          {
            "text": "        ids.forEach(id =&gt; {",
            "lineNumber": 3112
          },
          {
            "text": "             const file = newFiles[id];",
            "lineNumber": 3113
          },
          {
            "text": "             if (file &amp;&amp; file.parentId &amp;&amp; newFiles[file.parentId]) {",
            "lineNumber": 3114
          },
          {
            "text": "                 const parent = newFiles[file.parentId];",
            "lineNumber": 3115
          },
          {
            "text": "                 newFiles[file.parentId] = { ...parent, children: parent.children?.filter(cid =&gt; cid !== id) };",
            "lineNumber": 3116
          },
          {
            "text": "             }",
            "lineNumber": 3117
          },
          {
            "text": "             delete newFiles[id];",
            "lineNumber": 3118
          },
          {
            "text": "        });",
            "lineNumber": 3119
          },
          {
            "text": "        ",
            "lineNumber": 3120
          },
          {
            "text": "        const updatedTabs = prev.tabs.map(t =&gt; {",
            "lineNumber": 3121
          },
          {
            "text": "            // 如果当前标签页正在查看被删除的文件，清除 viewingFileId",
            "lineNumber": 3122
          },
          {
            "text": "            const isViewingDeletedFile = t.viewingFileId &amp;&amp; ids.includes(t.viewingFileId);",
            "lineNumber": 3123
          },
          {
            "text": "            return {",
            "lineNumber": 3124
          },
          {
            "text": "                ...t,",
            "lineNumber": 3125
          },
          {
            "text": "                selectedFileIds: t.selectedFileIds.filter(fid =&gt; !ids.includes(fid)),",
            "lineNumber": 3126
          },
          {
            "text": "                viewingFileId: isViewingDeletedFile ? null : t.viewingFileId",
            "lineNumber": 3127
          },
          {
            "text": "            };",
            "lineNumber": 3128
          },
          {
            "text": "        });",
            "lineNumber": 3129
          },
          {
            "text": "        ",
            "lineNumber": 3130
          },
          {
            "text": "        return { ...prev, files: newFiles, tabs: updatedTabs };",
            "lineNumber": 3131
          },
          {
            "text": "    });",
            "lineNumber": 3132
          },
          {
            "text": "    setDeletionTasks(prev =&gt; [...prev, newTask]);",
            "lineNumber": 3133
          },
          {
            "text": "  };",
            "lineNumber": 3134
          },
          {
            "lineNumber": 3135
          },
          {
            "text": "  const undoDelete = (taskId: string) =&gt; {",
            "lineNumber": 3136
          },
          {
            "text": "      const task = deletionTasks.find(t =&gt; t.id === taskId);",
            "lineNumber": 3137
          },
          {
            "text": "      if (!task) return;",
            "lineNumber": 3138
          },
          {
            "text": "      setState(prev =&gt; {",
            "lineNumber": 3139
          },
          {
            "text": "          const newFiles = { ...prev.files };",
            "lineNumber": 3140
          },
          {
            "text": "          task.files.forEach(file =&gt; {",
            "lineNumber": 3141
          },
          {
            "text": "              newFiles[file.id] = file;",
            "lineNumber": 3142
          },
          {
            "text": "              if (file.parentId &amp;&amp; newFiles[file.parentId]) {",
            "lineNumber": 3143
          },
          {
            "text": "                  const parent = newFiles[file.parentId];",
            "lineNumber": 3144
          },
          {
            "text": "                  if (!parent.children?.includes(file.id))",
            "lineNumber": 3145
          },
          {
            "text": "          }",
            "lineNumber": 3149
          },
          {
            "text": "      }",
            "lineNumber": 3151
          },
          {
            "text": ";",
            "lineNumber": 3153
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3200879991054535
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1329
          },
          "endPosition": {
            "line": 1488,
            "column": 1
          }
        },
        "contents": "const useLayout = \nconst aspectRatios = () =&gt; {\n\n    if (viewMode === 'browser') {\n      items.forEach(id =&gt; {\n        const file = files[id];\n        ratios[id] = file?.meta?.width &amp;&amp; file?.meta?.height \n          ? file.meta.width / file.meta.height \n          : (file?.type === FileType.FOLDER ? 1 : 1);\n      });\n    }\n    return ratios;\n  }, [items, files, viewMode]);\n\n  return useMemo(() =&gt; {\n    const layout: LayoutItem[] = [];\n    let totalHeight = 0;\n    const GAP = 16;\n    const PADDING = 24;\n    \n    // Ensure we have a reasonable width. If containerWidth is 0 (initial render), fall back to window width.\n    const safeContainerWidth = containerWidth &gt; 0 ? containerWidth : (typeof window !== 'undefined' ? window.innerWidth : 1280); \n    const availableWidth = Math.max(100, safeContainerWidth - (PADDING * 2));\n    // Ensure availableWidth is not too small, preventing unnecessary scrollbars\n    const minAvailableWidth = 1280 - (PADDING * 2);\n    const finalAvailableWidth = Math.max(availableWidth, minAvailableWidth);\n\n    if (viewMode === 'browser') {\n        if (layoutMode === 'list') {\n            const itemHeight = 44;\n            items.forEach((id, index) =&gt; {\n                layout.push({ id, x: PADDING, y: PADDING + index * itemHeight, width: finalAvailableWidth, height: itemHeight });\n            });\n            totalHeight = PADDING + items.length * itemHeight;\n        } else if (layoutMode === 'grid') {\n            const minColWidth = thumbnailSize;\n            const cols = Math.max(1, Math.floor((finalAvailableWidth + GAP) / (minColWidth + GAP)));\n            const itemWidth = (finalAvailableWidth - (cols - 1) * GAP) / cols;\n            const itemHeight = itemWidth + 40;\n\n            items.forEach((id, index) =&gt; {\n                const row = Math.floor(index / cols);\n                const col = index % cols;\n                layout.push({\n                    id,\n                    x: PADDING + col * (itemWidth + GAP),\n                    y: PADDING + row * (itemHeight + GAP),\n                    width: itemWidth,\n                    height: itemHeight\n\n            }\n  }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const useLayout = ",
            "lineNumber": 1330
          },
          {
            "text": "const aspectRatios = () =&gt; {",
            "lineNumber": 1340
          },
          {
            "lineNumber": 1341
          },
          {
            "text": "    if (viewMode === 'browser') {",
            "lineNumber": 1342
          },
          {
            "text": "      items.forEach(id =&gt; {",
            "lineNumber": 1343
          },
          {
            "text": "        const file = files[id];",
            "lineNumber": 1344
          },
          {
            "text": "        ratios[id] = file?.meta?.width &amp;&amp; file?.meta?.height ",
            "lineNumber": 1345
          },
          {
            "text": "          ? file.meta.width / file.meta.height ",
            "lineNumber": 1346
          },
          {
            "text": "          : (file?.type === FileType.FOLDER ? 1 : 1);",
            "lineNumber": 1347
          },
          {
            "text": "      });",
            "lineNumber": 1348
          },
          {
            "text": "    }",
            "lineNumber": 1349
          },
          {
            "text": "    return ratios;",
            "lineNumber": 1350
          },
          {
            "text": "  }, [items, files, viewMode]);",
            "lineNumber": 1351
          },
          {
            "lineNumber": 1352
          },
          {
            "text": "  return useMemo(() =&gt; {",
            "lineNumber": 1353
          },
          {
            "text": "    const layout: LayoutItem[] = [];",
            "lineNumber": 1354
          },
          {
            "text": "    let totalHeight = 0;",
            "lineNumber": 1355
          },
          {
            "text": "    const GAP = 16;",
            "lineNumber": 1356
          },
          {
            "text": "    const PADDING = 24;",
            "lineNumber": 1357
          },
          {
            "text": "    ",
            "lineNumber": 1358
          },
          {
            "text": "    // Ensure we have a reasonable width. If containerWidth is 0 (initial render), fall back to window width.",
            "lineNumber": 1359
          },
          {
            "text": "    const safeContainerWidth = containerWidth &gt; 0 ? containerWidth : (typeof window !== 'undefined' ? window.innerWidth : 1280); ",
            "lineNumber": 1360
          },
          {
            "text": "    const availableWidth = Math.max(100, safeContainerWidth - (PADDING * 2));",
            "lineNumber": 1361
          },
          {
            "text": "    // Ensure availableWidth is not too small, preventing unnecessary scrollbars",
            "lineNumber": 1362
          },
          {
            "text": "    const minAvailableWidth = 1280 - (PADDING * 2);",
            "lineNumber": 1363
          },
          {
            "text": "    const finalAvailableWidth = Math.max(availableWidth, minAvailableWidth);",
            "lineNumber": 1364
          },
          {
            "lineNumber": 1365
          },
          {
            "text": "    if (viewMode === 'browser') {",
            "lineNumber": 1366
          },
          {
            "text": "        if (layoutMode === 'list') {",
            "lineNumber": 1367
          },
          {
            "text": "            const itemHeight = 44;",
            "lineNumber": 1368
          },
          {
            "text": "            items.forEach((id, index) =&gt; {",
            "lineNumber": 1369
          },
          {
            "text": "                layout.push({ id, x: PADDING, y: PADDING + index * itemHeight, width: finalAvailableWidth, height: itemHeight });",
            "lineNumber": 1370
          },
          {
            "text": "            });",
            "lineNumber": 1371
          },
          {
            "text": "            totalHeight = PADDING + items.length * itemHeight;",
            "lineNumber": 1372
          },
          {
            "text": "        } else if (layoutMode === 'grid') {",
            "lineNumber": 1373
          },
          {
            "text": "            const minColWidth = thumbnailSize;",
            "lineNumber": 1374
          },
          {
            "text": "            const cols = Math.max(1, Math.floor((finalAvailableWidth + GAP) / (minColWidth + GAP)));",
            "lineNumber": 1375
          },
          {
            "text": "            const itemWidth = (finalAvailableWidth - (cols - 1) * GAP) / cols;",
            "lineNumber": 1376
          },
          {
            "text": "            const itemHeight = itemWidth + 40;",
            "lineNumber": 1377
          },
          {
            "lineNumber": 1378
          },
          {
            "text": "            items.forEach((id, index) =&gt; {",
            "lineNumber": 1379
          },
          {
            "text": "                const row = Math.floor(index / cols);",
            "lineNumber": 1380
          },
          {
            "text": "                const col = index % cols;",
            "lineNumber": 1381
          },
          {
            "text": "                layout.push({",
            "lineNumber": 1382
          },
          {
            "text": "                    id,",
            "lineNumber": 1383
          },
          {
            "text": "                    x: PADDING + col * (itemWidth + GAP),",
            "lineNumber": 1384
          },
          {
            "text": "                    y: PADDING + row * (itemHeight + GAP),",
            "lineNumber": 1385
          },
          {
            "text": "                    width: itemWidth,",
            "lineNumber": 1386
          },
          {
            "text": "                    height: itemHeight",
            "lineNumber": 1387
          },
          {
            "lineNumber": 1388
          },
          {
            "text": "            }",
            "lineNumber": 1389
          },
          {
            "text": "  }",
            "lineNumber": 1488
          },
          {
            "text": ";",
            "lineNumber": 1489
          }
        ]
      },
      "score": 0.3051914870738983
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \n : &#96;## Image Analysis Summary\\n\\n&#96;;\n                              \n                              // Extract all descriptions without numbering\n                              const allDescriptions = allResults\n                                  .map(r =&gt; r.description || '')\n                                  .filter(Boolean)\n                                  .join(' ');\n                              \n                              // Extract all texts\n                              const allTexts: string[] = [];\n                              allResults.forEach(r =&gt; {\n                                  if (r.translatedText) allTexts.push(r.translatedText);\n                                  else if (r.extractedText) allTexts.push(r.extractedText);\n                              });\n                              \n                              // Create a coherent fallback summary\n                              if\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3593
          },
          {
            "text": " : &#96;## Image Analysis Summary\\n\\n&#96;;",
            "lineNumber": 4303
          },
          {
            "text": "                              ",
            "lineNumber": 4304
          },
          {
            "text": "                              // Extract all descriptions without numbering",
            "lineNumber": 4305
          },
          {
            "text": "                              const allDescriptions = allResults",
            "lineNumber": 4306
          },
          {
            "text": "                                  .map(r =&gt; r.description || '')",
            "lineNumber": 4307
          },
          {
            "text": "                                  .filter(Boolean)",
            "lineNumber": 4308
          },
          {
            "text": "                                  .join(' ');",
            "lineNumber": 4309
          },
          {
            "text": "                              ",
            "lineNumber": 4310
          },
          {
            "text": "                              // Extract all texts",
            "lineNumber": 4311
          },
          {
            "text": "                              const allTexts: string[] = [];",
            "lineNumber": 4312
          },
          {
            "text": "                              allResults.forEach(r =&gt; {",
            "lineNumber": 4313
          },
          {
            "text": "                                  if (r.translatedText) allTexts.push(r.translatedText);",
            "lineNumber": 4314
          },
          {
            "text": "                                  else if (r.extractedText) allTexts.push(r.extractedText);",
            "lineNumber": 4315
          },
          {
            "text": "                              });",
            "lineNumber": 4316
          },
          {
            "text": "                              ",
            "lineNumber": 4317
          },
          {
            "text": "                              // Create a coherent fallback summary",
            "lineNumber": 4318
          },
          {
            "text": "                              if",
            "lineNumber": 4319
          },
          {
            "text": ";",
            "lineNumber": 4386
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3042308986186981
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleUpdatePerson = \nprev =&gt; (\n\n          people: {\n              ...prev.people,\n              [personId]: { ...prev.people[personId], ...updates }\n          }\n      }));\n  };\n\n  const handleCreatePerson = () =&gt; {\n      const newId = Math.random().toString(36).substr(2, 9);\n      const newPerson: Person = {\n          id: newId,\n          name: t('context.newPersonDefault'),\n          coverFileId: '',\n          count: 0,\n          description: ''\n      };\n      setState(prev =&gt; ({\n          ...prev,\n          people: { ...prev.people, [newId]: newPerson },\n          activeModal: { type: 'rename-person', data: { personId: newId } }\n      }));\n  };\n\n  const handleDeletePerson = (personId: string | string[]) =&gt; {\n      setState(prev =&gt; {\n          const newPeople = { ...prev.people };\n          \n          // Handle both single person and multiple people deletion\n          const idsToDelete = typeof personId === 'string' ? [personId] : personId;\n          idsToDelete.forEach(id =&gt; {\n              delete newPeople[id];\n          });\n          \n          return { ...prev, people: newPeople, activeModal: { type: null } };\n      });\n  };\n\n  const handleManualAddPerson = (personId: string) =&gt; {\n      const fileIds = activeTab.selectedFileIds;\n      if (fileIds.length === 0) {\n          setState(s =&gt; ({ ...s, activeModal: { type: null } }));\n          return;\n      }\n      setState(prev =&gt; {\n          const newFiles = { ...prev.files };\n          const newPeople = { ...prev.people };\n          const person = newPeople[personId];\n          if (!person) return prev;\n      }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleUpdatePerson = ",
            "lineNumber": 2418
          },
          {
            "text": "prev =&gt; (",
            "lineNumber": 2419
          },
          {
            "lineNumber": 2420
          },
          {
            "text": "          people: {",
            "lineNumber": 2421
          },
          {
            "text": "              ...prev.people,",
            "lineNumber": 2422
          },
          {
            "text": "              [personId]: { ...prev.people[personId], ...updates }",
            "lineNumber": 2423
          },
          {
            "text": "          }",
            "lineNumber": 2424
          },
          {
            "text": "      }));",
            "lineNumber": 2425
          },
          {
            "text": "  };",
            "lineNumber": 2426
          },
          {
            "lineNumber": 2427
          },
          {
            "text": "  const handleCreatePerson = () =&gt; {",
            "lineNumber": 2428
          },
          {
            "text": "      const newId = Math.random().toString(36).substr(2, 9);",
            "lineNumber": 2429
          },
          {
            "text": "      const newPerson: Person = {",
            "lineNumber": 2430
          },
          {
            "text": "          id: newId,",
            "lineNumber": 2431
          },
          {
            "text": "          name: t('context.newPersonDefault'),",
            "lineNumber": 2432
          },
          {
            "text": "          coverFileId: '',",
            "lineNumber": 2433
          },
          {
            "text": "          count: 0,",
            "lineNumber": 2434
          },
          {
            "text": "          description: ''",
            "lineNumber": 2435
          },
          {
            "text": "      };",
            "lineNumber": 2436
          },
          {
            "text": "      setState(prev =&gt; ({",
            "lineNumber": 2437
          },
          {
            "text": "          ...prev,",
            "lineNumber": 2438
          },
          {
            "text": "          people: { ...prev.people, [newId]: newPerson },",
            "lineNumber": 2439
          },
          {
            "text": "          activeModal: { type: 'rename-person', data: { personId: newId } }",
            "lineNumber": 2440
          },
          {
            "text": "      }));",
            "lineNumber": 2441
          },
          {
            "text": "  };",
            "lineNumber": 2442
          },
          {
            "lineNumber": 2443
          },
          {
            "text": "  const handleDeletePerson = (personId: string | string[]) =&gt; {",
            "lineNumber": 2444
          },
          {
            "text": "      setState(prev =&gt; {",
            "lineNumber": 2445
          },
          {
            "text": "          const newPeople = { ...prev.people };",
            "lineNumber": 2446
          },
          {
            "text": "          ",
            "lineNumber": 2447
          },
          {
            "text": "          // Handle both single person and multiple people deletion",
            "lineNumber": 2448
          },
          {
            "text": "          const idsToDelete = typeof personId === 'string' ? [personId] : personId;",
            "lineNumber": 2449
          },
          {
            "text": "          idsToDelete.forEach(id =&gt; {",
            "lineNumber": 2450
          },
          {
            "text": "              delete newPeople[id];",
            "lineNumber": 2451
          },
          {
            "text": "          });",
            "lineNumber": 2452
          },
          {
            "text": "          ",
            "lineNumber": 2453
          },
          {
            "text": "          return { ...prev, people: newPeople, activeModal: { type: null } };",
            "lineNumber": 2454
          },
          {
            "text": "      });",
            "lineNumber": 2455
          },
          {
            "text": "  };",
            "lineNumber": 2456
          },
          {
            "lineNumber": 2457
          },
          {
            "text": "  const handleManualAddPerson = (personId: string) =&gt; {",
            "lineNumber": 2458
          },
          {
            "text": "      const fileIds = activeTab.selectedFileIds;",
            "lineNumber": 2459
          },
          {
            "text": "      if (fileIds.length === 0) {",
            "lineNumber": 2460
          },
          {
            "text": "          setState(s =&gt; ({ ...s, activeModal: { type: null } }));",
            "lineNumber": 2461
          },
          {
            "text": "          return;",
            "lineNumber": 2462
          },
          {
            "text": "      }",
            "lineNumber": 2463
          },
          {
            "text": "      setState(prev =&gt; {",
            "lineNumber": 2464
          },
          {
            "text": "          const newFiles = { ...prev.files };",
            "lineNumber": 2465
          },
          {
            "text": "          const newPeople = { ...prev.people };",
            "lineNumber": 2466
          },
          {
            "text": "          const person = newPeople[personId];",
            "lineNumber": 2467
          },
          {
            "text": "          if (!person) return prev;",
            "lineNumber": 2468
          },
          {
            "text": "      }",
            "lineNumber": 2514
          },
          {
            "text": ";",
            "lineNumber": 2516
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3027496039867401
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TabBar.tsx",
        "range": {
          "startPosition": {
            "column": 59
          },
          "endPosition": {
            "line": 17,
            "column": 1
          }
        },
        "contents": "import { TabState } from '../types';\nimport { X, Plus, Tag, Image as ImageIcon, Filter, Folder, Book, Film, Minus, Square, Minimize2 } from 'lucide-react';\nimport { isTauriEnvironment } from '../utils/environment';\nimport { getCurrentWindow } from '@tauri-apps/api/window';\n\ninterface TabBarProps {\n  tabs: TabState[];\n  activeTabId: string;\n  files: Record&lt;string, any&gt;;\n  onSwitchTab: (id: string) =&gt; void;\n  onCloseTab: (e: React.MouseEvent, id: string) =&gt; void;\n  onNewTab: () =&gt; void;\n  onContextMenu: (e: React.MouseEvent, id: string) =&gt; void;\n  onCloseWindow: () =&gt; void;\n  t: (key: string) =&gt; string;\n  showWindowControls?: boolean;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import { TabState } from '../types';",
            "lineNumber": 2
          },
          {
            "text": "import { X, Plus, Tag, Image as ImageIcon, Filter, Folder, Book, Film, Minus, Square, Minimize2 } from 'lucide-react';",
            "lineNumber": 3
          },
          {
            "text": "import { isTauriEnvironment } from '../utils/environment';",
            "lineNumber": 4
          },
          {
            "text": "import { getCurrentWindow } from '@tauri-apps/api/window';",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "interface TabBarProps {",
            "lineNumber": 7,
            "isSignature": true
          },
          {
            "text": "  tabs: TabState[];",
            "lineNumber": 8
          },
          {
            "text": "  activeTabId: string;",
            "lineNumber": 9
          },
          {
            "text": "  files: Record&lt;string, any&gt;;",
            "lineNumber": 10
          },
          {
            "text": "  onSwitchTab: (id: string) =&gt; void;",
            "lineNumber": 11
          },
          {
            "text": "  onCloseTab: (e: React.MouseEvent, id: string) =&gt; void;",
            "lineNumber": 12
          },
          {
            "text": "  onNewTab: () =&gt; void;",
            "lineNumber": 13
          },
          {
            "text": "  onContextMenu: (e: React.MouseEvent, id: string) =&gt; void;",
            "lineNumber": 14
          },
          {
            "text": "  onCloseWindow: () =&gt; void;",
            "lineNumber": 15
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 16
          },
          {
            "text": "  showWindowControls?: boolean;",
            "lineNumber": 17,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 18,
            "isSignature": true
          }
        ]
      },
      "score": 0.3023563623428345
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1490
          },
          "endPosition": {
            "line": 2018,
            "column": 1
          }
        },
        "contents": "interface FileGridProps {\n\n  selectionBox?: { startX: number; startY: number; currentX: number; currentY: number } | null;\n  t: (key: string) =&gt; string;\n  onThumbnailSizeChange?: (size: number) =&gt; void;\n  onUpdateFile?: (id: string, updates: Partial&lt;FileNode&gt;) =&gt; void;\n  settings?: import('../types').AppSettings;\n  onDragEnd?: (e: React.DragEvent) =&gt; void;\n  resourceRoot?: string;\n  cachePath?: string;\n  onScrollTopChange?: (scrollTop: number) =&gt; void;\n}\n\nexport const FileGrid: React.FC&lt;FileGridProps&gt; = ({\n  displayFileIds,\n  files,\n  activeTab,\n  renamingId,\n  thumbnailSize,\n  resourceRoot,\n  cachePath,\n  hoverPlayingId,\n  onSetHoverPlayingId,\n  onFileClick,\n  onFileDoubleClick,\n  onContextMenu,\n  onRenameSubmit,\n  onRenameCancel,\n  onStartRename,\n  onDragStart,\n  onDragEnd,\n  onDropOnFolder,\n  onDropExternal,\n  containerRef,\n  onMouseDown,\n  onMouseMove,\n  onMouseUp,\n  onBackgroundContextMenu,\n  people,\n  groupedTags,\n  onPersonClick,\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "interface FileGridProps {",
            "lineNumber": 1491,
            "isSignature": true
          },
          {
            "lineNumber": 1526
          },
          {
            "text": "  selectionBox?: { startX: number; startY: number; currentX: number; currentY: number } | null;",
            "lineNumber": 1527
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 1528
          },
          {
            "text": "  onThumbnailSizeChange?: (size: number) =&gt; void;",
            "lineNumber": 1529
          },
          {
            "text": "  onUpdateFile?: (id: string, updates: Partial&lt;FileNode&gt;) =&gt; void;",
            "lineNumber": 1530
          },
          {
            "text": "  settings?: import('../types').AppSettings;",
            "lineNumber": 1531
          },
          {
            "text": "  onDragEnd?: (e: React.DragEvent) =&gt; void;",
            "lineNumber": 1532
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 1533
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 1534
          },
          {
            "text": "  onScrollTopChange?: (scrollTop: number) =&gt; void;",
            "lineNumber": 1535,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 1536,
            "isSignature": true
          },
          {
            "lineNumber": 1537
          },
          {
            "text": "export const FileGrid: React.FC&lt;FileGridProps&gt; = ({",
            "lineNumber": 1538
          },
          {
            "text": "  displayFileIds,",
            "lineNumber": 1539
          },
          {
            "text": "  files,",
            "lineNumber": 1540
          },
          {
            "text": "  activeTab,",
            "lineNumber": 1541
          },
          {
            "text": "  renamingId,",
            "lineNumber": 1542
          },
          {
            "text": "  thumbnailSize,",
            "lineNumber": 1543
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 1544
          },
          {
            "text": "  cachePath,",
            "lineNumber": 1545
          },
          {
            "text": "  hoverPlayingId,",
            "lineNumber": 1546
          },
          {
            "text": "  onSetHoverPlayingId,",
            "lineNumber": 1547
          },
          {
            "text": "  onFileClick,",
            "lineNumber": 1548
          },
          {
            "text": "  onFileDoubleClick,",
            "lineNumber": 1549
          },
          {
            "text": "  onContextMenu,",
            "lineNumber": 1550
          },
          {
            "text": "  onRenameSubmit,",
            "lineNumber": 1551
          },
          {
            "text": "  onRenameCancel,",
            "lineNumber": 1552
          },
          {
            "text": "  onStartRename,",
            "lineNumber": 1553
          },
          {
            "text": "  onDragStart,",
            "lineNumber": 1554
          },
          {
            "text": "  onDragEnd,",
            "lineNumber": 1555
          },
          {
            "text": "  onDropOnFolder,",
            "lineNumber": 1556
          },
          {
            "text": "  onDropExternal,",
            "lineNumber": 1557
          },
          {
            "text": "  containerRef,",
            "lineNumber": 1558
          },
          {
            "text": "  onMouseDown,",
            "lineNumber": 1559
          },
          {
            "text": "  onMouseMove,",
            "lineNumber": 1560
          },
          {
            "text": "  onMouseUp,",
            "lineNumber": 1561
          },
          {
            "text": "  onBackgroundContextMenu,",
            "lineNumber": 1562
          },
          {
            "text": "  people,",
            "lineNumber": 1563
          },
          {
            "text": "  groupedTags,",
            "lineNumber": 1564
          },
          {
            "text": "  onPersonClick,",
            "lineNumber": 1565
          },
          {
            "text": ";",
            "lineNumber": 2019
          }
        ]
      },
      "score": 0.29934704303741455
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \n\n          if (folderId) {\n              updateTask(taskId, { current: totalSteps, currentStep: t('tasks.summarizing') });\n              const folder = state.files[folderId];\n              if (folder) {\n                  // Prepare all content (descriptions, extracted text, translated text) into a single text block\n                  const allContent = allResults\n                      .map((result, index) =&gt; {\n                          let content = &#96;Image ${index + 1}: ${result.description || 'No description'}&#96;;\n                          if (result.extractedText) {\n                              content += &#96;\\nExtracted Text: ${result.extractedText}&#96;;\n                          }\n                          if (result.translatedText) {\n                              content += &#96;\\nTranslated Text: ${result.translatedText}&#96;;\n                          }\n                          return content;\n                      })\n                      .join('\\n\\n');\n                  \n                  if (allContent) {\n                      const aiConfig = state.settings.ai;\n                      let summary = '';\n                      \n                      // Determine output language based on software settings\n                      const isChinese = state.settings.language === 'zh';\n                      const outputLanguage = isChinese ? '中文' : 'English';\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3593
          },
          {
            "lineNumber": 4212
          },
          {
            "text": "          if (folderId) {",
            "lineNumber": 4213
          },
          {
            "text": "              updateTask(taskId, { current: totalSteps, currentStep: t('tasks.summarizing') });",
            "lineNumber": 4214
          },
          {
            "text": "              const folder = state.files[folderId];",
            "lineNumber": 4215
          },
          {
            "text": "              if (folder) {",
            "lineNumber": 4216
          },
          {
            "text": "                  // Prepare all content (descriptions, extracted text, translated text) into a single text block",
            "lineNumber": 4217
          },
          {
            "text": "                  const allContent = allResults",
            "lineNumber": 4218
          },
          {
            "text": "                      .map((result, index) =&gt; {",
            "lineNumber": 4219
          },
          {
            "text": "                          let content = &#96;Image ${index + 1}: ${result.description || 'No description'}&#96;;",
            "lineNumber": 4220
          },
          {
            "text": "                          if (result.extractedText) {",
            "lineNumber": 4221
          },
          {
            "text": "                              content += &#96;\\nExtracted Text: ${result.extractedText}&#96;;",
            "lineNumber": 4222
          },
          {
            "text": "                          }",
            "lineNumber": 4223
          },
          {
            "text": "                          if (result.translatedText) {",
            "lineNumber": 4224
          },
          {
            "text": "                              content += &#96;\\nTranslated Text: ${result.translatedText}&#96;;",
            "lineNumber": 4225
          },
          {
            "text": "                          }",
            "lineNumber": 4226
          },
          {
            "text": "                          return content;",
            "lineNumber": 4227
          },
          {
            "text": "                      })",
            "lineNumber": 4228
          },
          {
            "text": "                      .join('\\n\\n');",
            "lineNumber": 4229
          },
          {
            "text": "                  ",
            "lineNumber": 4230
          },
          {
            "text": "                  if (allContent) {",
            "lineNumber": 4231
          },
          {
            "text": "                      const aiConfig = state.settings.ai;",
            "lineNumber": 4232
          },
          {
            "text": "                      let summary = '';",
            "lineNumber": 4233
          },
          {
            "text": "                      ",
            "lineNumber": 4234
          },
          {
            "text": "                      // Determine output language based on software settings",
            "lineNumber": 4235
          },
          {
            "text": "                      const isChinese = state.settings.language === 'zh';",
            "lineNumber": 4236
          },
          {
            "text": "                      const outputLanguage = isChinese ? '中文' : 'English';",
            "lineNumber": 4237
          },
          {
            "text": ";",
            "lineNumber": 4386
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.2972714900970459
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \n\n                      const isChinese = state.settings.language === 'zh';\n                      const outputLanguage = isChinese ? '中文' : 'English';\n                      \n                      // Create prompt for AI to understand and provide detailed summary of the folder content\n                      const analysisPrompt = isChinese ? \n                      &#96;请根据以下所有图片的描述、提取到的文字和翻译后的文字，详细分析这个文件夹内的图片内容以及这些文字说了个什么事情？\\n\\n${allContent}\\n\\n请严格遵守以下要求：\\n1. ❌绝对禁止直接罗列单张图片的描述信息，例如\"图片1：...图片2：...\"这样的格式\\n2. ✅必须将所有图片的描述信息结合成一个整体进行分析，形成连贯的整体描述\\n3. ✅详细说明这些图片和文字所描述的整体事件、主题或故事\\n4. ✅如果你发现有提取到的文字，请优先使用翻译后的文字（如果有），否则使用提取到的文字，提炼重要内容并对此进行讲解\\n5. ✅请用清晰、有条理的语言进行分析和总结，不要过于简洁\\n6. ✅你的回答应该像是对整个文件夹内容的总体概括，而不是对每张图片的单独描述&#96; :\n                      &#96;Based on all the image descriptions, extracted text, and translated text below, please analyze in detail what these images are about and what story or information the text conveys.\\n\\n${allContent}\\n\\nPlease strictly follow these requirements:\\n1. ❌ ABSOLUTELY DO NOT directly list individual image descriptions, such as \"Image 1: ... Image 2: ...\" format\\n2. ✅ Must combine all image descriptions into a single coherent analysis, forming a continuous overall description\\n3. ✅ Provide a detailed explanation of the overall events, themes, or stories described in these images and text\\n4. ✅ If you find any extracted text, please prioritize using translated text (if available), otherwise use the extracted text, extract important content and explain it\\n5. ✅ Use clear, structured language for analysis and summary, avoid being too concise\\n6. ✅ Your answer should be an overall summary of the entire folder content, not a separate description of each image&#96;;\n                      \n                      try {\n                          let result: any = null;\n                          \n                          if (aiConfig.provider === 'openai') {\n                              const body = {\n                                  model: aiConfig.openai.model,\n                                  messages: [{ role: \"user\", content: analysisPrompt }],\n                                  max_tokens: 1500,\n                                  temperature: 0.7\n                              };\n                              const res = await fetch(&#96;${aiConfig.openai.endpoint}/chat/completions&#96;, {\n                                  method: 'POST',\n                                  headers: { 'Content-Type': 'application/json', 'Authorization': &#96;Bearer ${aiConfig.openai.apiKey}&#96; },\n                                  body: JSON.stringify(body)\n                              });\n                              const resData = await res.json();\n                              if (resData?.choices?.[0]?.message?.content) { \n                                  summary = resData.choices[0].message.content;\n                              }\n                          }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 4216,
                "column": 15
              },
              "endPosition": {
                "line": 4216,
                "column": 15
              }
            },
            {
              "startPosition": {
                "line": 4216,
                "column": 16
              },
              "endPosition": {
                "line": 4217,
                "column": 19
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3593
          },
          {
            "lineNumber": 4235
          },
          {
            "text": "                      const isChinese = state.settings.language === 'zh';",
            "lineNumber": 4236
          },
          {
            "text": "                      const outputLanguage = isChinese ? '中文' : 'English';",
            "lineNumber": 4237
          },
          {
            "text": "                      ",
            "lineNumber": 4238
          },
          {
            "text": "                      // Create prompt for AI to understand and provide detailed summary of the folder content",
            "lineNumber": 4239
          },
          {
            "text": "                      const analysisPrompt = isChinese ? ",
            "lineNumber": 4240
          },
          {
            "text": "                      &#96;请根据以下所有图片的描述、提取到的文字和翻译后的文字，详细分析这个文件夹内的图片内容以及这些文字说了个什么事情？\\n\\n${allContent}\\n\\n请严格遵守以下要求：\\n1. ❌绝对禁止直接罗列单张图片的描述信息，例如\"图片1：...图片2：...\"这样的格式\\n2. ✅必须将所有图片的描述信息结合成一个整体进行分析，形成连贯的整体描述\\n3. ✅详细说明这些图片和文字所描述的整体事件、主题或故事\\n4. ✅如果你发现有提取到的文字，请优先使用翻译后的文字（如果有），否则使用提取到的文字，提炼重要内容并对此进行讲解\\n5. ✅请用清晰、有条理的语言进行分析和总结，不要过于简洁\\n6. ✅你的回答应该像是对整个文件夹内容的总体概括，而不是对每张图片的单独描述&#96; :",
            "lineNumber": 4241
          },
          {
            "text": "                      &#96;Based on all the image descriptions, extracted text, and translated text below, please analyze in detail what these images are about and what story or information the text conveys.\\n\\n${allContent}\\n\\nPlease strictly follow these requirements:\\n1. ❌ ABSOLUTELY DO NOT directly list individual image descriptions, such as \"Image 1: ... Image 2: ...\" format\\n2. ✅ Must combine all image descriptions into a single coherent analysis, forming a continuous overall description\\n3. ✅ Provide a detailed explanation of the overall events, themes, or stories described in these images and text\\n4. ✅ If you find any extracted text, please prioritize using translated text (if available), otherwise use the extracted text, extract important content and explain it\\n5. ✅ Use clear, structured language for analysis and summary, avoid being too concise\\n6. ✅ Your answer should be an overall summary of the entire folder content, not a separate description of each image&#96;;",
            "lineNumber": 4242
          },
          {
            "text": "                      ",
            "lineNumber": 4243
          },
          {
            "text": "                      try {",
            "lineNumber": 4244
          },
          {
            "text": "                          let result: any = null;",
            "lineNumber": 4245
          },
          {
            "text": "                          ",
            "lineNumber": 4246
          },
          {
            "text": "                          if (aiConfig.provider === 'openai') {",
            "lineNumber": 4247
          },
          {
            "text": "                              const body = {",
            "lineNumber": 4248
          },
          {
            "text": "                                  model: aiConfig.openai.model,",
            "lineNumber": 4249
          },
          {
            "text": "                                  messages: [{ role: \"user\", content: analysisPrompt }],",
            "lineNumber": 4250
          },
          {
            "text": "                                  max_tokens: 1500,",
            "lineNumber": 4251
          },
          {
            "text": "                                  temperature: 0.7",
            "lineNumber": 4252
          },
          {
            "text": "                              };",
            "lineNumber": 4253
          },
          {
            "text": "                              const res = await fetch(&#96;${aiConfig.openai.endpoint}/chat/completions&#96;, {",
            "lineNumber": 4254
          },
          {
            "text": "                                  method: 'POST',",
            "lineNumber": 4255
          },
          {
            "text": "                                  headers: { 'Content-Type': 'application/json', 'Authorization': &#96;Bearer ${aiConfig.openai.apiKey}&#96; },",
            "lineNumber": 4256
          },
          {
            "text": "                                  body: JSON.stringify(body)",
            "lineNumber": 4257
          },
          {
            "text": "                              });",
            "lineNumber": 4258
          },
          {
            "text": "                              const resData = await res.json();",
            "lineNumber": 4259
          },
          {
            "text": "                              if (resData?.choices?.[0]?.message?.content) { ",
            "lineNumber": 4260
          },
          {
            "text": "                                  summary = resData.choices[0].message.content;",
            "lineNumber": 4261
          },
          {
            "text": "                              }",
            "lineNumber": 4262
          },
          {
            "text": "                          }",
            "lineNumber": 4263
          },
          {
            "text": ";",
            "lineNumber": 4386
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.29125869274139404
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n\n  // 监听设置变化，同步更新已保存的文件夹设置\n  useEffect(() =&gt; {\n      if (activeTab.viewMode !== 'browser') return;\n      const folderId = activeTab.folderId;\n      const saved = state.folderSettings[folderId];\n      \n      if (saved) {\n          const currentSettings = {\n              layoutMode: activeTab.layoutMode,\n              sortBy: state.sortBy,\n              sortDirection: state.sortDirection,\n              groupBy: groupBy\n          };\n\n          if (\n              saved.layoutMode !== currentSettings.layoutMode ||\n  }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "lineNumber": 2832
          },
          {
            "lineNumber": 2833
          },
          {
            "text": "  // 监听设置变化，同步更新已保存的文件夹设置",
            "lineNumber": 2834
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 2835
          },
          {
            "text": "      if (activeTab.viewMode !== 'browser') return;",
            "lineNumber": 2836
          },
          {
            "text": "      const folderId = activeTab.folderId;",
            "lineNumber": 2837
          },
          {
            "text": "      const saved = state.folderSettings[folderId];",
            "lineNumber": 2838
          },
          {
            "text": "      ",
            "lineNumber": 2839
          },
          {
            "text": "      if (saved) {",
            "lineNumber": 2840
          },
          {
            "text": "          const currentSettings = {",
            "lineNumber": 2841
          },
          {
            "text": "              layoutMode: activeTab.layoutMode,",
            "lineNumber": 2842
          },
          {
            "text": "              sortBy: state.sortBy,",
            "lineNumber": 2843
          },
          {
            "text": "              sortDirection: state.sortDirection,",
            "lineNumber": 2844
          },
          {
            "text": "              groupBy: groupBy",
            "lineNumber": 2845
          },
          {
            "text": "          };",
            "lineNumber": 2846
          },
          {
            "lineNumber": 2847
          },
          {
            "text": "          if (",
            "lineNumber": 2848
          },
          {
            "text": "              saved.layoutMode !== currentSettings.layoutMode ||",
            "lineNumber": 2849
          },
          {
            "text": "  }",
            "lineNumber": 2863
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.290779709815979
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \n\n                              \n                              // Create a coherent fallback summary\n                              if (allDescriptions) {\n                                  summary += isChinese ? \n                                      &#96;本文件夹包含多张图片，主要内容是：${allDescriptions.substring(0, 500)}${allDescriptions.length &gt; 500 ? '...' : ''}&#96; :\n                                      &#96;This folder contains multiple images, with main content: ${allDescriptions.substring(0, 500)}${allDescriptions.length &gt; 500 ? '...' : ''}&#96;;\n                              }\n                              \n                              if (allTexts.length &gt; 0) {\n                                  summary += isChinese ? &#96;\\n\\n提取到的文字内容：${allTexts.join('; ').substring(0, 300)}${allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96; :\n                                      &#96;\\n\\nExtracted text content: ${allTexts.join('; ').substring(0, 300)}${allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96;;\n                              }\n                          }\n                      } catch (err) {\n                          console.error('Failed to generate AI analysis', err);\n                          // Fallback to a better summary that doesn't list individual images\n                          const isChinese = state.settings.language === 'zh';\n                          summary = isChinese ? &#96;## 图片分析汇总\\n\\n&#96; : &#96;## Image Analysis Summary\\n\\n&#96;;\n                          \n                          \n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3593
          },
          {
            "lineNumber": 4316
          },
          {
            "text": "                              ",
            "lineNumber": 4317
          },
          {
            "text": "                              // Create a coherent fallback summary",
            "lineNumber": 4318
          },
          {
            "text": "                              if (allDescriptions) {",
            "lineNumber": 4319
          },
          {
            "text": "                                  summary += isChinese ? ",
            "lineNumber": 4320
          },
          {
            "text": "                                      &#96;本文件夹包含多张图片，主要内容是：${allDescriptions.substring(0, 500)}${allDescriptions.length &gt; 500 ? '...' : ''}&#96; :",
            "lineNumber": 4321
          },
          {
            "text": "                                      &#96;This folder contains multiple images, with main content: ${allDescriptions.substring(0, 500)}${allDescriptions.length &gt; 500 ? '...' : ''}&#96;;",
            "lineNumber": 4322
          },
          {
            "text": "                              }",
            "lineNumber": 4323
          },
          {
            "text": "                              ",
            "lineNumber": 4324
          },
          {
            "text": "                              if (allTexts.length &gt; 0) {",
            "lineNumber": 4325
          },
          {
            "text": "                                  summary += isChinese ? &#96;\\n\\n提取到的文字内容：${allTexts.join('; ').substring(0, 300)}${allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96; :",
            "lineNumber": 4326
          },
          {
            "text": "                                      &#96;\\n\\nExtracted text content: ${allTexts.join('; ').substring(0, 300)}${allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96;;",
            "lineNumber": 4327
          },
          {
            "text": "                              }",
            "lineNumber": 4328
          },
          {
            "text": "                          }",
            "lineNumber": 4329
          },
          {
            "text": "                      } catch (err) {",
            "lineNumber": 4330
          },
          {
            "text": "                          console.error('Failed to generate AI analysis', err);",
            "lineNumber": 4331
          },
          {
            "text": "                          // Fallback to a better summary that doesn't list individual images",
            "lineNumber": 4332
          },
          {
            "text": "                          const isChinese = state.settings.language === 'zh';",
            "lineNumber": 4333
          },
          {
            "text": "                          summary = isChinese ? &#96;## 图片分析汇总\\n\\n&#96; : &#96;## Image Analysis Summary\\n\\n&#96;;",
            "lineNumber": 4334
          },
          {
            "text": "                          ",
            "lineNumber": 4335
          },
          {
            "text": "                          ",
            "lineNumber": 4336
          },
          {
            "text": ";",
            "lineNumber": 4386
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.28546369075775146
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst displayFileIds = () =&gt; {\n { \n        const start = new Date(activeTab.dateFilter.start).getTime(); \n        const end = new Date(activeTab.dateFilter.end).getTime(); \n        const minTime = Math.min(start, end); \n        const maxTime = Math.max(start, end) + 86400000; \n        const mode = activeTab.dateFilter.mode;\n        \n        candidates = candidates.filter(f =&gt; {\n            const dateStr = mode === 'created' ? f.createdAt : f.updatedAt;\n            if (!dateStr) return false;\n            const time = new Date(dateStr).getTime();\n            return time &gt;= minTime &amp;&amp; time &lt; maxTime;\n        }); \n    }\n    \n    // Sort and return IDs\n    return sortFiles(candidates).map(f =&gt; f.id);\n  }, [state.files, activeTab, state.sortBy, state.sortDirection, state.settings.search.isAISearchEnabled]);\n\n  // ... (keep grouping logic)\n  const toggleGroup = (groupId: string) =&gt; { setCollapsedGroups(prev =&gt; ({ ...prev, [groupId]: !prev[groupId] })); };\n  const groupedFiles = useMemo&lt;FileGroup[]&gt;(() =&gt; {\n    if (groupBy === 'none') return [];\n    const groups: Record&lt;string, string[]&gt; = {};\n    displayFileIds.forEach(id =&gt; {\n      const file = state.files[id]; if (!file) return; let key = 'Other';\n      if (groupBy === 'type') {\n        key = file.type === FileType.FOLDER ? t('groupBy.folder') : (file.meta?.format?.toUpperCase() || 'Unknown');\n      } \n      else if (groupBy === 'date') {\n        if (file.createdAt) { \n          const date = new Date(file.createdAt);\n    }\n  };\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const displayFileIds = () =&gt; {",
            "lineNumber": 1098
          },
          {
            "text": " { ",
            "lineNumber": 1262
          },
          {
            "text": "        const start = new Date(activeTab.dateFilter.start).getTime(); ",
            "lineNumber": 1263
          },
          {
            "text": "        const end = new Date(activeTab.dateFilter.end).getTime(); ",
            "lineNumber": 1264
          },
          {
            "text": "        const minTime = Math.min(start, end); ",
            "lineNumber": 1265
          },
          {
            "text": "        const maxTime = Math.max(start, end) + 86400000; ",
            "lineNumber": 1266
          },
          {
            "text": "        const mode = activeTab.dateFilter.mode;",
            "lineNumber": 1267
          },
          {
            "text": "        ",
            "lineNumber": 1268
          },
          {
            "text": "        candidates = candidates.filter(f =&gt; {",
            "lineNumber": 1269
          },
          {
            "text": "            const dateStr = mode === 'created' ? f.createdAt : f.updatedAt;",
            "lineNumber": 1270
          },
          {
            "text": "            if (!dateStr) return false;",
            "lineNumber": 1271
          },
          {
            "text": "            const time = new Date(dateStr).getTime();",
            "lineNumber": 1272
          },
          {
            "text": "            return time &gt;= minTime &amp;&amp; time &lt; maxTime;",
            "lineNumber": 1273
          },
          {
            "text": "        }); ",
            "lineNumber": 1274
          },
          {
            "text": "    }",
            "lineNumber": 1275
          },
          {
            "text": "    ",
            "lineNumber": 1276
          },
          {
            "text": "    // Sort and return IDs",
            "lineNumber": 1277
          },
          {
            "text": "    return sortFiles(candidates).map(f =&gt; f.id);",
            "lineNumber": 1278
          },
          {
            "text": "  }, [state.files, activeTab, state.sortBy, state.sortDirection, state.settings.search.isAISearchEnabled]);",
            "lineNumber": 1279
          },
          {
            "lineNumber": 1280
          },
          {
            "text": "  // ... (keep grouping logic)",
            "lineNumber": 1281
          },
          {
            "text": "  const toggleGroup = (groupId: string) =&gt; { setCollapsedGroups(prev =&gt; ({ ...prev, [groupId]: !prev[groupId] })); };",
            "lineNumber": 1282
          },
          {
            "text": "  const groupedFiles = useMemo&lt;FileGroup[]&gt;(() =&gt; {",
            "lineNumber": 1283
          },
          {
            "text": "    if (groupBy === 'none') return [];",
            "lineNumber": 1284
          },
          {
            "text": "    const groups: Record&lt;string, string[]&gt; = {};",
            "lineNumber": 1285
          },
          {
            "text": "    displayFileIds.forEach(id =&gt; {",
            "lineNumber": 1286
          },
          {
            "text": "      const file = state.files[id]; if (!file) return; let key = 'Other';",
            "lineNumber": 1287
          },
          {
            "text": "      if (groupBy === 'type') {",
            "lineNumber": 1288
          },
          {
            "text": "        key = file.type === FileType.FOLDER ? t('groupBy.folder') : (file.meta?.format?.toUpperCase() || 'Unknown');",
            "lineNumber": 1289
          },
          {
            "text": "      } ",
            "lineNumber": 1290
          },
          {
            "text": "      else if (groupBy === 'date') {",
            "lineNumber": 1291
          },
          {
            "text": "        if (file.createdAt) { ",
            "lineNumber": 1292
          },
          {
            "text": "          const date = new Date(file.createdAt);",
            "lineNumber": 1293
          },
          {
            "text": "    }",
            "lineNumber": 1306
          },
          {
            "text": "  };",
            "lineNumber": 1308
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.2844657897949219
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\n\n                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}\n                          onPrev={() =&gt; handleViewerNavigate('prev')}\n                          onNavigateBack={goBack}\n                          onNavigateForward={goForward}\n                          canGoBack={activeTab.history.currentIndex &gt; 0}\n                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}\n                          onDelete={(id) =&gt; requestDelete([id])}\n                          onViewInExplorer={handleViewInExplorer}\n                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}\n                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}\n                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}\n                          searchQuery={activeTab.searchQuery}\n                          onSearch={handleViewerSearch}\n                          searchScope={activeTab.searchScope}\n                          onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })}\n                          onUpdateSlideshowConfig={(cfg) =&gt; setState(s =&gt; ({ ...s, slideshowConfig: cfg }))}\n                          onPasteTags={(id) =&gt; handlePasteTags([id])}\n                          onEditTags={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'edit-tags', data: { fileId: activeTab.viewingFileId } } }))}\n                          onCopyTags={() =&gt; handleCopyTags([activeTab.viewingFileId!])}\n                          onAIAnalysis={(id) =&gt; handleAIAnalysis([id])}\n                          isAISearchEnabled={state.settings.search.isAISearchEnabled}\n                          onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}\n                          t={t}\n                          activeTab={activeTab}\n                      /&gt;\n                  );\n              })()\n          )}\n          {!activeTab.viewingFileId &amp;&amp; (\n            &lt;&gt;\n              &lt;TopBar \n                activeTab={activeTab} \n                state={state}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4466
          },
          {
            "lineNumber": 4495
          },
          {
            "text": "                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}",
            "lineNumber": 4496
          },
          {
            "text": "                          onPrev={() =&gt; handleViewerNavigate('prev')}",
            "lineNumber": 4497
          },
          {
            "text": "                          onNavigateBack={goBack}",
            "lineNumber": 4498
          },
          {
            "text": "                          onNavigateForward={goForward}",
            "lineNumber": 4499
          },
          {
            "text": "                          canGoBack={activeTab.history.currentIndex &gt; 0}",
            "lineNumber": 4500
          },
          {
            "text": "                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}",
            "lineNumber": 4501
          },
          {
            "text": "                          onDelete={(id) =&gt; requestDelete([id])}",
            "lineNumber": 4502
          },
          {
            "text": "                          onViewInExplorer={handleViewInExplorer}",
            "lineNumber": 4503
          },
          {
            "text": "                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4504
          },
          {
            "text": "                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4505
          },
          {
            "text": "                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}",
            "lineNumber": 4506
          },
          {
            "text": "                          searchQuery={activeTab.searchQuery}",
            "lineNumber": 4507
          },
          {
            "text": "                          onSearch={handleViewerSearch}",
            "lineNumber": 4508
          },
          {
            "text": "                          searchScope={activeTab.searchScope}",
            "lineNumber": 4509
          },
          {
            "text": "                          onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })}",
            "lineNumber": 4510
          },
          {
            "text": "                          onUpdateSlideshowConfig={(cfg) =&gt; setState(s =&gt; ({ ...s, slideshowConfig: cfg }))}",
            "lineNumber": 4511
          },
          {
            "text": "                          onPasteTags={(id) =&gt; handlePasteTags([id])}",
            "lineNumber": 4512
          },
          {
            "text": "                          onEditTags={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'edit-tags', data: { fileId: activeTab.viewingFileId } } }))}",
            "lineNumber": 4513
          },
          {
            "text": "                          onCopyTags={() =&gt; handleCopyTags([activeTab.viewingFileId!])}",
            "lineNumber": 4514
          },
          {
            "text": "                          onAIAnalysis={(id) =&gt; handleAIAnalysis([id])}",
            "lineNumber": 4515
          },
          {
            "text": "                          isAISearchEnabled={state.settings.search.isAISearchEnabled}",
            "lineNumber": 4516
          },
          {
            "text": "                          onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}",
            "lineNumber": 4517
          },
          {
            "text": "                          t={t}",
            "lineNumber": 4518
          },
          {
            "text": "                          activeTab={activeTab}",
            "lineNumber": 4519
          },
          {
            "text": "                      /&gt;",
            "lineNumber": 4520
          },
          {
            "text": "                  );",
            "lineNumber": 4521
          },
          {
            "text": "              })()",
            "lineNumber": 4522
          },
          {
            "text": "          )}",
            "lineNumber": 4523
          },
          {
            "text": "          {!activeTab.viewingFileId &amp;&amp; (",
            "lineNumber": 4524
          },
          {
            "text": "            &lt;&gt;",
            "lineNumber": 4525
          },
          {
            "text": "              &lt;TopBar ",
            "lineNumber": 4526
          },
          {
            "text": "                activeTab={activeTab} ",
            "lineNumber": 4527
          },
          {
            "text": "                state={state}",
            "lineNumber": 4528
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.2830356955528259
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n \n                groupBy={groupBy}\n                onGroupByChange={setGroupBy}\n                isAISearchEnabled={state.settings.search.isAISearchEnabled}\n                onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}\n                onRememberFolderSettings={activeTab.viewMode === 'browser' ? handleRememberFolderSettings : undefined}\n                hasFolderSettings={activeTab.viewMode === 'browser' ? !!state.folderSettings[activeTab.folderId] : false}\n                t={t} \n              /&gt;\n              {/* ... (Filter UI, same as before) ... */}\n              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": " ",
            "lineNumber": 4548
          },
          {
            "text": "                groupBy={groupBy}",
            "lineNumber": 4549
          },
          {
            "text": "                onGroupByChange={setGroupBy}",
            "lineNumber": 4550
          },
          {
            "text": "                isAISearchEnabled={state.settings.search.isAISearchEnabled}",
            "lineNumber": 4551
          },
          {
            "text": "                onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}",
            "lineNumber": 4552
          },
          {
            "text": "                onRememberFolderSettings={activeTab.viewMode === 'browser' ? handleRememberFolderSettings : undefined}",
            "lineNumber": 4553
          },
          {
            "text": "                hasFolderSettings={activeTab.viewMode === 'browser' ? !!state.folderSettings[activeTab.folderId] : false}",
            "lineNumber": 4554
          },
          {
            "text": "                t={t} ",
            "lineNumber": 4555
          },
          {
            "text": "              /&gt;",
            "lineNumber": 4556
          },
          {
            "text": "              {/* ... (Filter UI, same as before) ... */}",
            "lineNumber": 4557
          },
          {
            "text": "              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start",
            "lineNumber": 4558
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.27668559551239014
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 152
          },
          "endPosition": {
            "line": 291,
            "column": 2
          }
        },
        "contents": "const extractPalette = async \n(resolve) =&gt; {\n() =&gt; {\n\n                \n                // Pass 2: Relax slightly only if we have very few colors\n                if (finalPalette.length &lt; 5) {\n                    for (const c of sorted) {\n                        if (finalPalette.length &gt;= 8) break;\n                        addColor(c, 30);\n                    }\n                }\n                \n                // We DO NOT force 8 colors. If we only found 4 distinct ones, we return 4.\n\n                resolve(finalPalette.map(p =&gt; p.hex));\n                \n            } catch(e) {\n                console.error(\"Pixel access failed\", e);\n                resolve([]);\n            }\n        };\n        img.onerror = () =&gt; resolve([]);\n    });\n};\n\nconst CategorySelector = ({ current, onChange, t }: any) =&gt; (\n  &lt;div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-800\"&gt;\n      &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2\"&gt;{t('meta.folderCategory')}&lt;/div&gt;\n      &lt;div className=\"flex bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl gap-2\"&gt;\n          {['general', 'book', 'sequence'].map((cat) =&gt; {\n              const isActive = current === cat;\n              return (\n                  &lt;button\n                      key={cat}\n                      onClick={() =&gt; onChange(cat)}\n                      className={&#96;flex-1 flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all ${\n                          isActive\n                          ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-md ring-1 ring-black/5 dark:ring-white/10' \n                          : 'text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-100'\n                      }&#96;}\n                  &gt;\n                      {cat === 'general' &amp;&amp; &lt;Folder size={20} className={&#96;mb-1.5 ${isActive ? 'fill-blue-100 dark:fill-blue-900/30' : ''}&#96;}/&gt;}\n                      {cat === 'book' &amp;&amp; &lt;Book size={20} className={&#96;mb-1.5 ${isActive ? 'fill-amber-100 dark:fill-amber-900/30' : ''}&#96;}/&gt;}\n                      {cat === 'sequence' &amp;&amp; &lt;Film size={20} className={&#96;mb-1.5 ${isActive ? 'fill-purple-100 dark:fill-purple-900/30' : ''}&#96;}/&gt;}\n                      {t(&#96;meta.cat${cat.charAt(0).toUpperCase() + cat.slice(1)}&#96;)}\n                  &lt;/button&gt;\n              );\n          })}\n      &lt;/div&gt;\n  &lt;/div&gt;\n);",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const extractPalette = async ",
            "lineNumber": 153
          },
          {
            "text": "(resolve) =&gt; {",
            "lineNumber": 154
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 158
          },
          {
            "lineNumber": 244
          },
          {
            "text": "                ",
            "lineNumber": 245
          },
          {
            "text": "                // Pass 2: Relax slightly only if we have very few colors",
            "lineNumber": 246
          },
          {
            "text": "                if (finalPalette.length &lt; 5) {",
            "lineNumber": 247
          },
          {
            "text": "                    for (const c of sorted) {",
            "lineNumber": 248
          },
          {
            "text": "                        if (finalPalette.length &gt;= 8) break;",
            "lineNumber": 249
          },
          {
            "text": "                        addColor(c, 30);",
            "lineNumber": 250
          },
          {
            "text": "                    }",
            "lineNumber": 251
          },
          {
            "text": "                }",
            "lineNumber": 252
          },
          {
            "text": "                ",
            "lineNumber": 253
          },
          {
            "text": "                // We DO NOT force 8 colors. If we only found 4 distinct ones, we return 4.",
            "lineNumber": 254
          },
          {
            "lineNumber": 255
          },
          {
            "text": "                resolve(finalPalette.map(p =&gt; p.hex));",
            "lineNumber": 256
          },
          {
            "text": "                ",
            "lineNumber": 257
          },
          {
            "text": "            } catch(e) {",
            "lineNumber": 258
          },
          {
            "text": "                console.error(\"Pixel access failed\", e);",
            "lineNumber": 259
          },
          {
            "text": "                resolve([]);",
            "lineNumber": 260
          },
          {
            "text": "            }",
            "lineNumber": 261
          },
          {
            "text": "        };",
            "lineNumber": 262
          },
          {
            "text": "        img.onerror = () =&gt; resolve([]);",
            "lineNumber": 263
          },
          {
            "text": "    });",
            "lineNumber": 264
          },
          {
            "text": "};",
            "lineNumber": 265
          },
          {
            "lineNumber": 266
          },
          {
            "text": "const CategorySelector = ({ current, onChange, t }: any) =&gt; (",
            "lineNumber": 267
          },
          {
            "text": "  &lt;div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-800\"&gt;",
            "lineNumber": 268
          },
          {
            "text": "      &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2\"&gt;{t('meta.folderCategory')}&lt;/div&gt;",
            "lineNumber": 269
          },
          {
            "text": "      &lt;div className=\"flex bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl gap-2\"&gt;",
            "lineNumber": 270
          },
          {
            "text": "          {['general', 'book', 'sequence'].map((cat) =&gt; {",
            "lineNumber": 271
          },
          {
            "text": "              const isActive = current === cat;",
            "lineNumber": 272
          },
          {
            "text": "              return (",
            "lineNumber": 273
          },
          {
            "text": "                  &lt;button",
            "lineNumber": 274
          },
          {
            "text": "                      key={cat}",
            "lineNumber": 275
          },
          {
            "text": "                      onClick={() =&gt; onChange(cat)}",
            "lineNumber": 276
          },
          {
            "text": "                      className={&#96;flex-1 flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all ${",
            "lineNumber": 277
          },
          {
            "text": "                          isActive",
            "lineNumber": 278
          },
          {
            "text": "                          ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-md ring-1 ring-black/5 dark:ring-white/10' ",
            "lineNumber": 279
          },
          {
            "text": "                          : 'text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-100'",
            "lineNumber": 280
          },
          {
            "text": "                      }&#96;}",
            "lineNumber": 281
          },
          {
            "text": "                  &gt;",
            "lineNumber": 282
          },
          {
            "text": "                      {cat === 'general' &amp;&amp; &lt;Folder size={20} className={&#96;mb-1.5 ${isActive ? 'fill-blue-100 dark:fill-blue-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 283
          },
          {
            "text": "                      {cat === 'book' &amp;&amp; &lt;Book size={20} className={&#96;mb-1.5 ${isActive ? 'fill-amber-100 dark:fill-amber-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 284
          },
          {
            "text": "                      {cat === 'sequence' &amp;&amp; &lt;Film size={20} className={&#96;mb-1.5 ${isActive ? 'fill-purple-100 dark:fill-purple-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 285
          },
          {
            "text": "                      {t(&#96;meta.cat${cat.charAt(0).toUpperCase() + cat.slice(1)}&#96;)}",
            "lineNumber": 286
          },
          {
            "text": "                  &lt;/button&gt;",
            "lineNumber": 287
          },
          {
            "text": "              );",
            "lineNumber": 288
          },
          {
            "text": "          })}",
            "lineNumber": 289
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 290
          },
          {
            "text": "  &lt;/div&gt;",
            "lineNumber": 291
          },
          {
            "text": ");",
            "lineNumber": 292
          }
        ]
      },
      "score": 0.2752508521080017
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/TopBar.tsx</summary>

</details>
</tool-use>

---



---


查看搜索功能的实现，了解如何限制搜索范围：


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "handlePerformSearch|onPerformSearch",
  "path": "src/App.tsx",
  "contextAfter": 30,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "handlePerformSearch|onPerformSearch",
    "path": "src/App.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/App.tsx",
              "matches": [
                {
                  "lineNumber": 3056,
                  "content": "  const onPerformSearch = async (query: string) =&gt; {"
                },
                {
                  "lineNumber": 3057,
                  "content": "      if (state.settings.search.isAISearchEnabled) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3058,
                  "content": "          await performAiSearch(query);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3059,
                  "content": "      } else {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3060,
                  "content": "          pushHistory(activeTab.folderId, null, 'browser', query, activeTab.searchScope, activeTab.activeTags, null, 0);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3061,
                  "content": "      }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3062,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3063,
                  "isContextLine": true
                },
                {
                  "lineNumber": 3064,
                  "content": "  const handlePerformSearch = onPerformSearch;"
                },
                {
                  "lineNumber": 3065,
                  "isContextLine": true
                },
                {
                  "lineNumber": 3066,
                  "content": "  const handleViewerSearch = (query: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', query, activeTab.searchScope, activeTab.activeTags, null, 0);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3067,
                  "content": "  const enterTagView = (tagName: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'tag', [tagName], null, 0);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3068,
                  "content": "  const enterTagsOverview = () =&gt; pushHistory(activeTab.folderId, null, 'tags-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3069,
                  "content": "  const enterPeopleOverview = () =&gt; pushHistory(activeTab.folderId, null, 'people-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3070,
                  "content": "  const enterPersonView = (personId: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'all', [], personId, 0);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3071,
                  "content": "  const handleClearTagFilter = (tagToRemove: string) =&gt; updateActiveTab(prev =&gt; ({ activeTags: prev.activeTags.filter(t =&gt; t !== tagToRemove) }));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3072,
                  "content": "  const handleClearAllTags = () =&gt; updateActiveTab({ activeTags: [] });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3073,
                  "content": "  const handleClearPersonFilter = () =&gt; updateActiveTab({ activePersonId: null });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3074,
                  "isContextLine": true
                },
                {
                  "lineNumber": 3075,
                  "content": "  const handleRenameSubmit = async (value: string, id: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3076,
                  "content": "      value = value.trim();",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3077,
                  "content": "      const file = state.files[id];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3078,
                  "content": "      if (!value || value === file.name) { setState(s =&gt; ({ ...s, renamingId: null })); return; }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3079,
                  "content": "      if (file.path) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3080,
                  "content": "          try {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3081,
                  "content": "              const separator = file.path.includes('/') ? '/' : '\\\\';",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3082,
                  "content": "              const parentPath = file.path.substring(0, file.path.lastIndexOf(separator));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3083,
                  "content": "              const newPath = &#96;${parentPath}${separator}${value}&#96;;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3084,
                  "isContextLine": true
                },
                {
                  "lineNumber": 3085,
                  "content": "              // Use appropriate renameFile function based on environment",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3086,
                  "content": "              const isTauriEnv = isTauriEnvironment();",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3087,
                  "content": "              if (isTauriEnv) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3088,
                  "content": "                  await renameFile(file.path, newPath);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3089,
                  "content": "              } else {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3090,
                  "content": "                  throw new Error(\"No file system access available\");",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3091,
                  "content": "              }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3092,
                  "isContextLine": true
                },
                {
                  "lineNumber": 3093,
                  "content": "              await handleRefresh();",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3094,
                  "content": "              setState(s =&gt; ({ ...s, renamingId: null }));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4540,
                  "content": "                onPerformSearch={handlePerformSearch}"
                },
                {
                  "lineNumber": 4541,
                  "content": "                onSetToolbarQuery={setToolbarQuery}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4542,
                  "content": "                onLayoutModeChange={(mode) =&gt; updateActiveTab({ layoutMode: mode })}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4543,
                  "content": "                onSortOptionChange={(opt) =&gt; setState(s =&gt; ({ ...s, sortBy: opt }))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4544,
                  "content": "                onSortDirectionChange={() =&gt; setState(s =&gt; ({ ...s, sortDirection: s.sortDirection === 'asc' ? 'desc' : 'asc' }))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4545,
                  "content": "                onThumbnailSizeChange={(size) =&gt; setState(s =&gt; ({ ...s, thumbnailSize: size }))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4546,
                  "content": "                onToggleMetadata={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isMetadataVisible: !s.layout.isMetadataVisible } }))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4547,
                  "content": "                onToggleSettings={toggleSettings}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4548,
                  "content": "                onUpdateDateFilter={(f) =&gt; updateActiveTab({ dateFilter: f })}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4549,
                  "content": "                groupBy={groupBy}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4550,
                  "content": "                onGroupByChange={setGroupBy}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4551,
                  "content": "                isAISearchEnabled={state.settings.search.isAISearchEnabled}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4552,
                  "content": "                onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4553,
                  "content": "                onRememberFolderSettings={activeTab.viewMode === 'browser' ? handleRememberFolderSettings : undefined}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4554,
                  "content": "                hasFolderSettings={activeTab.viewMode === 'browser' ? !!state.folderSettings[activeTab.folderId] : false}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4555,
                  "content": "                t={t}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4556,
                  "content": "              /&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4557,
                  "content": "              {/* ... (Filter UI, same as before) ... */}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4558,
                  "content": "              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start || activeTab.activePersonId || activeTab.aiFilter) &amp;&amp; (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4559,
                  "content": "                  &lt;div className=\"flex items-center px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 space-x-2 overflow-x-auto shrink-0 z-20\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4560,
                  "content": "                      &lt;div className=\"flex items-center text-xs text-gray-500 dark:text-gray-400 mr-2 shrink-0\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4561,
                  "content": "                          &lt;Filter size={12} className=\"mr-1\"/&gt; {t('context.filters')}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4562,
                  "content": "                      &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4563,
                  "isContextLine": true
                },
                {
                  "lineNumber": 4564,
                  "content": "                      {activeTab.aiFilter &amp;&amp; (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4565,
                  "content": "                          &lt;div className=\"flex items-center bg-purple-100 dark:bg-purple-900/40 text-purple-800 dark:text-purple-200 px-2 py-0.5 rounded-full text-xs border border-purple-200 dark:border-purple-800 whitespace-nowrap\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4566,
                  "content": "                              &lt;Brain size={10} className=\"mr-1\"/&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4567,
                  "content": "                              &lt;span&gt;{t('settings.aiSmartSearch')}: \"{activeTab.aiFilter.originalQuery}\"&lt;/span&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4568,
                  "content": "                              &lt;button onClick={() =&gt; updateActiveTab({ aiFilter: null })} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4569,
                  "content": "                          &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4570,
                  "content": "                      )}",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 70,
          "totalMatchedLines": 3
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "people-overview viewMode 人物主面板显示",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1490
          },
          "endPosition": {
            "line": 2018,
            "column": 1
          }
        },
        "contents": "interface FileGridProps {\n\n  selectionBox?: { startX: number; startY: number; currentX: number; currentY: number } | null;\n  t: (key: string) =&gt; string;\n  onThumbnailSizeChange?: (size: number) =&gt; void;\n  onUpdateFile?: (id: string, updates: Partial&lt;FileNode&gt;) =&gt; void;\n  settings?: import('../types').AppSettings;\n  onDragEnd?: (e: React.DragEvent) =&gt; void;\n  resourceRoot?: string;\n  cachePath?: string;\n  onScrollTopChange?: (scrollTop: number) =&gt; void;\n}\n\nexport const FileGrid: React.FC&lt;FileGridProps&gt; = ({\n  displayFileIds,\n  files,\n  activeTab,\n  renamingId,\n  thumbnailSize,\n  resourceRoot,\n  cachePath,\n  hoverPlayingId,\n  onSetHoverPlayingId,\n  onFileClick,\n  onFileDoubleClick,\n  onContextMenu,\n  onRenameSubmit,\n  onRenameCancel,\n  onStartRename,\n  onDragStart,\n  onDragEnd,\n  onDropOnFolder,\n  onDropExternal,\n  containerRef,\n  onMouseDown,\n  onMouseMove,\n  onMouseUp,\n  onBackgroundContextMenu,\n  people,\n  groupedTags,\n  onPersonClick,\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "interface FileGridProps {",
            "lineNumber": 1491,
            "isSignature": true
          },
          {
            "lineNumber": 1526
          },
          {
            "text": "  selectionBox?: { startX: number; startY: number; currentX: number; currentY: number } | null;",
            "lineNumber": 1527
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 1528
          },
          {
            "text": "  onThumbnailSizeChange?: (size: number) =&gt; void;",
            "lineNumber": 1529
          },
          {
            "text": "  onUpdateFile?: (id: string, updates: Partial&lt;FileNode&gt;) =&gt; void;",
            "lineNumber": 1530
          },
          {
            "text": "  settings?: import('../types').AppSettings;",
            "lineNumber": 1531
          },
          {
            "text": "  onDragEnd?: (e: React.DragEvent) =&gt; void;",
            "lineNumber": 1532
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 1533
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 1534
          },
          {
            "text": "  onScrollTopChange?: (scrollTop: number) =&gt; void;",
            "lineNumber": 1535,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 1536,
            "isSignature": true
          },
          {
            "lineNumber": 1537
          },
          {
            "text": "export const FileGrid: React.FC&lt;FileGridProps&gt; = ({",
            "lineNumber": 1538
          },
          {
            "text": "  displayFileIds,",
            "lineNumber": 1539
          },
          {
            "text": "  files,",
            "lineNumber": 1540
          },
          {
            "text": "  activeTab,",
            "lineNumber": 1541
          },
          {
            "text": "  renamingId,",
            "lineNumber": 1542
          },
          {
            "text": "  thumbnailSize,",
            "lineNumber": 1543
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 1544
          },
          {
            "text": "  cachePath,",
            "lineNumber": 1545
          },
          {
            "text": "  hoverPlayingId,",
            "lineNumber": 1546
          },
          {
            "text": "  onSetHoverPlayingId,",
            "lineNumber": 1547
          },
          {
            "text": "  onFileClick,",
            "lineNumber": 1548
          },
          {
            "text": "  onFileDoubleClick,",
            "lineNumber": 1549
          },
          {
            "text": "  onContextMenu,",
            "lineNumber": 1550
          },
          {
            "text": "  onRenameSubmit,",
            "lineNumber": 1551
          },
          {
            "text": "  onRenameCancel,",
            "lineNumber": 1552
          },
          {
            "text": "  onStartRename,",
            "lineNumber": 1553
          },
          {
            "text": "  onDragStart,",
            "lineNumber": 1554
          },
          {
            "text": "  onDragEnd,",
            "lineNumber": 1555
          },
          {
            "text": "  onDropOnFolder,",
            "lineNumber": 1556
          },
          {
            "text": "  onDropExternal,",
            "lineNumber": 1557
          },
          {
            "text": "  containerRef,",
            "lineNumber": 1558
          },
          {
            "text": "  onMouseDown,",
            "lineNumber": 1559
          },
          {
            "text": "  onMouseMove,",
            "lineNumber": 1560
          },
          {
            "text": "  onMouseUp,",
            "lineNumber": 1561
          },
          {
            "text": "  onBackgroundContextMenu,",
            "lineNumber": 1562
          },
          {
            "text": "  people,",
            "lineNumber": 1563
          },
          {
            "text": "  groupedTags,",
            "lineNumber": 1564
          },
          {
            "text": "  onPersonClick,",
            "lineNumber": 1565
          },
          {
            "text": ";",
            "lineNumber": 2019
          }
        ]
      },
      "score": 0.4736725687980652
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n              &lt;TopBar \n                activeTab={activeTab} \n                state={state} \n                toolbarQuery={toolbarQuery} \n                groupedTags={groupedTags} \n                tagSearchQuery={tagSearchQuery} \n                onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))} \n                onGoBack={goBack} \n                onGoForward={goForward} \n                onNavigateUp={handleNavigateUp} \n                onSetTagSearchQuery={setTagSearchQuery} \n                onTagClick={handleTagClick} \n                onRefresh={handleRefresh} \n                onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })} \n                onPerformSearch={handlePerformSearch} \n                onSetToolbarQuery={setToolbarQuery} \n                onLayoutModeChange={(mode) =&gt; updateActiveTab({ layoutMode: mode })} \n                onSortOptionChange={(opt) =&gt; setState(s =&gt; ({ ...s, sortBy: opt }))} \n                onSortDirectionChange={() =&gt; setState(s =&gt; ({ ...s, sortDirection: s.sortDirection === 'asc' ? 'desc' : 'asc' }))} \n                onThumbnailSizeChange={(size) =&gt; setState(s =&gt; ({ ...s, thumbnailSize: size }))} \n                onToggleMetadata={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isMetadataVisible: !s.layout.isMetadataVisible } }))} \n                onToggleSettings={toggleSettings} \n                onUpdateDateFilter={(f) =&gt; updateActiveTab({ dateFilter: f })} \n                groupBy={groupBy}\n                onGroupByChange={setGroupBy}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "lineNumber": 4525
          },
          {
            "text": "              &lt;TopBar ",
            "lineNumber": 4526
          },
          {
            "text": "                activeTab={activeTab} ",
            "lineNumber": 4527
          },
          {
            "text": "                state={state} ",
            "lineNumber": 4528
          },
          {
            "text": "                toolbarQuery={toolbarQuery} ",
            "lineNumber": 4529
          },
          {
            "text": "                groupedTags={groupedTags} ",
            "lineNumber": 4530
          },
          {
            "text": "                tagSearchQuery={tagSearchQuery} ",
            "lineNumber": 4531
          },
          {
            "text": "                onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))} ",
            "lineNumber": 4532
          },
          {
            "text": "                onGoBack={goBack} ",
            "lineNumber": 4533
          },
          {
            "text": "                onGoForward={goForward} ",
            "lineNumber": 4534
          },
          {
            "text": "                onNavigateUp={handleNavigateUp} ",
            "lineNumber": 4535
          },
          {
            "text": "                onSetTagSearchQuery={setTagSearchQuery} ",
            "lineNumber": 4536
          },
          {
            "text": "                onTagClick={handleTagClick} ",
            "lineNumber": 4537
          },
          {
            "text": "                onRefresh={handleRefresh} ",
            "lineNumber": 4538
          },
          {
            "text": "                onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })} ",
            "lineNumber": 4539
          },
          {
            "text": "                onPerformSearch={handlePerformSearch} ",
            "lineNumber": 4540
          },
          {
            "text": "                onSetToolbarQuery={setToolbarQuery} ",
            "lineNumber": 4541
          },
          {
            "text": "                onLayoutModeChange={(mode) =&gt; updateActiveTab({ layoutMode: mode })} ",
            "lineNumber": 4542
          },
          {
            "text": "                onSortOptionChange={(opt) =&gt; setState(s =&gt; ({ ...s, sortBy: opt }))} ",
            "lineNumber": 4543
          },
          {
            "text": "                onSortDirectionChange={() =&gt; setState(s =&gt; ({ ...s, sortDirection: s.sortDirection === 'asc' ? 'desc' : 'asc' }))} ",
            "lineNumber": 4544
          },
          {
            "text": "                onThumbnailSizeChange={(size) =&gt; setState(s =&gt; ({ ...s, thumbnailSize: size }))} ",
            "lineNumber": 4545
          },
          {
            "text": "                onToggleMetadata={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isMetadataVisible: !s.layout.isMetadataVisible } }))} ",
            "lineNumber": 4546
          },
          {
            "text": "                onToggleSettings={toggleSettings} ",
            "lineNumber": 4547
          },
          {
            "text": "                onUpdateDateFilter={(f) =&gt; updateActiveTab({ dateFilter: f })} ",
            "lineNumber": 4548
          },
          {
            "text": "                groupBy={groupBy}",
            "lineNumber": 4549
          },
          {
            "text": "                onGroupByChange={setGroupBy}",
            "lineNumber": 4550
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.39576709270477295
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 982
          },
          "endPosition": {
            "line": 1178,
            "column": 1
          }
        },
        "contents": "const FileCard = ({\n  file,\n  files,\n  isSelected,\n  renamingId,\n  layoutMode,\n  hoverPlayingId,\n  dragTargetId,\n  onFileClick,\n  onFileDoubleClick,\n  onContextMenu,\n  onStartRename,\n  onRenameSubmit,\n  onRenameCancel,\n  onSetHoverPlayingId,\n  onDragStart,\n  onDragEnd,\n  onDragOver,\n  onDragLeave,\n  onDropOnFolder,\n  onDropExternal,\n  style,\n  settings,\n  resourceRoot,\n  cachePath\n}: any) =&gt; {\n\n\n            &lt;div className=\"absolute bottom-1 right-1 flex space-x-1 pointer-events-none\"&gt;\n            {file.type === FileType.IMAGE &amp;&amp; (file.meta?.format === 'gif' || file.meta?.format === 'webp') &amp;&amp; (\n                &lt;span className=\"text-[9px] font-bold bg-black/60 text-white px-1 rounded shadow-sm\"&gt;{file.meta.format.toUpperCase()}&lt;/span&gt;\n            )}\n            &lt;/div&gt;\n        &lt;/div&gt;\n        \n        &lt;div className=\"mt-1.5 w-full text-center px-1 h-8 flex flex-col justify-start leading-tight\"&gt;\n            {renamingId === file.id ? (\n            &lt;InlineRenameInput\n                defaultValue={file.name}\n                onCommit={(val: string) =&gt; onRenameSubmit(val, file.id)}\n                onCancel={onRenameCancel}\n            /&gt;\n            ) : (\n            &lt;div\n                className=\"text-xs font-semibold text-gray-700 dark:text-gray-300 truncate w-full\"\n                title={file.name}\n                onDoubleClick={(e) =&gt; {\n                e.stopPropagation();\n                onStartRename(file.id);\n                }}\n            &gt;\n                {file.name}\n            &lt;/div&gt;\n            )}\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1014,
                "column": 1
              },
              "endPosition": {
                "line": 1014,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 1014,
                "column": 7
              },
              "endPosition": {
                "line": 1014,
                "column": 19
              }
            },
            {
              "startPosition": {
                "line": 1037,
                "column": 10
              },
              "endPosition": {
                "line": 1037,
                "column": 10
              }
            },
            {
              "startPosition": {
                "line": 1037,
                "column": 18
              },
              "endPosition": {
                "line": 1038,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FileCard = ({",
            "lineNumber": 983
          },
          {
            "text": "  file,",
            "lineNumber": 984
          },
          {
            "text": "  files,",
            "lineNumber": 985
          },
          {
            "text": "  isSelected,",
            "lineNumber": 986
          },
          {
            "text": "  renamingId,",
            "lineNumber": 987
          },
          {
            "text": "  layoutMode,",
            "lineNumber": 988
          },
          {
            "text": "  hoverPlayingId,",
            "lineNumber": 989
          },
          {
            "text": "  dragTargetId,",
            "lineNumber": 990
          },
          {
            "text": "  onFileClick,",
            "lineNumber": 991
          },
          {
            "text": "  onFileDoubleClick,",
            "lineNumber": 992
          },
          {
            "text": "  onContextMenu,",
            "lineNumber": 993
          },
          {
            "text": "  onStartRename,",
            "lineNumber": 994
          },
          {
            "text": "  onRenameSubmit,",
            "lineNumber": 995
          },
          {
            "text": "  onRenameCancel,",
            "lineNumber": 996
          },
          {
            "text": "  onSetHoverPlayingId,",
            "lineNumber": 997
          },
          {
            "text": "  onDragStart,",
            "lineNumber": 998
          },
          {
            "text": "  onDragEnd,",
            "lineNumber": 999
          },
          {
            "text": "  onDragOver,",
            "lineNumber": 1000
          },
          {
            "text": "  onDragLeave,",
            "lineNumber": 1001
          },
          {
            "text": "  onDropOnFolder,",
            "lineNumber": 1002
          },
          {
            "text": "  onDropExternal,",
            "lineNumber": 1003
          },
          {
            "text": "  style,",
            "lineNumber": 1004
          },
          {
            "text": "  settings,",
            "lineNumber": 1005
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 1006
          },
          {
            "text": "  cachePath",
            "lineNumber": 1007
          },
          {
            "text": "}: any) =&gt; {",
            "lineNumber": 1008
          },
          {
            "lineNumber": 1145
          },
          {
            "lineNumber": 1146
          },
          {
            "text": "            &lt;div className=\"absolute bottom-1 right-1 flex space-x-1 pointer-events-none\"&gt;",
            "lineNumber": 1147
          },
          {
            "text": "            {file.type === FileType.IMAGE &amp;&amp; (file.meta?.format === 'gif' || file.meta?.format === 'webp') &amp;&amp; (",
            "lineNumber": 1148
          },
          {
            "text": "                &lt;span className=\"text-[9px] font-bold bg-black/60 text-white px-1 rounded shadow-sm\"&gt;{file.meta.format.toUpperCase()}&lt;/span&gt;",
            "lineNumber": 1149
          },
          {
            "text": "            )}",
            "lineNumber": 1150
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 1151
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 1152
          },
          {
            "text": "        ",
            "lineNumber": 1153
          },
          {
            "text": "        &lt;div className=\"mt-1.5 w-full text-center px-1 h-8 flex flex-col justify-start leading-tight\"&gt;",
            "lineNumber": 1154
          },
          {
            "text": "            {renamingId === file.id ? (",
            "lineNumber": 1155
          },
          {
            "text": "            &lt;InlineRenameInput",
            "lineNumber": 1156
          },
          {
            "text": "                defaultValue={file.name}",
            "lineNumber": 1157
          },
          {
            "text": "                onCommit={(val: string) =&gt; onRenameSubmit(val, file.id)}",
            "lineNumber": 1158
          },
          {
            "text": "                onCancel={onRenameCancel}",
            "lineNumber": 1159
          },
          {
            "text": "            /&gt;",
            "lineNumber": 1160
          },
          {
            "text": "            ) : (",
            "lineNumber": 1161
          },
          {
            "text": "            &lt;div",
            "lineNumber": 1162
          },
          {
            "text": "                className=\"text-xs font-semibold text-gray-700 dark:text-gray-300 truncate w-full\"",
            "lineNumber": 1163
          },
          {
            "text": "                title={file.name}",
            "lineNumber": 1164
          },
          {
            "text": "                onDoubleClick={(e) =&gt; {",
            "lineNumber": 1165
          },
          {
            "text": "                e.stopPropagation();",
            "lineNumber": 1166
          },
          {
            "text": "                onStartRename(file.id);",
            "lineNumber": 1167
          },
          {
            "text": "                }}",
            "lineNumber": 1168
          },
          {
            "text": "            &gt;",
            "lineNumber": 1169
          },
          {
            "text": "                {file.name}",
            "lineNumber": 1170
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 1171
          },
          {
            "text": "            )}",
            "lineNumber": 1172
          },
          {
            "text": "};",
            "lineNumber": 1179
          }
        ]
      },
      "score": 0.37943410873413086
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nasync () =&gt; {\n\n        const exitAction = exitActionRef.current;\n\n        if (exitAction === 'minimize') {\n          // Minimize to tray\n          await hideWindow();\n        } else if (exitAction === 'exit') {\n          // Exit immediately\n          await exitApp();\n        } else {\n          // Ask user (default behavior)\n          setShowCloseConfirmation(true);\n        }\n      }} t={t} showWindowControls={!showSplash} /&gt;\n      &lt;div className=\"flex-1 flex overflow-hidden relative transition-all duration-300 ease-[cubic-bezier(0.25,0.1,0.25,1)]\"&gt;\n        &lt;div className={&#96;bg-gray-50 dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 flex flex-col transition-all duration-300 shrink-0 z-40 ${state.layout.isSidebarVisible ? 'w-64 translate-x-0 opacity-100' : 'w-0 -translate-x-full opacity-0 overflow-hidden'}&#96;}&gt;\n          &lt;Sidebar roots={state.roots} files={state.files} people={state.people} customTags={state.customTags} currentFolderId={activeTab.folderId} expandedIds={state.expandedFolderIds} tasks={state.tasks} onToggle={handleToggleFolder} onNavigate={handleNavigateFolder} onTagSelect={enterTagView} onNavigateAllTags={enterTagsOverview} onPersonSelect={enterPersonView} onNavigateAllPeople={enterPeopleOverview} onContextMenu={handleContextMenu} onDrop={(targetId, sourceIds) =&gt; handleMoveFiles(sourceIds, targetId)} onDropOnTag={handleDropOnTag} isCreatingTag={isCreatingTag} onStartCreateTag={handleCreateNewTag} onSaveNewTag={handleSaveNewTag} onCancelCreateTag={handleCancelCreateTag} onOpenSettings={toggleSettings} onRestoreTask={onRestoreTask} onStartRenamePerson={onStartRenamePerson} onCreatePerson={handleCreatePerson} t={t} /&gt;\n        &lt;/div&gt;\n        \n        &lt;div className=\"flex-1 flex flex-col min-w-0 relative bg-white dark:bg-gray-950\"&gt;\n          {activeTab.viewingFileId &amp;&amp; (\n              (() =&gt; {\n                  const viewingFile = state.files[activeTab.viewingFileId];\n                  const parentFolder = viewingFile &amp;&amp; viewingFile.parentId ? state.files[viewingFile.parentId] : null;\n                  \n                  if (\n              }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "async () =&gt; {",
            "lineNumber": 4444
          },
          {
            "lineNumber": 4445
          },
          {
            "text": "        const exitAction = exitActionRef.current;",
            "lineNumber": 4446
          },
          {
            "lineNumber": 4447
          },
          {
            "text": "        if (exitAction === 'minimize') {",
            "lineNumber": 4448
          },
          {
            "text": "          // Minimize to tray",
            "lineNumber": 4449
          },
          {
            "text": "          await hideWindow();",
            "lineNumber": 4450
          },
          {
            "text": "        } else if (exitAction === 'exit') {",
            "lineNumber": 4451
          },
          {
            "text": "          // Exit immediately",
            "lineNumber": 4452
          },
          {
            "text": "          await exitApp();",
            "lineNumber": 4453
          },
          {
            "text": "        } else {",
            "lineNumber": 4454
          },
          {
            "text": "          // Ask user (default behavior)",
            "lineNumber": 4455
          },
          {
            "text": "          setShowCloseConfirmation(true);",
            "lineNumber": 4456
          },
          {
            "text": "        }",
            "lineNumber": 4457
          },
          {
            "text": "      }} t={t} showWindowControls={!showSplash} /&gt;",
            "lineNumber": 4458
          },
          {
            "text": "      &lt;div className=\"flex-1 flex overflow-hidden relative transition-all duration-300 ease-[cubic-bezier(0.25,0.1,0.25,1)]\"&gt;",
            "lineNumber": 4459
          },
          {
            "text": "        &lt;div className={&#96;bg-gray-50 dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 flex flex-col transition-all duration-300 shrink-0 z-40 ${state.layout.isSidebarVisible ? 'w-64 translate-x-0 opacity-100' : 'w-0 -translate-x-full opacity-0 overflow-hidden'}&#96;}&gt;",
            "lineNumber": 4460
          },
          {
            "text": "          &lt;Sidebar roots={state.roots} files={state.files} people={state.people} customTags={state.customTags} currentFolderId={activeTab.folderId} expandedIds={state.expandedFolderIds} tasks={state.tasks} onToggle={handleToggleFolder} onNavigate={handleNavigateFolder} onTagSelect={enterTagView} onNavigateAllTags={enterTagsOverview} onPersonSelect={enterPersonView} onNavigateAllPeople={enterPeopleOverview} onContextMenu={handleContextMenu} onDrop={(targetId, sourceIds) =&gt; handleMoveFiles(sourceIds, targetId)} onDropOnTag={handleDropOnTag} isCreatingTag={isCreatingTag} onStartCreateTag={handleCreateNewTag} onSaveNewTag={handleSaveNewTag} onCancelCreateTag={handleCancelCreateTag} onOpenSettings={toggleSettings} onRestoreTask={onRestoreTask} onStartRenamePerson={onStartRenamePerson} onCreatePerson={handleCreatePerson} t={t} /&gt;",
            "lineNumber": 4461
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 4462
          },
          {
            "text": "        ",
            "lineNumber": 4463
          },
          {
            "text": "        &lt;div className=\"flex-1 flex flex-col min-w-0 relative bg-white dark:bg-gray-950\"&gt;",
            "lineNumber": 4464
          },
          {
            "text": "          {activeTab.viewingFileId &amp;&amp; (",
            "lineNumber": 4465
          },
          {
            "text": "              (() =&gt; {",
            "lineNumber": 4466
          },
          {
            "text": "                  const viewingFile = state.files[activeTab.viewingFileId];",
            "lineNumber": 4467
          },
          {
            "text": "                  const parentFolder = viewingFile &amp;&amp; viewingFile.parentId ? state.files[viewingFile.parentId] : null;",
            "lineNumber": 4468
          },
          {
            "text": "                  ",
            "lineNumber": 4469
          },
          {
            "text": "                  if (",
            "lineNumber": 4470
          },
          {
            "text": "              }",
            "lineNumber": 4522
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3634531497955322
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n(targetId, paths) =&gt; {\n\n                            // 即使走到了 onDropExternal 通道，我们也把它强行扭转为“移动”操作\n                            if (isInternalDragRef.current) {\n                                handleMoveFiles(activeTab.selectedFileIds, targetId);\n                            } else {\n                                // 2. 确实是外部文件，执行复制\n                                // Tauri环境下使用Tauri API处理外部文件复制\n                                startTask('copy', [], t('tasks.copying'));\n                                showToast(t('context.copied'));\n                                handleRefresh();\n                            }\n                        }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "(targetId, paths) =&gt; {",
            "lineNumber": 4749
          },
          {
            "lineNumber": 4750
          },
          {
            "text": "                            // 即使走到了 onDropExternal 通道，我们也把它强行扭转为“移动”操作",
            "lineNumber": 4751
          },
          {
            "text": "                            if (isInternalDragRef.current) {",
            "lineNumber": 4752
          },
          {
            "text": "                                handleMoveFiles(activeTab.selectedFileIds, targetId);",
            "lineNumber": 4753
          },
          {
            "text": "                            } else {",
            "lineNumber": 4754
          },
          {
            "text": "                                // 2. 确实是外部文件，执行复制",
            "lineNumber": 4755
          },
          {
            "text": "                                // Tauri环境下使用Tauri API处理外部文件复制",
            "lineNumber": 4756
          },
          {
            "text": "                                startTask('copy', [], t('tasks.copying'));",
            "lineNumber": 4757
          },
          {
            "text": "                                showToast(t('context.copied'));",
            "lineNumber": 4758
          },
          {
            "text": "                                handleRefresh();",
            "lineNumber": 4759
          },
          {
            "text": "                            }",
            "lineNumber": 4760
          },
          {
            "text": "                        }",
            "lineNumber": 4764
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3500286042690277
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleCopyFiles = async \n() =&gt; {\nprev =&gt; (\n\n              }));\n          }, 1000);\n      }\n  };\n\n  const handleMoveFiles = async (fileIds: string[], targetFolderId: string) =&gt; {\n      console.log('[MoveFiles] Starting move operation', { fileIds, targetFolderId });\n      \n      if (fileIds.includes(targetFolderId)) {\n          console.error('[MoveFiles] Cannot move a folder into itself');\n          return;\n      }\n      \n      const targetFolder = state.files[targetFolderId];\n      console.log('[MoveFiles] Target folder info', { targetFolder: targetFolder?.name, targetPath: targetFolder?.path });\n      \n      if (!targetFolder || !targetFolder.path) {\n          console.error('[MoveFiles] Invalid target folder or path');\n          return;\n      }\n      \n      const taskId = startTask('move', fileIds, t('tasks.moving'), false); // 禁用自动进度\n      console.log('[MoveFiles] Task started with ID', taskId);\n      \n      try {\n          const separator = targetFolder.path.includes('/') ? '/' : '\\\\';\n          // Collect all unique source parent IDs\n          const sourceParentIds = new Set&lt;string&gt;();\n          let movedCount = 0;\n          \n          // Check for existing files before performing file system operations\n          console.log('[MoveFiles] Checking for existing files');\n          let existingFiles: string[] = [];\n          const targetPaths: Record&lt;string, string&gt; = {};\n          \n          for (const id of fileIds) {\n              const file = state.files[id];\n              if (file &amp;&amp; file.path) {\n                  const filename = file.name;\n                  const newPath = &#96;${targetFolder.path}${separator}${filename}&#96;;\n                  targetPaths[id] = newPath;\n                  \n                  // Check if file exists at destination\n                  try {\n                      // Use Tauri API to check if file exists\n                      const exists = await invoke&lt;boolean&gt;('file_exists', { filePath: newPath });\n                      if (exists) {\n                          existingFiles.push(filename);\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1885,
                "column": 3
              },
              "endPosition": {
                "line": 1885,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1885,
                "column": 9
              },
              "endPosition": {
                "line": 1885,
                "column": 25
              }
            },
            {
              "startPosition": {
                "line": 1885,
                "column": 37
              },
              "endPosition": {
                "line": 1886,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleCopyFiles = async ",
            "lineNumber": 1870
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 1962
          },
          {
            "text": "prev =&gt; (",
            "lineNumber": 1963
          },
          {
            "lineNumber": 1965
          },
          {
            "text": "              }));",
            "lineNumber": 1966
          },
          {
            "text": "          }, 1000);",
            "lineNumber": 1967
          },
          {
            "text": "      }",
            "lineNumber": 1968
          },
          {
            "text": "  };",
            "lineNumber": 1969
          },
          {
            "lineNumber": 1970
          },
          {
            "text": "  const handleMoveFiles = async (fileIds: string[], targetFolderId: string) =&gt; {",
            "lineNumber": 1971
          },
          {
            "text": "      console.log('[MoveFiles] Starting move operation', { fileIds, targetFolderId });",
            "lineNumber": 1972
          },
          {
            "text": "      ",
            "lineNumber": 1973
          },
          {
            "text": "      if (fileIds.includes(targetFolderId)) {",
            "lineNumber": 1974
          },
          {
            "text": "          console.error('[MoveFiles] Cannot move a folder into itself');",
            "lineNumber": 1975
          },
          {
            "text": "          return;",
            "lineNumber": 1976
          },
          {
            "text": "      }",
            "lineNumber": 1977
          },
          {
            "text": "      ",
            "lineNumber": 1978
          },
          {
            "text": "      const targetFolder = state.files[targetFolderId];",
            "lineNumber": 1979
          },
          {
            "text": "      console.log('[MoveFiles] Target folder info', { targetFolder: targetFolder?.name, targetPath: targetFolder?.path });",
            "lineNumber": 1980
          },
          {
            "text": "      ",
            "lineNumber": 1981
          },
          {
            "text": "      if (!targetFolder || !targetFolder.path) {",
            "lineNumber": 1982
          },
          {
            "text": "          console.error('[MoveFiles] Invalid target folder or path');",
            "lineNumber": 1983
          },
          {
            "text": "          return;",
            "lineNumber": 1984
          },
          {
            "text": "      }",
            "lineNumber": 1985
          },
          {
            "text": "      ",
            "lineNumber": 1986
          },
          {
            "text": "      const taskId = startTask('move', fileIds, t('tasks.moving'), false); // 禁用自动进度",
            "lineNumber": 1987
          },
          {
            "text": "      console.log('[MoveFiles] Task started with ID', taskId);",
            "lineNumber": 1988
          },
          {
            "text": "      ",
            "lineNumber": 1989
          },
          {
            "text": "      try {",
            "lineNumber": 1990
          },
          {
            "text": "          const separator = targetFolder.path.includes('/') ? '/' : '\\\\';",
            "lineNumber": 1991
          },
          {
            "text": "          // Collect all unique source parent IDs",
            "lineNumber": 1992
          },
          {
            "text": "          const sourceParentIds = new Set&lt;string&gt;();",
            "lineNumber": 1993
          },
          {
            "text": "          let movedCount = 0;",
            "lineNumber": 1994
          },
          {
            "text": "          ",
            "lineNumber": 1995
          },
          {
            "text": "          // Check for existing files before performing file system operations",
            "lineNumber": 1996
          },
          {
            "text": "          console.log('[MoveFiles] Checking for existing files');",
            "lineNumber": 1997
          },
          {
            "text": "          let existingFiles: string[] = [];",
            "lineNumber": 1998
          },
          {
            "text": "          const targetPaths: Record&lt;string, string&gt; = {};",
            "lineNumber": 1999
          },
          {
            "text": "          ",
            "lineNumber": 2000
          },
          {
            "text": "          for (const id of fileIds) {",
            "lineNumber": 2001
          },
          {
            "text": "              const file = state.files[id];",
            "lineNumber": 2002
          },
          {
            "text": "              if (file &amp;&amp; file.path) {",
            "lineNumber": 2003
          },
          {
            "text": "                  const filename = file.name;",
            "lineNumber": 2004
          },
          {
            "text": "                  const newPath = &#96;${targetFolder.path}${separator}${filename}&#96;;",
            "lineNumber": 2005
          },
          {
            "text": "                  targetPaths[id] = newPath;",
            "lineNumber": 2006
          },
          {
            "text": "                  ",
            "lineNumber": 2007
          },
          {
            "text": "                  // Check if file exists at destination",
            "lineNumber": 2008
          },
          {
            "text": "                  try {",
            "lineNumber": 2009
          },
          {
            "text": "                      // Use Tauri API to check if file exists",
            "lineNumber": 2010
          },
          {
            "text": "                      const exists = await invoke&lt;boolean&gt;('file_exists', { filePath: newPath });",
            "lineNumber": 2011
          },
          {
            "text": "                      if (exists) {",
            "lineNumber": 2012
          },
          {
            "text": "                          existingFiles.push(filename);",
            "lineNumber": 2013
          },
          {
            "text": ";",
            "lineNumber": 2175
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.33586061000823975
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 152
          },
          "endPosition": {
            "line": 291,
            "column": 2
          }
        },
        "contents": "const extractPalette = async \n(resolve) =&gt; {\n() =&gt; {\n\n                \n                // Pass 2: Relax slightly only if we have very few colors\n                if (finalPalette.length &lt; 5) {\n                    for (const c of sorted) {\n                        if (finalPalette.length &gt;= 8) break;\n                        addColor(c, 30);\n                    }\n                }\n                \n                // We DO NOT force 8 colors. If we only found 4 distinct ones, we return 4.\n\n                resolve(finalPalette.map(p =&gt; p.hex));\n                \n            } catch(e) {\n                console.error(\"Pixel access failed\", e);\n                resolve([]);\n            }\n        };\n        img.onerror = () =&gt; resolve([]);\n    });\n};\n\nconst CategorySelector = ({ current, onChange, t }: any) =&gt; (\n  &lt;div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-800\"&gt;\n      &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2\"&gt;{t('meta.folderCategory')}&lt;/div&gt;\n      &lt;div className=\"flex bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl gap-2\"&gt;\n          {['general', 'book', 'sequence'].map((cat) =&gt; {\n              const isActive = current === cat;\n              return (\n                  &lt;button\n                      key={cat}\n                      onClick={() =&gt; onChange(cat)}\n                      className={&#96;flex-1 flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all ${\n                          isActive\n                          ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-md ring-1 ring-black/5 dark:ring-white/10' \n                          : 'text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-100'\n                      }&#96;}\n                  &gt;\n                      {cat === 'general' &amp;&amp; &lt;Folder size={20} className={&#96;mb-1.5 ${isActive ? 'fill-blue-100 dark:fill-blue-900/30' : ''}&#96;}/&gt;}\n                      {cat === 'book' &amp;&amp; &lt;Book size={20} className={&#96;mb-1.5 ${isActive ? 'fill-amber-100 dark:fill-amber-900/30' : ''}&#96;}/&gt;}\n                      {cat === 'sequence' &amp;&amp; &lt;Film size={20} className={&#96;mb-1.5 ${isActive ? 'fill-purple-100 dark:fill-purple-900/30' : ''}&#96;}/&gt;}\n                      {t(&#96;meta.cat${cat.charAt(0).toUpperCase() + cat.slice(1)}&#96;)}\n                  &lt;/button&gt;\n              );\n          })}\n      &lt;/div&gt;\n  &lt;/div&gt;\n);",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const extractPalette = async ",
            "lineNumber": 153
          },
          {
            "text": "(resolve) =&gt; {",
            "lineNumber": 154
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 158
          },
          {
            "lineNumber": 244
          },
          {
            "text": "                ",
            "lineNumber": 245
          },
          {
            "text": "                // Pass 2: Relax slightly only if we have very few colors",
            "lineNumber": 246
          },
          {
            "text": "                if (finalPalette.length &lt; 5) {",
            "lineNumber": 247
          },
          {
            "text": "                    for (const c of sorted) {",
            "lineNumber": 248
          },
          {
            "text": "                        if (finalPalette.length &gt;= 8) break;",
            "lineNumber": 249
          },
          {
            "text": "                        addColor(c, 30);",
            "lineNumber": 250
          },
          {
            "text": "                    }",
            "lineNumber": 251
          },
          {
            "text": "                }",
            "lineNumber": 252
          },
          {
            "text": "                ",
            "lineNumber": 253
          },
          {
            "text": "                // We DO NOT force 8 colors. If we only found 4 distinct ones, we return 4.",
            "lineNumber": 254
          },
          {
            "lineNumber": 255
          },
          {
            "text": "                resolve(finalPalette.map(p =&gt; p.hex));",
            "lineNumber": 256
          },
          {
            "text": "                ",
            "lineNumber": 257
          },
          {
            "text": "            } catch(e) {",
            "lineNumber": 258
          },
          {
            "text": "                console.error(\"Pixel access failed\", e);",
            "lineNumber": 259
          },
          {
            "text": "                resolve([]);",
            "lineNumber": 260
          },
          {
            "text": "            }",
            "lineNumber": 261
          },
          {
            "text": "        };",
            "lineNumber": 262
          },
          {
            "text": "        img.onerror = () =&gt; resolve([]);",
            "lineNumber": 263
          },
          {
            "text": "    });",
            "lineNumber": 264
          },
          {
            "text": "};",
            "lineNumber": 265
          },
          {
            "lineNumber": 266
          },
          {
            "text": "const CategorySelector = ({ current, onChange, t }: any) =&gt; (",
            "lineNumber": 267
          },
          {
            "text": "  &lt;div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-800\"&gt;",
            "lineNumber": 268
          },
          {
            "text": "      &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2\"&gt;{t('meta.folderCategory')}&lt;/div&gt;",
            "lineNumber": 269
          },
          {
            "text": "      &lt;div className=\"flex bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl gap-2\"&gt;",
            "lineNumber": 270
          },
          {
            "text": "          {['general', 'book', 'sequence'].map((cat) =&gt; {",
            "lineNumber": 271
          },
          {
            "text": "              const isActive = current === cat;",
            "lineNumber": 272
          },
          {
            "text": "              return (",
            "lineNumber": 273
          },
          {
            "text": "                  &lt;button",
            "lineNumber": 274
          },
          {
            "text": "                      key={cat}",
            "lineNumber": 275
          },
          {
            "text": "                      onClick={() =&gt; onChange(cat)}",
            "lineNumber": 276
          },
          {
            "text": "                      className={&#96;flex-1 flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all ${",
            "lineNumber": 277
          },
          {
            "text": "                          isActive",
            "lineNumber": 278
          },
          {
            "text": "                          ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-md ring-1 ring-black/5 dark:ring-white/10' ",
            "lineNumber": 279
          },
          {
            "text": "                          : 'text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-100'",
            "lineNumber": 280
          },
          {
            "text": "                      }&#96;}",
            "lineNumber": 281
          },
          {
            "text": "                  &gt;",
            "lineNumber": 282
          },
          {
            "text": "                      {cat === 'general' &amp;&amp; &lt;Folder size={20} className={&#96;mb-1.5 ${isActive ? 'fill-blue-100 dark:fill-blue-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 283
          },
          {
            "text": "                      {cat === 'book' &amp;&amp; &lt;Book size={20} className={&#96;mb-1.5 ${isActive ? 'fill-amber-100 dark:fill-amber-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 284
          },
          {
            "text": "                      {cat === 'sequence' &amp;&amp; &lt;Film size={20} className={&#96;mb-1.5 ${isActive ? 'fill-purple-100 dark:fill-purple-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 285
          },
          {
            "text": "                      {t(&#96;meta.cat${cat.charAt(0).toUpperCase() + cat.slice(1)}&#96;)}",
            "lineNumber": 286
          },
          {
            "text": "                  &lt;/button&gt;",
            "lineNumber": 287
          },
          {
            "text": "              );",
            "lineNumber": 288
          },
          {
            "text": "          })}",
            "lineNumber": 289
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 290
          },
          {
            "text": "  &lt;/div&gt;",
            "lineNumber": 291
          },
          {
            "text": ");",
            "lineNumber": 292
          }
        ]
      },
      "score": 0.32463014125823975
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst chartData = () =&gt; {\n\n \n            color: typeColors['FOLDER'] || defaultColor\n        });\n    }\n    \n    Object.entries(folderDetails.types).forEach(([type, count]) =&gt; {\n        data.push({ \n            label: type, \n            value: count, \n            color: typeColors[type] || defaultColor\n        });\n    });\n    \n    return data.sort((a, b) =&gt; b.value - a.value);\n  }, [folderDetails, t]);\n  \n  const personStats = useMemo(() =&gt; {\n    if (!person) return null;\n    let totalSize = 0;\n    let count = 0;\n    Object.values(files).forEach((f: FileNode) =&gt; {\n        if (f.type === FileType.IMAGE &amp;&amp; f.aiData?.faces.some(face =&gt; face.personId === person.id)) {\n            totalSize += f.meta?.sizeKb || 0;\n            count++;\n        }\n    });\n    return { totalSize, count };\n  },;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "const chartData = () =&gt; {",
            "lineNumber": 642
          },
          {
            "lineNumber": 647
          },
          {
            "text": " ",
            "lineNumber": 649
          },
          {
            "text": "            color: typeColors['FOLDER'] || defaultColor",
            "lineNumber": 650
          },
          {
            "text": "        });",
            "lineNumber": 651
          },
          {
            "text": "    }",
            "lineNumber": 652
          },
          {
            "text": "    ",
            "lineNumber": 653
          },
          {
            "text": "    Object.entries(folderDetails.types).forEach(([type, count]) =&gt; {",
            "lineNumber": 654
          },
          {
            "text": "        data.push({ ",
            "lineNumber": 655
          },
          {
            "text": "            label: type, ",
            "lineNumber": 656
          },
          {
            "text": "            value: count, ",
            "lineNumber": 657
          },
          {
            "text": "            color: typeColors[type] || defaultColor",
            "lineNumber": 658
          },
          {
            "text": "        });",
            "lineNumber": 659
          },
          {
            "text": "    });",
            "lineNumber": 660
          },
          {
            "text": "    ",
            "lineNumber": 661
          },
          {
            "text": "    return data.sort((a, b) =&gt; b.value - a.value);",
            "lineNumber": 662
          },
          {
            "text": "  }, [folderDetails, t]);",
            "lineNumber": 663
          },
          {
            "text": "  ",
            "lineNumber": 664
          },
          {
            "text": "  const personStats = useMemo(() =&gt; {",
            "lineNumber": 665
          },
          {
            "text": "    if (!person) return null;",
            "lineNumber": 666
          },
          {
            "text": "    let totalSize = 0;",
            "lineNumber": 667
          },
          {
            "text": "    let count = 0;",
            "lineNumber": 668
          },
          {
            "text": "    Object.values(files).forEach((f: FileNode) =&gt; {",
            "lineNumber": 669
          },
          {
            "text": "        if (f.type === FileType.IMAGE &amp;&amp; f.aiData?.faces.some(face =&gt; face.personId === person.id)) {",
            "lineNumber": 670
          },
          {
            "text": "            totalSize += f.meta?.sizeKb || 0;",
            "lineNumber": 671
          },
          {
            "text": "            count++;",
            "lineNumber": 672
          },
          {
            "text": "        }",
            "lineNumber": 673
          },
          {
            "text": "    });",
            "lineNumber": 674
          },
          {
            "text": "    return { totalSize, count };",
            "lineNumber": 675
          },
          {
            "text": "  },;",
            "lineNumber": 676
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.3194284439086914
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\types.ts",
        "range": {
          "startPosition": {
            "line": 183
          },
          "endPosition": {
            "line": 216,
            "column": 1
          }
        },
        "contents": "export interface HistoryItem {\n;\n  viewMode: 'browser' | 'tags-overview' | 'people-overview';\n  searchQuery: string;\n  searchScope: SearchScope;\n  activeTags: string[];\n  activePersonId: string | null;\n  aiFilter?: AiSearchFilter | null;\n  scrollTop?: number;\n}\n\nexport interface TabState {\n  id: string;\n  folderId: string;\n  viewingFileId: string | null;\n  viewMode: 'browser' | 'tags-overview' | 'people-overview'; \n  layoutMode: LayoutMode;\n  searchQuery: string;\n  searchScope: SearchScope;\n  aiFilter?: AiSearchFilter | null;\n  activeTags: string[];\n  activePersonId: string | null;\n  dateFilter: DateFilter;\n  selectedFileIds: string[];\n  lastSelectedId: string | null;\n  selectedTagIds: string[];\n  selectedPersonIds: string[];\n;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export interface HistoryItem {",
            "lineNumber": 184,
            "isSignature": true
          },
          {
            "text": ";",
            "lineNumber": 186
          },
          {
            "text": "  viewMode: 'browser' | 'tags-overview' | 'people-overview';",
            "lineNumber": 187
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 188
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 189
          },
          {
            "text": "  activeTags: string[];",
            "lineNumber": 190
          },
          {
            "text": "  activePersonId: string | null;",
            "lineNumber": 191
          },
          {
            "text": "  aiFilter?: AiSearchFilter | null;",
            "lineNumber": 192
          },
          {
            "text": "  scrollTop?: number;",
            "lineNumber": 193,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 194,
            "isSignature": true
          },
          {
            "lineNumber": 195
          },
          {
            "text": "export interface TabState {",
            "lineNumber": 196,
            "isSignature": true
          },
          {
            "text": "  id: string;",
            "lineNumber": 197
          },
          {
            "text": "  folderId: string;",
            "lineNumber": 198
          },
          {
            "text": "  viewingFileId: string | null;",
            "lineNumber": 199
          },
          {
            "text": "  viewMode: 'browser' | 'tags-overview' | 'people-overview'; ",
            "lineNumber": 200
          },
          {
            "text": "  layoutMode: LayoutMode;",
            "lineNumber": 201
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 202
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 203
          },
          {
            "text": "  aiFilter?: AiSearchFilter | null;",
            "lineNumber": 204
          },
          {
            "text": "  activeTags: string[];",
            "lineNumber": 205
          },
          {
            "text": "  activePersonId: string | null;",
            "lineNumber": 206
          },
          {
            "text": "  dateFilter: DateFilter;",
            "lineNumber": 207
          },
          {
            "text": "  selectedFileIds: string[];",
            "lineNumber": 208
          },
          {
            "text": "  lastSelectedId: string | null;",
            "lineNumber": 209
          },
          {
            "text": "  selectedTagIds: string[];",
            "lineNumber": 210
          },
          {
            "text": "  selectedPersonIds: string[];",
            "lineNumber": 211
          },
          {
            "text": ";",
            "lineNumber": 216,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 217,
            "isSignature": true
          }
        ]
      },
      "score": 0.31728529930114746
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\n\n                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}\n                          onPrev={() =&gt; handleViewerNavigate('prev')}\n                          onNavigateBack={goBack}\n                          onNavigateForward={goForward}\n                          canGoBack={activeTab.history.currentIndex &gt; 0}\n                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}\n                          onDelete={(id) =&gt; requestDelete([id])}\n                          onViewInExplorer={handleViewInExplorer}\n                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}\n                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}\n                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}\n                          searchQuery={activeTab.searchQuery}\n                          onSearch={handleViewerSearch}\n                          searchScope={activeTab.searchScope}\n                          onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })}\n                          onUpdateSlideshowConfig={(cfg) =&gt; setState(s =&gt; ({ ...s, slideshowConfig: cfg }))}\n                          onPasteTags={(id) =&gt; handlePasteTags([id])}\n                          onEditTags={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'edit-tags', data: { fileId: activeTab.viewingFileId } } }))}\n                          onCopyTags={() =&gt; handleCopyTags([activeTab.viewingFileId!])}\n                          onAIAnalysis={(id) =&gt; handleAIAnalysis([id])}\n                          isAISearchEnabled={state.settings.search.isAISearchEnabled}\n                          onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}\n                          t={t}\n                          activeTab={activeTab}\n                      /&gt;\n                  );\n              })()\n          )}\n          {!activeTab.viewingFileId &amp;&amp; (\n            &lt;&gt;\n              &lt;TopBar \n                activeTab={activeTab} \n                state={state}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4466
          },
          {
            "lineNumber": 4495
          },
          {
            "text": "                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}",
            "lineNumber": 4496
          },
          {
            "text": "                          onPrev={() =&gt; handleViewerNavigate('prev')}",
            "lineNumber": 4497
          },
          {
            "text": "                          onNavigateBack={goBack}",
            "lineNumber": 4498
          },
          {
            "text": "                          onNavigateForward={goForward}",
            "lineNumber": 4499
          },
          {
            "text": "                          canGoBack={activeTab.history.currentIndex &gt; 0}",
            "lineNumber": 4500
          },
          {
            "text": "                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}",
            "lineNumber": 4501
          },
          {
            "text": "                          onDelete={(id) =&gt; requestDelete([id])}",
            "lineNumber": 4502
          },
          {
            "text": "                          onViewInExplorer={handleViewInExplorer}",
            "lineNumber": 4503
          },
          {
            "text": "                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4504
          },
          {
            "text": "                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4505
          },
          {
            "text": "                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}",
            "lineNumber": 4506
          },
          {
            "text": "                          searchQuery={activeTab.searchQuery}",
            "lineNumber": 4507
          },
          {
            "text": "                          onSearch={handleViewerSearch}",
            "lineNumber": 4508
          },
          {
            "text": "                          searchScope={activeTab.searchScope}",
            "lineNumber": 4509
          },
          {
            "text": "                          onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })}",
            "lineNumber": 4510
          },
          {
            "text": "                          onUpdateSlideshowConfig={(cfg) =&gt; setState(s =&gt; ({ ...s, slideshowConfig: cfg }))}",
            "lineNumber": 4511
          },
          {
            "text": "                          onPasteTags={(id) =&gt; handlePasteTags([id])}",
            "lineNumber": 4512
          },
          {
            "text": "                          onEditTags={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'edit-tags', data: { fileId: activeTab.viewingFileId } } }))}",
            "lineNumber": 4513
          },
          {
            "text": "                          onCopyTags={() =&gt; handleCopyTags([activeTab.viewingFileId!])}",
            "lineNumber": 4514
          },
          {
            "text": "                          onAIAnalysis={(id) =&gt; handleAIAnalysis([id])}",
            "lineNumber": 4515
          },
          {
            "text": "                          isAISearchEnabled={state.settings.search.isAISearchEnabled}",
            "lineNumber": 4516
          },
          {
            "text": "                          onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}",
            "lineNumber": 4517
          },
          {
            "text": "                          t={t}",
            "lineNumber": 4518
          },
          {
            "text": "                          activeTab={activeTab}",
            "lineNumber": 4519
          },
          {
            "text": "                      /&gt;",
            "lineNumber": 4520
          },
          {
            "text": "                  );",
            "lineNumber": 4521
          },
          {
            "text": "              })()",
            "lineNumber": 4522
          },
          {
            "text": "          )}",
            "lineNumber": 4523
          },
          {
            "text": "          {!activeTab.viewingFileId &amp;&amp; (",
            "lineNumber": 4524
          },
          {
            "text": "            &lt;&gt;",
            "lineNumber": 4525
          },
          {
            "text": "              &lt;TopBar ",
            "lineNumber": 4526
          },
          {
            "text": "                activeTab={activeTab} ",
            "lineNumber": 4527
          },
          {
            "text": "                state={state}",
            "lineNumber": 4528
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.30228090286254883
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 467
          },
          "endPosition": {
            "line": 584,
            "column": 1
          }
        },
        "contents": "export const Sidebar: React.FC&lt;{\n  roots: string[];\n  files: Record&lt;string, FileNode&gt;;\n  people: Record&lt;string, Person&gt;;\n  customTags: string[];\n  currentFolderId: string;\n  expandedIds: string[];\n  tasks?: TaskProgress[];\n  onToggle: (id: string) =&gt; void;\n  onNavigate: (id: string) =&gt; void;\n  onTagSelect: (tag: string) =&gt; void;\n  onNavigateAllTags: () =&gt; void;\n  onPersonSelect: (personId: string) =&gt; void;\n  onNavigateAllPeople: () =&gt; void;\n  onContextMenu: (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'person', id: string) =&gt; void;\n  onDrop: (targetId: string, sourceIds: string[]) =&gt; void;\n  onDropOnTag: (tag: string, sourceIds: string[]) =&gt; void;\n  isCreatingTag: boolean;\n  onStartCreateTag: () =&gt; void;\n  onSaveNewTag: (tag: string) =&gt; void;\n  onCancelCreateTag: () =&gt; void;\n  onOpenSettings: () =&gt; void;\n  onRestoreTask: (taskId: string) =&gt; void;\n  onStartRenamePerson: (personId: string) =&gt; void;\n  onCreatePerson: () =&gt; void;\n  t: (key: string) =&gt; string;\n}&gt; =  {\n  \n  const minimizedTasks = tasks ? tasks.filter(task =&gt; task.minimized &amp;&amp; task.status === 'running') : [];\n\n  return (\n    &lt;div className=\"w-full h-full flex flex-col\"&gt;\n      &lt;div className=\"p-3 font-bold text-gray-500 dark:text-gray-400 text-xs uppercase tracking-wider border-b border-gray-200 dark:border-gray-800\"&gt;\n        {t('sidebar.catalog')}\n      &lt;/div&gt;\n      &lt;div className=\"flex-1 overflow-y-auto scrollbar-thin\"&gt;\n        {roots.map(rootId =&gt; (\n          &lt;TreeNode \n            key={rootId}\n            files={files}\n            nodeId={rootId}\n            currentFolderId={currentFolderId}\n            expandedIds={expandedIds}\n            onToggle={onToggle}\n            onNavigate={onNavigate}\n            onContextMenu={onContextMenu}\n            onDrop={onDrop}\n          /&gt;\n        ))}\n        \n        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;\n        \n        &lt;PeopleSection \n           people={people}\n           files={files}\n           onPersonSelect={onPersonSelect}\n           onNavigateAllPeople={onNavigateAllPeople}\n           onContextMenu={onContextMenu}\n           onStartRenamePerson={onStartRenamePerson}\n           onCreatePerson={onCreatePerson}\n           t={t}\n        /&gt;\n\n        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;\n        \n        &lt;TagSection \n          files={files} \n          customTags={customTags}\n          onTagSelect={onTagSelect} \n          onNavigateAllTags={onNavigateAllTags} \n          onContextMenu={onContextMenu}\n          isCreatingTag={isCreatingTag}\n          onStartCreateTag={onStartCreateTag}\n          onSaveNewTag={onSaveNewTag}\n          onCancelCreateTag={onCancelCreateTag}\n          onDropOnTag={onDropOnTag}\n          t={t}\n        /&gt;\n      &lt;/div&gt;\n      \n      {minimizedTasks.length &gt; 0 &amp;&amp;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 468,
                "column": 1
              },
              "endPosition": {
                "line": 468,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 468,
                "column": 8
              },
              "endPosition": {
                "line": 468,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 468,
                "column": 14
              },
              "endPosition": {
                "line": 494,
                "column": 6
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const Sidebar: React.FC&lt;{",
            "lineNumber": 468
          },
          {
            "text": "  roots: string[];",
            "lineNumber": 469
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 470
          },
          {
            "text": "  people: Record&lt;string, Person&gt;;",
            "lineNumber": 471
          },
          {
            "text": "  customTags: string[];",
            "lineNumber": 472
          },
          {
            "text": "  currentFolderId: string;",
            "lineNumber": 473
          },
          {
            "text": "  expandedIds: string[];",
            "lineNumber": 474
          },
          {
            "text": "  tasks?: TaskProgress[];",
            "lineNumber": 475
          },
          {
            "text": "  onToggle: (id: string) =&gt; void;",
            "lineNumber": 476
          },
          {
            "text": "  onNavigate: (id: string) =&gt; void;",
            "lineNumber": 477
          },
          {
            "text": "  onTagSelect: (tag: string) =&gt; void;",
            "lineNumber": 478
          },
          {
            "text": "  onNavigateAllTags: () =&gt; void;",
            "lineNumber": 479
          },
          {
            "text": "  onPersonSelect: (personId: string) =&gt; void;",
            "lineNumber": 480
          },
          {
            "text": "  onNavigateAllPeople: () =&gt; void;",
            "lineNumber": 481
          },
          {
            "text": "  onContextMenu: (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'person', id: string) =&gt; void;",
            "lineNumber": 482
          },
          {
            "text": "  onDrop: (targetId: string, sourceIds: string[]) =&gt; void;",
            "lineNumber": 483
          },
          {
            "text": "  onDropOnTag: (tag: string, sourceIds: string[]) =&gt; void;",
            "lineNumber": 484
          },
          {
            "text": "  isCreatingTag: boolean;",
            "lineNumber": 485
          },
          {
            "text": "  onStartCreateTag: () =&gt; void;",
            "lineNumber": 486
          },
          {
            "text": "  onSaveNewTag: (tag: string) =&gt; void;",
            "lineNumber": 487
          },
          {
            "text": "  onCancelCreateTag: () =&gt; void;",
            "lineNumber": 488
          },
          {
            "text": "  onOpenSettings: () =&gt; void;",
            "lineNumber": 489
          },
          {
            "text": "  onRestoreTask: (taskId: string) =&gt; void;",
            "lineNumber": 490
          },
          {
            "text": "  onStartRenamePerson: (personId: string) =&gt; void;",
            "lineNumber": 491
          },
          {
            "text": "  onCreatePerson: () =&gt; void;",
            "lineNumber": 492
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 493
          },
          {
            "text": "}&gt; =  {",
            "lineNumber": 494
          },
          {
            "text": "  ",
            "lineNumber": 495
          },
          {
            "text": "  const minimizedTasks = tasks ? tasks.filter(task =&gt; task.minimized &amp;&amp; task.status === 'running') : [];",
            "lineNumber": 496
          },
          {
            "lineNumber": 497
          },
          {
            "text": "  return (",
            "lineNumber": 498
          },
          {
            "text": "    &lt;div className=\"w-full h-full flex flex-col\"&gt;",
            "lineNumber": 499
          },
          {
            "text": "      &lt;div className=\"p-3 font-bold text-gray-500 dark:text-gray-400 text-xs uppercase tracking-wider border-b border-gray-200 dark:border-gray-800\"&gt;",
            "lineNumber": 500
          },
          {
            "text": "        {t('sidebar.catalog')}",
            "lineNumber": 501
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 502
          },
          {
            "text": "      &lt;div className=\"flex-1 overflow-y-auto scrollbar-thin\"&gt;",
            "lineNumber": 503
          },
          {
            "text": "        {roots.map(rootId =&gt; (",
            "lineNumber": 504
          },
          {
            "text": "          &lt;TreeNode ",
            "lineNumber": 505
          },
          {
            "text": "            key={rootId}",
            "lineNumber": 506
          },
          {
            "text": "            files={files}",
            "lineNumber": 507
          },
          {
            "text": "            nodeId={rootId}",
            "lineNumber": 508
          },
          {
            "text": "            currentFolderId={currentFolderId}",
            "lineNumber": 509
          },
          {
            "text": "            expandedIds={expandedIds}",
            "lineNumber": 510
          },
          {
            "text": "            onToggle={onToggle}",
            "lineNumber": 511
          },
          {
            "text": "            onNavigate={onNavigate}",
            "lineNumber": 512
          },
          {
            "text": "            onContextMenu={onContextMenu}",
            "lineNumber": 513
          },
          {
            "text": "            onDrop={onDrop}",
            "lineNumber": 514
          },
          {
            "text": "          /&gt;",
            "lineNumber": 515
          },
          {
            "text": "        ))}",
            "lineNumber": 516
          },
          {
            "text": "        ",
            "lineNumber": 517
          },
          {
            "text": "        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;",
            "lineNumber": 518
          },
          {
            "text": "        ",
            "lineNumber": 519
          },
          {
            "text": "        &lt;PeopleSection ",
            "lineNumber": 520
          },
          {
            "text": "           people={people}",
            "lineNumber": 521
          },
          {
            "text": "           files={files}",
            "lineNumber": 522
          },
          {
            "text": "           onPersonSelect={onPersonSelect}",
            "lineNumber": 523
          },
          {
            "text": "           onNavigateAllPeople={onNavigateAllPeople}",
            "lineNumber": 524
          },
          {
            "text": "           onContextMenu={onContextMenu}",
            "lineNumber": 525
          },
          {
            "text": "           onStartRenamePerson={onStartRenamePerson}",
            "lineNumber": 526
          },
          {
            "text": "           onCreatePerson={onCreatePerson}",
            "lineNumber": 527
          },
          {
            "text": "           t={t}",
            "lineNumber": 528
          },
          {
            "text": "        /&gt;",
            "lineNumber": 529
          },
          {
            "lineNumber": 530
          },
          {
            "text": "        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;",
            "lineNumber": 531
          },
          {
            "text": "        ",
            "lineNumber": 532
          },
          {
            "text": "        &lt;TagSection ",
            "lineNumber": 533
          },
          {
            "text": "          files={files} ",
            "lineNumber": 534
          },
          {
            "text": "          customTags={customTags}",
            "lineNumber": 535
          },
          {
            "text": "          onTagSelect={onTagSelect} ",
            "lineNumber": 536
          },
          {
            "text": "          onNavigateAllTags={onNavigateAllTags} ",
            "lineNumber": 537
          },
          {
            "text": "          onContextMenu={onContextMenu}",
            "lineNumber": 538
          },
          {
            "text": "          isCreatingTag={isCreatingTag}",
            "lineNumber": 539
          },
          {
            "text": "          onStartCreateTag={onStartCreateTag}",
            "lineNumber": 540
          },
          {
            "text": "          onSaveNewTag={onSaveNewTag}",
            "lineNumber": 541
          },
          {
            "text": "          onCancelCreateTag={onCancelCreateTag}",
            "lineNumber": 542
          },
          {
            "text": "          onDropOnTag={onDropOnTag}",
            "lineNumber": 543
          },
          {
            "text": "          t={t}",
            "lineNumber": 544
          },
          {
            "text": "        /&gt;",
            "lineNumber": 545
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 546
          },
          {
            "text": "      ",
            "lineNumber": 547
          },
          {
            "text": "      {minimizedTasks.length &gt; 0 &amp;&amp;",
            "lineNumber": 548
          },
          {
            "text": ";",
            "lineNumber": 585
          }
        ]
      },
      "score": 0.3006289005279541
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst handleRemoveTag = \nid =&gt; {\n\n              }\n          });\n      } else if (file) {\n          onUpdate(file.id, { tags: file.tags.filter(t =&gt; t !== tag) });\n      }\n  };\n\n  const copyToClipboard = (text: string) =&gt; {\n      navigator.clipboard.writeText(text);\n      setToast({ msg: t('context.copied'), visible: true });\n      setTimeout(() =&gt; setToast({ msg: '', visible: false }), 2000);\n  };\n\n  const handleCategoryChange = (category: 'general' | 'book' | 'sequence') =&gt; {\n      if (isMulti) {\n          selectedFileIds.forEach(id =&gt; {\n              if (files[id]?.type === FileType.FOLDER) {\n                  onUpdate(id, { category });\n              }\n          });\n      } else if (file &amp;&amp; file.type === FileType.FOLDER) {\n          onUpdate(file.id, { category });\n      }\n  };\n\n  if (person) {\n      const coverFile = files[person.coverFileId];\n      const coverUrl = coverFile?.path ? convertFileSrc(coverFile.path) : null;\n\n      return (\n        &lt;div className=\"h-full flex flex-col bg-white dark:bg-gray-900 overflow-y-auto custom-scrollbar relative\"&gt;\n          \n          {/* Hero Header */}\n          &lt;div className=\"relative\"&gt;\n             {/* Blurred Background */}\n             &lt;div className=\"absolute inset-0 overflow-hidden h-40 z-0\"&gt;\n                {coverUrl ? (\n                    &lt;img src={coverUrl}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "const handleRemoveTag = ",
            "lineNumber": 766
          },
          {
            "text": "id =&gt; {",
            "lineNumber": 768
          },
          {
            "lineNumber": 771
          },
          {
            "text": "              }",
            "lineNumber": 772
          },
          {
            "text": "          });",
            "lineNumber": 773
          },
          {
            "text": "      } else if (file) {",
            "lineNumber": 774
          },
          {
            "text": "          onUpdate(file.id, { tags: file.tags.filter(t =&gt; t !== tag) });",
            "lineNumber": 775
          },
          {
            "text": "      }",
            "lineNumber": 776
          },
          {
            "text": "  };",
            "lineNumber": 777
          },
          {
            "lineNumber": 778
          },
          {
            "text": "  const copyToClipboard = (text: string) =&gt; {",
            "lineNumber": 779
          },
          {
            "text": "      navigator.clipboard.writeText(text);",
            "lineNumber": 780
          },
          {
            "text": "      setToast({ msg: t('context.copied'), visible: true });",
            "lineNumber": 781
          },
          {
            "text": "      setTimeout(() =&gt; setToast({ msg: '', visible: false }), 2000);",
            "lineNumber": 782
          },
          {
            "text": "  };",
            "lineNumber": 783
          },
          {
            "lineNumber": 784
          },
          {
            "text": "  const handleCategoryChange = (category: 'general' | 'book' | 'sequence') =&gt; {",
            "lineNumber": 785
          },
          {
            "text": "      if (isMulti) {",
            "lineNumber": 786
          },
          {
            "text": "          selectedFileIds.forEach(id =&gt; {",
            "lineNumber": 787
          },
          {
            "text": "              if (files[id]?.type === FileType.FOLDER) {",
            "lineNumber": 788
          },
          {
            "text": "                  onUpdate(id, { category });",
            "lineNumber": 789
          },
          {
            "text": "              }",
            "lineNumber": 790
          },
          {
            "text": "          });",
            "lineNumber": 791
          },
          {
            "text": "      } else if (file &amp;&amp; file.type === FileType.FOLDER) {",
            "lineNumber": 792
          },
          {
            "text": "          onUpdate(file.id, { category });",
            "lineNumber": 793
          },
          {
            "text": "      }",
            "lineNumber": 794
          },
          {
            "text": "  };",
            "lineNumber": 795
          },
          {
            "lineNumber": 796
          },
          {
            "text": "  if (person) {",
            "lineNumber": 797
          },
          {
            "text": "      const coverFile = files[person.coverFileId];",
            "lineNumber": 798
          },
          {
            "text": "      const coverUrl = coverFile?.path ? convertFileSrc(coverFile.path) : null;",
            "lineNumber": 799
          },
          {
            "lineNumber": 800
          },
          {
            "text": "      return (",
            "lineNumber": 801
          },
          {
            "text": "        &lt;div className=\"h-full flex flex-col bg-white dark:bg-gray-900 overflow-y-auto custom-scrollbar relative\"&gt;",
            "lineNumber": 802
          },
          {
            "text": "          ",
            "lineNumber": 803
          },
          {
            "text": "          {/* Hero Header */}",
            "lineNumber": 804
          },
          {
            "text": "          &lt;div className=\"relative\"&gt;",
            "lineNumber": 805
          },
          {
            "text": "             {/* Blurred Background */}",
            "lineNumber": 806
          },
          {
            "text": "             &lt;div className=\"absolute inset-0 overflow-hidden h-40 z-0\"&gt;",
            "lineNumber": 807
          },
          {
            "text": "                {coverUrl ? (",
            "lineNumber": 808
          },
          {
            "text": "                    &lt;img src={coverUrl}",
            "lineNumber": 809
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.2804017961025238
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1329
          },
          "endPosition": {
            "line": 1535,
            "column": 1
          }
        },
        "contents": "const useLayout = \n() =&gt; {\n\n        const minColWidth = thumbnailSize;\n        const cols = Math.max(1, Math.floor((finalAvailableWidth + GAP) / (minColWidth + GAP)));\n        const itemWidth = (finalAvailableWidth - (cols - 1) * GAP) / cols;\n        const itemHeight = itemWidth + 60; // Extra space for text\n\n        itemsList.forEach((person, index) =&gt; {\n            const row = Math.floor(index / cols);\n            const col = index % cols;\n            layout.push({\n                id: person.id,\n                x: PADDING + col * (itemWidth + GAP),\n                y: PADDING + row * (itemHeight + GAP),\n                width: itemWidth,\n                height: itemHeight\n            });\n        });\n        const rows = Math.ceil(itemsList.length / cols);\n        totalHeight = PADDING + rows * (itemHeight + GAP);\n    } \n\n    return { layout, totalHeight };\n  }, [items, files, layoutMode, containerWidth, thumbnailSize, viewMode, aspectRatios, people]);\n};\n\ninterface FileGridProps {\n  displayFileIds: string[];\n  files: Record&lt;string, FileNode&gt;;\n  activeTab: TabState;\n  renamingId: string | null;\n  thumbnailSize: number;\n  hoverPlayingId: string | null;\n  onSetHoverPlayingId: (id: string | null) =&gt; void;\n  onFileClick: (e: React.MouseEvent, id: string) =&gt; void;\n  onFileDoubleClick: (id: string) =&gt; void;\n  onContextMenu: (e: React.MouseEvent, id: string) =&gt; void;\n  onRenameSubmit: (val: string, id: string) =&gt; void;\n  onRenameCancel: () =&gt; void;\n  onStartRename: (id: string) =&gt; void;\n  onDragStart\n;\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const useLayout = ",
            "lineNumber": 1330
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 1353
          },
          {
            "lineNumber": 1466
          },
          {
            "text": "        const minColWidth = thumbnailSize;",
            "lineNumber": 1467
          },
          {
            "text": "        const cols = Math.max(1, Math.floor((finalAvailableWidth + GAP) / (minColWidth + GAP)));",
            "lineNumber": 1468
          },
          {
            "text": "        const itemWidth = (finalAvailableWidth - (cols - 1) * GAP) / cols;",
            "lineNumber": 1469
          },
          {
            "text": "        const itemHeight = itemWidth + 60; // Extra space for text",
            "lineNumber": 1470
          },
          {
            "lineNumber": 1471
          },
          {
            "text": "        itemsList.forEach((person, index) =&gt; {",
            "lineNumber": 1472
          },
          {
            "text": "            const row = Math.floor(index / cols);",
            "lineNumber": 1473
          },
          {
            "text": "            const col = index % cols;",
            "lineNumber": 1474
          },
          {
            "text": "            layout.push({",
            "lineNumber": 1475
          },
          {
            "text": "                id: person.id,",
            "lineNumber": 1476
          },
          {
            "text": "                x: PADDING + col * (itemWidth + GAP),",
            "lineNumber": 1477
          },
          {
            "text": "                y: PADDING + row * (itemHeight + GAP),",
            "lineNumber": 1478
          },
          {
            "text": "                width: itemWidth,",
            "lineNumber": 1479
          },
          {
            "text": "                height: itemHeight",
            "lineNumber": 1480
          },
          {
            "text": "            });",
            "lineNumber": 1481
          },
          {
            "text": "        });",
            "lineNumber": 1482
          },
          {
            "text": "        const rows = Math.ceil(itemsList.length / cols);",
            "lineNumber": 1483
          },
          {
            "text": "        totalHeight = PADDING + rows * (itemHeight + GAP);",
            "lineNumber": 1484
          },
          {
            "text": "    } ",
            "lineNumber": 1485
          },
          {
            "lineNumber": 1486
          },
          {
            "text": "    return { layout, totalHeight };",
            "lineNumber": 1487
          },
          {
            "text": "  }, [items, files, layoutMode, containerWidth, thumbnailSize, viewMode, aspectRatios, people]);",
            "lineNumber": 1488
          },
          {
            "text": "};",
            "lineNumber": 1489
          },
          {
            "lineNumber": 1490
          },
          {
            "text": "interface FileGridProps {",
            "lineNumber": 1491,
            "isSignature": true
          },
          {
            "text": "  displayFileIds: string[];",
            "lineNumber": 1492
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 1493
          },
          {
            "text": "  activeTab: TabState;",
            "lineNumber": 1494
          },
          {
            "text": "  renamingId: string | null;",
            "lineNumber": 1495
          },
          {
            "text": "  thumbnailSize: number;",
            "lineNumber": 1496
          },
          {
            "text": "  hoverPlayingId: string | null;",
            "lineNumber": 1497
          },
          {
            "text": "  onSetHoverPlayingId: (id: string | null) =&gt; void;",
            "lineNumber": 1498
          },
          {
            "text": "  onFileClick: (e: React.MouseEvent, id: string) =&gt; void;",
            "lineNumber": 1499
          },
          {
            "text": "  onFileDoubleClick: (id: string) =&gt; void;",
            "lineNumber": 1500
          },
          {
            "text": "  onContextMenu: (e: React.MouseEvent, id: string) =&gt; void;",
            "lineNumber": 1501
          },
          {
            "text": "  onRenameSubmit: (val: string, id: string) =&gt; void;",
            "lineNumber": 1502
          },
          {
            "text": "  onRenameCancel: () =&gt; void;",
            "lineNumber": 1503
          },
          {
            "text": "  onStartRename: (id: string) =&gt; void;",
            "lineNumber": 1504
          },
          {
            "text": "  onDragStart",
            "lineNumber": 1505
          },
          {
            "text": ";",
            "lineNumber": 1535,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 1536,
            "isSignature": true
          }
        ]
      },
      "score": 0.2771650552749634
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleUpdatePerson = \nprev =&gt; (\n\n          people: {\n              ...prev.people,\n              [personId]: { ...prev.people[personId], ...updates }\n          }\n      }));\n  };\n\n  const handleCreatePerson = () =&gt; {\n      const newId = Math.random().toString(36).substr(2, 9);\n      const newPerson: Person = {\n          id: newId,\n          name: t('context.newPersonDefault'),\n          coverFileId: '',\n          count: 0,\n          description: ''\n      };\n      setState(prev =&gt; ({\n          ...prev,\n          people: { ...prev.people, [newId]: newPerson },\n          activeModal: { type: 'rename-person', data: { personId: newId } }\n      }));\n  };\n\n  const handleDeletePerson = (personId: string | string[]) =&gt; {\n      setState(prev =&gt; {\n          const newPeople = { ...prev.people };\n          \n          // Handle both single person and multiple people deletion\n          const idsToDelete = typeof personId === 'string' ? [personId] : personId;\n          idsToDelete.forEach(id =&gt; {\n              delete newPeople[id];\n          });\n          \n          return { ...prev, people: newPeople, activeModal: { type: null } };\n      });\n  };\n\n  const handleManualAddPerson = (personId: string) =&gt; {\n      const fileIds = activeTab.selectedFileIds;\n      if (fileIds.length === 0) {\n          setState(s =&gt; ({ ...s, activeModal: { type: null } }));\n          return;\n      }\n      setState(prev =&gt; {\n          const newFiles = { ...prev.files };\n          const newPeople = { ...prev.people };\n          const person = newPeople[personId];\n          if (!person) return prev;\n      }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleUpdatePerson = ",
            "lineNumber": 2418
          },
          {
            "text": "prev =&gt; (",
            "lineNumber": 2419
          },
          {
            "lineNumber": 2420
          },
          {
            "text": "          people: {",
            "lineNumber": 2421
          },
          {
            "text": "              ...prev.people,",
            "lineNumber": 2422
          },
          {
            "text": "              [personId]: { ...prev.people[personId], ...updates }",
            "lineNumber": 2423
          },
          {
            "text": "          }",
            "lineNumber": 2424
          },
          {
            "text": "      }));",
            "lineNumber": 2425
          },
          {
            "text": "  };",
            "lineNumber": 2426
          },
          {
            "lineNumber": 2427
          },
          {
            "text": "  const handleCreatePerson = () =&gt; {",
            "lineNumber": 2428
          },
          {
            "text": "      const newId = Math.random().toString(36).substr(2, 9);",
            "lineNumber": 2429
          },
          {
            "text": "      const newPerson: Person = {",
            "lineNumber": 2430
          },
          {
            "text": "          id: newId,",
            "lineNumber": 2431
          },
          {
            "text": "          name: t('context.newPersonDefault'),",
            "lineNumber": 2432
          },
          {
            "text": "          coverFileId: '',",
            "lineNumber": 2433
          },
          {
            "text": "          count: 0,",
            "lineNumber": 2434
          },
          {
            "text": "          description: ''",
            "lineNumber": 2435
          },
          {
            "text": "      };",
            "lineNumber": 2436
          },
          {
            "text": "      setState(prev =&gt; ({",
            "lineNumber": 2437
          },
          {
            "text": "          ...prev,",
            "lineNumber": 2438
          },
          {
            "text": "          people: { ...prev.people, [newId]: newPerson },",
            "lineNumber": 2439
          },
          {
            "text": "          activeModal: { type: 'rename-person', data: { personId: newId } }",
            "lineNumber": 2440
          },
          {
            "text": "      }));",
            "lineNumber": 2441
          },
          {
            "text": "  };",
            "lineNumber": 2442
          },
          {
            "lineNumber": 2443
          },
          {
            "text": "  const handleDeletePerson = (personId: string | string[]) =&gt; {",
            "lineNumber": 2444
          },
          {
            "text": "      setState(prev =&gt; {",
            "lineNumber": 2445
          },
          {
            "text": "          const newPeople = { ...prev.people };",
            "lineNumber": 2446
          },
          {
            "text": "          ",
            "lineNumber": 2447
          },
          {
            "text": "          // Handle both single person and multiple people deletion",
            "lineNumber": 2448
          },
          {
            "text": "          const idsToDelete = typeof personId === 'string' ? [personId] : personId;",
            "lineNumber": 2449
          },
          {
            "text": "          idsToDelete.forEach(id =&gt; {",
            "lineNumber": 2450
          },
          {
            "text": "              delete newPeople[id];",
            "lineNumber": 2451
          },
          {
            "text": "          });",
            "lineNumber": 2452
          },
          {
            "text": "          ",
            "lineNumber": 2453
          },
          {
            "text": "          return { ...prev, people: newPeople, activeModal: { type: null } };",
            "lineNumber": 2454
          },
          {
            "text": "      });",
            "lineNumber": 2455
          },
          {
            "text": "  };",
            "lineNumber": 2456
          },
          {
            "lineNumber": 2457
          },
          {
            "text": "  const handleManualAddPerson = (personId: string) =&gt; {",
            "lineNumber": 2458
          },
          {
            "text": "      const fileIds = activeTab.selectedFileIds;",
            "lineNumber": 2459
          },
          {
            "text": "      if (fileIds.length === 0) {",
            "lineNumber": 2460
          },
          {
            "text": "          setState(s =&gt; ({ ...s, activeModal: { type: null } }));",
            "lineNumber": 2461
          },
          {
            "text": "          return;",
            "lineNumber": 2462
          },
          {
            "text": "      }",
            "lineNumber": 2463
          },
          {
            "text": "      setState(prev =&gt; {",
            "lineNumber": 2464
          },
          {
            "text": "          const newFiles = { ...prev.files };",
            "lineNumber": 2465
          },
          {
            "text": "          const newPeople = { ...prev.people };",
            "lineNumber": 2466
          },
          {
            "text": "          const person = newPeople[personId];",
            "lineNumber": 2467
          },
          {
            "text": "          if (!person) return prev;",
            "lineNumber": 2468
          },
          {
            "text": "      }",
            "lineNumber": 2514
          },
          {
            "text": ";",
            "lineNumber": 2516
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.2742713689804077
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 300
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "const CropAvatarModal = \n\n        &lt;/div&gt;\n    &lt;/div&gt;\n  );\n};\n\nimport SplashScreen from './components/SplashScreen';\n\n// 导入统一的环境检测工具\nimport { isTauriEnvironment, detectTauriEnvironmentAsync } from './utils/environment';\n\nexport const App: React.FC = () =&gt; {\n  const [state, setState] = useState&lt;AppState&gt;({\n    roots: [], files: {}, people: {}, expandedFolderIds: [], tabs: [], activeTabId: '', sortBy: 'name', sortDirection: 'asc', thumbnailSize: 180, renamingId: null, clipboard: { action: null, items: { type: 'file', ids: [] } }, customTags: [], folderSettings: {}, layout: { isSidebarVisible: true, isMetadataVisible: true }, \n    slideshowConfig: { interval: 3000, transition: 'fade', isRandom: false, enableZoom: true },\n    settings: { \n        theme: 'system', \n        language: 'zh', \n        autoStart: false,\n        exitAction: 'ask',\n        animateOnHover: true,\n        paths: { resourceRoot: 'C:\\\\Users\\\\User\\\\Pictures\\\\AuroraGallery', cacheRoot: 'C:\\\\AppData\\\\Local\\\\Aurora\\\\Cache' }, \n        search: { isAISearchEnabled: false },\n        ai: {\n            provider: 'ollama',\n            openai: { apiKey: '', endpoint: 'https://api.openai.com/v1', model: 'gpt-4o' },\n            ollama: { endpoint: 'http://localhost:11434', model: 'llava' },\n            lmstudio: { endpoint: 'http://localhost:1234/v1', model: 'local-model' },\n            autoTag: false,\n            autoDescription: false,\n            enhancePersonDescription: false,\n            enableFaceRecognition: false,\n            autoAddPeople: false,\n            enableOCR: false,\n            enableTranslation: false,\n            targetLanguage: 'zh',\n            confidenceThreshold: 0.6\n        }\n    },\n    isSettingsOpen: false, settingsCategory: 'general', activeModal: { type: null }, tasks: [],\n    aiConnectionStatus: 'checking'\n  });\n\n  // #region agent log - removed log_frontend invocation as it doesn't exist\n  // #endregion\n\n  // ... (keep all state variables and hooks identical)\n  const [isLoading, setIsLoading] = useState(true);\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const CropAvatarModal = ",
            "lineNumber": 301
          },
          {
            "lineNumber": 501
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 502
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 503
          },
          {
            "text": "  );",
            "lineNumber": 504
          },
          {
            "text": "};",
            "lineNumber": 505
          },
          {
            "lineNumber": 506
          },
          {
            "text": "import SplashScreen from './components/SplashScreen';",
            "lineNumber": 507
          },
          {
            "lineNumber": 508
          },
          {
            "text": "// 导入统一的环境检测工具",
            "lineNumber": 509
          },
          {
            "text": "import { isTauriEnvironment, detectTauriEnvironmentAsync } from './utils/environment';",
            "lineNumber": 510
          },
          {
            "lineNumber": 511
          },
          {
            "text": "export const App: React.FC = () =&gt; {",
            "lineNumber": 512
          },
          {
            "text": "  const [state, setState] = useState&lt;AppState&gt;({",
            "lineNumber": 513
          },
          {
            "text": "    roots: [], files: {}, people: {}, expandedFolderIds: [], tabs: [], activeTabId: '', sortBy: 'name', sortDirection: 'asc', thumbnailSize: 180, renamingId: null, clipboard: { action: null, items: { type: 'file', ids: [] } }, customTags: [], folderSettings: {}, layout: { isSidebarVisible: true, isMetadataVisible: true }, ",
            "lineNumber": 514
          },
          {
            "text": "    slideshowConfig: { interval: 3000, transition: 'fade', isRandom: false, enableZoom: true },",
            "lineNumber": 515
          },
          {
            "text": "    settings: { ",
            "lineNumber": 516
          },
          {
            "text": "        theme: 'system', ",
            "lineNumber": 517
          },
          {
            "text": "        language: 'zh', ",
            "lineNumber": 518
          },
          {
            "text": "        autoStart: false,",
            "lineNumber": 519
          },
          {
            "text": "        exitAction: 'ask',",
            "lineNumber": 520
          },
          {
            "text": "        animateOnHover: true,",
            "lineNumber": 521
          },
          {
            "text": "        paths: { resourceRoot: 'C:\\\\Users\\\\User\\\\Pictures\\\\AuroraGallery', cacheRoot: 'C:\\\\AppData\\\\Local\\\\Aurora\\\\Cache' }, ",
            "lineNumber": 522
          },
          {
            "text": "        search: { isAISearchEnabled: false },",
            "lineNumber": 523
          },
          {
            "text": "        ai: {",
            "lineNumber": 524
          },
          {
            "text": "            provider: 'ollama',",
            "lineNumber": 525
          },
          {
            "text": "            openai: { apiKey: '', endpoint: 'https://api.openai.com/v1', model: 'gpt-4o' },",
            "lineNumber": 526
          },
          {
            "text": "            ollama: { endpoint: 'http://localhost:11434', model: 'llava' },",
            "lineNumber": 527
          },
          {
            "text": "            lmstudio: { endpoint: 'http://localhost:1234/v1', model: 'local-model' },",
            "lineNumber": 528
          },
          {
            "text": "            autoTag: false,",
            "lineNumber": 529
          },
          {
            "text": "            autoDescription: false,",
            "lineNumber": 530
          },
          {
            "text": "            enhancePersonDescription: false,",
            "lineNumber": 531
          },
          {
            "text": "            enableFaceRecognition: false,",
            "lineNumber": 532
          },
          {
            "text": "            autoAddPeople: false,",
            "lineNumber": 533
          },
          {
            "text": "            enableOCR: false,",
            "lineNumber": 534
          },
          {
            "text": "            enableTranslation: false,",
            "lineNumber": 535
          },
          {
            "text": "            targetLanguage: 'zh',",
            "lineNumber": 536
          },
          {
            "text": "            confidenceThreshold: 0.6",
            "lineNumber": 537
          },
          {
            "text": "        }",
            "lineNumber": 538
          },
          {
            "text": "    },",
            "lineNumber": 539
          },
          {
            "text": "    isSettingsOpen: false, settingsCategory: 'general', activeModal: { type: null }, tasks: [],",
            "lineNumber": 540
          },
          {
            "text": "    aiConnectionStatus: 'checking'",
            "lineNumber": 541
          },
          {
            "text": "  });",
            "lineNumber": 542
          },
          {
            "lineNumber": 543
          },
          {
            "text": "  // #region agent log - removed log_frontend invocation as it doesn't exist",
            "lineNumber": 544
          },
          {
            "text": "  // #endregion",
            "lineNumber": 545
          },
          {
            "lineNumber": 546
          },
          {
            "text": "  // ... (keep all state variables and hooks identical)",
            "lineNumber": 547
          },
          {
            "text": "  const [isLoading, setIsLoading] = useState(true);",
            "lineNumber": 548
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.27059900760650635
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst performAiSearch = async \nconst res = await \n { 'Content-Type': 'application/json' },\n                      body: JSON.stringify(body)\n                  });\n                  const resData = await res.json();\n                  if (resData?.response) {\n                      try { result = JSON.parse(resData.response); } catch(e){}\n                  }\n              } catch (e) {\n                  console.error('AI search failed:', e);\n              }\n          } else if (aiConfig.provider === 'lmstudio') {\n              const body = { model: aiConfig.lmstudio.model, messages: [{ role: \"user\", content: prompt }], max_tokens: 500, stream: false };\n              let endpoint = aiConfig.lmstudio.endpoint.replace(/\\/+$/, '');\n              if (!endpoint.endsWith('/v1')) endpoint += '/v1';\n              try {\n                  const res = await fetch(&#96;${endpoint}/chat/completions&#96;, {\n                      method: 'POST',\n                      headers: { 'Content-Type': 'application/json' },\n                      body: JSON.stringify(body)\n                  });\n                  const resData = await res.json();\n                  if (resData?.choices?.[0]?.message?.content) {\n                      try { result = JSON.parse(resData.choices[0].message.content); } catch(e){}\n                  }\n              } catch (e) {\n                  console.error('AI search failed:', e);\n              }\n          }\n\n          if (result) {\n              const aiFilter = {\n                  originalQuery: query\n              };\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const performAiSearch = async ",
            "lineNumber": 2947
          },
          {
            "text": "const res = await ",
            "lineNumber": 2997
          },
          {
            "text": " { 'Content-Type': 'application/json' },",
            "lineNumber": 2999
          },
          {
            "text": "                      body: JSON.stringify(body)",
            "lineNumber": 3000
          },
          {
            "text": "                  });",
            "lineNumber": 3001
          },
          {
            "text": "                  const resData = await res.json();",
            "lineNumber": 3002
          },
          {
            "text": "                  if (resData?.response) {",
            "lineNumber": 3003
          },
          {
            "text": "                      try { result = JSON.parse(resData.response); } catch(e){}",
            "lineNumber": 3004
          },
          {
            "text": "                  }",
            "lineNumber": 3005
          },
          {
            "text": "              } catch (e) {",
            "lineNumber": 3006
          },
          {
            "text": "                  console.error('AI search failed:', e);",
            "lineNumber": 3007
          },
          {
            "text": "              }",
            "lineNumber": 3008
          },
          {
            "text": "          } else if (aiConfig.provider === 'lmstudio') {",
            "lineNumber": 3009
          },
          {
            "text": "              const body = { model: aiConfig.lmstudio.model, messages: [{ role: \"user\", content: prompt }], max_tokens: 500, stream: false };",
            "lineNumber": 3010
          },
          {
            "text": "              let endpoint = aiConfig.lmstudio.endpoint.replace(/\\/+$/, '');",
            "lineNumber": 3011
          },
          {
            "text": "              if (!endpoint.endsWith('/v1')) endpoint += '/v1';",
            "lineNumber": 3012
          },
          {
            "text": "              try {",
            "lineNumber": 3013
          },
          {
            "text": "                  const res = await fetch(&#96;${endpoint}/chat/completions&#96;, {",
            "lineNumber": 3014
          },
          {
            "text": "                      method: 'POST',",
            "lineNumber": 3015
          },
          {
            "text": "                      headers: { 'Content-Type': 'application/json' },",
            "lineNumber": 3016
          },
          {
            "text": "                      body: JSON.stringify(body)",
            "lineNumber": 3017
          },
          {
            "text": "                  });",
            "lineNumber": 3018
          },
          {
            "text": "                  const resData = await res.json();",
            "lineNumber": 3019
          },
          {
            "text": "                  if (resData?.choices?.[0]?.message?.content) {",
            "lineNumber": 3020
          },
          {
            "text": "                      try { result = JSON.parse(resData.choices[0].message.content); } catch(e){}",
            "lineNumber": 3021
          },
          {
            "text": "                  }",
            "lineNumber": 3022
          },
          {
            "text": "              } catch (e) {",
            "lineNumber": 3023
          },
          {
            "text": "                  console.error('AI search failed:', e);",
            "lineNumber": 3024
          },
          {
            "text": "              }",
            "lineNumber": 3025
          },
          {
            "text": "          }",
            "lineNumber": 3026
          },
          {
            "lineNumber": 3027
          },
          {
            "text": "          if (result) {",
            "lineNumber": 3028
          },
          {
            "text": "              const aiFilter = {",
            "lineNumber": 3029
          },
          {
            "text": "                  originalQuery: query",
            "lineNumber": 3030
          },
          {
            "text": "              };",
            "lineNumber": 3035
          },
          {
            "text": ";",
            "lineNumber": 3054
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.27031606435775757
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 139
          },
          "endPosition": {
            "line": 215,
            "column": 1
          }
        },
        "contents": "const PeopleSection: React.FC&lt;PeopleSectionProps&gt; = \n\n          &lt;/button&gt;\n        &lt;/div&gt;\n\n        {expanded &amp;&amp; (\n          &lt;div className=\"pl-6 pr-2 pb-2 mt-1\"&gt;\n             {peopleList.length === 0 ? (\n                 &lt;div className=\"text-xs text-gray-400 italic py-1\"&gt;{t('sidebar.noPeople')}&lt;/div&gt;\n             ) : (\n                 &lt;div className=\"grid grid-cols-4 gap-2\"&gt;\n                     {peopleList.map(person =&gt; {\n                        const coverFile = files[person.coverFileId];\n                        \n                        return (\n                           &lt;div \n                              key={person.id} \n                              className=\"flex flex-col items-center group cursor-pointer\"\n                              onClick={() =&gt; onPersonSelect(person.id)}\n                              onContextMenu={(e) =&gt; onContextMenu(e, 'person', person.id)}\n                              onDoubleClick={(e) =&gt; {\n                                  e.stopPropagation();\n                                  onStartRenamePerson(person.id);\n                              }}\n                              title={person.name}\n                           &gt;\n                              &lt;div className=\"w-10 h-10 rounded-full border border-gray-200 dark:border-gray-700 overflow-hidden bg-gray-100 dark:bg-gray-800 hover:border-purple-500 dark:hover:border-purple-400 hover:ring-2 ring-purple-200 dark:ring-purple-900 transition-all shadow-sm relative\"&gt;\n                                 {coverFile ?\n                     }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 140,
                "column": 1
              },
              "endPosition": {
                "line": 140,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 140,
                "column": 7
              },
              "endPosition": {
                "line": 140,
                "column": 53
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const PeopleSection: React.FC&lt;PeopleSectionProps&gt; = ",
            "lineNumber": 140
          },
          {
            "lineNumber": 169
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 170
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 171
          },
          {
            "lineNumber": 172
          },
          {
            "text": "        {expanded &amp;&amp; (",
            "lineNumber": 173
          },
          {
            "text": "          &lt;div className=\"pl-6 pr-2 pb-2 mt-1\"&gt;",
            "lineNumber": 174
          },
          {
            "text": "             {peopleList.length === 0 ? (",
            "lineNumber": 175
          },
          {
            "text": "                 &lt;div className=\"text-xs text-gray-400 italic py-1\"&gt;{t('sidebar.noPeople')}&lt;/div&gt;",
            "lineNumber": 176
          },
          {
            "text": "             ) : (",
            "lineNumber": 177
          },
          {
            "text": "                 &lt;div className=\"grid grid-cols-4 gap-2\"&gt;",
            "lineNumber": 178
          },
          {
            "text": "                     {peopleList.map(person =&gt; {",
            "lineNumber": 179
          },
          {
            "text": "                        const coverFile = files[person.coverFileId];",
            "lineNumber": 180
          },
          {
            "text": "                        ",
            "lineNumber": 181
          },
          {
            "text": "                        return (",
            "lineNumber": 182
          },
          {
            "text": "                           &lt;div ",
            "lineNumber": 183
          },
          {
            "text": "                              key={person.id} ",
            "lineNumber": 184
          },
          {
            "text": "                              className=\"flex flex-col items-center group cursor-pointer\"",
            "lineNumber": 185
          },
          {
            "text": "                              onClick={() =&gt; onPersonSelect(person.id)}",
            "lineNumber": 186
          },
          {
            "text": "                              onContextMenu={(e) =&gt; onContextMenu(e, 'person', person.id)}",
            "lineNumber": 187
          },
          {
            "text": "                              onDoubleClick={(e) =&gt; {",
            "lineNumber": 188
          },
          {
            "text": "                                  e.stopPropagation();",
            "lineNumber": 189
          },
          {
            "text": "                                  onStartRenamePerson(person.id);",
            "lineNumber": 190
          },
          {
            "text": "                              }}",
            "lineNumber": 191
          },
          {
            "text": "                              title={person.name}",
            "lineNumber": 192
          },
          {
            "text": "                           &gt;",
            "lineNumber": 193
          },
          {
            "text": "                              &lt;div className=\"w-10 h-10 rounded-full border border-gray-200 dark:border-gray-700 overflow-hidden bg-gray-100 dark:bg-gray-800 hover:border-purple-500 dark:hover:border-purple-400 hover:ring-2 ring-purple-200 dark:ring-purple-900 transition-all shadow-sm relative\"&gt;",
            "lineNumber": 194
          },
          {
            "text": "                                 {coverFile ?",
            "lineNumber": 195
          },
          {
            "text": "                     }",
            "lineNumber": 209
          },
          {
            "text": ";",
            "lineNumber": 216
          }
        ]
      },
      "score": 0.268156498670578
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst personStats = () =&gt; {\n(f: FileNode) =&gt; {\n\n            count++;\n        }\n    });\n    return { totalSize, count };\n  }, [person, files]);\n  \n  const batchStats = useMemo(() =&gt; {\n    if (!isMulti) return null;\n    const selectedNodes = selectedFileIds.map(id =&gt; files[id]).filter(Boolean);\n    \n    let totalSize = 0;\n    const typeCount: Record&lt;string, number&gt; = {};\n    const allTags = new Set&lt;string&gt;();\n\n    selectedNodes.forEach(node =&gt; {\n        if (node.type === FileType.IMAGE) {\n            totalSize += node.meta?.sizeKb || 0;\n            const fmt = node.meta?.format.toUpperCase() || 'UNKNOWN';\n            typeCount[fmt] = (typeCount[fmt] || 0) + 1;\n        } else {\n            typeCount['FOLDER'] = (typeCount['FOLDER'] || 0) + 1;\n            const fs = getFolderStats(files, node.id);\n            totalSize += fs.size;\n        }\n        node.tags.forEach(t =&gt; allTags.add(t));\n    });\n\n    return { totalSize, typeCount, allTags: Array.from(allTags).sort() };\n  },;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "const personStats = () =&gt; {",
            "lineNumber": 665
          },
          {
            "text": "(f: FileNode) =&gt; {",
            "lineNumber": 669
          },
          {
            "lineNumber": 671
          },
          {
            "text": "            count++;",
            "lineNumber": 672
          },
          {
            "text": "        }",
            "lineNumber": 673
          },
          {
            "text": "    });",
            "lineNumber": 674
          },
          {
            "text": "    return { totalSize, count };",
            "lineNumber": 675
          },
          {
            "text": "  }, [person, files]);",
            "lineNumber": 676
          },
          {
            "text": "  ",
            "lineNumber": 677
          },
          {
            "text": "  const batchStats = useMemo(() =&gt; {",
            "lineNumber": 678
          },
          {
            "text": "    if (!isMulti) return null;",
            "lineNumber": 679
          },
          {
            "text": "    const selectedNodes = selectedFileIds.map(id =&gt; files[id]).filter(Boolean);",
            "lineNumber": 680
          },
          {
            "text": "    ",
            "lineNumber": 681
          },
          {
            "text": "    let totalSize = 0;",
            "lineNumber": 682
          },
          {
            "text": "    const typeCount: Record&lt;string, number&gt; = {};",
            "lineNumber": 683
          },
          {
            "text": "    const allTags = new Set&lt;string&gt;();",
            "lineNumber": 684
          },
          {
            "lineNumber": 685
          },
          {
            "text": "    selectedNodes.forEach(node =&gt; {",
            "lineNumber": 686
          },
          {
            "text": "        if (node.type === FileType.IMAGE) {",
            "lineNumber": 687
          },
          {
            "text": "            totalSize += node.meta?.sizeKb || 0;",
            "lineNumber": 688
          },
          {
            "text": "            const fmt = node.meta?.format.toUpperCase() || 'UNKNOWN';",
            "lineNumber": 689
          },
          {
            "text": "            typeCount[fmt] = (typeCount[fmt] || 0) + 1;",
            "lineNumber": 690
          },
          {
            "text": "        } else {",
            "lineNumber": 691
          },
          {
            "text": "            typeCount['FOLDER'] = (typeCount['FOLDER'] || 0) + 1;",
            "lineNumber": 692
          },
          {
            "text": "            const fs = getFolderStats(files, node.id);",
            "lineNumber": 693
          },
          {
            "text": "            totalSize += fs.size;",
            "lineNumber": 694
          },
          {
            "text": "        }",
            "lineNumber": 695
          },
          {
            "text": "        node.tags.forEach(t =&gt; allTags.add(t));",
            "lineNumber": 696
          },
          {
            "text": "    });",
            "lineNumber": 697
          },
          {
            "lineNumber": 698
          },
          {
            "text": "    return { totalSize, typeCount, allTags: Array.from(allTags).sort() };",
            "lineNumber": 699
          },
          {
            "text": "  },;",
            "lineNumber": 700
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.26769450306892395
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\n\n                  \n                  if (parentFolder &amp;&amp; parentFolder.category === 'sequence') {\n                      return (\n                          &lt;SequenceViewer\n                              file={viewingFile}\n                              folder={parentFolder}\n                              files={state.files}\n                              sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)}\n                              onClose={closeViewer}\n                              onNavigate={handleViewerJump}\n                              isSidebarOpen={state.layout.isSidebarVisible}\n                              onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))}\n                              onDelete={(id) =&gt; requestDelete([id])}\n                              t={t}\n                          /&gt;\n                      );\n                  }\n\n                  return (\n                      &lt;ImageViewer\n                          file={state.files[activeTab.viewingFileId]}\n                          sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)} \n                          files={state.files}\n                          layout={state.layout}\n                          slideshowConfig={state.slideshowConfig}\n                          onLayoutToggle={(part) =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, [part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible']: !s.layout[part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible'] } }))}\n                          onClose={closeViewer}\n                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}\n                          onPrev={() =&gt; handleViewerNavigate('prev')}\n              }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4466
          },
          {
            "lineNumber": 4468
          },
          {
            "text": "                  ",
            "lineNumber": 4469
          },
          {
            "text": "                  if (parentFolder &amp;&amp; parentFolder.category === 'sequence') {",
            "lineNumber": 4470
          },
          {
            "text": "                      return (",
            "lineNumber": 4471
          },
          {
            "text": "                          &lt;SequenceViewer",
            "lineNumber": 4472
          },
          {
            "text": "                              file={viewingFile}",
            "lineNumber": 4473
          },
          {
            "text": "                              folder={parentFolder}",
            "lineNumber": 4474
          },
          {
            "text": "                              files={state.files}",
            "lineNumber": 4475
          },
          {
            "text": "                              sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)}",
            "lineNumber": 4476
          },
          {
            "text": "                              onClose={closeViewer}",
            "lineNumber": 4477
          },
          {
            "text": "                              onNavigate={handleViewerJump}",
            "lineNumber": 4478
          },
          {
            "text": "                              isSidebarOpen={state.layout.isSidebarVisible}",
            "lineNumber": 4479
          },
          {
            "text": "                              onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))}",
            "lineNumber": 4480
          },
          {
            "text": "                              onDelete={(id) =&gt; requestDelete([id])}",
            "lineNumber": 4481
          },
          {
            "text": "                              t={t}",
            "lineNumber": 4482
          },
          {
            "text": "                          /&gt;",
            "lineNumber": 4483
          },
          {
            "text": "                      );",
            "lineNumber": 4484
          },
          {
            "text": "                  }",
            "lineNumber": 4485
          },
          {
            "lineNumber": 4486
          },
          {
            "text": "                  return (",
            "lineNumber": 4487
          },
          {
            "text": "                      &lt;ImageViewer",
            "lineNumber": 4488
          },
          {
            "text": "                          file={state.files[activeTab.viewingFileId]}",
            "lineNumber": 4489
          },
          {
            "text": "                          sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)} ",
            "lineNumber": 4490
          },
          {
            "text": "                          files={state.files}",
            "lineNumber": 4491
          },
          {
            "text": "                          layout={state.layout}",
            "lineNumber": 4492
          },
          {
            "text": "                          slideshowConfig={state.slideshowConfig}",
            "lineNumber": 4493
          },
          {
            "text": "                          onLayoutToggle={(part) =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, [part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible']: !s.layout[part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible'] } }))}",
            "lineNumber": 4494
          },
          {
            "text": "                          onClose={closeViewer}",
            "lineNumber": 4495
          },
          {
            "text": "                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}",
            "lineNumber": 4496
          },
          {
            "text": "                          onPrev={() =&gt; handleViewerNavigate('prev')}",
            "lineNumber": 4497
          },
          {
            "text": "              }",
            "lineNumber": 4522
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.26494133472442627
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst requestDelete = \n\n    setState(prev =&gt; {\n        const newFiles = { ...prev.files };\n        ids.forEach(id =&gt; {\n             const file = newFiles[id];\n             if (file &amp;&amp; file.parentId &amp;&amp; newFiles[file.parentId]) {\n                 const parent = newFiles[file.parentId];\n                 newFiles[file.parentId] = { ...parent, children: parent.children?.filter(cid =&gt; cid !== id) };\n             }\n             delete newFiles[id];\n        });\n        \n        const updatedTabs = prev.tabs.map(t =&gt; {\n            // 如果当前标签页正在查看被删除的文件，清除 viewingFileId\n            const isViewingDeletedFile = t.viewingFileId &amp;&amp; ids.includes(t.viewingFileId);\n            return {\n                ...t,\n                selectedFileIds: t.selectedFileIds.filter(fid =&gt; !ids.includes(fid)),\n                viewingFileId: isViewingDeletedFile ? null : t.viewingFileId\n            };\n        });\n        \n        return { ...prev, files: newFiles, tabs: updatedTabs };\n    });\n    setDeletionTasks(prev =&gt; [...prev, newTask]);\n  };\n\n  const undoDelete = (taskId: string) =&gt; {\n      const task = deletionTasks.find(t =&gt; t.id === taskId);\n      if (!task) return;\n      setState(prev =&gt; {\n          const newFiles = { ...prev.files };\n          task.files.forEach(file =&gt; {\n              newFiles[file.id] = file;\n              if (file.parentId &amp;&amp; newFiles[file.parentId]) {\n                  const parent = newFiles[file.parentId];\n                  if (!parent.children?.includes(file.id))\n          }\n      }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const requestDelete = ",
            "lineNumber": 3105
          },
          {
            "lineNumber": 3109
          },
          {
            "text": "    setState(prev =&gt; {",
            "lineNumber": 3110
          },
          {
            "text": "        const newFiles = { ...prev.files };",
            "lineNumber": 3111
          },
          {
            "text": "        ids.forEach(id =&gt; {",
            "lineNumber": 3112
          },
          {
            "text": "             const file = newFiles[id];",
            "lineNumber": 3113
          },
          {
            "text": "             if (file &amp;&amp; file.parentId &amp;&amp; newFiles[file.parentId]) {",
            "lineNumber": 3114
          },
          {
            "text": "                 const parent = newFiles[file.parentId];",
            "lineNumber": 3115
          },
          {
            "text": "                 newFiles[file.parentId] = { ...parent, children: parent.children?.filter(cid =&gt; cid !== id) };",
            "lineNumber": 3116
          },
          {
            "text": "             }",
            "lineNumber": 3117
          },
          {
            "text": "             delete newFiles[id];",
            "lineNumber": 3118
          },
          {
            "text": "        });",
            "lineNumber": 3119
          },
          {
            "text": "        ",
            "lineNumber": 3120
          },
          {
            "text": "        const updatedTabs = prev.tabs.map(t =&gt; {",
            "lineNumber": 3121
          },
          {
            "text": "            // 如果当前标签页正在查看被删除的文件，清除 viewingFileId",
            "lineNumber": 3122
          },
          {
            "text": "            const isViewingDeletedFile = t.viewingFileId &amp;&amp; ids.includes(t.viewingFileId);",
            "lineNumber": 3123
          },
          {
            "text": "            return {",
            "lineNumber": 3124
          },
          {
            "text": "                ...t,",
            "lineNumber": 3125
          },
          {
            "text": "                selectedFileIds: t.selectedFileIds.filter(fid =&gt; !ids.includes(fid)),",
            "lineNumber": 3126
          },
          {
            "text": "                viewingFileId: isViewingDeletedFile ? null : t.viewingFileId",
            "lineNumber": 3127
          },
          {
            "text": "            };",
            "lineNumber": 3128
          },
          {
            "text": "        });",
            "lineNumber": 3129
          },
          {
            "text": "        ",
            "lineNumber": 3130
          },
          {
            "text": "        return { ...prev, files: newFiles, tabs: updatedTabs };",
            "lineNumber": 3131
          },
          {
            "text": "    });",
            "lineNumber": 3132
          },
          {
            "text": "    setDeletionTasks(prev =&gt; [...prev, newTask]);",
            "lineNumber": 3133
          },
          {
            "text": "  };",
            "lineNumber": 3134
          },
          {
            "lineNumber": 3135
          },
          {
            "text": "  const undoDelete = (taskId: string) =&gt; {",
            "lineNumber": 3136
          },
          {
            "text": "      const task = deletionTasks.find(t =&gt; t.id === taskId);",
            "lineNumber": 3137
          },
          {
            "text": "      if (!task) return;",
            "lineNumber": 3138
          },
          {
            "text": "      setState(prev =&gt; {",
            "lineNumber": 3139
          },
          {
            "text": "          const newFiles = { ...prev.files };",
            "lineNumber": 3140
          },
          {
            "text": "          task.files.forEach(file =&gt; {",
            "lineNumber": 3141
          },
          {
            "text": "              newFiles[file.id] = file;",
            "lineNumber": 3142
          },
          {
            "text": "              if (file.parentId &amp;&amp; newFiles[file.parentId]) {",
            "lineNumber": 3143
          },
          {
            "text": "                  const parent = newFiles[file.parentId];",
            "lineNumber": 3144
          },
          {
            "text": "                  if (!parent.children?.includes(file.id))",
            "lineNumber": 3145
          },
          {
            "text": "          }",
            "lineNumber": 3149
          },
          {
            "text": "      }",
            "lineNumber": 3151
          },
          {
            "text": ";",
            "lineNumber": 3153
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.26441121101379395
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nfor (let fileIndex = 0; fileIndex &lt; imageFileIds.length; fileIndex++) {\n\n              const newTags = Array.from(new Set([...currentTags, ...aiData.tags]));\n\n              // Step 6: Save all AI data\n              updateTask(taskId, { current: currentStep + 6, currentStep: t('tasks.savingData') });\n              const updatedFile = {\n                  ...file,\n                  aiData,\n                  tags: newTags,\n                  description: file.description ? file.description : aiData.description\n              };\n\n              setState(prev =&gt; ({\n                  ...prev,\n                  people: currentPeople, // Always use the latest shared currentPeople\n                  files: {\n                      ...prev.files,\n                      [fileId]: updatedFile\n                  }\n              }));\n          }\n          \n          // If folderId is provided, summarize all results and update folder description\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 4154,
                "column": 3
              },
              "endPosition": {
                "line": 4154,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 4154,
                "column": 9
              },
              "endPosition": {
                "line": 4154,
                "column": 40
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3593
          },
          {
            "text": "for (let fileIndex = 0; fileIndex &lt; imageFileIds.length; fileIndex++) {",
            "lineNumber": 4027
          },
          {
            "lineNumber": 4190
          },
          {
            "text": "              const newTags = Array.from(new Set([...currentTags, ...aiData.tags]));",
            "lineNumber": 4191
          },
          {
            "lineNumber": 4192
          },
          {
            "text": "              // Step 6: Save all AI data",
            "lineNumber": 4193
          },
          {
            "text": "              updateTask(taskId, { current: currentStep + 6, currentStep: t('tasks.savingData') });",
            "lineNumber": 4194
          },
          {
            "text": "              const updatedFile = {",
            "lineNumber": 4195
          },
          {
            "text": "                  ...file,",
            "lineNumber": 4196
          },
          {
            "text": "                  aiData,",
            "lineNumber": 4197
          },
          {
            "text": "                  tags: newTags,",
            "lineNumber": 4198
          },
          {
            "text": "                  description: file.description ? file.description : aiData.description",
            "lineNumber": 4199
          },
          {
            "text": "              };",
            "lineNumber": 4200
          },
          {
            "lineNumber": 4201
          },
          {
            "text": "              setState(prev =&gt; ({",
            "lineNumber": 4202
          },
          {
            "text": "                  ...prev,",
            "lineNumber": 4203
          },
          {
            "text": "                  people: currentPeople, // Always use the latest shared currentPeople",
            "lineNumber": 4204
          },
          {
            "text": "                  files: {",
            "lineNumber": 4205
          },
          {
            "text": "                      ...prev.files,",
            "lineNumber": 4206
          },
          {
            "text": "                      [fileId]: updatedFile",
            "lineNumber": 4207
          },
          {
            "text": "                  }",
            "lineNumber": 4208
          },
          {
            "text": "              }));",
            "lineNumber": 4209
          },
          {
            "text": "          }",
            "lineNumber": 4210
          },
          {
            "text": "          ",
            "lineNumber": 4211
          },
          {
            "text": "          // If folderId is provided, summarize all results and update folder description",
            "lineNumber": 4212
          },
          {
            "text": ";",
            "lineNumber": 4386
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.26352643966674805
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\types.ts",
        "range": {
          "startPosition": {
            "line": 170
          },
          "endPosition": {
            "line": 193,
            "column": 1
          }
        },
        "contents": "export interface FolderSettings {\n;\n  sortDirection: SortDirection;\n  groupBy: GroupByOption;\n}\n\nexport interface FileGroup {\n  id: string;\n  title: string;\n  fileIds: string[];\n}\n\nexport interface HistoryItem {\n  folderId: string;\n  viewingId: string | null;\n  viewMode: 'browser' | 'tags-overview' | 'people-overview';\n  searchQuery: string;\n  searchScope: SearchScope;\n  activeTags: string[];\n;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export interface FolderSettings {",
            "lineNumber": 171,
            "isSignature": true
          },
          {
            "text": ";",
            "lineNumber": 173
          },
          {
            "text": "  sortDirection: SortDirection;",
            "lineNumber": 174
          },
          {
            "text": "  groupBy: GroupByOption;",
            "lineNumber": 175,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 176,
            "isSignature": true
          },
          {
            "lineNumber": 177
          },
          {
            "text": "export interface FileGroup {",
            "lineNumber": 178,
            "isSignature": true
          },
          {
            "text": "  id: string;",
            "lineNumber": 179
          },
          {
            "text": "  title: string;",
            "lineNumber": 180
          },
          {
            "text": "  fileIds: string[];",
            "lineNumber": 181,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 182,
            "isSignature": true
          },
          {
            "lineNumber": 183
          },
          {
            "text": "export interface HistoryItem {",
            "lineNumber": 184,
            "isSignature": true
          },
          {
            "text": "  folderId: string;",
            "lineNumber": 185
          },
          {
            "text": "  viewingId: string | null;",
            "lineNumber": 186
          },
          {
            "text": "  viewMode: 'browser' | 'tags-overview' | 'people-overview';",
            "lineNumber": 187
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 188
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 189
          },
          {
            "text": "  activeTags: string[];",
            "lineNumber": 190
          },
          {
            "text": ";",
            "lineNumber": 193,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 194,
            "isSignature": true
          }
        ]
      },
      "score": 0.25610148906707764
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n \n                groupBy={groupBy}\n                onGroupByChange={setGroupBy}\n                isAISearchEnabled={state.settings.search.isAISearchEnabled}\n                onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}\n                onRememberFolderSettings={activeTab.viewMode === 'browser' ? handleRememberFolderSettings : undefined}\n                hasFolderSettings={activeTab.viewMode === 'browser' ? !!state.folderSettings[activeTab.folderId] : false}\n                t={t} \n              /&gt;\n              {/* ... (Filter UI, same as before) ... */}\n              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": " ",
            "lineNumber": 4548
          },
          {
            "text": "                groupBy={groupBy}",
            "lineNumber": 4549
          },
          {
            "text": "                onGroupByChange={setGroupBy}",
            "lineNumber": 4550
          },
          {
            "text": "                isAISearchEnabled={state.settings.search.isAISearchEnabled}",
            "lineNumber": 4551
          },
          {
            "text": "                onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}",
            "lineNumber": 4552
          },
          {
            "text": "                onRememberFolderSettings={activeTab.viewMode === 'browser' ? handleRememberFolderSettings : undefined}",
            "lineNumber": 4553
          },
          {
            "text": "                hasFolderSettings={activeTab.viewMode === 'browser' ? !!state.folderSettings[activeTab.folderId] : false}",
            "lineNumber": 4554
          },
          {
            "text": "                t={t} ",
            "lineNumber": 4555
          },
          {
            "text": "              /&gt;",
            "lineNumber": 4556
          },
          {
            "text": "              {/* ... (Filter UI, same as before) ... */}",
            "lineNumber": 4557
          },
          {
            "text": "              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start",
            "lineNumber": 4558
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.25543320178985596
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst batchStats = () =&gt; {\n\n\n    return { totalSize, typeCount, allTags: Array.from(allTags).sort() };\n  }, [selectedFileIds, files]);\n\n  const batchChartData = useMemo(() =&gt; {\n      if (!batchStats) return [];\n      const data: { label: string; value: number; color: string }[] = [];\n\n      Object.entries(batchStats.typeCount).forEach(([type, count]) =&gt; {\n          let label = type;\n          let colorKey = type;\n          if (type === 'FOLDER') {\n              label = t('meta.folderType');\n              colorKey = 'FOLDER';\n          }\n          data.push({\n              label: label,\n              value: count,\n              color: typeColors[colorKey] || defaultColor\n          });\n      });\n\n      return data.sort((a, b) =&gt; b.value - a.value);\n  }, [batchStats, t]);\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "const batchStats = () =&gt; {",
            "lineNumber": 678
          },
          {
            "lineNumber": 697
          },
          {
            "lineNumber": 698
          },
          {
            "text": "    return { totalSize, typeCount, allTags: Array.from(allTags).sort() };",
            "lineNumber": 699
          },
          {
            "text": "  }, [selectedFileIds, files]);",
            "lineNumber": 700
          },
          {
            "lineNumber": 701
          },
          {
            "text": "  const batchChartData = useMemo(() =&gt; {",
            "lineNumber": 702
          },
          {
            "text": "      if (!batchStats) return [];",
            "lineNumber": 703
          },
          {
            "text": "      const data: { label: string; value: number; color: string }[] = [];",
            "lineNumber": 704
          },
          {
            "lineNumber": 705
          },
          {
            "text": "      Object.entries(batchStats.typeCount).forEach(([type, count]) =&gt; {",
            "lineNumber": 706
          },
          {
            "text": "          let label = type;",
            "lineNumber": 707
          },
          {
            "text": "          let colorKey = type;",
            "lineNumber": 708
          },
          {
            "text": "          if (type === 'FOLDER') {",
            "lineNumber": 709
          },
          {
            "text": "              label = t('meta.folderType');",
            "lineNumber": 710
          },
          {
            "text": "              colorKey = 'FOLDER';",
            "lineNumber": 711
          },
          {
            "text": "          }",
            "lineNumber": 712
          },
          {
            "text": "          data.push({",
            "lineNumber": 713
          },
          {
            "text": "              label: label,",
            "lineNumber": 714
          },
          {
            "text": "              value: count,",
            "lineNumber": 715
          },
          {
            "text": "              color: typeColors[colorKey] || defaultColor",
            "lineNumber": 716
          },
          {
            "text": "          });",
            "lineNumber": 717
          },
          {
            "text": "      });",
            "lineNumber": 718
          },
          {
            "lineNumber": 719
          },
          {
            "text": "      return data.sort((a, b) =&gt; b.value - a.value);",
            "lineNumber": 720
          },
          {
            "text": "  }, [batchStats, t]);",
            "lineNumber": 721
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.2549333870410919
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 982
          },
          "endPosition": {
            "line": 1178,
            "column": 1
          }
        },
        "contents": "const FileCard = ({\n  file,\n  files,\n  isSelected,\n  renamingId,\n  layoutMode,\n  hoverPlayingId,\n  dragTargetId,\n  onFileClick,\n  onFileDoubleClick,\n  onContextMenu,\n  onStartRename,\n  onRenameSubmit,\n  onRenameCancel,\n  onSetHoverPlayingId,\n  onDragStart,\n  onDragEnd,\n  onDragOver,\n  onDragLeave,\n  onDropOnFolder,\n  onDropExternal,\n  style,\n  settings,\n  resourceRoot,\n  cachePath\n}: any) =&gt; {\n\n  \n  // Fallback to settings if direct props are missing\n  const effectiveResourceRoot = resourceRoot || settings?.paths?.resourceRoot;\n  const effectiveCachePath = cachePath || settings?.paths?.cacheRoot || (settings?.paths?.resourceRoot ? &#96;${settings.paths.resourceRoot}${settings.paths.resourceRoot.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96; : undefined);\n\n  return (\n    &lt;div\n        data-id={file.id}\n        draggable={renamingId !== file.id}\n        onDragStart={(e) =&gt; onDragStart(e, file.id)}\n        onDragEnd={onDragEnd}\n        onDragOver={onDragOver}\n        onDragLeave={onDragLeave}\n        onDrop={(e) =&gt; {\n            e.preventDefault();\n            e.stopPropagation(); // 阻止事件冒泡，防止触发外层的 Drop\n\n            if (file.type === FileType.FOLDER) {\n                // 尝试获取 JSON 数据 (虽然后面 startDrag 可能会清空它，但保留这个逻辑兼容 Web 模式)\n                const data = e.dataTransfer.getData('application/json');\n                let parsedIds: string[] = [];\n\n                if (data) {\n                    try { parsedIds = JSON.parse(data); } catch (err) {}\n                }\n\n                // 逻辑分流：\n                if (parsedIds.length &gt; 0) {\n                    // 情况1: 明确读到了 ID，肯定是内部移动\n                    onDropOnFolder(file.id, parsedIds);\n                } else {\n                    // 情况2: 没读到 ID。\n                    // 此时可能是：\n                    // A. 内部原生拖拽 (startDrag 导致数据被清空)\n                    // B. 真正的外部文件拖入\n                    \n                    // 我们直接传空数组 [] 给 onDropOnFolder。\n                    // App.tsx 会检查 isInternalDragRef：\n                    //   - 如果是 true -&gt; 视为内部移动，使用 selectedFileIds\n        }\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const FileCard = ({",
            "lineNumber": 983
          },
          {
            "text": "  file,",
            "lineNumber": 984
          },
          {
            "text": "  files,",
            "lineNumber": 985
          },
          {
            "text": "  isSelected,",
            "lineNumber": 986
          },
          {
            "text": "  renamingId,",
            "lineNumber": 987
          },
          {
            "text": "  layoutMode,",
            "lineNumber": 988
          },
          {
            "text": "  hoverPlayingId,",
            "lineNumber": 989
          },
          {
            "text": "  dragTargetId,",
            "lineNumber": 990
          },
          {
            "text": "  onFileClick,",
            "lineNumber": 991
          },
          {
            "text": "  onFileDoubleClick,",
            "lineNumber": 992
          },
          {
            "text": "  onContextMenu,",
            "lineNumber": 993
          },
          {
            "text": "  onStartRename,",
            "lineNumber": 994
          },
          {
            "text": "  onRenameSubmit,",
            "lineNumber": 995
          },
          {
            "text": "  onRenameCancel,",
            "lineNumber": 996
          },
          {
            "text": "  onSetHoverPlayingId,",
            "lineNumber": 997
          },
          {
            "text": "  onDragStart,",
            "lineNumber": 998
          },
          {
            "text": "  onDragEnd,",
            "lineNumber": 999
          },
          {
            "text": "  onDragOver,",
            "lineNumber": 1000
          },
          {
            "text": "  onDragLeave,",
            "lineNumber": 1001
          },
          {
            "text": "  onDropOnFolder,",
            "lineNumber": 1002
          },
          {
            "text": "  onDropExternal,",
            "lineNumber": 1003
          },
          {
            "text": "  style,",
            "lineNumber": 1004
          },
          {
            "text": "  settings,",
            "lineNumber": 1005
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 1006
          },
          {
            "text": "  cachePath",
            "lineNumber": 1007
          },
          {
            "text": "}: any) =&gt; {",
            "lineNumber": 1008
          },
          {
            "lineNumber": 1012
          },
          {
            "text": "  ",
            "lineNumber": 1013
          },
          {
            "text": "  // Fallback to settings if direct props are missing",
            "lineNumber": 1014
          },
          {
            "text": "  const effectiveResourceRoot = resourceRoot || settings?.paths?.resourceRoot;",
            "lineNumber": 1015
          },
          {
            "text": "  const effectiveCachePath = cachePath || settings?.paths?.cacheRoot || (settings?.paths?.resourceRoot ? &#96;${settings.paths.resourceRoot}${settings.paths.resourceRoot.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96; : undefined);",
            "lineNumber": 1016
          },
          {
            "lineNumber": 1017
          },
          {
            "text": "  return (",
            "lineNumber": 1018
          },
          {
            "text": "    &lt;div",
            "lineNumber": 1019
          },
          {
            "text": "        data-id={file.id}",
            "lineNumber": 1020
          },
          {
            "text": "        draggable={renamingId !== file.id}",
            "lineNumber": 1021
          },
          {
            "text": "        onDragStart={(e) =&gt; onDragStart(e, file.id)}",
            "lineNumber": 1022
          },
          {
            "text": "        onDragEnd={onDragEnd}",
            "lineNumber": 1023
          },
          {
            "text": "        onDragOver={onDragOver}",
            "lineNumber": 1024
          },
          {
            "text": "        onDragLeave={onDragLeave}",
            "lineNumber": 1025
          },
          {
            "text": "        onDrop={(e) =&gt; {",
            "lineNumber": 1026
          },
          {
            "text": "            e.preventDefault();",
            "lineNumber": 1027
          },
          {
            "text": "            e.stopPropagation(); // 阻止事件冒泡，防止触发外层的 Drop",
            "lineNumber": 1028
          },
          {
            "lineNumber": 1029
          },
          {
            "text": "            if (file.type === FileType.FOLDER) {",
            "lineNumber": 1030
          },
          {
            "text": "                // 尝试获取 JSON 数据 (虽然后面 startDrag 可能会清空它，但保留这个逻辑兼容 Web 模式)",
            "lineNumber": 1031
          },
          {
            "text": "                const data = e.dataTransfer.getData('application/json');",
            "lineNumber": 1032
          },
          {
            "text": "                let parsedIds: string[] = [];",
            "lineNumber": 1033
          },
          {
            "lineNumber": 1034
          },
          {
            "text": "                if (data) {",
            "lineNumber": 1035
          },
          {
            "text": "                    try { parsedIds = JSON.parse(data); } catch (err) {}",
            "lineNumber": 1036
          },
          {
            "text": "                }",
            "lineNumber": 1037
          },
          {
            "lineNumber": 1038
          },
          {
            "text": "                // 逻辑分流：",
            "lineNumber": 1039
          },
          {
            "text": "                if (parsedIds.length &gt; 0) {",
            "lineNumber": 1040
          },
          {
            "text": "                    // 情况1: 明确读到了 ID，肯定是内部移动",
            "lineNumber": 1041
          },
          {
            "text": "                    onDropOnFolder(file.id, parsedIds);",
            "lineNumber": 1042
          },
          {
            "text": "                } else {",
            "lineNumber": 1043
          },
          {
            "text": "                    // 情况2: 没读到 ID。",
            "lineNumber": 1044
          },
          {
            "text": "                    // 此时可能是：",
            "lineNumber": 1045
          },
          {
            "text": "                    // A. 内部原生拖拽 (startDrag 导致数据被清空)",
            "lineNumber": 1046
          },
          {
            "text": "                    // B. 真正的外部文件拖入",
            "lineNumber": 1047
          },
          {
            "text": "                    ",
            "lineNumber": 1048
          },
          {
            "text": "                    // 我们直接传空数组 [] 给 onDropOnFolder。",
            "lineNumber": 1049
          },
          {
            "text": "                    // App.tsx 会检查 isInternalDragRef：",
            "lineNumber": 1050
          },
          {
            "text": "                    //   - 如果是 true -&gt; 视为内部移动，使用 selectedFileIds",
            "lineNumber": 1051
          },
          {
            "text": "        }",
            "lineNumber": 1071
          },
          {
            "text": "};",
            "lineNumber": 1179
          }
        ]
      },
      "score": 0.2533876895904541
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "people-overview",
  "path": "src/App.tsx",
  "contextAfter": 10,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "people-overview",
    "path": "src/App.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/App.tsx",
              "matches": [
                {
                  "lineNumber": 1632,
                  "content": "            } else if (activeTab.viewMode === 'people-overview') {"
                },
                {
                  "lineNumber": 1633,
                  "content": "                updateActiveTab({ selectedPersonIds: [] });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1634,
                  "content": "            }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1635,
                  "content": "        }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1636,
                  "content": "    }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1637,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1638,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1639,
                  "content": "  // Optimized mouse move handler with throttling and direct DOM manipulation",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1640,
                  "content": "  const handleMouseMove = useCallback(throttle((e: React.MouseEvent) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1641,
                  "content": "    if (!isSelecting || !selectionBox) return;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1642,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1746,
                  "content": "    } else if (activeTab.viewMode === 'people-overview') {"
                },
                {
                  "lineNumber": 1747,
                  "content": "      // Person selection - optimized with efficient calculation",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1748,
                  "content": "      const selectedPersonIds: string[] = [];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1749,
                  "content": "      // Get all people in the same order as displayed in the grid",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1750,
                  "content": "      const allPeople = Object.values(state.people);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1751,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1752,
                  "content": "      // Calculate container width for layout calculation",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1753,
                  "content": "      const containerWidth = container.clientWidth;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1754,
                  "content": "      const thumbnailSize = state.thumbnailSize;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1755,
                  "content": "      const GAP = 16;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1756,
                  "content": "      const PADDING = 16;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2319,
                  "content": "      // Match the order used in FileGrid's useLayout function for people-overview"
                },
                {
                  "lineNumber": 2320,
                  "content": "      const allPeople = Object.values(state.people);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2321,
                  "content": "      const allPersonIds = allPeople.map(person =&gt; person.id);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2322,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2323,
                  "content": "      if (isCtrl) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2324,
                  "content": "        // Ctrl+Click: Toggle selection of this person",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2325,
                  "content": "        if (activeTab.selectedPersonIds.includes(personId)) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2326,
                  "content": "          // Remove from selection",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2327,
                  "content": "          newSelectedPersonIds = activeTab.selectedPersonIds.filter(id =&gt; id !== personId);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2328,
                  "content": "        } else {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2329,
                  "content": "          // Add to selection",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2758,
                  "content": "  const pushHistory = (folderId: string, viewingId: string | null, viewMode: 'browser' | 'tags-overview' | 'people-overview' = 'browser', searchQuery: string = '', searchScope: SearchScope = 'all', activeTags: string[] = [], activePersonId: string | null = null, nextScrollTop: number = 0, aiFilter: AiSearchFilter | null | undefined = null) =&gt; {"
                },
                {
                  "lineNumber": 2759,
                  "content": "      const currentScrollTop = selectionRef.current?.scrollTop ?? activeTab.scrollTop;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2760,
                  "content": "      updateActiveTab(prevTab =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2761,
                  "content": "          const stackCopy = [...prevTab.history.stack];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2762,
                  "content": "          if (prevTab.history.currentIndex &gt;= 0 &amp;&amp; prevTab.history.currentIndex &lt; stackCopy.length) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2763,
                  "content": "              stackCopy[prevTab.history.currentIndex] = { ...stackCopy[prevTab.history.currentIndex], scrollTop: currentScrollTop };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2764,
                  "content": "          }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2765,
                  "content": "          const newStack = [...stackCopy.slice(0, prevTab.history.currentIndex + 1), { folderId, viewingId, viewMode, searchQuery, searchScope, activeTags, activePersonId, aiFilter, scrollTop: nextScrollTop }];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2766,
                  "content": "          return { folderId, viewingFileId: viewingId, viewMode, searchQuery, searchScope, activeTags, activePersonId, aiFilter, scrollTop: nextScrollTop, selectedFileIds: viewingId ? [viewingId] : [], selectedPersonIds: [], selectedTagIds: [], history: { stack: newStack, currentIndex: newStack.length - 1 } };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2767,
                  "content": "      });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2768,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3069,
                  "content": "  const enterPeopleOverview = () =&gt; pushHistory(activeTab.folderId, null, 'people-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);"
                },
                {
                  "lineNumber": 3070,
                  "content": "  const enterPersonView = (personId: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'all', [], personId, 0);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3071,
                  "content": "  const handleClearTagFilter = (tagToRemove: string) =&gt; updateActiveTab(prev =&gt; ({ activeTags: prev.activeTags.filter(t =&gt; t !== tagToRemove) }));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3072,
                  "content": "  const handleClearAllTags = () =&gt; updateActiveTab({ activeTags: [] });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3073,
                  "content": "  const handleClearPersonFilter = () =&gt; updateActiveTab({ activePersonId: null });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3074,
                  "isContextLine": true
                },
                {
                  "lineNumber": 3075,
                  "content": "  const handleRenameSubmit = async (value: string, id: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3076,
                  "content": "      value = value.trim();",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3077,
                  "content": "      const file = state.files[id];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3078,
                  "content": "      if (!value || value === file.name) { setState(s =&gt; ({ ...s, renamingId: null })); return; }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3079,
                  "content": "      if (file.path) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3231,
                  "content": "  const handleNavigateUp = () =&gt; { if (activeTab.activePersonId) { enterPeopleOverview(); } else if (activeTab.viewMode === 'people-overview' || activeTab.viewMode === 'tags-overview') { enterFolder(activeTab.folderId); } else { const current = state.files[activeTab.folderId]; if (current &amp;&amp; current.parentId) { enterFolder(current.parentId); } } };"
                },
                {
                  "lineNumber": 3232,
                  "content": "  const minimizeTask = (id: string) =&gt; { setState(prev =&gt; ({ ...prev, tasks: prev.tasks.map(t =&gt; t.id === id ? { ...t, minimized: true } : t) })); };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3233,
                  "content": "  const onRestoreTask = (id: string) =&gt; { setState(prev =&gt; ({ ...prev, tasks: prev.tasks.map(t =&gt; t.id === id ? { ...t, minimized: false } : t) })); };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3234,
                  "isContextLine": true
                },
                {
                  "lineNumber": 3235,
                  "content": "  const handleCreateFolder = async (targetId?: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3236,
                  "content": "      const parentId = targetId || activeTab.folderId;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3237,
                  "content": "      // Check if we're in the root directory (no parent folder)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3238,
                  "content": "      if (!parentId) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3239,
                  "content": "          // Create folder in root directory",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3240,
                  "content": "          const baseName = t('context.newFolder');",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3241,
                  "content": "          let name = baseName;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4698,
                  "content": "                  ) : activeTab.viewMode === 'people-overview' ? ("
                },
                {
                  "lineNumber": 4699,
                  "content": "                    &lt;div className=\"flex items-center w-full justify-between\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4700,
                  "content": "                      &lt;div className=\"flex items-center\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4701,
                  "content": "                        &lt;User size={12} className=\"mr-1\"/&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4702,
                  "content": "                        &lt;span&gt;{t('context.allPeople')}&lt;/span&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4703,
                  "content": "                      &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4704,
                  "content": "                      &lt;div className=\"text-[10px] opacity-60\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4705,
                  "content": "                        {Object.keys(state.people).length} {t('context.items')}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4706,
                  "content": "                      &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4707,
                  "content": "                    &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4708,
                  "content": "                  ) : (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5024,
                  "content": "            {activeTab.viewMode === 'people-overview' ? ("
                },
                {
                  "lineNumber": 5025,
                  "content": "              // 人物主界面：显示新建人物选项",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5026,
                  "content": "              &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer\" onClick={() =&gt; { handleCreatePerson(); closeContextMenu(); }}&gt;{t('context.newPerson')}&lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5027,
                  "content": "            ) : (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5028,
                  "content": "              // 其他界面：显示原有选项",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5029,
                  "content": "              &lt;&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5030,
                  "content": "                &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer\" onClick={() =&gt; { handleRefresh(); closeContextMenu(); }}&gt;{t('context.refresh')}&lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5031,
                  "content": "                &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer\" onClick={() =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5032,
                  "content": "                  // 全选当前目录下的所有内容",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5033,
                  "content": "                  updateActiveTab({ selectedFileIds: displayFileIds });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5034,
                  "content": "                  closeContextMenu();",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 88,
          "totalMatchedLines": 8
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


查看人物搜索的实现，以及搜索范围如何影响搜索结果：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/App.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "搜索人物名称 person name search filter",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleRefresh = async \nprev =&gt; {\nconst traverseAndMark = \n\n                      const file = prev.files[fileId];\n                      if (file &amp;&amp; file.children) {\n                          file.children.forEach(childId =&gt; traverseAndMark(childId));\n                      }\n                  };\n                  traverseAndMark(targetFolderId);\n                  \n                  // Then remove them from mergedFiles\n                  filesToRemove.forEach(fileId =&gt; {\n                      delete mergedFiles[fileId];\n                  });\n                  \n                  // 2. Merge new files with existing ones, preserving user data\n                  Object.entries(result.files).forEach(([fileId, newFile]) =&gt; {\n                      const existingFile = prev.files[fileId];\n                      if (existingFile) {\n                          // Merge files, preserving user-customized data\n                          mergedFiles[fileId] = {\n                              ...newFile,\n                              // Preserve user-added information\n                              tags: existingFile.tags,\n                              description: existingFile.description,\n                              url: existingFile.url,\n                              aiData: existingFile.aiData,\n                              sourceUrl: existingFile.sourceUrl,\n                              author: existingFile.author,\n                              category: existingFile.category,\n                              // Use new children from scan to reflect file system changes (add/remove)\n                              children: newFile.children || existingFile.children,\n                              // IMPORTANT: Preserve parentId for the scanned root to maintain tree structure\n                              parentId: (fileId === targetFolderId) ? existingFile.parentId : newFile.parentId\n                          };\n                      } else {\n                          // New file, add as-is\n                          mergedFiles[fileId] = newFile;\n                  }\n              }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 3
              },
              "endPosition": {
                "line": 1305,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 9
              },
              "endPosition": {
                "line": 1305,
                "column": 26
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 34
              },
              "endPosition": {
                "line": 1306,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleRefresh = async ",
            "lineNumber": 1346
          },
          {
            "text": "prev =&gt; {",
            "lineNumber": 1355
          },
          {
            "text": "const traverseAndMark = ",
            "lineNumber": 1362
          },
          {
            "lineNumber": 1363
          },
          {
            "text": "                      const file = prev.files[fileId];",
            "lineNumber": 1364
          },
          {
            "text": "                      if (file &amp;&amp; file.children) {",
            "lineNumber": 1365
          },
          {
            "text": "                          file.children.forEach(childId =&gt; traverseAndMark(childId));",
            "lineNumber": 1366
          },
          {
            "text": "                      }",
            "lineNumber": 1367
          },
          {
            "text": "                  };",
            "lineNumber": 1368
          },
          {
            "text": "                  traverseAndMark(targetFolderId);",
            "lineNumber": 1369
          },
          {
            "text": "                  ",
            "lineNumber": 1370
          },
          {
            "text": "                  // Then remove them from mergedFiles",
            "lineNumber": 1371
          },
          {
            "text": "                  filesToRemove.forEach(fileId =&gt; {",
            "lineNumber": 1372
          },
          {
            "text": "                      delete mergedFiles[fileId];",
            "lineNumber": 1373
          },
          {
            "text": "                  });",
            "lineNumber": 1374
          },
          {
            "text": "                  ",
            "lineNumber": 1375
          },
          {
            "text": "                  // 2. Merge new files with existing ones, preserving user data",
            "lineNumber": 1376
          },
          {
            "text": "                  Object.entries(result.files).forEach(([fileId, newFile]) =&gt; {",
            "lineNumber": 1377
          },
          {
            "text": "                      const existingFile = prev.files[fileId];",
            "lineNumber": 1378
          },
          {
            "text": "                      if (existingFile) {",
            "lineNumber": 1379
          },
          {
            "text": "                          // Merge files, preserving user-customized data",
            "lineNumber": 1380
          },
          {
            "text": "                          mergedFiles[fileId] = {",
            "lineNumber": 1381
          },
          {
            "text": "                              ...newFile,",
            "lineNumber": 1382
          },
          {
            "text": "                              // Preserve user-added information",
            "lineNumber": 1383
          },
          {
            "text": "                              tags: existingFile.tags,",
            "lineNumber": 1384
          },
          {
            "text": "                              description: existingFile.description,",
            "lineNumber": 1385
          },
          {
            "text": "                              url: existingFile.url,",
            "lineNumber": 1386
          },
          {
            "text": "                              aiData: existingFile.aiData,",
            "lineNumber": 1387
          },
          {
            "text": "                              sourceUrl: existingFile.sourceUrl,",
            "lineNumber": 1388
          },
          {
            "text": "                              author: existingFile.author,",
            "lineNumber": 1389
          },
          {
            "text": "                              category: existingFile.category,",
            "lineNumber": 1390
          },
          {
            "text": "                              // Use new children from scan to reflect file system changes (add/remove)",
            "lineNumber": 1391
          },
          {
            "text": "                              children: newFile.children || existingFile.children,",
            "lineNumber": 1392
          },
          {
            "text": "                              // IMPORTANT: Preserve parentId for the scanned root to maintain tree structure",
            "lineNumber": 1393
          },
          {
            "text": "                              parentId: (fileId === targetFolderId) ? existingFile.parentId : newFile.parentId",
            "lineNumber": 1394
          },
          {
            "text": "                          };",
            "lineNumber": 1395
          },
          {
            "text": "                      } else {",
            "lineNumber": 1396
          },
          {
            "text": "                          // New file, add as-is",
            "lineNumber": 1397
          },
          {
            "text": "                          mergedFiles[fileId] = newFile;",
            "lineNumber": 1398
          },
          {
            "text": "                  }",
            "lineNumber": 1400
          },
          {
            "text": "              }",
            "lineNumber": 1403
          },
          {
            "text": ";",
            "lineNumber": 1421
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.3856818675994873
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleOpenFolder = async \nprev =&gt; { \n\n                      }; \n                  }); \n              } \n          } catch (e) { console.error(\"Failed to open directory\", e); } \n  };\n  \n  const handleRefresh = async (folderId?: string) =&gt; {\n      const targetFolderId = folderId || activeTab.folderId;\n      const folder = state.files[targetFolderId];\n      \n      // Handle both Electron and Tauri environments\n      if (folder?.path) {\n          const path = folder.path;\n          try {\n              const result = await scanDirectory(path, true);\n              setState(prev =&gt; {\n                  // Create a copy of all files\n                  const mergedFiles = { ...prev.files };\n                  \n                  // 1. Remove all files in the refreshed folder's subtree\n                  // First, identify all files in the subtree\n                  const filesToRemove = new Set&lt;string&gt;();\n                  const traverseAndMark = (fileId: string) =&gt; {\n                      filesToRemove.add(fileId);\n                      const file = prev.files[fileId];\n                      if (file &amp;&amp; file.children)\n;\n              }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 3
              },
              "endPosition": {
                "line": 1305,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 9
              },
              "endPosition": {
                "line": 1305,
                "column": 26
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 34
              },
              "endPosition": {
                "line": 1306,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 1313,
                "column": 22
              },
              "endPosition": {
                "line": 1313,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 1313,
                "column": 38
              },
              "endPosition": {
                "line": 1314,
                "column": 13
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleOpenFolder = async ",
            "lineNumber": 1311
          },
          {
            "text": "prev =&gt; { ",
            "lineNumber": 1322
          },
          {
            "lineNumber": 1339
          },
          {
            "text": "                      }; ",
            "lineNumber": 1340
          },
          {
            "text": "                  }); ",
            "lineNumber": 1341
          },
          {
            "text": "              } ",
            "lineNumber": 1342
          },
          {
            "text": "          } catch (e) { console.error(\"Failed to open directory\", e); } ",
            "lineNumber": 1343
          },
          {
            "text": "  };",
            "lineNumber": 1344
          },
          {
            "text": "  ",
            "lineNumber": 1345
          },
          {
            "text": "  const handleRefresh = async (folderId?: string) =&gt; {",
            "lineNumber": 1346
          },
          {
            "text": "      const targetFolderId = folderId || activeTab.folderId;",
            "lineNumber": 1347
          },
          {
            "text": "      const folder = state.files[targetFolderId];",
            "lineNumber": 1348
          },
          {
            "text": "      ",
            "lineNumber": 1349
          },
          {
            "text": "      // Handle both Electron and Tauri environments",
            "lineNumber": 1350
          },
          {
            "text": "      if (folder?.path) {",
            "lineNumber": 1351
          },
          {
            "text": "          const path = folder.path;",
            "lineNumber": 1352
          },
          {
            "text": "          try {",
            "lineNumber": 1353
          },
          {
            "text": "              const result = await scanDirectory(path, true);",
            "lineNumber": 1354
          },
          {
            "text": "              setState(prev =&gt; {",
            "lineNumber": 1355
          },
          {
            "text": "                  // Create a copy of all files",
            "lineNumber": 1356
          },
          {
            "text": "                  const mergedFiles = { ...prev.files };",
            "lineNumber": 1357
          },
          {
            "text": "                  ",
            "lineNumber": 1358
          },
          {
            "text": "                  // 1. Remove all files in the refreshed folder's subtree",
            "lineNumber": 1359
          },
          {
            "text": "                  // First, identify all files in the subtree",
            "lineNumber": 1360
          },
          {
            "text": "                  const filesToRemove = new Set&lt;string&gt;();",
            "lineNumber": 1361
          },
          {
            "text": "                  const traverseAndMark = (fileId: string) =&gt; {",
            "lineNumber": 1362
          },
          {
            "text": "                      filesToRemove.add(fileId);",
            "lineNumber": 1363
          },
          {
            "text": "                      const file = prev.files[fileId];",
            "lineNumber": 1364
          },
          {
            "text": "                      if (file &amp;&amp; file.children)",
            "lineNumber": 1365
          },
          {
            "text": ";",
            "lineNumber": 1368
          },
          {
            "text": "              }",
            "lineNumber": 1403
          },
          {
            "text": ";",
            "lineNumber": 1421
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.36435338854789734
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleRefresh = async \nprev =&gt; {\n\n                  // Add a lastRefresh timestamp to force a re-render\n                  lastRefresh: Date.now()\n              };\n              \n              return { ...prev, files };\n          });\n      }\n  };\n\n  // ... (keep drag and drop, clicks, etc.)\n  // Drag over handler for the main container\n  const handleDragOver = (e: React.DragEvent) =&gt; {\n      e.preventDefault();\n      // 避免在此处使用 e.stopPropagation()，因为这会阻止事件流向子组件，导致子组件的拖拽逻辑失效 (如文件夹高亮)。\n\n      // Only show overlay for file browser view mode\n      if (activeTab.viewMode !== 'browser') {\n          if (isDragOver) {\n              setIsDragOver(false);\n          }\n          return;\n      }\n\n      // 1. 【内部拖拽检查】: 如果是内部拖拽，强制保持外部界面隐藏\n      if (isInternalDragRef.current) {\n          // 关键：如果状态已经是 isDragOver=true，则立即关闭它，防止闪烁\n          if (isDragOver) {\n              setIsDragOver(false);\n          }\n          // 允许事件向下传递，但不再执行下面的外部拖拽检测逻辑\n          return;\n      }\n\n      // 2. 【外部拖拽检查】: 检查是否有 Files 类型\n      if (e.dataTransfer.types.includes('Files')) {\n          // 关键：只有状态是 false 时才设置为 true，减少不必要的 state 更新\n          if (!isDragOver) {\n              setIsDragOver(true);\n          }\n          \n          // 计算复制/移动动作的逻辑\n          const container = e.currentTarget as HTMLElement;\n          const rect = container.getBoundingClientRect();\n          const x = e.clientX - rect.left;\n          if (x &lt; rect.width / 2) setDragAction('copy');\n          else setDragAction('move');\n          \n      } else {\n          // 如果拖拽的内容不是文件 (例如：拖拽文本或URL)\n          // 关键：只有状态是 true 时才设置为 false\n          if (isDragOver) {\n              setIsDragOver(false);\n          }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 3
              },
              "endPosition": {
                "line": 1305,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 9
              },
              "endPosition": {
                "line": 1305,
                "column": 26
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 34
              },
              "endPosition": {
                "line": 1306,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 1412,
                "column": 22
              },
              "endPosition": {
                "line": 1412,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 1412,
                "column": 40
              },
              "endPosition": {
                "line": 1413,
                "column": 13
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleRefresh = async ",
            "lineNumber": 1346
          },
          {
            "text": "prev =&gt; {",
            "lineNumber": 1409
          },
          {
            "lineNumber": 1413
          },
          {
            "text": "                  // Add a lastRefresh timestamp to force a re-render",
            "lineNumber": 1414
          },
          {
            "text": "                  lastRefresh: Date.now()",
            "lineNumber": 1415
          },
          {
            "text": "              };",
            "lineNumber": 1416
          },
          {
            "text": "              ",
            "lineNumber": 1417
          },
          {
            "text": "              return { ...prev, files };",
            "lineNumber": 1418
          },
          {
            "text": "          });",
            "lineNumber": 1419
          },
          {
            "text": "      }",
            "lineNumber": 1420
          },
          {
            "text": "  };",
            "lineNumber": 1421
          },
          {
            "lineNumber": 1422
          },
          {
            "text": "  // ... (keep drag and drop, clicks, etc.)",
            "lineNumber": 1423
          },
          {
            "text": "  // Drag over handler for the main container",
            "lineNumber": 1424
          },
          {
            "text": "  const handleDragOver = (e: React.DragEvent) =&gt; {",
            "lineNumber": 1425
          },
          {
            "text": "      e.preventDefault();",
            "lineNumber": 1426
          },
          {
            "text": "      // 避免在此处使用 e.stopPropagation()，因为这会阻止事件流向子组件，导致子组件的拖拽逻辑失效 (如文件夹高亮)。",
            "lineNumber": 1427
          },
          {
            "lineNumber": 1428
          },
          {
            "text": "      // Only show overlay for file browser view mode",
            "lineNumber": 1429
          },
          {
            "text": "      if (activeTab.viewMode !== 'browser') {",
            "lineNumber": 1430
          },
          {
            "text": "          if (isDragOver) {",
            "lineNumber": 1431
          },
          {
            "text": "              setIsDragOver(false);",
            "lineNumber": 1432
          },
          {
            "text": "          }",
            "lineNumber": 1433
          },
          {
            "text": "          return;",
            "lineNumber": 1434
          },
          {
            "text": "      }",
            "lineNumber": 1435
          },
          {
            "lineNumber": 1436
          },
          {
            "text": "      // 1. 【内部拖拽检查】: 如果是内部拖拽，强制保持外部界面隐藏",
            "lineNumber": 1437
          },
          {
            "text": "      if (isInternalDragRef.current) {",
            "lineNumber": 1438
          },
          {
            "text": "          // 关键：如果状态已经是 isDragOver=true，则立即关闭它，防止闪烁",
            "lineNumber": 1439
          },
          {
            "text": "          if (isDragOver) {",
            "lineNumber": 1440
          },
          {
            "text": "              setIsDragOver(false);",
            "lineNumber": 1441
          },
          {
            "text": "          }",
            "lineNumber": 1442
          },
          {
            "text": "          // 允许事件向下传递，但不再执行下面的外部拖拽检测逻辑",
            "lineNumber": 1443
          },
          {
            "text": "          return;",
            "lineNumber": 1444
          },
          {
            "text": "      }",
            "lineNumber": 1445
          },
          {
            "lineNumber": 1446
          },
          {
            "text": "      // 2. 【外部拖拽检查】: 检查是否有 Files 类型",
            "lineNumber": 1447
          },
          {
            "text": "      if (e.dataTransfer.types.includes('Files')) {",
            "lineNumber": 1448
          },
          {
            "text": "          // 关键：只有状态是 false 时才设置为 true，减少不必要的 state 更新",
            "lineNumber": 1449
          },
          {
            "text": "          if (!isDragOver) {",
            "lineNumber": 1450
          },
          {
            "text": "              setIsDragOver(true);",
            "lineNumber": 1451
          },
          {
            "text": "          }",
            "lineNumber": 1452
          },
          {
            "text": "          ",
            "lineNumber": 1453
          },
          {
            "text": "          // 计算复制/移动动作的逻辑",
            "lineNumber": 1454
          },
          {
            "text": "          const container = e.currentTarget as HTMLElement;",
            "lineNumber": 1455
          },
          {
            "text": "          const rect = container.getBoundingClientRect();",
            "lineNumber": 1456
          },
          {
            "text": "          const x = e.clientX - rect.left;",
            "lineNumber": 1457
          },
          {
            "text": "          if (x &lt; rect.width / 2) setDragAction('copy');",
            "lineNumber": 1458
          },
          {
            "text": "          else setDragAction('move');",
            "lineNumber": 1459
          },
          {
            "text": "          ",
            "lineNumber": 1460
          },
          {
            "text": "      } else {",
            "lineNumber": 1461
          },
          {
            "text": "          // 如果拖拽的内容不是文件 (例如：拖拽文本或URL)",
            "lineNumber": 1462
          },
          {
            "text": "          // 关键：只有状态是 true 时才设置为 false",
            "lineNumber": 1463
          },
          {
            "text": "          if (isDragOver) {",
            "lineNumber": 1464
          },
          {
            "text": "              setIsDragOver(false);",
            "lineNumber": 1465
          },
          {
            "text": "          }",
            "lineNumber": 1466
          },
          {
            "text": ";",
            "lineNumber": 1468
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.36152929067611694
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst groupedFiles = () =&gt; {\nid =&gt; {\n\n      if (!groups[key]) groups[key] = []; groups[key].push(id);\n    });\n    return Object.entries(groups).map(([title, ids]) =&gt; ({ id: title, title, fileIds: ids })).sort((a, b) =&gt; a.title.localeCompare(b.title));\n  }, [displayFileIds, groupBy, state.files, t]);\n\n  // ... (keep handleOpenFolder and handleRefresh)\n  const handleOpenFolder = async () =&gt; { \n      try { \n          const path = await openDirectory(); \n          if (path) { \n                  // 确保缓存目录存在（在资源根目录下创建 .Aurora_Cache 文件夹）\n                  if (isTauriEnvironment()) {\n                      const cachePath = &#96;${path}${path.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96;;\n                      await ensureDirectory(cachePath);\n                  }\n                  \n                  const result = await scanDirectory(path, true); \n                  setState(prev =&gt; { \n                      const newRoots = Array.from(new Set([...prev.roots, ...result.roots])); \n                      const newFiles = { ...prev.files, ...result.files }; \n                      const updatedTabs = prev.tabs.map(t =&gt; t.id === prev.activeTabId ? { ...t, folderId: result.roots[0], history: { stack: [{ folderId: result.roots[0], viewingId: null, viewMode: 'browser' as const, searchQuery: '', searchScope: 'all' as SearchScope, activeTags: [], activePersonId: null }], currentIndex: 0 } } : t); \n                      \n                      return { \n                          ...prev, \n                          roots: newRoots, \n                          files: newFiles, \n                          expandedFolderIds: [...prev.expandedFolderIds, ...result.roots], \n                          tabs: updatedTabs,\n                          settings: {\n                              ...prev.settings,\n                              paths: {\n                                  ...prev.settings.paths,\n                                  resourceRoot: path\n                              }\n                          }\n                      }; \n                  }); \n              } \n          } catch (e) { console.error(\"Failed to open directory\", e); } \n  };\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 3
              },
              "endPosition": {
                "line": 1305,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 9
              },
              "endPosition": {
                "line": 1305,
                "column": 26
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const groupedFiles = () =&gt; {",
            "lineNumber": 1283
          },
          {
            "text": "id =&gt; {",
            "lineNumber": 1286
          },
          {
            "lineNumber": 1304
          },
          {
            "text": "      if (!groups[key]) groups[key] = []; groups[key].push(id);",
            "lineNumber": 1305
          },
          {
            "text": "    });",
            "lineNumber": 1306
          },
          {
            "text": "    return Object.entries(groups).map(([title, ids]) =&gt; ({ id: title, title, fileIds: ids })).sort((a, b) =&gt; a.title.localeCompare(b.title));",
            "lineNumber": 1307
          },
          {
            "text": "  }, [displayFileIds, groupBy, state.files, t]);",
            "lineNumber": 1308
          },
          {
            "lineNumber": 1309
          },
          {
            "text": "  // ... (keep handleOpenFolder and handleRefresh)",
            "lineNumber": 1310
          },
          {
            "text": "  const handleOpenFolder = async () =&gt; { ",
            "lineNumber": 1311
          },
          {
            "text": "      try { ",
            "lineNumber": 1312
          },
          {
            "text": "          const path = await openDirectory(); ",
            "lineNumber": 1313
          },
          {
            "text": "          if (path) { ",
            "lineNumber": 1314
          },
          {
            "text": "                  // 确保缓存目录存在（在资源根目录下创建 .Aurora_Cache 文件夹）",
            "lineNumber": 1315
          },
          {
            "text": "                  if (isTauriEnvironment()) {",
            "lineNumber": 1316
          },
          {
            "text": "                      const cachePath = &#96;${path}${path.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96;;",
            "lineNumber": 1317
          },
          {
            "text": "                      await ensureDirectory(cachePath);",
            "lineNumber": 1318
          },
          {
            "text": "                  }",
            "lineNumber": 1319
          },
          {
            "text": "                  ",
            "lineNumber": 1320
          },
          {
            "text": "                  const result = await scanDirectory(path, true); ",
            "lineNumber": 1321
          },
          {
            "text": "                  setState(prev =&gt; { ",
            "lineNumber": 1322
          },
          {
            "text": "                      const newRoots = Array.from(new Set([...prev.roots, ...result.roots])); ",
            "lineNumber": 1323
          },
          {
            "text": "                      const newFiles = { ...prev.files, ...result.files }; ",
            "lineNumber": 1324
          },
          {
            "text": "                      const updatedTabs = prev.tabs.map(t =&gt; t.id === prev.activeTabId ? { ...t, folderId: result.roots[0], history: { stack: [{ folderId: result.roots[0], viewingId: null, viewMode: 'browser' as const, searchQuery: '', searchScope: 'all' as SearchScope, activeTags: [], activePersonId: null }], currentIndex: 0 } } : t); ",
            "lineNumber": 1325
          },
          {
            "text": "                      ",
            "lineNumber": 1326
          },
          {
            "text": "                      return { ",
            "lineNumber": 1327
          },
          {
            "text": "                          ...prev, ",
            "lineNumber": 1328
          },
          {
            "text": "                          roots: newRoots, ",
            "lineNumber": 1329
          },
          {
            "text": "                          files: newFiles, ",
            "lineNumber": 1330
          },
          {
            "text": "                          expandedFolderIds: [...prev.expandedFolderIds, ...result.roots], ",
            "lineNumber": 1331
          },
          {
            "text": "                          tabs: updatedTabs,",
            "lineNumber": 1332
          },
          {
            "text": "                          settings: {",
            "lineNumber": 1333
          },
          {
            "text": "                              ...prev.settings,",
            "lineNumber": 1334
          },
          {
            "text": "                              paths: {",
            "lineNumber": 1335
          },
          {
            "text": "                                  ...prev.settings.paths,",
            "lineNumber": 1336
          },
          {
            "text": "                                  resourceRoot: path",
            "lineNumber": 1337
          },
          {
            "text": "                              }",
            "lineNumber": 1338
          },
          {
            "text": "                          }",
            "lineNumber": 1339
          },
          {
            "text": "                      }; ",
            "lineNumber": 1340
          },
          {
            "text": "                  }); ",
            "lineNumber": 1341
          },
          {
            "text": "              } ",
            "lineNumber": 1342
          },
          {
            "text": "          } catch (e) { console.error(\"Failed to open directory\", e); } ",
            "lineNumber": 1343
          },
          {
            "text": "  };",
            "lineNumber": 1344
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.33721479773521423
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleRefresh = async \nprev =&gt; {\n([fileId, newFile]) =&gt; {\n\n                      } else {\n                          // New file, add as-is\n                          mergedFiles[fileId] = newFile;\n                      }\n                  });\n                  \n                  return { ...prev, files: mergedFiles };\n              });\n          } catch (e) {\n              console.error(\"Failed to refresh directory\", e);\n          }\n      } else if (folder) {\n          // Handle virtual folders with no actual path\n          setState(prev =&gt; {\n              // Force a complete re-render by updating the folder's lastRefresh timestamp\n              const files = { ...prev.files };\n              files[targetFolderId] = {\n                  ...folder,\n                  // Add a lastRefresh timestamp to force a re-render\n                  lastRefresh: Date.now()\n              };\n              \n              return { ...prev, files };\n          });\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 3
              },
              "endPosition": {
                "line": 1305,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 9
              },
              "endPosition": {
                "line": 1305,
                "column": 26
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 34
              },
              "endPosition": {
                "line": 1306,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleRefresh = async ",
            "lineNumber": 1346
          },
          {
            "text": "prev =&gt; {",
            "lineNumber": 1355
          },
          {
            "text": "([fileId, newFile]) =&gt; {",
            "lineNumber": 1377
          },
          {
            "lineNumber": 1395
          },
          {
            "text": "                      } else {",
            "lineNumber": 1396
          },
          {
            "text": "                          // New file, add as-is",
            "lineNumber": 1397
          },
          {
            "text": "                          mergedFiles[fileId] = newFile;",
            "lineNumber": 1398
          },
          {
            "text": "                      }",
            "lineNumber": 1399
          },
          {
            "text": "                  });",
            "lineNumber": 1400
          },
          {
            "text": "                  ",
            "lineNumber": 1401
          },
          {
            "text": "                  return { ...prev, files: mergedFiles };",
            "lineNumber": 1402
          },
          {
            "text": "              });",
            "lineNumber": 1403
          },
          {
            "text": "          } catch (e) {",
            "lineNumber": 1404
          },
          {
            "text": "              console.error(\"Failed to refresh directory\", e);",
            "lineNumber": 1405
          },
          {
            "text": "          }",
            "lineNumber": 1406
          },
          {
            "text": "      } else if (folder) {",
            "lineNumber": 1407
          },
          {
            "text": "          // Handle virtual folders with no actual path",
            "lineNumber": 1408
          },
          {
            "text": "          setState(prev =&gt; {",
            "lineNumber": 1409
          },
          {
            "text": "              // Force a complete re-render by updating the folder's lastRefresh timestamp",
            "lineNumber": 1410
          },
          {
            "text": "              const files = { ...prev.files };",
            "lineNumber": 1411
          },
          {
            "text": "              files[targetFolderId] = {",
            "lineNumber": 1412
          },
          {
            "text": "                  ...folder,",
            "lineNumber": 1413
          },
          {
            "text": "                  // Add a lastRefresh timestamp to force a re-render",
            "lineNumber": 1414
          },
          {
            "text": "                  lastRefresh: Date.now()",
            "lineNumber": 1415
          },
          {
            "text": "              };",
            "lineNumber": 1416
          },
          {
            "text": "              ",
            "lineNumber": 1417
          },
          {
            "text": "              return { ...prev, files };",
            "lineNumber": 1418
          },
          {
            "text": "          });",
            "lineNumber": 1419
          },
          {
            "text": ";",
            "lineNumber": 1421
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.2944209575653076
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst performAiSearch = async \nconst res = await \n { 'Content-Type': 'application/json' },\n                      body: JSON.stringify(body)\n                  });\n                  const resData = await res.json();\n                  if (resData?.response) {\n                      try { result = JSON.parse(resData.response); } catch(e){}\n                  }\n              } catch (e) {\n                  console.error('AI search failed:', e);\n              }\n          } else if (aiConfig.provider === 'lmstudio') {\n              const body = { model: aiConfig.lmstudio.model, messages: [{ role: \"user\", content: prompt }], max_tokens: 500, stream: false };\n              let endpoint = aiConfig.lmstudio.endpoint.replace(/\\/+$/, '');\n              if (!endpoint.endsWith('/v1')) endpoint += '/v1';\n              try {\n                  const res = await fetch(&#96;${endpoint}/chat/completions&#96;, {\n                      method: 'POST',\n                      headers: { 'Content-Type': 'application/json' },\n                      body: JSON.stringify(body)\n                  });\n                  const resData = await res.json();\n                  if (resData?.choices?.[0]?.message?.content) {\n                      try { result = JSON.parse(resData.choices[0].message.content); } catch(e){}\n                  }\n              } catch (e) {\n                  console.error('AI search failed:', e);\n              }\n          }\n\n          if (result) {\n              const aiFilter = {\n                  originalQuery: query\n              };\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const performAiSearch = async ",
            "lineNumber": 2947
          },
          {
            "text": "const res = await ",
            "lineNumber": 2997
          },
          {
            "text": " { 'Content-Type': 'application/json' },",
            "lineNumber": 2999
          },
          {
            "text": "                      body: JSON.stringify(body)",
            "lineNumber": 3000
          },
          {
            "text": "                  });",
            "lineNumber": 3001
          },
          {
            "text": "                  const resData = await res.json();",
            "lineNumber": 3002
          },
          {
            "text": "                  if (resData?.response) {",
            "lineNumber": 3003
          },
          {
            "text": "                      try { result = JSON.parse(resData.response); } catch(e){}",
            "lineNumber": 3004
          },
          {
            "text": "                  }",
            "lineNumber": 3005
          },
          {
            "text": "              } catch (e) {",
            "lineNumber": 3006
          },
          {
            "text": "                  console.error('AI search failed:', e);",
            "lineNumber": 3007
          },
          {
            "text": "              }",
            "lineNumber": 3008
          },
          {
            "text": "          } else if (aiConfig.provider === 'lmstudio') {",
            "lineNumber": 3009
          },
          {
            "text": "              const body = { model: aiConfig.lmstudio.model, messages: [{ role: \"user\", content: prompt }], max_tokens: 500, stream: false };",
            "lineNumber": 3010
          },
          {
            "text": "              let endpoint = aiConfig.lmstudio.endpoint.replace(/\\/+$/, '');",
            "lineNumber": 3011
          },
          {
            "text": "              if (!endpoint.endsWith('/v1')) endpoint += '/v1';",
            "lineNumber": 3012
          },
          {
            "text": "              try {",
            "lineNumber": 3013
          },
          {
            "text": "                  const res = await fetch(&#96;${endpoint}/chat/completions&#96;, {",
            "lineNumber": 3014
          },
          {
            "text": "                      method: 'POST',",
            "lineNumber": 3015
          },
          {
            "text": "                      headers: { 'Content-Type': 'application/json' },",
            "lineNumber": 3016
          },
          {
            "text": "                      body: JSON.stringify(body)",
            "lineNumber": 3017
          },
          {
            "text": "                  });",
            "lineNumber": 3018
          },
          {
            "text": "                  const resData = await res.json();",
            "lineNumber": 3019
          },
          {
            "text": "                  if (resData?.choices?.[0]?.message?.content) {",
            "lineNumber": 3020
          },
          {
            "text": "                      try { result = JSON.parse(resData.choices[0].message.content); } catch(e){}",
            "lineNumber": 3021
          },
          {
            "text": "                  }",
            "lineNumber": 3022
          },
          {
            "text": "              } catch (e) {",
            "lineNumber": 3023
          },
          {
            "text": "                  console.error('AI search failed:', e);",
            "lineNumber": 3024
          },
          {
            "text": "              }",
            "lineNumber": 3025
          },
          {
            "text": "          }",
            "lineNumber": 3026
          },
          {
            "lineNumber": 3027
          },
          {
            "text": "          if (result) {",
            "lineNumber": 3028
          },
          {
            "text": "              const aiFilter = {",
            "lineNumber": 3029
          },
          {
            "text": "                  originalQuery: query",
            "lineNumber": 3030
          },
          {
            "text": "              };",
            "lineNumber": 3035
          },
          {
            "text": ";",
            "lineNumber": 3054
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.2805593013763428
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n\n\n  // Handle close confirmation actions\n  const handleCloseConfirmation = async (action: 'minimize' | 'exit', alwaysAsk: boolean) =&gt; {\n    setShowCloseConfirmation(false);\n    \n    // Determine the exit action to save\n    // If alwaysAsk is true: keep as 'ask' (always show confirmation)\n    // If alwaysAsk is false: save the selected action (minimize or exit)\n    const exitActionToSave: 'ask' | 'minimize' | 'exit' = alwaysAsk ? 'ask' : action;\n    \n    // Update state\n    const newSettings = {\n      ...state.settings,\n      exitAction: exitActionToSave\n    };\n    \n    // Update state and ref immediately\n    setState(prev =&gt; ({\n      ...prev,\n      settings: newSettings\n    }));\n    \n    // Immediately update ref to ensure event listener uses the latest value\n    exitActionRef.current = exitActionToSave;\n    \n    // Immediately save the settings to ensure persistence\n    try {\n      const rootPaths = state.roots.map(id =&gt; state.files[id]?.path).filter(Boolean);\n      await saveUserData({\n        rootPaths,\n        customTags: state.customTags,\n        people: state.people,\n        folderSettings: state.folderSettings,\n        settings: newSettings,\n        fileMetadata: {}\n      });\n    } catch (error) {\n      console.error('Failed to save exit action preference:', error);\n    }\n    \n    // Perform the selected action\n    switch (action) {\n      case 'minimize':\n        await hideWindow();\n        break;\n      case 'exit':\n        // Exit the application\n        await exitApp();\n        break;\n    }\n  };\n\n  // Enhanced handleClearPersonInfo to support selective clearing\n  const handleClearPersonInfo = (fileIds: string[], personIdsToClear?: string[]) =&gt; {\n      setState(prev =&gt; {\n          const newFiles = { ...prev.files };\n      }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 2467,
                "column": 3
              },
              "endPosition": {
                "line": 2467,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 2467,
                "column": 9
              },
              "endPosition": {
                "line": 2467,
                "column": 27
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "lineNumber": 2516
          },
          {
            "lineNumber": 2517
          },
          {
            "text": "  // Handle close confirmation actions",
            "lineNumber": 2518
          },
          {
            "text": "  const handleCloseConfirmation = async (action: 'minimize' | 'exit', alwaysAsk: boolean) =&gt; {",
            "lineNumber": 2519
          },
          {
            "text": "    setShowCloseConfirmation(false);",
            "lineNumber": 2520
          },
          {
            "text": "    ",
            "lineNumber": 2521
          },
          {
            "text": "    // Determine the exit action to save",
            "lineNumber": 2522
          },
          {
            "text": "    // If alwaysAsk is true: keep as 'ask' (always show confirmation)",
            "lineNumber": 2523
          },
          {
            "text": "    // If alwaysAsk is false: save the selected action (minimize or exit)",
            "lineNumber": 2524
          },
          {
            "text": "    const exitActionToSave: 'ask' | 'minimize' | 'exit' = alwaysAsk ? 'ask' : action;",
            "lineNumber": 2525
          },
          {
            "text": "    ",
            "lineNumber": 2526
          },
          {
            "text": "    // Update state",
            "lineNumber": 2527
          },
          {
            "text": "    const newSettings = {",
            "lineNumber": 2528
          },
          {
            "text": "      ...state.settings,",
            "lineNumber": 2529
          },
          {
            "text": "      exitAction: exitActionToSave",
            "lineNumber": 2530
          },
          {
            "text": "    };",
            "lineNumber": 2531
          },
          {
            "text": "    ",
            "lineNumber": 2532
          },
          {
            "text": "    // Update state and ref immediately",
            "lineNumber": 2533
          },
          {
            "text": "    setState(prev =&gt; ({",
            "lineNumber": 2534
          },
          {
            "text": "      ...prev,",
            "lineNumber": 2535
          },
          {
            "text": "      settings: newSettings",
            "lineNumber": 2536
          },
          {
            "text": "    }));",
            "lineNumber": 2537
          },
          {
            "text": "    ",
            "lineNumber": 2538
          },
          {
            "text": "    // Immediately update ref to ensure event listener uses the latest value",
            "lineNumber": 2539
          },
          {
            "text": "    exitActionRef.current = exitActionToSave;",
            "lineNumber": 2540
          },
          {
            "text": "    ",
            "lineNumber": 2541
          },
          {
            "text": "    // Immediately save the settings to ensure persistence",
            "lineNumber": 2542
          },
          {
            "text": "    try {",
            "lineNumber": 2543
          },
          {
            "text": "      const rootPaths = state.roots.map(id =&gt; state.files[id]?.path).filter(Boolean);",
            "lineNumber": 2544
          },
          {
            "text": "      await saveUserData({",
            "lineNumber": 2545
          },
          {
            "text": "        rootPaths,",
            "lineNumber": 2546
          },
          {
            "text": "        customTags: state.customTags,",
            "lineNumber": 2547
          },
          {
            "text": "        people: state.people,",
            "lineNumber": 2548
          },
          {
            "text": "        folderSettings: state.folderSettings,",
            "lineNumber": 2549
          },
          {
            "text": "        settings: newSettings,",
            "lineNumber": 2550
          },
          {
            "text": "        fileMetadata: {}",
            "lineNumber": 2551
          },
          {
            "text": "      });",
            "lineNumber": 2552
          },
          {
            "text": "    } catch (error) {",
            "lineNumber": 2553
          },
          {
            "text": "      console.error('Failed to save exit action preference:', error);",
            "lineNumber": 2554
          },
          {
            "text": "    }",
            "lineNumber": 2555
          },
          {
            "text": "    ",
            "lineNumber": 2556
          },
          {
            "text": "    // Perform the selected action",
            "lineNumber": 2557
          },
          {
            "text": "    switch (action) {",
            "lineNumber": 2558
          },
          {
            "text": "      case 'minimize':",
            "lineNumber": 2559
          },
          {
            "text": "        await hideWindow();",
            "lineNumber": 2560
          },
          {
            "text": "        break;",
            "lineNumber": 2561
          },
          {
            "text": "      case 'exit':",
            "lineNumber": 2562
          },
          {
            "text": "        // Exit the application",
            "lineNumber": 2563
          },
          {
            "text": "        await exitApp();",
            "lineNumber": 2564
          },
          {
            "text": "        break;",
            "lineNumber": 2565
          },
          {
            "text": "    }",
            "lineNumber": 2566
          },
          {
            "text": "  };",
            "lineNumber": 2567
          },
          {
            "lineNumber": 2568
          },
          {
            "text": "  // Enhanced handleClearPersonInfo to support selective clearing",
            "lineNumber": 2569
          },
          {
            "text": "  const handleClearPersonInfo = (fileIds: string[], personIdsToClear?: string[]) =&gt; {",
            "lineNumber": 2570
          },
          {
            "text": "      setState(prev =&gt; {",
            "lineNumber": 2571
          },
          {
            "text": "          const newFiles = { ...prev.files };",
            "lineNumber": 2572
          },
          {
            "text": "      }",
            "lineNumber": 2635
          },
          {
            "text": ";",
            "lineNumber": 2636
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.27776798605918884
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \n\n                              \n                              // Create a coherent fallback summary\n                              if (allDescriptions) {\n                                  summary += isChinese ? \n                                      &#96;本文件夹包含多张图片，主要内容是：${allDescriptions.substring(0, 500)}${allDescriptions.length &gt; 500 ? '...' : ''}&#96; :\n                                      &#96;This folder contains multiple images, with main content: ${allDescriptions.substring(0, 500)}${allDescriptions.length &gt; 500 ? '...' : ''}&#96;;\n                              }\n                              \n                              if (allTexts.length &gt; 0) {\n                                  summary += isChinese ? &#96;\\n\\n提取到的文字内容：${allTexts.join('; ').substring(0, 300)}${allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96; :\n                                      &#96;\\n\\nExtracted text content: ${allTexts.join('; ').substring(0, 300)}${allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96;;\n                              }\n                          }\n                      } catch (err) {\n                          console.error('Failed to generate AI analysis', err);\n                          // Fallback to a better summary that doesn't list individual images\n                          const isChinese = state.settings.language === 'zh';\n                          summary = isChinese ? &#96;## 图片分析汇总\\n\\n&#96; : &#96;## Image Analysis Summary\\n\\n&#96;;\n                          \n                          \n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3593
          },
          {
            "lineNumber": 4316
          },
          {
            "text": "                              ",
            "lineNumber": 4317
          },
          {
            "text": "                              // Create a coherent fallback summary",
            "lineNumber": 4318
          },
          {
            "text": "                              if (allDescriptions) {",
            "lineNumber": 4319
          },
          {
            "text": "                                  summary += isChinese ? ",
            "lineNumber": 4320
          },
          {
            "text": "                                      &#96;本文件夹包含多张图片，主要内容是：${allDescriptions.substring(0, 500)}${allDescriptions.length &gt; 500 ? '...' : ''}&#96; :",
            "lineNumber": 4321
          },
          {
            "text": "                                      &#96;This folder contains multiple images, with main content: ${allDescriptions.substring(0, 500)}${allDescriptions.length &gt; 500 ? '...' : ''}&#96;;",
            "lineNumber": 4322
          },
          {
            "text": "                              }",
            "lineNumber": 4323
          },
          {
            "text": "                              ",
            "lineNumber": 4324
          },
          {
            "text": "                              if (allTexts.length &gt; 0) {",
            "lineNumber": 4325
          },
          {
            "text": "                                  summary += isChinese ? &#96;\\n\\n提取到的文字内容：${allTexts.join('; ').substring(0, 300)}${allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96; :",
            "lineNumber": 4326
          },
          {
            "text": "                                      &#96;\\n\\nExtracted text content: ${allTexts.join('; ').substring(0, 300)}${allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96;;",
            "lineNumber": 4327
          },
          {
            "text": "                              }",
            "lineNumber": 4328
          },
          {
            "text": "                          }",
            "lineNumber": 4329
          },
          {
            "text": "                      } catch (err) {",
            "lineNumber": 4330
          },
          {
            "text": "                          console.error('Failed to generate AI analysis', err);",
            "lineNumber": 4331
          },
          {
            "text": "                          // Fallback to a better summary that doesn't list individual images",
            "lineNumber": 4332
          },
          {
            "text": "                          const isChinese = state.settings.language === 'zh';",
            "lineNumber": 4333
          },
          {
            "text": "                          summary = isChinese ? &#96;## 图片分析汇总\\n\\n&#96; : &#96;## Image Analysis Summary\\n\\n&#96;;",
            "lineNumber": 4334
          },
          {
            "text": "                          ",
            "lineNumber": 4335
          },
          {
            "text": "                          ",
            "lineNumber": 4336
          },
          {
            "text": ";",
            "lineNumber": 4386
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.26822906732559204
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\types.ts",
        "range": {
          "startPosition": {
            "line": 154,
            "column": 1
          },
          "endPosition": {
            "line": 164,
            "column": 60
          }
        },
        "contents": "export interface AiSearchFilter {\n  keywords: string[];\n  colors: string[];\n  people: string[];\n  originalQuery: string;\n  description?: string;\n}\n\nexport type SearchScope = 'all' | 'file' | 'tag' | 'folder';",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export interface AiSearchFilter {",
            "lineNumber": 157,
            "isSignature": true
          },
          {
            "text": "  keywords: string[];",
            "lineNumber": 158
          },
          {
            "text": "  colors: string[];",
            "lineNumber": 159
          },
          {
            "text": "  people: string[];",
            "lineNumber": 160
          },
          {
            "text": "  originalQuery: string;",
            "lineNumber": 161
          },
          {
            "text": "  description?: string;",
            "lineNumber": 162,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 163,
            "isSignature": true
          },
          {
            "lineNumber": 164
          },
          {
            "text": "export type SearchScope = 'all' | 'file' | 'tag' | 'folder';",
            "lineNumber": 165,
            "isSignature": true
          }
        ]
      },
      "score": 0.26634660363197327
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst performAiSearch = async \n\n          const prompt = &#96;\n          Analyze this search query for a photo gallery: \"${query}\".\n          Extract search intent and criteria into a JSON object.\n          Return ONLY JSON.\n          \n          Expected JSON Structure:\n          {\n            \"keywords\": string[], // Synonyms, objects, tags\n            \"colors\": string[], // Hex codes or color names\n            \"people\": string[], // Names of people\n            \"description\": string // A concise description of what to look for (optional)\n          }\n          &#96;;\n\n          let result: any = null;\n          \n          // Same logic as handleAIAnalysis but for search\n          if (aiConfig.provider === 'openai') {\n              const body = {\n                  model: aiConfig.openai.model,\n                  messages: [{ role: \"user\", content: prompt }],\n                  max_tokens: 500\n              };\n              try {\n                  const res = await fetch(&#96;${aiConfig.openai.endpoint}/chat/completions&#96;, {\n                      method: 'POST',\n                      headers: { 'Content-Type': 'application/json', 'Authorization': &#96;Bearer ${aiConfig.openai.apiKey}&#96; },\n                      body: JSON.stringify(body)\n                  });\n                  const resData = await res.json();\n                  if (resData?.choices?.[0]?.message?.content) { \n                      try { result = JSON.parse(resData.choices[0].message.content); } catch(e){} \n                  }\n              } catch (e) {\n                  console.error('AI search failed:', e);\n              }\n          } else if (aiConfig.provider === 'ollama') {\n              const body = { model: aiConfig.ollama.model, prompt: prompt, stream: false, format: \"json\" };\n              try {\n                  const res = await fetch(&#96;${aiConfig.ollama.endpoint}/api/generate&#96;, {\n                      method: 'POST',\n                      headers: { 'Content-Type': 'application/json' },\n                      body: JSON.stringify(body)\n                  });\n                  const resData = await res.json();\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 2892,
                "column": 3
              },
              "endPosition": {
                "line": 2892,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 2892,
                "column": 9
              },
              "endPosition": {
                "line": 2892,
                "column": 33
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const performAiSearch = async ",
            "lineNumber": 2947
          },
          {
            "lineNumber": 2957
          },
          {
            "text": "          const prompt = &#96;",
            "lineNumber": 2958
          },
          {
            "text": "          Analyze this search query for a photo gallery: \"${query}\".",
            "lineNumber": 2959
          },
          {
            "text": "          Extract search intent and criteria into a JSON object.",
            "lineNumber": 2960
          },
          {
            "text": "          Return ONLY JSON.",
            "lineNumber": 2961
          },
          {
            "text": "          ",
            "lineNumber": 2962
          },
          {
            "text": "          Expected JSON Structure:",
            "lineNumber": 2963
          },
          {
            "text": "          {",
            "lineNumber": 2964
          },
          {
            "text": "            \"keywords\": string[], // Synonyms, objects, tags",
            "lineNumber": 2965
          },
          {
            "text": "            \"colors\": string[], // Hex codes or color names",
            "lineNumber": 2966
          },
          {
            "text": "            \"people\": string[], // Names of people",
            "lineNumber": 2967
          },
          {
            "text": "            \"description\": string // A concise description of what to look for (optional)",
            "lineNumber": 2968
          },
          {
            "text": "          }",
            "lineNumber": 2969
          },
          {
            "text": "          &#96;;",
            "lineNumber": 2970
          },
          {
            "lineNumber": 2971
          },
          {
            "text": "          let result: any = null;",
            "lineNumber": 2972
          },
          {
            "text": "          ",
            "lineNumber": 2973
          },
          {
            "text": "          // Same logic as handleAIAnalysis but for search",
            "lineNumber": 2974
          },
          {
            "text": "          if (aiConfig.provider === 'openai') {",
            "lineNumber": 2975
          },
          {
            "text": "              const body = {",
            "lineNumber": 2976
          },
          {
            "text": "                  model: aiConfig.openai.model,",
            "lineNumber": 2977
          },
          {
            "text": "                  messages: [{ role: \"user\", content: prompt }],",
            "lineNumber": 2978
          },
          {
            "text": "                  max_tokens: 500",
            "lineNumber": 2979
          },
          {
            "text": "              };",
            "lineNumber": 2980
          },
          {
            "text": "              try {",
            "lineNumber": 2981
          },
          {
            "text": "                  const res = await fetch(&#96;${aiConfig.openai.endpoint}/chat/completions&#96;, {",
            "lineNumber": 2982
          },
          {
            "text": "                      method: 'POST',",
            "lineNumber": 2983
          },
          {
            "text": "                      headers: { 'Content-Type': 'application/json', 'Authorization': &#96;Bearer ${aiConfig.openai.apiKey}&#96; },",
            "lineNumber": 2984
          },
          {
            "text": "                      body: JSON.stringify(body)",
            "lineNumber": 2985
          },
          {
            "text": "                  });",
            "lineNumber": 2986
          },
          {
            "text": "                  const resData = await res.json();",
            "lineNumber": 2987
          },
          {
            "text": "                  if (resData?.choices?.[0]?.message?.content) { ",
            "lineNumber": 2988
          },
          {
            "text": "                      try { result = JSON.parse(resData.choices[0].message.content); } catch(e){} ",
            "lineNumber": 2989
          },
          {
            "text": "                  }",
            "lineNumber": 2990
          },
          {
            "text": "              } catch (e) {",
            "lineNumber": 2991
          },
          {
            "text": "                  console.error('AI search failed:', e);",
            "lineNumber": 2992
          },
          {
            "text": "              }",
            "lineNumber": 2993
          },
          {
            "text": "          } else if (aiConfig.provider === 'ollama') {",
            "lineNumber": 2994
          },
          {
            "text": "              const body = { model: aiConfig.ollama.model, prompt: prompt, stream: false, format: \"json\" };",
            "lineNumber": 2995
          },
          {
            "text": "              try {",
            "lineNumber": 2996
          },
          {
            "text": "                  const res = await fetch(&#96;${aiConfig.ollama.endpoint}/api/generate&#96;, {",
            "lineNumber": 2997
          },
          {
            "text": "                      method: 'POST',",
            "lineNumber": 2998
          },
          {
            "text": "                      headers: { 'Content-Type': 'application/json' },",
            "lineNumber": 2999
          },
          {
            "text": "                      body: JSON.stringify(body)",
            "lineNumber": 3000
          },
          {
            "text": "                  });",
            "lineNumber": 3001
          },
          {
            "text": "                  const resData = await res.json();",
            "lineNumber": 3002
          },
          {
            "text": ";",
            "lineNumber": 3054
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.26042699813842773
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleUpdatePerson = \nprev =&gt; (\n\n          people: {\n              ...prev.people,\n              [personId]: { ...prev.people[personId], ...updates }\n          }\n      }));\n  };\n\n  const handleCreatePerson = () =&gt; {\n      const newId = Math.random().toString(36).substr(2, 9);\n      const newPerson: Person = {\n          id: newId,\n          name: t('context.newPersonDefault'),\n          coverFileId: '',\n          count: 0,\n          description: ''\n      };\n      setState(prev =&gt; ({\n          ...prev,\n          people: { ...prev.people, [newId]: newPerson },\n          activeModal: { type: 'rename-person', data: { personId: newId } }\n      }));\n  };\n\n  const handleDeletePerson = (personId: string | string[]) =&gt; {\n      setState(prev =&gt; {\n          const newPeople = { ...prev.people };\n          \n          // Handle both single person and multiple people deletion\n          const idsToDelete = typeof personId === 'string' ? [personId] : personId;\n          idsToDelete.forEach(id =&gt; {\n              delete newPeople[id];\n          });\n          \n          return { ...prev, people: newPeople, activeModal: { type: null } };\n      });\n  };\n\n  const handleManualAddPerson = (personId: string) =&gt; {\n      const fileIds = activeTab.selectedFileIds;\n      if (fileIds.length === 0) {\n          setState(s =&gt; ({ ...s, activeModal: { type: null } }));\n          return;\n      }\n      setState(prev =&gt; {\n          const newFiles = { ...prev.files };\n          const newPeople = { ...prev.people };\n          const person = newPeople[personId];\n          if (!person) return prev;\n      }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleUpdatePerson = ",
            "lineNumber": 2418
          },
          {
            "text": "prev =&gt; (",
            "lineNumber": 2419
          },
          {
            "lineNumber": 2420
          },
          {
            "text": "          people: {",
            "lineNumber": 2421
          },
          {
            "text": "              ...prev.people,",
            "lineNumber": 2422
          },
          {
            "text": "              [personId]: { ...prev.people[personId], ...updates }",
            "lineNumber": 2423
          },
          {
            "text": "          }",
            "lineNumber": 2424
          },
          {
            "text": "      }));",
            "lineNumber": 2425
          },
          {
            "text": "  };",
            "lineNumber": 2426
          },
          {
            "lineNumber": 2427
          },
          {
            "text": "  const handleCreatePerson = () =&gt; {",
            "lineNumber": 2428
          },
          {
            "text": "      const newId = Math.random().toString(36).substr(2, 9);",
            "lineNumber": 2429
          },
          {
            "text": "      const newPerson: Person = {",
            "lineNumber": 2430
          },
          {
            "text": "          id: newId,",
            "lineNumber": 2431
          },
          {
            "text": "          name: t('context.newPersonDefault'),",
            "lineNumber": 2432
          },
          {
            "text": "          coverFileId: '',",
            "lineNumber": 2433
          },
          {
            "text": "          count: 0,",
            "lineNumber": 2434
          },
          {
            "text": "          description: ''",
            "lineNumber": 2435
          },
          {
            "text": "      };",
            "lineNumber": 2436
          },
          {
            "text": "      setState(prev =&gt; ({",
            "lineNumber": 2437
          },
          {
            "text": "          ...prev,",
            "lineNumber": 2438
          },
          {
            "text": "          people: { ...prev.people, [newId]: newPerson },",
            "lineNumber": 2439
          },
          {
            "text": "          activeModal: { type: 'rename-person', data: { personId: newId } }",
            "lineNumber": 2440
          },
          {
            "text": "      }));",
            "lineNumber": 2441
          },
          {
            "text": "  };",
            "lineNumber": 2442
          },
          {
            "lineNumber": 2443
          },
          {
            "text": "  const handleDeletePerson = (personId: string | string[]) =&gt; {",
            "lineNumber": 2444
          },
          {
            "text": "      setState(prev =&gt; {",
            "lineNumber": 2445
          },
          {
            "text": "          const newPeople = { ...prev.people };",
            "lineNumber": 2446
          },
          {
            "text": "          ",
            "lineNumber": 2447
          },
          {
            "text": "          // Handle both single person and multiple people deletion",
            "lineNumber": 2448
          },
          {
            "text": "          const idsToDelete = typeof personId === 'string' ? [personId] : personId;",
            "lineNumber": 2449
          },
          {
            "text": "          idsToDelete.forEach(id =&gt; {",
            "lineNumber": 2450
          },
          {
            "text": "              delete newPeople[id];",
            "lineNumber": 2451
          },
          {
            "text": "          });",
            "lineNumber": 2452
          },
          {
            "text": "          ",
            "lineNumber": 2453
          },
          {
            "text": "          return { ...prev, people: newPeople, activeModal: { type: null } };",
            "lineNumber": 2454
          },
          {
            "text": "      });",
            "lineNumber": 2455
          },
          {
            "text": "  };",
            "lineNumber": 2456
          },
          {
            "lineNumber": 2457
          },
          {
            "text": "  const handleManualAddPerson = (personId: string) =&gt; {",
            "lineNumber": 2458
          },
          {
            "text": "      const fileIds = activeTab.selectedFileIds;",
            "lineNumber": 2459
          },
          {
            "text": "      if (fileIds.length === 0) {",
            "lineNumber": 2460
          },
          {
            "text": "          setState(s =&gt; ({ ...s, activeModal: { type: null } }));",
            "lineNumber": 2461
          },
          {
            "text": "          return;",
            "lineNumber": 2462
          },
          {
            "text": "      }",
            "lineNumber": 2463
          },
          {
            "text": "      setState(prev =&gt; {",
            "lineNumber": 2464
          },
          {
            "text": "          const newFiles = { ...prev.files };",
            "lineNumber": 2465
          },
          {
            "text": "          const newPeople = { ...prev.people };",
            "lineNumber": 2466
          },
          {
            "text": "          const person = newPeople[personId];",
            "lineNumber": 2467
          },
          {
            "text": "          if (!person) return prev;",
            "lineNumber": 2468
          },
          {
            "text": "      }",
            "lineNumber": 2514
          },
          {
            "text": ";",
            "lineNumber": 2516
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.25831159949302673
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1490
          },
          "endPosition": {
            "line": 2018,
            "column": 1
          }
        },
        "contents": "interface FileGridProps {\n\n  selectionBox?: { startX: number; startY: number; currentX: number; currentY: number } | null;\n  t: (key: string) =&gt; string;\n  onThumbnailSizeChange?: (size: number) =&gt; void;\n  onUpdateFile?: (id: string, updates: Partial&lt;FileNode&gt;) =&gt; void;\n  settings?: import('../types').AppSettings;\n  onDragEnd?: (e: React.DragEvent) =&gt; void;\n  resourceRoot?: string;\n  cachePath?: string;\n  onScrollTopChange?: (scrollTop: number) =&gt; void;\n}\n\nexport const FileGrid: React.FC&lt;FileGridProps&gt; = ({\n  displayFileIds,\n  files,\n  activeTab,\n  renamingId,\n  thumbnailSize,\n  resourceRoot,\n  cachePath,\n  hoverPlayingId,\n  onSetHoverPlayingId,\n  onFileClick,\n  onFileDoubleClick,\n  onContextMenu,\n  onRenameSubmit,\n  onRenameCancel,\n  onStartRename,\n  onDragStart,\n  onDragEnd,\n  onDropOnFolder,\n  onDropExternal,\n  containerRef,\n  onMouseDown,\n  onMouseMove,\n  onMouseUp,\n  onBackgroundContextMenu,\n  people,\n  groupedTags,\n  onPersonClick,\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "interface FileGridProps {",
            "lineNumber": 1491,
            "isSignature": true
          },
          {
            "lineNumber": 1526
          },
          {
            "text": "  selectionBox?: { startX: number; startY: number; currentX: number; currentY: number } | null;",
            "lineNumber": 1527
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 1528
          },
          {
            "text": "  onThumbnailSizeChange?: (size: number) =&gt; void;",
            "lineNumber": 1529
          },
          {
            "text": "  onUpdateFile?: (id: string, updates: Partial&lt;FileNode&gt;) =&gt; void;",
            "lineNumber": 1530
          },
          {
            "text": "  settings?: import('../types').AppSettings;",
            "lineNumber": 1531
          },
          {
            "text": "  onDragEnd?: (e: React.DragEvent) =&gt; void;",
            "lineNumber": 1532
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 1533
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 1534
          },
          {
            "text": "  onScrollTopChange?: (scrollTop: number) =&gt; void;",
            "lineNumber": 1535,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 1536,
            "isSignature": true
          },
          {
            "lineNumber": 1537
          },
          {
            "text": "export const FileGrid: React.FC&lt;FileGridProps&gt; = ({",
            "lineNumber": 1538
          },
          {
            "text": "  displayFileIds,",
            "lineNumber": 1539
          },
          {
            "text": "  files,",
            "lineNumber": 1540
          },
          {
            "text": "  activeTab,",
            "lineNumber": 1541
          },
          {
            "text": "  renamingId,",
            "lineNumber": 1542
          },
          {
            "text": "  thumbnailSize,",
            "lineNumber": 1543
          },
          {
            "text": "  resourceRoot,",
            "lineNumber": 1544
          },
          {
            "text": "  cachePath,",
            "lineNumber": 1545
          },
          {
            "text": "  hoverPlayingId,",
            "lineNumber": 1546
          },
          {
            "text": "  onSetHoverPlayingId,",
            "lineNumber": 1547
          },
          {
            "text": "  onFileClick,",
            "lineNumber": 1548
          },
          {
            "text": "  onFileDoubleClick,",
            "lineNumber": 1549
          },
          {
            "text": "  onContextMenu,",
            "lineNumber": 1550
          },
          {
            "text": "  onRenameSubmit,",
            "lineNumber": 1551
          },
          {
            "text": "  onRenameCancel,",
            "lineNumber": 1552
          },
          {
            "text": "  onStartRename,",
            "lineNumber": 1553
          },
          {
            "text": "  onDragStart,",
            "lineNumber": 1554
          },
          {
            "text": "  onDragEnd,",
            "lineNumber": 1555
          },
          {
            "text": "  onDropOnFolder,",
            "lineNumber": 1556
          },
          {
            "text": "  onDropExternal,",
            "lineNumber": 1557
          },
          {
            "text": "  containerRef,",
            "lineNumber": 1558
          },
          {
            "text": "  onMouseDown,",
            "lineNumber": 1559
          },
          {
            "text": "  onMouseMove,",
            "lineNumber": 1560
          },
          {
            "text": "  onMouseUp,",
            "lineNumber": 1561
          },
          {
            "text": "  onBackgroundContextMenu,",
            "lineNumber": 1562
          },
          {
            "text": "  people,",
            "lineNumber": 1563
          },
          {
            "text": "  groupedTags,",
            "lineNumber": 1564
          },
          {
            "text": "  onPersonClick,",
            "lineNumber": 1565
          },
          {
            "text": ";",
            "lineNumber": 2019
          }
        ]
      },
      "score": 0.2580327093601227
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 109
          },
          "endPosition": {
            "line": 255,
            "column": 1
          }
        },
        "contents": "const FolderPickerModal = \n\n  \n  // 查找所有匹配的文件夹及其祖先文件夹\n  const findMatchingFolders = (): Set&lt;string&gt; | null =&gt; {\n    // 如果搜索框为空，返回 null，表示不需要过滤\n    if (!searchQuery.trim()) {\n      return null;\n    }\n    \n    const matchingFolders = new Set&lt;string&gt;();\n    const query = searchQuery.toLowerCase();\n    \n    // 递归遍历文件夹树，查找匹配的文件夹\n    const traverse = (nodeId: string) =&gt; {\n      const node = files[nodeId];\n      if (!node || node.type !== FileType.FOLDER) return;\n      \n      // 检查当前文件夹是否匹配搜索条件\n      const matches = node.name.toLowerCase().includes(query);\n      \n      // 获取子文件夹\n      const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];\n      \n      // 检查是否有子文件夹匹配\n      let hasMatchingChild = false;\n      for (const childId of folderChildren) {\n        traverse(childId);\n        if (matchingFolders.has(childId)) {\n          hasMatchingChild = true;\n        }\n      }\n      \n      // 如果当前文件夹匹配或有匹配的子文件夹，添加到结果中\n      if (matches || hasMatchingChild) {\n        matchingFolders.add(nodeId);\n      }\n    };\n    \n    // 从所有根目录开始遍历\n    roots.forEach((rootId: string) =&gt; traverse(rootId));\n    \n    return matchingFolders;\n  };\n  \n  // 递归渲染文件夹树，支持搜索过滤\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 108,
                "column": 1
              },
              "endPosition": {
                "line": 108,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 108,
                "column": 7
              },
              "endPosition": {
                "line": 108,
                "column": 27
              }
            },
            {
              "startPosition": {
                "line": 127,
                "column": 3
              },
              "endPosition": {
                "line": 127,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 127,
                "column": 9
              },
              "endPosition": {
                "line": 127,
                "column": 31
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ",
            "lineNumber": 110
          },
          {
            "lineNumber": 126
          },
          {
            "text": "  ",
            "lineNumber": 127
          },
          {
            "text": "  // 查找所有匹配的文件夹及其祖先文件夹",
            "lineNumber": 128
          },
          {
            "text": "  const findMatchingFolders = (): Set&lt;string&gt; | null =&gt; {",
            "lineNumber": 129
          },
          {
            "text": "    // 如果搜索框为空，返回 null，表示不需要过滤",
            "lineNumber": 130
          },
          {
            "text": "    if (!searchQuery.trim()) {",
            "lineNumber": 131
          },
          {
            "text": "      return null;",
            "lineNumber": 132
          },
          {
            "text": "    }",
            "lineNumber": 133
          },
          {
            "text": "    ",
            "lineNumber": 134
          },
          {
            "text": "    const matchingFolders = new Set&lt;string&gt;();",
            "lineNumber": 135
          },
          {
            "text": "    const query = searchQuery.toLowerCase();",
            "lineNumber": 136
          },
          {
            "text": "    ",
            "lineNumber": 137
          },
          {
            "text": "    // 递归遍历文件夹树，查找匹配的文件夹",
            "lineNumber": 138
          },
          {
            "text": "    const traverse = (nodeId: string) =&gt; {",
            "lineNumber": 139
          },
          {
            "text": "      const node = files[nodeId];",
            "lineNumber": 140
          },
          {
            "text": "      if (!node || node.type !== FileType.FOLDER) return;",
            "lineNumber": 141
          },
          {
            "text": "      ",
            "lineNumber": 142
          },
          {
            "text": "      // 检查当前文件夹是否匹配搜索条件",
            "lineNumber": 143
          },
          {
            "text": "      const matches = node.name.toLowerCase().includes(query);",
            "lineNumber": 144
          },
          {
            "text": "      ",
            "lineNumber": 145
          },
          {
            "text": "      // 获取子文件夹",
            "lineNumber": 146
          },
          {
            "text": "      const folderChildren = node.children?.filter((childId: string) =&gt; files[childId]?.type === FileType.FOLDER) || [];",
            "lineNumber": 147
          },
          {
            "text": "      ",
            "lineNumber": 148
          },
          {
            "text": "      // 检查是否有子文件夹匹配",
            "lineNumber": 149
          },
          {
            "text": "      let hasMatchingChild = false;",
            "lineNumber": 150
          },
          {
            "text": "      for (const childId of folderChildren) {",
            "lineNumber": 151
          },
          {
            "text": "        traverse(childId);",
            "lineNumber": 152
          },
          {
            "text": "        if (matchingFolders.has(childId)) {",
            "lineNumber": 153
          },
          {
            "text": "          hasMatchingChild = true;",
            "lineNumber": 154
          },
          {
            "text": "        }",
            "lineNumber": 155
          },
          {
            "text": "      }",
            "lineNumber": 156
          },
          {
            "text": "      ",
            "lineNumber": 157
          },
          {
            "text": "      // 如果当前文件夹匹配或有匹配的子文件夹，添加到结果中",
            "lineNumber": 158
          },
          {
            "text": "      if (matches || hasMatchingChild) {",
            "lineNumber": 159
          },
          {
            "text": "        matchingFolders.add(nodeId);",
            "lineNumber": 160
          },
          {
            "text": "      }",
            "lineNumber": 161
          },
          {
            "text": "    };",
            "lineNumber": 162
          },
          {
            "text": "    ",
            "lineNumber": 163
          },
          {
            "text": "    // 从所有根目录开始遍历",
            "lineNumber": 164
          },
          {
            "text": "    roots.forEach((rootId: string) =&gt; traverse(rootId));",
            "lineNumber": 165
          },
          {
            "text": "    ",
            "lineNumber": 166
          },
          {
            "text": "    return matchingFolders;",
            "lineNumber": 167
          },
          {
            "text": "  };",
            "lineNumber": 168
          },
          {
            "text": "  ",
            "lineNumber": 169
          },
          {
            "text": "  // 递归渲染文件夹树，支持搜索过滤",
            "lineNumber": 170
          },
          {
            "text": ";",
            "lineNumber": 256
          }
        ]
      },
      "score": 0.256483793258667
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\types.ts",
        "range": {
          "startPosition": {
            "line": 183
          },
          "endPosition": {
            "line": 216,
            "column": 1
          }
        },
        "contents": "export interface HistoryItem {\n;\n  viewMode: 'browser' | 'tags-overview' | 'people-overview';\n  searchQuery: string;\n  searchScope: SearchScope;\n  activeTags: string[];\n  activePersonId: string | null;\n  aiFilter?: AiSearchFilter | null;\n  scrollTop?: number;\n}\n\nexport interface TabState {\n  id: string;\n  folderId: string;\n  viewingFileId: string | null;\n  viewMode: 'browser' | 'tags-overview' | 'people-overview'; \n  layoutMode: LayoutMode;\n  searchQuery: string;\n  searchScope: SearchScope;\n  aiFilter?: AiSearchFilter | null;\n  activeTags: string[];\n  activePersonId: string | null;\n  dateFilter: DateFilter;\n  selectedFileIds: string[];\n  lastSelectedId: string | null;\n  selectedTagIds: string[];\n  selectedPersonIds: string[];\n;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export interface HistoryItem {",
            "lineNumber": 184,
            "isSignature": true
          },
          {
            "text": ";",
            "lineNumber": 186
          },
          {
            "text": "  viewMode: 'browser' | 'tags-overview' | 'people-overview';",
            "lineNumber": 187
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 188
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 189
          },
          {
            "text": "  activeTags: string[];",
            "lineNumber": 190
          },
          {
            "text": "  activePersonId: string | null;",
            "lineNumber": 191
          },
          {
            "text": "  aiFilter?: AiSearchFilter | null;",
            "lineNumber": 192
          },
          {
            "text": "  scrollTop?: number;",
            "lineNumber": 193,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 194,
            "isSignature": true
          },
          {
            "lineNumber": 195
          },
          {
            "text": "export interface TabState {",
            "lineNumber": 196,
            "isSignature": true
          },
          {
            "text": "  id: string;",
            "lineNumber": 197
          },
          {
            "text": "  folderId: string;",
            "lineNumber": 198
          },
          {
            "text": "  viewingFileId: string | null;",
            "lineNumber": 199
          },
          {
            "text": "  viewMode: 'browser' | 'tags-overview' | 'people-overview'; ",
            "lineNumber": 200
          },
          {
            "text": "  layoutMode: LayoutMode;",
            "lineNumber": 201
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 202
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 203
          },
          {
            "text": "  aiFilter?: AiSearchFilter | null;",
            "lineNumber": 204
          },
          {
            "text": "  activeTags: string[];",
            "lineNumber": 205
          },
          {
            "text": "  activePersonId: string | null;",
            "lineNumber": 206
          },
          {
            "text": "  dateFilter: DateFilter;",
            "lineNumber": 207
          },
          {
            "text": "  selectedFileIds: string[];",
            "lineNumber": 208
          },
          {
            "text": "  lastSelectedId: string | null;",
            "lineNumber": 209
          },
          {
            "text": "  selectedTagIds: string[];",
            "lineNumber": 210
          },
          {
            "text": "  selectedPersonIds: string[];",
            "lineNumber": 211
          },
          {
            "text": ";",
            "lineNumber": 216,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 217,
            "isSignature": true
          }
        ]
      },
      "score": 0.24584347009658813
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 152
          },
          "endPosition": {
            "line": 291,
            "column": 2
          }
        },
        "contents": "const extractPalette = async \n(resolve) =&gt; {\n() =&gt; {\n\n                \n                // Pass 2: Relax slightly only if we have very few colors\n                if (finalPalette.length &lt; 5) {\n                    for (const c of sorted) {\n                        if (finalPalette.length &gt;= 8) break;\n                        addColor(c, 30);\n                    }\n                }\n                \n                // We DO NOT force 8 colors. If we only found 4 distinct ones, we return 4.\n\n                resolve(finalPalette.map(p =&gt; p.hex));\n                \n            } catch(e) {\n                console.error(\"Pixel access failed\", e);\n                resolve([]);\n            }\n        };\n        img.onerror = () =&gt; resolve([]);\n    });\n};\n\nconst CategorySelector = ({ current, onChange, t }: any) =&gt; (\n  &lt;div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-800\"&gt;\n      &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2\"&gt;{t('meta.folderCategory')}&lt;/div&gt;\n      &lt;div className=\"flex bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl gap-2\"&gt;\n          {['general', 'book', 'sequence'].map((cat) =&gt; {\n              const isActive = current === cat;\n              return (\n                  &lt;button\n                      key={cat}\n                      onClick={() =&gt; onChange(cat)}\n                      className={&#96;flex-1 flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all ${\n                          isActive\n                          ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-md ring-1 ring-black/5 dark:ring-white/10' \n                          : 'text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-100'\n                      }&#96;}\n                  &gt;\n                      {cat === 'general' &amp;&amp; &lt;Folder size={20} className={&#96;mb-1.5 ${isActive ? 'fill-blue-100 dark:fill-blue-900/30' : ''}&#96;}/&gt;}\n                      {cat === 'book' &amp;&amp; &lt;Book size={20} className={&#96;mb-1.5 ${isActive ? 'fill-amber-100 dark:fill-amber-900/30' : ''}&#96;}/&gt;}\n                      {cat === 'sequence' &amp;&amp; &lt;Film size={20} className={&#96;mb-1.5 ${isActive ? 'fill-purple-100 dark:fill-purple-900/30' : ''}&#96;}/&gt;}\n                      {t(&#96;meta.cat${cat.charAt(0).toUpperCase() + cat.slice(1)}&#96;)}\n                  &lt;/button&gt;\n              );\n          })}\n      &lt;/div&gt;\n  &lt;/div&gt;\n);",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const extractPalette = async ",
            "lineNumber": 153
          },
          {
            "text": "(resolve) =&gt; {",
            "lineNumber": 154
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 158
          },
          {
            "lineNumber": 244
          },
          {
            "text": "                ",
            "lineNumber": 245
          },
          {
            "text": "                // Pass 2: Relax slightly only if we have very few colors",
            "lineNumber": 246
          },
          {
            "text": "                if (finalPalette.length &lt; 5) {",
            "lineNumber": 247
          },
          {
            "text": "                    for (const c of sorted) {",
            "lineNumber": 248
          },
          {
            "text": "                        if (finalPalette.length &gt;= 8) break;",
            "lineNumber": 249
          },
          {
            "text": "                        addColor(c, 30);",
            "lineNumber": 250
          },
          {
            "text": "                    }",
            "lineNumber": 251
          },
          {
            "text": "                }",
            "lineNumber": 252
          },
          {
            "text": "                ",
            "lineNumber": 253
          },
          {
            "text": "                // We DO NOT force 8 colors. If we only found 4 distinct ones, we return 4.",
            "lineNumber": 254
          },
          {
            "lineNumber": 255
          },
          {
            "text": "                resolve(finalPalette.map(p =&gt; p.hex));",
            "lineNumber": 256
          },
          {
            "text": "                ",
            "lineNumber": 257
          },
          {
            "text": "            } catch(e) {",
            "lineNumber": 258
          },
          {
            "text": "                console.error(\"Pixel access failed\", e);",
            "lineNumber": 259
          },
          {
            "text": "                resolve([]);",
            "lineNumber": 260
          },
          {
            "text": "            }",
            "lineNumber": 261
          },
          {
            "text": "        };",
            "lineNumber": 262
          },
          {
            "text": "        img.onerror = () =&gt; resolve([]);",
            "lineNumber": 263
          },
          {
            "text": "    });",
            "lineNumber": 264
          },
          {
            "text": "};",
            "lineNumber": 265
          },
          {
            "lineNumber": 266
          },
          {
            "text": "const CategorySelector = ({ current, onChange, t }: any) =&gt; (",
            "lineNumber": 267
          },
          {
            "text": "  &lt;div className=\"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-800\"&gt;",
            "lineNumber": 268
          },
          {
            "text": "      &lt;div className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-semibold mb-2\"&gt;{t('meta.folderCategory')}&lt;/div&gt;",
            "lineNumber": 269
          },
          {
            "text": "      &lt;div className=\"flex bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl gap-2\"&gt;",
            "lineNumber": 270
          },
          {
            "text": "          {['general', 'book', 'sequence'].map((cat) =&gt; {",
            "lineNumber": 271
          },
          {
            "text": "              const isActive = current === cat;",
            "lineNumber": 272
          },
          {
            "text": "              return (",
            "lineNumber": 273
          },
          {
            "text": "                  &lt;button",
            "lineNumber": 274
          },
          {
            "text": "                      key={cat}",
            "lineNumber": 275
          },
          {
            "text": "                      onClick={() =&gt; onChange(cat)}",
            "lineNumber": 276
          },
          {
            "text": "                      className={&#96;flex-1 flex flex-col items-center justify-center py-3 rounded-lg text-xs font-medium transition-all ${",
            "lineNumber": 277
          },
          {
            "text": "                          isActive",
            "lineNumber": 278
          },
          {
            "text": "                          ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-md ring-1 ring-black/5 dark:ring-white/10' ",
            "lineNumber": 279
          },
          {
            "text": "                          : 'text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-100'",
            "lineNumber": 280
          },
          {
            "text": "                      }&#96;}",
            "lineNumber": 281
          },
          {
            "text": "                  &gt;",
            "lineNumber": 282
          },
          {
            "text": "                      {cat === 'general' &amp;&amp; &lt;Folder size={20} className={&#96;mb-1.5 ${isActive ? 'fill-blue-100 dark:fill-blue-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 283
          },
          {
            "text": "                      {cat === 'book' &amp;&amp; &lt;Book size={20} className={&#96;mb-1.5 ${isActive ? 'fill-amber-100 dark:fill-amber-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 284
          },
          {
            "text": "                      {cat === 'sequence' &amp;&amp; &lt;Film size={20} className={&#96;mb-1.5 ${isActive ? 'fill-purple-100 dark:fill-purple-900/30' : ''}&#96;}/&gt;}",
            "lineNumber": 285
          },
          {
            "text": "                      {t(&#96;meta.cat${cat.charAt(0).toUpperCase() + cat.slice(1)}&#96;)}",
            "lineNumber": 286
          },
          {
            "text": "                  &lt;/button&gt;",
            "lineNumber": 287
          },
          {
            "text": "              );",
            "lineNumber": 288
          },
          {
            "text": "          })}",
            "lineNumber": 289
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 290
          },
          {
            "text": "  &lt;/div&gt;",
            "lineNumber": 291
          },
          {
            "text": ");",
            "lineNumber": 292
          }
        ]
      },
      "score": 0.24450869858264923
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\types.ts",
        "range": {
          "startPosition": {
            "line": 62,
            "column": 1
          },
          "endPosition": {
            "line": 78,
            "column": 1
          }
        },
        "contents": "export interface Person {\n  id: string;\n  name: string;\n  coverFileId: string;\n  count: number;\n  description?: string;\n  descriptor?: number[];\n  faceBox?: { x: number; y: number; w: number; h: number }; // Percentages 0-100\n}\n\nexport interface UserProfile {\n  name: string;\n  avatarUrl: string;\n  ip: string;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export interface Person {",
            "lineNumber": 65,
            "isSignature": true
          },
          {
            "text": "  id: string;",
            "lineNumber": 66
          },
          {
            "text": "  name: string;",
            "lineNumber": 67
          },
          {
            "text": "  coverFileId: string;",
            "lineNumber": 68
          },
          {
            "text": "  count: number;",
            "lineNumber": 69
          },
          {
            "text": "  description?: string;",
            "lineNumber": 70
          },
          {
            "text": "  descriptor?: number[];",
            "lineNumber": 71
          },
          {
            "text": "  faceBox?: { x: number; y: number; w: number; h: number }; // Percentages 0-100",
            "lineNumber": 72
          },
          {
            "text": "}",
            "lineNumber": 73,
            "isSignature": true
          },
          {
            "lineNumber": 74
          },
          {
            "text": "export interface UserProfile {",
            "lineNumber": 75,
            "isSignature": true
          },
          {
            "text": "  name: string;",
            "lineNumber": 76
          },
          {
            "text": "  avatarUrl: string;",
            "lineNumber": 77
          },
          {
            "text": "  ip: string;",
            "lineNumber": 78,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 79,
            "isSignature": true
          }
        ]
      },
      "score": 0.23281049728393555
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\n\n                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}\n                          onPrev={() =&gt; handleViewerNavigate('prev')}\n                          onNavigateBack={goBack}\n                          onNavigateForward={goForward}\n                          canGoBack={activeTab.history.currentIndex &gt; 0}\n                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}\n                          onDelete={(id) =&gt; requestDelete([id])}\n                          onViewInExplorer={handleViewInExplorer}\n                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}\n                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}\n                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}\n                          searchQuery={activeTab.searchQuery}\n                          onSearch={handleViewerSearch}\n                          searchScope={activeTab.searchScope}\n                          onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })}\n                          onUpdateSlideshowConfig={(cfg) =&gt; setState(s =&gt; ({ ...s, slideshowConfig: cfg }))}\n                          onPasteTags={(id) =&gt; handlePasteTags([id])}\n                          onEditTags={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'edit-tags', data: { fileId: activeTab.viewingFileId } } }))}\n                          onCopyTags={() =&gt; handleCopyTags([activeTab.viewingFileId!])}\n                          onAIAnalysis={(id) =&gt; handleAIAnalysis([id])}\n                          isAISearchEnabled={state.settings.search.isAISearchEnabled}\n                          onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}\n                          t={t}\n                          activeTab={activeTab}\n                      /&gt;\n                  );\n              })()\n          )}\n          {!activeTab.viewingFileId &amp;&amp; (\n            &lt;&gt;\n              &lt;TopBar \n                activeTab={activeTab} \n                state={state}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4466
          },
          {
            "lineNumber": 4495
          },
          {
            "text": "                          onNext={(random) =&gt; handleViewerNavigate(random ? 'random' : 'next')}",
            "lineNumber": 4496
          },
          {
            "text": "                          onPrev={() =&gt; handleViewerNavigate('prev')}",
            "lineNumber": 4497
          },
          {
            "text": "                          onNavigateBack={goBack}",
            "lineNumber": 4498
          },
          {
            "text": "                          onNavigateForward={goForward}",
            "lineNumber": 4499
          },
          {
            "text": "                          canGoBack={activeTab.history.currentIndex &gt; 0}",
            "lineNumber": 4500
          },
          {
            "text": "                          canGoForward={activeTab.history.currentIndex &lt; activeTab.history.stack.length - 1}",
            "lineNumber": 4501
          },
          {
            "text": "                          onDelete={(id) =&gt; requestDelete([id])}",
            "lineNumber": 4502
          },
          {
            "text": "                          onViewInExplorer={handleViewInExplorer}",
            "lineNumber": 4503
          },
          {
            "text": "                          onCopyToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'copy-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4504
          },
          {
            "text": "                          onMoveToFolder={(fileId) =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'move-to-folder', data: { fileIds: [fileId] } } }))}",
            "lineNumber": 4505
          },
          {
            "text": "                          onNavigateToFolder={(fid) =&gt; enterFolder(fid)}",
            "lineNumber": 4506
          },
          {
            "text": "                          searchQuery={activeTab.searchQuery}",
            "lineNumber": 4507
          },
          {
            "text": "                          onSearch={handleViewerSearch}",
            "lineNumber": 4508
          },
          {
            "text": "                          searchScope={activeTab.searchScope}",
            "lineNumber": 4509
          },
          {
            "text": "                          onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })}",
            "lineNumber": 4510
          },
          {
            "text": "                          onUpdateSlideshowConfig={(cfg) =&gt; setState(s =&gt; ({ ...s, slideshowConfig: cfg }))}",
            "lineNumber": 4511
          },
          {
            "text": "                          onPasteTags={(id) =&gt; handlePasteTags([id])}",
            "lineNumber": 4512
          },
          {
            "text": "                          onEditTags={() =&gt; setState(s =&gt; ({ ...s, activeModal: { type: 'edit-tags', data: { fileId: activeTab.viewingFileId } } }))}",
            "lineNumber": 4513
          },
          {
            "text": "                          onCopyTags={() =&gt; handleCopyTags([activeTab.viewingFileId!])}",
            "lineNumber": 4514
          },
          {
            "text": "                          onAIAnalysis={(id) =&gt; handleAIAnalysis([id])}",
            "lineNumber": 4515
          },
          {
            "text": "                          isAISearchEnabled={state.settings.search.isAISearchEnabled}",
            "lineNumber": 4516
          },
          {
            "text": "                          onToggleAISearch={() =&gt; setState(s =&gt; ({ ...s, settings: { ...s.settings, search: { ...s.settings.search, isAISearchEnabled: !s.settings.search.isAISearchEnabled } } }))}",
            "lineNumber": 4517
          },
          {
            "text": "                          t={t}",
            "lineNumber": 4518
          },
          {
            "text": "                          activeTab={activeTab}",
            "lineNumber": 4519
          },
          {
            "text": "                      /&gt;",
            "lineNumber": 4520
          },
          {
            "text": "                  );",
            "lineNumber": 4521
          },
          {
            "text": "              })()",
            "lineNumber": 4522
          },
          {
            "text": "          )}",
            "lineNumber": 4523
          },
          {
            "text": "          {!activeTab.viewingFileId &amp;&amp; (",
            "lineNumber": 4524
          },
          {
            "text": "            &lt;&gt;",
            "lineNumber": 4525
          },
          {
            "text": "              &lt;TopBar ",
            "lineNumber": 4526
          },
          {
            "text": "                activeTab={activeTab} ",
            "lineNumber": 4527
          },
          {
            "text": "                state={state}",
            "lineNumber": 4528
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.2293606996536255
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 42
          },
          "endPosition": {
            "line": 107,
            "column": 1
          }
        },
        "contents": "const ClearPersonModal = \n&gt;{t('context.selectNone')}&lt;/button&gt; \n        &lt;/div&gt; \n      &lt;/div&gt; \n      &lt;div className=\"flex-1 overflow-y-auto min-h-[200px] space-y-1 mb-4 border border-gray-100 dark:border-gray-700 rounded p-1\"&gt; \n        {peopleList.map((p: Person) =&gt; { \n          const coverFile = files[p.coverFileId]; \n          const hasCover = !!coverFile; \n          const isSelected = selectedPeople.includes(p.id); \n          return ( \n            &lt;div key={p.id} onClick={() =&gt; handleTogglePerson(p.id)} className={&#96;flex items-center p-2 rounded cursor-pointer group border border-transparent ${isSelected ? 'bg-blue-100 dark:bg-blue-900/50 border-l-4 border-blue-500 shadow-md font-semibold' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}&#96;}&gt; \n              &lt;div className=\"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 overflow-hidden mr-3 flex items-center justify-center\"&gt;\n                {hasCover ? (/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */&lt;div className=\"w-full h-full flex items-center justify-center bg-gray-300 dark:bg-gray-700\"&gt;&lt;User size={14} className=\"text-gray-400 dark:text-gray-500\" /&gt;&lt;/div&gt;) : (\n                  &lt;User size={14} className=\"text-gray-400 dark:text-gray-500\" /&gt;\n                )}\n              &lt;/div&gt; \n              &lt;span className={&#96;text-sm flex-1 ${isSelected ? 'text-blue-700 dark:text-blue-300' : 'text-gray-800 dark:text-gray-200'}&#96;}&gt;{p.name}&lt;/span&gt; \n              &lt;div className={&#96;w-5 h-5 rounded border-2 flex items-center justify-center ${isSelected ? 'border-blue-600 bg-blue-600 ring-2 ring-blue-300/50 dark:ring-blue-700/50 shadow-sm' : 'border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800'}&#96;}&gt; \n                {isSelected &amp;&amp; &lt;Check size={14} className=\"text-white\" strokeWidth={3} /&gt;} \n              &lt;/div&gt; \n            &lt;/div&gt; \n          ); \n        })}\n      &lt;/div&gt; \n      &lt;div className=\"flex justify-end space-x-2\"&gt; \n        \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 41,
                "column": 1
              },
              "endPosition": {
                "line": 41,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 41,
                "column": 7
              },
              "endPosition": {
                "line": 41,
                "column": 26
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const ClearPersonModal = ",
            "lineNumber": 43
          },
          {
            "text": "&gt;{t('context.selectNone')}&lt;/button&gt; ",
            "lineNumber": 79
          },
          {
            "text": "        &lt;/div&gt; ",
            "lineNumber": 80
          },
          {
            "text": "      &lt;/div&gt; ",
            "lineNumber": 81
          },
          {
            "text": "      &lt;div className=\"flex-1 overflow-y-auto min-h-[200px] space-y-1 mb-4 border border-gray-100 dark:border-gray-700 rounded p-1\"&gt; ",
            "lineNumber": 82
          },
          {
            "text": "        {peopleList.map((p: Person) =&gt; { ",
            "lineNumber": 83
          },
          {
            "text": "          const coverFile = files[p.coverFileId]; ",
            "lineNumber": 84
          },
          {
            "text": "          const hasCover = !!coverFile; ",
            "lineNumber": 85
          },
          {
            "text": "          const isSelected = selectedPeople.includes(p.id); ",
            "lineNumber": 86
          },
          {
            "text": "          return ( ",
            "lineNumber": 87
          },
          {
            "text": "            &lt;div key={p.id} onClick={() =&gt; handleTogglePerson(p.id)} className={&#96;flex items-center p-2 rounded cursor-pointer group border border-transparent ${isSelected ? 'bg-blue-100 dark:bg-blue-900/50 border-l-4 border-blue-500 shadow-md font-semibold' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}&#96;}&gt; ",
            "lineNumber": 88
          },
          {
            "text": "              &lt;div className=\"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 overflow-hidden mr-3 flex items-center justify-center\"&gt;",
            "lineNumber": 89
          },
          {
            "text": "                {hasCover ? (/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */&lt;div className=\"w-full h-full flex items-center justify-center bg-gray-300 dark:bg-gray-700\"&gt;&lt;User size={14} className=\"text-gray-400 dark:text-gray-500\" /&gt;&lt;/div&gt;) : (",
            "lineNumber": 90
          },
          {
            "text": "                  &lt;User size={14} className=\"text-gray-400 dark:text-gray-500\" /&gt;",
            "lineNumber": 91
          },
          {
            "text": "                )}",
            "lineNumber": 92
          },
          {
            "text": "              &lt;/div&gt; ",
            "lineNumber": 93
          },
          {
            "text": "              &lt;span className={&#96;text-sm flex-1 ${isSelected ? 'text-blue-700 dark:text-blue-300' : 'text-gray-800 dark:text-gray-200'}&#96;}&gt;{p.name}&lt;/span&gt; ",
            "lineNumber": 94
          },
          {
            "text": "              &lt;div className={&#96;w-5 h-5 rounded border-2 flex items-center justify-center ${isSelected ? 'border-blue-600 bg-blue-600 ring-2 ring-blue-300/50 dark:ring-blue-700/50 shadow-sm' : 'border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800'}&#96;}&gt; ",
            "lineNumber": 95
          },
          {
            "text": "                {isSelected &amp;&amp; &lt;Check size={14} className=\"text-white\" strokeWidth={3} /&gt;} ",
            "lineNumber": 96
          },
          {
            "text": "              &lt;/div&gt; ",
            "lineNumber": 97
          },
          {
            "text": "            &lt;/div&gt; ",
            "lineNumber": 98
          },
          {
            "text": "          ); ",
            "lineNumber": 99
          },
          {
            "text": "        })}",
            "lineNumber": 100
          },
          {
            "text": "      &lt;/div&gt; ",
            "lineNumber": 101
          },
          {
            "text": "      &lt;div className=\"flex justify-end space-x-2\"&gt; ",
            "lineNumber": 102
          },
          {
            "text": "        ",
            "lineNumber": 103
          },
          {
            "text": ";",
            "lineNumber": 108
          }
        ]
      },
      "score": 0.22735460102558136
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 467
          },
          "endPosition": {
            "line": 584,
            "column": 1
          }
        },
        "contents": "export const Sidebar: React.FC&lt;{\n  roots: string[];\n  files: Record&lt;string, FileNode&gt;;\n  people: Record&lt;string, Person&gt;;\n  customTags: string[];\n  currentFolderId: string;\n  expandedIds: string[];\n  tasks?: TaskProgress[];\n  onToggle: (id: string) =&gt; void;\n  onNavigate: (id: string) =&gt; void;\n  onTagSelect: (tag: string) =&gt; void;\n  onNavigateAllTags: () =&gt; void;\n  onPersonSelect: (personId: string) =&gt; void;\n  onNavigateAllPeople: () =&gt; void;\n  onContextMenu: (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'person', id: string) =&gt; void;\n  onDrop: (targetId: string, sourceIds: string[]) =&gt; void;\n  onDropOnTag: (tag: string, sourceIds: string[]) =&gt; void;\n  isCreatingTag: boolean;\n  onStartCreateTag: () =&gt; void;\n  onSaveNewTag: (tag: string) =&gt; void;\n  onCancelCreateTag: () =&gt; void;\n  onOpenSettings: () =&gt; void;\n  onRestoreTask: (taskId: string) =&gt; void;\n  onStartRenamePerson: (personId: string) =&gt; void;\n  onCreatePerson: () =&gt; void;\n  t: (key: string) =&gt; string;\n}&gt; =  {\n  \n  const minimizedTasks = tasks ? tasks.filter(task =&gt; task.minimized &amp;&amp; task.status === 'running') : [];\n\n  return (\n    &lt;div className=\"w-full h-full flex flex-col\"&gt;\n      &lt;div className=\"p-3 font-bold text-gray-500 dark:text-gray-400 text-xs uppercase tracking-wider border-b border-gray-200 dark:border-gray-800\"&gt;\n        {t('sidebar.catalog')}\n      &lt;/div&gt;\n      &lt;div className=\"flex-1 overflow-y-auto scrollbar-thin\"&gt;\n        {roots.map(rootId =&gt; (\n          &lt;TreeNode \n            key={rootId}\n            files={files}\n            nodeId={rootId}\n            currentFolderId={currentFolderId}\n            expandedIds={expandedIds}\n            onToggle={onToggle}\n            onNavigate={onNavigate}\n            onContextMenu={onContextMenu}\n            onDrop={onDrop}\n          /&gt;\n        ))}\n        \n        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;\n        \n        &lt;PeopleSection \n           people={people}\n           files={files}\n           onPersonSelect={onPersonSelect}\n           onNavigateAllPeople={onNavigateAllPeople}\n           onContextMenu={onContextMenu}\n           onStartRenamePerson={onStartRenamePerson}\n           onCreatePerson={onCreatePerson}\n           t={t}\n        /&gt;\n\n        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;\n        \n        &lt;TagSection \n          files={files} \n          customTags={customTags}\n          onTagSelect={onTagSelect} \n          onNavigateAllTags={onNavigateAllTags} \n          onContextMenu={onContextMenu}\n          isCreatingTag={isCreatingTag}\n          onStartCreateTag={onStartCreateTag}\n          onSaveNewTag={onSaveNewTag}\n          onCancelCreateTag={onCancelCreateTag}\n          onDropOnTag={onDropOnTag}\n          t={t}\n        /&gt;\n      &lt;/div&gt;\n      \n      {minimizedTasks.length &gt; 0 &amp;&amp;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 468,
                "column": 1
              },
              "endPosition": {
                "line": 468,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 468,
                "column": 8
              },
              "endPosition": {
                "line": 468,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 468,
                "column": 14
              },
              "endPosition": {
                "line": 494,
                "column": 6
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const Sidebar: React.FC&lt;{",
            "lineNumber": 468
          },
          {
            "text": "  roots: string[];",
            "lineNumber": 469
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 470
          },
          {
            "text": "  people: Record&lt;string, Person&gt;;",
            "lineNumber": 471
          },
          {
            "text": "  customTags: string[];",
            "lineNumber": 472
          },
          {
            "text": "  currentFolderId: string;",
            "lineNumber": 473
          },
          {
            "text": "  expandedIds: string[];",
            "lineNumber": 474
          },
          {
            "text": "  tasks?: TaskProgress[];",
            "lineNumber": 475
          },
          {
            "text": "  onToggle: (id: string) =&gt; void;",
            "lineNumber": 476
          },
          {
            "text": "  onNavigate: (id: string) =&gt; void;",
            "lineNumber": 477
          },
          {
            "text": "  onTagSelect: (tag: string) =&gt; void;",
            "lineNumber": 478
          },
          {
            "text": "  onNavigateAllTags: () =&gt; void;",
            "lineNumber": 479
          },
          {
            "text": "  onPersonSelect: (personId: string) =&gt; void;",
            "lineNumber": 480
          },
          {
            "text": "  onNavigateAllPeople: () =&gt; void;",
            "lineNumber": 481
          },
          {
            "text": "  onContextMenu: (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'person', id: string) =&gt; void;",
            "lineNumber": 482
          },
          {
            "text": "  onDrop: (targetId: string, sourceIds: string[]) =&gt; void;",
            "lineNumber": 483
          },
          {
            "text": "  onDropOnTag: (tag: string, sourceIds: string[]) =&gt; void;",
            "lineNumber": 484
          },
          {
            "text": "  isCreatingTag: boolean;",
            "lineNumber": 485
          },
          {
            "text": "  onStartCreateTag: () =&gt; void;",
            "lineNumber": 486
          },
          {
            "text": "  onSaveNewTag: (tag: string) =&gt; void;",
            "lineNumber": 487
          },
          {
            "text": "  onCancelCreateTag: () =&gt; void;",
            "lineNumber": 488
          },
          {
            "text": "  onOpenSettings: () =&gt; void;",
            "lineNumber": 489
          },
          {
            "text": "  onRestoreTask: (taskId: string) =&gt; void;",
            "lineNumber": 490
          },
          {
            "text": "  onStartRenamePerson: (personId: string) =&gt; void;",
            "lineNumber": 491
          },
          {
            "text": "  onCreatePerson: () =&gt; void;",
            "lineNumber": 492
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 493
          },
          {
            "text": "}&gt; =  {",
            "lineNumber": 494
          },
          {
            "text": "  ",
            "lineNumber": 495
          },
          {
            "text": "  const minimizedTasks = tasks ? tasks.filter(task =&gt; task.minimized &amp;&amp; task.status === 'running') : [];",
            "lineNumber": 496
          },
          {
            "lineNumber": 497
          },
          {
            "text": "  return (",
            "lineNumber": 498
          },
          {
            "text": "    &lt;div className=\"w-full h-full flex flex-col\"&gt;",
            "lineNumber": 499
          },
          {
            "text": "      &lt;div className=\"p-3 font-bold text-gray-500 dark:text-gray-400 text-xs uppercase tracking-wider border-b border-gray-200 dark:border-gray-800\"&gt;",
            "lineNumber": 500
          },
          {
            "text": "        {t('sidebar.catalog')}",
            "lineNumber": 501
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 502
          },
          {
            "text": "      &lt;div className=\"flex-1 overflow-y-auto scrollbar-thin\"&gt;",
            "lineNumber": 503
          },
          {
            "text": "        {roots.map(rootId =&gt; (",
            "lineNumber": 504
          },
          {
            "text": "          &lt;TreeNode ",
            "lineNumber": 505
          },
          {
            "text": "            key={rootId}",
            "lineNumber": 506
          },
          {
            "text": "            files={files}",
            "lineNumber": 507
          },
          {
            "text": "            nodeId={rootId}",
            "lineNumber": 508
          },
          {
            "text": "            currentFolderId={currentFolderId}",
            "lineNumber": 509
          },
          {
            "text": "            expandedIds={expandedIds}",
            "lineNumber": 510
          },
          {
            "text": "            onToggle={onToggle}",
            "lineNumber": 511
          },
          {
            "text": "            onNavigate={onNavigate}",
            "lineNumber": 512
          },
          {
            "text": "            onContextMenu={onContextMenu}",
            "lineNumber": 513
          },
          {
            "text": "            onDrop={onDrop}",
            "lineNumber": 514
          },
          {
            "text": "          /&gt;",
            "lineNumber": 515
          },
          {
            "text": "        ))}",
            "lineNumber": 516
          },
          {
            "text": "        ",
            "lineNumber": 517
          },
          {
            "text": "        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;",
            "lineNumber": 518
          },
          {
            "text": "        ",
            "lineNumber": 519
          },
          {
            "text": "        &lt;PeopleSection ",
            "lineNumber": 520
          },
          {
            "text": "           people={people}",
            "lineNumber": 521
          },
          {
            "text": "           files={files}",
            "lineNumber": 522
          },
          {
            "text": "           onPersonSelect={onPersonSelect}",
            "lineNumber": 523
          },
          {
            "text": "           onNavigateAllPeople={onNavigateAllPeople}",
            "lineNumber": 524
          },
          {
            "text": "           onContextMenu={onContextMenu}",
            "lineNumber": 525
          },
          {
            "text": "           onStartRenamePerson={onStartRenamePerson}",
            "lineNumber": 526
          },
          {
            "text": "           onCreatePerson={onCreatePerson}",
            "lineNumber": 527
          },
          {
            "text": "           t={t}",
            "lineNumber": 528
          },
          {
            "text": "        /&gt;",
            "lineNumber": 529
          },
          {
            "lineNumber": 530
          },
          {
            "text": "        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;",
            "lineNumber": 531
          },
          {
            "text": "        ",
            "lineNumber": 532
          },
          {
            "text": "        &lt;TagSection ",
            "lineNumber": 533
          },
          {
            "text": "          files={files} ",
            "lineNumber": 534
          },
          {
            "text": "          customTags={customTags}",
            "lineNumber": 535
          },
          {
            "text": "          onTagSelect={onTagSelect} ",
            "lineNumber": 536
          },
          {
            "text": "          onNavigateAllTags={onNavigateAllTags} ",
            "lineNumber": 537
          },
          {
            "text": "          onContextMenu={onContextMenu}",
            "lineNumber": 538
          },
          {
            "text": "          isCreatingTag={isCreatingTag}",
            "lineNumber": 539
          },
          {
            "text": "          onStartCreateTag={onStartCreateTag}",
            "lineNumber": 540
          },
          {
            "text": "          onSaveNewTag={onSaveNewTag}",
            "lineNumber": 541
          },
          {
            "text": "          onCancelCreateTag={onCancelCreateTag}",
            "lineNumber": 542
          },
          {
            "text": "          onDropOnTag={onDropOnTag}",
            "lineNumber": 543
          },
          {
            "text": "          t={t}",
            "lineNumber": 544
          },
          {
            "text": "        /&gt;",
            "lineNumber": 545
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 546
          },
          {
            "text": "      ",
            "lineNumber": 547
          },
          {
            "text": "      {minimizedTasks.length &gt; 0 &amp;&amp;",
            "lineNumber": 548
          },
          {
            "text": ";",
            "lineNumber": 585
          }
        ]
      },
      "score": 0.22535189986228943
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n \n                        resourceRoot={state.settings.paths.resourceRoot}\n                        cachePath={state.settings.paths.cacheRoot || (state.settings.paths.resourceRoot ? &#96;${state.settings.paths.resourceRoot}${state.settings.paths.resourceRoot.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96; : undefined)} \n                        hoverPlayingId={hoverPlayingId} \n                        onSetHoverPlayingId={setHoverPlayingId} \n                        onFileClick={handleFileClick} \n                        onFileDoubleClick={(id) =&gt; state.files[id]?.type === FileType.FOLDER ? handleNavigateFolder(id) : enterViewer(id)} \n                        onContextMenu={(e, id) =&gt; handleContextMenu(e, 'file', id)} \n                        onRenameSubmit={handleRenameSubmit} \n                        onRenameCancel={() =&gt; setState(s =&gt; ({ ...s, renamingId: null }))} \n                        onStartRename={startRename} \n                        onDragStart={handleDragStart} \n                        onDragEnd={handleDragEnd} \n                        onDropOnFolder={handleDropOnFolder} \n                        settings={state.settings}\n                        onDropExternal={(targetId, paths) =&gt; {\n                            // 1. 核心检查：如果是内部发起的拖拽 (isInternalDragRef.current = true)\n                            // 即使走到了 onDropExternal 通道，我们也把它强行扭转为“移动”操作\n                            if (isInternalDragRef.current)\n                        }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": " ",
            "lineNumber": 4734
          },
          {
            "text": "                        resourceRoot={state.settings.paths.resourceRoot}",
            "lineNumber": 4735
          },
          {
            "text": "                        cachePath={state.settings.paths.cacheRoot || (state.settings.paths.resourceRoot ? &#96;${state.settings.paths.resourceRoot}${state.settings.paths.resourceRoot.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96; : undefined)} ",
            "lineNumber": 4736
          },
          {
            "text": "                        hoverPlayingId={hoverPlayingId} ",
            "lineNumber": 4737
          },
          {
            "text": "                        onSetHoverPlayingId={setHoverPlayingId} ",
            "lineNumber": 4738
          },
          {
            "text": "                        onFileClick={handleFileClick} ",
            "lineNumber": 4739
          },
          {
            "text": "                        onFileDoubleClick={(id) =&gt; state.files[id]?.type === FileType.FOLDER ? handleNavigateFolder(id) : enterViewer(id)} ",
            "lineNumber": 4740
          },
          {
            "text": "                        onContextMenu={(e, id) =&gt; handleContextMenu(e, 'file', id)} ",
            "lineNumber": 4741
          },
          {
            "text": "                        onRenameSubmit={handleRenameSubmit} ",
            "lineNumber": 4742
          },
          {
            "text": "                        onRenameCancel={() =&gt; setState(s =&gt; ({ ...s, renamingId: null }))} ",
            "lineNumber": 4743
          },
          {
            "text": "                        onStartRename={startRename} ",
            "lineNumber": 4744
          },
          {
            "text": "                        onDragStart={handleDragStart} ",
            "lineNumber": 4745
          },
          {
            "text": "                        onDragEnd={handleDragEnd} ",
            "lineNumber": 4746
          },
          {
            "text": "                        onDropOnFolder={handleDropOnFolder} ",
            "lineNumber": 4747
          },
          {
            "text": "                        settings={state.settings}",
            "lineNumber": 4748
          },
          {
            "text": "                        onDropExternal={(targetId, paths) =&gt; {",
            "lineNumber": 4749
          },
          {
            "text": "                            // 1. 核心检查：如果是内部发起的拖拽 (isInternalDragRef.current = true)",
            "lineNumber": 4750
          },
          {
            "text": "                            // 即使走到了 onDropExternal 通道，我们也把它强行扭转为“移动”操作",
            "lineNumber": 4751
          },
          {
            "text": "                            if (isInternalDragRef.current)",
            "lineNumber": 4752
          },
          {
            "text": "                        }",
            "lineNumber": 4764
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.22425170242786407
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\types.ts",
        "range": {
          "startPosition": {
            "line": 170
          },
          "endPosition": {
            "line": 193,
            "column": 1
          }
        },
        "contents": "export interface FolderSettings {\n;\n  sortDirection: SortDirection;\n  groupBy: GroupByOption;\n}\n\nexport interface FileGroup {\n  id: string;\n  title: string;\n  fileIds: string[];\n}\n\nexport interface HistoryItem {\n  folderId: string;\n  viewingId: string | null;\n  viewMode: 'browser' | 'tags-overview' | 'people-overview';\n  searchQuery: string;\n  searchScope: SearchScope;\n  activeTags: string[];\n;\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export interface FolderSettings {",
            "lineNumber": 171,
            "isSignature": true
          },
          {
            "text": ";",
            "lineNumber": 173
          },
          {
            "text": "  sortDirection: SortDirection;",
            "lineNumber": 174
          },
          {
            "text": "  groupBy: GroupByOption;",
            "lineNumber": 175,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 176,
            "isSignature": true
          },
          {
            "lineNumber": 177
          },
          {
            "text": "export interface FileGroup {",
            "lineNumber": 178,
            "isSignature": true
          },
          {
            "text": "  id: string;",
            "lineNumber": 179
          },
          {
            "text": "  title: string;",
            "lineNumber": 180
          },
          {
            "text": "  fileIds: string[];",
            "lineNumber": 181,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 182,
            "isSignature": true
          },
          {
            "lineNumber": 183
          },
          {
            "text": "export interface HistoryItem {",
            "lineNumber": 184,
            "isSignature": true
          },
          {
            "text": "  folderId: string;",
            "lineNumber": 185
          },
          {
            "text": "  viewingId: string | null;",
            "lineNumber": 186
          },
          {
            "text": "  viewMode: 'browser' | 'tags-overview' | 'people-overview';",
            "lineNumber": 187
          },
          {
            "text": "  searchQuery: string;",
            "lineNumber": 188
          },
          {
            "text": "  searchScope: SearchScope;",
            "lineNumber": 189
          },
          {
            "text": "  activeTags: string[];",
            "lineNumber": 190
          },
          {
            "text": ";",
            "lineNumber": 193,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 194,
            "isSignature": true
          }
        ]
      },
      "score": 0.2163688987493515
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 139
          },
          "endPosition": {
            "line": 215,
            "column": 1
          }
        },
        "contents": "const PeopleSection: React.FC&lt;PeopleSectionProps&gt; = \n\n          &lt;/button&gt;\n        &lt;/div&gt;\n\n        {expanded &amp;&amp; (\n          &lt;div className=\"pl-6 pr-2 pb-2 mt-1\"&gt;\n             {peopleList.length === 0 ? (\n                 &lt;div className=\"text-xs text-gray-400 italic py-1\"&gt;{t('sidebar.noPeople')}&lt;/div&gt;\n             ) : (\n                 &lt;div className=\"grid grid-cols-4 gap-2\"&gt;\n                     {peopleList.map(person =&gt; {\n                        const coverFile = files[person.coverFileId];\n                        \n                        return (\n                           &lt;div \n                              key={person.id} \n                              className=\"flex flex-col items-center group cursor-pointer\"\n                              onClick={() =&gt; onPersonSelect(person.id)}\n                              onContextMenu={(e) =&gt; onContextMenu(e, 'person', person.id)}\n                              onDoubleClick={(e) =&gt; {\n                                  e.stopPropagation();\n                                  onStartRenamePerson(person.id);\n                              }}\n                              title={person.name}\n                           &gt;\n                              &lt;div className=\"w-10 h-10 rounded-full border border-gray-200 dark:border-gray-700 overflow-hidden bg-gray-100 dark:bg-gray-800 hover:border-purple-500 dark:hover:border-purple-400 hover:ring-2 ring-purple-200 dark:ring-purple-900 transition-all shadow-sm relative\"&gt;\n                                 {coverFile ?\n                     }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 140,
                "column": 1
              },
              "endPosition": {
                "line": 140,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 140,
                "column": 7
              },
              "endPosition": {
                "line": 140,
                "column": 53
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const PeopleSection: React.FC&lt;PeopleSectionProps&gt; = ",
            "lineNumber": 140
          },
          {
            "lineNumber": 169
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 170
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 171
          },
          {
            "lineNumber": 172
          },
          {
            "text": "        {expanded &amp;&amp; (",
            "lineNumber": 173
          },
          {
            "text": "          &lt;div className=\"pl-6 pr-2 pb-2 mt-1\"&gt;",
            "lineNumber": 174
          },
          {
            "text": "             {peopleList.length === 0 ? (",
            "lineNumber": 175
          },
          {
            "text": "                 &lt;div className=\"text-xs text-gray-400 italic py-1\"&gt;{t('sidebar.noPeople')}&lt;/div&gt;",
            "lineNumber": 176
          },
          {
            "text": "             ) : (",
            "lineNumber": 177
          },
          {
            "text": "                 &lt;div className=\"grid grid-cols-4 gap-2\"&gt;",
            "lineNumber": 178
          },
          {
            "text": "                     {peopleList.map(person =&gt; {",
            "lineNumber": 179
          },
          {
            "text": "                        const coverFile = files[person.coverFileId];",
            "lineNumber": 180
          },
          {
            "text": "                        ",
            "lineNumber": 181
          },
          {
            "text": "                        return (",
            "lineNumber": 182
          },
          {
            "text": "                           &lt;div ",
            "lineNumber": 183
          },
          {
            "text": "                              key={person.id} ",
            "lineNumber": 184
          },
          {
            "text": "                              className=\"flex flex-col items-center group cursor-pointer\"",
            "lineNumber": 185
          },
          {
            "text": "                              onClick={() =&gt; onPersonSelect(person.id)}",
            "lineNumber": 186
          },
          {
            "text": "                              onContextMenu={(e) =&gt; onContextMenu(e, 'person', person.id)}",
            "lineNumber": 187
          },
          {
            "text": "                              onDoubleClick={(e) =&gt; {",
            "lineNumber": 188
          },
          {
            "text": "                                  e.stopPropagation();",
            "lineNumber": 189
          },
          {
            "text": "                                  onStartRenamePerson(person.id);",
            "lineNumber": 190
          },
          {
            "text": "                              }}",
            "lineNumber": 191
          },
          {
            "text": "                              title={person.name}",
            "lineNumber": 192
          },
          {
            "text": "                           &gt;",
            "lineNumber": 193
          },
          {
            "text": "                              &lt;div className=\"w-10 h-10 rounded-full border border-gray-200 dark:border-gray-700 overflow-hidden bg-gray-100 dark:bg-gray-800 hover:border-purple-500 dark:hover:border-purple-400 hover:ring-2 ring-purple-200 dark:ring-purple-900 transition-all shadow-sm relative\"&gt;",
            "lineNumber": 194
          },
          {
            "text": "                                 {coverFile ?",
            "lineNumber": 195
          },
          {
            "text": "                     }",
            "lineNumber": 209
          },
          {
            "text": ";",
            "lineNumber": 216
          }
        ]
      },
      "score": 0.21469509601593018
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nconst batchStats = () =&gt; {\n\n\n    return { totalSize, typeCount, allTags: Array.from(allTags).sort() };\n  }, [selectedFileIds, files]);\n\n  const batchChartData = useMemo(() =&gt; {\n      if (!batchStats) return [];\n      const data: { label: string; value: number; color: string }[] = [];\n\n      Object.entries(batchStats.typeCount).forEach(([type, count]) =&gt; {\n          let label = type;\n          let colorKey = type;\n          if (type === 'FOLDER') {\n              label = t('meta.folderType');\n              colorKey = 'FOLDER';\n          }\n          data.push({\n              label: label,\n              value: count,\n              color: typeColors[colorKey] || defaultColor\n          });\n      });\n\n      return data.sort((a, b) =&gt; b.value - a.value);\n  }, [batchStats, t]);\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "const batchStats = () =&gt; {",
            "lineNumber": 678
          },
          {
            "lineNumber": 697
          },
          {
            "lineNumber": 698
          },
          {
            "text": "    return { totalSize, typeCount, allTags: Array.from(allTags).sort() };",
            "lineNumber": 699
          },
          {
            "text": "  }, [selectedFileIds, files]);",
            "lineNumber": 700
          },
          {
            "lineNumber": 701
          },
          {
            "text": "  const batchChartData = useMemo(() =&gt; {",
            "lineNumber": 702
          },
          {
            "text": "      if (!batchStats) return [];",
            "lineNumber": 703
          },
          {
            "text": "      const data: { label: string; value: number; color: string }[] = [];",
            "lineNumber": 704
          },
          {
            "lineNumber": 705
          },
          {
            "text": "      Object.entries(batchStats.typeCount).forEach(([type, count]) =&gt; {",
            "lineNumber": 706
          },
          {
            "text": "          let label = type;",
            "lineNumber": 707
          },
          {
            "text": "          let colorKey = type;",
            "lineNumber": 708
          },
          {
            "text": "          if (type === 'FOLDER') {",
            "lineNumber": 709
          },
          {
            "text": "              label = t('meta.folderType');",
            "lineNumber": 710
          },
          {
            "text": "              colorKey = 'FOLDER';",
            "lineNumber": 711
          },
          {
            "text": "          }",
            "lineNumber": 712
          },
          {
            "text": "          data.push({",
            "lineNumber": 713
          },
          {
            "text": "              label: label,",
            "lineNumber": 714
          },
          {
            "text": "              value: count,",
            "lineNumber": 715
          },
          {
            "text": "              color: typeColors[colorKey] || defaultColor",
            "lineNumber": 716
          },
          {
            "text": "          });",
            "lineNumber": 717
          },
          {
            "text": "      });",
            "lineNumber": 718
          },
          {
            "lineNumber": 719
          },
          {
            "text": "      return data.sort((a, b) =&gt; b.value - a.value);",
            "lineNumber": 720
          },
          {
            "text": "  }, [batchStats, t]);",
            "lineNumber": 721
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.21311749517917633
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleCopyFiles = async \n() =&gt; {\nprev =&gt; (\n\n              }));\n          }, 1000);\n      }\n  };\n\n  const handleMoveFiles = async (fileIds: string[], targetFolderId: string) =&gt; {\n      console.log('[MoveFiles] Starting move operation', { fileIds, targetFolderId });\n      \n      if (fileIds.includes(targetFolderId)) {\n          console.error('[MoveFiles] Cannot move a folder into itself');\n          return;\n      }\n      \n      const targetFolder = state.files[targetFolderId];\n      console.log('[MoveFiles] Target folder info', { targetFolder: targetFolder?.name, targetPath: targetFolder?.path });\n      \n      if (!targetFolder || !targetFolder.path) {\n          console.error('[MoveFiles] Invalid target folder or path');\n          return;\n      }\n      \n      const taskId = startTask('move', fileIds, t('tasks.moving'), false); // 禁用自动进度\n      console.log('[MoveFiles] Task started with ID', taskId);\n      \n      try {\n          const separator = targetFolder.path.includes('/') ? '/' : '\\\\';\n          // Collect all unique source parent IDs\n          const sourceParentIds = new Set&lt;string&gt;();\n          let movedCount = 0;\n          \n          // Check for existing files before performing file system operations\n          console.log('[MoveFiles] Checking for existing files');\n          let existingFiles: string[] = [];\n          const targetPaths: Record&lt;string, string&gt; = {};\n          \n          for (const id of fileIds) {\n              const file = state.files[id];\n              if (file &amp;&amp; file.path) {\n                  const filename = file.name;\n                  const newPath = &#96;${targetFolder.path}${separator}${filename}&#96;;\n                  targetPaths[id] = newPath;\n                  \n                  // Check if file exists at destination\n                  try {\n                      // Use Tauri API to check if file exists\n                      const exists = await invoke&lt;boolean&gt;('file_exists', { filePath: newPath });\n                      if (exists) {\n                          existingFiles.push(filename);\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1885,
                "column": 3
              },
              "endPosition": {
                "line": 1885,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1885,
                "column": 9
              },
              "endPosition": {
                "line": 1885,
                "column": 25
              }
            },
            {
              "startPosition": {
                "line": 1885,
                "column": 37
              },
              "endPosition": {
                "line": 1886,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleCopyFiles = async ",
            "lineNumber": 1870
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 1962
          },
          {
            "text": "prev =&gt; (",
            "lineNumber": 1963
          },
          {
            "lineNumber": 1965
          },
          {
            "text": "              }));",
            "lineNumber": 1966
          },
          {
            "text": "          }, 1000);",
            "lineNumber": 1967
          },
          {
            "text": "      }",
            "lineNumber": 1968
          },
          {
            "text": "  };",
            "lineNumber": 1969
          },
          {
            "lineNumber": 1970
          },
          {
            "text": "  const handleMoveFiles = async (fileIds: string[], targetFolderId: string) =&gt; {",
            "lineNumber": 1971
          },
          {
            "text": "      console.log('[MoveFiles] Starting move operation', { fileIds, targetFolderId });",
            "lineNumber": 1972
          },
          {
            "text": "      ",
            "lineNumber": 1973
          },
          {
            "text": "      if (fileIds.includes(targetFolderId)) {",
            "lineNumber": 1974
          },
          {
            "text": "          console.error('[MoveFiles] Cannot move a folder into itself');",
            "lineNumber": 1975
          },
          {
            "text": "          return;",
            "lineNumber": 1976
          },
          {
            "text": "      }",
            "lineNumber": 1977
          },
          {
            "text": "      ",
            "lineNumber": 1978
          },
          {
            "text": "      const targetFolder = state.files[targetFolderId];",
            "lineNumber": 1979
          },
          {
            "text": "      console.log('[MoveFiles] Target folder info', { targetFolder: targetFolder?.name, targetPath: targetFolder?.path });",
            "lineNumber": 1980
          },
          {
            "text": "      ",
            "lineNumber": 1981
          },
          {
            "text": "      if (!targetFolder || !targetFolder.path) {",
            "lineNumber": 1982
          },
          {
            "text": "          console.error('[MoveFiles] Invalid target folder or path');",
            "lineNumber": 1983
          },
          {
            "text": "          return;",
            "lineNumber": 1984
          },
          {
            "text": "      }",
            "lineNumber": 1985
          },
          {
            "text": "      ",
            "lineNumber": 1986
          },
          {
            "text": "      const taskId = startTask('move', fileIds, t('tasks.moving'), false); // 禁用自动进度",
            "lineNumber": 1987
          },
          {
            "text": "      console.log('[MoveFiles] Task started with ID', taskId);",
            "lineNumber": 1988
          },
          {
            "text": "      ",
            "lineNumber": 1989
          },
          {
            "text": "      try {",
            "lineNumber": 1990
          },
          {
            "text": "          const separator = targetFolder.path.includes('/') ? '/' : '\\\\';",
            "lineNumber": 1991
          },
          {
            "text": "          // Collect all unique source parent IDs",
            "lineNumber": 1992
          },
          {
            "text": "          const sourceParentIds = new Set&lt;string&gt;();",
            "lineNumber": 1993
          },
          {
            "text": "          let movedCount = 0;",
            "lineNumber": 1994
          },
          {
            "text": "          ",
            "lineNumber": 1995
          },
          {
            "text": "          // Check for existing files before performing file system operations",
            "lineNumber": 1996
          },
          {
            "text": "          console.log('[MoveFiles] Checking for existing files');",
            "lineNumber": 1997
          },
          {
            "text": "          let existingFiles: string[] = [];",
            "lineNumber": 1998
          },
          {
            "text": "          const targetPaths: Record&lt;string, string&gt; = {};",
            "lineNumber": 1999
          },
          {
            "text": "          ",
            "lineNumber": 2000
          },
          {
            "text": "          for (const id of fileIds) {",
            "lineNumber": 2001
          },
          {
            "text": "              const file = state.files[id];",
            "lineNumber": 2002
          },
          {
            "text": "              if (file &amp;&amp; file.path) {",
            "lineNumber": 2003
          },
          {
            "text": "                  const filename = file.name;",
            "lineNumber": 2004
          },
          {
            "text": "                  const newPath = &#96;${targetFolder.path}${separator}${filename}&#96;;",
            "lineNumber": 2005
          },
          {
            "text": "                  targetPaths[id] = newPath;",
            "lineNumber": 2006
          },
          {
            "text": "                  ",
            "lineNumber": 2007
          },
          {
            "text": "                  // Check if file exists at destination",
            "lineNumber": 2008
          },
          {
            "text": "                  try {",
            "lineNumber": 2009
          },
          {
            "text": "                      // Use Tauri API to check if file exists",
            "lineNumber": 2010
          },
          {
            "text": "                      const exists = await invoke&lt;boolean&gt;('file_exists', { filePath: newPath });",
            "lineNumber": 2011
          },
          {
            "text": "                      if (exists) {",
            "lineNumber": 2012
          },
          {
            "text": "                          existingFiles.push(filename);",
            "lineNumber": 2013
          },
          {
            "text": ";",
            "lineNumber": 2175
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.2124163955450058
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5046,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleChangePath = async \n\n          if (isTauriEnvironment()) {\n              // 计算缓存路径\n              const cachePath = &#96;${selectedPath}${selectedPath.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96;;\n              await ensureDirectory(cachePath);\n          }\n          \n          const newSettings = {\n              ...state.settings,\n              paths: {\n                  ...state.settings.paths,\n                  resourceRoot: selectedPath,\n                  // 清除 cacheRoot，因为现在它总是从 resourceRoot 计算\n                  cacheRoot: ''\n              }\n          };\n          \n          setState(prev =&gt; ({\n              ...prev,\n              settings: newSettings\n          }));\n          \n          startTask('ai', [], t('tasks.processing')); \n          const result = await scanDirectory(selectedPath);\n          \n          setState(prev =&gt; {\n               const newRoots = result.roots;\n               const newFiles = result.files;\n               const newRootId = newRoots.length &gt; 0 ? newRoots[0] : '';\n               if (!newRootId) return prev;\n               const newTab: TabState = { \n                   ...DUMMY_TAB, \n                   id: Math.random().toString(36).substr(2, 9),\n                   folderId: newRootId,\n                   history: { \n                       stack: [{ \n                           folderId: newRootId, \n                           viewingId: null, \n                           viewMode: 'browser', \n                           searchQuery: '', \n                           searchScope: 'all', \n                           activeTags: [], \n                           activePersonId: null \n                       }], \n                       currentIndex: 0 \n                   } \n               };\n               return {\n                   ...prev,\n                   roots: newRoots,\n                   files: newFiles,\n                   expandedFolderIds: [newRootId],\n                   tabs: [newTab],\n                   activeTabId: newTab.id,\n                   settings: newSettings\n               };\n          });\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 2572,
                "column": 3
              },
              "endPosition": {
                "line": 2572,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 2572,
                "column": 9
              },
              "endPosition": {
                "line": 2572,
                "column": 33
              }
            },
            {
              "startPosition": {
                "line": 2578,
                "column": 7
              },
              "endPosition": {
                "line": 2578,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 2578,
                "column": 16
              },
              "endPosition": {
                "line": 2579,
                "column": 11
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleChangePath = async ",
            "lineNumber": 2665
          },
          {
            "lineNumber": 2672
          },
          {
            "text": "          if (isTauriEnvironment()) {",
            "lineNumber": 2673
          },
          {
            "text": "              // 计算缓存路径",
            "lineNumber": 2674
          },
          {
            "text": "              const cachePath = &#96;${selectedPath}${selectedPath.includes('\\\\') ? '\\\\' : '/'}.Aurora_Cache&#96;;",
            "lineNumber": 2675
          },
          {
            "text": "              await ensureDirectory(cachePath);",
            "lineNumber": 2676
          },
          {
            "text": "          }",
            "lineNumber": 2677
          },
          {
            "text": "          ",
            "lineNumber": 2678
          },
          {
            "text": "          const newSettings = {",
            "lineNumber": 2679
          },
          {
            "text": "              ...state.settings,",
            "lineNumber": 2680
          },
          {
            "text": "              paths: {",
            "lineNumber": 2681
          },
          {
            "text": "                  ...state.settings.paths,",
            "lineNumber": 2682
          },
          {
            "text": "                  resourceRoot: selectedPath,",
            "lineNumber": 2683
          },
          {
            "text": "                  // 清除 cacheRoot，因为现在它总是从 resourceRoot 计算",
            "lineNumber": 2684
          },
          {
            "text": "                  cacheRoot: ''",
            "lineNumber": 2685
          },
          {
            "text": "              }",
            "lineNumber": 2686
          },
          {
            "text": "          };",
            "lineNumber": 2687
          },
          {
            "text": "          ",
            "lineNumber": 2688
          },
          {
            "text": "          setState(prev =&gt; ({",
            "lineNumber": 2689
          },
          {
            "text": "              ...prev,",
            "lineNumber": 2690
          },
          {
            "text": "              settings: newSettings",
            "lineNumber": 2691
          },
          {
            "text": "          }));",
            "lineNumber": 2692
          },
          {
            "text": "          ",
            "lineNumber": 2693
          },
          {
            "text": "          startTask('ai', [], t('tasks.processing')); ",
            "lineNumber": 2694
          },
          {
            "text": "          const result = await scanDirectory(selectedPath);",
            "lineNumber": 2695
          },
          {
            "text": "          ",
            "lineNumber": 2696
          },
          {
            "text": "          setState(prev =&gt; {",
            "lineNumber": 2697
          },
          {
            "text": "               const newRoots = result.roots;",
            "lineNumber": 2698
          },
          {
            "text": "               const newFiles = result.files;",
            "lineNumber": 2699
          },
          {
            "text": "               const newRootId = newRoots.length &gt; 0 ? newRoots[0] : '';",
            "lineNumber": 2700
          },
          {
            "text": "               if (!newRootId) return prev;",
            "lineNumber": 2701
          },
          {
            "text": "               const newTab: TabState = { ",
            "lineNumber": 2702
          },
          {
            "text": "                   ...DUMMY_TAB, ",
            "lineNumber": 2703
          },
          {
            "text": "                   id: Math.random().toString(36).substr(2, 9),",
            "lineNumber": 2704
          },
          {
            "text": "                   folderId: newRootId,",
            "lineNumber": 2705
          },
          {
            "text": "                   history: { ",
            "lineNumber": 2706
          },
          {
            "text": "                       stack: [{ ",
            "lineNumber": 2707
          },
          {
            "text": "                           folderId: newRootId, ",
            "lineNumber": 2708
          },
          {
            "text": "                           viewingId: null, ",
            "lineNumber": 2709
          },
          {
            "text": "                           viewMode: 'browser', ",
            "lineNumber": 2710
          },
          {
            "text": "                           searchQuery: '', ",
            "lineNumber": 2711
          },
          {
            "text": "                           searchScope: 'all', ",
            "lineNumber": 2712
          },
          {
            "text": "                           activeTags: [], ",
            "lineNumber": 2713
          },
          {
            "text": "                           activePersonId: null ",
            "lineNumber": 2714
          },
          {
            "text": "                       }], ",
            "lineNumber": 2715
          },
          {
            "text": "                       currentIndex: 0 ",
            "lineNumber": 2716
          },
          {
            "text": "                   } ",
            "lineNumber": 2717
          },
          {
            "text": "               };",
            "lineNumber": 2718
          },
          {
            "text": "               return {",
            "lineNumber": 2719
          },
          {
            "text": "                   ...prev,",
            "lineNumber": 2720
          },
          {
            "text": "                   roots: newRoots,",
            "lineNumber": 2721
          },
          {
            "text": "                   files: newFiles,",
            "lineNumber": 2722
          },
          {
            "text": "                   expandedFolderIds: [newRootId],",
            "lineNumber": 2723
          },
          {
            "text": "                   tabs: [newTab],",
            "lineNumber": 2724
          },
          {
            "text": "                   activeTabId: newTab.id,",
            "lineNumber": 2725
          },
          {
            "text": "                   settings: newSettings",
            "lineNumber": 2726
          },
          {
            "text": "               };",
            "lineNumber": 2727
          },
          {
            "text": "          });",
            "lineNumber": 2728
          },
          {
            "text": ";",
            "lineNumber": 2755
          },
          {
            "text": ";",
            "lineNumber": 5047
          }
        ]
      },
      "score": 0.20815914869308472
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/App.tsx</summary>

</details>
</tool-use>

---



---


查看人物主面板的显示逻辑，了解如何过滤人物：


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "people-overview|allPeople",
  "path": "src/components/FileGrid.tsx",
  "contextAfter": 20,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "people-overview|allPeople",
    "path": "src/components/FileGrid.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/components/FileGrid.tsx",
              "matches": [
                {
                  "lineNumber": 1336,
                  "content": "  viewMode: 'browser' | 'tags-overview' | 'people-overview',"
                },
                {
                  "lineNumber": 1337,
                  "content": "  groupedTags?: Record&lt;string, string[]&gt;,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1338,
                  "content": "  people?: Record&lt;string, Person&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1339,
                  "content": ") =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1340,
                  "content": "  const aspectRatios = useMemo(() =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1341,
                  "content": "    const ratios: Record&lt;string, number&gt; = {};",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1342,
                  "content": "    if (viewMode === 'browser') {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1343,
                  "content": "      items.forEach(id =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1344,
                  "content": "        const file = files[id];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1345,
                  "content": "        ratios[id] = file?.meta?.width &amp;&amp; file?.meta?.height",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1346,
                  "content": "          ? file.meta.width / file.meta.height",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1347,
                  "content": "          : (file?.type === FileType.FOLDER ? 1 : 1);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1348,
                  "content": "      });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1349,
                  "content": "    }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1350,
                  "content": "    return ratios;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1351,
                  "content": "  }, [items, files, viewMode]);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1352,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1353,
                  "content": "  return useMemo(() =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1354,
                  "content": "    const layout: LayoutItem[] = [];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1355,
                  "content": "    let totalHeight = 0;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1356,
                  "content": "    const GAP = 16;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1464,
                  "content": "    } else if (viewMode === 'people-overview') {"
                },
                {
                  "lineNumber": 1465,
                  "content": "        // Use provided people dictionary to generate IDs, ignore 'items' prop",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1466,
                  "content": "        const itemsList = Object.values(people || {});",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1467,
                  "content": "        const minColWidth = thumbnailSize;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1468,
                  "content": "        const cols = Math.max(1, Math.floor((finalAvailableWidth + GAP) / (minColWidth + GAP)));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1469,
                  "content": "        const itemWidth = (finalAvailableWidth - (cols - 1) * GAP) / cols;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1470,
                  "content": "        const itemHeight = itemWidth + 60; // Extra space for text",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1471,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1472,
                  "content": "        itemsList.forEach((person, index) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1473,
                  "content": "            const row = Math.floor(index / cols);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1474,
                  "content": "            const col = index % cols;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1475,
                  "content": "            layout.push({",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1476,
                  "content": "                id: person.id,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1477,
                  "content": "                x: PADDING + col * (itemWidth + GAP),",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1478,
                  "content": "                y: PADDING + row * (itemHeight + GAP),",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1479,
                  "content": "                width: itemWidth,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1480,
                  "content": "                height: itemHeight",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1481,
                  "content": "            });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1482,
                  "content": "        });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1483,
                  "content": "        const rows = Math.ceil(itemsList.length / cols);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1484,
                  "content": "        totalHeight = PADDING + rows * (itemHeight + GAP);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1724,
                  "content": "            const maxLimit = activeTab.viewMode === 'people-overview' ? 450 : 480;"
                },
                {
                  "lineNumber": 1725,
                  "content": "            const minLimit = activeTab.viewMode === 'people-overview' ? 140 : 100;"
                },
                {
                  "lineNumber": 1726,
                  "content": "            const step = 20;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1727,
                  "content": "            const delta = e.deltaY &gt; 0 ? -step : step;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1728,
                  "content": "            const newSize = Math.max(minLimit, Math.min(maxLimit, thumbnailSize + delta));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1729,
                  "content": "            onThumbnailSizeChange(newSize);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1730,
                  "content": "        }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1731,
                  "content": "    };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1732,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1733,
                  "content": "    container.addEventListener('wheel', handleWheel, { passive: false });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1734,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1735,
                  "content": "    return () =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1736,
                  "content": "        container.removeEventListener('wheel', handleWheel);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1737,
                  "content": "    };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1738,
                  "content": "  }, [containerRef, thumbnailSize, onThumbnailSizeChange, activeTab.viewMode]);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1739,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1740,
                  "content": "  useEffect(() =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1741,
                  "content": "    if (!containerRef?.current) return;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1742,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1743,
                  "content": "    const rect = containerRef.current.getBoundingClientRect();",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1744,
                  "content": "    if (rect.width &gt; 0) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1745,
                  "content": "        setContainerRect({ width: rect.width, height: rect.height });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1862,
                  "content": "          {activeTab.viewMode === 'people-overview' ? ("
                },
                {
                  "lineNumber": 1863,
                  "content": "              &lt;div className=\"w-full\" style={{ position: 'relative', minHeight: '100%' }}&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1864,
                  "content": "                  &lt;div style={{ position: 'relative' }}&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1865,
                  "content": "                      &lt;div",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1866,
                  "content": "                          className=\"relative\"",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1867,
                  "content": "                          style={{",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1868,
                  "content": "                              width: '100%',",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1869,
                  "content": "                              height: totalHeight,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1870,
                  "content": "                              position: 'relative'",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1871,
                  "content": "                          }}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1872,
                  "content": "                      &gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1873,
                  "content": "                          {visibleItems.map((item) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1874,
                  "content": "                              const person = people ? people[item.id] : null;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1875,
                  "content": "                              if (!person) return null;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1876,
                  "content": "                              return (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1877,
                  "content": "                                  &lt;PersonCard",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1878,
                  "content": "                                      key={person.id}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1879,
                  "content": "                                      person={person}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1880,
                  "content": "                                      files={files}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1881,
                  "content": "                                      isSelected={activeTab.selectedPersonIds.includes(person.id)}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1882,
                  "content": "                                      onPersonClick={handlePersonClick}",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 85,
          "totalMatchedLines": 5
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---



---


查看人物面板的搜索过滤逻辑：


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "searchQuery.*people|people.*searchQuery|filter.*person|person.*filter",
  "path": "src/App.tsx",
  "contextAfter": 10,
  "caseInsensitive": true
}
```
Result:

```json
{
  "success": {
    "pattern": "searchQuery.*people|people.*searchQuery|filter.*person|person.*filter",
    "path": "src/App.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/App.tsx",
              "matches": [
                {
                  "lineNumber": 17,
                  "content": "import { AppState, FileNode, FileType, SlideshowConfig, AppSettings, SearchScope, SortOption, TabState, LayoutMode, SUPPORTED_EXTENSIONS, DateFilter, SettingsCategory, AiData, TaskProgress, Person, HistoryItem, AiFace, GroupByOption, FileGroup, DeletionTask, AiSearchFilter } from './types';"
                },
                {
                  "lineNumber": 18,
                  "content": "import { Search, Folder, Image as ImageIcon, ArrowUp, X, FolderOpen, Tag, Folder as FolderIcon, Settings, Moon, Sun, Monitor, RotateCcw, Copy, Move, ChevronDown, FileText, Filter, Trash2, Undo2, Globe, Shield, QrCode, Smartphone, ExternalLink, Sliders, Plus, Layout, List, Grid, Maximize, AlertTriangle, Merge, FilePlus, ChevronRight, HardDrive, ChevronsDown, ChevronsUp, FolderPlus, Calendar, Server, Loader2, Database, Palette, Check, RefreshCw, Scan, Cpu, Cloud, FileCode, Edit3, Minus, User, Type, Brain, Sparkles, Crop, LogOut, XCircle } from 'lucide-react';",
                  "isContextLine": true
                },
                {
                  "lineNumber": 19,
                  "isContextLine": true
                },
                {
                  "lineNumber": 20,
                  "content": "// ... (helper components remain unchanged)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 21,
                  "content": "const TaskProgressModal = ({ tasks, onMinimize, onClose, t }: any) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 22,
                  "content": "  const [isMinimizing, setIsMinimizing] = useState(false);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 23,
                  "content": "  const activeTasks = tasks.filter((task: any) =&gt; !task.minimized);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 24,
                  "content": "  if (activeTasks.length === 0) return null;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 25,
                  "content": "  const handleMinimize = () =&gt; { setIsMinimizing(true); setTimeout(() =&gt; { activeTasks.forEach((task: any) =&gt; onMinimize(task.id)); setIsMinimizing(false); }, 300); };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 26,
                  "content": "  return (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 27,
                  "content": "    &lt;div className={&#96;fixed bottom-6 left-1/2 transform -translate-x-1/2 z-[100] transition-all duration-300 ease-in-out origin-bottom ${isMinimizing ? 'scale-75 opacity-0 translate-y-full' : 'scale-100 opacity-100'}&#96;}&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 41,
                  "content": "const AddToPersonModal = ({ people, files, onConfirm, onClose, t }: any) =&gt; { const [search, setSearch] = useState(''); const filteredPeople = Object.values(people as Record&lt;string, Person&gt;).filter((p: Person) =&gt; p.name.toLowerCase().includes(search.toLowerCase())); return ( &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-80 max-h-[500px] flex flex-col animate-zoom-in\"&gt;&lt;h3 className=\"font-bold text-lg mb-4 text-gray-900 dark:text-white\"&gt;{t('context.selectPerson')}&lt;/h3&gt;&lt;div className=\"relative mb-3\"&gt;&lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;&lt;input id=\"add-to-person-search\" name=\"add-to-person-search\" className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\" placeholder={t('search.placeholder')} value={search} onChange={e =&gt; setSearch(e.target.value)} autoFocus /&gt;&lt;/div&gt;&lt;div className=\"flex-1 overflow-y-auto min-h-[200px] space-y-"
                },
                {
                  "lineNumber": 42,
                  "isContextLine": true
                },
                {
                  "lineNumber": 43,
                  "content": "const ClearPersonModal = ({ files, fileIds, people, onConfirm, onClose, t }: any) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 44,
                  "content": "  // Get all unique people from selected files",
                  "isContextLine": true
                },
                {
                  "lineNumber": 45,
                  "content": "  const allPeople = new Set&lt;string&gt;();",
                  "isContextLine": true
                },
                {
                  "lineNumber": 46,
                  "content": "  fileIds.forEach((fileId: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 47,
                  "content": "    const file = files[fileId];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 48,
                  "content": "    if (file &amp;&amp; file.type === FileType.IMAGE &amp;&amp; file.aiData?.faces) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 49,
                  "content": "      file.aiData.faces.forEach((face: AiFace) =&gt; allPeople.add(face.personId));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 50,
                  "content": "    }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 51,
                  "content": "  });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 53,
                  "content": "  const peopleList = Array.from(allPeople).map(personId =&gt; people[personId]).filter(Boolean);"
                },
                {
                  "lineNumber": 54,
                  "content": "  const [selectedPeople, setSelectedPeople] = useState&lt;string[]&gt;(peopleList.map(p =&gt; p.id));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 55,
                  "isContextLine": true
                },
                {
                  "lineNumber": 56,
                  "content": "  const handleTogglePerson = (personId: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 57,
                  "content": "    setSelectedPeople(prev =&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 58,
                  "content": "      prev.includes(personId)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 59,
                  "content": "        ? prev.filter(id =&gt; id !== personId)"
                },
                {
                  "lineNumber": 60,
                  "content": "        : [...prev, personId]",
                  "isContextLine": true
                },
                {
                  "lineNumber": 61,
                  "content": "    );",
                  "isContextLine": true
                },
                {
                  "lineNumber": 62,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 63,
                  "isContextLine": true
                },
                {
                  "lineNumber": 64,
                  "content": "  const handleSelectAll = () =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 65,
                  "content": "    setSelectedPeople(peopleList.map(p =&gt; p.id));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 66,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 67,
                  "isContextLine": true
                },
                {
                  "lineNumber": 68,
                  "content": "  const handleSelectNone = () =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 69,
                  "content": "    setSelectedPeople([]);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 258,
                  "content": "const DUMMY_TAB: TabState = { id: 'dummy', folderId: '', viewingFileId: null, viewMode: 'browser' as const, layoutMode: 'grid', searchQuery: '', searchScope: 'all', activeTags: [], activePersonId: null, selectedFileIds: [], lastSelectedId: null, selectedTagIds: [], selectedPersonIds: [], dateFilter: { start: null, end: null, mode: 'created' }, history: { stack: [], currentIndex: -1 }, scrollTop: 0 };"
                },
                {
                  "lineNumber": 259,
                  "isContextLine": true
                },
                {
                  "lineNumber": 260,
                  "content": "const ExitConfirmModal = ({ remember, onConfirm, onCancel, onRememberChange, t }: any) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 261,
                  "content": "    return (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 262,
                  "content": "        &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl max-w-sm w-full animate-zoom-in\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 263,
                  "content": "            &lt;h3 className=\"font-bold text-lg mb-2 text-gray-900 dark:text-white\"&gt;{t('exitModal.title')}&lt;/h3&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 264,
                  "content": "            &lt;p className=\"text-gray-700 dark:text-gray-300 mb-6 text-sm\"&gt;{t('exitModal.message')}&lt;/p&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 265,
                  "isContextLine": true
                },
                {
                  "lineNumber": 266,
                  "content": "            &lt;div className=\"flex items-center mb-6\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 267,
                  "content": "                &lt;input",
                  "isContextLine": true
                },
                {
                  "lineNumber": 268,
                  "content": "                    type=\"checkbox\"",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1157,
                  "content": "        // Optimized active person filter - use direct lookup"
                },
                {
                  "lineNumber": 1158,
                  "content": "        const personId = activeTab.activePersonId;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1159,
                  "content": "        candidates = (Object.values(state.files) as FileNode[]).filter(f =&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1160,
                  "content": "            f.type === FileType.IMAGE &amp;&amp;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1161,
                  "content": "            f.aiData?.faces &amp;&amp;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1162,
                  "content": "            f.aiData.faces.some(face =&gt; face.personId === personId)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1163,
                  "content": "        );",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1164,
                  "content": "    }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1165,
                  "content": "    else if (activeTab.activeTags.length &gt; 0) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1166,
                  "content": "        // Optimized tag filter - use Set for faster lookups",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1167,
                  "content": "        const activeTagsSet = new Set(activeTab.activeTags);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2327,
                  "content": "          newSelectedPersonIds = activeTab.selectedPersonIds.filter(id =&gt; id !== personId);"
                },
                {
                  "lineNumber": 2328,
                  "content": "        } else {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2329,
                  "content": "          // Add to selection",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2330,
                  "content": "          newSelectedPersonIds = [...activeTab.selectedPersonIds, personId];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2331,
                  "content": "        }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2332,
                  "content": "      } else if (isShift &amp;&amp; activeTab.selectedPersonIds.length &gt; 0) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2333,
                  "content": "        // Shift+Click: Select range from last selected to current",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2334,
                  "content": "        const lastSelectedPersonId = activeTab.selectedPersonIds[activeTab.selectedPersonIds.length - 1];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2335,
                  "content": "        const lastIndex = allPersonIds.indexOf(lastSelectedPersonId);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2336,
                  "content": "        const currentIndex = allPersonIds.indexOf(personId);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2337,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2587,
                  "content": "                      updatedFaces = file.aiData.faces.filter(face =&gt; !personIdsToClear.includes(face.personId));"
                },
                {
                  "lineNumber": 2588,
                  "content": "                  } else {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2589,
                  "content": "                      // 清除所有人脸信息",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2590,
                  "content": "                      updatedFaces = [];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2591,
                  "content": "                  }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2592,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2593,
                  "content": "                  // 检查是否有变化",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2594,
                  "content": "                  if (updatedFaces.length !== file.aiData.faces.length) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2595,
                  "content": "                      // 保存要更新的人物ID",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2596,
                  "content": "                      file.aiData.faces.forEach(face =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2597,
                  "content": "                          personIdsToUpdate.add(face.personId);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2758,
                  "content": "  const pushHistory = (folderId: string, viewingId: string | null, viewMode: 'browser' | 'tags-overview' | 'people-overview' = 'browser', searchQuery: string = '', searchScope: SearchScope = 'all', activeTags: string[] = [], activePersonId: string | null = null, nextScrollTop: number = 0, aiFilter: AiSearchFilter | null | undefined = null) =&gt; {"
                },
                {
                  "lineNumber": 2759,
                  "content": "      const currentScrollTop = selectionRef.current?.scrollTop ?? activeTab.scrollTop;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2760,
                  "content": "      updateActiveTab(prevTab =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2761,
                  "content": "          const stackCopy = [...prevTab.history.stack];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2762,
                  "content": "          if (prevTab.history.currentIndex &gt;= 0 &amp;&amp; prevTab.history.currentIndex &lt; stackCopy.length) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2763,
                  "content": "              stackCopy[prevTab.history.currentIndex] = { ...stackCopy[prevTab.history.currentIndex], scrollTop: currentScrollTop };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2764,
                  "content": "          }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2765,
                  "content": "          const newStack = [...stackCopy.slice(0, prevTab.history.currentIndex + 1), { folderId, viewingId, viewMode, searchQuery, searchScope, activeTags, activePersonId, aiFilter, scrollTop: nextScrollTop }];"
                },
                {
                  "lineNumber": 2766,
                  "content": "          return { folderId, viewingFileId: viewingId, viewMode, searchQuery, searchScope, activeTags, activePersonId, aiFilter, scrollTop: nextScrollTop, selectedFileIds: viewingId ? [viewingId] : [], selectedPersonIds: [], selectedTagIds: [], history: { stack: newStack, currentIndex: newStack.length - 1 } };"
                },
                {
                  "lineNumber": 2767,
                  "content": "      });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2768,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2769,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2770,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2771,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2772,
                  "content": "  const handleRememberFolderSettings = () =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2773,
                  "content": "      if (activeTab.viewMode !== 'browser') return;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2774,
                  "content": "      const folderId = activeTab.folderId;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2775,
                  "content": "      const folder = state.files[folderId];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2776,
                  "content": "      if (!folder || folder.type !== FileType.FOLDER) return;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2875,
                  "content": "              return { folderId: step.folderId, viewingFileId: step.viewingId, viewMode: step.viewMode, searchQuery: step.searchQuery, searchScope: step.searchScope, activeTags: step.activeTags || [], activePersonId: step.activePersonId, aiFilter: step.aiFilter, scrollTop: step.scrollTop || 0, selectedFileIds: step.viewingId ? [step.viewingId] : [], selectedPersonIds: [], selectedTagIds: [], history: { ...prevTab.history, currentIndex: newIndex } };"
                },
                {
                  "lineNumber": 2876,
                  "content": "          }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2877,
                  "content": "          return {};",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2878,
                  "content": "      });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2879,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2880,
                  "content": "  const goForward = () =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2881,
                  "content": "      updateActiveTab(prevTab =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2882,
                  "content": "          if (prevTab.history.currentIndex &lt; prevTab.history.stack.length - 1) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2883,
                  "content": "              const newIndex = prevTab.history.currentIndex + 1;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2884,
                  "content": "              const step = prevTab.history.stack[newIndex];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2885,
                  "content": "              return { folderId: step.folderId, viewingFileId: step.viewingId, viewMode: step.viewMode, searchQuery: step.searchQuery, searchScope: step.searchScope, activeTags: step.activeTags || [], activePersonId: step.activePersonId, aiFilter: step.aiFilter, scrollTop: step.scrollTop || 0, selectedFileIds: step.viewingId ? [step.viewingId] : [], selectedPersonIds: [], selectedTagIds: [], history: { ...prevTab.history, currentIndex: newIndex } };"
                },
                {
                  "lineNumber": 2886,
                  "content": "          }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2887,
                  "content": "          return {};",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2888,
                  "content": "      });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2889,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2890,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2891,
                  "content": "  const closeViewer = () =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2892,
                  "content": "      if (activeTab.history.stack[activeTab.history.currentIndex].viewingId) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2893,
                  "content": "          pushHistory(activeTab.folderId, null, activeTab.viewMode, activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, activeTab.activePersonId, activeTab.scrollTop, activeTab.aiFilter);"
                },
                {
                  "lineNumber": 2894,
                  "content": "      } else {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2895,
                  "content": "          updateActiveTab({ viewingFileId: null });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2896,
                  "content": "      }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2897,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2898,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2899,
                  "content": "  const enterViewer = (fileId: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2900,
                  "content": "      const scrollTop = selectionRef.current?.scrollTop || 0;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2901,
                  "content": "      pushHistory(activeTab.folderId, fileId, 'browser', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, activeTab.activePersonId, scrollTop, activeTab.aiFilter);"
                },
                {
                  "lineNumber": 2902,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2903,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2904,
                  "content": "  const handleViewerNavigate = (direction: 'next' | 'prev' | 'random') =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2905,
                  "content": "      if (!activeTab.viewingFileId) return;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2906,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2907,
                  "content": "      // Filter to get only image file IDs",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2908,
                  "content": "      const imageFileIds = displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2909,
                  "content": "      if (imageFileIds.length === 0) return;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2910,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2911,
                  "content": "      const currentFile = state.files[activeTab.viewingFileId];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3069,
                  "content": "  const enterPeopleOverview = () =&gt; pushHistory(activeTab.folderId, null, 'people-overview', activeTab.searchQuery, activeTab.searchScope, activeTab.activeTags, null, 0);"
                },
                {
                  "lineNumber": 3070,
                  "content": "  const enterPersonView = (personId: string) =&gt; pushHistory(activeTab.folderId, null, 'browser', '', 'all', [], personId, 0);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3071,
                  "content": "  const handleClearTagFilter = (tagToRemove: string) =&gt; updateActiveTab(prev =&gt; ({ activeTags: prev.activeTags.filter(t =&gt; t !== tagToRemove) }));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3072,
                  "content": "  const handleClearAllTags = () =&gt; updateActiveTab({ activeTags: [] });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3073,
                  "content": "  const handleClearPersonFilter = () =&gt; updateActiveTab({ activePersonId: null });"
                },
                {
                  "lineNumber": 3074,
                  "isContextLine": true
                },
                {
                  "lineNumber": 3075,
                  "content": "  const handleRenameSubmit = async (value: string, id: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3076,
                  "content": "      value = value.trim();",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3077,
                  "content": "      const file = state.files[id];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3078,
                  "content": "      if (!value || value === file.name) { setState(s =&gt; ({ ...s, renamingId: null })); return; }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3079,
                  "content": "      if (file.path) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3080,
                  "content": "          try {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3081,
                  "content": "              const separator = file.path.includes('/') ? '/' : '\\\\';",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3082,
                  "content": "              const parentPath = file.path.substring(0, file.path.lastIndexOf(separator));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 3083,
                  "content": "              const newPath = &#96;${parentPath}${separator}${value}&#96;;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4558,
                  "content": "              {(activeTab.activeTags.length &gt; 0 || activeTab.dateFilter.start || activeTab.activePersonId || activeTab.aiFilter) &amp;&amp; ("
                },
                {
                  "lineNumber": 4559,
                  "content": "                  &lt;div className=\"flex items-center px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 space-x-2 overflow-x-auto shrink-0 z-20\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4560,
                  "content": "                      &lt;div className=\"flex items-center text-xs text-gray-500 dark:text-gray-400 mr-2 shrink-0\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4561,
                  "content": "                          &lt;Filter size={12} className=\"mr-1\"/&gt; {t('context.filters')}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4562,
                  "content": "                      &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4563,
                  "isContextLine": true
                },
                {
                  "lineNumber": 4564,
                  "content": "                      {activeTab.aiFilter &amp;&amp; (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4565,
                  "content": "                          &lt;div className=\"flex items-center bg-purple-100 dark:bg-purple-900/40 text-purple-800 dark:text-purple-200 px-2 py-0.5 rounded-full text-xs border border-purple-200 dark:border-purple-800 whitespace-nowrap\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4566,
                  "content": "                              &lt;Brain size={10} className=\"mr-1\"/&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4567,
                  "content": "                              &lt;span&gt;{t('settings.aiSmartSearch')}: \"{activeTab.aiFilter.originalQuery}\"&lt;/span&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4568,
                  "content": "                              &lt;button onClick={() =&gt; updateActiveTab({ aiFilter: null })} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4584,
                  "content": "                              &lt;button onClick={() =&gt; handleClearPersonFilter()} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;"
                },
                {
                  "lineNumber": 4585,
                  "content": "                          &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4586,
                  "content": "                      )}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4587,
                  "isContextLine": true
                },
                {
                  "lineNumber": 4588,
                  "content": "                      {activeTab.activeTags.map(tag =&gt; (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4589,
                  "content": "                          &lt;div key={tag} className=\"flex items-center bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded-full text-xs border border-blue-200 dark:border-blue-800 whitespace-nowrap\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4590,
                  "content": "                              &lt;span&gt;{tag}&lt;/span&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4591,
                  "content": "                              &lt;button onClick={() =&gt; handleClearTagFilter(tag)} className=\"ml-1.5 hover:text-red-500\"&gt;&lt;X size={12}/&gt;&lt;/button&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4592,
                  "content": "                          &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4593,
                  "content": "                      ))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4594,
                  "isContextLine": true
                },
                {
                  "lineNumber": 4595,
                  "content": "                      &lt;button onClick={() =&gt; { handleClearAllTags(); handleClearPersonFilter(); updateActiveTab({ dateFilter: { start: null, end: null, mode: 'created' as const }, aiFilter: null }); }} className=\"text-xs text-gray-500 hover:text-red-500 underline ml-2 whitespace-nowrap\"&gt;{t('context.clearAll')}&lt;/button&gt;"
                },
                {
                  "lineNumber": 4596,
                  "content": "                  &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4597,
                  "content": "              )}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4598,
                  "isContextLine": true
                },
                {
                  "lineNumber": 4599,
                  "content": "              &lt;div className=\"flex-1 flex flex-col relative bg-white dark:bg-gray-950 overflow-hidden\"",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4600,
                  "content": "                   onDragOver={handleDragOver}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4601,
                  "content": "                   onDragLeave={handleDragLeave}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4602,
                  "content": "                   onDragEnter={handleDragEnter}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4603,
                  "content": "                   onDrop={handleExternalFileDrop}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4604,
                  "content": "              &gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4605,
                  "content": "                {/* Drag and drop overlay */}",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 187,
          "totalMatchedLines": 20
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/App.tsx</summary>

</details>
</tool-use>

---



---


查看人物列表的过滤逻辑：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "displayFileIds|people.*filter|filteredPeople",
  "path": "src/App.tsx",
  "contextAfter": 5,
  "caseInsensitive": true
}
```
Result:

```json
{
  "success": {
    "pattern": "displayFileIds|people.*filter|filteredPeople",
    "path": "src/App.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/App.tsx",
              "matches": [
                {
                  "lineNumber": 41,
                  "content": "const AddToPersonModal = ({ people, files, onConfirm, onClose, t }: any) =&gt; { const [search, setSearch] = useState(''); const filteredPeople = Object.values(people as Record&lt;string, Person&gt;).filter((p: Person) =&gt; p.name.toLowerCase().includes(search.toLowerCase())); return ( &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-80 max-h-[500px] flex flex-col animate-zoom-in\"&gt;&lt;h3 className=\"font-bold text-lg mb-4 text-gray-900 dark:text-white\"&gt;{t('context.selectPerson')}&lt;/h3&gt;&lt;div className=\"relative mb-3\"&gt;&lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;&lt;input id=\"add-to-person-search\" name=\"add-to-person-search\" className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\" placeholder={t('search.placeholder')} value={search} onChange={e =&gt; setSearch(e.target.value)} autoFocus /&gt;&lt;/div&gt;&lt;div className=\"flex-1 overflow-y-auto min-h-[200px] space-y-"
                },
                {
                  "lineNumber": 42,
                  "isContextLine": true
                },
                {
                  "lineNumber": 43,
                  "content": "const ClearPersonModal = ({ files, fileIds, people, onConfirm, onClose, t }: any) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 44,
                  "content": "  // Get all unique people from selected files",
                  "isContextLine": true
                },
                {
                  "lineNumber": 45,
                  "content": "  const allPeople = new Set&lt;string&gt;();",
                  "isContextLine": true
                },
                {
                  "lineNumber": 46,
                  "content": "  fileIds.forEach((fileId: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 53,
                  "content": "  const peopleList = Array.from(allPeople).map(personId =&gt; people[personId]).filter(Boolean);"
                },
                {
                  "lineNumber": 54,
                  "content": "  const [selectedPeople, setSelectedPeople] = useState&lt;string[]&gt;(peopleList.map(p =&gt; p.id));",
                  "isContextLine": true
                },
                {
                  "lineNumber": 55,
                  "isContextLine": true
                },
                {
                  "lineNumber": 56,
                  "content": "  const handleTogglePerson = (personId: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 57,
                  "content": "    setSelectedPeople(prev =&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 58,
                  "content": "      prev.includes(personId)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1081,
                  "content": "  // ... (keep navigation/file handling functions: updateActiveTab, sortFiles, getFilteredChildren, displayFileIds)"
                },
                {
                  "lineNumber": 1082,
                  "content": "  const updateActiveTab = (updates: Partial&lt;TabState&gt; | ((prev: TabState) =&gt; Partial&lt;TabState&gt;)) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1083,
                  "content": "     setState(prev =&gt; { const current = prev.tabs.find(t =&gt; t.id === prev.activeTabId); if (!current) return prev; const newValues = typeof updates === 'function' ? updates(current) : updates; const newTab = { ...current, ...newValues }; return { ...prev, tabs: prev.tabs.map(t =&gt; t.id === prev.activeTabId ? newTab : t) }; });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1084,
                  "content": "  };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1085,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1086,
                  "content": "  const sortFiles = (files: FileNode[]) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1098,
                  "content": "  const displayFileIds = useMemo(() =&gt; {"
                },
                {
                  "lineNumber": 1099,
                  "content": "    let candidates: FileNode[] = [];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1100,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1101,
                  "content": "    // AI Search Filter Logic - Optimized with early exits",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1102,
                  "content": "    if (activeTab.aiFilter &amp;&amp; state.settings.search.isAISearchEnabled) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1103,
                  "content": "        const { keywords, colors, people, description } = activeTab.aiFilter;"
                },
                {
                  "lineNumber": 1104,
                  "content": "        const allFiles = Object.values(state.files) as FileNode[];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1105,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1106,
                  "content": "        candidates = allFiles.filter(f =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1107,
                  "content": "            if (f.type !== FileType.IMAGE) return false;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1108,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1286,
                  "content": "    displayFileIds.forEach(id =&gt; {"
                },
                {
                  "lineNumber": 1287,
                  "content": "      const file = state.files[id]; if (!file) return; let key = 'Other';",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1288,
                  "content": "      if (groupBy === 'type') {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1289,
                  "content": "        key = file.type === FileType.FOLDER ? t('groupBy.folder') : (file.meta?.format?.toUpperCase() || 'Unknown');",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1290,
                  "content": "      }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1291,
                  "content": "      else if (groupBy === 'date') {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1308,
                  "content": "  }, [displayFileIds, groupBy, state.files, t]);"
                },
                {
                  "lineNumber": 1309,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1310,
                  "content": "  // ... (keep handleOpenFolder and handleRefresh)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1311,
                  "content": "  const handleOpenFolder = async () =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1312,
                  "content": "      try {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1313,
                  "content": "          const path = await openDirectory();",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1577,
                  "content": "        allFiles = displayFileIds;"
                },
                {
                  "lineNumber": 1578,
                  "content": "      } else {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1579,
                  "content": "        // Folder view - use displayFileIds which already contains the sorted and filtered list of files to display"
                },
                {
                  "lineNumber": 1580,
                  "content": "        allFiles = displayFileIds;"
                },
                {
                  "lineNumber": 1581,
                  "content": "      }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1582,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1583,
                  "content": "      const lastIndex = allFiles.indexOf(activeTab.lastSelectedId);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1584,
                  "content": "      const currentIndex = allFiles.indexOf(id);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1585,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2758,
                  "content": "  const pushHistory = (folderId: string, viewingId: string | null, viewMode: 'browser' | 'tags-overview' | 'people-overview' = 'browser', searchQuery: string = '', searchScope: SearchScope = 'all', activeTags: string[] = [], activePersonId: string | null = null, nextScrollTop: number = 0, aiFilter: AiSearchFilter | null | undefined = null) =&gt; {"
                },
                {
                  "lineNumber": 2759,
                  "content": "      const currentScrollTop = selectionRef.current?.scrollTop ?? activeTab.scrollTop;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2760,
                  "content": "      updateActiveTab(prevTab =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2761,
                  "content": "          const stackCopy = [...prevTab.history.stack];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2762,
                  "content": "          if (prevTab.history.currentIndex &gt;= 0 &amp;&amp; prevTab.history.currentIndex &lt; stackCopy.length) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2763,
                  "content": "              stackCopy[prevTab.history.currentIndex] = { ...stackCopy[prevTab.history.currentIndex], scrollTop: currentScrollTop };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2908,
                  "content": "      const imageFileIds = displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE);"
                },
                {
                  "lineNumber": 2909,
                  "content": "      if (imageFileIds.length === 0) return;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2910,
                  "isContextLine": true
                },
                {
                  "lineNumber": 2911,
                  "content": "      const currentFile = state.files[activeTab.viewingFileId];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2912,
                  "content": "      let currentIndex = imageFileIds.indexOf(activeTab.viewingFileId);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 2913,
                  "isContextLine": true
                },
                {
                  "lineNumber": 4476,
                  "content": "                              sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)}"
                },
                {
                  "lineNumber": 4477,
                  "content": "                              onClose={closeViewer}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4478,
                  "content": "                              onNavigate={handleViewerJump}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4479,
                  "content": "                              isSidebarOpen={state.layout.isSidebarVisible}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4480,
                  "content": "                              onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4481,
                  "content": "                              onDelete={(id) =&gt; requestDelete([id])}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4490,
                  "content": "                          sortedFileIds={displayFileIds.filter(id =&gt; state.files[id].type === FileType.IMAGE)}"
                },
                {
                  "lineNumber": 4491,
                  "content": "                          files={state.files}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4492,
                  "content": "                          layout={state.layout}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4493,
                  "content": "                          slideshowConfig={state.slideshowConfig}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4494,
                  "content": "                          onLayoutToggle={(part) =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, [part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible']: !s.layout[part === 'sidebar' ? 'isSidebarVisible' : 'isMetadataVisible'] } }))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4495,
                  "content": "                          onClose={closeViewer}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4717,
                  "content": "                        {displayFileIds.length} {t('context.items')}"
                },
                {
                  "lineNumber": 4718,
                  "content": "                      &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4719,
                  "content": "                    &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4720,
                  "content": "                  )}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4721,
                  "content": "                &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4722,
                  "content": "                &lt;div className=\"flex-1 overflow-hidden relative\" id=\"file-grid-container\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4723,
                  "content": "                  {displayFileIds.length === 0 &amp;&amp; activeTab.viewMode === 'browser' ? ("
                },
                {
                  "lineNumber": 4724,
                  "content": "                     &lt;div className=\"w-full h-full flex flex-col items-center justify-center text-gray-400\" onMouseDown={handleMouseDown} onContextMenu={(e) =&gt; handleContextMenu(e, 'background', '')}&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4725,
                  "content": "                        &lt;div className=\"text-6xl mb-4 opacity-20\"&gt;&lt;FolderOpen/&gt;&lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4726,
                  "content": "                        &lt;p&gt;{t('context.noFiles')}&lt;/p&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4727,
                  "content": "                     &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4728,
                  "content": "                  ) :  (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4730,
                  "content": "                        displayFileIds={displayFileIds}"
                },
                {
                  "lineNumber": 4731,
                  "content": "                        files={state.files}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4732,
                  "content": "                        activeTab={activeTab}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4733,
                  "content": "                        renamingId={state.renamingId}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4734,
                  "content": "                        thumbnailSize={state.thumbnailSize}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4735,
                  "content": "                        resourceRoot={state.settings.paths.resourceRoot}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5033,
                  "content": "                  updateActiveTab({ selectedFileIds: displayFileIds });"
                },
                {
                  "lineNumber": 5034,
                  "content": "                  closeContextMenu();",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5035,
                  "content": "                }}&gt;{t('context.selectAll')}&lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5036,
                  "content": "                &lt;div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"&gt;&lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5037,
                  "content": "                &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer\" onClick={() =&gt; { handleCreateFolder(); closeContextMenu(); }}&gt;{t('context.newFolder')}&lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 5038,
                  "content": "                &lt;div className=\"px-4 py-2 hover:bg-blue-600 hover:text-white cursor-pointer\" onClick={() =&gt; { handleCreateNewTag(); closeContextMenu(); }}&gt;{t('context.newTag')}&lt;/div&gt;",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 98,
          "totalMatchedLines": 18
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


实现：在人物面板时，搜索框仅搜索人物名称。开始修改：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---



---


实现：在人物面板时，搜索框仅搜索人物名称。


---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] 修改 FileGrid 的 useLayout 函数，在 people-overview 模式下根据 searchQuery 过滤人物
- [ ] 修改 TopBar 组件，在人物面板时禁用搜索范围选择器并更新占位符
- [ ] 修改 onPerformSearch 函数，确保在人物面板时搜索只应用于人物

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---



---


修改 `FileGrid` 组件，在人物面板时根据搜索查询过滤人物：


---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "a226d7aa-a8d1-4ccd-89f9-53f6d5d6758a"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "f68e0dad-0c77-4414-ae4b-e54878bfba74"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "74491f53-7716-4ef7-b101-f2b3ce693bde"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "useLayout\\(",
  "path": "src/components/FileGrid.tsx",
  "contextAfter": 10,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "useLayout\\(",
    "path": "src/components/FileGrid.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/components/FileGrid.tsx",
              "matches": [
                {
                  "lineNumber": 1212,
                  "content": "  const { layout, totalHeight } = useLayout("
                },
                {
                  "lineNumber": 1213,
                  "content": "    group.fileIds,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1214,
                  "content": "    files,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1215,
                  "content": "    activeTab.layoutMode,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1216,
                  "content": "    containerRect.width,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1217,
                  "content": "    thumbnailSize,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1218,
                  "content": "    'browser'",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1219,
                  "content": "  );",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1220,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1221,
                  "content": "  // 移除虚拟滚动逻辑，直接使用所有项目",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1222,
                  "content": "  const visibleItems = layout;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1786,
                  "content": "  const { layout, totalHeight } = useLayout("
                },
                {
                  "lineNumber": 1787,
                  "content": "      displayFileIds,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1788,
                  "content": "      files,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1789,
                  "content": "      activeTab.layoutMode,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1790,
                  "content": "      containerRect.width,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1791,
                  "content": "      thumbnailSize,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1792,
                  "content": "      activeTab.viewMode,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1793,
                  "content": "      groupedTags,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1794,
                  "content": "      people",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1795,
                  "content": "  );",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1796,
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 22,
          "totalMatchedLines": 2
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


更新 `useLayout` 的调用，传递 `searchQuery`：


---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "1eae80d7-7034-4ab0-a523-c25c0eb71226"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] 修改 FileGrid 的 useLayout 函数，在 people-overview 模式下根据 searchQuery 过滤人物
- [-] 修改 TopBar 组件，在人物面板时禁用搜索范围选择器并更新占位符
- [ ] 修改 onPerformSearch 函数，确保在人物面板时搜索只应用于人物

</details>
</tool-use>

---



---


修改 `TopBar` 组件，在人物面板时禁用搜索范围选择器并更新占位符：


---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "8d057575-0ada-4c0f-ae54-166961e35178"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "ece266bb-5e0d-4e8f-a4d4-56844db12d2f"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] 修改 FileGrid 的 useLayout 函数，在 people-overview 模式下根据 searchQuery 过滤人物
- [x] 修改 TopBar 组件，在人物面板时禁用搜索范围选择器并更新占位符
- [-] 修改 onPerformSearch 函数，确保在人物面板时搜索只应用于人物

</details>
</tool-use>

---



---


修改 `onPerformSearch`，确保在人物面板时搜索只应用于人物：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/App.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "5e77c9b8-6b7a-401f-aa7a-cf0e4b1c4d14"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] 修改 FileGrid 的 useLayout 函数，在 people-overview 模式下根据 searchQuery 过滤人物
- [x] 修改 TopBar 组件，在人物面板时禁用搜索范围选择器并更新占位符
- [x] 修改 onPerformSearch 函数，确保在人物面板时搜索只应用于人物

</details>
</tool-use>

---



---


检查搜索框输入时是否正确更新搜索查询。查看 `toolbarQuery` 和 `activeTab.searchQuery` 的关系：


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "toolbarQuery|setToolbarQuery",
  "path": "src/App.tsx",
  "contextAfter": 3,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "toolbarQuery|setToolbarQuery",
    "path": "src/App.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/App.tsx",
              "matches": [
                {
                  "lineNumber": 564,
                  "content": "  const [toolbarQuery, setToolbarQuery] = useState('');"
                },
                {
                  "lineNumber": 565,
                  "content": "  const [groupBy, setGroupBy] = useState&lt;GroupByOption&gt;('none');",
                  "isContextLine": true
                },
                {
                  "lineNumber": 566,
                  "content": "  const [collapsedGroups, setCollapsedGroups] = useState&lt;Record&lt;string, boolean&gt;&gt;({});",
                  "isContextLine": true
                },
                {
                  "lineNumber": 567,
                  "content": "  const [rememberExitChoice, setRememberExitChoice] = useState(false);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1055,
                  "content": "  useEffect(() =&gt; { setToolbarQuery(activeTab.searchQuery); }, [activeTab.id, activeTab.searchQuery]);"
                },
                {
                  "lineNumber": 1056,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1057,
                  "content": "  const t = (key: string): string =&gt; { const keys = key.split('.'); let val: any = translations[state.settings.language]; for (const k of keys) { val = val?.[k]; } return typeof val === 'string' ? val : key; };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1058,
                  "content": "  const showToast = (msg: string) =&gt; { setToast({ msg, visible: true }); setTimeout(() =&gt; setToast({ msg: '', visible: false }), 2500); };",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4535,
                  "content": "                toolbarQuery={toolbarQuery}"
                },
                {
                  "lineNumber": 4536,
                  "content": "                groupedTags={groupedTags}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4537,
                  "content": "                tagSearchQuery={tagSearchQuery}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4538,
                  "content": "                onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4547,
                  "content": "                onSetToolbarQuery={setToolbarQuery}"
                },
                {
                  "lineNumber": 4548,
                  "content": "                onLayoutModeChange={(mode) =&gt; updateActiveTab({ layoutMode: mode })}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4549,
                  "content": "                onSortOptionChange={(opt) =&gt; setState(s =&gt; ({ ...s, sortBy: opt }))}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 4550,
                  "content": "                onSortDirectionChange={() =&gt; setState(s =&gt; ({ ...s, sortDirection: s.sortDirection === 'asc' ? 'desc' : 'asc' }))}",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 16,
          "totalMatchedLines": 4
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "searchQuery.*toolbarQuery|toolbarQuery.*searchQuery",
  "path": "src/App.tsx",
  "contextAfter": 3,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "searchQuery.*toolbarQuery|toolbarQuery.*searchQuery",
    "path": "src/App.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {}
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


修改搜索逻辑，使在人物面板时输入即实时更新搜索查询：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/App.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "53b0fe24-e6d6-4411-b9e8-63923af2d5e1"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "src/components/TopBar.tsx",
    "src/components/FileGrid.tsx",
    "src/App.tsx"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "src/components/TopBar.tsx"
    },
    {
      "relativeWorkspacePath": "src/components/FileGrid.tsx"
    },
    {
      "relativeWorkspacePath": "src/App.tsx"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


验证所有更改是否正确。检查是否有遗漏：


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "people-overview",
  "path": "src/components/TopBar.tsx",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "people-overview",
    "path": "src/components/TopBar.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/components/TopBar.tsx",
              "matches": [
                {
                  "lineNumber": 531,
                  "content": "          {activeTab.viewMode !== 'people-overview' &amp;&amp; ("
                },
                {
                  "lineNumber": 573,
                  "content": "              activeTab.viewMode === 'people-overview'"
                },
                {
                  "lineNumber": 722,
                  "content": "                       min={activeTab.viewMode === 'people-overview' ? 140 : 100}"
                },
                {
                  "lineNumber": 723,
                  "content": "                       max={activeTab.viewMode === 'people-overview' ? 450 : 480}"
                }
              ]
            }
          ],
          "totalLines": 4,
          "totalMatchedLines": 4
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "searchQuery",
  "path": "src/components/FileGrid.tsx",
  "contextAfter": 2,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "searchQuery",
    "path": "src/components/FileGrid.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/components/FileGrid.tsx",
              "matches": [
                {
                  "lineNumber": 1339,
                  "content": "  searchQuery?: string"
                },
                {
                  "lineNumber": 1340,
                  "content": ") =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1341,
                  "content": "  const aspectRatios = useMemo(() =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1469,
                  "content": "        if (searchQuery &amp;&amp; searchQuery.trim()) {"
                },
                {
                  "lineNumber": 1470,
                  "content": "            const query = searchQuery.toLowerCase().trim();"
                },
                {
                  "lineNumber": 1471,
                  "content": "            itemsList = itemsList.filter(person =&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1472,
                  "content": "                person.name.toLowerCase().includes(query)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1496,
                  "content": "  }, [items, files, layoutMode, containerWidth, thumbnailSize, viewMode, aspectRatios, people, searchQuery]);"
                },
                {
                  "lineNumber": 1497,
                  "content": "};",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1498,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1795,
                  "content": "      activeTab.searchQuery"
                },
                {
                  "lineNumber": 1796,
                  "content": "  );",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1797,
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 13,
          "totalMatchedLines": 5
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


## 修改总结

1. **修改 `FileGrid` 组件** (`src/components/FileGrid.tsx`)：
   - 在 `useLayout` 函数中添加 `searchQuery` 参数
   - 在 `people-overview` 模式下，根据 `searchQuery` 过滤人物名称

2. **修改 `TopBar` 组件** (`src/components/TopBar.tsx`)：
   - 在人物面板时隐藏搜索范围选择器（仅在 `viewMode !== 'people-overview'` 时显示）
   - 更新搜索框占位符：人物面板显示“搜索人物...”，其他模式显示原有占位符

3. **修改 `App` 组件** (`src/App.tsx`)：
   - 修改 `onPerformSearch`：在人物面板时只更新搜索查询，不切换视图模式
   - 修改 `onSetToolbarQuery`：在人物面板时实时更新 `activeTab.searchQuery`，实现实时过滤

## 功能说明

- 在人物主面板时：搜索框仅搜索人物名称，搜索范围选择器隐藏，占位符显示“搜索人物...”
- 离开人物主面板时：搜索功能恢复，搜索范围选择器显示，占位符恢复原样

所有更改已完成，代码已通过 linter 检查。

---

_**User**_

目前在人物界面时的搜索框里显示的信息是： DOM Path: div#root > div.w-full h-full flex flex-col bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 overflow-hidden font-.an. tran.ition-color. duration-300 > div.flex-1 flex overflow-hidden relative tran.ition-all duration-300 ea.e-[cubic-bezier(0.25,0.1,0.25,1)] > div.flex-1 flex flex-col min-w-0 relative bg-white dark:bg-gray-950 > div.h-14 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 flex item.-center px-4 ju.tify-between .hrink-0 z-30 .pace-x-4 > div.flex-1 max-w-2xl relative > div.flex item.-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 tran.ition-all border overflow-hidden border-tran.parent > input#toolbar-search-input
Position: top=59px, left=517px, width=255px, height=20px
React Component: TopBar
HTML Element: <input type="text" id="toolbar-search-input" name="toolbar-search-input" class="bg-transparent border-none focus:outline-none text-sm w-full text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 min-w-0" placeholder="search.placeholderPerson" value=""></input> search.placeholderPerson，把它更改为：搜索人物。

---

_**Agent (model default, mode Agent)**_



---


占位符显示为翻译键 `search.placeholderPerson`，但缺少对应翻译。将其改为直接显示“搜索人物”。检查翻译相关代码：


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "search\\.placeholder|placeholderPerson",
  "path": "src",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "search\\.placeholder|placeholderPerson",
    "path": "src",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/App.tsx",
              "matches": [
                {
                  "lineNumber": 41,
                  "content": "const AddToPersonModal = ({ people, files, onConfirm, onClose, t }: any) =&gt; { const [search, setSearch] = useState(''); const filteredPeople = Object.values(people as Record&lt;string, Person&gt;).filter((p: Person) =&gt; p.name.toLowerCase().includes(search.toLowerCase())); return ( &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-80 max-h-[500px] flex flex-col animate-zoom-in\"&gt;&lt;h3 className=\"font-bold text-lg mb-4 text-gray-900 dark:text-white\"&gt;{t('context.selectPerson')}&lt;/h3&gt;&lt;div className=\"relative mb-3\"&gt;&lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;&lt;input id=\"add-to-person-search\" name=\"add-to-person-search\" className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\" placeholder={t('search.placeholder')} value={search} onChange={e =&gt; setSearch(e.target.value)} autoFocus /&gt;&lt;/div&gt;&lt;div className=\"flex-1 overflow-y-auto min-h-[200px] space-y-"
                },
                {
                  "lineNumber": 224,
                  "content": "          placeholder={t('search.placeholder')}"
                },
                {
                  "lineNumber": 4657,
                  "content": "                              placeholder={t('search.placeholder')}"
                }
              ]
            },
            {
              "file": "src/components/TopBar.tsx",
              "matches": [
                {
                  "lineNumber": 105,
                  "content": "            placeholder={t('search.placeholder')}"
                },
                {
                  "lineNumber": 574,
                  "content": "                ? t('search.placeholderPerson') || '搜索人物...'"
                },
                {
                  "lineNumber": 577,
                  "content": "                  : t('search.placeholder')"
                }
              ]
            },
            {
              "file": "src/components/ImageViewer.tsx",
              "matches": [
                {
                  "lineNumber": 506,
                  "content": "                  placeholder={isAISearchEnabled ? t('settings.aiSmartSearch') : t('search.placeholder')}"
                }
              ]
            },
            {
              "file": "src\\App.tsx",
              "matches": [
                {
                  "lineNumber": 41,
                  "content": "const AddToPersonModal = ({ people, files, onConfirm, onClose, t }: any) =&gt; { const [search, setSearch] = useState(''); const filteredPeople = Object.values(people as Record&lt;string, Person&gt;).filter((p: Person) =&gt; p.name.toLowerCase().includes(search.toLowerCase())); return ( &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-80 max-h-[500px] flex flex-col animate-zoom-in\"&gt;&lt;h3 className=\"font-bold text-lg mb-4 text-gray-900 dark:text-white\"&gt;{t('context.selectPerson')}&lt;/h3&gt;&lt;div className=\"relative mb-3\"&gt;&lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;&lt;input id=\"add-to-person-search\" name=\"add-to-person-search\" className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\" placeholder={t('search.placeholder')} value={search} onChange={e =&gt; setSearch(e.target.value)} autoFocus /&gt;&lt;/div&gt;&lt;div className=\"flex-1 overflow-y-auto min-h-[200px] space-y-"
                },
                {
                  "lineNumber": 224,
                  "content": "          placeholder={t('search.placeholder')}"
                },
                {
                  "lineNumber": 4657,
                  "content": "                              placeholder={t('search.placeholder')}"
                }
              ]
            },
            {
              "file": "src\\components\\TopBar.tsx",
              "matches": [
                {
                  "lineNumber": 105,
                  "content": "            placeholder={t('search.placeholder')}"
                },
                {
                  "lineNumber": 574,
                  "content": "                ? t('search.placeholderPerson') || '搜索人物...'"
                },
                {
                  "lineNumber": 577,
                  "content": "                  : t('search.placeholder')"
                }
              ]
            }
          ],
          "totalLines": 13,
          "totalMatchedLines": 13
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "翻译文件 translations search placeholder",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n      \n      aiEnableOCR: 'Enable Text Recognition (OCR)',\n      aiEnableTranslation: 'Enable Translation',\n      aiConfidence: 'Confidence Threshold',\n      aiAnalyzing: 'Analyzing image...',\n      aiAnalyzeSuccess: 'Analysis Complete',\n      testConnection: 'Test Connection',\n      testing: 'Connecting...',\n      connectionSuccess: 'Connected',\n      connectionFailed: 'Connection Failed',\n      connectionStatus: 'Connection Status',\n      connectionSteps: 'Connection Steps',\n      openaiStep1: 'Get API Key from OpenAI or compatible provider.',\n      openaiStep2: 'Enter API Endpoint (e.g. https://api.openai.com/v1).',\n      openaiStep3: 'Paste API Key in input box above.',\n      openaiStep4: 'Enter suitable model name (e.g., gpt-4o).',\n      openaiStep5: 'Click test connection button to verify configuration.',\n      ollamaStep4: 'Verify endpoint is http://localhost:11434 in input box above.',\n      ollamaStep5: 'Enter appropriate model name in model input box.',\n      lmStudioStep5: 'Copy API address and paste into input box above.',\n      statusConnected: 'Connected',\n      statusDisconnected: 'Disconnected',\n      statusChecking: 'Checking...',\n      endpoint: 'Endpoint',\n      apiKey: 'API Key',\n      batchRenameTitle: 'Batch Rename',\n      namePattern: 'Naming Pattern',\n      namePatternHint: 'Example: Image_### or Trip_{date}',\n      startNumber: 'Start Number',\n      preview: 'Preview',\n      patternHelp: 'Use # for numbers (e.g. ### for 001), {date} for current date.',\n      aiSmartSearch: 'AI Smart Search',\n      aiSmartSearchThinking: 'AI Thinking...',\n      aiTargetLang: 'Translation Target Language',\n      dataBackup: 'Data Backup',\n      exportTags: 'Export Tags &amp; People',\n      importTags: 'Import Tags &amp; People',\n      importSuccess: 'Import successful',\n      importError: 'Import failed: Invalid file format',\n    },\n    exitModal: {\n      title: 'Exit Confirmation',\n      message: 'How would you like to close the application?',\n      minimize: 'Minimize to Tray',\n      exit: 'Exit Application',\n      remember: 'Remember my choice',\n      trayOpen: 'Open',\n      trayExit: 'Exit',\n    },\n    window: {\n      minimize: 'Minimize',\n      maximize: 'Maximize',\n      restore: 'Restore',\n      close: 'Close',\n      closeConfirmation: {\n        title: 'Close Confirmation',\n        message: 'Are you sure you want to close Aurora Gallery?',\n        minimizeToTray: 'Minimize to Tray',\n        exit: 'Exit Application',\n        alwaysAsk: 'Ask Every Time'\n      }\n    },\n    search: {\n      scopeAll: 'All',\n      scopeFile: 'Filename',\n      scopeTag: 'Tags',\n      scopeFolder: 'Folders',\n      placeholder: 'Search...',\n      tagSearchPlaceholder: 'Search tags...'\n    },\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "text": "      ",
            "lineNumber": 834
          },
          {
            "text": "      aiEnableOCR: 'Enable Text Recognition (OCR)',",
            "lineNumber": 835
          },
          {
            "text": "      aiEnableTranslation: 'Enable Translation',",
            "lineNumber": 836
          },
          {
            "text": "      aiConfidence: 'Confidence Threshold',",
            "lineNumber": 837
          },
          {
            "text": "      aiAnalyzing: 'Analyzing image...',",
            "lineNumber": 838
          },
          {
            "text": "      aiAnalyzeSuccess: 'Analysis Complete',",
            "lineNumber": 839
          },
          {
            "text": "      testConnection: 'Test Connection',",
            "lineNumber": 840
          },
          {
            "text": "      testing: 'Connecting...',",
            "lineNumber": 841
          },
          {
            "text": "      connectionSuccess: 'Connected',",
            "lineNumber": 842
          },
          {
            "text": "      connectionFailed: 'Connection Failed',",
            "lineNumber": 843
          },
          {
            "text": "      connectionStatus: 'Connection Status',",
            "lineNumber": 844
          },
          {
            "text": "      connectionSteps: 'Connection Steps',",
            "lineNumber": 845
          },
          {
            "text": "      openaiStep1: 'Get API Key from OpenAI or compatible provider.',",
            "lineNumber": 846
          },
          {
            "text": "      openaiStep2: 'Enter API Endpoint (e.g. https://api.openai.com/v1).',",
            "lineNumber": 847
          },
          {
            "text": "      openaiStep3: 'Paste API Key in input box above.',",
            "lineNumber": 848
          },
          {
            "text": "      openaiStep4: 'Enter suitable model name (e.g., gpt-4o).',",
            "lineNumber": 849
          },
          {
            "text": "      openaiStep5: 'Click test connection button to verify configuration.',",
            "lineNumber": 850
          },
          {
            "text": "      ollamaStep4: 'Verify endpoint is http://localhost:11434 in input box above.',",
            "lineNumber": 851
          },
          {
            "text": "      ollamaStep5: 'Enter appropriate model name in model input box.',",
            "lineNumber": 852
          },
          {
            "text": "      lmStudioStep5: 'Copy API address and paste into input box above.',",
            "lineNumber": 853
          },
          {
            "text": "      statusConnected: 'Connected',",
            "lineNumber": 854
          },
          {
            "text": "      statusDisconnected: 'Disconnected',",
            "lineNumber": 855
          },
          {
            "text": "      statusChecking: 'Checking...',",
            "lineNumber": 856
          },
          {
            "text": "      endpoint: 'Endpoint',",
            "lineNumber": 857
          },
          {
            "text": "      apiKey: 'API Key',",
            "lineNumber": 858
          },
          {
            "text": "      batchRenameTitle: 'Batch Rename',",
            "lineNumber": 859
          },
          {
            "text": "      namePattern: 'Naming Pattern',",
            "lineNumber": 860
          },
          {
            "text": "      namePatternHint: 'Example: Image_### or Trip_{date}',",
            "lineNumber": 861
          },
          {
            "text": "      startNumber: 'Start Number',",
            "lineNumber": 862
          },
          {
            "text": "      preview: 'Preview',",
            "lineNumber": 863
          },
          {
            "text": "      patternHelp: 'Use # for numbers (e.g. ### for 001), {date} for current date.',",
            "lineNumber": 864
          },
          {
            "text": "      aiSmartSearch: 'AI Smart Search',",
            "lineNumber": 865
          },
          {
            "text": "      aiSmartSearchThinking: 'AI Thinking...',",
            "lineNumber": 866
          },
          {
            "text": "      aiTargetLang: 'Translation Target Language',",
            "lineNumber": 867
          },
          {
            "text": "      dataBackup: 'Data Backup',",
            "lineNumber": 868
          },
          {
            "text": "      exportTags: 'Export Tags &amp; People',",
            "lineNumber": 869
          },
          {
            "text": "      importTags: 'Import Tags &amp; People',",
            "lineNumber": 870
          },
          {
            "text": "      importSuccess: 'Import successful',",
            "lineNumber": 871
          },
          {
            "text": "      importError: 'Import failed: Invalid file format',",
            "lineNumber": 872
          },
          {
            "text": "    },",
            "lineNumber": 873
          },
          {
            "text": "    exitModal: {",
            "lineNumber": 874
          },
          {
            "text": "      title: 'Exit Confirmation',",
            "lineNumber": 875
          },
          {
            "text": "      message: 'How would you like to close the application?',",
            "lineNumber": 876
          },
          {
            "text": "      minimize: 'Minimize to Tray',",
            "lineNumber": 877
          },
          {
            "text": "      exit: 'Exit Application',",
            "lineNumber": 878
          },
          {
            "text": "      remember: 'Remember my choice',",
            "lineNumber": 879
          },
          {
            "text": "      trayOpen: 'Open',",
            "lineNumber": 880
          },
          {
            "text": "      trayExit: 'Exit',",
            "lineNumber": 881
          },
          {
            "text": "    },",
            "lineNumber": 882
          },
          {
            "text": "    window: {",
            "lineNumber": 883
          },
          {
            "text": "      minimize: 'Minimize',",
            "lineNumber": 884
          },
          {
            "text": "      maximize: 'Maximize',",
            "lineNumber": 885
          },
          {
            "text": "      restore: 'Restore',",
            "lineNumber": 886
          },
          {
            "text": "      close: 'Close',",
            "lineNumber": 887
          },
          {
            "text": "      closeConfirmation: {",
            "lineNumber": 888
          },
          {
            "text": "        title: 'Close Confirmation',",
            "lineNumber": 889
          },
          {
            "text": "        message: 'Are you sure you want to close Aurora Gallery?',",
            "lineNumber": 890
          },
          {
            "text": "        minimizeToTray: 'Minimize to Tray',",
            "lineNumber": 891
          },
          {
            "text": "        exit: 'Exit Application',",
            "lineNumber": 892
          },
          {
            "text": "        alwaysAsk: 'Ask Every Time'",
            "lineNumber": 893
          },
          {
            "text": "      }",
            "lineNumber": 894
          },
          {
            "text": "    },",
            "lineNumber": 895
          },
          {
            "text": "    search: {",
            "lineNumber": 896
          },
          {
            "text": "      scopeAll: 'All',",
            "lineNumber": 897
          },
          {
            "text": "      scopeFile: 'Filename',",
            "lineNumber": 898
          },
          {
            "text": "      scopeTag: 'Tags',",
            "lineNumber": 899
          },
          {
            "text": "      scopeFolder: 'Folders',",
            "lineNumber": 900
          },
          {
            "text": "      placeholder: 'Search...',",
            "lineNumber": 901
          },
          {
            "text": "      tagSearchPlaceholder: 'Search tags...'",
            "lineNumber": 902
          },
          {
            "text": "    },",
            "lineNumber": 903
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.4250907003879547
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n\n      connectionFailed: '连接失败',\n      connectionStatus: '连接状态',\n      statusConnected: '已连接',\n      statusDisconnected: '未连接',\n      statusChecking: '检查中...',\n      endpoint: '服务地址',\n      apiKey: 'API 密钥',\n      batchRenameTitle: '批量重命名',\n      namePattern: '命名规则',\n      namePatternHint: '示例：Image_### 或 Trip_{date}',\n      startNumber: '起始序号',\n      preview: '预览',\n      patternHelp: '使用 # 代表数字序号 (如 ### 代表 001)，使用 {date} 代表当前日期。',\n      aiSmartSearch: 'AI 智能搜索',\n      aiSmartSearchThinking: 'AI 正在思考...',\n      aiTargetLang: '翻译目标语言',\n      dataBackup: '数据备份',\n      exportTags: '导出标签与人物',\n      importTags: '导入标签与人物',\n      importSuccess: '导入成功',\n      importError: '导入失败：文件格式无效',\n    },\n    exitModal: {\n      title: '关闭确认',\n      message: '您希望如何关闭应用程序？',\n      minimize: '最小化到托盘',\n      exit: '直接退出',\n      remember: '记住我的选择',\n      trayOpen: '打开',\n      trayExit: '退出',\n    },\n    window: {\n      minimize: '最小化',\n      maximize: '最大化',\n      restore: '恢复',\n      close: '关闭',\n      closeConfirmation: {\n        title: '关闭确认',\n        message: '您确定要关闭极光图库吗？',\n        minimizeToTray: '最小化到托盘',\n        exit: '退出程序',\n        alwaysAsk: '每次询问'\n      }\n    },\n    search: {\n      scopeAll: '搜索全部',\n      scopeFile: '文件名',\n      scopeTag: '标签',\n      scopeFolder: '文件夹',\n      placeholder: '搜索...',\n      tagSearchPlaceholder: '搜索标签...'\n    },\n    sort: {\n      sortBy: '排序方式',\n      name: '按名称',\n      date: '按时间',\n      size: '按大小',\n      asc: '升序',\n      desc: '降序'\n    },\n    groupBy: {\n      title: '分组方式',\n      none: '无',\n      type: '类型',\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "lineNumber": 379
          },
          {
            "text": "      connectionFailed: '连接失败',",
            "lineNumber": 380
          },
          {
            "text": "      connectionStatus: '连接状态',",
            "lineNumber": 381
          },
          {
            "text": "      statusConnected: '已连接',",
            "lineNumber": 382
          },
          {
            "text": "      statusDisconnected: '未连接',",
            "lineNumber": 383
          },
          {
            "text": "      statusChecking: '检查中...',",
            "lineNumber": 384
          },
          {
            "text": "      endpoint: '服务地址',",
            "lineNumber": 385
          },
          {
            "text": "      apiKey: 'API 密钥',",
            "lineNumber": 386
          },
          {
            "text": "      batchRenameTitle: '批量重命名',",
            "lineNumber": 387
          },
          {
            "text": "      namePattern: '命名规则',",
            "lineNumber": 388
          },
          {
            "text": "      namePatternHint: '示例：Image_### 或 Trip_{date}',",
            "lineNumber": 389
          },
          {
            "text": "      startNumber: '起始序号',",
            "lineNumber": 390
          },
          {
            "text": "      preview: '预览',",
            "lineNumber": 391
          },
          {
            "text": "      patternHelp: '使用 # 代表数字序号 (如 ### 代表 001)，使用 {date} 代表当前日期。',",
            "lineNumber": 392
          },
          {
            "text": "      aiSmartSearch: 'AI 智能搜索',",
            "lineNumber": 393
          },
          {
            "text": "      aiSmartSearchThinking: 'AI 正在思考...',",
            "lineNumber": 394
          },
          {
            "text": "      aiTargetLang: '翻译目标语言',",
            "lineNumber": 395
          },
          {
            "text": "      dataBackup: '数据备份',",
            "lineNumber": 396
          },
          {
            "text": "      exportTags: '导出标签与人物',",
            "lineNumber": 397
          },
          {
            "text": "      importTags: '导入标签与人物',",
            "lineNumber": 398
          },
          {
            "text": "      importSuccess: '导入成功',",
            "lineNumber": 399
          },
          {
            "text": "      importError: '导入失败：文件格式无效',",
            "lineNumber": 400
          },
          {
            "text": "    },",
            "lineNumber": 401
          },
          {
            "text": "    exitModal: {",
            "lineNumber": 402
          },
          {
            "text": "      title: '关闭确认',",
            "lineNumber": 403
          },
          {
            "text": "      message: '您希望如何关闭应用程序？',",
            "lineNumber": 404
          },
          {
            "text": "      minimize: '最小化到托盘',",
            "lineNumber": 405
          },
          {
            "text": "      exit: '直接退出',",
            "lineNumber": 406
          },
          {
            "text": "      remember: '记住我的选择',",
            "lineNumber": 407
          },
          {
            "text": "      trayOpen: '打开',",
            "lineNumber": 408
          },
          {
            "text": "      trayExit: '退出',",
            "lineNumber": 409
          },
          {
            "text": "    },",
            "lineNumber": 410
          },
          {
            "text": "    window: {",
            "lineNumber": 411
          },
          {
            "text": "      minimize: '最小化',",
            "lineNumber": 412
          },
          {
            "text": "      maximize: '最大化',",
            "lineNumber": 413
          },
          {
            "text": "      restore: '恢复',",
            "lineNumber": 414
          },
          {
            "text": "      close: '关闭',",
            "lineNumber": 415
          },
          {
            "text": "      closeConfirmation: {",
            "lineNumber": 416
          },
          {
            "text": "        title: '关闭确认',",
            "lineNumber": 417
          },
          {
            "text": "        message: '您确定要关闭极光图库吗？',",
            "lineNumber": 418
          },
          {
            "text": "        minimizeToTray: '最小化到托盘',",
            "lineNumber": 419
          },
          {
            "text": "        exit: '退出程序',",
            "lineNumber": 420
          },
          {
            "text": "        alwaysAsk: '每次询问'",
            "lineNumber": 421
          },
          {
            "text": "      }",
            "lineNumber": 422
          },
          {
            "text": "    },",
            "lineNumber": 423
          },
          {
            "text": "    search: {",
            "lineNumber": 424
          },
          {
            "text": "      scopeAll: '搜索全部',",
            "lineNumber": 425
          },
          {
            "text": "      scopeFile: '文件名',",
            "lineNumber": 426
          },
          {
            "text": "      scopeTag: '标签',",
            "lineNumber": 427
          },
          {
            "text": "      scopeFolder: '文件夹',",
            "lineNumber": 428
          },
          {
            "text": "      placeholder: '搜索...',",
            "lineNumber": 429
          },
          {
            "text": "      tagSearchPlaceholder: '搜索标签...'",
            "lineNumber": 430
          },
          {
            "text": "    },",
            "lineNumber": 431
          },
          {
            "text": "    sort: {",
            "lineNumber": 432
          },
          {
            "text": "      sortBy: '排序方式',",
            "lineNumber": 433
          },
          {
            "text": "      name: '按名称',",
            "lineNumber": 434
          },
          {
            "text": "      date: '按时间',",
            "lineNumber": 435
          },
          {
            "text": "      size: '按大小',",
            "lineNumber": 436
          },
          {
            "text": "      asc: '升序',",
            "lineNumber": 437
          },
          {
            "text": "      desc: '降序'",
            "lineNumber": 438
          },
          {
            "text": "    },",
            "lineNumber": 439
          },
          {
            "text": "    groupBy: {",
            "lineNumber": 440
          },
          {
            "text": "      title: '分组方式',",
            "lineNumber": 441
          },
          {
            "text": "      none: '无',",
            "lineNumber": 442
          },
          {
            "text": "      type: '类型',",
            "lineNumber": 443
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.4229188561439514
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n\n          &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-2\"&gt;&lt;/div&gt;\n          &lt;button \n            onClick={onNavigateBack} disabled={!canGoBack}\n            className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30 text-gray-500 dark:text-gray-400\"\n            title={t('viewer.back')}\n          &gt;\n            &lt;ArrowLeft size={18} /&gt;\n          &lt;/button&gt;\n          &lt;button \n            onClick={onNavigateForward} disabled={!canGoForward}\n            className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30 text-gray-500 dark:text-gray-400\"\n            title={t('viewer.forward')}\n          &gt;\n            &lt;ArrowRight size={18} /&gt;\n          &lt;/button&gt;\n        &lt;/div&gt;\n\n        &lt;div className=\"flex-1 text-center truncate px-4 font-medium text-gray-800 dark:text-gray-200 flex justify-center items-center\"&gt;\n          {showSearch ? (\n            &lt;div className=\"relative w-full max-w-[672px] animate-fade-in\"&gt;\n              &lt;div className={&#96;flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border overflow-hidden ${isAISearchEnabled ? 'border-purple-500 shadow-sm shadow-purple-500/20' : localQuery ? 'border-blue-500 shadow-sm' : 'border-transparent'}&#96;}&gt;\n                 &lt;div className=\"relative flex-shrink-0\"&gt;\n                   &lt;button \n                     ref={scopeBtnRef}\n                     type=\"button\"\n                     onClick={toggleScopeMenu}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "lineNumber": 467
          },
          {
            "text": "          &lt;div className=\"h-6 w-px bg-gray-300 dark:bg-gray-700 mx-2\"&gt;&lt;/div&gt;",
            "lineNumber": 468
          },
          {
            "text": "          &lt;button ",
            "lineNumber": 469
          },
          {
            "text": "            onClick={onNavigateBack} disabled={!canGoBack}",
            "lineNumber": 470
          },
          {
            "text": "            className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30 text-gray-500 dark:text-gray-400\"",
            "lineNumber": 471
          },
          {
            "text": "            title={t('viewer.back')}",
            "lineNumber": 472
          },
          {
            "text": "          &gt;",
            "lineNumber": 473
          },
          {
            "text": "            &lt;ArrowLeft size={18} /&gt;",
            "lineNumber": 474
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 475
          },
          {
            "text": "          &lt;button ",
            "lineNumber": 476
          },
          {
            "text": "            onClick={onNavigateForward} disabled={!canGoForward}",
            "lineNumber": 477
          },
          {
            "text": "            className=\"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-30 text-gray-500 dark:text-gray-400\"",
            "lineNumber": 478
          },
          {
            "text": "            title={t('viewer.forward')}",
            "lineNumber": 479
          },
          {
            "text": "          &gt;",
            "lineNumber": 480
          },
          {
            "text": "            &lt;ArrowRight size={18} /&gt;",
            "lineNumber": 481
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 482
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 483
          },
          {
            "lineNumber": 484
          },
          {
            "text": "        &lt;div className=\"flex-1 text-center truncate px-4 font-medium text-gray-800 dark:text-gray-200 flex justify-center items-center\"&gt;",
            "lineNumber": 485
          },
          {
            "text": "          {showSearch ? (",
            "lineNumber": 486
          },
          {
            "text": "            &lt;div className=\"relative w-full max-w-[672px] animate-fade-in\"&gt;",
            "lineNumber": 487
          },
          {
            "text": "              &lt;div className={&#96;flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border overflow-hidden ${isAISearchEnabled ? 'border-purple-500 shadow-sm shadow-purple-500/20' : localQuery ? 'border-blue-500 shadow-sm' : 'border-transparent'}&#96;}&gt;",
            "lineNumber": 488
          },
          {
            "text": "                 &lt;div className=\"relative flex-shrink-0\"&gt;",
            "lineNumber": 489
          },
          {
            "text": "                   &lt;button ",
            "lineNumber": 490
          },
          {
            "text": "                     ref={scopeBtnRef}",
            "lineNumber": 491
          },
          {
            "text": "                     type=\"button\"",
            "lineNumber": 492
          },
          {
            "text": "                     onClick={toggleScopeMenu}",
            "lineNumber": 493
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.3759934902191162
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n\n      deletePersonConfirmTitle: 'Delete Person?',\n      deletePersonConfirmMsg: 'Deleting this person will remove all face association data, but will not delete the original images.',\n      allPeople: 'All People',\n      setAvatar: 'Set Avatar',\n      cropAvatar: 'Crop Avatar',\n      startSlideshow: 'Start Slideshow',\n      stopSlideshow: 'Stop Slideshow',\n      slideshowSettings: 'Slideshow Settings',\n      fullscreen: 'Fullscreen',\n      exitFullscreen: 'Exit Fullscreen',\n      rename: 'Rename',\n      batchRename: 'Batch Rename',\n      delete: 'Delete',\n      copyTo: 'Copy to Folder...',\n      copyToCurrentFolder: 'Copy to Current Folder',\n      moveTo: 'Move to Folder...',\n      moveToCurrentFolder: 'Move to Current Folder',\n      viewTagged: 'View Tagged Files',\n      copyName: 'Copy Name',\n      deleteTag: 'Delete Tag',\n      deleteTagConfirmTitle: 'Delete Tag?',\n      deleteTagConfirmMsg: 'Deleting this tag will remove it from all files that use it.',\n      deleteTagConfirmBtn: 'Delete',\n      copied: 'Copied',\n      moved: 'Moved',\n      imageCopied: 'Image copied to clipboard',\n      emptyFolder: 'Empty',\n      noFiles: 'No Files',\n      items: 'items',\n      files: 'files',\n      subfolders: 'folders',\n      newFolder: 'New Folder',\n      createSubfolder: 'Create Subfolder',\n      expandAll: 'Expand All Subfolders',\n      collapseAll: 'Collapse All Subfolders',\n      refresh: 'Refresh',\n      backgroundTitle: 'General',\n      openInNewTab: 'Open in New Tab',\n      openFolderInNewTab: 'Open Selected Folder in New Tab',\n      newTab: 'New Tab',\n      closeTab: 'Close Tab',\n      closeOtherTabs: 'Close Other Tabs',\n      closeAllTabs: 'Close All Tabs',\n      noTags: 'No tags',\n      filters: 'Filters:',\n      clearAll: 'Clear All',\n      allTagsOverview: 'All Tags Overview',\n      filtered: '(Filtered)',\n      selectAll: 'Select All',\n      deletedItems: 'Deleted {count} items',\n      undo: 'Undo',\n      copyColor: 'Copy Color Value',\n      searchSimilarColor: 'Search Similar Colors',\n      aiAnalyze: 'AI Smart Analysis',\n      aiAnalyzeFolder: 'AI Smart Analysis (Folder)',\n      addBookmark: 'Add Bookmark',\n      readBookmark: 'Read Bookmark',\n      saved: 'Saved',\n      loaded: 'Loaded'\n    },\n    tasks: {\n      title: 'Progress',\n      minimizing: 'Minimize',\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "lineNumber": 544
          },
          {
            "text": "      deletePersonConfirmTitle: 'Delete Person?',",
            "lineNumber": 545
          },
          {
            "text": "      deletePersonConfirmMsg: 'Deleting this person will remove all face association data, but will not delete the original images.',",
            "lineNumber": 546
          },
          {
            "text": "      allPeople: 'All People',",
            "lineNumber": 547
          },
          {
            "text": "      setAvatar: 'Set Avatar',",
            "lineNumber": 548
          },
          {
            "text": "      cropAvatar: 'Crop Avatar',",
            "lineNumber": 549
          },
          {
            "text": "      startSlideshow: 'Start Slideshow',",
            "lineNumber": 550
          },
          {
            "text": "      stopSlideshow: 'Stop Slideshow',",
            "lineNumber": 551
          },
          {
            "text": "      slideshowSettings: 'Slideshow Settings',",
            "lineNumber": 552
          },
          {
            "text": "      fullscreen: 'Fullscreen',",
            "lineNumber": 553
          },
          {
            "text": "      exitFullscreen: 'Exit Fullscreen',",
            "lineNumber": 554
          },
          {
            "text": "      rename: 'Rename',",
            "lineNumber": 555
          },
          {
            "text": "      batchRename: 'Batch Rename',",
            "lineNumber": 556
          },
          {
            "text": "      delete: 'Delete',",
            "lineNumber": 557
          },
          {
            "text": "      copyTo: 'Copy to Folder...',",
            "lineNumber": 558
          },
          {
            "text": "      copyToCurrentFolder: 'Copy to Current Folder',",
            "lineNumber": 559
          },
          {
            "text": "      moveTo: 'Move to Folder...',",
            "lineNumber": 560
          },
          {
            "text": "      moveToCurrentFolder: 'Move to Current Folder',",
            "lineNumber": 561
          },
          {
            "text": "      viewTagged: 'View Tagged Files',",
            "lineNumber": 562
          },
          {
            "text": "      copyName: 'Copy Name',",
            "lineNumber": 563
          },
          {
            "text": "      deleteTag: 'Delete Tag',",
            "lineNumber": 564
          },
          {
            "text": "      deleteTagConfirmTitle: 'Delete Tag?',",
            "lineNumber": 565
          },
          {
            "text": "      deleteTagConfirmMsg: 'Deleting this tag will remove it from all files that use it.',",
            "lineNumber": 566
          },
          {
            "text": "      deleteTagConfirmBtn: 'Delete',",
            "lineNumber": 567
          },
          {
            "text": "      copied: 'Copied',",
            "lineNumber": 568
          },
          {
            "text": "      moved: 'Moved',",
            "lineNumber": 569
          },
          {
            "text": "      imageCopied: 'Image copied to clipboard',",
            "lineNumber": 570
          },
          {
            "text": "      emptyFolder: 'Empty',",
            "lineNumber": 571
          },
          {
            "text": "      noFiles: 'No Files',",
            "lineNumber": 572
          },
          {
            "text": "      items: 'items',",
            "lineNumber": 573
          },
          {
            "text": "      files: 'files',",
            "lineNumber": 574
          },
          {
            "text": "      subfolders: 'folders',",
            "lineNumber": 575
          },
          {
            "text": "      newFolder: 'New Folder',",
            "lineNumber": 576
          },
          {
            "text": "      createSubfolder: 'Create Subfolder',",
            "lineNumber": 577
          },
          {
            "text": "      expandAll: 'Expand All Subfolders',",
            "lineNumber": 578
          },
          {
            "text": "      collapseAll: 'Collapse All Subfolders',",
            "lineNumber": 579
          },
          {
            "text": "      refresh: 'Refresh',",
            "lineNumber": 580
          },
          {
            "text": "      backgroundTitle: 'General',",
            "lineNumber": 581
          },
          {
            "text": "      openInNewTab: 'Open in New Tab',",
            "lineNumber": 582
          },
          {
            "text": "      openFolderInNewTab: 'Open Selected Folder in New Tab',",
            "lineNumber": 583
          },
          {
            "text": "      newTab: 'New Tab',",
            "lineNumber": 584
          },
          {
            "text": "      closeTab: 'Close Tab',",
            "lineNumber": 585
          },
          {
            "text": "      closeOtherTabs: 'Close Other Tabs',",
            "lineNumber": 586
          },
          {
            "text": "      closeAllTabs: 'Close All Tabs',",
            "lineNumber": 587
          },
          {
            "text": "      noTags: 'No tags',",
            "lineNumber": 588
          },
          {
            "text": "      filters: 'Filters:',",
            "lineNumber": 589
          },
          {
            "text": "      clearAll: 'Clear All',",
            "lineNumber": 590
          },
          {
            "text": "      allTagsOverview: 'All Tags Overview',",
            "lineNumber": 591
          },
          {
            "text": "      filtered: '(Filtered)',",
            "lineNumber": 592
          },
          {
            "text": "      selectAll: 'Select All',",
            "lineNumber": 593
          },
          {
            "text": "      deletedItems: 'Deleted {count} items',",
            "lineNumber": 594
          },
          {
            "text": "      undo: 'Undo',",
            "lineNumber": 595
          },
          {
            "text": "      copyColor: 'Copy Color Value',",
            "lineNumber": 596
          },
          {
            "text": "      searchSimilarColor: 'Search Similar Colors',",
            "lineNumber": 597
          },
          {
            "text": "      aiAnalyze: 'AI Smart Analysis',",
            "lineNumber": 598
          },
          {
            "text": "      aiAnalyzeFolder: 'AI Smart Analysis (Folder)',",
            "lineNumber": 599
          },
          {
            "text": "      addBookmark: 'Add Bookmark',",
            "lineNumber": 600
          },
          {
            "text": "      readBookmark: 'Read Bookmark',",
            "lineNumber": 601
          },
          {
            "text": "      saved: 'Saved',",
            "lineNumber": 602
          },
          {
            "text": "      loaded: 'Loaded'",
            "lineNumber": 603
          },
          {
            "text": "    },",
            "lineNumber": 604
          },
          {
            "text": "    tasks: {",
            "lineNumber": 605
          },
          {
            "text": "      title: 'Progress',",
            "lineNumber": 606
          },
          {
            "text": "      minimizing: 'Minimize',",
            "lineNumber": 607
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.3678015470504761
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 444
          },
          "endPosition": {
            "line": 807,
            "column": 1
          }
        },
        "contents": "export const TopBar: React.FC&lt;TopBarProps&gt; = \n\n(opt) =&gt; (\n\n                      &lt;/button&gt;\n                    ))}\n                  &lt;/div&gt;\n                &lt;/&gt;\n              )}\n            &lt;/div&gt;\n          )}\n\n          &lt;Search size={16} className={&#96;mr-2 flex-shrink-0 ${isAISearchEnabled ? 'text-purple-500' : 'text-gray-400'}&#96;} /&gt;\n          \n          &lt;input\n            ref={searchInputRef}\n            type=\"text\"\n            id=\"toolbar-search-input\"\n            name=\"toolbar-search-input\"\n            className=\"bg-transparent border-none focus:outline-none text-sm w-full text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 min-w-0\"\n            placeholder={\n              activeTab.viewMode === 'people-overview' \n                ? t('search.placeholderPerson') || '搜索人物...'\n                : isAISearchEnabled \n                  ? t('settings.aiSmartSearch') \n                  : t('search.placeholder')\n            }\n            value={toolbarQuery}\n            onChange={(e) =&gt; onSetToolbarQuery(e.target.value)}\n            onKeyDown={handleKeyDown}\n          /&gt;\n\n          &lt;div className=\"flex items-center space-x-1 ml-2 flex-shrink-0\"&gt;\n             {toolbarQuery &amp;&amp; (\n                &lt;button onClick={() =&gt; { onSetToolbarQuery(''); onPerformSearch(''); }} className=\"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-400 flex-shrink-0\"&gt;\n                  &lt;X size={14} /&gt;\n                &lt;/button&gt;\n             )}\n              \n             &lt;button \n                onClick={onToggleAISearch}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 443,
                "column": 1
              },
              "endPosition": {
                "line": 443,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 8
              },
              "endPosition": {
                "line": 443,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 14
              },
              "endPosition": {
                "line": 443,
                "column": 46
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const TopBar: React.FC&lt;TopBarProps&gt; = ",
            "lineNumber": 445
          },
          {
            "lineNumber": 544
          },
          {
            "text": "(opt) =&gt; (",
            "lineNumber": 549
          },
          {
            "lineNumber": 555
          },
          {
            "text": "                      &lt;/button&gt;",
            "lineNumber": 556
          },
          {
            "text": "                    ))}",
            "lineNumber": 557
          },
          {
            "text": "                  &lt;/div&gt;",
            "lineNumber": 558
          },
          {
            "text": "                &lt;/&gt;",
            "lineNumber": 559
          },
          {
            "text": "              )}",
            "lineNumber": 560
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 561
          },
          {
            "text": "          )}",
            "lineNumber": 562
          },
          {
            "lineNumber": 563
          },
          {
            "text": "          &lt;Search size={16} className={&#96;mr-2 flex-shrink-0 ${isAISearchEnabled ? 'text-purple-500' : 'text-gray-400'}&#96;} /&gt;",
            "lineNumber": 564
          },
          {
            "text": "          ",
            "lineNumber": 565
          },
          {
            "text": "          &lt;input",
            "lineNumber": 566
          },
          {
            "text": "            ref={searchInputRef}",
            "lineNumber": 567
          },
          {
            "text": "            type=\"text\"",
            "lineNumber": 568
          },
          {
            "text": "            id=\"toolbar-search-input\"",
            "lineNumber": 569
          },
          {
            "text": "            name=\"toolbar-search-input\"",
            "lineNumber": 570
          },
          {
            "text": "            className=\"bg-transparent border-none focus:outline-none text-sm w-full text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 min-w-0\"",
            "lineNumber": 571
          },
          {
            "text": "            placeholder={",
            "lineNumber": 572
          },
          {
            "text": "              activeTab.viewMode === 'people-overview' ",
            "lineNumber": 573
          },
          {
            "text": "                ? t('search.placeholderPerson') || '搜索人物...'",
            "lineNumber": 574
          },
          {
            "text": "                : isAISearchEnabled ",
            "lineNumber": 575
          },
          {
            "text": "                  ? t('settings.aiSmartSearch') ",
            "lineNumber": 576
          },
          {
            "text": "                  : t('search.placeholder')",
            "lineNumber": 577
          },
          {
            "text": "            }",
            "lineNumber": 578
          },
          {
            "text": "            value={toolbarQuery}",
            "lineNumber": 579
          },
          {
            "text": "            onChange={(e) =&gt; onSetToolbarQuery(e.target.value)}",
            "lineNumber": 580
          },
          {
            "text": "            onKeyDown={handleKeyDown}",
            "lineNumber": 581
          },
          {
            "text": "          /&gt;",
            "lineNumber": 582
          },
          {
            "lineNumber": 583
          },
          {
            "text": "          &lt;div className=\"flex items-center space-x-1 ml-2 flex-shrink-0\"&gt;",
            "lineNumber": 584
          },
          {
            "text": "             {toolbarQuery &amp;&amp; (",
            "lineNumber": 585
          },
          {
            "text": "                &lt;button onClick={() =&gt; { onSetToolbarQuery(''); onPerformSearch(''); }} className=\"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-400 flex-shrink-0\"&gt;",
            "lineNumber": 586
          },
          {
            "text": "                  &lt;X size={14} /&gt;",
            "lineNumber": 587
          },
          {
            "text": "                &lt;/button&gt;",
            "lineNumber": 588
          },
          {
            "text": "             )}",
            "lineNumber": 589
          },
          {
            "text": "              ",
            "lineNumber": 590
          },
          {
            "text": "             &lt;button ",
            "lineNumber": 591
          },
          {
            "text": "                onClick={onToggleAISearch}",
            "lineNumber": 592
          },
          {
            "text": ";",
            "lineNumber": 808
          }
        ]
      },
      "score": 0.34775853157043457
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n,\n        applyToAll: 'Apply to all selected items',\n        save: 'Save',\n        saved: 'Saved',\n        descSaveHint: 'Shift+Enter to save',\n        sourceSaveHint: 'Enter to save',\n        folderComposition: 'File Composition',\n        folderStats: 'Contents',\n        folderType: 'Folder',\n        folderCategory: 'Folder Category',\n        catGeneral: 'General',\n        catBook: 'Book',\n        catSequence: 'Sequence',\n        unknown: 'Unknown',\n        other: 'Other',\n        aiSection: 'AI INTELLIGENCE',\n        aiFaces: 'Detected Faces',\n        aiScene: 'Scene',\n        aiConfidence: 'Confidence',\n        aiObjects: 'Objects',\n        aiAutoTags: 'AI Tags',\n        aiExtractedText: 'Extracted Text',\n        aiTranslatedText: 'Translation',\n        bookDetails: 'Book Details',\n        author: 'Author',\n        bookmarks: 'Bookmarks',\n        noBookmarks: 'No Bookmarks',\n        addBookmark: 'Bookmark This Page',\n        aiTextAnalysis: 'AI Text Analysis',\n        leftPage: 'Left Page',\n        rightPage: 'Right Page',\n        translation: 'Translation',\n        pages: 'Pages',\n        clear: 'Clear',\n        clearAll: 'Clear All',\n        clearAiData: 'Clear AI Intelligence Info',\n        clearAllAiData: 'Clear All AI Intelligence Info',\n        aiFilesCount: 'AI Analyzed Files',\n      },\n    viewer: {\n      toggleSidebar: 'Toggle Sidebar',\n      toggleMeta: 'Toggle Info Panel',\n      back: 'Back',\n      forward: 'Forward',\n      up: 'Up',\n      original: 'Original Size',\n      fit: 'Fit to Window',\n      rotateLeft: 'Rotate Left',\n      rotateRight: 'Rotate Right',\n      search: 'Search',\n      slideshowInterval: 'Interval',\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "text": ",",
            "lineNumber": 661
          },
          {
            "text": "        applyToAll: 'Apply to all selected items',",
            "lineNumber": 662
          },
          {
            "text": "        save: 'Save',",
            "lineNumber": 663
          },
          {
            "text": "        saved: 'Saved',",
            "lineNumber": 664
          },
          {
            "text": "        descSaveHint: 'Shift+Enter to save',",
            "lineNumber": 665
          },
          {
            "text": "        sourceSaveHint: 'Enter to save',",
            "lineNumber": 666
          },
          {
            "text": "        folderComposition: 'File Composition',",
            "lineNumber": 667
          },
          {
            "text": "        folderStats: 'Contents',",
            "lineNumber": 668
          },
          {
            "text": "        folderType: 'Folder',",
            "lineNumber": 669
          },
          {
            "text": "        folderCategory: 'Folder Category',",
            "lineNumber": 670
          },
          {
            "text": "        catGeneral: 'General',",
            "lineNumber": 671
          },
          {
            "text": "        catBook: 'Book',",
            "lineNumber": 672
          },
          {
            "text": "        catSequence: 'Sequence',",
            "lineNumber": 673
          },
          {
            "text": "        unknown: 'Unknown',",
            "lineNumber": 674
          },
          {
            "text": "        other: 'Other',",
            "lineNumber": 675
          },
          {
            "text": "        aiSection: 'AI INTELLIGENCE',",
            "lineNumber": 676
          },
          {
            "text": "        aiFaces: 'Detected Faces',",
            "lineNumber": 677
          },
          {
            "text": "        aiScene: 'Scene',",
            "lineNumber": 678
          },
          {
            "text": "        aiConfidence: 'Confidence',",
            "lineNumber": 679
          },
          {
            "text": "        aiObjects: 'Objects',",
            "lineNumber": 680
          },
          {
            "text": "        aiAutoTags: 'AI Tags',",
            "lineNumber": 681
          },
          {
            "text": "        aiExtractedText: 'Extracted Text',",
            "lineNumber": 682
          },
          {
            "text": "        aiTranslatedText: 'Translation',",
            "lineNumber": 683
          },
          {
            "text": "        bookDetails: 'Book Details',",
            "lineNumber": 684
          },
          {
            "text": "        author: 'Author',",
            "lineNumber": 685
          },
          {
            "text": "        bookmarks: 'Bookmarks',",
            "lineNumber": 686
          },
          {
            "text": "        noBookmarks: 'No Bookmarks',",
            "lineNumber": 687
          },
          {
            "text": "        addBookmark: 'Bookmark This Page',",
            "lineNumber": 688
          },
          {
            "text": "        aiTextAnalysis: 'AI Text Analysis',",
            "lineNumber": 689
          },
          {
            "text": "        leftPage: 'Left Page',",
            "lineNumber": 690
          },
          {
            "text": "        rightPage: 'Right Page',",
            "lineNumber": 691
          },
          {
            "text": "        translation: 'Translation',",
            "lineNumber": 692
          },
          {
            "text": "        pages: 'Pages',",
            "lineNumber": 693
          },
          {
            "text": "        clear: 'Clear',",
            "lineNumber": 694
          },
          {
            "text": "        clearAll: 'Clear All',",
            "lineNumber": 695
          },
          {
            "text": "        clearAiData: 'Clear AI Intelligence Info',",
            "lineNumber": 696
          },
          {
            "text": "        clearAllAiData: 'Clear All AI Intelligence Info',",
            "lineNumber": 697
          },
          {
            "text": "        aiFilesCount: 'AI Analyzed Files',",
            "lineNumber": 698
          },
          {
            "text": "      },",
            "lineNumber": 699
          },
          {
            "text": "    viewer: {",
            "lineNumber": 700
          },
          {
            "text": "      toggleSidebar: 'Toggle Sidebar',",
            "lineNumber": 701
          },
          {
            "text": "      toggleMeta: 'Toggle Info Panel',",
            "lineNumber": 702
          },
          {
            "text": "      back: 'Back',",
            "lineNumber": 703
          },
          {
            "text": "      forward: 'Forward',",
            "lineNumber": 704
          },
          {
            "text": "      up: 'Up',",
            "lineNumber": 705
          },
          {
            "text": "      original: 'Original Size',",
            "lineNumber": 706
          },
          {
            "text": "      fit: 'Fit to Window',",
            "lineNumber": 707
          },
          {
            "text": "      rotateLeft: 'Rotate Left',",
            "lineNumber": 708
          },
          {
            "text": "      rotateRight: 'Rotate Right',",
            "lineNumber": 709
          },
          {
            "text": "      search: 'Search',",
            "lineNumber": 710
          },
          {
            "text": "      slideshowInterval: 'Interval',",
            "lineNumber": 711
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.34434831142425537
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n\n      deleteTagConfirmTitle: '删除标签？',\n      deleteTagConfirmMsg: '删除该标签会清除所有已经使用了该标签的文件上的关联。',\n      deleteTagConfirmBtn: '删除',\n      copied: '已复制',\n      moved: '已移动',\n      imageCopied: '图片数据已复制到剪贴板',\n      emptyFolder: '空文件夹',\n      noFiles: '无文件',\n      items: '项',\n      files: '个文件',\n      subfolders: '子文件夹',\n      newFolder: '新建文件夹',\n      createSubfolder: '创建子文件夹',\n      expandAll: '展开所有子文件夹',\n      collapseAll: '收起所有子文件夹',\n      refresh: '刷新',\n      backgroundTitle: '常规',\n      openInNewTab: '在新标签页中打开',\n      openFolderInNewTab: '在新标签页打开所选的文件夹',\n      newTab: '新建标签页',\n      closeTab: '关闭标签页',\n      closeOtherTabs: '关闭其他标签页',\n      closeAllTabs: '关闭所有标签页',\n      noTags: '暂无标签',\n      filters: '筛选条件:',\n      clearAll: '清除所有',\n      allTagsOverview: '所有标签概览',\n      filtered: '(已筛选)',\n      selectAll: '全选',\n      deletedItems: '已删除 {count} 项',\n      undo: '撤销',\n      copyColor: '复制颜色值',\n      searchSimilarColor: '搜索此颜色相近的文件',\n      aiAnalyze: 'AI 智能分析',\n      aiAnalyzeFolder: 'AI 智能分析 (文件夹)',\n      addBookmark: '添加书签',\n      readBookmark: '读取书签',\n      saved: '已保存',\n      loaded: '已读取'\n    },\n    tasks:\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "lineNumber": 92
          },
          {
            "text": "      deleteTagConfirmTitle: '删除标签？',",
            "lineNumber": 93
          },
          {
            "text": "      deleteTagConfirmMsg: '删除该标签会清除所有已经使用了该标签的文件上的关联。',",
            "lineNumber": 94
          },
          {
            "text": "      deleteTagConfirmBtn: '删除',",
            "lineNumber": 95
          },
          {
            "text": "      copied: '已复制',",
            "lineNumber": 96
          },
          {
            "text": "      moved: '已移动',",
            "lineNumber": 97
          },
          {
            "text": "      imageCopied: '图片数据已复制到剪贴板',",
            "lineNumber": 98
          },
          {
            "text": "      emptyFolder: '空文件夹',",
            "lineNumber": 99
          },
          {
            "text": "      noFiles: '无文件',",
            "lineNumber": 100
          },
          {
            "text": "      items: '项',",
            "lineNumber": 101
          },
          {
            "text": "      files: '个文件',",
            "lineNumber": 102
          },
          {
            "text": "      subfolders: '子文件夹',",
            "lineNumber": 103
          },
          {
            "text": "      newFolder: '新建文件夹',",
            "lineNumber": 104
          },
          {
            "text": "      createSubfolder: '创建子文件夹',",
            "lineNumber": 105
          },
          {
            "text": "      expandAll: '展开所有子文件夹',",
            "lineNumber": 106
          },
          {
            "text": "      collapseAll: '收起所有子文件夹',",
            "lineNumber": 107
          },
          {
            "text": "      refresh: '刷新',",
            "lineNumber": 108
          },
          {
            "text": "      backgroundTitle: '常规',",
            "lineNumber": 109
          },
          {
            "text": "      openInNewTab: '在新标签页中打开',",
            "lineNumber": 110
          },
          {
            "text": "      openFolderInNewTab: '在新标签页打开所选的文件夹',",
            "lineNumber": 111
          },
          {
            "text": "      newTab: '新建标签页',",
            "lineNumber": 112
          },
          {
            "text": "      closeTab: '关闭标签页',",
            "lineNumber": 113
          },
          {
            "text": "      closeOtherTabs: '关闭其他标签页',",
            "lineNumber": 114
          },
          {
            "text": "      closeAllTabs: '关闭所有标签页',",
            "lineNumber": 115
          },
          {
            "text": "      noTags: '暂无标签',",
            "lineNumber": 116
          },
          {
            "text": "      filters: '筛选条件:',",
            "lineNumber": 117
          },
          {
            "text": "      clearAll: '清除所有',",
            "lineNumber": 118
          },
          {
            "text": "      allTagsOverview: '所有标签概览',",
            "lineNumber": 119
          },
          {
            "text": "      filtered: '(已筛选)',",
            "lineNumber": 120
          },
          {
            "text": "      selectAll: '全选',",
            "lineNumber": 121
          },
          {
            "text": "      deletedItems: '已删除 {count} 项',",
            "lineNumber": 122
          },
          {
            "text": "      undo: '撤销',",
            "lineNumber": 123
          },
          {
            "text": "      copyColor: '复制颜色值',",
            "lineNumber": 124
          },
          {
            "text": "      searchSimilarColor: '搜索此颜色相近的文件',",
            "lineNumber": 125
          },
          {
            "text": "      aiAnalyze: 'AI 智能分析',",
            "lineNumber": 126
          },
          {
            "text": "      aiAnalyzeFolder: 'AI 智能分析 (文件夹)',",
            "lineNumber": 127
          },
          {
            "text": "      addBookmark: '添加书签',",
            "lineNumber": 128
          },
          {
            "text": "      readBookmark: '读取书签',",
            "lineNumber": 129
          },
          {
            "text": "      saved: '已保存',",
            "lineNumber": 130
          },
          {
            "text": "      loaded: '已读取'",
            "lineNumber": 131
          },
          {
            "text": "    },",
            "lineNumber": 132
          },
          {
            "text": "    tasks:",
            "lineNumber": 133
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.34228044748306274
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n\n    },\n    tasks: {\n      title: 'Progress',\n      minimizing: 'Minimize',\n      processing: 'Processing',\n      rate: 'Rate',\n      filesPerSec: 'files/s',\n      aiAnalysis: 'AI Analysis',\n      copying: 'Copying',\n      moving: 'Moving',\n      complete: 'Complete',\n      minimizeHint: 'Task minimized to sidebar',\n      summarizing: 'Summarizing descriptions...',\n      folderSummaryComplete: 'Folder summary complete',\n      sendingRequest: 'Sending request to',\n      aiResponse: 'AI Response received',\n      readingFile: 'Reading file...',\n      aiAnalyzing: 'Analyzing image...',\n      processingResult: 'Processing AI result...',\n      updatingDescription: 'Updating description...',\n      addingTags: 'Adding tags...',\n      savingData: 'Saving data...',\n      completed: 'Completed',\n      generatingThumbnails: 'Generating thumbnails...',\n      thumbnailsGenerated: 'Thumbnails generation complete',\n      noImagesFound: 'No image files found'\n    },\n    meta: {\n        selectHint: 'Select a file to view details',\n        selected: 'Selected',\n        items: 'items',\n        batchOp: 'Batch Edit',\n        details: 'DETAILS',\n        format: 'Format',\n        size: 'Size',\n        dimensions: 'Dimensions',\n        totalSize: 'Total Size',\n        created: 'Created',\n        updated: 'Updated',\n        tags: 'TAGS',\n        addTagPlaceholder: 'Type and enter to add...',\n        description: 'DESCRIPTION',\n        addDesc: 'Add description...',\n        sourceUrl: 'SOURCE URL',\n        sourceUrlTooltip: 'Ctrl+Click to visit URL',\n        openSource: 'Open Source',\n        palette: 'COLOR PALETTE',\n        histogram: 'HISTOGRAM',\n        showHistogram: 'Show Histogram',\n        hideHistogram: 'Hide Histogram',\n        channelR: 'R',\n        channelG: 'G',\n        channelB: 'B',\n        channelL: 'L',\n        mixedValues: '(Mixed Values)',\n        typeDistribution: 'Type Distribution',\n        fileDistribution: 'File Distribution',\n        totalFiles: 'Total Files',\n        applyToAll: 'Apply to all selected items',\n        save: 'Save',\n        saved: 'Saved',\n        descSaveHint: 'Shift+Enter to save',\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "lineNumber": 603
          },
          {
            "text": "    },",
            "lineNumber": 604
          },
          {
            "text": "    tasks: {",
            "lineNumber": 605
          },
          {
            "text": "      title: 'Progress',",
            "lineNumber": 606
          },
          {
            "text": "      minimizing: 'Minimize',",
            "lineNumber": 607
          },
          {
            "text": "      processing: 'Processing',",
            "lineNumber": 608
          },
          {
            "text": "      rate: 'Rate',",
            "lineNumber": 609
          },
          {
            "text": "      filesPerSec: 'files/s',",
            "lineNumber": 610
          },
          {
            "text": "      aiAnalysis: 'AI Analysis',",
            "lineNumber": 611
          },
          {
            "text": "      copying: 'Copying',",
            "lineNumber": 612
          },
          {
            "text": "      moving: 'Moving',",
            "lineNumber": 613
          },
          {
            "text": "      complete: 'Complete',",
            "lineNumber": 614
          },
          {
            "text": "      minimizeHint: 'Task minimized to sidebar',",
            "lineNumber": 615
          },
          {
            "text": "      summarizing: 'Summarizing descriptions...',",
            "lineNumber": 616
          },
          {
            "text": "      folderSummaryComplete: 'Folder summary complete',",
            "lineNumber": 617
          },
          {
            "text": "      sendingRequest: 'Sending request to',",
            "lineNumber": 618
          },
          {
            "text": "      aiResponse: 'AI Response received',",
            "lineNumber": 619
          },
          {
            "text": "      readingFile: 'Reading file...',",
            "lineNumber": 620
          },
          {
            "text": "      aiAnalyzing: 'Analyzing image...',",
            "lineNumber": 621
          },
          {
            "text": "      processingResult: 'Processing AI result...',",
            "lineNumber": 622
          },
          {
            "text": "      updatingDescription: 'Updating description...',",
            "lineNumber": 623
          },
          {
            "text": "      addingTags: 'Adding tags...',",
            "lineNumber": 624
          },
          {
            "text": "      savingData: 'Saving data...',",
            "lineNumber": 625
          },
          {
            "text": "      completed: 'Completed',",
            "lineNumber": 626
          },
          {
            "text": "      generatingThumbnails: 'Generating thumbnails...',",
            "lineNumber": 627
          },
          {
            "text": "      thumbnailsGenerated: 'Thumbnails generation complete',",
            "lineNumber": 628
          },
          {
            "text": "      noImagesFound: 'No image files found'",
            "lineNumber": 629
          },
          {
            "text": "    },",
            "lineNumber": 630
          },
          {
            "text": "    meta: {",
            "lineNumber": 631
          },
          {
            "text": "        selectHint: 'Select a file to view details',",
            "lineNumber": 632
          },
          {
            "text": "        selected: 'Selected',",
            "lineNumber": 633
          },
          {
            "text": "        items: 'items',",
            "lineNumber": 634
          },
          {
            "text": "        batchOp: 'Batch Edit',",
            "lineNumber": 635
          },
          {
            "text": "        details: 'DETAILS',",
            "lineNumber": 636
          },
          {
            "text": "        format: 'Format',",
            "lineNumber": 637
          },
          {
            "text": "        size: 'Size',",
            "lineNumber": 638
          },
          {
            "text": "        dimensions: 'Dimensions',",
            "lineNumber": 639
          },
          {
            "text": "        totalSize: 'Total Size',",
            "lineNumber": 640
          },
          {
            "text": "        created: 'Created',",
            "lineNumber": 641
          },
          {
            "text": "        updated: 'Updated',",
            "lineNumber": 642
          },
          {
            "text": "        tags: 'TAGS',",
            "lineNumber": 643
          },
          {
            "text": "        addTagPlaceholder: 'Type and enter to add...',",
            "lineNumber": 644
          },
          {
            "text": "        description: 'DESCRIPTION',",
            "lineNumber": 645
          },
          {
            "text": "        addDesc: 'Add description...',",
            "lineNumber": 646
          },
          {
            "text": "        sourceUrl: 'SOURCE URL',",
            "lineNumber": 647
          },
          {
            "text": "        sourceUrlTooltip: 'Ctrl+Click to visit URL',",
            "lineNumber": 648
          },
          {
            "text": "        openSource: 'Open Source',",
            "lineNumber": 649
          },
          {
            "text": "        palette: 'COLOR PALETTE',",
            "lineNumber": 650
          },
          {
            "text": "        histogram: 'HISTOGRAM',",
            "lineNumber": 651
          },
          {
            "text": "        showHistogram: 'Show Histogram',",
            "lineNumber": 652
          },
          {
            "text": "        hideHistogram: 'Hide Histogram',",
            "lineNumber": 653
          },
          {
            "text": "        channelR: 'R',",
            "lineNumber": 654
          },
          {
            "text": "        channelG: 'G',",
            "lineNumber": 655
          },
          {
            "text": "        channelB: 'B',",
            "lineNumber": 656
          },
          {
            "text": "        channelL: 'L',",
            "lineNumber": 657
          },
          {
            "text": "        mixedValues: '(Mixed Values)',",
            "lineNumber": 658
          },
          {
            "text": "        typeDistribution: 'Type Distribution',",
            "lineNumber": 659
          },
          {
            "text": "        fileDistribution: 'File Distribution',",
            "lineNumber": 660
          },
          {
            "text": "        totalFiles: 'Total Files',",
            "lineNumber": 661
          },
          {
            "text": "        applyToAll: 'Apply to all selected items',",
            "lineNumber": 662
          },
          {
            "text": "        save: 'Save',",
            "lineNumber": 663
          },
          {
            "text": "        saved: 'Saved',",
            "lineNumber": 664
          },
          {
            "text": "        descSaveHint: 'Shift+Enter to save',",
            "lineNumber": 665
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.3370383083820343
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n,\n        bookDetails: '图书详情',\n        author: '作者',\n        bookmarks: '书签',\n        noBookmarks: '暂无书签',\n        addBookmark: '添加当前页',\n        aiTextAnalysis: 'AI 文本分析',\n        leftPage: '左页',\n        rightPage: '右页',\n        translation: '翻译',\n        pages: '页面',\n        clear: '清除',\n        clearAll: '清除全部',\n        clearAiData: '清除 AI 智能分析信息',\n        clearAllAiData: '清除所有 AI 智能分析信息',\n        aiFilesCount: 'AI 分析文件数',\n      },\n    viewer: {\n      toggleSidebar: '切换侧边栏',\n      toggleMeta: '切换详情面板',\n      back: '后退',\n      forward: '前进',\n      up: '向上',\n      original: '原始尺寸',\n      fit: '自适应窗口',\n      rotateLeft: '向左旋转',\n      rotateRight: '向右旋转',\n      search: '搜索',\n      slideshowInterval: '播放间隔',\n      transition: '过渡效果',\n      none: '无',\n      fade: '淡入淡出',\n      slide: '平滑移动',\n      random: '随机播放',\n      enableZoom: '图片逐渐放大',\n      done: '完成'\n    },\n    sequence: {\n      play: '播放',\n      pause: '暂停',\n      prev: '上一帧',\n      next: '下一帧',\n      fps: '播放帧率',\n      loop: '循环播放',\n      playOnce: '播放一次',\n      frame: '帧',\n      settings: '序列设置',\n      folderInfo: '文件夹信息',\n      fit: '自适应窗口',\n      original: '原始大小',\n      deleteWarning:\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "text": ",",
            "lineNumber": 211
          },
          {
            "text": "        bookDetails: '图书详情',",
            "lineNumber": 212
          },
          {
            "text": "        author: '作者',",
            "lineNumber": 213
          },
          {
            "text": "        bookmarks: '书签',",
            "lineNumber": 214
          },
          {
            "text": "        noBookmarks: '暂无书签',",
            "lineNumber": 215
          },
          {
            "text": "        addBookmark: '添加当前页',",
            "lineNumber": 216
          },
          {
            "text": "        aiTextAnalysis: 'AI 文本分析',",
            "lineNumber": 217
          },
          {
            "text": "        leftPage: '左页',",
            "lineNumber": 218
          },
          {
            "text": "        rightPage: '右页',",
            "lineNumber": 219
          },
          {
            "text": "        translation: '翻译',",
            "lineNumber": 220
          },
          {
            "text": "        pages: '页面',",
            "lineNumber": 221
          },
          {
            "text": "        clear: '清除',",
            "lineNumber": 222
          },
          {
            "text": "        clearAll: '清除全部',",
            "lineNumber": 223
          },
          {
            "text": "        clearAiData: '清除 AI 智能分析信息',",
            "lineNumber": 224
          },
          {
            "text": "        clearAllAiData: '清除所有 AI 智能分析信息',",
            "lineNumber": 225
          },
          {
            "text": "        aiFilesCount: 'AI 分析文件数',",
            "lineNumber": 226
          },
          {
            "text": "      },",
            "lineNumber": 227
          },
          {
            "text": "    viewer: {",
            "lineNumber": 228
          },
          {
            "text": "      toggleSidebar: '切换侧边栏',",
            "lineNumber": 229
          },
          {
            "text": "      toggleMeta: '切换详情面板',",
            "lineNumber": 230
          },
          {
            "text": "      back: '后退',",
            "lineNumber": 231
          },
          {
            "text": "      forward: '前进',",
            "lineNumber": 232
          },
          {
            "text": "      up: '向上',",
            "lineNumber": 233
          },
          {
            "text": "      original: '原始尺寸',",
            "lineNumber": 234
          },
          {
            "text": "      fit: '自适应窗口',",
            "lineNumber": 235
          },
          {
            "text": "      rotateLeft: '向左旋转',",
            "lineNumber": 236
          },
          {
            "text": "      rotateRight: '向右旋转',",
            "lineNumber": 237
          },
          {
            "text": "      search: '搜索',",
            "lineNumber": 238
          },
          {
            "text": "      slideshowInterval: '播放间隔',",
            "lineNumber": 239
          },
          {
            "text": "      transition: '过渡效果',",
            "lineNumber": 240
          },
          {
            "text": "      none: '无',",
            "lineNumber": 241
          },
          {
            "text": "      fade: '淡入淡出',",
            "lineNumber": 242
          },
          {
            "text": "      slide: '平滑移动',",
            "lineNumber": 243
          },
          {
            "text": "      random: '随机播放',",
            "lineNumber": 244
          },
          {
            "text": "      enableZoom: '图片逐渐放大',",
            "lineNumber": 245
          },
          {
            "text": "      done: '完成'",
            "lineNumber": 246
          },
          {
            "text": "    },",
            "lineNumber": 247
          },
          {
            "text": "    sequence: {",
            "lineNumber": 248
          },
          {
            "text": "      play: '播放',",
            "lineNumber": 249
          },
          {
            "text": "      pause: '暂停',",
            "lineNumber": 250
          },
          {
            "text": "      prev: '上一帧',",
            "lineNumber": 251
          },
          {
            "text": "      next: '下一帧',",
            "lineNumber": 252
          },
          {
            "text": "      fps: '播放帧率',",
            "lineNumber": 253
          },
          {
            "text": "      loop: '循环播放',",
            "lineNumber": 254
          },
          {
            "text": "      playOnce: '播放一次',",
            "lineNumber": 255
          },
          {
            "text": "      frame: '帧',",
            "lineNumber": 256
          },
          {
            "text": "      settings: '序列设置',",
            "lineNumber": 257
          },
          {
            "text": "      folderInfo: '文件夹信息',",
            "lineNumber": 258
          },
          {
            "text": "      fit: '自适应窗口',",
            "lineNumber": 259
          },
          {
            "text": "      original: '原始大小',",
            "lineNumber": 260
          },
          {
            "text": "      deleteWarning:",
            "lineNumber": 261
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.3354930877685547
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n,\n      completed: '已完成',\n      generatingThumbnails: '正在生成缩略图...',\n      thumbnailsGenerated: '缩略图生成完成',\n      noImagesFound: '未找到图片文件'\n    },\n    meta: {\n        selectHint: '选择一个文件以查看详情',\n        selected: '已选择',\n        items: '个项目',\n        batchOp: '批量编辑',\n        details: '详细信息',\n        format: '格式',\n        size: '大小',\n        dimensions: '尺寸',\n        totalSize: '总大小',\n        created: '创建',\n        updated: '更新',\n        tags: '标签',\n        addTagPlaceholder: '输入并回车添加...',\n        description: '描述',\n        addDesc: '添加描述...',\n        sourceUrl: '来源网址',\n        sourceUrlTooltip: '按住 Ctrl 点击访问网址',\n        openSource: '打开来源',\n        palette: '主色调识别',\n        histogram: '图片直方图',\n        showHistogram: '展开直方图',\n        hideHistogram: '收起直方图',\n        channelR: 'R',\n        channelG: 'G',\n        channelB: 'B',\n        channelL: 'L',\n        mixedValues: '(多个不同的值)',\n        typeDistribution: '类型分布',\n        fileDistribution: '文件分布',\n        totalFiles: '总文件数',\n        applyToAll: '应用到所有选中项',\n        save: '保存',\n        saved: '已保存',\n        descSaveHint: 'Shift+Enter 保存',\n        sourceSaveHint: 'Enter 保存',\n        folderComposition: '文件构成',\n        folderStats: '包含内容',\n        folderType: '文件夹',\n        folderCategory: '文件夹分类',\n        catGeneral: '常规',\n        catBook: '图书',\n        catSequence: '序列帧',\n        unknown: '未知',\n        other: '其他',\n        aiSection: 'AI 智能分析',\n        aiFaces: '检测到的人脸',\n        aiScene: '场景分类',\n        aiConfidence: '置信度',\n        aiObjects: '检测物体',\n        aiAutoTags: 'AI 标签',\n        aiExtractedText: '识别到的文字',\n        aiTranslatedText: '翻译结果',\n        bookDetails: '图书详情',\n        author: '作者',\n        bookmarks: '书签',\n        noBookmarks: '暂无书签',\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "text": ",",
            "lineNumber": 153
          },
          {
            "text": "      completed: '已完成',",
            "lineNumber": 154
          },
          {
            "text": "      generatingThumbnails: '正在生成缩略图...',",
            "lineNumber": 155
          },
          {
            "text": "      thumbnailsGenerated: '缩略图生成完成',",
            "lineNumber": 156
          },
          {
            "text": "      noImagesFound: '未找到图片文件'",
            "lineNumber": 157
          },
          {
            "text": "    },",
            "lineNumber": 158
          },
          {
            "text": "    meta: {",
            "lineNumber": 159
          },
          {
            "text": "        selectHint: '选择一个文件以查看详情',",
            "lineNumber": 160
          },
          {
            "text": "        selected: '已选择',",
            "lineNumber": 161
          },
          {
            "text": "        items: '个项目',",
            "lineNumber": 162
          },
          {
            "text": "        batchOp: '批量编辑',",
            "lineNumber": 163
          },
          {
            "text": "        details: '详细信息',",
            "lineNumber": 164
          },
          {
            "text": "        format: '格式',",
            "lineNumber": 165
          },
          {
            "text": "        size: '大小',",
            "lineNumber": 166
          },
          {
            "text": "        dimensions: '尺寸',",
            "lineNumber": 167
          },
          {
            "text": "        totalSize: '总大小',",
            "lineNumber": 168
          },
          {
            "text": "        created: '创建',",
            "lineNumber": 169
          },
          {
            "text": "        updated: '更新',",
            "lineNumber": 170
          },
          {
            "text": "        tags: '标签',",
            "lineNumber": 171
          },
          {
            "text": "        addTagPlaceholder: '输入并回车添加...',",
            "lineNumber": 172
          },
          {
            "text": "        description: '描述',",
            "lineNumber": 173
          },
          {
            "text": "        addDesc: '添加描述...',",
            "lineNumber": 174
          },
          {
            "text": "        sourceUrl: '来源网址',",
            "lineNumber": 175
          },
          {
            "text": "        sourceUrlTooltip: '按住 Ctrl 点击访问网址',",
            "lineNumber": 176
          },
          {
            "text": "        openSource: '打开来源',",
            "lineNumber": 177
          },
          {
            "text": "        palette: '主色调识别',",
            "lineNumber": 178
          },
          {
            "text": "        histogram: '图片直方图',",
            "lineNumber": 179
          },
          {
            "text": "        showHistogram: '展开直方图',",
            "lineNumber": 180
          },
          {
            "text": "        hideHistogram: '收起直方图',",
            "lineNumber": 181
          },
          {
            "text": "        channelR: 'R',",
            "lineNumber": 182
          },
          {
            "text": "        channelG: 'G',",
            "lineNumber": 183
          },
          {
            "text": "        channelB: 'B',",
            "lineNumber": 184
          },
          {
            "text": "        channelL: 'L',",
            "lineNumber": 185
          },
          {
            "text": "        mixedValues: '(多个不同的值)',",
            "lineNumber": 186
          },
          {
            "text": "        typeDistribution: '类型分布',",
            "lineNumber": 187
          },
          {
            "text": "        fileDistribution: '文件分布',",
            "lineNumber": 188
          },
          {
            "text": "        totalFiles: '总文件数',",
            "lineNumber": 189
          },
          {
            "text": "        applyToAll: '应用到所有选中项',",
            "lineNumber": 190
          },
          {
            "text": "        save: '保存',",
            "lineNumber": 191
          },
          {
            "text": "        saved: '已保存',",
            "lineNumber": 192
          },
          {
            "text": "        descSaveHint: 'Shift+Enter 保存',",
            "lineNumber": 193
          },
          {
            "text": "        sourceSaveHint: 'Enter 保存',",
            "lineNumber": 194
          },
          {
            "text": "        folderComposition: '文件构成',",
            "lineNumber": 195
          },
          {
            "text": "        folderStats: '包含内容',",
            "lineNumber": 196
          },
          {
            "text": "        folderType: '文件夹',",
            "lineNumber": 197
          },
          {
            "text": "        folderCategory: '文件夹分类',",
            "lineNumber": 198
          },
          {
            "text": "        catGeneral: '常规',",
            "lineNumber": 199
          },
          {
            "text": "        catBook: '图书',",
            "lineNumber": 200
          },
          {
            "text": "        catSequence: '序列帧',",
            "lineNumber": 201
          },
          {
            "text": "        unknown: '未知',",
            "lineNumber": 202
          },
          {
            "text": "        other: '其他',",
            "lineNumber": 203
          },
          {
            "text": "        aiSection: 'AI 智能分析',",
            "lineNumber": 204
          },
          {
            "text": "        aiFaces: '检测到的人脸',",
            "lineNumber": 205
          },
          {
            "text": "        aiScene: '场景分类',",
            "lineNumber": 206
          },
          {
            "text": "        aiConfidence: '置信度',",
            "lineNumber": 207
          },
          {
            "text": "        aiObjects: '检测物体',",
            "lineNumber": 208
          },
          {
            "text": "        aiAutoTags: 'AI 标签',",
            "lineNumber": 209
          },
          {
            "text": "        aiExtractedText: '识别到的文字',",
            "lineNumber": 210
          },
          {
            "text": "        aiTranslatedText: '翻译结果',",
            "lineNumber": 211
          },
          {
            "text": "        bookDetails: '图书详情',",
            "lineNumber": 212
          },
          {
            "text": "        author: '作者',",
            "lineNumber": 213
          },
          {
            "text": "        bookmarks: '书签',",
            "lineNumber": 214
          },
          {
            "text": "        noBookmarks: '暂无书签',",
            "lineNumber": 215
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.3329232931137085
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n  zh: {\n    app: {\n      title: '极光图库',\n      desc: '专业图片管理',\n      viewing: '查看中',\n      folder: '文件夹',\n      filters: '个筛选条件',\n      maxTabsWarning: '最多允许 20 个标签页',\n      notImplemented: '此功能尚未实现'\n    },\n    welcome: {\n      title: '欢迎使用极光图库',\n      step1Title: '设置您的图库',\n      step1Desc: '请选择一个文件夹作为您的资源根目录，我们将为您建立索引。',\n      step2Title: '个性化设置',\n      step2Desc: '根据您的喜好定制体验。',\n      selectFolder: '选择文件夹',\n      currentPath: '当前选择',\n      next: '下一步',\n      skip: '跳过',\n      finish: '开始使用',\n      aiDesc: '启用 AI 智能分析以自动标记图片和识别人脸。',\n    },\n    sidebar: {\n      catalog: '资源目录',\n      localSupport: '本地磁盘 &amp; 局域网支持',\n      people: '人物',\n      allTags: '所有标签',\n      tagPreview: '标签',\n      noTagsFound: '未找到标签',\n      noPeople: '暂无人物',\n      tagHelp: 'Ctrl+点击多选 • Shift+点击范围选择',\n      rightClickToAdd: '右键点击添加标签',\n      recent: '最近',\n      ipCopied: 'IP地址已复制',\n      user: '用户',\n      settings: '设置',\n      nas: 'NAS 存储',\n      nasDisconnected: '未连接',\n      nasConnected: '已连接',\n      tasks: '后台任务'\n    },\n    context: {\n      viewInExplorer: '在系统文件管理器中查看',\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "text": "  zh: {",
            "lineNumber": 3
          },
          {
            "text": "    app: {",
            "lineNumber": 4
          },
          {
            "text": "      title: '极光图库',",
            "lineNumber": 5
          },
          {
            "text": "      desc: '专业图片管理',",
            "lineNumber": 6
          },
          {
            "text": "      viewing: '查看中',",
            "lineNumber": 7
          },
          {
            "text": "      folder: '文件夹',",
            "lineNumber": 8
          },
          {
            "text": "      filters: '个筛选条件',",
            "lineNumber": 9
          },
          {
            "text": "      maxTabsWarning: '最多允许 20 个标签页',",
            "lineNumber": 10
          },
          {
            "text": "      notImplemented: '此功能尚未实现'",
            "lineNumber": 11
          },
          {
            "text": "    },",
            "lineNumber": 12
          },
          {
            "text": "    welcome: {",
            "lineNumber": 13
          },
          {
            "text": "      title: '欢迎使用极光图库',",
            "lineNumber": 14
          },
          {
            "text": "      step1Title: '设置您的图库',",
            "lineNumber": 15
          },
          {
            "text": "      step1Desc: '请选择一个文件夹作为您的资源根目录，我们将为您建立索引。',",
            "lineNumber": 16
          },
          {
            "text": "      step2Title: '个性化设置',",
            "lineNumber": 17
          },
          {
            "text": "      step2Desc: '根据您的喜好定制体验。',",
            "lineNumber": 18
          },
          {
            "text": "      selectFolder: '选择文件夹',",
            "lineNumber": 19
          },
          {
            "text": "      currentPath: '当前选择',",
            "lineNumber": 20
          },
          {
            "text": "      next: '下一步',",
            "lineNumber": 21
          },
          {
            "text": "      skip: '跳过',",
            "lineNumber": 22
          },
          {
            "text": "      finish: '开始使用',",
            "lineNumber": 23
          },
          {
            "text": "      aiDesc: '启用 AI 智能分析以自动标记图片和识别人脸。',",
            "lineNumber": 24
          },
          {
            "text": "    },",
            "lineNumber": 25
          },
          {
            "text": "    sidebar: {",
            "lineNumber": 26
          },
          {
            "text": "      catalog: '资源目录',",
            "lineNumber": 27
          },
          {
            "text": "      localSupport: '本地磁盘 &amp; 局域网支持',",
            "lineNumber": 28
          },
          {
            "text": "      people: '人物',",
            "lineNumber": 29
          },
          {
            "text": "      allTags: '所有标签',",
            "lineNumber": 30
          },
          {
            "text": "      tagPreview: '标签',",
            "lineNumber": 31
          },
          {
            "text": "      noTagsFound: '未找到标签',",
            "lineNumber": 32
          },
          {
            "text": "      noPeople: '暂无人物',",
            "lineNumber": 33
          },
          {
            "text": "      tagHelp: 'Ctrl+点击多选 • Shift+点击范围选择',",
            "lineNumber": 34
          },
          {
            "text": "      rightClickToAdd: '右键点击添加标签',",
            "lineNumber": 35
          },
          {
            "text": "      recent: '最近',",
            "lineNumber": 36
          },
          {
            "text": "      ipCopied: 'IP地址已复制',",
            "lineNumber": 37
          },
          {
            "text": "      user: '用户',",
            "lineNumber": 38
          },
          {
            "text": "      settings: '设置',",
            "lineNumber": 39
          },
          {
            "text": "      nas: 'NAS 存储',",
            "lineNumber": 40
          },
          {
            "text": "      nasDisconnected: '未连接',",
            "lineNumber": 41
          },
          {
            "text": "      nasConnected: '已连接',",
            "lineNumber": 42
          },
          {
            "text": "      tasks: '后台任务'",
            "lineNumber": 43
          },
          {
            "text": "    },",
            "lineNumber": 44
          },
          {
            "text": "    context: {",
            "lineNumber": 45
          },
          {
            "text": "      viewInExplorer: '在系统文件管理器中查看',",
            "lineNumber": 46
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.3283925950527191
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n {\n      title: '分组方式',\n      none: '无',\n      type: '类型',\n      date: '日期',\n      size: '大小',\n      folder: '文件夹',\n      small: '小 (&lt; 1MB)',\n      medium: '中 (1-10MB)',\n      large: '大 (&gt; 10MB)'\n    },\n    folderSettings: {\n      remember: '记住此文件夹',\n      saved: '已保存此文件夹的设置'\n    },\n    layout: {\n      mode: '布局方式',\n      grid: '网格视图',\n      adaptive: '自适应视图',\n      list: '列表视图',\n      masonry: '瀑布流视图',\n      small: '小',\n      large: '大'\n    },\n    date: {\n      calendar: '日期筛选',\n      startDate: '开始日期',\n      endDate: '结束日期',\n      filterBy: '筛选依据',\n      createdDate: '创建时间',\n      updatedDate: '更新时间',\n      clearFilter: '清除筛选',\n      to: '至'\n    }\n  },\n  en: {\n    app: {\n      title: 'Aurora Gallery',\n      desc: 'Pro Asset Manager',\n      viewing: 'Viewing',\n      folder: 'Folder',\n      filters: 'Filters',\n      maxTabsWarning: 'Maximum 20 tabs allowed',\n      notImplemented: 'Function not implemented'\n    },\n    welcome: {\n      title: 'Welcome to Aurora Gallery',\n      step1Title: 'Setup Library',\n      step1Desc: 'Please select a root folder to manage your photos.',\n      step2Title: 'Personalize',\n      step2Desc: 'Customize your experience.',\n      selectFolder: 'Select Folder',\n      currentPath: 'Selected Path',\n      next: 'Next',\n      skip: 'Skip',\n      finish: 'Start Using',\n      aiDesc:\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "text": " {",
            "lineNumber": 440
          },
          {
            "text": "      title: '分组方式',",
            "lineNumber": 441
          },
          {
            "text": "      none: '无',",
            "lineNumber": 442
          },
          {
            "text": "      type: '类型',",
            "lineNumber": 443
          },
          {
            "text": "      date: '日期',",
            "lineNumber": 444
          },
          {
            "text": "      size: '大小',",
            "lineNumber": 445
          },
          {
            "text": "      folder: '文件夹',",
            "lineNumber": 446
          },
          {
            "text": "      small: '小 (&lt; 1MB)',",
            "lineNumber": 447
          },
          {
            "text": "      medium: '中 (1-10MB)',",
            "lineNumber": 448
          },
          {
            "text": "      large: '大 (&gt; 10MB)'",
            "lineNumber": 449
          },
          {
            "text": "    },",
            "lineNumber": 450
          },
          {
            "text": "    folderSettings: {",
            "lineNumber": 451
          },
          {
            "text": "      remember: '记住此文件夹',",
            "lineNumber": 452
          },
          {
            "text": "      saved: '已保存此文件夹的设置'",
            "lineNumber": 453
          },
          {
            "text": "    },",
            "lineNumber": 454
          },
          {
            "text": "    layout: {",
            "lineNumber": 455
          },
          {
            "text": "      mode: '布局方式',",
            "lineNumber": 456
          },
          {
            "text": "      grid: '网格视图',",
            "lineNumber": 457
          },
          {
            "text": "      adaptive: '自适应视图',",
            "lineNumber": 458
          },
          {
            "text": "      list: '列表视图',",
            "lineNumber": 459
          },
          {
            "text": "      masonry: '瀑布流视图',",
            "lineNumber": 460
          },
          {
            "text": "      small: '小',",
            "lineNumber": 461
          },
          {
            "text": "      large: '大'",
            "lineNumber": 462
          },
          {
            "text": "    },",
            "lineNumber": 463
          },
          {
            "text": "    date: {",
            "lineNumber": 464
          },
          {
            "text": "      calendar: '日期筛选',",
            "lineNumber": 465
          },
          {
            "text": "      startDate: '开始日期',",
            "lineNumber": 466
          },
          {
            "text": "      endDate: '结束日期',",
            "lineNumber": 467
          },
          {
            "text": "      filterBy: '筛选依据',",
            "lineNumber": 468
          },
          {
            "text": "      createdDate: '创建时间',",
            "lineNumber": 469
          },
          {
            "text": "      updatedDate: '更新时间',",
            "lineNumber": 470
          },
          {
            "text": "      clearFilter: '清除筛选',",
            "lineNumber": 471
          },
          {
            "text": "      to: '至'",
            "lineNumber": 472
          },
          {
            "text": "    }",
            "lineNumber": 473
          },
          {
            "text": "  },",
            "lineNumber": 474
          },
          {
            "text": "  en: {",
            "lineNumber": 475
          },
          {
            "text": "    app: {",
            "lineNumber": 476
          },
          {
            "text": "      title: 'Aurora Gallery',",
            "lineNumber": 477
          },
          {
            "text": "      desc: 'Pro Asset Manager',",
            "lineNumber": 478
          },
          {
            "text": "      viewing: 'Viewing',",
            "lineNumber": 479
          },
          {
            "text": "      folder: 'Folder',",
            "lineNumber": 480
          },
          {
            "text": "      filters: 'Filters',",
            "lineNumber": 481
          },
          {
            "text": "      maxTabsWarning: 'Maximum 20 tabs allowed',",
            "lineNumber": 482
          },
          {
            "text": "      notImplemented: 'Function not implemented'",
            "lineNumber": 483
          },
          {
            "text": "    },",
            "lineNumber": 484
          },
          {
            "text": "    welcome: {",
            "lineNumber": 485
          },
          {
            "text": "      title: 'Welcome to Aurora Gallery',",
            "lineNumber": 486
          },
          {
            "text": "      step1Title: 'Setup Library',",
            "lineNumber": 487
          },
          {
            "text": "      step1Desc: 'Please select a root folder to manage your photos.',",
            "lineNumber": 488
          },
          {
            "text": "      step2Title: 'Personalize',",
            "lineNumber": 489
          },
          {
            "text": "      step2Desc: 'Customize your experience.',",
            "lineNumber": 490
          },
          {
            "text": "      selectFolder: 'Select Folder',",
            "lineNumber": 491
          },
          {
            "text": "      currentPath: 'Selected Path',",
            "lineNumber": 492
          },
          {
            "text": "      next: 'Next',",
            "lineNumber": 493
          },
          {
            "text": "      skip: 'Skip',",
            "lineNumber": 494
          },
          {
            "text": "      finish: 'Start Using',",
            "lineNumber": 495
          },
          {
            "text": "      aiDesc:",
            "lineNumber": 496
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.3140507936477661
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n,\n      currentPath: 'Selected Path',\n      next: 'Next',\n      skip: 'Skip',\n      finish: 'Start Using',\n      aiDesc: 'Enable AI analysis for auto-tagging and face recognition.',\n    },\n    sidebar: {\n      catalog: 'CATALOG',\n      localSupport: 'Local Disk &amp; LAN Support',\n      people: 'PEOPLE',\n      allTags: 'ALL TAGS',\n      tagPreview: 'Tag',\n      noTagsFound: 'No tags found',\n      noPeople: 'No people yet',\n      tagHelp: 'Ctrl+Click to Toggle • Shift+Click to Select Range',\n      rightClickToAdd: 'Right-click to add tag',\n      recent: 'recent',\n      ipCopied: 'IP Address copied',\n      user: 'USER',\n      settings: 'Settings',\n      nas: 'NAS Storage',\n      nasDisconnected: 'Disconnected',\n      nasConnected: 'Connected',\n      tasks: 'Background Tasks'\n    },\n    context: {\n      viewInExplorer: 'View in File Explorer',\n      openFolder: 'Open File Location',\n      copyFile: 'Copy File',\n      copyImage: 'Copy Image',\n      copyPath: 'Copy File Path',\n      copyFolderPath: 'Copy Folder Path',\n      saveAs: 'Save As...',\n      addTag: 'Add Tag',\n      editTags: 'Edit Tags',\n      copyTag: 'Copy Tags',\n      pasteTag: 'Paste Tags',\n      generateThumbnails: 'Generate Thumbnails',\n      newTag: 'New Tag',\n      newTagDefault: 'New Tag',\n      enterTagName: 'Enter new tag name:',\n      renameTag: 'Rename Tag',\n      enterNewTagName: 'Enter new tag name',\n      newPerson: 'New Person',\n      newPersonDefault: 'New Person',\n      addToPerson: 'Add to Person...',\n      clearPersonInfo: 'Clear Person Info',\n      selectPerson: 'Select Person',\n      selectPeopleToClear: 'Select People to Clear',\n      selectNone: 'Select None',\n      renamePerson: 'Rename Person',\n      enterNewPersonName: 'Enter new person name',\n      deletePerson: 'Delete Person',\n      deletePersonConfirmTitle: 'Delete Person?',\n      deletePersonConfirmMsg: 'Deleting this person will remove all face association data, but will not delete the original images.\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "text": ",",
            "lineNumber": 491
          },
          {
            "text": "      currentPath: 'Selected Path',",
            "lineNumber": 492
          },
          {
            "text": "      next: 'Next',",
            "lineNumber": 493
          },
          {
            "text": "      skip: 'Skip',",
            "lineNumber": 494
          },
          {
            "text": "      finish: 'Start Using',",
            "lineNumber": 495
          },
          {
            "text": "      aiDesc: 'Enable AI analysis for auto-tagging and face recognition.',",
            "lineNumber": 496
          },
          {
            "text": "    },",
            "lineNumber": 497
          },
          {
            "text": "    sidebar: {",
            "lineNumber": 498
          },
          {
            "text": "      catalog: 'CATALOG',",
            "lineNumber": 499
          },
          {
            "text": "      localSupport: 'Local Disk &amp; LAN Support',",
            "lineNumber": 500
          },
          {
            "text": "      people: 'PEOPLE',",
            "lineNumber": 501
          },
          {
            "text": "      allTags: 'ALL TAGS',",
            "lineNumber": 502
          },
          {
            "text": "      tagPreview: 'Tag',",
            "lineNumber": 503
          },
          {
            "text": "      noTagsFound: 'No tags found',",
            "lineNumber": 504
          },
          {
            "text": "      noPeople: 'No people yet',",
            "lineNumber": 505
          },
          {
            "text": "      tagHelp: 'Ctrl+Click to Toggle • Shift+Click to Select Range',",
            "lineNumber": 506
          },
          {
            "text": "      rightClickToAdd: 'Right-click to add tag',",
            "lineNumber": 507
          },
          {
            "text": "      recent: 'recent',",
            "lineNumber": 508
          },
          {
            "text": "      ipCopied: 'IP Address copied',",
            "lineNumber": 509
          },
          {
            "text": "      user: 'USER',",
            "lineNumber": 510
          },
          {
            "text": "      settings: 'Settings',",
            "lineNumber": 511
          },
          {
            "text": "      nas: 'NAS Storage',",
            "lineNumber": 512
          },
          {
            "text": "      nasDisconnected: 'Disconnected',",
            "lineNumber": 513
          },
          {
            "text": "      nasConnected: 'Connected',",
            "lineNumber": 514
          },
          {
            "text": "      tasks: 'Background Tasks'",
            "lineNumber": 515
          },
          {
            "text": "    },",
            "lineNumber": 516
          },
          {
            "text": "    context: {",
            "lineNumber": 517
          },
          {
            "text": "      viewInExplorer: 'View in File Explorer',",
            "lineNumber": 518
          },
          {
            "text": "      openFolder: 'Open File Location',",
            "lineNumber": 519
          },
          {
            "text": "      copyFile: 'Copy File',",
            "lineNumber": 520
          },
          {
            "text": "      copyImage: 'Copy Image',",
            "lineNumber": 521
          },
          {
            "text": "      copyPath: 'Copy File Path',",
            "lineNumber": 522
          },
          {
            "text": "      copyFolderPath: 'Copy Folder Path',",
            "lineNumber": 523
          },
          {
            "text": "      saveAs: 'Save As...',",
            "lineNumber": 524
          },
          {
            "text": "      addTag: 'Add Tag',",
            "lineNumber": 525
          },
          {
            "text": "      editTags: 'Edit Tags',",
            "lineNumber": 526
          },
          {
            "text": "      copyTag: 'Copy Tags',",
            "lineNumber": 527
          },
          {
            "text": "      pasteTag: 'Paste Tags',",
            "lineNumber": 528
          },
          {
            "text": "      generateThumbnails: 'Generate Thumbnails',",
            "lineNumber": 529
          },
          {
            "text": "      newTag: 'New Tag',",
            "lineNumber": 530
          },
          {
            "text": "      newTagDefault: 'New Tag',",
            "lineNumber": 531
          },
          {
            "text": "      enterTagName: 'Enter new tag name:',",
            "lineNumber": 532
          },
          {
            "text": "      renameTag: 'Rename Tag',",
            "lineNumber": 533
          },
          {
            "text": "      enterNewTagName: 'Enter new tag name',",
            "lineNumber": 534
          },
          {
            "text": "      newPerson: 'New Person',",
            "lineNumber": 535
          },
          {
            "text": "      newPersonDefault: 'New Person',",
            "lineNumber": 536
          },
          {
            "text": "      addToPerson: 'Add to Person...',",
            "lineNumber": 537
          },
          {
            "text": "      clearPersonInfo: 'Clear Person Info',",
            "lineNumber": 538
          },
          {
            "text": "      selectPerson: 'Select Person',",
            "lineNumber": 539
          },
          {
            "text": "      selectPeopleToClear: 'Select People to Clear',",
            "lineNumber": 540
          },
          {
            "text": "      selectNone: 'Select None',",
            "lineNumber": 541
          },
          {
            "text": "      renamePerson: 'Rename Person',",
            "lineNumber": 542
          },
          {
            "text": "      enterNewPersonName: 'Enter new person name',",
            "lineNumber": 543
          },
          {
            "text": "      deletePerson: 'Delete Person',",
            "lineNumber": 544
          },
          {
            "text": "      deletePersonConfirmTitle: 'Delete Person?',",
            "lineNumber": 545
          },
          {
            "text": "      deletePersonConfirmMsg: 'Deleting this person will remove all face association data, but will not delete the original images.",
            "lineNumber": 546
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.31248754262924194
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n\n    context: {\n      viewInExplorer: '在系统文件管理器中查看',\n      openFolder: '打开所在文件',\n      copyFile: '复制文件',\n      copyImage: '复制图片',\n      copyPath: '复制文件路径',\n      copyFolderPath: '复制文件夹路径',\n      saveAs: '另存为...',\n      addTag: '添加标签',\n      editTags: '编辑标签',\n      copyTag: '复制标签',\n      pasteTag: '粘贴标签',\n      generateThumbnails: '生成缩略图',\n      newTag: '新建标签',\n      newTagDefault: '新标签',\n      enterTagName: '请输入新标签名称:',\n      renameTag: '重命名标签',\n      enterNewTagName: '请输入新的标签名称',\n      newPerson: '新建人物',\n      newPersonDefault: '新人物',\n      addToPerson: '添加到人物...',\n      clearPersonInfo: '清除人物信息',\n      selectPerson: '选择人物',\n      selectPeopleToClear: '选择要清除的人物',\n      selectNone: '取消全选',\n      renamePerson: '重命名人物',\n      enterNewPersonName: '请输入新的人物名称',\n      deletePerson: '删除人物',\n      deletePersonConfirmTitle: '删除人物？',\n      deletePersonConfirmMsg: '删除该人物将移除所有关联的人脸数据，但不会删除原始图片文件。',\n      allPeople: '所有人物',\n      setAvatar: '设置头像',\n      cropAvatar: '裁剪头像',\n      startSlideshow: '开始幻灯片',\n      stopSlideshow: '停止幻灯片',\n      slideshowSettings: '幻灯片设置',\n      fullscreen: '全屏显示',\n      exitFullscreen: '退出全屏',\n      rename: '重命名',\n      batchRename: '批量重命名',\n      delete: '删除',\n      copyTo: '复制到文件夹...',\n      copyToCurrentFolder: '复制到当前文件夹',\n      moveTo: '移动到文件夹...',\n      moveToCurrentFolder: '移动到当前文件夹',\n      viewTagged: '查看相关文件',\n      copyName: '复制名称',\n      deleteTag: '删除标签',\n      deleteTagConfirmTitle: '删除标签？',\n      deleteTagConfirmMsg: '删除该标签会清除所有已经使用了该标签的文件上的关联。\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "lineNumber": 44
          },
          {
            "text": "    context: {",
            "lineNumber": 45
          },
          {
            "text": "      viewInExplorer: '在系统文件管理器中查看',",
            "lineNumber": 46
          },
          {
            "text": "      openFolder: '打开所在文件',",
            "lineNumber": 47
          },
          {
            "text": "      copyFile: '复制文件',",
            "lineNumber": 48
          },
          {
            "text": "      copyImage: '复制图片',",
            "lineNumber": 49
          },
          {
            "text": "      copyPath: '复制文件路径',",
            "lineNumber": 50
          },
          {
            "text": "      copyFolderPath: '复制文件夹路径',",
            "lineNumber": 51
          },
          {
            "text": "      saveAs: '另存为...',",
            "lineNumber": 52
          },
          {
            "text": "      addTag: '添加标签',",
            "lineNumber": 53
          },
          {
            "text": "      editTags: '编辑标签',",
            "lineNumber": 54
          },
          {
            "text": "      copyTag: '复制标签',",
            "lineNumber": 55
          },
          {
            "text": "      pasteTag: '粘贴标签',",
            "lineNumber": 56
          },
          {
            "text": "      generateThumbnails: '生成缩略图',",
            "lineNumber": 57
          },
          {
            "text": "      newTag: '新建标签',",
            "lineNumber": 58
          },
          {
            "text": "      newTagDefault: '新标签',",
            "lineNumber": 59
          },
          {
            "text": "      enterTagName: '请输入新标签名称:',",
            "lineNumber": 60
          },
          {
            "text": "      renameTag: '重命名标签',",
            "lineNumber": 61
          },
          {
            "text": "      enterNewTagName: '请输入新的标签名称',",
            "lineNumber": 62
          },
          {
            "text": "      newPerson: '新建人物',",
            "lineNumber": 63
          },
          {
            "text": "      newPersonDefault: '新人物',",
            "lineNumber": 64
          },
          {
            "text": "      addToPerson: '添加到人物...',",
            "lineNumber": 65
          },
          {
            "text": "      clearPersonInfo: '清除人物信息',",
            "lineNumber": 66
          },
          {
            "text": "      selectPerson: '选择人物',",
            "lineNumber": 67
          },
          {
            "text": "      selectPeopleToClear: '选择要清除的人物',",
            "lineNumber": 68
          },
          {
            "text": "      selectNone: '取消全选',",
            "lineNumber": 69
          },
          {
            "text": "      renamePerson: '重命名人物',",
            "lineNumber": 70
          },
          {
            "text": "      enterNewPersonName: '请输入新的人物名称',",
            "lineNumber": 71
          },
          {
            "text": "      deletePerson: '删除人物',",
            "lineNumber": 72
          },
          {
            "text": "      deletePersonConfirmTitle: '删除人物？',",
            "lineNumber": 73
          },
          {
            "text": "      deletePersonConfirmMsg: '删除该人物将移除所有关联的人脸数据，但不会删除原始图片文件。',",
            "lineNumber": 74
          },
          {
            "text": "      allPeople: '所有人物',",
            "lineNumber": 75
          },
          {
            "text": "      setAvatar: '设置头像',",
            "lineNumber": 76
          },
          {
            "text": "      cropAvatar: '裁剪头像',",
            "lineNumber": 77
          },
          {
            "text": "      startSlideshow: '开始幻灯片',",
            "lineNumber": 78
          },
          {
            "text": "      stopSlideshow: '停止幻灯片',",
            "lineNumber": 79
          },
          {
            "text": "      slideshowSettings: '幻灯片设置',",
            "lineNumber": 80
          },
          {
            "text": "      fullscreen: '全屏显示',",
            "lineNumber": 81
          },
          {
            "text": "      exitFullscreen: '退出全屏',",
            "lineNumber": 82
          },
          {
            "text": "      rename: '重命名',",
            "lineNumber": 83
          },
          {
            "text": "      batchRename: '批量重命名',",
            "lineNumber": 84
          },
          {
            "text": "      delete: '删除',",
            "lineNumber": 85
          },
          {
            "text": "      copyTo: '复制到文件夹...',",
            "lineNumber": 86
          },
          {
            "text": "      copyToCurrentFolder: '复制到当前文件夹',",
            "lineNumber": 87
          },
          {
            "text": "      moveTo: '移动到文件夹...',",
            "lineNumber": 88
          },
          {
            "text": "      moveToCurrentFolder: '移动到当前文件夹',",
            "lineNumber": 89
          },
          {
            "text": "      viewTagged: '查看相关文件',",
            "lineNumber": 90
          },
          {
            "text": "      copyName: '复制名称',",
            "lineNumber": 91
          },
          {
            "text": "      deleteTag: '删除标签',",
            "lineNumber": 92
          },
          {
            "text": "      deleteTagConfirmTitle: '删除标签？',",
            "lineNumber": 93
          },
          {
            "text": "      deleteTagConfirmMsg: '删除该标签会清除所有已经使用了该标签的文件上的关联。",
            "lineNumber": 94
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.3052169978618622
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 43
          },
          "endPosition": {
            "line": 195,
            "column": 1
          }
        },
        "contents": "const TagsWidget = \nconst suggestedTags = \n [allTags, localSearchQuery, isFocused]);\n  \n  const keys = Object.keys(filteredGroupedTags).sort();\n  const totalTags = Object.values(filteredGroupedTags).reduce((acc, curr) =&gt; acc + curr.length, 0);\n\n  return (\n    &lt;div className=\"flex flex-col select-none bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-2xl overflow-hidden w-80 max-h-[400px] font-sans border border-gray-200 dark:border-gray-700 z-50\"&gt;\n      &lt;div className=\"px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\"&gt;\n        &lt;div className=\"flex items-center justify-between mb-3\"&gt;\n          &lt;span className=\"font-bold text-sm tracking-wide\"&gt;{t('sidebar.allTags')}&lt;/span&gt;\n          &lt;span className=\"text-xs text-gray-500 dark:text-gray-400 bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded-full\"&gt;\n            {totalTags}\n          &lt;/span&gt;\n        &lt;/div&gt;\n        &lt;div className=\"relative\"&gt;\n          &lt;Search size={14} className=\"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400\" /&gt;\n          &lt;input\n            type=\"text\"\n            id=\"tag-search-input\"\n            name=\"tag-search-input\"\n            placeholder={t('search.placeholder')}\n            value={localSearchQuery}\n            onChange={(e) =&gt; {\n              setLocalSearchQuery(e.target.value);\n              onSetTagSearchQuery(e.target.value);\n            }}\n            onFocus={() =&gt; setIsFocused(true)}\n            onBlur={() =&gt; {\n              // 延迟关闭，以便点击建议项时能触发点击事件\n              setTimeout(() =&gt; setIsFocused(false), 200);\n            }}\n            className=\"w-full pl-8 pr-2 py-1.5 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          /&gt;\n          {localSearchQuery &amp;&amp;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 42,
                "column": 1
              },
              "endPosition": {
                "line": 42,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 42,
                "column": 7
              },
              "endPosition": {
                "line": 42,
                "column": 20
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsWidget = ",
            "lineNumber": 44
          },
          {
            "text": "const suggestedTags = ",
            "lineNumber": 79
          },
          {
            "text": " [allTags, localSearchQuery, isFocused]);",
            "lineNumber": 85
          },
          {
            "text": "  ",
            "lineNumber": 86
          },
          {
            "text": "  const keys = Object.keys(filteredGroupedTags).sort();",
            "lineNumber": 87
          },
          {
            "text": "  const totalTags = Object.values(filteredGroupedTags).reduce((acc, curr) =&gt; acc + curr.length, 0);",
            "lineNumber": 88
          },
          {
            "lineNumber": 89
          },
          {
            "text": "  return (",
            "lineNumber": 90
          },
          {
            "text": "    &lt;div className=\"flex flex-col select-none bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-2xl overflow-hidden w-80 max-h-[400px] font-sans border border-gray-200 dark:border-gray-700 z-50\"&gt;",
            "lineNumber": 91
          },
          {
            "text": "      &lt;div className=\"px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\"&gt;",
            "lineNumber": 92
          },
          {
            "text": "        &lt;div className=\"flex items-center justify-between mb-3\"&gt;",
            "lineNumber": 93
          },
          {
            "text": "          &lt;span className=\"font-bold text-sm tracking-wide\"&gt;{t('sidebar.allTags')}&lt;/span&gt;",
            "lineNumber": 94
          },
          {
            "text": "          &lt;span className=\"text-xs text-gray-500 dark:text-gray-400 bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded-full\"&gt;",
            "lineNumber": 95
          },
          {
            "text": "            {totalTags}",
            "lineNumber": 96
          },
          {
            "text": "          &lt;/span&gt;",
            "lineNumber": 97
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 98
          },
          {
            "text": "        &lt;div className=\"relative\"&gt;",
            "lineNumber": 99
          },
          {
            "text": "          &lt;Search size={14} className=\"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400\" /&gt;",
            "lineNumber": 100
          },
          {
            "text": "          &lt;input",
            "lineNumber": 101
          },
          {
            "text": "            type=\"text\"",
            "lineNumber": 102
          },
          {
            "text": "            id=\"tag-search-input\"",
            "lineNumber": 103
          },
          {
            "text": "            name=\"tag-search-input\"",
            "lineNumber": 104
          },
          {
            "text": "            placeholder={t('search.placeholder')}",
            "lineNumber": 105
          },
          {
            "text": "            value={localSearchQuery}",
            "lineNumber": 106
          },
          {
            "text": "            onChange={(e) =&gt; {",
            "lineNumber": 107
          },
          {
            "text": "              setLocalSearchQuery(e.target.value);",
            "lineNumber": 108
          },
          {
            "text": "              onSetTagSearchQuery(e.target.value);",
            "lineNumber": 109
          },
          {
            "text": "            }}",
            "lineNumber": 110
          },
          {
            "text": "            onFocus={() =&gt; setIsFocused(true)}",
            "lineNumber": 111
          },
          {
            "text": "            onBlur={() =&gt; {",
            "lineNumber": 112
          },
          {
            "text": "              // 延迟关闭，以便点击建议项时能触发点击事件",
            "lineNumber": 113
          },
          {
            "text": "              setTimeout(() =&gt; setIsFocused(false), 200);",
            "lineNumber": 114
          },
          {
            "text": "            }}",
            "lineNumber": 115
          },
          {
            "text": "            className=\"w-full pl-8 pr-2 py-1.5 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"",
            "lineNumber": 116
          },
          {
            "text": "          /&gt;",
            "lineNumber": 117
          },
          {
            "text": "          {localSearchQuery &amp;&amp;",
            "lineNumber": 118
          },
          {
            "text": ";",
            "lineNumber": 196
          }
        ]
      },
      "score": 0.30213356018066406
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nprev =&gt; (\n\n                      }));\n                  }\n              }\n          }\n          \n          showToast(t('settings.aiAnalyzeSuccess'));\n\n      } catch (err) {\n          console.error(err);\n          showToast(\"AI Analysis Failed\");\n      } finally {\n          updateTask(taskId, { status: 'completed', currentStep: t('tasks.completed') });\n          setTimeout(() =&gt; setState(prev =&gt; ({ ...prev, tasks: prev.tasks.filter(t =&gt; t.id !== taskId) })), 1000);\n      }\n  };\n  \n  // Function to analyze all files in a folder\n  const handleFolderAIAnalysis = async (folderId: string) =&gt; {\n      // Get all image files in the folder and check their AI analysis status\n      const getAllImageFilesInFolder = (folderId: string): { id: string; analyzed: boolean }[] =&gt; {\n          const folder = state.files[folderId];\n          if (!folder) return [];\n          \n          let imageFiles: { id: string; analyzed: boolean }[] = [];\n          \n          if (folder.children) {\n              for (const childId of folder.children) {\n                  const child = state.files[childId];\n                  if (child) {\n                      if (child.type === FileType.FOLDER) {\n                          // Recursively get files from subfolders\n                          imageFiles\n;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3599
          },
          {
            "text": "prev =&gt; (",
            "lineNumber": 4369
          },
          {
            "lineNumber": 4377
          },
          {
            "text": "                      }));",
            "lineNumber": 4378
          },
          {
            "text": "                  }",
            "lineNumber": 4379
          },
          {
            "text": "              }",
            "lineNumber": 4380
          },
          {
            "text": "          }",
            "lineNumber": 4381
          },
          {
            "text": "          ",
            "lineNumber": 4382
          },
          {
            "text": "          showToast(t('settings.aiAnalyzeSuccess'));",
            "lineNumber": 4383
          },
          {
            "lineNumber": 4384
          },
          {
            "text": "      } catch (err) {",
            "lineNumber": 4385
          },
          {
            "text": "          console.error(err);",
            "lineNumber": 4386
          },
          {
            "text": "          showToast(\"AI Analysis Failed\");",
            "lineNumber": 4387
          },
          {
            "text": "      } finally {",
            "lineNumber": 4388
          },
          {
            "text": "          updateTask(taskId, { status: 'completed', currentStep: t('tasks.completed') });",
            "lineNumber": 4389
          },
          {
            "text": "          setTimeout(() =&gt; setState(prev =&gt; ({ ...prev, tasks: prev.tasks.filter(t =&gt; t.id !== taskId) })), 1000);",
            "lineNumber": 4390
          },
          {
            "text": "      }",
            "lineNumber": 4391
          },
          {
            "text": "  };",
            "lineNumber": 4392
          },
          {
            "text": "  ",
            "lineNumber": 4393
          },
          {
            "text": "  // Function to analyze all files in a folder",
            "lineNumber": 4394
          },
          {
            "text": "  const handleFolderAIAnalysis = async (folderId: string) =&gt; {",
            "lineNumber": 4395
          },
          {
            "text": "      // Get all image files in the folder and check their AI analysis status",
            "lineNumber": 4396
          },
          {
            "text": "      const getAllImageFilesInFolder = (folderId: string): { id: string; analyzed: boolean }[] =&gt; {",
            "lineNumber": 4397
          },
          {
            "text": "          const folder = state.files[folderId];",
            "lineNumber": 4398
          },
          {
            "text": "          if (!folder) return [];",
            "lineNumber": 4399
          },
          {
            "text": "          ",
            "lineNumber": 4400
          },
          {
            "text": "          let imageFiles: { id: string; analyzed: boolean }[] = [];",
            "lineNumber": 4401
          },
          {
            "text": "          ",
            "lineNumber": 4402
          },
          {
            "text": "          if (folder.children) {",
            "lineNumber": 4403
          },
          {
            "text": "              for (const childId of folder.children) {",
            "lineNumber": 4404
          },
          {
            "text": "                  const child = state.files[childId];",
            "lineNumber": 4405
          },
          {
            "text": "                  if (child) {",
            "lineNumber": 4406
          },
          {
            "text": "                      if (child.type === FileType.FOLDER) {",
            "lineNumber": 4407
          },
          {
            "text": "                          // Recursively get files from subfolders",
            "lineNumber": 4408
          },
          {
            "text": "                          imageFiles",
            "lineNumber": 4409
          },
          {
            "text": ";",
            "lineNumber": 4420
          },
          {
            "text": ";",
            "lineNumber": 4441
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.29135680198669434
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleRefresh = async \nprev =&gt; {\n\n                  // Add a lastRefresh timestamp to force a re-render\n                  lastRefresh: Date.now()\n              };\n              \n              return { ...prev, files };\n          });\n      }\n  };\n\n  // ... (keep drag and drop, clicks, etc.)\n  // Drag over handler for the main container\n  const handleDragOver = (e: React.DragEvent) =&gt; {\n      e.preventDefault();\n      // 避免在此处使用 e.stopPropagation()，因为这会阻止事件流向子组件，导致子组件的拖拽逻辑失效 (如文件夹高亮)。\n\n      // Only show overlay for file browser view mode\n      if (activeTab.viewMode !== 'browser') {\n          if (isDragOver) {\n              setIsDragOver(false);\n          }\n          return;\n      }\n\n      // 1. 【内部拖拽检查】: 如果是内部拖拽，强制保持外部界面隐藏\n      if (isInternalDragRef.current) {\n          // 关键：如果状态已经是 isDragOver=true，则立即关闭它，防止闪烁\n          if (isDragOver) {\n              setIsDragOver(false);\n          }\n          // 允许事件向下传递，但不再执行下面的外部拖拽检测逻辑\n          return;\n      }\n\n      // 2. 【外部拖拽检查】: 检查是否有 Files 类型\n      if (e.dataTransfer.types.includes('Files')) {\n          // 关键：只有状态是 false 时才设置为 true，减少不必要的 state 更新\n          if (!isDragOver) {\n              setIsDragOver(true);\n          }\n          \n          // 计算复制/移动动作的逻辑\n          const container = e.currentTarget as HTMLElement;\n          const rect = container.getBoundingClientRect();\n          const x = e.clientX - rect.left;\n          if (x &lt; rect.width / 2) setDragAction('copy');\n          else setDragAction('move');\n          \n      } else {\n          // 如果拖拽的内容不是文件 (例如：拖拽文本或URL)\n          // 关键：只有状态是 true 时才设置为 false\n          if (isDragOver) {\n              setIsDragOver(false);\n          }\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 3
              },
              "endPosition": {
                "line": 1305,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 9
              },
              "endPosition": {
                "line": 1305,
                "column": 26
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 34
              },
              "endPosition": {
                "line": 1306,
                "column": 5
              }
            },
            {
              "startPosition": {
                "line": 1412,
                "column": 22
              },
              "endPosition": {
                "line": 1412,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 1412,
                "column": 40
              },
              "endPosition": {
                "line": 1413,
                "column": 13
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleRefresh = async ",
            "lineNumber": 1346
          },
          {
            "text": "prev =&gt; {",
            "lineNumber": 1409
          },
          {
            "lineNumber": 1413
          },
          {
            "text": "                  // Add a lastRefresh timestamp to force a re-render",
            "lineNumber": 1414
          },
          {
            "text": "                  lastRefresh: Date.now()",
            "lineNumber": 1415
          },
          {
            "text": "              };",
            "lineNumber": 1416
          },
          {
            "text": "              ",
            "lineNumber": 1417
          },
          {
            "text": "              return { ...prev, files };",
            "lineNumber": 1418
          },
          {
            "text": "          });",
            "lineNumber": 1419
          },
          {
            "text": "      }",
            "lineNumber": 1420
          },
          {
            "text": "  };",
            "lineNumber": 1421
          },
          {
            "lineNumber": 1422
          },
          {
            "text": "  // ... (keep drag and drop, clicks, etc.)",
            "lineNumber": 1423
          },
          {
            "text": "  // Drag over handler for the main container",
            "lineNumber": 1424
          },
          {
            "text": "  const handleDragOver = (e: React.DragEvent) =&gt; {",
            "lineNumber": 1425
          },
          {
            "text": "      e.preventDefault();",
            "lineNumber": 1426
          },
          {
            "text": "      // 避免在此处使用 e.stopPropagation()，因为这会阻止事件流向子组件，导致子组件的拖拽逻辑失效 (如文件夹高亮)。",
            "lineNumber": 1427
          },
          {
            "lineNumber": 1428
          },
          {
            "text": "      // Only show overlay for file browser view mode",
            "lineNumber": 1429
          },
          {
            "text": "      if (activeTab.viewMode !== 'browser') {",
            "lineNumber": 1430
          },
          {
            "text": "          if (isDragOver) {",
            "lineNumber": 1431
          },
          {
            "text": "              setIsDragOver(false);",
            "lineNumber": 1432
          },
          {
            "text": "          }",
            "lineNumber": 1433
          },
          {
            "text": "          return;",
            "lineNumber": 1434
          },
          {
            "text": "      }",
            "lineNumber": 1435
          },
          {
            "lineNumber": 1436
          },
          {
            "text": "      // 1. 【内部拖拽检查】: 如果是内部拖拽，强制保持外部界面隐藏",
            "lineNumber": 1437
          },
          {
            "text": "      if (isInternalDragRef.current) {",
            "lineNumber": 1438
          },
          {
            "text": "          // 关键：如果状态已经是 isDragOver=true，则立即关闭它，防止闪烁",
            "lineNumber": 1439
          },
          {
            "text": "          if (isDragOver) {",
            "lineNumber": 1440
          },
          {
            "text": "              setIsDragOver(false);",
            "lineNumber": 1441
          },
          {
            "text": "          }",
            "lineNumber": 1442
          },
          {
            "text": "          // 允许事件向下传递，但不再执行下面的外部拖拽检测逻辑",
            "lineNumber": 1443
          },
          {
            "text": "          return;",
            "lineNumber": 1444
          },
          {
            "text": "      }",
            "lineNumber": 1445
          },
          {
            "lineNumber": 1446
          },
          {
            "text": "      // 2. 【外部拖拽检查】: 检查是否有 Files 类型",
            "lineNumber": 1447
          },
          {
            "text": "      if (e.dataTransfer.types.includes('Files')) {",
            "lineNumber": 1448
          },
          {
            "text": "          // 关键：只有状态是 false 时才设置为 true，减少不必要的 state 更新",
            "lineNumber": 1449
          },
          {
            "text": "          if (!isDragOver) {",
            "lineNumber": 1450
          },
          {
            "text": "              setIsDragOver(true);",
            "lineNumber": 1451
          },
          {
            "text": "          }",
            "lineNumber": 1452
          },
          {
            "text": "          ",
            "lineNumber": 1453
          },
          {
            "text": "          // 计算复制/移动动作的逻辑",
            "lineNumber": 1454
          },
          {
            "text": "          const container = e.currentTarget as HTMLElement;",
            "lineNumber": 1455
          },
          {
            "text": "          const rect = container.getBoundingClientRect();",
            "lineNumber": 1456
          },
          {
            "text": "          const x = e.clientX - rect.left;",
            "lineNumber": 1457
          },
          {
            "text": "          if (x &lt; rect.width / 2) setDragAction('copy');",
            "lineNumber": 1458
          },
          {
            "text": "          else setDragAction('move');",
            "lineNumber": 1459
          },
          {
            "text": "          ",
            "lineNumber": 1460
          },
          {
            "text": "      } else {",
            "lineNumber": 1461
          },
          {
            "text": "          // 如果拖拽的内容不是文件 (例如：拖拽文本或URL)",
            "lineNumber": 1462
          },
          {
            "text": "          // 关键：只有状态是 true 时才设置为 false",
            "lineNumber": 1463
          },
          {
            "text": "          if (isDragOver) {",
            "lineNumber": 1464
          },
          {
            "text": "              setIsDragOver(false);",
            "lineNumber": 1465
          },
          {
            "text": "          }",
            "lineNumber": 1466
          },
          {
            "text": ";",
            "lineNumber": 1468
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.28050923347473145
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n\n      loaded: '已读取'\n    },\n    tasks: {\n      title: '任务进度',\n      minimizing: '最小化',\n      processing: '正在处理',\n      rate: '速率',\n      filesPerSec: '个/秒',\n      aiAnalysis: 'AI 智能分析',\n      copying: '正在复制',\n      moving: '正在移动',\n      complete: '完成',\n      minimizeHint: '任务已最小化至侧边栏',\n      summarizing: '正在汇总描述...',\n      folderSummaryComplete: '文件夹分析汇总完成',\n      sendingRequest: '正在发送请求到',\n      aiResponse: '已接收 AI 响应',\n      readingFile: '正在读取文件...',\n      aiAnalyzing: '正在进行 AI 分析...',\n      processingResult: '正在处理 AI 结果...',\n      updatingDescription: '正在更新描述...',\n      addingTags: '正在添加标签...',\n      savingData: '正在保存数据...',\n      completed: '已完成',\n      generatingThumbnails: '正在生成缩略图...',\n      thumbnailsGenerated: '缩略图生成完成',\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "lineNumber": 130
          },
          {
            "text": "      loaded: '已读取'",
            "lineNumber": 131
          },
          {
            "text": "    },",
            "lineNumber": 132
          },
          {
            "text": "    tasks: {",
            "lineNumber": 133
          },
          {
            "text": "      title: '任务进度',",
            "lineNumber": 134
          },
          {
            "text": "      minimizing: '最小化',",
            "lineNumber": 135
          },
          {
            "text": "      processing: '正在处理',",
            "lineNumber": 136
          },
          {
            "text": "      rate: '速率',",
            "lineNumber": 137
          },
          {
            "text": "      filesPerSec: '个/秒',",
            "lineNumber": 138
          },
          {
            "text": "      aiAnalysis: 'AI 智能分析',",
            "lineNumber": 139
          },
          {
            "text": "      copying: '正在复制',",
            "lineNumber": 140
          },
          {
            "text": "      moving: '正在移动',",
            "lineNumber": 141
          },
          {
            "text": "      complete: '完成',",
            "lineNumber": 142
          },
          {
            "text": "      minimizeHint: '任务已最小化至侧边栏',",
            "lineNumber": 143
          },
          {
            "text": "      summarizing: '正在汇总描述...',",
            "lineNumber": 144
          },
          {
            "text": "      folderSummaryComplete: '文件夹分析汇总完成',",
            "lineNumber": 145
          },
          {
            "text": "      sendingRequest: '正在发送请求到',",
            "lineNumber": 146
          },
          {
            "text": "      aiResponse: '已接收 AI 响应',",
            "lineNumber": 147
          },
          {
            "text": "      readingFile: '正在读取文件...',",
            "lineNumber": 148
          },
          {
            "text": "      aiAnalyzing: '正在进行 AI 分析...',",
            "lineNumber": 149
          },
          {
            "text": "      processingResult: '正在处理 AI 结果...',",
            "lineNumber": 150
          },
          {
            "text": "      updatingDescription: '正在更新描述...',",
            "lineNumber": 151
          },
          {
            "text": "      addingTags: '正在添加标签...',",
            "lineNumber": 152
          },
          {
            "text": "      savingData: '正在保存数据...',",
            "lineNumber": 153
          },
          {
            "text": "      completed: '已完成',",
            "lineNumber": 154
          },
          {
            "text": "      generatingThumbnails: '正在生成缩略图...',",
            "lineNumber": 155
          },
          {
            "text": "      thumbnailsGenerated: '缩略图生成完成',",
            "lineNumber": 156
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.2754404544830322
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n\n      nasScan: 'Scan LAN',\n      nasScanFound: 'Devices Found',\n      nasUser: 'Username',\n      nasPass: 'Password',\n      nasConnecting: 'Connecting...',\n      nasSuccess: 'Connected',\n      nasError: 'Connection Failed',\n      networkErrorTitle: 'Connection Failed',\n      networkErrorReasons: 'Could not connect to LAN server. Reasons might include:',\n      networkErrorReason1: 'Incorrect IP address or server not running',\n      networkErrorReason2: 'Firewall blocking port (8080)',\n      networkErrorReason3: 'Devices not on the same subnet',\n      networkErrorReason4: 'Invalid access code',\n      aiProvider: 'AI Model Engine',\n      aiProviderLocal: 'Local Model (Ollama)',\n      aiProviderOnline: 'Cloud API (Online)',\n      aiProviderLmStudio: 'LM Studio (Local)',\n      aiModelVision: 'Model (Vision Capable)',\n      aiModel: 'Model',\n      aiModelOptional: 'Model (Optional)',\n      lmStudioVersionHint: 'Ensure to include /v1 at the end',\n      lmStudioEndpoint: 'API Endpoint',\n      lmStudioSetupGuide: 'How to use LM Studio?',\n      lmStudioStep1: 'Download and install from lmstudio.ai.',\n      lmStudioStep2: 'Search and download a Vision-capable model (search \"Vision\" or \"Llava\").',\n      lmStudioStep3: 'Click the \"Local Server\" icon (arrows) on the left sidebar.',\n      lmStudioStep4: 'Select the model at the top and click \"Start Server\".',\n      ollamaSetupGuide: 'How to use Ollama?',\n      ollamaStep1: 'Download from ollama.com.',\n      ollamaStep2: 'Run &#96;ollama run llava&#96; in terminal.',\n      ollamaStep3: 'Ensure server is running on port 11434.',\n      onlineSetupGuide: 'How to use Online API?',\n      onlineStep1: 'Get an API Key from OpenAI or compatible provider.',\n      onlineStep2: 'Enter API Endpoint (e.g. https://api.openai.com/v1).',\n      onlineStep3: 'Paste your API Key.',\n      aiAutoTag: 'Auto-add AI tags',\n      aiAutoDescription: 'Auto-add AI description',\n      aiEnhancePersonDesc: 'Enhance Person Description (Focus on actions)',\n      aiFaceRec: 'Enable Face Recognition',\n      aiAutoAddPeople: 'Auto-add identified people',      \n      aiEnableOCR: 'Enable Text Recognition (OCR)',\n      aiEnableTranslation: 'Enable Translation',\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "lineNumber": 794
          },
          {
            "text": "      nasScan: 'Scan LAN',",
            "lineNumber": 795
          },
          {
            "text": "      nasScanFound: 'Devices Found',",
            "lineNumber": 796
          },
          {
            "text": "      nasUser: 'Username',",
            "lineNumber": 797
          },
          {
            "text": "      nasPass: 'Password',",
            "lineNumber": 798
          },
          {
            "text": "      nasConnecting: 'Connecting...',",
            "lineNumber": 799
          },
          {
            "text": "      nasSuccess: 'Connected',",
            "lineNumber": 800
          },
          {
            "text": "      nasError: 'Connection Failed',",
            "lineNumber": 801
          },
          {
            "text": "      networkErrorTitle: 'Connection Failed',",
            "lineNumber": 802
          },
          {
            "text": "      networkErrorReasons: 'Could not connect to LAN server. Reasons might include:',",
            "lineNumber": 803
          },
          {
            "text": "      networkErrorReason1: 'Incorrect IP address or server not running',",
            "lineNumber": 804
          },
          {
            "text": "      networkErrorReason2: 'Firewall blocking port (8080)',",
            "lineNumber": 805
          },
          {
            "text": "      networkErrorReason3: 'Devices not on the same subnet',",
            "lineNumber": 806
          },
          {
            "text": "      networkErrorReason4: 'Invalid access code',",
            "lineNumber": 807
          },
          {
            "text": "      aiProvider: 'AI Model Engine',",
            "lineNumber": 808
          },
          {
            "text": "      aiProviderLocal: 'Local Model (Ollama)',",
            "lineNumber": 809
          },
          {
            "text": "      aiProviderOnline: 'Cloud API (Online)',",
            "lineNumber": 810
          },
          {
            "text": "      aiProviderLmStudio: 'LM Studio (Local)',",
            "lineNumber": 811
          },
          {
            "text": "      aiModelVision: 'Model (Vision Capable)',",
            "lineNumber": 812
          },
          {
            "text": "      aiModel: 'Model',",
            "lineNumber": 813
          },
          {
            "text": "      aiModelOptional: 'Model (Optional)',",
            "lineNumber": 814
          },
          {
            "text": "      lmStudioVersionHint: 'Ensure to include /v1 at the end',",
            "lineNumber": 815
          },
          {
            "text": "      lmStudioEndpoint: 'API Endpoint',",
            "lineNumber": 816
          },
          {
            "text": "      lmStudioSetupGuide: 'How to use LM Studio?',",
            "lineNumber": 817
          },
          {
            "text": "      lmStudioStep1: 'Download and install from lmstudio.ai.',",
            "lineNumber": 818
          },
          {
            "text": "      lmStudioStep2: 'Search and download a Vision-capable model (search \"Vision\" or \"Llava\").',",
            "lineNumber": 819
          },
          {
            "text": "      lmStudioStep3: 'Click the \"Local Server\" icon (arrows) on the left sidebar.',",
            "lineNumber": 820
          },
          {
            "text": "      lmStudioStep4: 'Select the model at the top and click \"Start Server\".',",
            "lineNumber": 821
          },
          {
            "text": "      ollamaSetupGuide: 'How to use Ollama?',",
            "lineNumber": 822
          },
          {
            "text": "      ollamaStep1: 'Download from ollama.com.',",
            "lineNumber": 823
          },
          {
            "text": "      ollamaStep2: 'Run &#96;ollama run llava&#96; in terminal.',",
            "lineNumber": 824
          },
          {
            "text": "      ollamaStep3: 'Ensure server is running on port 11434.',",
            "lineNumber": 825
          },
          {
            "text": "      onlineSetupGuide: 'How to use Online API?',",
            "lineNumber": 826
          },
          {
            "text": "      onlineStep1: 'Get an API Key from OpenAI or compatible provider.',",
            "lineNumber": 827
          },
          {
            "text": "      onlineStep2: 'Enter API Endpoint (e.g. https://api.openai.com/v1).',",
            "lineNumber": 828
          },
          {
            "text": "      onlineStep3: 'Paste your API Key.',",
            "lineNumber": 829
          },
          {
            "text": "      aiAutoTag: 'Auto-add AI tags',",
            "lineNumber": 830
          },
          {
            "text": "      aiAutoDescription: 'Auto-add AI description',",
            "lineNumber": 831
          },
          {
            "text": "      aiEnhancePersonDesc: 'Enhance Person Description (Focus on actions)',",
            "lineNumber": 832
          },
          {
            "text": "      aiFaceRec: 'Enable Face Recognition',",
            "lineNumber": 833
          },
          {
            "text": "      aiAutoAddPeople: 'Auto-add identified people',      ",
            "lineNumber": 834
          },
          {
            "text": "      aiEnableOCR: 'Enable Text Recognition (OCR)',",
            "lineNumber": 835
          },
          {
            "text": "      aiEnableTranslation: 'Enable Translation',",
            "lineNumber": 836
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.26338183879852295
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n\n      exitActionExit: 'Exit Application',\n      folders: 'Folders &amp; Cache',\n      resourceRoot: 'Resource Root',\n      cacheRoot: 'Cache Directory',\n      change: 'Change',\n      confirm: 'Confirm',\n      connect: 'Connect',\n      cancel: 'Back',\n      modalCopy: 'Copy to Folder',\n      modalMove: 'Move to Folder',\n      modalEditTags: 'Edit Tags',\n      modalAction: 'Action',\n      movingTo: 'Moving resource root to',\n      movingCache: 'Moving cache to',\n      autoStartEnabled: 'Auto-start enabled',\n      autoStartDisabled: 'Auto-start disabled',\n      success: 'Settings saved',\n      collisionTitle: 'Name Collision',\n      fileCollisionMsg: 'A file with this name already exists in this folder.',\n      fileOverwriteMsg: 'A file with this name already exists. Overwrite it?',\n      filesOverwriteMsg: '%count% files with the same names already exist. Overwrite them?',\n      folderCollisionMsg: 'A folder with this name already exists.',\n      renameAuto: 'Rename with suffix',\n      mergeFolder: 'Merge Folders',\n      mergeDesc: 'Merging will move all contents from the source folder to the target folder and delete the source folder. Duplicate files in the target will be renamed.',\n      selectDest: 'Select Destination Folder',\n      networkTitle: 'Local Network Sharing',\n      networkDesc: 'Allow devices on same Wi-Fi to access and manage library',\n      serverRunning: 'Server Running',\n      serverStopped: 'Server Stopped',\n      accessCode: 'Access PIN',\n      allowWrite: 'Allow Edit/Delete',\n      connectedDevices: 'Connected Devices',\n      port: 'Port',\n      scanQr: 'Scan to Connect',\n      extensionChangeTitle: 'Rename Extension',\n      extensionChangeMsg: 'If you change a file name extension, the file might become unstable.',\n      extensionChangeConfirm: 'Are you sure you want to change it?',\n      nasTitle: 'Connect to NAS',\n      nasAddress: 'Server Address',\n      nasScan: 'Scan LAN',\n      nasScanFound: 'Devices Found',\n      nasUser: 'Username',\n      nasPass: 'Password',\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "lineNumber": 754
          },
          {
            "text": "      exitActionExit: 'Exit Application',",
            "lineNumber": 755
          },
          {
            "text": "      folders: 'Folders &amp; Cache',",
            "lineNumber": 756
          },
          {
            "text": "      resourceRoot: 'Resource Root',",
            "lineNumber": 757
          },
          {
            "text": "      cacheRoot: 'Cache Directory',",
            "lineNumber": 758
          },
          {
            "text": "      change: 'Change',",
            "lineNumber": 759
          },
          {
            "text": "      confirm: 'Confirm',",
            "lineNumber": 760
          },
          {
            "text": "      connect: 'Connect',",
            "lineNumber": 761
          },
          {
            "text": "      cancel: 'Back',",
            "lineNumber": 762
          },
          {
            "text": "      modalCopy: 'Copy to Folder',",
            "lineNumber": 763
          },
          {
            "text": "      modalMove: 'Move to Folder',",
            "lineNumber": 764
          },
          {
            "text": "      modalEditTags: 'Edit Tags',",
            "lineNumber": 765
          },
          {
            "text": "      modalAction: 'Action',",
            "lineNumber": 766
          },
          {
            "text": "      movingTo: 'Moving resource root to',",
            "lineNumber": 767
          },
          {
            "text": "      movingCache: 'Moving cache to',",
            "lineNumber": 768
          },
          {
            "text": "      autoStartEnabled: 'Auto-start enabled',",
            "lineNumber": 769
          },
          {
            "text": "      autoStartDisabled: 'Auto-start disabled',",
            "lineNumber": 770
          },
          {
            "text": "      success: 'Settings saved',",
            "lineNumber": 771
          },
          {
            "text": "      collisionTitle: 'Name Collision',",
            "lineNumber": 772
          },
          {
            "text": "      fileCollisionMsg: 'A file with this name already exists in this folder.',",
            "lineNumber": 773
          },
          {
            "text": "      fileOverwriteMsg: 'A file with this name already exists. Overwrite it?',",
            "lineNumber": 774
          },
          {
            "text": "      filesOverwriteMsg: '%count% files with the same names already exist. Overwrite them?',",
            "lineNumber": 775
          },
          {
            "text": "      folderCollisionMsg: 'A folder with this name already exists.',",
            "lineNumber": 776
          },
          {
            "text": "      renameAuto: 'Rename with suffix',",
            "lineNumber": 777
          },
          {
            "text": "      mergeFolder: 'Merge Folders',",
            "lineNumber": 778
          },
          {
            "text": "      mergeDesc: 'Merging will move all contents from the source folder to the target folder and delete the source folder. Duplicate files in the target will be renamed.',",
            "lineNumber": 779
          },
          {
            "text": "      selectDest: 'Select Destination Folder',",
            "lineNumber": 780
          },
          {
            "text": "      networkTitle: 'Local Network Sharing',",
            "lineNumber": 781
          },
          {
            "text": "      networkDesc: 'Allow devices on same Wi-Fi to access and manage library',",
            "lineNumber": 782
          },
          {
            "text": "      serverRunning: 'Server Running',",
            "lineNumber": 783
          },
          {
            "text": "      serverStopped: 'Server Stopped',",
            "lineNumber": 784
          },
          {
            "text": "      accessCode: 'Access PIN',",
            "lineNumber": 785
          },
          {
            "text": "      allowWrite: 'Allow Edit/Delete',",
            "lineNumber": 786
          },
          {
            "text": "      connectedDevices: 'Connected Devices',",
            "lineNumber": 787
          },
          {
            "text": "      port: 'Port',",
            "lineNumber": 788
          },
          {
            "text": "      scanQr: 'Scan to Connect',",
            "lineNumber": 789
          },
          {
            "text": "      extensionChangeTitle: 'Rename Extension',",
            "lineNumber": 790
          },
          {
            "text": "      extensionChangeMsg: 'If you change a file name extension, the file might become unstable.',",
            "lineNumber": 791
          },
          {
            "text": "      extensionChangeConfirm: 'Are you sure you want to change it?',",
            "lineNumber": 792
          },
          {
            "text": "      nasTitle: 'Connect to NAS',",
            "lineNumber": 793
          },
          {
            "text": "      nasAddress: 'Server Address',",
            "lineNumber": 794
          },
          {
            "text": "      nasScan: 'Scan LAN',",
            "lineNumber": 795
          },
          {
            "text": "      nasScanFound: 'Devices Found',",
            "lineNumber": 796
          },
          {
            "text": "      nasUser: 'Username',",
            "lineNumber": 797
          },
          {
            "text": "      nasPass: 'Password',",
            "lineNumber": 798
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.2598452568054199
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\ImageViewer.tsx",
        "range": {
          "startPosition": {
            "line": 53
          },
          "endPosition": {
            "line": 851,
            "column": 1
          }
        },
        "contents": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = \n\n                     type=\"button\"\n                     onClick={toggleScopeMenu}\n                     className=\"flex items-center text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 mr-2 pr-2 border-r border-gray-300 dark:border-gray-700 whitespace-nowrap\"\n                   &gt;\n                     {getScopeIcon()}\n                     &lt;ChevronDown size={12} className=\"ml-1 opacity-70\"/&gt;\n                   &lt;/button&gt;\n                 &lt;/div&gt;\n                &lt;Search size={16} className={&#96;mr-2 flex-shrink-0 ${isAISearchEnabled ? 'text-purple-500' : 'text-gray-400'}&#96;} /&gt;\n                &lt;input\n                  ref={searchInputRef}\n                  type=\"text\"\n                  value={localQuery}\n                  onChange={(e) =&gt; setLocalQuery(e.target.value)}\n                  placeholder={isAISearchEnabled ? t('settings.aiSmartSearch') : t('search.placeholder')}\n                  className=\"bg-transparent border-none flex-1 focus:outline-none text-sm text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 min-w-0\"\n                  onKeyDown={(e) =&gt; { if (e.key === 'Enter') handleSearchSubmit(); }}\n                /&gt;\n                &lt;div className=\"flex items-center space-x-1 ml-2 flex-shrink-0\"&gt;\n                  {localQuery &amp;&amp; (\n                    &lt;button onClick={() =&gt; { setLocalQuery(''); onSearch(''); }} className=\"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-400 flex-shrink-0\"&gt;\n                      &lt;X size={14} /&gt;\n                    &lt;/button&gt;\n                  )}\n                  &lt;button \n                    onClick={onToggleAISearch}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 52,
                "column": 1
              },
              "endPosition": {
                "line": 52,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 8
              },
              "endPosition": {
                "line": 52,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 52,
                "column": 14
              },
              "endPosition": {
                "line": 52,
                "column": 51
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageViewer: React.FC&lt;ViewerProps&gt; = ",
            "lineNumber": 54
          },
          {
            "lineNumber": 491
          },
          {
            "text": "                     type=\"button\"",
            "lineNumber": 492
          },
          {
            "text": "                     onClick={toggleScopeMenu}",
            "lineNumber": 493
          },
          {
            "text": "                     className=\"flex items-center text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 mr-2 pr-2 border-r border-gray-300 dark:border-gray-700 whitespace-nowrap\"",
            "lineNumber": 494
          },
          {
            "text": "                   &gt;",
            "lineNumber": 495
          },
          {
            "text": "                     {getScopeIcon()}",
            "lineNumber": 496
          },
          {
            "text": "                     &lt;ChevronDown size={12} className=\"ml-1 opacity-70\"/&gt;",
            "lineNumber": 497
          },
          {
            "text": "                   &lt;/button&gt;",
            "lineNumber": 498
          },
          {
            "text": "                 &lt;/div&gt;",
            "lineNumber": 499
          },
          {
            "text": "                &lt;Search size={16} className={&#96;mr-2 flex-shrink-0 ${isAISearchEnabled ? 'text-purple-500' : 'text-gray-400'}&#96;} /&gt;",
            "lineNumber": 500
          },
          {
            "text": "                &lt;input",
            "lineNumber": 501
          },
          {
            "text": "                  ref={searchInputRef}",
            "lineNumber": 502
          },
          {
            "text": "                  type=\"text\"",
            "lineNumber": 503
          },
          {
            "text": "                  value={localQuery}",
            "lineNumber": 504
          },
          {
            "text": "                  onChange={(e) =&gt; setLocalQuery(e.target.value)}",
            "lineNumber": 505
          },
          {
            "text": "                  placeholder={isAISearchEnabled ? t('settings.aiSmartSearch') : t('search.placeholder')}",
            "lineNumber": 506
          },
          {
            "text": "                  className=\"bg-transparent border-none flex-1 focus:outline-none text-sm text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 min-w-0\"",
            "lineNumber": 507
          },
          {
            "text": "                  onKeyDown={(e) =&gt; { if (e.key === 'Enter') handleSearchSubmit(); }}",
            "lineNumber": 508
          },
          {
            "text": "                /&gt;",
            "lineNumber": 509
          },
          {
            "text": "                &lt;div className=\"flex items-center space-x-1 ml-2 flex-shrink-0\"&gt;",
            "lineNumber": 510
          },
          {
            "text": "                  {localQuery &amp;&amp; (",
            "lineNumber": 511
          },
          {
            "text": "                    &lt;button onClick={() =&gt; { setLocalQuery(''); onSearch(''); }} className=\"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-400 flex-shrink-0\"&gt;",
            "lineNumber": 512
          },
          {
            "text": "                      &lt;X size={14} /&gt;",
            "lineNumber": 513
          },
          {
            "text": "                    &lt;/button&gt;",
            "lineNumber": 514
          },
          {
            "text": "                  )}",
            "lineNumber": 515
          },
          {
            "text": "                  &lt;button ",
            "lineNumber": 516
          },
          {
            "text": "                    onClick={onToggleAISearch}",
            "lineNumber": 517
          },
          {
            "text": ";",
            "lineNumber": 852
          }
        ]
      },
      "score": 0.2545402944087982
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleRefresh = async \nprev =&gt; {\n([fileId, newFile]) =&gt; {\n\n                      } else {\n                          // New file, add as-is\n                          mergedFiles[fileId] = newFile;\n                      }\n                  });\n                  \n                  return { ...prev, files: mergedFiles };\n              });\n          } catch (e) {\n              console.error(\"Failed to refresh directory\", e);\n          }\n      } else if (folder) {\n          // Handle virtual folders with no actual path\n          setState(prev =&gt; {\n              // Force a complete re-render by updating the folder's lastRefresh timestamp\n              const files = { ...prev.files };\n              files[targetFolderId] = {\n                  ...folder,\n                  // Add a lastRefresh timestamp to force a re-render\n                  lastRefresh: Date.now()\n              };\n              \n              return { ...prev, files };\n          });\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 3
              },
              "endPosition": {
                "line": 1305,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 9
              },
              "endPosition": {
                "line": 1305,
                "column": 26
              }
            },
            {
              "startPosition": {
                "line": 1305,
                "column": 34
              },
              "endPosition": {
                "line": 1306,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleRefresh = async ",
            "lineNumber": 1346
          },
          {
            "text": "prev =&gt; {",
            "lineNumber": 1355
          },
          {
            "text": "([fileId, newFile]) =&gt; {",
            "lineNumber": 1377
          },
          {
            "lineNumber": 1395
          },
          {
            "text": "                      } else {",
            "lineNumber": 1396
          },
          {
            "text": "                          // New file, add as-is",
            "lineNumber": 1397
          },
          {
            "text": "                          mergedFiles[fileId] = newFile;",
            "lineNumber": 1398
          },
          {
            "text": "                      }",
            "lineNumber": 1399
          },
          {
            "text": "                  });",
            "lineNumber": 1400
          },
          {
            "text": "                  ",
            "lineNumber": 1401
          },
          {
            "text": "                  return { ...prev, files: mergedFiles };",
            "lineNumber": 1402
          },
          {
            "text": "              });",
            "lineNumber": 1403
          },
          {
            "text": "          } catch (e) {",
            "lineNumber": 1404
          },
          {
            "text": "              console.error(\"Failed to refresh directory\", e);",
            "lineNumber": 1405
          },
          {
            "text": "          }",
            "lineNumber": 1406
          },
          {
            "text": "      } else if (folder) {",
            "lineNumber": 1407
          },
          {
            "text": "          // Handle virtual folders with no actual path",
            "lineNumber": 1408
          },
          {
            "text": "          setState(prev =&gt; {",
            "lineNumber": 1409
          },
          {
            "text": "              // Force a complete re-render by updating the folder's lastRefresh timestamp",
            "lineNumber": 1410
          },
          {
            "text": "              const files = { ...prev.files };",
            "lineNumber": 1411
          },
          {
            "text": "              files[targetFolderId] = {",
            "lineNumber": 1412
          },
          {
            "text": "                  ...folder,",
            "lineNumber": 1413
          },
          {
            "text": "                  // Add a lastRefresh timestamp to force a re-render",
            "lineNumber": 1414
          },
          {
            "text": "                  lastRefresh: Date.now()",
            "lineNumber": 1415
          },
          {
            "text": "              };",
            "lineNumber": 1416
          },
          {
            "text": "              ",
            "lineNumber": 1417
          },
          {
            "text": "              return { ...prev, files };",
            "lineNumber": 1418
          },
          {
            "text": "          });",
            "lineNumber": 1419
          },
          {
            "text": ";",
            "lineNumber": 1421
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.2501802444458008
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n\n      renameAuto: '自动重命名',\n      mergeFolder: '合并文件夹',\n      mergeDesc: '合并操作将把源文件夹中的所有内容移动到目标文件夹中，并删除源文件夹。如果目标文件夹中存在同名文件，它们将被自动重命名。',\n      selectDest: '选择目标文件夹',\n      networkTitle: '局域网共享',\n      networkDesc: '允许同一 Wi-Fi 下的设备（手机、平板）访问和管理图库',\n      serverRunning: '服务正在运行',\n      serverStopped: '服务已停止',\n      accessCode: '访问验证码',\n      allowWrite: '允许编辑和删除',\n      connectedDevices: '已连接设备',\n      port: '端口',\n      scanQr: '扫码连接',\n      extensionChangeTitle: '更改文件扩展名',\n      extensionChangeMsg: '如果改变文件扩展名，可能会导致文件不可用。',\n      extensionChangeConfirm: '确定要更改吗？',\n      nasTitle: '连接到 NAS',\n      nasAddress: '服务器地址',\n      nasScan: '扫描局域网',\n      nasScanFound: '发现设备',\n      nasUser: '用户名',\n      nasPass: '密码',\n      nasConnecting: '正在连接...',\n      nasSuccess: '连接成功',\n      nasError: '连接失败',\n      networkErrorTitle: '连接失败',\n      networkErrorReasons: '无法连接到局域网服务器。可能的原因包括：',\n      networkErrorReason1: 'IP 地址不正确或服务器未启动',\n      networkErrorReason2: '防火墙拦截了连接端口 (8080)',\n      networkErrorReason3: '设备未处于同一网段',\n      networkErrorReason4: '访问验证码错误',\n      aiProvider: 'AI 模型引擎',\n      aiProviderLocal: '本地模型 (Ollama)',\n      aiProviderOnline: '在线云端 (Cloud API)',\n      aiProviderLmStudio: 'LM Studio (本地)',\n      aiModelVision: '模型 (支持视觉)',\n      aiModel: '模型',\n      aiModelOptional: '模型 (可选)',\n      lmStudioVersionHint: '确保结尾包含 /v1',\n      lmStudioEndpoint: 'API 服务地址',\n      connectionSteps: '连接步骤说明',\n      lmStudioSetupGuide: '如何使用 LM Studio?',\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "lineNumber": 304
          },
          {
            "text": "      renameAuto: '自动重命名',",
            "lineNumber": 305
          },
          {
            "text": "      mergeFolder: '合并文件夹',",
            "lineNumber": 306
          },
          {
            "text": "      mergeDesc: '合并操作将把源文件夹中的所有内容移动到目标文件夹中，并删除源文件夹。如果目标文件夹中存在同名文件，它们将被自动重命名。',",
            "lineNumber": 307
          },
          {
            "text": "      selectDest: '选择目标文件夹',",
            "lineNumber": 308
          },
          {
            "text": "      networkTitle: '局域网共享',",
            "lineNumber": 309
          },
          {
            "text": "      networkDesc: '允许同一 Wi-Fi 下的设备（手机、平板）访问和管理图库',",
            "lineNumber": 310
          },
          {
            "text": "      serverRunning: '服务正在运行',",
            "lineNumber": 311
          },
          {
            "text": "      serverStopped: '服务已停止',",
            "lineNumber": 312
          },
          {
            "text": "      accessCode: '访问验证码',",
            "lineNumber": 313
          },
          {
            "text": "      allowWrite: '允许编辑和删除',",
            "lineNumber": 314
          },
          {
            "text": "      connectedDevices: '已连接设备',",
            "lineNumber": 315
          },
          {
            "text": "      port: '端口',",
            "lineNumber": 316
          },
          {
            "text": "      scanQr: '扫码连接',",
            "lineNumber": 317
          },
          {
            "text": "      extensionChangeTitle: '更改文件扩展名',",
            "lineNumber": 318
          },
          {
            "text": "      extensionChangeMsg: '如果改变文件扩展名，可能会导致文件不可用。',",
            "lineNumber": 319
          },
          {
            "text": "      extensionChangeConfirm: '确定要更改吗？',",
            "lineNumber": 320
          },
          {
            "text": "      nasTitle: '连接到 NAS',",
            "lineNumber": 321
          },
          {
            "text": "      nasAddress: '服务器地址',",
            "lineNumber": 322
          },
          {
            "text": "      nasScan: '扫描局域网',",
            "lineNumber": 323
          },
          {
            "text": "      nasScanFound: '发现设备',",
            "lineNumber": 324
          },
          {
            "text": "      nasUser: '用户名',",
            "lineNumber": 325
          },
          {
            "text": "      nasPass: '密码',",
            "lineNumber": 326
          },
          {
            "text": "      nasConnecting: '正在连接...',",
            "lineNumber": 327
          },
          {
            "text": "      nasSuccess: '连接成功',",
            "lineNumber": 328
          },
          {
            "text": "      nasError: '连接失败',",
            "lineNumber": 329
          },
          {
            "text": "      networkErrorTitle: '连接失败',",
            "lineNumber": 330
          },
          {
            "text": "      networkErrorReasons: '无法连接到局域网服务器。可能的原因包括：',",
            "lineNumber": 331
          },
          {
            "text": "      networkErrorReason1: 'IP 地址不正确或服务器未启动',",
            "lineNumber": 332
          },
          {
            "text": "      networkErrorReason2: '防火墙拦截了连接端口 (8080)',",
            "lineNumber": 333
          },
          {
            "text": "      networkErrorReason3: '设备未处于同一网段',",
            "lineNumber": 334
          },
          {
            "text": "      networkErrorReason4: '访问验证码错误',",
            "lineNumber": 335
          },
          {
            "text": "      aiProvider: 'AI 模型引擎',",
            "lineNumber": 336
          },
          {
            "text": "      aiProviderLocal: '本地模型 (Ollama)',",
            "lineNumber": 337
          },
          {
            "text": "      aiProviderOnline: '在线云端 (Cloud API)',",
            "lineNumber": 338
          },
          {
            "text": "      aiProviderLmStudio: 'LM Studio (本地)',",
            "lineNumber": 339
          },
          {
            "text": "      aiModelVision: '模型 (支持视觉)',",
            "lineNumber": 340
          },
          {
            "text": "      aiModel: '模型',",
            "lineNumber": 341
          },
          {
            "text": "      aiModelOptional: '模型 (可选)',",
            "lineNumber": 342
          },
          {
            "text": "      lmStudioVersionHint: '确保结尾包含 /v1',",
            "lineNumber": 343
          },
          {
            "text": "      lmStudioEndpoint: 'API 服务地址',",
            "lineNumber": 344
          },
          {
            "text": "      connectionSteps: '连接步骤说明',",
            "lineNumber": 345
          },
          {
            "text": "      lmStudioSetupGuide: '如何使用 LM Studio?',",
            "lineNumber": 346
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.2462051957845688
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 109
          },
          "endPosition": {
            "line": 255,
            "column": 2
          }
        },
        "contents": "const FolderPickerModal = \nconst renderTree = \n\n    );\n  };\n  \n  const matchingFolders = findMatchingFolders();\n  \n  return (\n    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in\"&gt;\n      &lt;h3 className=\"font-bold text-lg mb-2 text-gray-900 dark:text-white\"&gt;\n        {type === 'copy-to-folder' ? t('context.copyTo') : t('context.moveTo')}\n      &lt;/h3&gt;\n      \n      {/* 搜索框 */}\n      &lt;div className=\"relative mb-4\"&gt;\n        &lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;\n        &lt;input\n          type=\"text\"\n          id=\"folder-picker-search\"\n          name=\"folder-picker-search\"\n          className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\"\n          placeholder={t('search.placeholder')}\n          value={searchQuery}\n          onChange={(e) =&gt; setSearchQuery(e.target.value)}\n          autoFocus\n        /&gt;\n        {searchQuery &amp;&amp; (\n          &lt;button\n            className=\"absolute right-2.5 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n            onClick={() =&gt; setSearchQuery('')}\n          &gt;\n            &lt;X size={14} /&gt;\n          &lt;/button&gt;\n        )}\n      &lt;/div&gt;\n      \n      &lt;div className=\"flex-1 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded mb-4 p-2 bg-gray-50 dark:bg-gray-900/50\"&gt;\n        {roots.map((rootId: string) =&gt; renderTree(rootId, 0, matchingFolders))}\n      &lt;/div&gt;\n      &lt;div className=\"flex justify-end space-x-2\"&gt;\n        &lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;\n          {t('settings.cancel')}\n        &lt;/button&gt;\n        &lt;button \n          onClick={() =&gt; currentId &amp;&amp; onConfirm(currentId)} \n          disabled={!currentId}\n          className=\"bg-blue-600 disabled:opacity-50 text-white px-3 py-1.5 rounded hover:bg-blue-700 text-sm\"\n        &gt;\n          {t('settings.confirm')}\n        &lt;/button&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  );\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 108,
                "column": 1
              },
              "endPosition": {
                "line": 108,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 108,
                "column": 7
              },
              "endPosition": {
                "line": 108,
                "column": 27
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const FolderPickerModal = ",
            "lineNumber": 110
          },
          {
            "text": "const renderTree = ",
            "lineNumber": 171
          },
          {
            "lineNumber": 204
          },
          {
            "text": "    );",
            "lineNumber": 205
          },
          {
            "text": "  };",
            "lineNumber": 206
          },
          {
            "text": "  ",
            "lineNumber": 207
          },
          {
            "text": "  const matchingFolders = findMatchingFolders();",
            "lineNumber": 208
          },
          {
            "text": "  ",
            "lineNumber": 209
          },
          {
            "text": "  return (",
            "lineNumber": 210
          },
          {
            "text": "    &lt;div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl w-96 h-[500px] flex flex-col animate-zoom-in\"&gt;",
            "lineNumber": 211
          },
          {
            "text": "      &lt;h3 className=\"font-bold text-lg mb-2 text-gray-900 dark:text-white\"&gt;",
            "lineNumber": 212
          },
          {
            "text": "        {type === 'copy-to-folder' ? t('context.copyTo') : t('context.moveTo')}",
            "lineNumber": 213
          },
          {
            "text": "      &lt;/h3&gt;",
            "lineNumber": 214
          },
          {
            "text": "      ",
            "lineNumber": 215
          },
          {
            "text": "      {/* 搜索框 */}",
            "lineNumber": 216
          },
          {
            "text": "      &lt;div className=\"relative mb-4\"&gt;",
            "lineNumber": 217
          },
          {
            "text": "        &lt;Search size={14} className=\"absolute left-2.5 top-2.5 text-gray-400\"/&gt;",
            "lineNumber": 218
          },
          {
            "text": "        &lt;input",
            "lineNumber": 219
          },
          {
            "text": "          type=\"text\"",
            "lineNumber": 220
          },
          {
            "text": "          id=\"folder-picker-search\"",
            "lineNumber": 221
          },
          {
            "text": "          name=\"folder-picker-search\"",
            "lineNumber": 222
          },
          {
            "text": "          className=\"w-full border dark:border-gray-600 rounded pl-8 pr-2 py-2 bg-transparent text-gray-900 dark:text-white focus:outline-none focus:ring-2 ring-blue-500 text-sm\"",
            "lineNumber": 223
          },
          {
            "text": "          placeholder={t('search.placeholder')}",
            "lineNumber": 224
          },
          {
            "text": "          value={searchQuery}",
            "lineNumber": 225
          },
          {
            "text": "          onChange={(e) =&gt; setSearchQuery(e.target.value)}",
            "lineNumber": 226
          },
          {
            "text": "          autoFocus",
            "lineNumber": 227
          },
          {
            "text": "        /&gt;",
            "lineNumber": 228
          },
          {
            "text": "        {searchQuery &amp;&amp; (",
            "lineNumber": 229
          },
          {
            "text": "          &lt;button",
            "lineNumber": 230
          },
          {
            "text": "            className=\"absolute right-2.5 top-2.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"",
            "lineNumber": 231
          },
          {
            "text": "            onClick={() =&gt; setSearchQuery('')}",
            "lineNumber": 232
          },
          {
            "text": "          &gt;",
            "lineNumber": 233
          },
          {
            "text": "            &lt;X size={14} /&gt;",
            "lineNumber": 234
          },
          {
            "text": "          &lt;/button&gt;",
            "lineNumber": 235
          },
          {
            "text": "        )}",
            "lineNumber": 236
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 237
          },
          {
            "text": "      ",
            "lineNumber": 238
          },
          {
            "text": "      &lt;div className=\"flex-1 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded mb-4 p-2 bg-gray-50 dark:bg-gray-900/50\"&gt;",
            "lineNumber": 239
          },
          {
            "text": "        {roots.map((rootId: string) =&gt; renderTree(rootId, 0, matchingFolders))}",
            "lineNumber": 240
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 241
          },
          {
            "text": "      &lt;div className=\"flex justify-end space-x-2\"&gt;",
            "lineNumber": 242
          },
          {
            "text": "        &lt;button onClick={onClose} className=\"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm\"&gt;",
            "lineNumber": 243
          },
          {
            "text": "          {t('settings.cancel')}",
            "lineNumber": 244
          },
          {
            "text": "        &lt;/button&gt;",
            "lineNumber": 245
          },
          {
            "text": "        &lt;button ",
            "lineNumber": 246
          },
          {
            "text": "          onClick={() =&gt; currentId &amp;&amp; onConfirm(currentId)} ",
            "lineNumber": 247
          },
          {
            "text": "          disabled={!currentId}",
            "lineNumber": 248
          },
          {
            "text": "          className=\"bg-blue-600 disabled:opacity-50 text-white px-3 py-1.5 rounded hover:bg-blue-700 text-sm\"",
            "lineNumber": 249
          },
          {
            "text": "        &gt;",
            "lineNumber": 250
          },
          {
            "text": "          {t('settings.confirm')}",
            "lineNumber": 251
          },
          {
            "text": "        &lt;/button&gt;",
            "lineNumber": 252
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 253
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 254
          },
          {
            "text": "  );",
            "lineNumber": 255
          },
          {
            "text": "};",
            "lineNumber": 256
          }
        ]
      },
      "score": 0.24397079646587372
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\utils\\translations.ts",
        "range": {
          "startPosition": {
            "line": 1
          },
          "endPosition": {
            "line": 946,
            "column": 1
          }
        },
        "contents": "export const translations = {\n\n      connectionSteps: '连接步骤说明',\n      lmStudioSetupGuide: '如何使用 LM Studio?',\n      lmStudioStep1: '访问 lmstudio.ai 下载并安装软件。',\n      lmStudioStep2: '在软件中搜索并下载支持视觉的模型 (推荐搜索 \"Vision\" 或 \"Llava\")。',\n      lmStudioStep3: '点击左侧 \"Local Server\" (双向箭头图标)。',\n      lmStudioStep4: '顶部选择模型，点击 \"Start Server\" 启动服务。',\n      lmStudioStep5: '复制 API 地址并粘贴到上方输入框中。',\n      ollamaSetupGuide: '如何使用 Ollama?',\n      ollamaStep1: '访问 ollama.com 下载并安装软件。',\n      ollamaStep2: '在终端运行 &#96;ollama run llava&#96; (或 &#96;moondream&#96; 等视觉模型)。',\n      ollamaStep3: '确保服务运行在默认端口 11434。',\n      ollamaStep4: '在上方输入框中确认服务地址为 http://localhost:11434。',\n      ollamaStep5: '选择适合的模型名称填入模型输入框。',\n      onlineSetupGuide: '如何配置在线 API?',\n      openaiStep1: '获取 OpenAI 或兼容服务商的 API Key。',\n      openaiStep2: '输入 API Endpoint (如 https://api.openai.com/v1)。',\n      openaiStep3: '粘贴 API Key 到上方输入框。',\n      openaiStep4: '输入适合的模型名称 (如 gpt-4o)。',\n      openaiStep5: '点击测试连接按钮验证配置是否正确。',\n      onlineStep1: '1. 获取 OpenAI 或兼容服务商的 API Key。',\n      onlineStep2: '2. 输入 API Endpoint (如 https://api.openai.com/v1)。',\n      onlineStep3: '3. 粘贴 API Key。注意：这将产生费用。',\n      aiAutoTag: '自动添加 AI 标签',\n      aiAutoDescription: '自动添加 AI 描述',\n      aiEnhancePersonDesc: '增强人物描述 (着重分析人物行为)',\n      aiFaceRec: '启用人脸识别',\n      aiAutoAddPeople: '自动添加到人物',\n      aiEnableOCR: '启用文字识别 (OCR)',\n      aiEnableTranslation: '启用文字翻译',\n      aiConfidence: '识别置信度阈值',\n      aiAnalyzing: '正在进行 AI 分析...',\n      aiAnalyzeSuccess: 'AI 分析完成',\n      testConnection: '测试连接',\n      testing: '正在连接...',\n      connectionSuccess: '连接成功',\n      connectionFailed: '连接失败',\n      connectionStatus: '连接状态',\n      statusConnected: '已连接',\n      statusDisconnected: '未连接',\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 2,
                "column": 1
              },
              "endPosition": {
                "line": 2,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 8
              },
              "endPosition": {
                "line": 2,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 2,
                "column": 14
              },
              "endPosition": {
                "line": 3,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const translations = {",
            "lineNumber": 2
          },
          {
            "lineNumber": 344
          },
          {
            "text": "      connectionSteps: '连接步骤说明',",
            "lineNumber": 345
          },
          {
            "text": "      lmStudioSetupGuide: '如何使用 LM Studio?',",
            "lineNumber": 346
          },
          {
            "text": "      lmStudioStep1: '访问 lmstudio.ai 下载并安装软件。',",
            "lineNumber": 347
          },
          {
            "text": "      lmStudioStep2: '在软件中搜索并下载支持视觉的模型 (推荐搜索 \"Vision\" 或 \"Llava\")。',",
            "lineNumber": 348
          },
          {
            "text": "      lmStudioStep3: '点击左侧 \"Local Server\" (双向箭头图标)。',",
            "lineNumber": 349
          },
          {
            "text": "      lmStudioStep4: '顶部选择模型，点击 \"Start Server\" 启动服务。',",
            "lineNumber": 350
          },
          {
            "text": "      lmStudioStep5: '复制 API 地址并粘贴到上方输入框中。',",
            "lineNumber": 351
          },
          {
            "text": "      ollamaSetupGuide: '如何使用 Ollama?',",
            "lineNumber": 352
          },
          {
            "text": "      ollamaStep1: '访问 ollama.com 下载并安装软件。',",
            "lineNumber": 353
          },
          {
            "text": "      ollamaStep2: '在终端运行 &#96;ollama run llava&#96; (或 &#96;moondream&#96; 等视觉模型)。',",
            "lineNumber": 354
          },
          {
            "text": "      ollamaStep3: '确保服务运行在默认端口 11434。',",
            "lineNumber": 355
          },
          {
            "text": "      ollamaStep4: '在上方输入框中确认服务地址为 http://localhost:11434。',",
            "lineNumber": 356
          },
          {
            "text": "      ollamaStep5: '选择适合的模型名称填入模型输入框。',",
            "lineNumber": 357
          },
          {
            "text": "      onlineSetupGuide: '如何配置在线 API?',",
            "lineNumber": 358
          },
          {
            "text": "      openaiStep1: '获取 OpenAI 或兼容服务商的 API Key。',",
            "lineNumber": 359
          },
          {
            "text": "      openaiStep2: '输入 API Endpoint (如 https://api.openai.com/v1)。',",
            "lineNumber": 360
          },
          {
            "text": "      openaiStep3: '粘贴 API Key 到上方输入框。',",
            "lineNumber": 361
          },
          {
            "text": "      openaiStep4: '输入适合的模型名称 (如 gpt-4o)。',",
            "lineNumber": 362
          },
          {
            "text": "      openaiStep5: '点击测试连接按钮验证配置是否正确。',",
            "lineNumber": 363
          },
          {
            "text": "      onlineStep1: '1. 获取 OpenAI 或兼容服务商的 API Key。',",
            "lineNumber": 364
          },
          {
            "text": "      onlineStep2: '2. 输入 API Endpoint (如 https://api.openai.com/v1)。',",
            "lineNumber": 365
          },
          {
            "text": "      onlineStep3: '3. 粘贴 API Key。注意：这将产生费用。',",
            "lineNumber": 366
          },
          {
            "text": "      aiAutoTag: '自动添加 AI 标签',",
            "lineNumber": 367
          },
          {
            "text": "      aiAutoDescription: '自动添加 AI 描述',",
            "lineNumber": 368
          },
          {
            "text": "      aiEnhancePersonDesc: '增强人物描述 (着重分析人物行为)',",
            "lineNumber": 369
          },
          {
            "text": "      aiFaceRec: '启用人脸识别',",
            "lineNumber": 370
          },
          {
            "text": "      aiAutoAddPeople: '自动添加到人物',",
            "lineNumber": 371
          },
          {
            "text": "      aiEnableOCR: '启用文字识别 (OCR)',",
            "lineNumber": 372
          },
          {
            "text": "      aiEnableTranslation: '启用文字翻译',",
            "lineNumber": 373
          },
          {
            "text": "      aiConfidence: '识别置信度阈值',",
            "lineNumber": 374
          },
          {
            "text": "      aiAnalyzing: '正在进行 AI 分析...',",
            "lineNumber": 375
          },
          {
            "text": "      aiAnalyzeSuccess: 'AI 分析完成',",
            "lineNumber": 376
          },
          {
            "text": "      testConnection: '测试连接',",
            "lineNumber": 377
          },
          {
            "text": "      testing: '正在连接...',",
            "lineNumber": 378
          },
          {
            "text": "      connectionSuccess: '连接成功',",
            "lineNumber": 379
          },
          {
            "text": "      connectionFailed: '连接失败',",
            "lineNumber": 380
          },
          {
            "text": "      connectionStatus: '连接状态',",
            "lineNumber": 381
          },
          {
            "text": "      statusConnected: '已连接',",
            "lineNumber": 382
          },
          {
            "text": "      statusDisconnected: '未连接',",
            "lineNumber": 383
          },
          {
            "text": "};",
            "lineNumber": 947
          }
        ]
      },
      "score": 0.24302244186401367
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/TopBar.tsx</summary>

</details>
</tool-use>

---



---


将占位符改为直接显示“搜索人物”，不再使用翻译键。


---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "429a9336-b6ea-48f9-8cfe-50c88de317e3"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "src/components/TopBar.tsx"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "src/components/TopBar.tsx"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


已将占位符从翻译键改为直接显示“搜索人物”。在人物界面时，搜索框占位符会显示“搜索人物”，而不是 `search.placeholderPerson`。

修改已完成，代码已通过 linter 检查。

---

_**User**_

为所有标签面板业添加于人物面板一样的搜索框逻辑，当在所有标签面板时，顶部的搜索框仅能搜索所有标签，离开所有标签面板时则恢复搜索的功能。

---

_**Agent (model default, mode Agent)**_



---


查看标签面板的实现，准备添加与人物面板相同的搜索逻辑。


---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "tags-overview 标签面板显示标签列表",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1329
          },
          "endPosition": {
            "line": 1543,
            "column": 1
          }
        },
        "contents": "const useLayout = \n() =&gt; {\n {\n        // Use provided people dictionary to generate IDs, ignore 'items' prop\n        // Filter people by search query if provided\n        let itemsList = Object.values(people || {});\n        if (searchQuery &amp;&amp; searchQuery.trim()) {\n            const query = searchQuery.toLowerCase().trim();\n            itemsList = itemsList.filter(person =&gt; \n                person.name.toLowerCase().includes(query)\n            );\n        }\n        const minColWidth = thumbnailSize;\n        const cols = Math.max(1, Math.floor((finalAvailableWidth + GAP) / (minColWidth + GAP)));\n        const itemWidth = (finalAvailableWidth - (cols - 1) * GAP) / cols;\n        const itemHeight = itemWidth + 60; // Extra space for text\n\n        itemsList.forEach((person, index) =&gt; {\n            const row = Math.floor(index / cols);\n            const col = index % cols;\n            layout.push({\n                id: person.id,\n                x: PADDING + col * (itemWidth + GAP),\n                y: PADDING + row * (itemHeight + GAP),\n                width: itemWidth,\n                height: itemHeight\n            });\n        });\n        const rows = Math.ceil(itemsList.length / cols);\n        totalHeight = PADDING + rows * (itemHeight + GAP);\n    } \n\n    return { layout, totalHeight };\n  }, [items, files, layoutMode, containerWidth, thumbnailSize, viewMode, aspectRatios, people, searchQuery]);\n};\n\ninterface FileGridProps {\n  displayFileIds: string[];\n  files: Record&lt;string, FileNode&gt;;\n  activeTab: TabState;\n  renamingId: string | null;\n  thumbnailSize: number;\n  hoverPlayingId: string | null;\n  onSetHoverPlayingId\n;\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const useLayout = ",
            "lineNumber": 1330
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 1354
          },
          {
            "text": " {",
            "lineNumber": 1465
          },
          {
            "text": "        // Use provided people dictionary to generate IDs, ignore 'items' prop",
            "lineNumber": 1466
          },
          {
            "text": "        // Filter people by search query if provided",
            "lineNumber": 1467
          },
          {
            "text": "        let itemsList = Object.values(people || {});",
            "lineNumber": 1468
          },
          {
            "text": "        if (searchQuery &amp;&amp; searchQuery.trim()) {",
            "lineNumber": 1469
          },
          {
            "text": "            const query = searchQuery.toLowerCase().trim();",
            "lineNumber": 1470
          },
          {
            "text": "            itemsList = itemsList.filter(person =&gt; ",
            "lineNumber": 1471
          },
          {
            "text": "                person.name.toLowerCase().includes(query)",
            "lineNumber": 1472
          },
          {
            "text": "            );",
            "lineNumber": 1473
          },
          {
            "text": "        }",
            "lineNumber": 1474
          },
          {
            "text": "        const minColWidth = thumbnailSize;",
            "lineNumber": 1475
          },
          {
            "text": "        const cols = Math.max(1, Math.floor((finalAvailableWidth + GAP) / (minColWidth + GAP)));",
            "lineNumber": 1476
          },
          {
            "text": "        const itemWidth = (finalAvailableWidth - (cols - 1) * GAP) / cols;",
            "lineNumber": 1477
          },
          {
            "text": "        const itemHeight = itemWidth + 60; // Extra space for text",
            "lineNumber": 1478
          },
          {
            "lineNumber": 1479
          },
          {
            "text": "        itemsList.forEach((person, index) =&gt; {",
            "lineNumber": 1480
          },
          {
            "text": "            const row = Math.floor(index / cols);",
            "lineNumber": 1481
          },
          {
            "text": "            const col = index % cols;",
            "lineNumber": 1482
          },
          {
            "text": "            layout.push({",
            "lineNumber": 1483
          },
          {
            "text": "                id: person.id,",
            "lineNumber": 1484
          },
          {
            "text": "                x: PADDING + col * (itemWidth + GAP),",
            "lineNumber": 1485
          },
          {
            "text": "                y: PADDING + row * (itemHeight + GAP),",
            "lineNumber": 1486
          },
          {
            "text": "                width: itemWidth,",
            "lineNumber": 1487
          },
          {
            "text": "                height: itemHeight",
            "lineNumber": 1488
          },
          {
            "text": "            });",
            "lineNumber": 1489
          },
          {
            "text": "        });",
            "lineNumber": 1490
          },
          {
            "text": "        const rows = Math.ceil(itemsList.length / cols);",
            "lineNumber": 1491
          },
          {
            "text": "        totalHeight = PADDING + rows * (itemHeight + GAP);",
            "lineNumber": 1492
          },
          {
            "text": "    } ",
            "lineNumber": 1493
          },
          {
            "lineNumber": 1494
          },
          {
            "text": "    return { layout, totalHeight };",
            "lineNumber": 1495
          },
          {
            "text": "  }, [items, files, layoutMode, containerWidth, thumbnailSize, viewMode, aspectRatios, people, searchQuery]);",
            "lineNumber": 1496
          },
          {
            "text": "};",
            "lineNumber": 1497
          },
          {
            "lineNumber": 1498
          },
          {
            "text": "interface FileGridProps {",
            "lineNumber": 1499,
            "isSignature": true
          },
          {
            "text": "  displayFileIds: string[];",
            "lineNumber": 1500
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 1501
          },
          {
            "text": "  activeTab: TabState;",
            "lineNumber": 1502
          },
          {
            "text": "  renamingId: string | null;",
            "lineNumber": 1503
          },
          {
            "text": "  thumbnailSize: number;",
            "lineNumber": 1504
          },
          {
            "text": "  hoverPlayingId: string | null;",
            "lineNumber": 1505
          },
          {
            "text": "  onSetHoverPlayingId",
            "lineNumber": 1506
          },
          {
            "text": ";",
            "lineNumber": 1543,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 1544,
            "isSignature": true
          }
        ]
      },
      "score": 0.513731062412262
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nprev =&gt; (\n\n                      }));\n                  }\n              }\n          }\n          \n          showToast(t('settings.aiAnalyzeSuccess'));\n\n      } catch (err) {\n          console.error(err);\n          showToast(\"AI Analysis Failed\");\n      } finally {\n          updateTask(taskId, { status: 'completed', currentStep: t('tasks.completed') });\n          setTimeout(() =&gt; setState(prev =&gt; ({ ...prev, tasks: prev.tasks.filter(t =&gt; t.id !== taskId) })), 1000);\n      }\n  };\n  \n  // Function to analyze all files in a folder\n  const handleFolderAIAnalysis = async (folderId: string) =&gt; {\n      // Get all image files in the folder and check their AI analysis status\n      const getAllImageFilesInFolder = (folderId: string): { id: string; analyzed: boolean }[] =&gt; {\n          const folder = state.files[folderId];\n          if (!folder) return [];\n          \n          let imageFiles: { id: string; analyzed: boolean }[] = [];\n          \n          if (folder.children) {\n              for (const childId of folder.children) {\n                  const child = state.files[childId];\n                  if (child) {\n                      if (child.type === FileType.FOLDER) {\n                          // Recursively get files from subfolders\n                          imageFiles\n;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3599
          },
          {
            "text": "prev =&gt; (",
            "lineNumber": 4369
          },
          {
            "lineNumber": 4377
          },
          {
            "text": "                      }));",
            "lineNumber": 4378
          },
          {
            "text": "                  }",
            "lineNumber": 4379
          },
          {
            "text": "              }",
            "lineNumber": 4380
          },
          {
            "text": "          }",
            "lineNumber": 4381
          },
          {
            "text": "          ",
            "lineNumber": 4382
          },
          {
            "text": "          showToast(t('settings.aiAnalyzeSuccess'));",
            "lineNumber": 4383
          },
          {
            "lineNumber": 4384
          },
          {
            "text": "      } catch (err) {",
            "lineNumber": 4385
          },
          {
            "text": "          console.error(err);",
            "lineNumber": 4386
          },
          {
            "text": "          showToast(\"AI Analysis Failed\");",
            "lineNumber": 4387
          },
          {
            "text": "      } finally {",
            "lineNumber": 4388
          },
          {
            "text": "          updateTask(taskId, { status: 'completed', currentStep: t('tasks.completed') });",
            "lineNumber": 4389
          },
          {
            "text": "          setTimeout(() =&gt; setState(prev =&gt; ({ ...prev, tasks: prev.tasks.filter(t =&gt; t.id !== taskId) })), 1000);",
            "lineNumber": 4390
          },
          {
            "text": "      }",
            "lineNumber": 4391
          },
          {
            "text": "  };",
            "lineNumber": 4392
          },
          {
            "text": "  ",
            "lineNumber": 4393
          },
          {
            "text": "  // Function to analyze all files in a folder",
            "lineNumber": 4394
          },
          {
            "text": "  const handleFolderAIAnalysis = async (folderId: string) =&gt; {",
            "lineNumber": 4395
          },
          {
            "text": "      // Get all image files in the folder and check their AI analysis status",
            "lineNumber": 4396
          },
          {
            "text": "      const getAllImageFilesInFolder = (folderId: string): { id: string; analyzed: boolean }[] =&gt; {",
            "lineNumber": 4397
          },
          {
            "text": "          const folder = state.files[folderId];",
            "lineNumber": 4398
          },
          {
            "text": "          if (!folder) return [];",
            "lineNumber": 4399
          },
          {
            "text": "          ",
            "lineNumber": 4400
          },
          {
            "text": "          let imageFiles: { id: string; analyzed: boolean }[] = [];",
            "lineNumber": 4401
          },
          {
            "text": "          ",
            "lineNumber": 4402
          },
          {
            "text": "          if (folder.children) {",
            "lineNumber": 4403
          },
          {
            "text": "              for (const childId of folder.children) {",
            "lineNumber": 4404
          },
          {
            "text": "                  const child = state.files[childId];",
            "lineNumber": 4405
          },
          {
            "text": "                  if (child) {",
            "lineNumber": 4406
          },
          {
            "text": "                      if (child.type === FileType.FOLDER) {",
            "lineNumber": 4407
          },
          {
            "text": "                          // Recursively get files from subfolders",
            "lineNumber": 4408
          },
          {
            "text": "                          imageFiles",
            "lineNumber": 4409
          },
          {
            "text": ";",
            "lineNumber": 4420
          },
          {
            "text": ";",
            "lineNumber": 4441
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.4880104959011078
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 43
          },
          "endPosition": {
            "line": 195,
            "column": 1
          }
        },
        "contents": "const TagsWidget = \n}\n        &lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div className=\"flex-1 flex overflow-hidden\"&gt;\n        {/* 标签列表内容 */}\n        &lt;div className=\"flex-1 overflow-y-auto p-4 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600\"&gt;\n          {keys.length === 0 &amp;&amp; (\n            &lt;div className=\"text-center text-gray-400 text-xs py-4 italic\"&gt;{t('sidebar.noTagsFound')}&lt;/div&gt;\n          )}\n          {keys.map(key =&gt; (\n            &lt;div id={&#96;tag-widget-group-${key}&#96;} key={key} className=\"mb-4 last:mb-0\"&gt;\n              &lt;div className=\"text-xs font-bold text-gray-400 dark:text-gray-500 mb-2 uppercase border-b border-gray-100 dark:border-gray-800 pb-1\"&gt;{key}&lt;/div&gt;\n              &lt;div className=\"flex flex-wrap gap-2\"&gt;\n                {filteredGroupedTags[key].map(tag =&gt; (\n                  &lt;button\n                    key={tag}\n                    onClick={(e) =&gt; onTagClick(tag, e)}\n                    className=\"text-xs px-2.5 py-1 rounded-md bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/40 border border-blue-100 dark:border-blue-900/30 transition-colors truncate max-w-full text-left\"\n                    title={tag}\n                  &gt;\n                    {tag}\n                  &lt;/button&gt;\n                ))}\n              &lt;/div&gt;\n            &lt;/div&gt;\n          ))}\n        &lt;/div&gt;\n        {/* 字母索引栏 */}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 42,
                "column": 1
              },
              "endPosition": {
                "line": 42,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 42,
                "column": 7
              },
              "endPosition": {
                "line": 42,
                "column": 20
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsWidget = ",
            "lineNumber": 44
          },
          {
            "text": "}",
            "lineNumber": 146
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 147
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 148
          },
          {
            "text": "      &lt;div className=\"flex-1 flex overflow-hidden\"&gt;",
            "lineNumber": 149
          },
          {
            "text": "        {/* 标签列表内容 */}",
            "lineNumber": 150
          },
          {
            "text": "        &lt;div className=\"flex-1 overflow-y-auto p-4 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600\"&gt;",
            "lineNumber": 151
          },
          {
            "text": "          {keys.length === 0 &amp;&amp; (",
            "lineNumber": 152
          },
          {
            "text": "            &lt;div className=\"text-center text-gray-400 text-xs py-4 italic\"&gt;{t('sidebar.noTagsFound')}&lt;/div&gt;",
            "lineNumber": 153
          },
          {
            "text": "          )}",
            "lineNumber": 154
          },
          {
            "text": "          {keys.map(key =&gt; (",
            "lineNumber": 155
          },
          {
            "text": "            &lt;div id={&#96;tag-widget-group-${key}&#96;} key={key} className=\"mb-4 last:mb-0\"&gt;",
            "lineNumber": 156
          },
          {
            "text": "              &lt;div className=\"text-xs font-bold text-gray-400 dark:text-gray-500 mb-2 uppercase border-b border-gray-100 dark:border-gray-800 pb-1\"&gt;{key}&lt;/div&gt;",
            "lineNumber": 157
          },
          {
            "text": "              &lt;div className=\"flex flex-wrap gap-2\"&gt;",
            "lineNumber": 158
          },
          {
            "text": "                {filteredGroupedTags[key].map(tag =&gt; (",
            "lineNumber": 159
          },
          {
            "text": "                  &lt;button",
            "lineNumber": 160
          },
          {
            "text": "                    key={tag}",
            "lineNumber": 161
          },
          {
            "text": "                    onClick={(e) =&gt; onTagClick(tag, e)}",
            "lineNumber": 162
          },
          {
            "text": "                    className=\"text-xs px-2.5 py-1 rounded-md bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/40 border border-blue-100 dark:border-blue-900/30 transition-colors truncate max-w-full text-left\"",
            "lineNumber": 163
          },
          {
            "text": "                    title={tag}",
            "lineNumber": 164
          },
          {
            "text": "                  &gt;",
            "lineNumber": 165
          },
          {
            "text": "                    {tag}",
            "lineNumber": 166
          },
          {
            "text": "                  &lt;/button&gt;",
            "lineNumber": 167
          },
          {
            "text": "                ))}",
            "lineNumber": 168
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 169
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 170
          },
          {
            "text": "          ))}",
            "lineNumber": 171
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 172
          },
          {
            "text": "        {/* 字母索引栏 */}",
            "lineNumber": 173
          },
          {
            "text": ";",
            "lineNumber": 196
          }
        ]
      },
      "score": 0.44667351245880127
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 363
          },
          "endPosition": {
            "line": 501,
            "column": 1
          }
        },
        "contents": "const findImagesDeeply = \nwhile (stack.length &gt; 0 &amp;&amp; traversalCount &lt; MAX_TRAVERSAL) {\n\n        if (!node) continue;\n        \n        if (node.type === FileType.IMAGE) {\n            images.push(node);\n        } else if (node.type === FileType.FOLDER &amp;&amp; node.children) {\n            stack.push(...node.children);\n        }\n    }\n    \n    // 排序并切片\n    return images\n        .sort((a, b) =&gt; (b.updatedAt || b.createdAt || '').localeCompare(a.updatedAt || a.createdAt || ''))\n        .slice(0, limit);\n};\n\nexport const FolderThumbnail = React.memo(({ file, files, mode, resourceRoot, cachePath }: { file: FileNode; files: Record&lt;string, FileNode&gt;, mode: LayoutMode, resourceRoot?: string, cachePath?: string }) =&gt; {\n  const [ref, isInView, wasInView] = useInView({ rootMargin: '200px' });\n  \n  // 1. 同步计算需要展示的子文件 (改为深度查找)\n  const imageChildren = useMemo(() =&gt; {\n      if (!file.children || file.children.length === 0) return [];\n      return findImagesDeeply(file, files, 3);\n  }, [file, files]);\n\n  // 2. 初始化时尝试从全局缓存同步读取\n  const [previewSrcs, setPreviewSrcs] = useState&lt;string[]&gt;(() =&gt; {\n      const cache = getGlobalCache();\n      // 尝试映射所有子文件到缓存中的 URL\n      const cachedUrls = imageChildren.map(child =&gt; {\n          // 使用与 ImageThumbnail 相同的 Key 生成逻辑 (仅 filePath)\n          return cache.get(child.path) || null; \n      });\n      \n      // 只有当所有需要的图片都有缓存时，才视为命中 (或者至少有一张？)\n      // 为了体验最好，只要有缓存就先用。过滤掉 null。\n      const validUrls = cachedUrls.filter((url): url is string =&gt; !!url);\n  };\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 284,
                "column": 1
              },
              "endPosition": {
                "line": 284,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 7
              },
              "endPosition": {
                "line": 284,
                "column": 18
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 29
              },
              "endPosition": {
                "line": 285,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const findImagesDeeply = ",
            "lineNumber": 364
          },
          {
            "text": "while (stack.length &gt; 0 &amp;&amp; traversalCount &lt; MAX_TRAVERSAL) {",
            "lineNumber": 378
          },
          {
            "lineNumber": 384
          },
          {
            "text": "        if (!node) continue;",
            "lineNumber": 385
          },
          {
            "text": "        ",
            "lineNumber": 386
          },
          {
            "text": "        if (node.type === FileType.IMAGE) {",
            "lineNumber": 387
          },
          {
            "text": "            images.push(node);",
            "lineNumber": 388
          },
          {
            "text": "        } else if (node.type === FileType.FOLDER &amp;&amp; node.children) {",
            "lineNumber": 389
          },
          {
            "text": "            stack.push(...node.children);",
            "lineNumber": 390
          },
          {
            "text": "        }",
            "lineNumber": 391
          },
          {
            "text": "    }",
            "lineNumber": 392
          },
          {
            "text": "    ",
            "lineNumber": 393
          },
          {
            "text": "    // 排序并切片",
            "lineNumber": 394
          },
          {
            "text": "    return images",
            "lineNumber": 395
          },
          {
            "text": "        .sort((a, b) =&gt; (b.updatedAt || b.createdAt || '').localeCompare(a.updatedAt || a.createdAt || ''))",
            "lineNumber": 396
          },
          {
            "text": "        .slice(0, limit);",
            "lineNumber": 397
          },
          {
            "text": "};",
            "lineNumber": 398
          },
          {
            "lineNumber": 399
          },
          {
            "text": "export const FolderThumbnail = React.memo(({ file, files, mode, resourceRoot, cachePath }: { file: FileNode; files: Record&lt;string, FileNode&gt;, mode: LayoutMode, resourceRoot?: string, cachePath?: string }) =&gt; {",
            "lineNumber": 400
          },
          {
            "text": "  const [ref, isInView, wasInView] = useInView({ rootMargin: '200px' });",
            "lineNumber": 401
          },
          {
            "text": "  ",
            "lineNumber": 402
          },
          {
            "text": "  // 1. 同步计算需要展示的子文件 (改为深度查找)",
            "lineNumber": 403
          },
          {
            "text": "  const imageChildren = useMemo(() =&gt; {",
            "lineNumber": 404
          },
          {
            "text": "      if (!file.children || file.children.length === 0) return [];",
            "lineNumber": 405
          },
          {
            "text": "      return findImagesDeeply(file, files, 3);",
            "lineNumber": 406
          },
          {
            "text": "  }, [file, files]);",
            "lineNumber": 407
          },
          {
            "lineNumber": 408
          },
          {
            "text": "  // 2. 初始化时尝试从全局缓存同步读取",
            "lineNumber": 409
          },
          {
            "text": "  const [previewSrcs, setPreviewSrcs] = useState&lt;string[]&gt;(() =&gt; {",
            "lineNumber": 410
          },
          {
            "text": "      const cache = getGlobalCache();",
            "lineNumber": 411
          },
          {
            "text": "      // 尝试映射所有子文件到缓存中的 URL",
            "lineNumber": 412
          },
          {
            "text": "      const cachedUrls = imageChildren.map(child =&gt; {",
            "lineNumber": 413
          },
          {
            "text": "          // 使用与 ImageThumbnail 相同的 Key 生成逻辑 (仅 filePath)",
            "lineNumber": 414
          },
          {
            "text": "          return cache.get(child.path) || null; ",
            "lineNumber": 415
          },
          {
            "text": "      });",
            "lineNumber": 416
          },
          {
            "text": "      ",
            "lineNumber": 417
          },
          {
            "text": "      // 只有当所有需要的图片都有缓存时，才视为命中 (或者至少有一张？)",
            "lineNumber": 418
          },
          {
            "text": "      // 为了体验最好，只要有缓存就先用。过滤掉 null。",
            "lineNumber": 419
          },
          {
            "text": "      const validUrls = cachedUrls.filter((url): url is string =&gt; !!url);",
            "lineNumber": 420
          },
          {
            "text": "  };",
            "lineNumber": 424
          },
          {
            "text": "};",
            "lineNumber": 502
          }
        ]
      },
      "score": 0.44575148820877075
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 213
          },
          "endPosition": {
            "line": 360,
            "column": 1
          }
        },
        "contents": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { \n  src: string; \n  alt: string; \n  isSelected: boolean;\n  filePath?: string;\n  modified?: string;\n  size?: number;\n  isHovering?: boolean;\n  fileMeta?: { format?: string };\n  resourceRoot?: string;\n  cachePath?: string;\n}) =&gt; {\n() =&gt; {\n\n\n      return () =&gt; {\n        controller.abort();\n      };\n    }\n  }, [filePath, modified, resourceRoot, isInView, wasInView]);\n\n\n\n  React.useEffect(() =&gt; {\n    let isMounted = true;\n\n    const loadAnimation = async () =&gt; {\n      if (isHovering &amp;&amp; filePath) {\n        // 从文件路径提取格式\n        const fileName = filePath.split(/[\\\\/]/).pop() || '';\n        const fileExt = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase();\n        const isAnimationFormat = (fileMeta?.format === 'gif' || fileMeta?.format === 'webp') || (fileExt === 'gif' || fileExt === 'webp');\n        \n        if (isAnimationFormat) {\n          try {\n            // 使用readFileAsBase64直接读取文件内容，避免使用http://asset.localhost/协议\n            const { readFileAsBase64 } = await import('../api/tauri-bridge');\n            \n            if (!isMounted) return;\n\n            const dataUrl = await readFileAsBase64(filePath);\n            \n            if (isMounted) {\n              if (dataUrl) {\n                setAnimSrc(dataUrl);\n              } else {\n                setAnimSrc(null);\n              }\n            }\n          } catch (e) {\n            setAnimSrc(null);\n          }\n        } else {\n          if (isMounted) {\n            setAnimSrc(null);\n          }\n        }\n      } else {\n        if (isMounted) {\n          setAnimSrc(null);\n        }\n      }\n    };\n\n    loadAnimation();\n\n    return\n  }\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { ",
            "lineNumber": 214
          },
          {
            "text": "  src: string; ",
            "lineNumber": 215
          },
          {
            "text": "  alt: string; ",
            "lineNumber": 216
          },
          {
            "text": "  isSelected: boolean;",
            "lineNumber": 217
          },
          {
            "text": "  filePath?: string;",
            "lineNumber": 218
          },
          {
            "text": "  modified?: string;",
            "lineNumber": 219
          },
          {
            "text": "  size?: number;",
            "lineNumber": 220
          },
          {
            "text": "  isHovering?: boolean;",
            "lineNumber": 221
          },
          {
            "text": "  fileMeta?: { format?: string };",
            "lineNumber": 222
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 223
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 224
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 225
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 242
          },
          {
            "lineNumber": 281
          },
          {
            "lineNumber": 282
          },
          {
            "text": "      return () =&gt; {",
            "lineNumber": 283
          },
          {
            "text": "        controller.abort();",
            "lineNumber": 284
          },
          {
            "text": "      };",
            "lineNumber": 285
          },
          {
            "text": "    }",
            "lineNumber": 286
          },
          {
            "text": "  }, [filePath, modified, resourceRoot, isInView, wasInView]);",
            "lineNumber": 287
          },
          {
            "lineNumber": 288
          },
          {
            "lineNumber": 289
          },
          {
            "lineNumber": 290
          },
          {
            "text": "  React.useEffect(() =&gt; {",
            "lineNumber": 291
          },
          {
            "text": "    let isMounted = true;",
            "lineNumber": 292
          },
          {
            "lineNumber": 293
          },
          {
            "text": "    const loadAnimation = async () =&gt; {",
            "lineNumber": 294
          },
          {
            "text": "      if (isHovering &amp;&amp; filePath) {",
            "lineNumber": 295
          },
          {
            "text": "        // 从文件路径提取格式",
            "lineNumber": 296
          },
          {
            "text": "        const fileName = filePath.split(/[\\\\/]/).pop() || '';",
            "lineNumber": 297
          },
          {
            "text": "        const fileExt = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase();",
            "lineNumber": 298
          },
          {
            "text": "        const isAnimationFormat = (fileMeta?.format === 'gif' || fileMeta?.format === 'webp') || (fileExt === 'gif' || fileExt === 'webp');",
            "lineNumber": 299
          },
          {
            "text": "        ",
            "lineNumber": 300
          },
          {
            "text": "        if (isAnimationFormat) {",
            "lineNumber": 301
          },
          {
            "text": "          try {",
            "lineNumber": 302
          },
          {
            "text": "            // 使用readFileAsBase64直接读取文件内容，避免使用http://asset.localhost/协议",
            "lineNumber": 303
          },
          {
            "text": "            const { readFileAsBase64 } = await import('../api/tauri-bridge');",
            "lineNumber": 304
          },
          {
            "text": "            ",
            "lineNumber": 305
          },
          {
            "text": "            if (!isMounted) return;",
            "lineNumber": 306
          },
          {
            "lineNumber": 307
          },
          {
            "text": "            const dataUrl = await readFileAsBase64(filePath);",
            "lineNumber": 308
          },
          {
            "text": "            ",
            "lineNumber": 309
          },
          {
            "text": "            if (isMounted) {",
            "lineNumber": 310
          },
          {
            "text": "              if (dataUrl) {",
            "lineNumber": 311
          },
          {
            "text": "                setAnimSrc(dataUrl);",
            "lineNumber": 312
          },
          {
            "text": "              } else {",
            "lineNumber": 313
          },
          {
            "text": "                setAnimSrc(null);",
            "lineNumber": 314
          },
          {
            "text": "              }",
            "lineNumber": 315
          },
          {
            "text": "            }",
            "lineNumber": 316
          },
          {
            "text": "          } catch (e) {",
            "lineNumber": 317
          },
          {
            "text": "            setAnimSrc(null);",
            "lineNumber": 318
          },
          {
            "text": "          }",
            "lineNumber": 319
          },
          {
            "text": "        } else {",
            "lineNumber": 320
          },
          {
            "text": "          if (isMounted) {",
            "lineNumber": 321
          },
          {
            "text": "            setAnimSrc(null);",
            "lineNumber": 322
          },
          {
            "text": "          }",
            "lineNumber": 323
          },
          {
            "text": "        }",
            "lineNumber": 324
          },
          {
            "text": "      } else {",
            "lineNumber": 325
          },
          {
            "text": "        if (isMounted) {",
            "lineNumber": 326
          },
          {
            "text": "          setAnimSrc(null);",
            "lineNumber": 327
          },
          {
            "text": "        }",
            "lineNumber": 328
          },
          {
            "text": "      }",
            "lineNumber": 329
          },
          {
            "text": "    };",
            "lineNumber": 330
          },
          {
            "lineNumber": 331
          },
          {
            "text": "    loadAnimation();",
            "lineNumber": 332
          },
          {
            "lineNumber": 333
          },
          {
            "text": "    return",
            "lineNumber": 334
          },
          {
            "text": "  }",
            "lineNumber": 337
          },
          {
            "text": "};",
            "lineNumber": 361
          }
        ]
      },
      "score": 0.4289408028125763
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\n\n                          activeTab={activeTab}\n                      /&gt;\n                  );\n              })()\n          )}\n          {!activeTab.viewingFileId &amp;&amp; (\n            &lt;&gt;\n              &lt;TopBar \n                activeTab={activeTab} \n                state={state} \n                toolbarQuery={toolbarQuery} \n                groupedTags={groupedTags} \n                tagSearchQuery={tagSearchQuery} \n                onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))} \n                onGoBack={goBack} \n                onGoForward={goForward} \n                onNavigateUp={handleNavigateUp} \n                onSetTagSearchQuery={setTagSearchQuery} \n                onTagClick={handleTagClick} \n                onRefresh={handleRefresh} \n                onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })} \n                onPerformSearch={handlePerformSearch} \n                onSetToolbarQuery={(query) =&gt; {\n                    setToolbarQuery(query);\n                    // 在人物面板时，实时更新搜索查询以过滤人物\n                    if (activeTab.viewMode === 'people-overview')\n                }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4472
          },
          {
            "lineNumber": 4524
          },
          {
            "text": "                          activeTab={activeTab}",
            "lineNumber": 4525
          },
          {
            "text": "                      /&gt;",
            "lineNumber": 4526
          },
          {
            "text": "                  );",
            "lineNumber": 4527
          },
          {
            "text": "              })()",
            "lineNumber": 4528
          },
          {
            "text": "          )}",
            "lineNumber": 4529
          },
          {
            "text": "          {!activeTab.viewingFileId &amp;&amp; (",
            "lineNumber": 4530
          },
          {
            "text": "            &lt;&gt;",
            "lineNumber": 4531
          },
          {
            "text": "              &lt;TopBar ",
            "lineNumber": 4532
          },
          {
            "text": "                activeTab={activeTab} ",
            "lineNumber": 4533
          },
          {
            "text": "                state={state} ",
            "lineNumber": 4534
          },
          {
            "text": "                toolbarQuery={toolbarQuery} ",
            "lineNumber": 4535
          },
          {
            "text": "                groupedTags={groupedTags} ",
            "lineNumber": 4536
          },
          {
            "text": "                tagSearchQuery={tagSearchQuery} ",
            "lineNumber": 4537
          },
          {
            "text": "                onToggleSidebar={() =&gt; setState(s =&gt; ({ ...s, layout: { ...s.layout, isSidebarVisible: !s.layout.isSidebarVisible } }))} ",
            "lineNumber": 4538
          },
          {
            "text": "                onGoBack={goBack} ",
            "lineNumber": 4539
          },
          {
            "text": "                onGoForward={goForward} ",
            "lineNumber": 4540
          },
          {
            "text": "                onNavigateUp={handleNavigateUp} ",
            "lineNumber": 4541
          },
          {
            "text": "                onSetTagSearchQuery={setTagSearchQuery} ",
            "lineNumber": 4542
          },
          {
            "text": "                onTagClick={handleTagClick} ",
            "lineNumber": 4543
          },
          {
            "text": "                onRefresh={handleRefresh} ",
            "lineNumber": 4544
          },
          {
            "text": "                onSearchScopeChange={(scope) =&gt; updateActiveTab({ searchScope: scope })} ",
            "lineNumber": 4545
          },
          {
            "text": "                onPerformSearch={handlePerformSearch} ",
            "lineNumber": 4546
          },
          {
            "text": "                onSetToolbarQuery={(query) =&gt; {",
            "lineNumber": 4547
          },
          {
            "text": "                    setToolbarQuery(query);",
            "lineNumber": 4548
          },
          {
            "text": "                    // 在人物面板时，实时更新搜索查询以过滤人物",
            "lineNumber": 4549
          },
          {
            "text": "                    if (activeTab.viewMode === 'people-overview')",
            "lineNumber": 4550
          },
          {
            "text": "                }",
            "lineNumber": 4553
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.4226628541946411
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleRenameTag = \nprev =&gt; {\n\n          \n          // Update tabs with tag references\n          const newTabs = prev.tabs.map(tab =&gt; {\n              let updatedTab = { ...tab };\n              \n              // Update tab's search query if it's searching for the old tag\n              if (updatedTab.searchQuery === oldTag) {\n                  updatedTab.searchQuery = trimmedNewTag;\n              }\n              \n              // Update tab's active tags if the old tag is active\n              if (updatedTab.activeTags.includes(oldTag)) {\n                  updatedTab.activeTags = updatedTab.activeTags.map(tag =&gt; tag === oldTag ? trimmedNewTag : tag);\n              }\n              \n              // Update tab's selected tag ids if the old tag is selected\n              if (updatedTab.selectedTagIds.includes(oldTag)) {\n                  updatedTab.selectedTagIds = updatedTab.selectedTagIds.map(tag =&gt; tag === oldTag ? trimmedNewTag : tag);\n              }\n              \n              return updatedTab;\n          });\n          \n          return {\n              ...prev,\n              files: newFiles,\n              customTags: newCustomTags,\n              tabs: newTabs,\n              activeModal: { type: null }\n          };\n      });\n  };\n  \n  const handleRenamePerson = (personId: string, newName: string) =&gt; {\n      if (!newName.trim()) return;\n      setState(prev =&gt; ({\n          ...prev,\n          people: {\n              ...prev.people,\n              [personId]: { ...prev.people[personId], name: newName }\n          },\n          activeModal: { type: null }\n      }));\n  };\n\n  const handleUpdatePerson = (personId: string, updates: Partial&lt;Person&gt;) =&gt; {\n      setState(prev =&gt; ({\n          ...prev,\n          people: {\n              ...prev.people,\n)\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleRenameTag = ",
            "lineNumber": 2353
          },
          {
            "text": "prev =&gt; {",
            "lineNumber": 2358
          },
          {
            "lineNumber": 2372
          },
          {
            "text": "          ",
            "lineNumber": 2373
          },
          {
            "text": "          // Update tabs with tag references",
            "lineNumber": 2374
          },
          {
            "text": "          const newTabs = prev.tabs.map(tab =&gt; {",
            "lineNumber": 2375
          },
          {
            "text": "              let updatedTab = { ...tab };",
            "lineNumber": 2376
          },
          {
            "text": "              ",
            "lineNumber": 2377
          },
          {
            "text": "              // Update tab's search query if it's searching for the old tag",
            "lineNumber": 2378
          },
          {
            "text": "              if (updatedTab.searchQuery === oldTag) {",
            "lineNumber": 2379
          },
          {
            "text": "                  updatedTab.searchQuery = trimmedNewTag;",
            "lineNumber": 2380
          },
          {
            "text": "              }",
            "lineNumber": 2381
          },
          {
            "text": "              ",
            "lineNumber": 2382
          },
          {
            "text": "              // Update tab's active tags if the old tag is active",
            "lineNumber": 2383
          },
          {
            "text": "              if (updatedTab.activeTags.includes(oldTag)) {",
            "lineNumber": 2384
          },
          {
            "text": "                  updatedTab.activeTags = updatedTab.activeTags.map(tag =&gt; tag === oldTag ? trimmedNewTag : tag);",
            "lineNumber": 2385
          },
          {
            "text": "              }",
            "lineNumber": 2386
          },
          {
            "text": "              ",
            "lineNumber": 2387
          },
          {
            "text": "              // Update tab's selected tag ids if the old tag is selected",
            "lineNumber": 2388
          },
          {
            "text": "              if (updatedTab.selectedTagIds.includes(oldTag)) {",
            "lineNumber": 2389
          },
          {
            "text": "                  updatedTab.selectedTagIds = updatedTab.selectedTagIds.map(tag =&gt; tag === oldTag ? trimmedNewTag : tag);",
            "lineNumber": 2390
          },
          {
            "text": "              }",
            "lineNumber": 2391
          },
          {
            "text": "              ",
            "lineNumber": 2392
          },
          {
            "text": "              return updatedTab;",
            "lineNumber": 2393
          },
          {
            "text": "          });",
            "lineNumber": 2394
          },
          {
            "text": "          ",
            "lineNumber": 2395
          },
          {
            "text": "          return {",
            "lineNumber": 2396
          },
          {
            "text": "              ...prev,",
            "lineNumber": 2397
          },
          {
            "text": "              files: newFiles,",
            "lineNumber": 2398
          },
          {
            "text": "              customTags: newCustomTags,",
            "lineNumber": 2399
          },
          {
            "text": "              tabs: newTabs,",
            "lineNumber": 2400
          },
          {
            "text": "              activeModal: { type: null }",
            "lineNumber": 2401
          },
          {
            "text": "          };",
            "lineNumber": 2402
          },
          {
            "text": "      });",
            "lineNumber": 2403
          },
          {
            "text": "  };",
            "lineNumber": 2404
          },
          {
            "text": "  ",
            "lineNumber": 2405
          },
          {
            "text": "  const handleRenamePerson = (personId: string, newName: string) =&gt; {",
            "lineNumber": 2406
          },
          {
            "text": "      if (!newName.trim()) return;",
            "lineNumber": 2407
          },
          {
            "text": "      setState(prev =&gt; ({",
            "lineNumber": 2408
          },
          {
            "text": "          ...prev,",
            "lineNumber": 2409
          },
          {
            "text": "          people: {",
            "lineNumber": 2410
          },
          {
            "text": "              ...prev.people,",
            "lineNumber": 2411
          },
          {
            "text": "              [personId]: { ...prev.people[personId], name: newName }",
            "lineNumber": 2412
          },
          {
            "text": "          },",
            "lineNumber": 2413
          },
          {
            "text": "          activeModal: { type: null }",
            "lineNumber": 2414
          },
          {
            "text": "      }));",
            "lineNumber": 2415
          },
          {
            "text": "  };",
            "lineNumber": 2416
          },
          {
            "lineNumber": 2417
          },
          {
            "text": "  const handleUpdatePerson = (personId: string, updates: Partial&lt;Person&gt;) =&gt; {",
            "lineNumber": 2418
          },
          {
            "text": "      setState(prev =&gt; ({",
            "lineNumber": 2419
          },
          {
            "text": "          ...prev,",
            "lineNumber": 2420
          },
          {
            "text": "          people: {",
            "lineNumber": 2421
          },
          {
            "text": "              ...prev.people,",
            "lineNumber": 2422
          },
          {
            "text": ")",
            "lineNumber": 2425
          },
          {
            "text": ";",
            "lineNumber": 2426
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.41411200165748596
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 231
          },
          "endPosition": {
            "line": 465
          }
        },
        "contents": "const TagSection: React.FC&lt;TagSectionProps&gt; = \ntag =&gt; (\n\n              &lt;div \n                className={&#96;py-1 px-2 rounded cursor-pointer flex items-center justify-between transition-colors\n                   ${dragOverTag === tag \n                      ? 'bg-blue-200 dark:bg-blue-900 border border-blue-400 dark:border-blue-500' \n                      : 'hover:bg-blue-100 dark:hover:bg-blue-900/30 hover:text-blue-700 dark:text-gray-300 dark:hover:text-blue-300 border border-transparent'}\n                &#96;}\n                onClick={() =&gt; onTagSelect(tag)}\n              &gt;\n                 &lt;span className=\"pointer-events-none\"&gt;{tag}&lt;/span&gt;\n                 &lt;span className=\"text-[10px] text-gray-500 dark:text-gray-600 bg-gray-200 dark:bg-gray-800 px-1.5 rounded-full pointer-events-none\"&gt;\n                   {Object.values(files).filter((f: FileNode) =&gt; f.tags.includes(tag)).length}\n                 &lt;/span&gt;\n              &lt;/div&gt;\n              \n              {hoveredTag === tag &amp;&amp; previewImages.length &gt; 0 &amp;&amp;\n          )",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 232,
                "column": 1
              },
              "endPosition": {
                "line": 232,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 232,
                "column": 7
              },
              "endPosition": {
                "line": 232,
                "column": 47
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 12
              },
              "endPosition": {
                "line": 387,
                "column": 12
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 27
              },
              "endPosition": {
                "line": 388,
                "column": 13
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagSection: React.FC&lt;TagSectionProps&gt; = ",
            "lineNumber": 232
          },
          {
            "text": "tag =&gt; (",
            "lineNumber": 387
          },
          {
            "lineNumber": 420
          },
          {
            "text": "              &lt;div ",
            "lineNumber": 421
          },
          {
            "text": "                className={&#96;py-1 px-2 rounded cursor-pointer flex items-center justify-between transition-colors",
            "lineNumber": 422
          },
          {
            "text": "                   ${dragOverTag === tag ",
            "lineNumber": 423
          },
          {
            "text": "                      ? 'bg-blue-200 dark:bg-blue-900 border border-blue-400 dark:border-blue-500' ",
            "lineNumber": 424
          },
          {
            "text": "                      : 'hover:bg-blue-100 dark:hover:bg-blue-900/30 hover:text-blue-700 dark:text-gray-300 dark:hover:text-blue-300 border border-transparent'}",
            "lineNumber": 425
          },
          {
            "text": "                &#96;}",
            "lineNumber": 426
          },
          {
            "text": "                onClick={() =&gt; onTagSelect(tag)}",
            "lineNumber": 427
          },
          {
            "text": "              &gt;",
            "lineNumber": 428
          },
          {
            "text": "                 &lt;span className=\"pointer-events-none\"&gt;{tag}&lt;/span&gt;",
            "lineNumber": 429
          },
          {
            "text": "                 &lt;span className=\"text-[10px] text-gray-500 dark:text-gray-600 bg-gray-200 dark:bg-gray-800 px-1.5 rounded-full pointer-events-none\"&gt;",
            "lineNumber": 430
          },
          {
            "text": "                   {Object.values(files).filter((f: FileNode) =&gt; f.tags.includes(tag)).length}",
            "lineNumber": 431
          },
          {
            "text": "                 &lt;/span&gt;",
            "lineNumber": 432
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 433
          },
          {
            "text": "              ",
            "lineNumber": 434
          },
          {
            "text": "              {hoveredTag === tag &amp;&amp; previewImages.length &gt; 0 &amp;&amp;",
            "lineNumber": 435
          },
          {
            "text": "          )",
            "lineNumber": 458
          }
        ]
      },
      "score": 0.4054717421531677
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 213
          },
          "endPosition": {
            "line": 397,
            "column": 1
          }
        },
        "contents": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { \n  src: string; \n  alt: string; \n  isSelected: boolean;\n  filePath?: string;\n  modified?: string;\n  size?: number;\n  isHovering?: boolean;\n  fileMeta?: { format?: string };\n  resourceRoot?: string;\n  cachePath?: string;\n}) =&gt; {\n size={24} /&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/div&gt;\n  );\n});\n\n// 辅助函数：深度查找文件夹内的图片\nconst findImagesDeeply = (\n    rootFolder: FileNode, \n    allFiles: Record&lt;string, FileNode&gt;, \n    limit: number = 3\n): FileNode[] =&gt; {\n    const images: FileNode[] = [];\n    // 使用栈进行 DFS，或者队列进行 BFS\n    const stack: string[] = [...(rootFolder.children || [])];\n    const visited = new Set&lt;string&gt;(); // 防止循环引用\n    \n    // 设置一个遍历上限，防止超大文件夹卡死 UI\n    let traversalCount = 0;\n    const MAX_TRAVERSAL = 500; \n\n    while (stack.length &gt; 0 &amp;&amp; traversalCount &lt; MAX_TRAVERSAL) {\n        const id = stack.pop()!;\n        if (visited.has(id)) continue;\n        visited.add(id);\n        traversalCount++;\n\n        const node = allFiles[id];\n        if (!node) continue;\n        \n        if (node.type === FileType.IMAGE) {\n            images.push(node);\n        }\n    }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 284,
                "column": 1
              },
              "endPosition": {
                "line": 284,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 7
              },
              "endPosition": {
                "line": 284,
                "column": 18
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 29
              },
              "endPosition": {
                "line": 285,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { ",
            "lineNumber": 214
          },
          {
            "text": "  src: string; ",
            "lineNumber": 215
          },
          {
            "text": "  alt: string; ",
            "lineNumber": 216
          },
          {
            "text": "  isSelected: boolean;",
            "lineNumber": 217
          },
          {
            "text": "  filePath?: string;",
            "lineNumber": 218
          },
          {
            "text": "  modified?: string;",
            "lineNumber": 219
          },
          {
            "text": "  size?: number;",
            "lineNumber": 220
          },
          {
            "text": "  isHovering?: boolean;",
            "lineNumber": 221
          },
          {
            "text": "  fileMeta?: { format?: string };",
            "lineNumber": 222
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 223
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 224
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 225
          },
          {
            "text": " size={24} /&gt;",
            "lineNumber": 356
          },
          {
            "text": "        )}",
            "lineNumber": 357
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 358
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 359
          },
          {
            "text": "  );",
            "lineNumber": 360
          },
          {
            "text": "});",
            "lineNumber": 361
          },
          {
            "lineNumber": 362
          },
          {
            "text": "// 辅助函数：深度查找文件夹内的图片",
            "lineNumber": 363
          },
          {
            "text": "const findImagesDeeply = (",
            "lineNumber": 364
          },
          {
            "text": "    rootFolder: FileNode, ",
            "lineNumber": 365
          },
          {
            "text": "    allFiles: Record&lt;string, FileNode&gt;, ",
            "lineNumber": 366
          },
          {
            "text": "    limit: number = 3",
            "lineNumber": 367
          },
          {
            "text": "): FileNode[] =&gt; {",
            "lineNumber": 368
          },
          {
            "text": "    const images: FileNode[] = [];",
            "lineNumber": 369
          },
          {
            "text": "    // 使用栈进行 DFS，或者队列进行 BFS",
            "lineNumber": 370
          },
          {
            "text": "    const stack: string[] = [...(rootFolder.children || [])];",
            "lineNumber": 371
          },
          {
            "text": "    const visited = new Set&lt;string&gt;(); // 防止循环引用",
            "lineNumber": 372
          },
          {
            "text": "    ",
            "lineNumber": 373
          },
          {
            "text": "    // 设置一个遍历上限，防止超大文件夹卡死 UI",
            "lineNumber": 374
          },
          {
            "text": "    let traversalCount = 0;",
            "lineNumber": 375
          },
          {
            "text": "    const MAX_TRAVERSAL = 500; ",
            "lineNumber": 376
          },
          {
            "lineNumber": 377
          },
          {
            "text": "    while (stack.length &gt; 0 &amp;&amp; traversalCount &lt; MAX_TRAVERSAL) {",
            "lineNumber": 378
          },
          {
            "text": "        const id = stack.pop()!;",
            "lineNumber": 379
          },
          {
            "text": "        if (visited.has(id)) continue;",
            "lineNumber": 380
          },
          {
            "text": "        visited.add(id);",
            "lineNumber": 381
          },
          {
            "text": "        traversalCount++;",
            "lineNumber": 382
          },
          {
            "lineNumber": 383
          },
          {
            "text": "        const node = allFiles[id];",
            "lineNumber": 384
          },
          {
            "text": "        if (!node) continue;",
            "lineNumber": 385
          },
          {
            "text": "        ",
            "lineNumber": 386
          },
          {
            "text": "        if (node.type === FileType.IMAGE) {",
            "lineNumber": 387
          },
          {
            "text": "            images.push(node);",
            "lineNumber": 388
          },
          {
            "text": "        }",
            "lineNumber": 389
          },
          {
            "text": "    }",
            "lineNumber": 392
          },
          {
            "text": ";",
            "lineNumber": 398
          }
        ]
      },
      "score": 0.40308329463005066
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 213
          },
          "endPosition": {
            "line": 360,
            "column": 1
          }
        },
        "contents": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { \n  src: string; \n  alt: string; \n  isSelected: boolean;\n  filePath?: string;\n  modified?: string;\n  size?: number;\n  isHovering?: boolean;\n  fileMeta?: { format?: string };\n  resourceRoot?: string;\n  cachePath?: string;\n}) =&gt; {\n() =&gt; {\nconst loadThumbnail = async \n\n        \n        try {\n          const { getThumbnail } = await import('../api/tauri-bridge');\n          const thumbnail = await getThumbnail(filePath, modified, resourceRoot, controller.signal);\n          \n          if (!controller.signal.aborted &amp;&amp; thumbnail) {\n            // 更新全局缓存\n            if (cache.get(key) !== thumbnail) {\n                cache.set(key, thumbnail);\n                setThumbnailSrc(thumbnail);\n            }\n          }\n        } catch (error) {\n          if (!controller.signal.aborted) {\n            console.error('Failed to load thumbnail:', error);\n          }\n        } finally {\n          if (!controller.signal.aborted) {\n            setLoading(false);\n          }\n        }\n      };\n\n      loadThumbnail();\n\n      return () =&gt; {\n        controller.abort();\n      };\n    }\n  },\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { ",
            "lineNumber": 214
          },
          {
            "text": "  src: string; ",
            "lineNumber": 215
          },
          {
            "text": "  alt: string; ",
            "lineNumber": 216
          },
          {
            "text": "  isSelected: boolean;",
            "lineNumber": 217
          },
          {
            "text": "  filePath?: string;",
            "lineNumber": 218
          },
          {
            "text": "  modified?: string;",
            "lineNumber": 219
          },
          {
            "text": "  size?: number;",
            "lineNumber": 220
          },
          {
            "text": "  isHovering?: boolean;",
            "lineNumber": 221
          },
          {
            "text": "  fileMeta?: { format?: string };",
            "lineNumber": 222
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 223
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 224
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 225
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 242
          },
          {
            "text": "const loadThumbnail = async ",
            "lineNumber": 255
          },
          {
            "lineNumber": 257
          },
          {
            "text": "        ",
            "lineNumber": 258
          },
          {
            "text": "        try {",
            "lineNumber": 259
          },
          {
            "text": "          const { getThumbnail } = await import('../api/tauri-bridge');",
            "lineNumber": 260
          },
          {
            "text": "          const thumbnail = await getThumbnail(filePath, modified, resourceRoot, controller.signal);",
            "lineNumber": 261
          },
          {
            "text": "          ",
            "lineNumber": 262
          },
          {
            "text": "          if (!controller.signal.aborted &amp;&amp; thumbnail) {",
            "lineNumber": 263
          },
          {
            "text": "            // 更新全局缓存",
            "lineNumber": 264
          },
          {
            "text": "            if (cache.get(key) !== thumbnail) {",
            "lineNumber": 265
          },
          {
            "text": "                cache.set(key, thumbnail);",
            "lineNumber": 266
          },
          {
            "text": "                setThumbnailSrc(thumbnail);",
            "lineNumber": 267
          },
          {
            "text": "            }",
            "lineNumber": 268
          },
          {
            "text": "          }",
            "lineNumber": 269
          },
          {
            "text": "        } catch (error) {",
            "lineNumber": 270
          },
          {
            "text": "          if (!controller.signal.aborted) {",
            "lineNumber": 271
          },
          {
            "text": "            console.error('Failed to load thumbnail:', error);",
            "lineNumber": 272
          },
          {
            "text": "          }",
            "lineNumber": 273
          },
          {
            "text": "        } finally {",
            "lineNumber": 274
          },
          {
            "text": "          if (!controller.signal.aborted) {",
            "lineNumber": 275
          },
          {
            "text": "            setLoading(false);",
            "lineNumber": 276
          },
          {
            "text": "          }",
            "lineNumber": 277
          },
          {
            "text": "        }",
            "lineNumber": 278
          },
          {
            "text": "      };",
            "lineNumber": 279
          },
          {
            "lineNumber": 280
          },
          {
            "text": "      loadThumbnail();",
            "lineNumber": 281
          },
          {
            "lineNumber": 282
          },
          {
            "text": "      return () =&gt; {",
            "lineNumber": 283
          },
          {
            "text": "        controller.abort();",
            "lineNumber": 284
          },
          {
            "text": "      };",
            "lineNumber": 285
          },
          {
            "text": "    }",
            "lineNumber": 286
          },
          {
            "text": "  },",
            "lineNumber": 287
          },
          {
            "text": "};",
            "lineNumber": 361
          }
        ]
      },
      "score": 0.3983044922351837
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 229,
            "column": 1
          },
          "endPosition": {
            "line": 465
          }
        },
        "contents": "const TagSection: React.FC&lt;TagSectionProps&gt; = ({ \n  files, customTags, onTagSelect, onNavigateAllTags, onContextMenu, \n  isCreatingTag, onStartCreateTag, onSaveNewTag, onCancelCreateTag, onDropOnTag, t \n}) =&gt; {\n  const [expanded, setExpanded] = useState(false);\n  const [hoveredTag, setHoveredTag] = useState&lt;string | null&gt;(null);\n  const [hoveredTagPos, setHoveredTagPos] = useState&lt;{top: number, left: number} | null&gt;(null);\n  const [dragOverTag, setDragOverTag] = useState&lt;string | null&gt;(null);\n  const [tagInputValue, setTagInputValue] = useState('');\n  \n  const hoverTimerRef = useRef&lt;ReturnType&lt;typeof setTimeout&gt; | null&gt;(null);\n  const inputRef = useRef&lt;HTMLInputElement&gt;(null);\n\n  useEffect(() =&gt; {\n    if (isCreatingTag) {\n      setExpanded(true);\n      setTagInputValue(t('context.newTagDefault'));\n    }\n  }, [isCreatingTag, t]);\n\n  useEffect(() =&gt; {\n    if (isCreatingTag &amp;&amp; inputRef.current) {\n        inputRef.current.focus();\n        inputRef.current.select();\n    }\n  }, [isCreatingTag]);\n  \n  useEffect(() =&gt; {\n    return () =&gt; {\n      if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);\n    };\n  }, []);\n\n  const sortedTags = useMemo(() =&gt; {\n    const allTags = new Set&lt;string&gt;(customTags);\n    Object.values(files).forEach((file: FileNode) =&gt; {\n      file.tags.forEach(tag =&gt; allTags.add(tag));\n    });\n    return Array.from(allTags).sort((a, b) =&gt; a.localeCompare(b, 'zh-CN'));\n  }, [files, customTags]);\n\n  const suggestions = useMemo(() =&gt; {\n    if (!isCreatingTag || !tagInputValue) return [];\n    const lowerInput = tagInputValue.toLowerCase();\n    return sortedTags.filter(t =&gt; \n        t.toLowerCase().includes(lowerInput) &amp;&amp; t.toLowerCase() !== lowerInput\n    ).slice(0, 5);\n  }, [isCreatingTag, tagInputValue, sortedTags]);\n\n  const previewImages = useMemo(() =&gt; {\n    if (!hoveredTag) return [];\n  };",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const TagSection: React.FC&lt;TagSectionProps&gt; = ({ ",
            "lineNumber": 232
          },
          {
            "text": "  files, customTags, onTagSelect, onNavigateAllTags, onContextMenu, ",
            "lineNumber": 233
          },
          {
            "text": "  isCreatingTag, onStartCreateTag, onSaveNewTag, onCancelCreateTag, onDropOnTag, t ",
            "lineNumber": 234
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 235
          },
          {
            "text": "  const [expanded, setExpanded] = useState(false);",
            "lineNumber": 236
          },
          {
            "text": "  const [hoveredTag, setHoveredTag] = useState&lt;string | null&gt;(null);",
            "lineNumber": 237
          },
          {
            "text": "  const [hoveredTagPos, setHoveredTagPos] = useState&lt;{top: number, left: number} | null&gt;(null);",
            "lineNumber": 238
          },
          {
            "text": "  const [dragOverTag, setDragOverTag] = useState&lt;string | null&gt;(null);",
            "lineNumber": 239
          },
          {
            "text": "  const [tagInputValue, setTagInputValue] = useState('');",
            "lineNumber": 240
          },
          {
            "text": "  ",
            "lineNumber": 241
          },
          {
            "text": "  const hoverTimerRef = useRef&lt;ReturnType&lt;typeof setTimeout&gt; | null&gt;(null);",
            "lineNumber": 242
          },
          {
            "text": "  const inputRef = useRef&lt;HTMLInputElement&gt;(null);",
            "lineNumber": 243
          },
          {
            "lineNumber": 244
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 245
          },
          {
            "text": "    if (isCreatingTag) {",
            "lineNumber": 246
          },
          {
            "text": "      setExpanded(true);",
            "lineNumber": 247
          },
          {
            "text": "      setTagInputValue(t('context.newTagDefault'));",
            "lineNumber": 248
          },
          {
            "text": "    }",
            "lineNumber": 249
          },
          {
            "text": "  }, [isCreatingTag, t]);",
            "lineNumber": 250
          },
          {
            "lineNumber": 251
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 252
          },
          {
            "text": "    if (isCreatingTag &amp;&amp; inputRef.current) {",
            "lineNumber": 253
          },
          {
            "text": "        inputRef.current.focus();",
            "lineNumber": 254
          },
          {
            "text": "        inputRef.current.select();",
            "lineNumber": 255
          },
          {
            "text": "    }",
            "lineNumber": 256
          },
          {
            "text": "  }, [isCreatingTag]);",
            "lineNumber": 257
          },
          {
            "text": "  ",
            "lineNumber": 258
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 259
          },
          {
            "text": "    return () =&gt; {",
            "lineNumber": 260
          },
          {
            "text": "      if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);",
            "lineNumber": 261
          },
          {
            "text": "    };",
            "lineNumber": 262
          },
          {
            "text": "  }, []);",
            "lineNumber": 263
          },
          {
            "lineNumber": 264
          },
          {
            "text": "  const sortedTags = useMemo(() =&gt; {",
            "lineNumber": 265
          },
          {
            "text": "    const allTags = new Set&lt;string&gt;(customTags);",
            "lineNumber": 266
          },
          {
            "text": "    Object.values(files).forEach((file: FileNode) =&gt; {",
            "lineNumber": 267
          },
          {
            "text": "      file.tags.forEach(tag =&gt; allTags.add(tag));",
            "lineNumber": 268
          },
          {
            "text": "    });",
            "lineNumber": 269
          },
          {
            "text": "    return Array.from(allTags).sort((a, b) =&gt; a.localeCompare(b, 'zh-CN'));",
            "lineNumber": 270
          },
          {
            "text": "  }, [files, customTags]);",
            "lineNumber": 271
          },
          {
            "lineNumber": 272
          },
          {
            "text": "  const suggestions = useMemo(() =&gt; {",
            "lineNumber": 273
          },
          {
            "text": "    if (!isCreatingTag || !tagInputValue) return [];",
            "lineNumber": 274
          },
          {
            "text": "    const lowerInput = tagInputValue.toLowerCase();",
            "lineNumber": 275
          },
          {
            "text": "    return sortedTags.filter(t =&gt; ",
            "lineNumber": 276
          },
          {
            "text": "        t.toLowerCase().includes(lowerInput) &amp;&amp; t.toLowerCase() !== lowerInput",
            "lineNumber": 277
          },
          {
            "text": "    ).slice(0, 5);",
            "lineNumber": 278
          },
          {
            "text": "  }, [isCreatingTag, tagInputValue, sortedTags]);",
            "lineNumber": 279
          },
          {
            "lineNumber": 280
          },
          {
            "text": "  const previewImages = useMemo(() =&gt; {",
            "lineNumber": 281
          },
          {
            "text": "    if (!hoveredTag) return [];",
            "lineNumber": 282
          },
          {
            "text": "  };",
            "lineNumber": 287
          }
        ]
      },
      "score": 0.3955647051334381
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 399
          },
          "endPosition": {
            "line": 501,
            "column": 1
          }
        },
        "contents": "export const FolderThumbnail = ({ file, files, mode, resourceRoot, cachePath }: { file: FileNode; files: Record&lt;string, FileNode&gt;, mode: LayoutMode, resourceRoot?: string, cachePath?: string }) =&gt; {\nconst [previewSrcs, setPreviewSrcs] = () =&gt; {\n\n      // 为了体验最好，只要有缓存就先用。过滤掉 null。\n      const validUrls = cachedUrls.filter((url): url is string =&gt; !!url);\n      \n      // 如果没有缓存，返回空数组\n      return validUrls;\n  });\n\n  // 如果初始就有数据（哪怕只有一张），就不设为 loaded=false，避免闪烁\n  const [loaded, setLoaded] = useState(previewSrcs.length &gt; 0);\n\n  useEffect(() =&gt; {\n    // 如果已经加载过了，且数量足够（或者等于子文件总数），就不再请求\n    // 注意：这里简单判断，如果缓存里不够 3 张但实际有 3 张，还是会触发请求补全\n    if (loaded &amp;&amp; previewSrcs.length === Math.min(3, imageChildren.length)) {\n        return;\n    }\n\n    if ((isInView || wasInView) &amp;&amp; resourceRoot &amp;&amp; imageChildren.length &gt; 0) {\n      const controller = new AbortController();\n      const loadPreviews = async () =&gt; {\n        try {\n          const { getThumbnail } = await import('../api/tauri-bridge');\n          \n          // 并行请求所有子文件的缩略图\n          const promises = imageChildren.map(async (img: FileNode) =&gt; {\n              // 先查缓存，如果有就不请求了 (虽然 getThumbnail 内部也有 batcher，但这里拦截更快)\n              const cache = getGlobalCache();\n              const cached = cache.get(img.path);\n              if (cached) return cached;\n\n              // 请求新图\n              const url = await getThumbnail(img.path, img.updatedAt, resourceRoot, controller.signal);\n              if (url) {\n                  cache.set(img.path, url); // 更新缓存\n              }\n              return url;\n          });\n;\n  }\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 284,
                "column": 1
              },
              "endPosition": {
                "line": 284,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 7
              },
              "endPosition": {
                "line": 284,
                "column": 18
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 29
              },
              "endPosition": {
                "line": 285,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 8
              },
              "endPosition": {
                "line": 387,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 17
              },
              "endPosition": {
                "line": 388,
                "column": 11
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const FolderThumbnail = ({ file, files, mode, resourceRoot, cachePath }: { file: FileNode; files: Record&lt;string, FileNode&gt;, mode: LayoutMode, resourceRoot?: string, cachePath?: string }) =&gt; {",
            "lineNumber": 400
          },
          {
            "text": "const [previewSrcs, setPreviewSrcs] = () =&gt; {",
            "lineNumber": 410
          },
          {
            "lineNumber": 418
          },
          {
            "text": "      // 为了体验最好，只要有缓存就先用。过滤掉 null。",
            "lineNumber": 419
          },
          {
            "text": "      const validUrls = cachedUrls.filter((url): url is string =&gt; !!url);",
            "lineNumber": 420
          },
          {
            "text": "      ",
            "lineNumber": 421
          },
          {
            "text": "      // 如果没有缓存，返回空数组",
            "lineNumber": 422
          },
          {
            "text": "      return validUrls;",
            "lineNumber": 423
          },
          {
            "text": "  });",
            "lineNumber": 424
          },
          {
            "lineNumber": 425
          },
          {
            "text": "  // 如果初始就有数据（哪怕只有一张），就不设为 loaded=false，避免闪烁",
            "lineNumber": 426
          },
          {
            "text": "  const [loaded, setLoaded] = useState(previewSrcs.length &gt; 0);",
            "lineNumber": 427
          },
          {
            "lineNumber": 428
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 429
          },
          {
            "text": "    // 如果已经加载过了，且数量足够（或者等于子文件总数），就不再请求",
            "lineNumber": 430
          },
          {
            "text": "    // 注意：这里简单判断，如果缓存里不够 3 张但实际有 3 张，还是会触发请求补全",
            "lineNumber": 431
          },
          {
            "text": "    if (loaded &amp;&amp; previewSrcs.length === Math.min(3, imageChildren.length)) {",
            "lineNumber": 432
          },
          {
            "text": "        return;",
            "lineNumber": 433
          },
          {
            "text": "    }",
            "lineNumber": 434
          },
          {
            "lineNumber": 435
          },
          {
            "text": "    if ((isInView || wasInView) &amp;&amp; resourceRoot &amp;&amp; imageChildren.length &gt; 0) {",
            "lineNumber": 436
          },
          {
            "text": "      const controller = new AbortController();",
            "lineNumber": 437
          },
          {
            "text": "      const loadPreviews = async () =&gt; {",
            "lineNumber": 438
          },
          {
            "text": "        try {",
            "lineNumber": 439
          },
          {
            "text": "          const { getThumbnail } = await import('../api/tauri-bridge');",
            "lineNumber": 440
          },
          {
            "text": "          ",
            "lineNumber": 441
          },
          {
            "text": "          // 并行请求所有子文件的缩略图",
            "lineNumber": 442
          },
          {
            "text": "          const promises = imageChildren.map(async (img: FileNode) =&gt; {",
            "lineNumber": 443
          },
          {
            "text": "              // 先查缓存，如果有就不请求了 (虽然 getThumbnail 内部也有 batcher，但这里拦截更快)",
            "lineNumber": 444
          },
          {
            "text": "              const cache = getGlobalCache();",
            "lineNumber": 445
          },
          {
            "text": "              const cached = cache.get(img.path);",
            "lineNumber": 446
          },
          {
            "text": "              if (cached) return cached;",
            "lineNumber": 447
          },
          {
            "lineNumber": 448
          },
          {
            "text": "              // 请求新图",
            "lineNumber": 449
          },
          {
            "text": "              const url = await getThumbnail(img.path, img.updatedAt, resourceRoot, controller.signal);",
            "lineNumber": 450
          },
          {
            "text": "              if (url) {",
            "lineNumber": 451
          },
          {
            "text": "                  cache.set(img.path, url); // 更新缓存",
            "lineNumber": 452
          },
          {
            "text": "              }",
            "lineNumber": 453
          },
          {
            "text": "              return url;",
            "lineNumber": 454
          },
          {
            "text": "          });",
            "lineNumber": 455
          },
          {
            "text": ";",
            "lineNumber": 479
          },
          {
            "text": "  }",
            "lineNumber": 487
          },
          {
            "text": "};",
            "lineNumber": 502
          }
        ]
      },
      "score": 0.39449751377105713
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 11
          },
          "endPosition": {
            "line": 195,
            "column": 1
          }
        },
        "contents": "interface TopBarProps {\n\n  t: (key: string) =&gt; string;\n}\n\nconst TagsWidget = ({ groupedTags, onTagClick, t, tagSearchQuery, onSetTagSearchQuery }: { groupedTags: Record&lt;string, string[]&gt;, onTagClick: (tag: string, e: React.MouseEvent) =&gt; void, t: (key: string) =&gt; string, tagSearchQuery: string, onSetTagSearchQuery: (query: string) =&gt; void }) =&gt; {\n  const [localSearchQuery, setLocalSearchQuery] = React.useState(tagSearchQuery);\n  const [isFocused, setIsFocused] = React.useState(false);\n  \n  // 当外部tagSearchQuery变化时，更新本地状态\n  React.useEffect(() =&gt; {\n    setLocalSearchQuery(tagSearchQuery);\n  }, [tagSearchQuery]);\n  \n  // 获取所有标签列表，用于智能联想\n  const allTags = React.useMemo(() =&gt; {\n    const tagsSet = new Set&lt;string&gt;();\n    Object.values(groupedTags).forEach(tags =&gt; {\n      tags.forEach(tag =&gt; tagsSet.add(tag));\n    });\n    return Array.from(tagsSet);\n  }, [groupedTags]);\n  \n  // 过滤标签，只显示匹配搜索条件的标签\n  const filteredGroupedTags = React.useMemo(() =&gt; {\n    if (!localSearchQuery) return groupedTags;\n    \n    const filtered: Record&lt;string, string[]&gt; = {};\n    Object.entries(groupedTags).forEach(([key, tags]) =&gt; {\n      const matchingTags = tags.filter(tag =&gt; \n        tag.toLowerCase().includes(localSearchQuery.toLowerCase())\n      );\n      if (matchingTags.length &gt; 0) {\n        filtered[key] = matchingTags;\n      }\n    });\n    return filtered;\n  }, [groupedTags, localSearchQuery]);\n  \n  // 智能联想的标签列表\n  const suggestedTags = React.useMemo(() =&gt; {\n    if (!localSearchQuery || !isFocused) return [];\n    return allTags\n      .filter(tag =&gt; tag.toLowerCase().includes(localSearchQuery.toLowerCase()))\n      .sort()\n      .slice(0, 10);\n  }, [allTags, localSearchQuery, isFocused]);\n  \n  const keys = Object.keys(filteredGroupedTags).sort();\n  const totalTags = Object.values(filteredGroupedTags).reduce;\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "interface TopBarProps {",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "lineNumber": 40
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 41,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 42,
            "isSignature": true
          },
          {
            "lineNumber": 43
          },
          {
            "text": "const TagsWidget = ({ groupedTags, onTagClick, t, tagSearchQuery, onSetTagSearchQuery }: { groupedTags: Record&lt;string, string[]&gt;, onTagClick: (tag: string, e: React.MouseEvent) =&gt; void, t: (key: string) =&gt; string, tagSearchQuery: string, onSetTagSearchQuery: (query: string) =&gt; void }) =&gt; {",
            "lineNumber": 44
          },
          {
            "text": "  const [localSearchQuery, setLocalSearchQuery] = React.useState(tagSearchQuery);",
            "lineNumber": 45
          },
          {
            "text": "  const [isFocused, setIsFocused] = React.useState(false);",
            "lineNumber": 46
          },
          {
            "text": "  ",
            "lineNumber": 47
          },
          {
            "text": "  // 当外部tagSearchQuery变化时，更新本地状态",
            "lineNumber": 48
          },
          {
            "text": "  React.useEffect(() =&gt; {",
            "lineNumber": 49
          },
          {
            "text": "    setLocalSearchQuery(tagSearchQuery);",
            "lineNumber": 50
          },
          {
            "text": "  }, [tagSearchQuery]);",
            "lineNumber": 51
          },
          {
            "text": "  ",
            "lineNumber": 52
          },
          {
            "text": "  // 获取所有标签列表，用于智能联想",
            "lineNumber": 53
          },
          {
            "text": "  const allTags = React.useMemo(() =&gt; {",
            "lineNumber": 54
          },
          {
            "text": "    const tagsSet = new Set&lt;string&gt;();",
            "lineNumber": 55
          },
          {
            "text": "    Object.values(groupedTags).forEach(tags =&gt; {",
            "lineNumber": 56
          },
          {
            "text": "      tags.forEach(tag =&gt; tagsSet.add(tag));",
            "lineNumber": 57
          },
          {
            "text": "    });",
            "lineNumber": 58
          },
          {
            "text": "    return Array.from(tagsSet);",
            "lineNumber": 59
          },
          {
            "text": "  }, [groupedTags]);",
            "lineNumber": 60
          },
          {
            "text": "  ",
            "lineNumber": 61
          },
          {
            "text": "  // 过滤标签，只显示匹配搜索条件的标签",
            "lineNumber": 62
          },
          {
            "text": "  const filteredGroupedTags = React.useMemo(() =&gt; {",
            "lineNumber": 63
          },
          {
            "text": "    if (!localSearchQuery) return groupedTags;",
            "lineNumber": 64
          },
          {
            "text": "    ",
            "lineNumber": 65
          },
          {
            "text": "    const filtered: Record&lt;string, string[]&gt; = {};",
            "lineNumber": 66
          },
          {
            "text": "    Object.entries(groupedTags).forEach(([key, tags]) =&gt; {",
            "lineNumber": 67
          },
          {
            "text": "      const matchingTags = tags.filter(tag =&gt; ",
            "lineNumber": 68
          },
          {
            "text": "        tag.toLowerCase().includes(localSearchQuery.toLowerCase())",
            "lineNumber": 69
          },
          {
            "text": "      );",
            "lineNumber": 70
          },
          {
            "text": "      if (matchingTags.length &gt; 0) {",
            "lineNumber": 71
          },
          {
            "text": "        filtered[key] = matchingTags;",
            "lineNumber": 72
          },
          {
            "text": "      }",
            "lineNumber": 73
          },
          {
            "text": "    });",
            "lineNumber": 74
          },
          {
            "text": "    return filtered;",
            "lineNumber": 75
          },
          {
            "text": "  }, [groupedTags, localSearchQuery]);",
            "lineNumber": 76
          },
          {
            "text": "  ",
            "lineNumber": 77
          },
          {
            "text": "  // 智能联想的标签列表",
            "lineNumber": 78
          },
          {
            "text": "  const suggestedTags = React.useMemo(() =&gt; {",
            "lineNumber": 79
          },
          {
            "text": "    if (!localSearchQuery || !isFocused) return [];",
            "lineNumber": 80
          },
          {
            "text": "    return allTags",
            "lineNumber": 81
          },
          {
            "text": "      .filter(tag =&gt; tag.toLowerCase().includes(localSearchQuery.toLowerCase()))",
            "lineNumber": 82
          },
          {
            "text": "      .sort()",
            "lineNumber": 83
          },
          {
            "text": "      .slice(0, 10);",
            "lineNumber": 84
          },
          {
            "text": "  }, [allTags, localSearchQuery, isFocused]);",
            "lineNumber": 85
          },
          {
            "text": "  ",
            "lineNumber": 86
          },
          {
            "text": "  const keys = Object.keys(filteredGroupedTags).sort();",
            "lineNumber": 87
          },
          {
            "text": "  const totalTags = Object.values(filteredGroupedTags).reduce;",
            "lineNumber": 88
          },
          {
            "text": ";",
            "lineNumber": 196
          }
        ]
      },
      "score": 0.38708484172821045
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 43
          },
          "endPosition": {
            "line": 195,
            "column": 1
          }
        },
        "contents": "const TagsWidget = \nconst suggestedTags = \n [allTags, localSearchQuery, isFocused]);\n  \n  const keys = Object.keys(filteredGroupedTags).sort();\n  const totalTags = Object.values(filteredGroupedTags).reduce((acc, curr) =&gt; acc + curr.length, 0);\n\n  return (\n    &lt;div className=\"flex flex-col select-none bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-2xl overflow-hidden w-80 max-h-[400px] font-sans border border-gray-200 dark:border-gray-700 z-50\"&gt;\n      &lt;div className=\"px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\"&gt;\n        &lt;div className=\"flex items-center justify-between mb-3\"&gt;\n          &lt;span className=\"font-bold text-sm tracking-wide\"&gt;{t('sidebar.allTags')}&lt;/span&gt;\n          &lt;span className=\"text-xs text-gray-500 dark:text-gray-400 bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded-full\"&gt;\n            {totalTags}\n          &lt;/span&gt;\n        &lt;/div&gt;\n        &lt;div className=\"relative\"&gt;\n          &lt;Search size={14} className=\"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400\" /&gt;\n          &lt;input\n            type=\"text\"\n            id=\"tag-search-input\"\n            name=\"tag-search-input\"\n            placeholder={t('search.placeholder')}\n            value={localSearchQuery}\n            onChange={(e) =&gt; {\n              setLocalSearchQuery(e.target.value);\n              onSetTagSearchQuery(e.target.value);\n            }}\n            onFocus={() =&gt; setIsFocused(true)}\n            onBlur={() =&gt; {\n              // 延迟关闭，以便点击建议项时能触发点击事件\n              setTimeout(() =&gt; setIsFocused(false), 200);\n            }}\n            className=\"w-full pl-8 pr-2 py-1.5 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          /&gt;\n          {localSearchQuery &amp;&amp;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 42,
                "column": 1
              },
              "endPosition": {
                "line": 42,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 42,
                "column": 7
              },
              "endPosition": {
                "line": 42,
                "column": 20
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsWidget = ",
            "lineNumber": 44
          },
          {
            "text": "const suggestedTags = ",
            "lineNumber": 79
          },
          {
            "text": " [allTags, localSearchQuery, isFocused]);",
            "lineNumber": 85
          },
          {
            "text": "  ",
            "lineNumber": 86
          },
          {
            "text": "  const keys = Object.keys(filteredGroupedTags).sort();",
            "lineNumber": 87
          },
          {
            "text": "  const totalTags = Object.values(filteredGroupedTags).reduce((acc, curr) =&gt; acc + curr.length, 0);",
            "lineNumber": 88
          },
          {
            "lineNumber": 89
          },
          {
            "text": "  return (",
            "lineNumber": 90
          },
          {
            "text": "    &lt;div className=\"flex flex-col select-none bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-2xl overflow-hidden w-80 max-h-[400px] font-sans border border-gray-200 dark:border-gray-700 z-50\"&gt;",
            "lineNumber": 91
          },
          {
            "text": "      &lt;div className=\"px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\"&gt;",
            "lineNumber": 92
          },
          {
            "text": "        &lt;div className=\"flex items-center justify-between mb-3\"&gt;",
            "lineNumber": 93
          },
          {
            "text": "          &lt;span className=\"font-bold text-sm tracking-wide\"&gt;{t('sidebar.allTags')}&lt;/span&gt;",
            "lineNumber": 94
          },
          {
            "text": "          &lt;span className=\"text-xs text-gray-500 dark:text-gray-400 bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded-full\"&gt;",
            "lineNumber": 95
          },
          {
            "text": "            {totalTags}",
            "lineNumber": 96
          },
          {
            "text": "          &lt;/span&gt;",
            "lineNumber": 97
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 98
          },
          {
            "text": "        &lt;div className=\"relative\"&gt;",
            "lineNumber": 99
          },
          {
            "text": "          &lt;Search size={14} className=\"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400\" /&gt;",
            "lineNumber": 100
          },
          {
            "text": "          &lt;input",
            "lineNumber": 101
          },
          {
            "text": "            type=\"text\"",
            "lineNumber": 102
          },
          {
            "text": "            id=\"tag-search-input\"",
            "lineNumber": 103
          },
          {
            "text": "            name=\"tag-search-input\"",
            "lineNumber": 104
          },
          {
            "text": "            placeholder={t('search.placeholder')}",
            "lineNumber": 105
          },
          {
            "text": "            value={localSearchQuery}",
            "lineNumber": 106
          },
          {
            "text": "            onChange={(e) =&gt; {",
            "lineNumber": 107
          },
          {
            "text": "              setLocalSearchQuery(e.target.value);",
            "lineNumber": 108
          },
          {
            "text": "              onSetTagSearchQuery(e.target.value);",
            "lineNumber": 109
          },
          {
            "text": "            }}",
            "lineNumber": 110
          },
          {
            "text": "            onFocus={() =&gt; setIsFocused(true)}",
            "lineNumber": 111
          },
          {
            "text": "            onBlur={() =&gt; {",
            "lineNumber": 112
          },
          {
            "text": "              // 延迟关闭，以便点击建议项时能触发点击事件",
            "lineNumber": 113
          },
          {
            "text": "              setTimeout(() =&gt; setIsFocused(false), 200);",
            "lineNumber": 114
          },
          {
            "text": "            }}",
            "lineNumber": 115
          },
          {
            "text": "            className=\"w-full pl-8 pr-2 py-1.5 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"",
            "lineNumber": 116
          },
          {
            "text": "          /&gt;",
            "lineNumber": 117
          },
          {
            "text": "          {localSearchQuery &amp;&amp;",
            "lineNumber": 118
          },
          {
            "text": ";",
            "lineNumber": 196
          }
        ]
      },
      "score": 0.3855060338973999
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleFolderAIAnalysis = async \n\n      \n      if (allImageIds.length === 0) return;\n      \n      // Get IDs of images that haven't been analyzed yet\n      const unanalyzedImageIds = allImageFiles.filter(file =&gt; !file.analyzed).map(file =&gt; file.id);\n      \n      if (unanalyzedImageIds.length &gt; 0) {\n          // If there are unanalyzed images, analyze them first\n          await handleAIAnalysis(unanalyzedImageIds, folderId);\n      } else {\n          // If all images are already analyzed, just generate the summary\n          // We'll call handleAIAnalysis with empty array and folderId to trigger summary generation\n          await handleAIAnalysis([], folderId);\n      }\n  };\n\n  return (\n    &lt;div className=\"w-full h-full flex flex-col bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 overflow-hidden font-sans transition-colors duration-300\" \n              onClick={closeContextMenu} onDragOver={handleDragOver} onDrop={handleExternalFileDrop} onDragLeave={handleDragLeave}&gt;\n      {/* 启动界面 */}\n      &lt;SplashScreen isVisible={showSplash}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 4407,
                "column": 28
              },
              "endPosition": {
                "line": 4407,
                "column": 28
              }
            },
            {
              "startPosition": {
                "line": 4407,
                "column": 29
              },
              "endPosition": {
                "line": 4408,
                "column": 29
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleFolderAIAnalysis = async ",
            "lineNumber": 4395
          },
          {
            "lineNumber": 4426
          },
          {
            "text": "      ",
            "lineNumber": 4427
          },
          {
            "text": "      if (allImageIds.length === 0) return;",
            "lineNumber": 4428
          },
          {
            "text": "      ",
            "lineNumber": 4429
          },
          {
            "text": "      // Get IDs of images that haven't been analyzed yet",
            "lineNumber": 4430
          },
          {
            "text": "      const unanalyzedImageIds = allImageFiles.filter(file =&gt; !file.analyzed).map(file =&gt; file.id);",
            "lineNumber": 4431
          },
          {
            "text": "      ",
            "lineNumber": 4432
          },
          {
            "text": "      if (unanalyzedImageIds.length &gt; 0) {",
            "lineNumber": 4433
          },
          {
            "text": "          // If there are unanalyzed images, analyze them first",
            "lineNumber": 4434
          },
          {
            "text": "          await handleAIAnalysis(unanalyzedImageIds, folderId);",
            "lineNumber": 4435
          },
          {
            "text": "      } else {",
            "lineNumber": 4436
          },
          {
            "text": "          // If all images are already analyzed, just generate the summary",
            "lineNumber": 4437
          },
          {
            "text": "          // We'll call handleAIAnalysis with empty array and folderId to trigger summary generation",
            "lineNumber": 4438
          },
          {
            "text": "          await handleAIAnalysis([], folderId);",
            "lineNumber": 4439
          },
          {
            "text": "      }",
            "lineNumber": 4440
          },
          {
            "text": "  };",
            "lineNumber": 4441
          },
          {
            "lineNumber": 4442
          },
          {
            "text": "  return (",
            "lineNumber": 4443
          },
          {
            "text": "    &lt;div className=\"w-full h-full flex flex-col bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 overflow-hidden font-sans transition-colors duration-300\" ",
            "lineNumber": 4444
          },
          {
            "text": "              onClick={closeContextMenu} onDragOver={handleDragOver} onDrop={handleExternalFileDrop} onDragLeave={handleDragLeave}&gt;",
            "lineNumber": 4445
          },
          {
            "text": "      {/* 启动界面 */}",
            "lineNumber": 4446
          },
          {
            "text": "      &lt;SplashScreen isVisible={showSplash}",
            "lineNumber": 4447
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.3816860020160675
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \n() =&gt; {\nid =&gt; {\n\n                                            }\n                                        });\n                                    }} \n                                    className=\"flex items-center px-3 py-1.5 bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-400 text-white rounded-md font-medium transition-colors text-sm\"\n                                    title={t('meta.clearAllAiData')}\n                                &gt;\n                                    &lt;X size={12} className=\"mr-1.5\"/&gt; {t('meta.clearAll')}\n                                &lt;/button&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    ) : (\n                        // Single file AI analysis details\n                        file &amp;&amp; file.aiData &amp;&amp; (\n                            &lt;div className=\"space-y-3\"&gt;\n                                &lt;div className=\"grid grid-cols-2 gap-2 text-xs\"&gt;\n                                    &lt;div className=\"bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;\n                                        &lt;div className=\"text-gray-400 mb-1\"&gt;{t('meta.aiScene')}&lt;/div&gt;\n                                        &lt;div className=\"font-medium text-gray-800 dark:text-gray-200\"&gt;{file.aiData.sceneCategory}&lt;/div&gt;\n                                    &lt;/div&gt;\n                                    &lt;div className=\"bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;\n                                        &lt;div className=\"text-gray-400 mb-1\"&gt;{t('meta.aiConfidence')}&lt;/div&gt;\n                                        &lt;div className=\"font-medium text-gray-800 dark:text-gray-200\"&gt;{Math.round(file.aiData.confidence * 100)}%&lt;/div&gt;\n                                    &lt;/div&gt;\n                                &lt;/div&gt;\n\n                                {file.aiData.faces.length &gt; 0 &amp;&amp; (\n                                    &lt;div&gt;\n                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1.5 flex items-center\"&gt;&lt;Smile size={10} className=\"mr-1\"/&gt; {t('meta.aiFaces')}&lt;/div&gt;\n                                        &lt;div className=\"flex flex-wrap gap-1.5\"&gt;\n                                            \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 1159
          },
          {
            "text": "id =&gt; {",
            "lineNumber": 1160
          },
          {
            "lineNumber": 1162
          },
          {
            "text": "                                            }",
            "lineNumber": 1163
          },
          {
            "text": "                                        });",
            "lineNumber": 1164
          },
          {
            "text": "                                    }} ",
            "lineNumber": 1165
          },
          {
            "text": "                                    className=\"flex items-center px-3 py-1.5 bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-400 text-white rounded-md font-medium transition-colors text-sm\"",
            "lineNumber": 1166
          },
          {
            "text": "                                    title={t('meta.clearAllAiData')}",
            "lineNumber": 1167
          },
          {
            "text": "                                &gt;",
            "lineNumber": 1168
          },
          {
            "text": "                                    &lt;X size={12} className=\"mr-1.5\"/&gt; {t('meta.clearAll')}",
            "lineNumber": 1169
          },
          {
            "text": "                                &lt;/button&gt;",
            "lineNumber": 1170
          },
          {
            "text": "                            &lt;/div&gt;",
            "lineNumber": 1171
          },
          {
            "text": "                        &lt;/div&gt;",
            "lineNumber": 1172
          },
          {
            "text": "                    ) : (",
            "lineNumber": 1173
          },
          {
            "text": "                        // Single file AI analysis details",
            "lineNumber": 1174
          },
          {
            "text": "                        file &amp;&amp; file.aiData &amp;&amp; (",
            "lineNumber": 1175
          },
          {
            "text": "                            &lt;div className=\"space-y-3\"&gt;",
            "lineNumber": 1176
          },
          {
            "text": "                                &lt;div className=\"grid grid-cols-2 gap-2 text-xs\"&gt;",
            "lineNumber": 1177
          },
          {
            "text": "                                    &lt;div className=\"bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;",
            "lineNumber": 1178
          },
          {
            "text": "                                        &lt;div className=\"text-gray-400 mb-1\"&gt;{t('meta.aiScene')}&lt;/div&gt;",
            "lineNumber": 1179
          },
          {
            "text": "                                        &lt;div className=\"font-medium text-gray-800 dark:text-gray-200\"&gt;{file.aiData.sceneCategory}&lt;/div&gt;",
            "lineNumber": 1180
          },
          {
            "text": "                                    &lt;/div&gt;",
            "lineNumber": 1181
          },
          {
            "text": "                                    &lt;div className=\"bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;",
            "lineNumber": 1182
          },
          {
            "text": "                                        &lt;div className=\"text-gray-400 mb-1\"&gt;{t('meta.aiConfidence')}&lt;/div&gt;",
            "lineNumber": 1183
          },
          {
            "text": "                                        &lt;div className=\"font-medium text-gray-800 dark:text-gray-200\"&gt;{Math.round(file.aiData.confidence * 100)}%&lt;/div&gt;",
            "lineNumber": 1184
          },
          {
            "text": "                                    &lt;/div&gt;",
            "lineNumber": 1185
          },
          {
            "text": "                                &lt;/div&gt;",
            "lineNumber": 1186
          },
          {
            "lineNumber": 1187
          },
          {
            "text": "                                {file.aiData.faces.length &gt; 0 &amp;&amp; (",
            "lineNumber": 1188
          },
          {
            "text": "                                    &lt;div&gt;",
            "lineNumber": 1189
          },
          {
            "text": "                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1.5 flex items-center\"&gt;&lt;Smile size={10} className=\"mr-1\"/&gt; {t('meta.aiFaces')}&lt;/div&gt;",
            "lineNumber": 1190
          },
          {
            "text": "                                        &lt;div className=\"flex flex-wrap gap-1.5\"&gt;",
            "lineNumber": 1191
          },
          {
            "text": "                                            ",
            "lineNumber": 1192
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.3728412389755249
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 231
          },
          "endPosition": {
            "line": 465
          }
        },
        "contents": "const TagSection: React.FC&lt;TagSectionProps&gt; = \n\n\n          {sortedTags.map(tag =&gt; (\n            &lt;div \n              key={tag}\n              className=\"relative group\"\n              onMouseEnter={(e) =&gt; handleMouseEnter(e, tag)}\n              onMouseLeave={handleMouseLeave}\n              onContextMenu={(e) =&gt; onContextMenu(e, 'tag', tag)}\n              onDragOver={(e) =&gt; {\n                e.preventDefault();\n                e.stopPropagation();\n                setDragOverTag(tag);\n                e.dataTransfer.dropEffect = 'copy';\n              }}\n              onDragLeave={(e) =&gt; {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  if (e.relatedTarget &amp;&amp; e.currentTarget.contains(e.relatedTarget as Node)) return;\n                  setDragOverTag(null);\n              }}\n              onDrop={(e) =&gt; {\n                e.preventDefault();\n                e.stopPropagation();\n                setDragOverTag(null);\n                const data = e.dataTransfer.getData('application/json');\n                if (data) {\n                    try {\n                        const ids = JSON.parse(data);\n                        if (Array.isArray(ids) &amp;&amp; ids.length &gt; 0) {\n                            onDropOnTag(tag, ids);\n                        }\n                    } catch (err) {}\n                }\n              }}\n            &gt;\n              &lt;div \n                className=\n          )",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 232,
                "column": 1
              },
              "endPosition": {
                "line": 232,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 232,
                "column": 7
              },
              "endPosition": {
                "line": 232,
                "column": 47
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagSection: React.FC&lt;TagSectionProps&gt; = ",
            "lineNumber": 232
          },
          {
            "lineNumber": 385
          },
          {
            "lineNumber": 386
          },
          {
            "text": "          {sortedTags.map(tag =&gt; (",
            "lineNumber": 387
          },
          {
            "text": "            &lt;div ",
            "lineNumber": 388
          },
          {
            "text": "              key={tag}",
            "lineNumber": 389
          },
          {
            "text": "              className=\"relative group\"",
            "lineNumber": 390
          },
          {
            "text": "              onMouseEnter={(e) =&gt; handleMouseEnter(e, tag)}",
            "lineNumber": 391
          },
          {
            "text": "              onMouseLeave={handleMouseLeave}",
            "lineNumber": 392
          },
          {
            "text": "              onContextMenu={(e) =&gt; onContextMenu(e, 'tag', tag)}",
            "lineNumber": 393
          },
          {
            "text": "              onDragOver={(e) =&gt; {",
            "lineNumber": 394
          },
          {
            "text": "                e.preventDefault();",
            "lineNumber": 395
          },
          {
            "text": "                e.stopPropagation();",
            "lineNumber": 396
          },
          {
            "text": "                setDragOverTag(tag);",
            "lineNumber": 397
          },
          {
            "text": "                e.dataTransfer.dropEffect = 'copy';",
            "lineNumber": 398
          },
          {
            "text": "              }}",
            "lineNumber": 399
          },
          {
            "text": "              onDragLeave={(e) =&gt; {",
            "lineNumber": 400
          },
          {
            "text": "                  e.preventDefault();",
            "lineNumber": 401
          },
          {
            "text": "                  e.stopPropagation();",
            "lineNumber": 402
          },
          {
            "text": "                  if (e.relatedTarget &amp;&amp; e.currentTarget.contains(e.relatedTarget as Node)) return;",
            "lineNumber": 403
          },
          {
            "text": "                  setDragOverTag(null);",
            "lineNumber": 404
          },
          {
            "text": "              }}",
            "lineNumber": 405
          },
          {
            "text": "              onDrop={(e) =&gt; {",
            "lineNumber": 406
          },
          {
            "text": "                e.preventDefault();",
            "lineNumber": 407
          },
          {
            "text": "                e.stopPropagation();",
            "lineNumber": 408
          },
          {
            "text": "                setDragOverTag(null);",
            "lineNumber": 409
          },
          {
            "text": "                const data = e.dataTransfer.getData('application/json');",
            "lineNumber": 410
          },
          {
            "text": "                if (data) {",
            "lineNumber": 411
          },
          {
            "text": "                    try {",
            "lineNumber": 412
          },
          {
            "text": "                        const ids = JSON.parse(data);",
            "lineNumber": 413
          },
          {
            "text": "                        if (Array.isArray(ids) &amp;&amp; ids.length &gt; 0) {",
            "lineNumber": 414
          },
          {
            "text": "                            onDropOnTag(tag, ids);",
            "lineNumber": 415
          },
          {
            "text": "                        }",
            "lineNumber": 416
          },
          {
            "text": "                    } catch (err) {}",
            "lineNumber": 417
          },
          {
            "text": "                }",
            "lineNumber": 418
          },
          {
            "text": "              }}",
            "lineNumber": 419
          },
          {
            "text": "            &gt;",
            "lineNumber": 420
          },
          {
            "text": "              &lt;div ",
            "lineNumber": 421
          },
          {
            "text": "                className=",
            "lineNumber": 422
          },
          {
            "text": "          )",
            "lineNumber": 458
          }
        ]
      },
      "score": 0.37159308791160583
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 213
          },
          "endPosition": {
            "line": 360,
            "column": 3
          }
        },
        "contents": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { \n  src: string; \n  alt: string; \n  isSelected: boolean;\n  filePath?: string;\n  modified?: string;\n  size?: number;\n  isHovering?: boolean;\n  fileMeta?: { format?: string };\n  resourceRoot?: string;\n  cachePath?: string;\n}) =&gt; {\n() =&gt; {\nconst loadAnimation = async \n\n      }\n    };\n\n    loadAnimation();\n\n    return () =&gt; {\n      isMounted = false;\n    };\n  }, [isHovering, filePath, fileMeta]);\n\n  const finalSrc = animSrc || thumbnailSrc;\n\n  return (\n    &lt;div ref={ref} className=\"w-full h-full relative overflow-hidden\"&gt;\n      {/* Placeholder Icon */}\n      &lt;div className=\"absolute inset-0 bg-gray-200 dark:bg-gray-800 flex items-center justify-center pointer-events-none\"&gt;\n        {loading &amp;&amp; !thumbnailSrc ? (\n          &lt;ImageIcon className=\"text-gray-400 dark:text-gray-600 animate-pulse\" size={24} /&gt;\n        ) : finalSrc ? (\n          &lt;img \n            src={finalSrc} \n            alt={alt} \n            className=\"absolute inset-0 w-full h-full object-cover\" \n            loading=\"eager\" \n            draggable=\"false\"\n          /&gt;\n        ) : (\n          &lt;ImageIcon className=\"text-gray-400 dark:text-gray-600\" size={24} /&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/div&gt;\n  );\n});",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 284,
                "column": 1
              },
              "endPosition": {
                "line": 284,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 7
              },
              "endPosition": {
                "line": 284,
                "column": 18
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 29
              },
              "endPosition": {
                "line": 285,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { ",
            "lineNumber": 214
          },
          {
            "text": "  src: string; ",
            "lineNumber": 215
          },
          {
            "text": "  alt: string; ",
            "lineNumber": 216
          },
          {
            "text": "  isSelected: boolean;",
            "lineNumber": 217
          },
          {
            "text": "  filePath?: string;",
            "lineNumber": 218
          },
          {
            "text": "  modified?: string;",
            "lineNumber": 219
          },
          {
            "text": "  size?: number;",
            "lineNumber": 220
          },
          {
            "text": "  isHovering?: boolean;",
            "lineNumber": 221
          },
          {
            "text": "  fileMeta?: { format?: string };",
            "lineNumber": 222
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 223
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 224
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 225
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 291
          },
          {
            "text": "const loadAnimation = async ",
            "lineNumber": 294
          },
          {
            "lineNumber": 328
          },
          {
            "text": "      }",
            "lineNumber": 329
          },
          {
            "text": "    };",
            "lineNumber": 330
          },
          {
            "lineNumber": 331
          },
          {
            "text": "    loadAnimation();",
            "lineNumber": 332
          },
          {
            "lineNumber": 333
          },
          {
            "text": "    return () =&gt; {",
            "lineNumber": 334
          },
          {
            "text": "      isMounted = false;",
            "lineNumber": 335
          },
          {
            "text": "    };",
            "lineNumber": 336
          },
          {
            "text": "  }, [isHovering, filePath, fileMeta]);",
            "lineNumber": 337
          },
          {
            "lineNumber": 338
          },
          {
            "text": "  const finalSrc = animSrc || thumbnailSrc;",
            "lineNumber": 339
          },
          {
            "lineNumber": 340
          },
          {
            "text": "  return (",
            "lineNumber": 341
          },
          {
            "text": "    &lt;div ref={ref} className=\"w-full h-full relative overflow-hidden\"&gt;",
            "lineNumber": 342
          },
          {
            "text": "      {/* Placeholder Icon */}",
            "lineNumber": 343
          },
          {
            "text": "      &lt;div className=\"absolute inset-0 bg-gray-200 dark:bg-gray-800 flex items-center justify-center pointer-events-none\"&gt;",
            "lineNumber": 344
          },
          {
            "text": "        {loading &amp;&amp; !thumbnailSrc ? (",
            "lineNumber": 345
          },
          {
            "text": "          &lt;ImageIcon className=\"text-gray-400 dark:text-gray-600 animate-pulse\" size={24} /&gt;",
            "lineNumber": 346
          },
          {
            "text": "        ) : finalSrc ? (",
            "lineNumber": 347
          },
          {
            "text": "          &lt;img ",
            "lineNumber": 348
          },
          {
            "text": "            src={finalSrc} ",
            "lineNumber": 349
          },
          {
            "text": "            alt={alt} ",
            "lineNumber": 350
          },
          {
            "text": "            className=\"absolute inset-0 w-full h-full object-cover\" ",
            "lineNumber": 351
          },
          {
            "text": "            loading=\"eager\" ",
            "lineNumber": 352
          },
          {
            "text": "            draggable=\"false\"",
            "lineNumber": 353
          },
          {
            "text": "          /&gt;",
            "lineNumber": 354
          },
          {
            "text": "        ) : (",
            "lineNumber": 355
          },
          {
            "text": "          &lt;ImageIcon className=\"text-gray-400 dark:text-gray-600\" size={24} /&gt;",
            "lineNumber": 356
          },
          {
            "text": "        )}",
            "lineNumber": 357
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 358
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 359
          },
          {
            "text": "  );",
            "lineNumber": 360
          },
          {
            "text": "});",
            "lineNumber": 361
          }
        ]
      },
      "score": 0.36653009057044983
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleCopyFiles = async \nprev =&gt; {\n\n              \n              return {\n                  ...prev,\n                  files: newFiles\n              };\n          });\n          \n          showToast(t('context.copied'));\n          console.log('[CopyFiles] Copy operation completed successfully');\n          // 完成任务\n          updateTask(taskId, { current: fileIds.length, status: 'completed' });\n          // 1秒后移除任务\n          setTimeout(() =&gt; {\n              setState(prev =&gt; ({\n                  ...prev,\n                  tasks: prev.tasks.filter(t =&gt; t.id !== taskId)\n              }));\n          }, 1000);\n      } catch (e) {\n          console.error('[CopyFiles] Error during copy operation:', e);\n          showToast(\"Copy failed\");\n          // 任务失败，直接移除\n          setTimeout(() =&gt; {\n              setState(prev =&gt; ({\n                  ...prev,\n                  tasks: prev.tasks.filter(t =&gt; t.id !== taskId)\n              }));\n          }, 1000);\n      }\n  };\n\n  const handleMoveFiles = async (\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 1885,
                "column": 3
              },
              "endPosition": {
                "line": 1885,
                "column": 9
              }
            },
            {
              "startPosition": {
                "line": 1885,
                "column": 9
              },
              "endPosition": {
                "line": 1885,
                "column": 25
              }
            },
            {
              "startPosition": {
                "line": 1885,
                "column": 37
              },
              "endPosition": {
                "line": 1886,
                "column": 5
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleCopyFiles = async ",
            "lineNumber": 1870
          },
          {
            "text": "prev =&gt; {",
            "lineNumber": 1916
          },
          {
            "lineNumber": 1939
          },
          {
            "text": "              ",
            "lineNumber": 1940
          },
          {
            "text": "              return {",
            "lineNumber": 1941
          },
          {
            "text": "                  ...prev,",
            "lineNumber": 1942
          },
          {
            "text": "                  files: newFiles",
            "lineNumber": 1943
          },
          {
            "text": "              };",
            "lineNumber": 1944
          },
          {
            "text": "          });",
            "lineNumber": 1945
          },
          {
            "text": "          ",
            "lineNumber": 1946
          },
          {
            "text": "          showToast(t('context.copied'));",
            "lineNumber": 1947
          },
          {
            "text": "          console.log('[CopyFiles] Copy operation completed successfully');",
            "lineNumber": 1948
          },
          {
            "text": "          // 完成任务",
            "lineNumber": 1949
          },
          {
            "text": "          updateTask(taskId, { current: fileIds.length, status: 'completed' });",
            "lineNumber": 1950
          },
          {
            "text": "          // 1秒后移除任务",
            "lineNumber": 1951
          },
          {
            "text": "          setTimeout(() =&gt; {",
            "lineNumber": 1952
          },
          {
            "text": "              setState(prev =&gt; ({",
            "lineNumber": 1953
          },
          {
            "text": "                  ...prev,",
            "lineNumber": 1954
          },
          {
            "text": "                  tasks: prev.tasks.filter(t =&gt; t.id !== taskId)",
            "lineNumber": 1955
          },
          {
            "text": "              }));",
            "lineNumber": 1956
          },
          {
            "text": "          }, 1000);",
            "lineNumber": 1957
          },
          {
            "text": "      } catch (e) {",
            "lineNumber": 1958
          },
          {
            "text": "          console.error('[CopyFiles] Error during copy operation:', e);",
            "lineNumber": 1959
          },
          {
            "text": "          showToast(\"Copy failed\");",
            "lineNumber": 1960
          },
          {
            "text": "          // 任务失败，直接移除",
            "lineNumber": 1961
          },
          {
            "text": "          setTimeout(() =&gt; {",
            "lineNumber": 1962
          },
          {
            "text": "              setState(prev =&gt; ({",
            "lineNumber": 1963
          },
          {
            "text": "                  ...prev,",
            "lineNumber": 1964
          },
          {
            "text": "                  tasks: prev.tasks.filter(t =&gt; t.id !== taskId)",
            "lineNumber": 1965
          },
          {
            "text": "              }));",
            "lineNumber": 1966
          },
          {
            "text": "          }, 1000);",
            "lineNumber": 1967
          },
          {
            "text": "      }",
            "lineNumber": 1968
          },
          {
            "text": "  };",
            "lineNumber": 1969
          },
          {
            "lineNumber": 1970
          },
          {
            "text": "  const handleMoveFiles = async (",
            "lineNumber": 1971
          },
          {
            "text": ";",
            "lineNumber": 2175
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.36342155933380127
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nobj =&gt; (\n\n                                                &lt;/span&gt;\n                                            ))}\n                                        &lt;/div&gt;\n                                    &lt;/div&gt;\n                                )}\n\n                                {file.aiData.extractedText &amp;&amp; (\n                                    &lt;div className=\"mt-2 bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;\n                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1 flex items-center\"&gt;\n                                            &lt;FileText size={10} className=\"mr-1\"/&gt; {t('meta.aiExtractedText')}\n                                        &lt;/div&gt;\n                                        &lt;p className=\"text-xs text-gray-700 dark:text-gray-300 whitespace-pre-wrap leading-relaxed\"&gt;{file.aiData.extractedText}&lt;/p&gt;\n                                    &lt;/div&gt;\n                                )}\n\n                                {file.aiData.translatedText &amp;&amp; (\n                                    &lt;div className=\"mt-2 bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;\n                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1 flex items-center\"&gt;\n                                            &lt;Languages size={10} className=\"mr-1\"/&gt; {t('meta.aiTranslatedText')}\n                                        &lt;/div&gt;\n                                        \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "obj =&gt; (",
            "lineNumber": 1206
          },
          {
            "lineNumber": 1208
          },
          {
            "text": "                                                &lt;/span&gt;",
            "lineNumber": 1209
          },
          {
            "text": "                                            ))}",
            "lineNumber": 1210
          },
          {
            "text": "                                        &lt;/div&gt;",
            "lineNumber": 1211
          },
          {
            "text": "                                    &lt;/div&gt;",
            "lineNumber": 1212
          },
          {
            "text": "                                )}",
            "lineNumber": 1213
          },
          {
            "lineNumber": 1214
          },
          {
            "text": "                                {file.aiData.extractedText &amp;&amp; (",
            "lineNumber": 1215
          },
          {
            "text": "                                    &lt;div className=\"mt-2 bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;",
            "lineNumber": 1216
          },
          {
            "text": "                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1 flex items-center\"&gt;",
            "lineNumber": 1217
          },
          {
            "text": "                                            &lt;FileText size={10} className=\"mr-1\"/&gt; {t('meta.aiExtractedText')}",
            "lineNumber": 1218
          },
          {
            "text": "                                        &lt;/div&gt;",
            "lineNumber": 1219
          },
          {
            "text": "                                        &lt;p className=\"text-xs text-gray-700 dark:text-gray-300 whitespace-pre-wrap leading-relaxed\"&gt;{file.aiData.extractedText}&lt;/p&gt;",
            "lineNumber": 1220
          },
          {
            "text": "                                    &lt;/div&gt;",
            "lineNumber": 1221
          },
          {
            "text": "                                )}",
            "lineNumber": 1222
          },
          {
            "lineNumber": 1223
          },
          {
            "text": "                                {file.aiData.translatedText &amp;&amp; (",
            "lineNumber": 1224
          },
          {
            "text": "                                    &lt;div className=\"mt-2 bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;",
            "lineNumber": 1225
          },
          {
            "text": "                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1 flex items-center\"&gt;",
            "lineNumber": 1226
          },
          {
            "text": "                                            &lt;Languages size={10} className=\"mr-1\"/&gt; {t('meta.aiTranslatedText')}",
            "lineNumber": 1227
          },
          {
            "text": "                                        &lt;/div&gt;",
            "lineNumber": 1228
          },
          {
            "text": "                                        ",
            "lineNumber": 1229
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.3632151484489441
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nallTexts.join('; ').length &gt; 300 ? '...' : ''}&#96;;\n                              }\n                          }\n                      } catch (err) {\n                          console.error('Failed to generate AI analysis', err);\n                          // Fallback to a better summary that doesn't list individual images\n                          const isChinese = state.settings.language === 'zh';\n                          summary = isChinese ? &#96;## 图片分析汇总\\n\\n&#96; : &#96;## Image Analysis Summary\\n\\n&#96;;\n                          \n                          // Extract all descriptions without numbering\n                          const allDescriptions = allResults\n                              .map(r =&gt; r.description || '')\n                              .filter(Boolean)\n                              .;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3599
          },
          {
            "text": "allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96;;",
            "lineNumber": 4333
          },
          {
            "text": "                              }",
            "lineNumber": 4334
          },
          {
            "text": "                          }",
            "lineNumber": 4335
          },
          {
            "text": "                      } catch (err) {",
            "lineNumber": 4336
          },
          {
            "text": "                          console.error('Failed to generate AI analysis', err);",
            "lineNumber": 4337
          },
          {
            "text": "                          // Fallback to a better summary that doesn't list individual images",
            "lineNumber": 4338
          },
          {
            "text": "                          const isChinese = state.settings.language === 'zh';",
            "lineNumber": 4339
          },
          {
            "text": "                          summary = isChinese ? &#96;## 图片分析汇总\\n\\n&#96; : &#96;## Image Analysis Summary\\n\\n&#96;;",
            "lineNumber": 4340
          },
          {
            "text": "                          ",
            "lineNumber": 4341
          },
          {
            "text": "                          // Extract all descriptions without numbering",
            "lineNumber": 4342
          },
          {
            "text": "                          const allDescriptions = allResults",
            "lineNumber": 4343
          },
          {
            "text": "                              .map(r =&gt; r.description || '')",
            "lineNumber": 4344
          },
          {
            "text": "                              .filter(Boolean)",
            "lineNumber": 4345
          },
          {
            "text": "                              .;",
            "lineNumber": 4346
          },
          {
            "text": ";",
            "lineNumber": 4392
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.3565160036087036
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 444
          },
          "endPosition": {
            "line": 807,
            "column": 1
          }
        },
        "contents": "export const TopBar: React.FC&lt;TopBarProps&gt; = \n\n                        &lt;span className=\"text-sm text-gray-700 dark:text-gray-200\"&gt;{t('folderSettings.remember')}&lt;/span&gt;\n                        &lt;button \n                            className={&#96;relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${hasFolderSettings ? 'bg-blue-500' : 'bg-gray-300 dark:bg-gray-600'}&#96;}\n                        &gt;\n                            &lt;span className={&#96;inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 ease-in-out ${hasFolderSettings ? 'translate-x-6' : 'translate-x-1'}&#96;} /&gt;\n                        &lt;/button&gt;\n                      &lt;/div&gt;\n                    &lt;/&gt;\n                  )}\n               &lt;/div&gt;\n             &lt;/&gt;\n           )}\n        &lt;/div&gt;\n\n        {/* Date Filter */}\n        &lt;div className=\"relative\"&gt;\n           &lt;button \n             onClick={() =&gt; setFilterMenuOpen(!filterMenuOpen)}\n             className={&#96;p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 ${filterMenuOpen || activeTab.dateFilter.start ? 'text-blue-500' : 'text-gray-600 dark:text-gray-300'}&#96;}\n             title={t('date.calendar')}\n           &gt;\n             &lt;Calendar size={18} /&gt;\n           &lt;/button&gt;\n           {filterMenuOpen &amp;&amp; (\n             &lt;&gt;\n               &lt;div className=\"fixed inset-0 z-40\" onClick={() =&gt; setFilterMenuOpen(false)}&gt;&lt;/div&gt;\n               &lt;div className=\"absolute top-full right-0 mt-2 z-50 animate-zoom-in\"&gt;\n                  &lt;CalendarWidget \n                      dateFilter={activeTab.dateFilter} \n                      onUpdate={onUpdateDateFilter}\n                      t={t}\n                  /&gt;\n               &lt;/div&gt;\n             &lt;/&gt;\n           )}\n        &lt;/div&gt;\n\n        {/* All Tags Widget */}\n        &lt;div className=\"relative\"&gt;\n           &lt;button\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 443,
                "column": 1
              },
              "endPosition": {
                "line": 443,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 8
              },
              "endPosition": {
                "line": 443,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 14
              },
              "endPosition": {
                "line": 443,
                "column": 46
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const TopBar: React.FC&lt;TopBarProps&gt; = ",
            "lineNumber": 445
          },
          {
            "lineNumber": 733
          },
          {
            "text": "                        &lt;span className=\"text-sm text-gray-700 dark:text-gray-200\"&gt;{t('folderSettings.remember')}&lt;/span&gt;",
            "lineNumber": 734
          },
          {
            "text": "                        &lt;button ",
            "lineNumber": 735
          },
          {
            "text": "                            className={&#96;relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${hasFolderSettings ? 'bg-blue-500' : 'bg-gray-300 dark:bg-gray-600'}&#96;}",
            "lineNumber": 736
          },
          {
            "text": "                        &gt;",
            "lineNumber": 737
          },
          {
            "text": "                            &lt;span className={&#96;inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 ease-in-out ${hasFolderSettings ? 'translate-x-6' : 'translate-x-1'}&#96;} /&gt;",
            "lineNumber": 738
          },
          {
            "text": "                        &lt;/button&gt;",
            "lineNumber": 739
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 740
          },
          {
            "text": "                    &lt;/&gt;",
            "lineNumber": 741
          },
          {
            "text": "                  )}",
            "lineNumber": 742
          },
          {
            "text": "               &lt;/div&gt;",
            "lineNumber": 743
          },
          {
            "text": "             &lt;/&gt;",
            "lineNumber": 744
          },
          {
            "text": "           )}",
            "lineNumber": 745
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 746
          },
          {
            "lineNumber": 747
          },
          {
            "text": "        {/* Date Filter */}",
            "lineNumber": 748
          },
          {
            "text": "        &lt;div className=\"relative\"&gt;",
            "lineNumber": 749
          },
          {
            "text": "           &lt;button ",
            "lineNumber": 750
          },
          {
            "text": "             onClick={() =&gt; setFilterMenuOpen(!filterMenuOpen)}",
            "lineNumber": 751
          },
          {
            "text": "             className={&#96;p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 ${filterMenuOpen || activeTab.dateFilter.start ? 'text-blue-500' : 'text-gray-600 dark:text-gray-300'}&#96;}",
            "lineNumber": 752
          },
          {
            "text": "             title={t('date.calendar')}",
            "lineNumber": 753
          },
          {
            "text": "           &gt;",
            "lineNumber": 754
          },
          {
            "text": "             &lt;Calendar size={18} /&gt;",
            "lineNumber": 755
          },
          {
            "text": "           &lt;/button&gt;",
            "lineNumber": 756
          },
          {
            "text": "           {filterMenuOpen &amp;&amp; (",
            "lineNumber": 757
          },
          {
            "text": "             &lt;&gt;",
            "lineNumber": 758
          },
          {
            "text": "               &lt;div className=\"fixed inset-0 z-40\" onClick={() =&gt; setFilterMenuOpen(false)}&gt;&lt;/div&gt;",
            "lineNumber": 759
          },
          {
            "text": "               &lt;div className=\"absolute top-full right-0 mt-2 z-50 animate-zoom-in\"&gt;",
            "lineNumber": 760
          },
          {
            "text": "                  &lt;CalendarWidget ",
            "lineNumber": 761
          },
          {
            "text": "                      dateFilter={activeTab.dateFilter} ",
            "lineNumber": 762
          },
          {
            "text": "                      onUpdate={onUpdateDateFilter}",
            "lineNumber": 763
          },
          {
            "text": "                      t={t}",
            "lineNumber": 764
          },
          {
            "text": "                  /&gt;",
            "lineNumber": 765
          },
          {
            "text": "               &lt;/div&gt;",
            "lineNumber": 766
          },
          {
            "text": "             &lt;/&gt;",
            "lineNumber": 767
          },
          {
            "text": "           )}",
            "lineNumber": 768
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 769
          },
          {
            "lineNumber": 770
          },
          {
            "text": "        {/* All Tags Widget */}",
            "lineNumber": 771
          },
          {
            "text": "        &lt;div className=\"relative\"&gt;",
            "lineNumber": 772
          },
          {
            "text": "           &lt;button",
            "lineNumber": 773
          },
          {
            "text": ";",
            "lineNumber": 808
          }
        ]
      },
      "score": 0.3526848554611206
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 231
          },
          "endPosition": {
            "line": 584,
            "column": 1
          }
        },
        "contents": "const TagSection: React.FC&lt;TagSectionProps&gt; = \ntag =&gt; (\n\n              \n              {hoveredTag === tag &amp;&amp; previewImages.length &gt; 0 &amp;&amp; hoveredTagPos &amp;&amp; createPortal(\n                &lt;div \n                  className=\"fixed z-[100] bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl p-3 w-64 animate-fade-in pointer-events-none\" \n                  style={{ top: hoveredTagPos.top, left: hoveredTagPos.left }}\n                &gt;\n                  &lt;div className=\"text-sm text-gray-800 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-600 pb-1 font-bold flex items-center justify-between\"&gt;\n                     &lt;span&gt;{t('sidebar.tagPreview')} \"{hoveredTag}\"&lt;/span&gt;\n                     &lt;span className=\"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 rounded\"&gt;{previewImages.length} {t('sidebar.recent')}&lt;/span&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\"grid grid-cols-3 gap-2\"&gt;\n                    {previewImages.map(img =&gt; (\n                      &lt;div key={img.id} className=\"aspect-square bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-700 overflow-hidden\"&gt;\n                         {/* Note: In Tauri, file.url is a file path, not a usable URL. Use placeholder for now. */}\n                         &lt;div className=\"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center\"&gt;\n                           &lt;ImageIcon className=\"text-gray-400 dark:text-gray-500\" size={20} /&gt;\n                         &lt;/div&gt;\n                      &lt;/div&gt;\n                    ))}\n                  &lt;/div&gt;\n                &lt;/div&gt;,\n                document.body\n              )}\n            &lt;/div&gt;\n          ))}\n          {sortedTags.length === 0 &amp;&amp; !isCreatingTag &amp;&amp; (\n             &lt;div className=\"text-xs text-gray-400 italic px-2 py-1\"&gt;{t('sidebar.rightClickToAdd')}&lt;/div&gt;\n          )}\n        &lt;/div&gt;\n      )}\n    &lt;/div&gt;\n  );\n}\n\nexport const Sidebar: React.FC&lt;{\n  roots: string[];\n  files: Record&lt;string, FileNode&gt;;\n  people: Record&lt;string, Person&gt;;\n  customTags: string[];\n  currentFolderId: string;\n  expandedIds: string[];\n  tasks?: TaskProgress[];\n  onToggle: (id: string) =&gt; void;\n  onNavigate: (id: string) =&gt; void;\n  onTagSelect: (tag: string) =&gt; void;\n  onNavigateAllTags: () =&gt; void;\n  onPersonSelect: (personId: string) =&gt; void;\n  onNavigateAllPeople: () =&gt; void;\n  onContextMenu: (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'person', id: string) =&gt; void;\n  onDrop: (targetId: string, sourceIds: string[]) =&gt; void;\n  onDropOnTag: (tag: string, sourceIds: string[]) =&gt; void;\n  isCreatingTag: boolean;\n  onStartCreateTag: () =&gt; void;\n  onSaveNewTag: (tag: string) =&gt; void;\n  onCancelCreateTag: () =&gt; void;\n  onOpenSettings: () =&gt; void;\n  onRestoreTask: (taskId: string) =&gt; void;\n  onStartRenamePerson: (personId: string) =&gt; void;\n  onCreatePerson: () =&gt; void;\n  t: (key: string) =&gt; string;\n}&gt; = \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 232,
                "column": 1
              },
              "endPosition": {
                "line": 232,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 232,
                "column": 7
              },
              "endPosition": {
                "line": 232,
                "column": 47
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 12
              },
              "endPosition": {
                "line": 387,
                "column": 12
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 27
              },
              "endPosition": {
                "line": 388,
                "column": 13
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagSection: React.FC&lt;TagSectionProps&gt; = ",
            "lineNumber": 232
          },
          {
            "text": "tag =&gt; (",
            "lineNumber": 387
          },
          {
            "lineNumber": 433
          },
          {
            "text": "              ",
            "lineNumber": 434
          },
          {
            "text": "              {hoveredTag === tag &amp;&amp; previewImages.length &gt; 0 &amp;&amp; hoveredTagPos &amp;&amp; createPortal(",
            "lineNumber": 435
          },
          {
            "text": "                &lt;div ",
            "lineNumber": 436
          },
          {
            "text": "                  className=\"fixed z-[100] bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl p-3 w-64 animate-fade-in pointer-events-none\" ",
            "lineNumber": 437
          },
          {
            "text": "                  style={{ top: hoveredTagPos.top, left: hoveredTagPos.left }}",
            "lineNumber": 438
          },
          {
            "text": "                &gt;",
            "lineNumber": 439
          },
          {
            "text": "                  &lt;div className=\"text-sm text-gray-800 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-600 pb-1 font-bold flex items-center justify-between\"&gt;",
            "lineNumber": 440
          },
          {
            "text": "                     &lt;span&gt;{t('sidebar.tagPreview')} \"{hoveredTag}\"&lt;/span&gt;",
            "lineNumber": 441
          },
          {
            "text": "                     &lt;span className=\"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 rounded\"&gt;{previewImages.length} {t('sidebar.recent')}&lt;/span&gt;",
            "lineNumber": 442
          },
          {
            "text": "                  &lt;/div&gt;",
            "lineNumber": 443
          },
          {
            "text": "                  &lt;div className=\"grid grid-cols-3 gap-2\"&gt;",
            "lineNumber": 444
          },
          {
            "text": "                    {previewImages.map(img =&gt; (",
            "lineNumber": 445
          },
          {
            "text": "                      &lt;div key={img.id} className=\"aspect-square bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-700 overflow-hidden\"&gt;",
            "lineNumber": 446
          },
          {
            "text": "                         {/* Note: In Tauri, file.url is a file path, not a usable URL. Use placeholder for now. */}",
            "lineNumber": 447
          },
          {
            "text": "                         &lt;div className=\"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center\"&gt;",
            "lineNumber": 448
          },
          {
            "text": "                           &lt;ImageIcon className=\"text-gray-400 dark:text-gray-500\" size={20} /&gt;",
            "lineNumber": 449
          },
          {
            "text": "                         &lt;/div&gt;",
            "lineNumber": 450
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 451
          },
          {
            "text": "                    ))}",
            "lineNumber": 452
          },
          {
            "text": "                  &lt;/div&gt;",
            "lineNumber": 453
          },
          {
            "text": "                &lt;/div&gt;,",
            "lineNumber": 454
          },
          {
            "text": "                document.body",
            "lineNumber": 455
          },
          {
            "text": "              )}",
            "lineNumber": 456
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 457
          },
          {
            "text": "          ))}",
            "lineNumber": 458
          },
          {
            "text": "          {sortedTags.length === 0 &amp;&amp; !isCreatingTag &amp;&amp; (",
            "lineNumber": 459
          },
          {
            "text": "             &lt;div className=\"text-xs text-gray-400 italic px-2 py-1\"&gt;{t('sidebar.rightClickToAdd')}&lt;/div&gt;",
            "lineNumber": 460
          },
          {
            "text": "          )}",
            "lineNumber": 461
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 462
          },
          {
            "text": "      )}",
            "lineNumber": 463
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 464
          },
          {
            "text": "  );",
            "lineNumber": 465
          },
          {
            "text": "}",
            "lineNumber": 466
          },
          {
            "lineNumber": 467
          },
          {
            "text": "export const Sidebar: React.FC&lt;{",
            "lineNumber": 468
          },
          {
            "text": "  roots: string[];",
            "lineNumber": 469
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 470
          },
          {
            "text": "  people: Record&lt;string, Person&gt;;",
            "lineNumber": 471
          },
          {
            "text": "  customTags: string[];",
            "lineNumber": 472
          },
          {
            "text": "  currentFolderId: string;",
            "lineNumber": 473
          },
          {
            "text": "  expandedIds: string[];",
            "lineNumber": 474
          },
          {
            "text": "  tasks?: TaskProgress[];",
            "lineNumber": 475
          },
          {
            "text": "  onToggle: (id: string) =&gt; void;",
            "lineNumber": 476
          },
          {
            "text": "  onNavigate: (id: string) =&gt; void;",
            "lineNumber": 477
          },
          {
            "text": "  onTagSelect: (tag: string) =&gt; void;",
            "lineNumber": 478
          },
          {
            "text": "  onNavigateAllTags: () =&gt; void;",
            "lineNumber": 479
          },
          {
            "text": "  onPersonSelect: (personId: string) =&gt; void;",
            "lineNumber": 480
          },
          {
            "text": "  onNavigateAllPeople: () =&gt; void;",
            "lineNumber": 481
          },
          {
            "text": "  onContextMenu: (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'person', id: string) =&gt; void;",
            "lineNumber": 482
          },
          {
            "text": "  onDrop: (targetId: string, sourceIds: string[]) =&gt; void;",
            "lineNumber": 483
          },
          {
            "text": "  onDropOnTag: (tag: string, sourceIds: string[]) =&gt; void;",
            "lineNumber": 484
          },
          {
            "text": "  isCreatingTag: boolean;",
            "lineNumber": 485
          },
          {
            "text": "  onStartCreateTag: () =&gt; void;",
            "lineNumber": 486
          },
          {
            "text": "  onSaveNewTag: (tag: string) =&gt; void;",
            "lineNumber": 487
          },
          {
            "text": "  onCancelCreateTag: () =&gt; void;",
            "lineNumber": 488
          },
          {
            "text": "  onOpenSettings: () =&gt; void;",
            "lineNumber": 489
          },
          {
            "text": "  onRestoreTask: (taskId: string) =&gt; void;",
            "lineNumber": 490
          },
          {
            "text": "  onStartRenamePerson: (personId: string) =&gt; void;",
            "lineNumber": 491
          },
          {
            "text": "  onCreatePerson: () =&gt; void;",
            "lineNumber": 492
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 493
          },
          {
            "text": "}&gt; = ",
            "lineNumber": 494
          },
          {
            "text": ";",
            "lineNumber": 585
          }
        ]
      },
      "score": 0.3524027466773987
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 467
          },
          "endPosition": {
            "line": 584,
            "column": 1
          }
        },
        "contents": "export const Sidebar: React.FC&lt;{\n  roots: string[];\n  files: Record&lt;string, FileNode&gt;;\n  people: Record&lt;string, Person&gt;;\n  customTags: string[];\n  currentFolderId: string;\n  expandedIds: string[];\n  tasks?: TaskProgress[];\n  onToggle: (id: string) =&gt; void;\n  onNavigate: (id: string) =&gt; void;\n  onTagSelect: (tag: string) =&gt; void;\n  onNavigateAllTags: () =&gt; void;\n  onPersonSelect: (personId: string) =&gt; void;\n  onNavigateAllPeople: () =&gt; void;\n  onContextMenu: (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'person', id: string) =&gt; void;\n  onDrop: (targetId: string, sourceIds: string[]) =&gt; void;\n  onDropOnTag: (tag: string, sourceIds: string[]) =&gt; void;\n  isCreatingTag: boolean;\n  onStartCreateTag: () =&gt; void;\n  onSaveNewTag: (tag: string) =&gt; void;\n  onCancelCreateTag: () =&gt; void;\n  onOpenSettings: () =&gt; void;\n  onRestoreTask: (taskId: string) =&gt; void;\n  onStartRenamePerson: (personId: string) =&gt; void;\n  onCreatePerson: () =&gt; void;\n  t: (key: string) =&gt; string;\n}&gt; =  {\n  \n  const minimizedTasks = tasks ? tasks.filter(task =&gt; task.minimized &amp;&amp; task.status === 'running') : [];\n\n  return (\n    &lt;div className=\"w-full h-full flex flex-col\"&gt;\n      &lt;div className=\"p-3 font-bold text-gray-500 dark:text-gray-400 text-xs uppercase tracking-wider border-b border-gray-200 dark:border-gray-800\"&gt;\n        {t('sidebar.catalog')}\n      &lt;/div&gt;\n      &lt;div className=\"flex-1 overflow-y-auto scrollbar-thin\"&gt;\n        {roots.map(rootId =&gt; (\n          &lt;TreeNode \n            key={rootId}\n            files={files}\n            nodeId={rootId}\n            currentFolderId={currentFolderId}\n            expandedIds={expandedIds}\n            onToggle={onToggle}\n            onNavigate={onNavigate}\n            onContextMenu={onContextMenu}\n            onDrop={onDrop}\n          /&gt;\n        ))}\n        \n        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;\n        \n        &lt;PeopleSection \n           people={people}\n           files={files}\n           onPersonSelect={onPersonSelect}\n           onNavigateAllPeople={onNavigateAllPeople}\n           onContextMenu={onContextMenu}\n           onStartRenamePerson={onStartRenamePerson}\n           onCreatePerson={onCreatePerson}\n           t={t}\n        /&gt;\n\n        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;\n        \n        &lt;TagSection \n          files={files} \n          customTags={customTags}\n          onTagSelect={onTagSelect} \n          onNavigateAllTags={onNavigateAllTags} \n          onContextMenu={onContextMenu}\n          isCreatingTag={isCreatingTag}\n          onStartCreateTag={onStartCreateTag}\n          onSaveNewTag={onSaveNewTag}\n          onCancelCreateTag={onCancelCreateTag}\n          onDropOnTag={onDropOnTag}\n          t={t}\n        /&gt;\n      &lt;/div&gt;\n      \n      {minimizedTasks.length &gt; 0 &amp;&amp;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 468,
                "column": 1
              },
              "endPosition": {
                "line": 468,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 468,
                "column": 8
              },
              "endPosition": {
                "line": 468,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 468,
                "column": 14
              },
              "endPosition": {
                "line": 494,
                "column": 6
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const Sidebar: React.FC&lt;{",
            "lineNumber": 468
          },
          {
            "text": "  roots: string[];",
            "lineNumber": 469
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 470
          },
          {
            "text": "  people: Record&lt;string, Person&gt;;",
            "lineNumber": 471
          },
          {
            "text": "  customTags: string[];",
            "lineNumber": 472
          },
          {
            "text": "  currentFolderId: string;",
            "lineNumber": 473
          },
          {
            "text": "  expandedIds: string[];",
            "lineNumber": 474
          },
          {
            "text": "  tasks?: TaskProgress[];",
            "lineNumber": 475
          },
          {
            "text": "  onToggle: (id: string) =&gt; void;",
            "lineNumber": 476
          },
          {
            "text": "  onNavigate: (id: string) =&gt; void;",
            "lineNumber": 477
          },
          {
            "text": "  onTagSelect: (tag: string) =&gt; void;",
            "lineNumber": 478
          },
          {
            "text": "  onNavigateAllTags: () =&gt; void;",
            "lineNumber": 479
          },
          {
            "text": "  onPersonSelect: (personId: string) =&gt; void;",
            "lineNumber": 480
          },
          {
            "text": "  onNavigateAllPeople: () =&gt; void;",
            "lineNumber": 481
          },
          {
            "text": "  onContextMenu: (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'person', id: string) =&gt; void;",
            "lineNumber": 482
          },
          {
            "text": "  onDrop: (targetId: string, sourceIds: string[]) =&gt; void;",
            "lineNumber": 483
          },
          {
            "text": "  onDropOnTag: (tag: string, sourceIds: string[]) =&gt; void;",
            "lineNumber": 484
          },
          {
            "text": "  isCreatingTag: boolean;",
            "lineNumber": 485
          },
          {
            "text": "  onStartCreateTag: () =&gt; void;",
            "lineNumber": 486
          },
          {
            "text": "  onSaveNewTag: (tag: string) =&gt; void;",
            "lineNumber": 487
          },
          {
            "text": "  onCancelCreateTag: () =&gt; void;",
            "lineNumber": 488
          },
          {
            "text": "  onOpenSettings: () =&gt; void;",
            "lineNumber": 489
          },
          {
            "text": "  onRestoreTask: (taskId: string) =&gt; void;",
            "lineNumber": 490
          },
          {
            "text": "  onStartRenamePerson: (personId: string) =&gt; void;",
            "lineNumber": 491
          },
          {
            "text": "  onCreatePerson: () =&gt; void;",
            "lineNumber": 492
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 493
          },
          {
            "text": "}&gt; =  {",
            "lineNumber": 494
          },
          {
            "text": "  ",
            "lineNumber": 495
          },
          {
            "text": "  const minimizedTasks = tasks ? tasks.filter(task =&gt; task.minimized &amp;&amp; task.status === 'running') : [];",
            "lineNumber": 496
          },
          {
            "lineNumber": 497
          },
          {
            "text": "  return (",
            "lineNumber": 498
          },
          {
            "text": "    &lt;div className=\"w-full h-full flex flex-col\"&gt;",
            "lineNumber": 499
          },
          {
            "text": "      &lt;div className=\"p-3 font-bold text-gray-500 dark:text-gray-400 text-xs uppercase tracking-wider border-b border-gray-200 dark:border-gray-800\"&gt;",
            "lineNumber": 500
          },
          {
            "text": "        {t('sidebar.catalog')}",
            "lineNumber": 501
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 502
          },
          {
            "text": "      &lt;div className=\"flex-1 overflow-y-auto scrollbar-thin\"&gt;",
            "lineNumber": 503
          },
          {
            "text": "        {roots.map(rootId =&gt; (",
            "lineNumber": 504
          },
          {
            "text": "          &lt;TreeNode ",
            "lineNumber": 505
          },
          {
            "text": "            key={rootId}",
            "lineNumber": 506
          },
          {
            "text": "            files={files}",
            "lineNumber": 507
          },
          {
            "text": "            nodeId={rootId}",
            "lineNumber": 508
          },
          {
            "text": "            currentFolderId={currentFolderId}",
            "lineNumber": 509
          },
          {
            "text": "            expandedIds={expandedIds}",
            "lineNumber": 510
          },
          {
            "text": "            onToggle={onToggle}",
            "lineNumber": 511
          },
          {
            "text": "            onNavigate={onNavigate}",
            "lineNumber": 512
          },
          {
            "text": "            onContextMenu={onContextMenu}",
            "lineNumber": 513
          },
          {
            "text": "            onDrop={onDrop}",
            "lineNumber": 514
          },
          {
            "text": "          /&gt;",
            "lineNumber": 515
          },
          {
            "text": "        ))}",
            "lineNumber": 516
          },
          {
            "text": "        ",
            "lineNumber": 517
          },
          {
            "text": "        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;",
            "lineNumber": 518
          },
          {
            "text": "        ",
            "lineNumber": 519
          },
          {
            "text": "        &lt;PeopleSection ",
            "lineNumber": 520
          },
          {
            "text": "           people={people}",
            "lineNumber": 521
          },
          {
            "text": "           files={files}",
            "lineNumber": 522
          },
          {
            "text": "           onPersonSelect={onPersonSelect}",
            "lineNumber": 523
          },
          {
            "text": "           onNavigateAllPeople={onNavigateAllPeople}",
            "lineNumber": 524
          },
          {
            "text": "           onContextMenu={onContextMenu}",
            "lineNumber": 525
          },
          {
            "text": "           onStartRenamePerson={onStartRenamePerson}",
            "lineNumber": 526
          },
          {
            "text": "           onCreatePerson={onCreatePerson}",
            "lineNumber": 527
          },
          {
            "text": "           t={t}",
            "lineNumber": 528
          },
          {
            "text": "        /&gt;",
            "lineNumber": 529
          },
          {
            "lineNumber": 530
          },
          {
            "text": "        &lt;div className=\"my-2 border-t border-gray-200 dark:border-gray-800\"&gt;&lt;/div&gt;",
            "lineNumber": 531
          },
          {
            "text": "        ",
            "lineNumber": 532
          },
          {
            "text": "        &lt;TagSection ",
            "lineNumber": 533
          },
          {
            "text": "          files={files} ",
            "lineNumber": 534
          },
          {
            "text": "          customTags={customTags}",
            "lineNumber": 535
          },
          {
            "text": "          onTagSelect={onTagSelect} ",
            "lineNumber": 536
          },
          {
            "text": "          onNavigateAllTags={onNavigateAllTags} ",
            "lineNumber": 537
          },
          {
            "text": "          onContextMenu={onContextMenu}",
            "lineNumber": 538
          },
          {
            "text": "          isCreatingTag={isCreatingTag}",
            "lineNumber": 539
          },
          {
            "text": "          onStartCreateTag={onStartCreateTag}",
            "lineNumber": 540
          },
          {
            "text": "          onSaveNewTag={onSaveNewTag}",
            "lineNumber": 541
          },
          {
            "text": "          onCancelCreateTag={onCancelCreateTag}",
            "lineNumber": 542
          },
          {
            "text": "          onDropOnTag={onDropOnTag}",
            "lineNumber": 543
          },
          {
            "text": "          t={t}",
            "lineNumber": 544
          },
          {
            "text": "        /&gt;",
            "lineNumber": 545
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 546
          },
          {
            "text": "      ",
            "lineNumber": 547
          },
          {
            "text": "      {minimizedTasks.length &gt; 0 &amp;&amp;",
            "lineNumber": 548
          },
          {
            "text": ";",
            "lineNumber": 585
          }
        ]
      },
      "score": 0.3521040678024292
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleFolderAIAnalysis = async \nconst getAllImageFilesInFolder = \n\n                  if (child) {\n                      if (child.type === FileType.FOLDER) {\n                          // Recursively get files from subfolders\n                          imageFiles = [...imageFiles, ...getAllImageFilesInFolder(childId)];\n                      } else if (child.type === FileType.IMAGE) {\n                          // Check if image has been analyzed\n                          const analyzed = !!child.aiData?.analyzed;\n                          imageFiles.push({ id: childId, analyzed });\n                      }\n                  }\n              }\n          }\n          \n          return imageFiles;\n      };\n      \n      // Get all image files with their analysis status\n      const allImageFiles = getAllImageFilesInFolder(folderId);\n      \n      // Filter out non-image files and get all image IDs\n      const allImageIds = allImageFiles.map(file =&gt; file.id);\n      \n      if (allImageIds.length === 0) return;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleFolderAIAnalysis = async ",
            "lineNumber": 4395
          },
          {
            "text": "const getAllImageFilesInFolder = ",
            "lineNumber": 4397
          },
          {
            "lineNumber": 4405
          },
          {
            "text": "                  if (child) {",
            "lineNumber": 4406
          },
          {
            "text": "                      if (child.type === FileType.FOLDER) {",
            "lineNumber": 4407
          },
          {
            "text": "                          // Recursively get files from subfolders",
            "lineNumber": 4408
          },
          {
            "text": "                          imageFiles = [...imageFiles, ...getAllImageFilesInFolder(childId)];",
            "lineNumber": 4409
          },
          {
            "text": "                      } else if (child.type === FileType.IMAGE) {",
            "lineNumber": 4410
          },
          {
            "text": "                          // Check if image has been analyzed",
            "lineNumber": 4411
          },
          {
            "text": "                          const analyzed = !!child.aiData?.analyzed;",
            "lineNumber": 4412
          },
          {
            "text": "                          imageFiles.push({ id: childId, analyzed });",
            "lineNumber": 4413
          },
          {
            "text": "                      }",
            "lineNumber": 4414
          },
          {
            "text": "                  }",
            "lineNumber": 4415
          },
          {
            "text": "              }",
            "lineNumber": 4416
          },
          {
            "text": "          }",
            "lineNumber": 4417
          },
          {
            "text": "          ",
            "lineNumber": 4418
          },
          {
            "text": "          return imageFiles;",
            "lineNumber": 4419
          },
          {
            "text": "      };",
            "lineNumber": 4420
          },
          {
            "text": "      ",
            "lineNumber": 4421
          },
          {
            "text": "      // Get all image files with their analysis status",
            "lineNumber": 4422
          },
          {
            "text": "      const allImageFiles = getAllImageFilesInFolder(folderId);",
            "lineNumber": 4423
          },
          {
            "text": "      ",
            "lineNumber": 4424
          },
          {
            "text": "      // Filter out non-image files and get all image IDs",
            "lineNumber": 4425
          },
          {
            "text": "      const allImageIds = allImageFiles.map(file =&gt; file.id);",
            "lineNumber": 4426
          },
          {
            "text": "      ",
            "lineNumber": 4427
          },
          {
            "text": "      if (allImageIds.length === 0) return;",
            "lineNumber": 4428
          },
          {
            "text": ";",
            "lineNumber": 4441
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.34482699632644653
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "tags-overview",
  "path": "src/components/FileGrid.tsx",
  "contextAfter": 20,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "tags-overview",
    "path": "src/components/FileGrid.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/components/FileGrid.tsx",
              "matches": [
                {
                  "lineNumber": 1336,
                  "content": "  viewMode: 'browser' | 'tags-overview' | 'people-overview',"
                },
                {
                  "lineNumber": 1337,
                  "content": "  groupedTags?: Record&lt;string, string[]&gt;,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1338,
                  "content": "  people?: Record&lt;string, Person&gt;,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1339,
                  "content": "  searchQuery?: string",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1340,
                  "content": ") =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1341,
                  "content": "  const aspectRatios = useMemo(() =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1342,
                  "content": "    const ratios: Record&lt;string, number&gt; = {};",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1343,
                  "content": "    if (viewMode === 'browser') {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1344,
                  "content": "      items.forEach(id =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1345,
                  "content": "        const file = files[id];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1346,
                  "content": "        ratios[id] = file?.meta?.width &amp;&amp; file?.meta?.height",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1347,
                  "content": "          ? file.meta.width / file.meta.height",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1348,
                  "content": "          : (file?.type === FileType.FOLDER ? 1 : 1);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1349,
                  "content": "      });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1350,
                  "content": "    }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1351,
                  "content": "    return ratios;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1352,
                  "content": "  }, [items, files, viewMode]);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1353,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1354,
                  "content": "  return useMemo(() =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1355,
                  "content": "    const layout: LayoutItem[] = [];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1356,
                  "content": "    let totalHeight = 0;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1811,
                  "content": "  if (activeTab.viewMode === 'tags-overview') {"
                },
                {
                  "lineNumber": 1812,
                  "content": "      return (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1813,
                  "content": "          &lt;div",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1814,
                  "content": "              ref={containerRef}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1815,
                  "content": "              className=\"w-full h-full overflow-auto px-6 pb-6 relative\"",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1816,
                  "content": "              onContextMenu={onBackgroundContextMenu}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1817,
                  "content": "              onMouseDown={onMouseDown}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1818,
                  "content": "              onMouseMove={onMouseMove}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1819,
                  "content": "              onMouseUp={onMouseUp}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1820,
                  "content": "          &gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1821,
                  "content": "              &lt;div className=\"absolute inset-0 pointer-events-none z-50\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1822,
                  "content": "                  {selectionBox &amp;&amp; (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1823,
                  "content": "                      &lt;div",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1824,
                  "content": "                          className=\"absolute border-2 border-blue-500 bg-blue-100 dark:bg-blue-900/20 opacity-50 pointer-events-none\"",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1825,
                  "content": "                          style={{",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1826,
                  "content": "                              left: Math.min(selectionBox.startX, selectionBox.currentX),",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1827,
                  "content": "                              top: Math.min(selectionBox.startY, selectionBox.currentY),",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1828,
                  "content": "                              width: Math.abs(selectionBox.currentX - selectionBox.startX),",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1829,
                  "content": "                              height: Math.abs(selectionBox.currentY - selectionBox.startY),",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1830,
                  "content": "                          }}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1831,
                  "content": "                      /&gt;",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 42,
          "totalMatchedLines": 2
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---



---


查看标签面板的显示逻辑：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "TagCard|tags-overview.*tag",
  "path": "src/components/FileGrid.tsx",
  "contextAfter": 10,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "TagCard|tags-overview.*tag",
    "path": "src/components/FileGrid.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {}
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "TagCard 标签卡片组件显示标签",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 213
          },
          "endPosition": {
            "line": 360,
            "column": 1
          }
        },
        "contents": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { \n  src: string; \n  alt: string; \n  isSelected: boolean;\n  filePath?: string;\n  modified?: string;\n  size?: number;\n  isHovering?: boolean;\n  fileMeta?: { format?: string };\n  resourceRoot?: string;\n  cachePath?: string;\n}) =&gt; {\n() =&gt; {\nconst loadThumbnail = async \n\n        \n        try {\n          const { getThumbnail } = await import('../api/tauri-bridge');\n          const thumbnail = await getThumbnail(filePath, modified, resourceRoot, controller.signal);\n          \n          if (!controller.signal.aborted &amp;&amp; thumbnail) {\n            // 更新全局缓存\n            if (cache.get(key) !== thumbnail) {\n                cache.set(key, thumbnail);\n                setThumbnailSrc(thumbnail);\n            }\n          }\n        } catch (error) {\n          if (!controller.signal.aborted) {\n            console.error('Failed to load thumbnail:', error);\n          }\n        } finally {\n          if (!controller.signal.aborted) {\n            setLoading(false);\n          }\n        }\n      };\n\n      loadThumbnail();\n\n      return () =&gt; {\n        controller.abort();\n      };\n    }\n  },\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { ",
            "lineNumber": 214
          },
          {
            "text": "  src: string; ",
            "lineNumber": 215
          },
          {
            "text": "  alt: string; ",
            "lineNumber": 216
          },
          {
            "text": "  isSelected: boolean;",
            "lineNumber": 217
          },
          {
            "text": "  filePath?: string;",
            "lineNumber": 218
          },
          {
            "text": "  modified?: string;",
            "lineNumber": 219
          },
          {
            "text": "  size?: number;",
            "lineNumber": 220
          },
          {
            "text": "  isHovering?: boolean;",
            "lineNumber": 221
          },
          {
            "text": "  fileMeta?: { format?: string };",
            "lineNumber": 222
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 223
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 224
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 225
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 242
          },
          {
            "text": "const loadThumbnail = async ",
            "lineNumber": 255
          },
          {
            "lineNumber": 257
          },
          {
            "text": "        ",
            "lineNumber": 258
          },
          {
            "text": "        try {",
            "lineNumber": 259
          },
          {
            "text": "          const { getThumbnail } = await import('../api/tauri-bridge');",
            "lineNumber": 260
          },
          {
            "text": "          const thumbnail = await getThumbnail(filePath, modified, resourceRoot, controller.signal);",
            "lineNumber": 261
          },
          {
            "text": "          ",
            "lineNumber": 262
          },
          {
            "text": "          if (!controller.signal.aborted &amp;&amp; thumbnail) {",
            "lineNumber": 263
          },
          {
            "text": "            // 更新全局缓存",
            "lineNumber": 264
          },
          {
            "text": "            if (cache.get(key) !== thumbnail) {",
            "lineNumber": 265
          },
          {
            "text": "                cache.set(key, thumbnail);",
            "lineNumber": 266
          },
          {
            "text": "                setThumbnailSrc(thumbnail);",
            "lineNumber": 267
          },
          {
            "text": "            }",
            "lineNumber": 268
          },
          {
            "text": "          }",
            "lineNumber": 269
          },
          {
            "text": "        } catch (error) {",
            "lineNumber": 270
          },
          {
            "text": "          if (!controller.signal.aborted) {",
            "lineNumber": 271
          },
          {
            "text": "            console.error('Failed to load thumbnail:', error);",
            "lineNumber": 272
          },
          {
            "text": "          }",
            "lineNumber": 273
          },
          {
            "text": "        } finally {",
            "lineNumber": 274
          },
          {
            "text": "          if (!controller.signal.aborted) {",
            "lineNumber": 275
          },
          {
            "text": "            setLoading(false);",
            "lineNumber": 276
          },
          {
            "text": "          }",
            "lineNumber": 277
          },
          {
            "text": "        }",
            "lineNumber": 278
          },
          {
            "text": "      };",
            "lineNumber": 279
          },
          {
            "lineNumber": 280
          },
          {
            "text": "      loadThumbnail();",
            "lineNumber": 281
          },
          {
            "lineNumber": 282
          },
          {
            "text": "      return () =&gt; {",
            "lineNumber": 283
          },
          {
            "text": "        controller.abort();",
            "lineNumber": 284
          },
          {
            "text": "      };",
            "lineNumber": 285
          },
          {
            "text": "    }",
            "lineNumber": 286
          },
          {
            "text": "  },",
            "lineNumber": 287
          },
          {
            "text": "};",
            "lineNumber": 361
          }
        ]
      },
      "score": 0.41991615295410156
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 43
          },
          "endPosition": {
            "line": 195,
            "column": 1
          }
        },
        "contents": "const TagsWidget = \n}\n        &lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div className=\"flex-1 flex overflow-hidden\"&gt;\n        {/* 标签列表内容 */}\n        &lt;div className=\"flex-1 overflow-y-auto p-4 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600\"&gt;\n          {keys.length === 0 &amp;&amp; (\n            &lt;div className=\"text-center text-gray-400 text-xs py-4 italic\"&gt;{t('sidebar.noTagsFound')}&lt;/div&gt;\n          )}\n          {keys.map(key =&gt; (\n            &lt;div id={&#96;tag-widget-group-${key}&#96;} key={key} className=\"mb-4 last:mb-0\"&gt;\n              &lt;div className=\"text-xs font-bold text-gray-400 dark:text-gray-500 mb-2 uppercase border-b border-gray-100 dark:border-gray-800 pb-1\"&gt;{key}&lt;/div&gt;\n              &lt;div className=\"flex flex-wrap gap-2\"&gt;\n                {filteredGroupedTags[key].map(tag =&gt; (\n                  &lt;button\n                    key={tag}\n                    onClick={(e) =&gt; onTagClick(tag, e)}\n                    className=\"text-xs px-2.5 py-1 rounded-md bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/40 border border-blue-100 dark:border-blue-900/30 transition-colors truncate max-w-full text-left\"\n                    title={tag}\n                  &gt;\n                    {tag}\n                  &lt;/button&gt;\n                ))}\n              &lt;/div&gt;\n            &lt;/div&gt;\n          ))}\n        &lt;/div&gt;\n        {/* 字母索引栏 */}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 42,
                "column": 1
              },
              "endPosition": {
                "line": 42,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 42,
                "column": 7
              },
              "endPosition": {
                "line": 42,
                "column": 20
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsWidget = ",
            "lineNumber": 44
          },
          {
            "text": "}",
            "lineNumber": 146
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 147
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 148
          },
          {
            "text": "      &lt;div className=\"flex-1 flex overflow-hidden\"&gt;",
            "lineNumber": 149
          },
          {
            "text": "        {/* 标签列表内容 */}",
            "lineNumber": 150
          },
          {
            "text": "        &lt;div className=\"flex-1 overflow-y-auto p-4 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600\"&gt;",
            "lineNumber": 151
          },
          {
            "text": "          {keys.length === 0 &amp;&amp; (",
            "lineNumber": 152
          },
          {
            "text": "            &lt;div className=\"text-center text-gray-400 text-xs py-4 italic\"&gt;{t('sidebar.noTagsFound')}&lt;/div&gt;",
            "lineNumber": 153
          },
          {
            "text": "          )}",
            "lineNumber": 154
          },
          {
            "text": "          {keys.map(key =&gt; (",
            "lineNumber": 155
          },
          {
            "text": "            &lt;div id={&#96;tag-widget-group-${key}&#96;} key={key} className=\"mb-4 last:mb-0\"&gt;",
            "lineNumber": 156
          },
          {
            "text": "              &lt;div className=\"text-xs font-bold text-gray-400 dark:text-gray-500 mb-2 uppercase border-b border-gray-100 dark:border-gray-800 pb-1\"&gt;{key}&lt;/div&gt;",
            "lineNumber": 157
          },
          {
            "text": "              &lt;div className=\"flex flex-wrap gap-2\"&gt;",
            "lineNumber": 158
          },
          {
            "text": "                {filteredGroupedTags[key].map(tag =&gt; (",
            "lineNumber": 159
          },
          {
            "text": "                  &lt;button",
            "lineNumber": 160
          },
          {
            "text": "                    key={tag}",
            "lineNumber": 161
          },
          {
            "text": "                    onClick={(e) =&gt; onTagClick(tag, e)}",
            "lineNumber": 162
          },
          {
            "text": "                    className=\"text-xs px-2.5 py-1 rounded-md bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/40 border border-blue-100 dark:border-blue-900/30 transition-colors truncate max-w-full text-left\"",
            "lineNumber": 163
          },
          {
            "text": "                    title={tag}",
            "lineNumber": 164
          },
          {
            "text": "                  &gt;",
            "lineNumber": 165
          },
          {
            "text": "                    {tag}",
            "lineNumber": 166
          },
          {
            "text": "                  &lt;/button&gt;",
            "lineNumber": 167
          },
          {
            "text": "                ))}",
            "lineNumber": 168
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 169
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 170
          },
          {
            "text": "          ))}",
            "lineNumber": 171
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 172
          },
          {
            "text": "        {/* 字母索引栏 */}",
            "lineNumber": 173
          },
          {
            "text": ";",
            "lineNumber": 196
          }
        ]
      },
      "score": 0.39437299966812134
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 363
          },
          "endPosition": {
            "line": 501,
            "column": 1
          }
        },
        "contents": "const findImagesDeeply = \nwhile (stack.length &gt; 0 &amp;&amp; traversalCount &lt; MAX_TRAVERSAL) {\n\n        if (!node) continue;\n        \n        if (node.type === FileType.IMAGE) {\n            images.push(node);\n        } else if (node.type === FileType.FOLDER &amp;&amp; node.children) {\n            stack.push(...node.children);\n        }\n    }\n    \n    // 排序并切片\n    return images\n        .sort((a, b) =&gt; (b.updatedAt || b.createdAt || '').localeCompare(a.updatedAt || a.createdAt || ''))\n        .slice(0, limit);\n};\n\nexport const FolderThumbnail = React.memo(({ file, files, mode, resourceRoot, cachePath }: { file: FileNode; files: Record&lt;string, FileNode&gt;, mode: LayoutMode, resourceRoot?: string, cachePath?: string }) =&gt; {\n  const [ref, isInView, wasInView] = useInView({ rootMargin: '200px' });\n  \n  // 1. 同步计算需要展示的子文件 (改为深度查找)\n  const imageChildren = useMemo(() =&gt; {\n      if (!file.children || file.children.length === 0) return [];\n      return findImagesDeeply(file, files, 3);\n  }, [file, files]);\n\n  // 2. 初始化时尝试从全局缓存同步读取\n  const [previewSrcs, setPreviewSrcs] = useState&lt;string[]&gt;(() =&gt; {\n      const cache = getGlobalCache();\n      // 尝试映射所有子文件到缓存中的 URL\n      const cachedUrls = imageChildren.map(child =&gt; {\n          // 使用与 ImageThumbnail 相同的 Key 生成逻辑 (仅 filePath)\n          return cache.get(child.path) || null; \n      });\n      \n      // 只有当所有需要的图片都有缓存时，才视为命中 (或者至少有一张？)\n      // 为了体验最好，只要有缓存就先用。过滤掉 null。\n      const validUrls = cachedUrls.filter((url): url is string =&gt; !!url);\n  };\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 284,
                "column": 1
              },
              "endPosition": {
                "line": 284,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 7
              },
              "endPosition": {
                "line": 284,
                "column": 18
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 29
              },
              "endPosition": {
                "line": 285,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const findImagesDeeply = ",
            "lineNumber": 364
          },
          {
            "text": "while (stack.length &gt; 0 &amp;&amp; traversalCount &lt; MAX_TRAVERSAL) {",
            "lineNumber": 378
          },
          {
            "lineNumber": 384
          },
          {
            "text": "        if (!node) continue;",
            "lineNumber": 385
          },
          {
            "text": "        ",
            "lineNumber": 386
          },
          {
            "text": "        if (node.type === FileType.IMAGE) {",
            "lineNumber": 387
          },
          {
            "text": "            images.push(node);",
            "lineNumber": 388
          },
          {
            "text": "        } else if (node.type === FileType.FOLDER &amp;&amp; node.children) {",
            "lineNumber": 389
          },
          {
            "text": "            stack.push(...node.children);",
            "lineNumber": 390
          },
          {
            "text": "        }",
            "lineNumber": 391
          },
          {
            "text": "    }",
            "lineNumber": 392
          },
          {
            "text": "    ",
            "lineNumber": 393
          },
          {
            "text": "    // 排序并切片",
            "lineNumber": 394
          },
          {
            "text": "    return images",
            "lineNumber": 395
          },
          {
            "text": "        .sort((a, b) =&gt; (b.updatedAt || b.createdAt || '').localeCompare(a.updatedAt || a.createdAt || ''))",
            "lineNumber": 396
          },
          {
            "text": "        .slice(0, limit);",
            "lineNumber": 397
          },
          {
            "text": "};",
            "lineNumber": 398
          },
          {
            "lineNumber": 399
          },
          {
            "text": "export const FolderThumbnail = React.memo(({ file, files, mode, resourceRoot, cachePath }: { file: FileNode; files: Record&lt;string, FileNode&gt;, mode: LayoutMode, resourceRoot?: string, cachePath?: string }) =&gt; {",
            "lineNumber": 400
          },
          {
            "text": "  const [ref, isInView, wasInView] = useInView({ rootMargin: '200px' });",
            "lineNumber": 401
          },
          {
            "text": "  ",
            "lineNumber": 402
          },
          {
            "text": "  // 1. 同步计算需要展示的子文件 (改为深度查找)",
            "lineNumber": 403
          },
          {
            "text": "  const imageChildren = useMemo(() =&gt; {",
            "lineNumber": 404
          },
          {
            "text": "      if (!file.children || file.children.length === 0) return [];",
            "lineNumber": 405
          },
          {
            "text": "      return findImagesDeeply(file, files, 3);",
            "lineNumber": 406
          },
          {
            "text": "  }, [file, files]);",
            "lineNumber": 407
          },
          {
            "lineNumber": 408
          },
          {
            "text": "  // 2. 初始化时尝试从全局缓存同步读取",
            "lineNumber": 409
          },
          {
            "text": "  const [previewSrcs, setPreviewSrcs] = useState&lt;string[]&gt;(() =&gt; {",
            "lineNumber": 410
          },
          {
            "text": "      const cache = getGlobalCache();",
            "lineNumber": 411
          },
          {
            "text": "      // 尝试映射所有子文件到缓存中的 URL",
            "lineNumber": 412
          },
          {
            "text": "      const cachedUrls = imageChildren.map(child =&gt; {",
            "lineNumber": 413
          },
          {
            "text": "          // 使用与 ImageThumbnail 相同的 Key 生成逻辑 (仅 filePath)",
            "lineNumber": 414
          },
          {
            "text": "          return cache.get(child.path) || null; ",
            "lineNumber": 415
          },
          {
            "text": "      });",
            "lineNumber": 416
          },
          {
            "text": "      ",
            "lineNumber": 417
          },
          {
            "text": "      // 只有当所有需要的图片都有缓存时，才视为命中 (或者至少有一张？)",
            "lineNumber": 418
          },
          {
            "text": "      // 为了体验最好，只要有缓存就先用。过滤掉 null。",
            "lineNumber": 419
          },
          {
            "text": "      const validUrls = cachedUrls.filter((url): url is string =&gt; !!url);",
            "lineNumber": 420
          },
          {
            "text": "  };",
            "lineNumber": 424
          },
          {
            "text": "};",
            "lineNumber": 502
          }
        ]
      },
      "score": 0.38075849413871765
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 213
          },
          "endPosition": {
            "line": 360,
            "column": 1
          }
        },
        "contents": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { \n  src: string; \n  alt: string; \n  isSelected: boolean;\n  filePath?: string;\n  modified?: string;\n  size?: number;\n  isHovering?: boolean;\n  fileMeta?: { format?: string };\n  resourceRoot?: string;\n  cachePath?: string;\n}) =&gt; {\n() =&gt; {\n\n\n      return () =&gt; {\n        controller.abort();\n      };\n    }\n  }, [filePath, modified, resourceRoot, isInView, wasInView]);\n\n\n\n  React.useEffect(() =&gt; {\n    let isMounted = true;\n\n    const loadAnimation = async () =&gt; {\n      if (isHovering &amp;&amp; filePath) {\n        // 从文件路径提取格式\n        const fileName = filePath.split(/[\\\\/]/).pop() || '';\n        const fileExt = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase();\n        const isAnimationFormat = (fileMeta?.format === 'gif' || fileMeta?.format === 'webp') || (fileExt === 'gif' || fileExt === 'webp');\n        \n        if (isAnimationFormat) {\n          try {\n            // 使用readFileAsBase64直接读取文件内容，避免使用http://asset.localhost/协议\n            const { readFileAsBase64 } = await import('../api/tauri-bridge');\n            \n            if (!isMounted) return;\n\n            const dataUrl = await readFileAsBase64(filePath);\n            \n            if (isMounted) {\n              if (dataUrl) {\n                setAnimSrc(dataUrl);\n              } else {\n                setAnimSrc(null);\n              }\n            }\n          } catch (e) {\n            setAnimSrc(null);\n          }\n        } else {\n          if (isMounted) {\n            setAnimSrc(null);\n          }\n        }\n      } else {\n        if (isMounted) {\n          setAnimSrc(null);\n        }\n      }\n    };\n\n    loadAnimation();\n\n    return\n  }\n};",
        "signatures": {},
        "detailedLines": [
          {
            "text": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { ",
            "lineNumber": 214
          },
          {
            "text": "  src: string; ",
            "lineNumber": 215
          },
          {
            "text": "  alt: string; ",
            "lineNumber": 216
          },
          {
            "text": "  isSelected: boolean;",
            "lineNumber": 217
          },
          {
            "text": "  filePath?: string;",
            "lineNumber": 218
          },
          {
            "text": "  modified?: string;",
            "lineNumber": 219
          },
          {
            "text": "  size?: number;",
            "lineNumber": 220
          },
          {
            "text": "  isHovering?: boolean;",
            "lineNumber": 221
          },
          {
            "text": "  fileMeta?: { format?: string };",
            "lineNumber": 222
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 223
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 224
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 225
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 242
          },
          {
            "lineNumber": 281
          },
          {
            "lineNumber": 282
          },
          {
            "text": "      return () =&gt; {",
            "lineNumber": 283
          },
          {
            "text": "        controller.abort();",
            "lineNumber": 284
          },
          {
            "text": "      };",
            "lineNumber": 285
          },
          {
            "text": "    }",
            "lineNumber": 286
          },
          {
            "text": "  }, [filePath, modified, resourceRoot, isInView, wasInView]);",
            "lineNumber": 287
          },
          {
            "lineNumber": 288
          },
          {
            "lineNumber": 289
          },
          {
            "lineNumber": 290
          },
          {
            "text": "  React.useEffect(() =&gt; {",
            "lineNumber": 291
          },
          {
            "text": "    let isMounted = true;",
            "lineNumber": 292
          },
          {
            "lineNumber": 293
          },
          {
            "text": "    const loadAnimation = async () =&gt; {",
            "lineNumber": 294
          },
          {
            "text": "      if (isHovering &amp;&amp; filePath) {",
            "lineNumber": 295
          },
          {
            "text": "        // 从文件路径提取格式",
            "lineNumber": 296
          },
          {
            "text": "        const fileName = filePath.split(/[\\\\/]/).pop() || '';",
            "lineNumber": 297
          },
          {
            "text": "        const fileExt = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase();",
            "lineNumber": 298
          },
          {
            "text": "        const isAnimationFormat = (fileMeta?.format === 'gif' || fileMeta?.format === 'webp') || (fileExt === 'gif' || fileExt === 'webp');",
            "lineNumber": 299
          },
          {
            "text": "        ",
            "lineNumber": 300
          },
          {
            "text": "        if (isAnimationFormat) {",
            "lineNumber": 301
          },
          {
            "text": "          try {",
            "lineNumber": 302
          },
          {
            "text": "            // 使用readFileAsBase64直接读取文件内容，避免使用http://asset.localhost/协议",
            "lineNumber": 303
          },
          {
            "text": "            const { readFileAsBase64 } = await import('../api/tauri-bridge');",
            "lineNumber": 304
          },
          {
            "text": "            ",
            "lineNumber": 305
          },
          {
            "text": "            if (!isMounted) return;",
            "lineNumber": 306
          },
          {
            "lineNumber": 307
          },
          {
            "text": "            const dataUrl = await readFileAsBase64(filePath);",
            "lineNumber": 308
          },
          {
            "text": "            ",
            "lineNumber": 309
          },
          {
            "text": "            if (isMounted) {",
            "lineNumber": 310
          },
          {
            "text": "              if (dataUrl) {",
            "lineNumber": 311
          },
          {
            "text": "                setAnimSrc(dataUrl);",
            "lineNumber": 312
          },
          {
            "text": "              } else {",
            "lineNumber": 313
          },
          {
            "text": "                setAnimSrc(null);",
            "lineNumber": 314
          },
          {
            "text": "              }",
            "lineNumber": 315
          },
          {
            "text": "            }",
            "lineNumber": 316
          },
          {
            "text": "          } catch (e) {",
            "lineNumber": 317
          },
          {
            "text": "            setAnimSrc(null);",
            "lineNumber": 318
          },
          {
            "text": "          }",
            "lineNumber": 319
          },
          {
            "text": "        } else {",
            "lineNumber": 320
          },
          {
            "text": "          if (isMounted) {",
            "lineNumber": 321
          },
          {
            "text": "            setAnimSrc(null);",
            "lineNumber": 322
          },
          {
            "text": "          }",
            "lineNumber": 323
          },
          {
            "text": "        }",
            "lineNumber": 324
          },
          {
            "text": "      } else {",
            "lineNumber": 325
          },
          {
            "text": "        if (isMounted) {",
            "lineNumber": 326
          },
          {
            "text": "          setAnimSrc(null);",
            "lineNumber": 327
          },
          {
            "text": "        }",
            "lineNumber": 328
          },
          {
            "text": "      }",
            "lineNumber": 329
          },
          {
            "text": "    };",
            "lineNumber": 330
          },
          {
            "lineNumber": 331
          },
          {
            "text": "    loadAnimation();",
            "lineNumber": 332
          },
          {
            "lineNumber": 333
          },
          {
            "text": "    return",
            "lineNumber": 334
          },
          {
            "text": "  }",
            "lineNumber": 337
          },
          {
            "text": "};",
            "lineNumber": 361
          }
        ]
      },
      "score": 0.38015440106391907
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 11
          },
          "endPosition": {
            "line": 195,
            "column": 1
          }
        },
        "contents": "interface TopBarProps {\n\n  t: (key: string) =&gt; string;\n}\n\nconst TagsWidget = ({ groupedTags, onTagClick, t, tagSearchQuery, onSetTagSearchQuery }: { groupedTags: Record&lt;string, string[]&gt;, onTagClick: (tag: string, e: React.MouseEvent) =&gt; void, t: (key: string) =&gt; string, tagSearchQuery: string, onSetTagSearchQuery: (query: string) =&gt; void }) =&gt; {\n  const [localSearchQuery, setLocalSearchQuery] = React.useState(tagSearchQuery);\n  const [isFocused, setIsFocused] = React.useState(false);\n  \n  // 当外部tagSearchQuery变化时，更新本地状态\n  React.useEffect(() =&gt; {\n    setLocalSearchQuery(tagSearchQuery);\n  }, [tagSearchQuery]);\n  \n  // 获取所有标签列表，用于智能联想\n  const allTags = React.useMemo(() =&gt; {\n    const tagsSet = new Set&lt;string&gt;();\n    Object.values(groupedTags).forEach(tags =&gt; {\n      tags.forEach(tag =&gt; tagsSet.add(tag));\n    });\n    return Array.from(tagsSet);\n  }, [groupedTags]);\n  \n  // 过滤标签，只显示匹配搜索条件的标签\n  const filteredGroupedTags = React.useMemo(() =&gt; {\n    if (!localSearchQuery) return groupedTags;\n    \n    const filtered: Record&lt;string, string[]&gt; = {};\n    Object.entries(groupedTags).forEach(([key, tags]) =&gt; {\n      const matchingTags = tags.filter(tag =&gt; \n        tag.toLowerCase().includes(localSearchQuery.toLowerCase())\n      );\n      if (matchingTags.length &gt; 0) {\n        filtered[key] = matchingTags;\n      }\n    });\n    return filtered;\n  }, [groupedTags, localSearchQuery]);\n  \n  // 智能联想的标签列表\n  const suggestedTags = React.useMemo(() =&gt; {\n    if (!localSearchQuery || !isFocused) return [];\n    return allTags\n      .filter(tag =&gt; tag.toLowerCase().includes(localSearchQuery.toLowerCase()))\n      .sort()\n      .slice(0, 10);\n  }, [allTags, localSearchQuery, isFocused]);\n  \n  const keys = Object.keys(filteredGroupedTags).sort();\n  const totalTags = Object.values(filteredGroupedTags).reduce;\n;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "interface TopBarProps {",
            "lineNumber": 12,
            "isSignature": true
          },
          {
            "lineNumber": 40
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 41,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 42,
            "isSignature": true
          },
          {
            "lineNumber": 43
          },
          {
            "text": "const TagsWidget = ({ groupedTags, onTagClick, t, tagSearchQuery, onSetTagSearchQuery }: { groupedTags: Record&lt;string, string[]&gt;, onTagClick: (tag: string, e: React.MouseEvent) =&gt; void, t: (key: string) =&gt; string, tagSearchQuery: string, onSetTagSearchQuery: (query: string) =&gt; void }) =&gt; {",
            "lineNumber": 44
          },
          {
            "text": "  const [localSearchQuery, setLocalSearchQuery] = React.useState(tagSearchQuery);",
            "lineNumber": 45
          },
          {
            "text": "  const [isFocused, setIsFocused] = React.useState(false);",
            "lineNumber": 46
          },
          {
            "text": "  ",
            "lineNumber": 47
          },
          {
            "text": "  // 当外部tagSearchQuery变化时，更新本地状态",
            "lineNumber": 48
          },
          {
            "text": "  React.useEffect(() =&gt; {",
            "lineNumber": 49
          },
          {
            "text": "    setLocalSearchQuery(tagSearchQuery);",
            "lineNumber": 50
          },
          {
            "text": "  }, [tagSearchQuery]);",
            "lineNumber": 51
          },
          {
            "text": "  ",
            "lineNumber": 52
          },
          {
            "text": "  // 获取所有标签列表，用于智能联想",
            "lineNumber": 53
          },
          {
            "text": "  const allTags = React.useMemo(() =&gt; {",
            "lineNumber": 54
          },
          {
            "text": "    const tagsSet = new Set&lt;string&gt;();",
            "lineNumber": 55
          },
          {
            "text": "    Object.values(groupedTags).forEach(tags =&gt; {",
            "lineNumber": 56
          },
          {
            "text": "      tags.forEach(tag =&gt; tagsSet.add(tag));",
            "lineNumber": 57
          },
          {
            "text": "    });",
            "lineNumber": 58
          },
          {
            "text": "    return Array.from(tagsSet);",
            "lineNumber": 59
          },
          {
            "text": "  }, [groupedTags]);",
            "lineNumber": 60
          },
          {
            "text": "  ",
            "lineNumber": 61
          },
          {
            "text": "  // 过滤标签，只显示匹配搜索条件的标签",
            "lineNumber": 62
          },
          {
            "text": "  const filteredGroupedTags = React.useMemo(() =&gt; {",
            "lineNumber": 63
          },
          {
            "text": "    if (!localSearchQuery) return groupedTags;",
            "lineNumber": 64
          },
          {
            "text": "    ",
            "lineNumber": 65
          },
          {
            "text": "    const filtered: Record&lt;string, string[]&gt; = {};",
            "lineNumber": 66
          },
          {
            "text": "    Object.entries(groupedTags).forEach(([key, tags]) =&gt; {",
            "lineNumber": 67
          },
          {
            "text": "      const matchingTags = tags.filter(tag =&gt; ",
            "lineNumber": 68
          },
          {
            "text": "        tag.toLowerCase().includes(localSearchQuery.toLowerCase())",
            "lineNumber": 69
          },
          {
            "text": "      );",
            "lineNumber": 70
          },
          {
            "text": "      if (matchingTags.length &gt; 0) {",
            "lineNumber": 71
          },
          {
            "text": "        filtered[key] = matchingTags;",
            "lineNumber": 72
          },
          {
            "text": "      }",
            "lineNumber": 73
          },
          {
            "text": "    });",
            "lineNumber": 74
          },
          {
            "text": "    return filtered;",
            "lineNumber": 75
          },
          {
            "text": "  }, [groupedTags, localSearchQuery]);",
            "lineNumber": 76
          },
          {
            "text": "  ",
            "lineNumber": 77
          },
          {
            "text": "  // 智能联想的标签列表",
            "lineNumber": 78
          },
          {
            "text": "  const suggestedTags = React.useMemo(() =&gt; {",
            "lineNumber": 79
          },
          {
            "text": "    if (!localSearchQuery || !isFocused) return [];",
            "lineNumber": 80
          },
          {
            "text": "    return allTags",
            "lineNumber": 81
          },
          {
            "text": "      .filter(tag =&gt; tag.toLowerCase().includes(localSearchQuery.toLowerCase()))",
            "lineNumber": 82
          },
          {
            "text": "      .sort()",
            "lineNumber": 83
          },
          {
            "text": "      .slice(0, 10);",
            "lineNumber": 84
          },
          {
            "text": "  }, [allTags, localSearchQuery, isFocused]);",
            "lineNumber": 85
          },
          {
            "text": "  ",
            "lineNumber": 86
          },
          {
            "text": "  const keys = Object.keys(filteredGroupedTags).sort();",
            "lineNumber": 87
          },
          {
            "text": "  const totalTags = Object.values(filteredGroupedTags).reduce;",
            "lineNumber": 88
          },
          {
            "text": ";",
            "lineNumber": 196
          }
        ]
      },
      "score": 0.37457001209259033
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \n() =&gt; {\nid =&gt; {\n\n                                            }\n                                        });\n                                    }} \n                                    className=\"flex items-center px-3 py-1.5 bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-400 text-white rounded-md font-medium transition-colors text-sm\"\n                                    title={t('meta.clearAllAiData')}\n                                &gt;\n                                    &lt;X size={12} className=\"mr-1.5\"/&gt; {t('meta.clearAll')}\n                                &lt;/button&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    ) : (\n                        // Single file AI analysis details\n                        file &amp;&amp; file.aiData &amp;&amp; (\n                            &lt;div className=\"space-y-3\"&gt;\n                                &lt;div className=\"grid grid-cols-2 gap-2 text-xs\"&gt;\n                                    &lt;div className=\"bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;\n                                        &lt;div className=\"text-gray-400 mb-1\"&gt;{t('meta.aiScene')}&lt;/div&gt;\n                                        &lt;div className=\"font-medium text-gray-800 dark:text-gray-200\"&gt;{file.aiData.sceneCategory}&lt;/div&gt;\n                                    &lt;/div&gt;\n                                    &lt;div className=\"bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;\n                                        &lt;div className=\"text-gray-400 mb-1\"&gt;{t('meta.aiConfidence')}&lt;/div&gt;\n                                        &lt;div className=\"font-medium text-gray-800 dark:text-gray-200\"&gt;{Math.round(file.aiData.confidence * 100)}%&lt;/div&gt;\n                                    &lt;/div&gt;\n                                &lt;/div&gt;\n\n                                {file.aiData.faces.length &gt; 0 &amp;&amp; (\n                                    &lt;div&gt;\n                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1.5 flex items-center\"&gt;&lt;Smile size={10} className=\"mr-1\"/&gt; {t('meta.aiFaces')}&lt;/div&gt;\n                                        &lt;div className=\"flex flex-wrap gap-1.5\"&gt;\n                                            \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 1159
          },
          {
            "text": "id =&gt; {",
            "lineNumber": 1160
          },
          {
            "lineNumber": 1162
          },
          {
            "text": "                                            }",
            "lineNumber": 1163
          },
          {
            "text": "                                        });",
            "lineNumber": 1164
          },
          {
            "text": "                                    }} ",
            "lineNumber": 1165
          },
          {
            "text": "                                    className=\"flex items-center px-3 py-1.5 bg-red-600 dark:bg-red-500 hover:bg-red-700 dark:hover:bg-red-400 text-white rounded-md font-medium transition-colors text-sm\"",
            "lineNumber": 1166
          },
          {
            "text": "                                    title={t('meta.clearAllAiData')}",
            "lineNumber": 1167
          },
          {
            "text": "                                &gt;",
            "lineNumber": 1168
          },
          {
            "text": "                                    &lt;X size={12} className=\"mr-1.5\"/&gt; {t('meta.clearAll')}",
            "lineNumber": 1169
          },
          {
            "text": "                                &lt;/button&gt;",
            "lineNumber": 1170
          },
          {
            "text": "                            &lt;/div&gt;",
            "lineNumber": 1171
          },
          {
            "text": "                        &lt;/div&gt;",
            "lineNumber": 1172
          },
          {
            "text": "                    ) : (",
            "lineNumber": 1173
          },
          {
            "text": "                        // Single file AI analysis details",
            "lineNumber": 1174
          },
          {
            "text": "                        file &amp;&amp; file.aiData &amp;&amp; (",
            "lineNumber": 1175
          },
          {
            "text": "                            &lt;div className=\"space-y-3\"&gt;",
            "lineNumber": 1176
          },
          {
            "text": "                                &lt;div className=\"grid grid-cols-2 gap-2 text-xs\"&gt;",
            "lineNumber": 1177
          },
          {
            "text": "                                    &lt;div className=\"bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;",
            "lineNumber": 1178
          },
          {
            "text": "                                        &lt;div className=\"text-gray-400 mb-1\"&gt;{t('meta.aiScene')}&lt;/div&gt;",
            "lineNumber": 1179
          },
          {
            "text": "                                        &lt;div className=\"font-medium text-gray-800 dark:text-gray-200\"&gt;{file.aiData.sceneCategory}&lt;/div&gt;",
            "lineNumber": 1180
          },
          {
            "text": "                                    &lt;/div&gt;",
            "lineNumber": 1181
          },
          {
            "text": "                                    &lt;div className=\"bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;",
            "lineNumber": 1182
          },
          {
            "text": "                                        &lt;div className=\"text-gray-400 mb-1\"&gt;{t('meta.aiConfidence')}&lt;/div&gt;",
            "lineNumber": 1183
          },
          {
            "text": "                                        &lt;div className=\"font-medium text-gray-800 dark:text-gray-200\"&gt;{Math.round(file.aiData.confidence * 100)}%&lt;/div&gt;",
            "lineNumber": 1184
          },
          {
            "text": "                                    &lt;/div&gt;",
            "lineNumber": 1185
          },
          {
            "text": "                                &lt;/div&gt;",
            "lineNumber": 1186
          },
          {
            "lineNumber": 1187
          },
          {
            "text": "                                {file.aiData.faces.length &gt; 0 &amp;&amp; (",
            "lineNumber": 1188
          },
          {
            "text": "                                    &lt;div&gt;",
            "lineNumber": 1189
          },
          {
            "text": "                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1.5 flex items-center\"&gt;&lt;Smile size={10} className=\"mr-1\"/&gt; {t('meta.aiFaces')}&lt;/div&gt;",
            "lineNumber": 1190
          },
          {
            "text": "                                        &lt;div className=\"flex flex-wrap gap-1.5\"&gt;",
            "lineNumber": 1191
          },
          {
            "text": "                                            ",
            "lineNumber": 1192
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.3720000982284546
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \n() =&gt; {\ntag =&gt; (\n\n                                  &lt;/div&gt;\n                                ))}\n                              &lt;/div&gt;\n                            );\n                          })()}\n                        &lt;/div&gt;\n                      &lt;/div&gt;\n                    &lt;/div&gt;\n                  ) : activeTab.viewMode === 'people-overview' ? (\n                    &lt;div className=\"flex items-center w-full justify-between\"&gt;\n                      &lt;div className=\"flex items-center\"&gt;\n                        &lt;User size={12} className=\"mr-1\"/&gt;\n                        &lt;span&gt;{t('context.allPeople')}&lt;/span&gt;\n                      &lt;/div&gt;\n                      &lt;div className=\"text-[10px] opacity-60\"&gt;\n                        {Object.keys(state.people).length} {t('context.items')}\n                      &lt;/div&gt;\n                    &lt;/div&gt;\n                  ) : (\n                    &lt;div className=\"flex items-center w-full justify-between\"&gt;\n                      &lt;div className=\"flex items-center space-x-1 overflow-hidden\"&gt;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 4672
          },
          {
            "text": "tag =&gt; (",
            "lineNumber": 4695
          },
          {
            "lineNumber": 4701
          },
          {
            "text": "                                  &lt;/div&gt;",
            "lineNumber": 4702
          },
          {
            "text": "                                ))}",
            "lineNumber": 4703
          },
          {
            "text": "                              &lt;/div&gt;",
            "lineNumber": 4704
          },
          {
            "text": "                            );",
            "lineNumber": 4705
          },
          {
            "text": "                          })()}",
            "lineNumber": 4706
          },
          {
            "text": "                        &lt;/div&gt;",
            "lineNumber": 4707
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4708
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 4709
          },
          {
            "text": "                  ) : activeTab.viewMode === 'people-overview' ? (",
            "lineNumber": 4710
          },
          {
            "text": "                    &lt;div className=\"flex items-center w-full justify-between\"&gt;",
            "lineNumber": 4711
          },
          {
            "text": "                      &lt;div className=\"flex items-center\"&gt;",
            "lineNumber": 4712
          },
          {
            "text": "                        &lt;User size={12} className=\"mr-1\"/&gt;",
            "lineNumber": 4713
          },
          {
            "text": "                        &lt;span&gt;{t('context.allPeople')}&lt;/span&gt;",
            "lineNumber": 4714
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4715
          },
          {
            "text": "                      &lt;div className=\"text-[10px] opacity-60\"&gt;",
            "lineNumber": 4716
          },
          {
            "text": "                        {Object.keys(state.people).length} {t('context.items')}",
            "lineNumber": 4717
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 4718
          },
          {
            "text": "                    &lt;/div&gt;",
            "lineNumber": 4719
          },
          {
            "text": "                  ) : (",
            "lineNumber": 4720
          },
          {
            "text": "                    &lt;div className=\"flex items-center w-full justify-between\"&gt;",
            "lineNumber": 4721
          },
          {
            "text": "                      &lt;div className=\"flex items-center space-x-1 overflow-hidden\"&gt;",
            "lineNumber": 4722
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.37002646923065186
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 231
          },
          "endPosition": {
            "line": 465
          }
        },
        "contents": "const TagSection: React.FC&lt;TagSectionProps&gt; = \ntag =&gt; (\n\n              &lt;div \n                className={&#96;py-1 px-2 rounded cursor-pointer flex items-center justify-between transition-colors\n                   ${dragOverTag === tag \n                      ? 'bg-blue-200 dark:bg-blue-900 border border-blue-400 dark:border-blue-500' \n                      : 'hover:bg-blue-100 dark:hover:bg-blue-900/30 hover:text-blue-700 dark:text-gray-300 dark:hover:text-blue-300 border border-transparent'}\n                &#96;}\n                onClick={() =&gt; onTagSelect(tag)}\n              &gt;\n                 &lt;span className=\"pointer-events-none\"&gt;{tag}&lt;/span&gt;\n                 &lt;span className=\"text-[10px] text-gray-500 dark:text-gray-600 bg-gray-200 dark:bg-gray-800 px-1.5 rounded-full pointer-events-none\"&gt;\n                   {Object.values(files).filter((f: FileNode) =&gt; f.tags.includes(tag)).length}\n                 &lt;/span&gt;\n              &lt;/div&gt;\n              \n              {hoveredTag === tag &amp;&amp; previewImages.length &gt; 0 &amp;&amp;\n          )",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 232,
                "column": 1
              },
              "endPosition": {
                "line": 232,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 232,
                "column": 7
              },
              "endPosition": {
                "line": 232,
                "column": 47
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 12
              },
              "endPosition": {
                "line": 387,
                "column": 12
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 27
              },
              "endPosition": {
                "line": 388,
                "column": 13
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagSection: React.FC&lt;TagSectionProps&gt; = ",
            "lineNumber": 232
          },
          {
            "text": "tag =&gt; (",
            "lineNumber": 387
          },
          {
            "lineNumber": 420
          },
          {
            "text": "              &lt;div ",
            "lineNumber": 421
          },
          {
            "text": "                className={&#96;py-1 px-2 rounded cursor-pointer flex items-center justify-between transition-colors",
            "lineNumber": 422
          },
          {
            "text": "                   ${dragOverTag === tag ",
            "lineNumber": 423
          },
          {
            "text": "                      ? 'bg-blue-200 dark:bg-blue-900 border border-blue-400 dark:border-blue-500' ",
            "lineNumber": 424
          },
          {
            "text": "                      : 'hover:bg-blue-100 dark:hover:bg-blue-900/30 hover:text-blue-700 dark:text-gray-300 dark:hover:text-blue-300 border border-transparent'}",
            "lineNumber": 425
          },
          {
            "text": "                &#96;}",
            "lineNumber": 426
          },
          {
            "text": "                onClick={() =&gt; onTagSelect(tag)}",
            "lineNumber": 427
          },
          {
            "text": "              &gt;",
            "lineNumber": 428
          },
          {
            "text": "                 &lt;span className=\"pointer-events-none\"&gt;{tag}&lt;/span&gt;",
            "lineNumber": 429
          },
          {
            "text": "                 &lt;span className=\"text-[10px] text-gray-500 dark:text-gray-600 bg-gray-200 dark:bg-gray-800 px-1.5 rounded-full pointer-events-none\"&gt;",
            "lineNumber": 430
          },
          {
            "text": "                   {Object.values(files).filter((f: FileNode) =&gt; f.tags.includes(tag)).length}",
            "lineNumber": 431
          },
          {
            "text": "                 &lt;/span&gt;",
            "lineNumber": 432
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 433
          },
          {
            "text": "              ",
            "lineNumber": 434
          },
          {
            "text": "              {hoveredTag === tag &amp;&amp; previewImages.length &gt; 0 &amp;&amp;",
            "lineNumber": 435
          },
          {
            "text": "          )",
            "lineNumber": 458
          }
        ]
      },
      "score": 0.36472320556640625
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 229,
            "column": 1
          },
          "endPosition": {
            "line": 465
          }
        },
        "contents": "const TagSection: React.FC&lt;TagSectionProps&gt; = ({ \n  files, customTags, onTagSelect, onNavigateAllTags, onContextMenu, \n  isCreatingTag, onStartCreateTag, onSaveNewTag, onCancelCreateTag, onDropOnTag, t \n}) =&gt; {\n  const [expanded, setExpanded] = useState(false);\n  const [hoveredTag, setHoveredTag] = useState&lt;string | null&gt;(null);\n  const [hoveredTagPos, setHoveredTagPos] = useState&lt;{top: number, left: number} | null&gt;(null);\n  const [dragOverTag, setDragOverTag] = useState&lt;string | null&gt;(null);\n  const [tagInputValue, setTagInputValue] = useState('');\n  \n  const hoverTimerRef = useRef&lt;ReturnType&lt;typeof setTimeout&gt; | null&gt;(null);\n  const inputRef = useRef&lt;HTMLInputElement&gt;(null);\n\n  useEffect(() =&gt; {\n    if (isCreatingTag) {\n      setExpanded(true);\n      setTagInputValue(t('context.newTagDefault'));\n    }\n  }, [isCreatingTag, t]);\n\n  useEffect(() =&gt; {\n    if (isCreatingTag &amp;&amp; inputRef.current) {\n        inputRef.current.focus();\n        inputRef.current.select();\n    }\n  }, [isCreatingTag]);\n  \n  useEffect(() =&gt; {\n    return () =&gt; {\n      if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);\n    };\n  }, []);\n\n  const sortedTags = useMemo(() =&gt; {\n    const allTags = new Set&lt;string&gt;(customTags);\n    Object.values(files).forEach((file: FileNode) =&gt; {\n      file.tags.forEach(tag =&gt; allTags.add(tag));\n    });\n    return Array.from(allTags).sort((a, b) =&gt; a.localeCompare(b, 'zh-CN'));\n  }, [files, customTags]);\n\n  const suggestions = useMemo(() =&gt; {\n    if (!isCreatingTag || !tagInputValue) return [];\n    const lowerInput = tagInputValue.toLowerCase();\n    return sortedTags.filter(t =&gt; \n        t.toLowerCase().includes(lowerInput) &amp;&amp; t.toLowerCase() !== lowerInput\n    ).slice(0, 5);\n  }, [isCreatingTag, tagInputValue, sortedTags]);\n\n  const previewImages = useMemo(() =&gt; {\n    if (!hoveredTag) return [];\n  };",
        "signatures": {},
        "detailedLines": [
          {
            "text": "const TagSection: React.FC&lt;TagSectionProps&gt; = ({ ",
            "lineNumber": 232
          },
          {
            "text": "  files, customTags, onTagSelect, onNavigateAllTags, onContextMenu, ",
            "lineNumber": 233
          },
          {
            "text": "  isCreatingTag, onStartCreateTag, onSaveNewTag, onCancelCreateTag, onDropOnTag, t ",
            "lineNumber": 234
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 235
          },
          {
            "text": "  const [expanded, setExpanded] = useState(false);",
            "lineNumber": 236
          },
          {
            "text": "  const [hoveredTag, setHoveredTag] = useState&lt;string | null&gt;(null);",
            "lineNumber": 237
          },
          {
            "text": "  const [hoveredTagPos, setHoveredTagPos] = useState&lt;{top: number, left: number} | null&gt;(null);",
            "lineNumber": 238
          },
          {
            "text": "  const [dragOverTag, setDragOverTag] = useState&lt;string | null&gt;(null);",
            "lineNumber": 239
          },
          {
            "text": "  const [tagInputValue, setTagInputValue] = useState('');",
            "lineNumber": 240
          },
          {
            "text": "  ",
            "lineNumber": 241
          },
          {
            "text": "  const hoverTimerRef = useRef&lt;ReturnType&lt;typeof setTimeout&gt; | null&gt;(null);",
            "lineNumber": 242
          },
          {
            "text": "  const inputRef = useRef&lt;HTMLInputElement&gt;(null);",
            "lineNumber": 243
          },
          {
            "lineNumber": 244
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 245
          },
          {
            "text": "    if (isCreatingTag) {",
            "lineNumber": 246
          },
          {
            "text": "      setExpanded(true);",
            "lineNumber": 247
          },
          {
            "text": "      setTagInputValue(t('context.newTagDefault'));",
            "lineNumber": 248
          },
          {
            "text": "    }",
            "lineNumber": 249
          },
          {
            "text": "  }, [isCreatingTag, t]);",
            "lineNumber": 250
          },
          {
            "lineNumber": 251
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 252
          },
          {
            "text": "    if (isCreatingTag &amp;&amp; inputRef.current) {",
            "lineNumber": 253
          },
          {
            "text": "        inputRef.current.focus();",
            "lineNumber": 254
          },
          {
            "text": "        inputRef.current.select();",
            "lineNumber": 255
          },
          {
            "text": "    }",
            "lineNumber": 256
          },
          {
            "text": "  }, [isCreatingTag]);",
            "lineNumber": 257
          },
          {
            "text": "  ",
            "lineNumber": 258
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 259
          },
          {
            "text": "    return () =&gt; {",
            "lineNumber": 260
          },
          {
            "text": "      if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);",
            "lineNumber": 261
          },
          {
            "text": "    };",
            "lineNumber": 262
          },
          {
            "text": "  }, []);",
            "lineNumber": 263
          },
          {
            "lineNumber": 264
          },
          {
            "text": "  const sortedTags = useMemo(() =&gt; {",
            "lineNumber": 265
          },
          {
            "text": "    const allTags = new Set&lt;string&gt;(customTags);",
            "lineNumber": 266
          },
          {
            "text": "    Object.values(files).forEach((file: FileNode) =&gt; {",
            "lineNumber": 267
          },
          {
            "text": "      file.tags.forEach(tag =&gt; allTags.add(tag));",
            "lineNumber": 268
          },
          {
            "text": "    });",
            "lineNumber": 269
          },
          {
            "text": "    return Array.from(allTags).sort((a, b) =&gt; a.localeCompare(b, 'zh-CN'));",
            "lineNumber": 270
          },
          {
            "text": "  }, [files, customTags]);",
            "lineNumber": 271
          },
          {
            "lineNumber": 272
          },
          {
            "text": "  const suggestions = useMemo(() =&gt; {",
            "lineNumber": 273
          },
          {
            "text": "    if (!isCreatingTag || !tagInputValue) return [];",
            "lineNumber": 274
          },
          {
            "text": "    const lowerInput = tagInputValue.toLowerCase();",
            "lineNumber": 275
          },
          {
            "text": "    return sortedTags.filter(t =&gt; ",
            "lineNumber": 276
          },
          {
            "text": "        t.toLowerCase().includes(lowerInput) &amp;&amp; t.toLowerCase() !== lowerInput",
            "lineNumber": 277
          },
          {
            "text": "    ).slice(0, 5);",
            "lineNumber": 278
          },
          {
            "text": "  }, [isCreatingTag, tagInputValue, sortedTags]);",
            "lineNumber": 279
          },
          {
            "lineNumber": 280
          },
          {
            "text": "  const previewImages = useMemo(() =&gt; {",
            "lineNumber": 281
          },
          {
            "text": "    if (!hoveredTag) return [];",
            "lineNumber": 282
          },
          {
            "text": "  };",
            "lineNumber": 287
          }
        ]
      },
      "score": 0.3458057641983032
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 399
          },
          "endPosition": {
            "line": 501,
            "column": 1
          }
        },
        "contents": "export const FolderThumbnail = ({ file, files, mode, resourceRoot, cachePath }: { file: FileNode; files: Record&lt;string, FileNode&gt;, mode: LayoutMode, resourceRoot?: string, cachePath?: string }) =&gt; {\nconst [previewSrcs, setPreviewSrcs] = () =&gt; {\n\n      // 为了体验最好，只要有缓存就先用。过滤掉 null。\n      const validUrls = cachedUrls.filter((url): url is string =&gt; !!url);\n      \n      // 如果没有缓存，返回空数组\n      return validUrls;\n  });\n\n  // 如果初始就有数据（哪怕只有一张），就不设为 loaded=false，避免闪烁\n  const [loaded, setLoaded] = useState(previewSrcs.length &gt; 0);\n\n  useEffect(() =&gt; {\n    // 如果已经加载过了，且数量足够（或者等于子文件总数），就不再请求\n    // 注意：这里简单判断，如果缓存里不够 3 张但实际有 3 张，还是会触发请求补全\n    if (loaded &amp;&amp; previewSrcs.length === Math.min(3, imageChildren.length)) {\n        return;\n    }\n\n    if ((isInView || wasInView) &amp;&amp; resourceRoot &amp;&amp; imageChildren.length &gt; 0) {\n      const controller = new AbortController();\n      const loadPreviews = async () =&gt; {\n        try {\n          const { getThumbnail } = await import('../api/tauri-bridge');\n          \n          // 并行请求所有子文件的缩略图\n          const promises = imageChildren.map(async (img: FileNode) =&gt; {\n              // 先查缓存，如果有就不请求了 (虽然 getThumbnail 内部也有 batcher，但这里拦截更快)\n              const cache = getGlobalCache();\n              const cached = cache.get(img.path);\n              if (cached) return cached;\n\n              // 请求新图\n              const url = await getThumbnail(img.path, img.updatedAt, resourceRoot, controller.signal);\n              if (url) {\n                  cache.set(img.path, url); // 更新缓存\n              }\n              return url;\n          });\n;\n  }\n};",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 284,
                "column": 1
              },
              "endPosition": {
                "line": 284,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 7
              },
              "endPosition": {
                "line": 284,
                "column": 18
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 29
              },
              "endPosition": {
                "line": 285,
                "column": 3
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 8
              },
              "endPosition": {
                "line": 387,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 17
              },
              "endPosition": {
                "line": 388,
                "column": 11
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const FolderThumbnail = ({ file, files, mode, resourceRoot, cachePath }: { file: FileNode; files: Record&lt;string, FileNode&gt;, mode: LayoutMode, resourceRoot?: string, cachePath?: string }) =&gt; {",
            "lineNumber": 400
          },
          {
            "text": "const [previewSrcs, setPreviewSrcs] = () =&gt; {",
            "lineNumber": 410
          },
          {
            "lineNumber": 418
          },
          {
            "text": "      // 为了体验最好，只要有缓存就先用。过滤掉 null。",
            "lineNumber": 419
          },
          {
            "text": "      const validUrls = cachedUrls.filter((url): url is string =&gt; !!url);",
            "lineNumber": 420
          },
          {
            "text": "      ",
            "lineNumber": 421
          },
          {
            "text": "      // 如果没有缓存，返回空数组",
            "lineNumber": 422
          },
          {
            "text": "      return validUrls;",
            "lineNumber": 423
          },
          {
            "text": "  });",
            "lineNumber": 424
          },
          {
            "lineNumber": 425
          },
          {
            "text": "  // 如果初始就有数据（哪怕只有一张），就不设为 loaded=false，避免闪烁",
            "lineNumber": 426
          },
          {
            "text": "  const [loaded, setLoaded] = useState(previewSrcs.length &gt; 0);",
            "lineNumber": 427
          },
          {
            "lineNumber": 428
          },
          {
            "text": "  useEffect(() =&gt; {",
            "lineNumber": 429
          },
          {
            "text": "    // 如果已经加载过了，且数量足够（或者等于子文件总数），就不再请求",
            "lineNumber": 430
          },
          {
            "text": "    // 注意：这里简单判断，如果缓存里不够 3 张但实际有 3 张，还是会触发请求补全",
            "lineNumber": 431
          },
          {
            "text": "    if (loaded &amp;&amp; previewSrcs.length === Math.min(3, imageChildren.length)) {",
            "lineNumber": 432
          },
          {
            "text": "        return;",
            "lineNumber": 433
          },
          {
            "text": "    }",
            "lineNumber": 434
          },
          {
            "lineNumber": 435
          },
          {
            "text": "    if ((isInView || wasInView) &amp;&amp; resourceRoot &amp;&amp; imageChildren.length &gt; 0) {",
            "lineNumber": 436
          },
          {
            "text": "      const controller = new AbortController();",
            "lineNumber": 437
          },
          {
            "text": "      const loadPreviews = async () =&gt; {",
            "lineNumber": 438
          },
          {
            "text": "        try {",
            "lineNumber": 439
          },
          {
            "text": "          const { getThumbnail } = await import('../api/tauri-bridge');",
            "lineNumber": 440
          },
          {
            "text": "          ",
            "lineNumber": 441
          },
          {
            "text": "          // 并行请求所有子文件的缩略图",
            "lineNumber": 442
          },
          {
            "text": "          const promises = imageChildren.map(async (img: FileNode) =&gt; {",
            "lineNumber": 443
          },
          {
            "text": "              // 先查缓存，如果有就不请求了 (虽然 getThumbnail 内部也有 batcher，但这里拦截更快)",
            "lineNumber": 444
          },
          {
            "text": "              const cache = getGlobalCache();",
            "lineNumber": 445
          },
          {
            "text": "              const cached = cache.get(img.path);",
            "lineNumber": 446
          },
          {
            "text": "              if (cached) return cached;",
            "lineNumber": 447
          },
          {
            "lineNumber": 448
          },
          {
            "text": "              // 请求新图",
            "lineNumber": 449
          },
          {
            "text": "              const url = await getThumbnail(img.path, img.updatedAt, resourceRoot, controller.signal);",
            "lineNumber": 450
          },
          {
            "text": "              if (url) {",
            "lineNumber": 451
          },
          {
            "text": "                  cache.set(img.path, url); // 更新缓存",
            "lineNumber": 452
          },
          {
            "text": "              }",
            "lineNumber": 453
          },
          {
            "text": "              return url;",
            "lineNumber": 454
          },
          {
            "text": "          });",
            "lineNumber": 455
          },
          {
            "text": ";",
            "lineNumber": 479
          },
          {
            "text": "  }",
            "lineNumber": 487
          },
          {
            "text": "};",
            "lineNumber": 502
          }
        ]
      },
      "score": 0.3445744514465332
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 213
          },
          "endPosition": {
            "line": 397,
            "column": 1
          }
        },
        "contents": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { \n  src: string; \n  alt: string; \n  isSelected: boolean;\n  filePath?: string;\n  modified?: string;\n  size?: number;\n  isHovering?: boolean;\n  fileMeta?: { format?: string };\n  resourceRoot?: string;\n  cachePath?: string;\n}) =&gt; {\n size={24} /&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/div&gt;\n  );\n});\n\n// 辅助函数：深度查找文件夹内的图片\nconst findImagesDeeply = (\n    rootFolder: FileNode, \n    allFiles: Record&lt;string, FileNode&gt;, \n    limit: number = 3\n): FileNode[] =&gt; {\n    const images: FileNode[] = [];\n    // 使用栈进行 DFS，或者队列进行 BFS\n    const stack: string[] = [...(rootFolder.children || [])];\n    const visited = new Set&lt;string&gt;(); // 防止循环引用\n    \n    // 设置一个遍历上限，防止超大文件夹卡死 UI\n    let traversalCount = 0;\n    const MAX_TRAVERSAL = 500; \n\n    while (stack.length &gt; 0 &amp;&amp; traversalCount &lt; MAX_TRAVERSAL) {\n        const id = stack.pop()!;\n        if (visited.has(id)) continue;\n        visited.add(id);\n        traversalCount++;\n\n        const node = allFiles[id];\n        if (!node) continue;\n        \n        if (node.type === FileType.IMAGE) {\n            images.push(node);\n        }\n    }\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 284,
                "column": 1
              },
              "endPosition": {
                "line": 284,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 7
              },
              "endPosition": {
                "line": 284,
                "column": 18
              }
            },
            {
              "startPosition": {
                "line": 284,
                "column": 29
              },
              "endPosition": {
                "line": 285,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const ImageThumbnail = ({ src, alt, isSelected, filePath, modified, size, isHovering, fileMeta, resourceRoot, cachePath }: { ",
            "lineNumber": 214
          },
          {
            "text": "  src: string; ",
            "lineNumber": 215
          },
          {
            "text": "  alt: string; ",
            "lineNumber": 216
          },
          {
            "text": "  isSelected: boolean;",
            "lineNumber": 217
          },
          {
            "text": "  filePath?: string;",
            "lineNumber": 218
          },
          {
            "text": "  modified?: string;",
            "lineNumber": 219
          },
          {
            "text": "  size?: number;",
            "lineNumber": 220
          },
          {
            "text": "  isHovering?: boolean;",
            "lineNumber": 221
          },
          {
            "text": "  fileMeta?: { format?: string };",
            "lineNumber": 222
          },
          {
            "text": "  resourceRoot?: string;",
            "lineNumber": 223
          },
          {
            "text": "  cachePath?: string;",
            "lineNumber": 224
          },
          {
            "text": "}) =&gt; {",
            "lineNumber": 225
          },
          {
            "text": " size={24} /&gt;",
            "lineNumber": 356
          },
          {
            "text": "        )}",
            "lineNumber": 357
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 358
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 359
          },
          {
            "text": "  );",
            "lineNumber": 360
          },
          {
            "text": "});",
            "lineNumber": 361
          },
          {
            "lineNumber": 362
          },
          {
            "text": "// 辅助函数：深度查找文件夹内的图片",
            "lineNumber": 363
          },
          {
            "text": "const findImagesDeeply = (",
            "lineNumber": 364
          },
          {
            "text": "    rootFolder: FileNode, ",
            "lineNumber": 365
          },
          {
            "text": "    allFiles: Record&lt;string, FileNode&gt;, ",
            "lineNumber": 366
          },
          {
            "text": "    limit: number = 3",
            "lineNumber": 367
          },
          {
            "text": "): FileNode[] =&gt; {",
            "lineNumber": 368
          },
          {
            "text": "    const images: FileNode[] = [];",
            "lineNumber": 369
          },
          {
            "text": "    // 使用栈进行 DFS，或者队列进行 BFS",
            "lineNumber": 370
          },
          {
            "text": "    const stack: string[] = [...(rootFolder.children || [])];",
            "lineNumber": 371
          },
          {
            "text": "    const visited = new Set&lt;string&gt;(); // 防止循环引用",
            "lineNumber": 372
          },
          {
            "text": "    ",
            "lineNumber": 373
          },
          {
            "text": "    // 设置一个遍历上限，防止超大文件夹卡死 UI",
            "lineNumber": 374
          },
          {
            "text": "    let traversalCount = 0;",
            "lineNumber": 375
          },
          {
            "text": "    const MAX_TRAVERSAL = 500; ",
            "lineNumber": 376
          },
          {
            "lineNumber": 377
          },
          {
            "text": "    while (stack.length &gt; 0 &amp;&amp; traversalCount &lt; MAX_TRAVERSAL) {",
            "lineNumber": 378
          },
          {
            "text": "        const id = stack.pop()!;",
            "lineNumber": 379
          },
          {
            "text": "        if (visited.has(id)) continue;",
            "lineNumber": 380
          },
          {
            "text": "        visited.add(id);",
            "lineNumber": 381
          },
          {
            "text": "        traversalCount++;",
            "lineNumber": 382
          },
          {
            "lineNumber": 383
          },
          {
            "text": "        const node = allFiles[id];",
            "lineNumber": 384
          },
          {
            "text": "        if (!node) continue;",
            "lineNumber": 385
          },
          {
            "text": "        ",
            "lineNumber": 386
          },
          {
            "text": "        if (node.type === FileType.IMAGE) {",
            "lineNumber": 387
          },
          {
            "text": "            images.push(node);",
            "lineNumber": 388
          },
          {
            "text": "        }",
            "lineNumber": 389
          },
          {
            "text": "    }",
            "lineNumber": 392
          },
          {
            "text": ";",
            "lineNumber": 398
          }
        ]
      },
      "score": 0.33866220712661743
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 231
          },
          "endPosition": {
            "line": 584,
            "column": 1
          }
        },
        "contents": "const TagSection: React.FC&lt;TagSectionProps&gt; = \ntag =&gt; (\n\n              \n              {hoveredTag === tag &amp;&amp; previewImages.length &gt; 0 &amp;&amp; hoveredTagPos &amp;&amp; createPortal(\n                &lt;div \n                  className=\"fixed z-[100] bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl p-3 w-64 animate-fade-in pointer-events-none\" \n                  style={{ top: hoveredTagPos.top, left: hoveredTagPos.left }}\n                &gt;\n                  &lt;div className=\"text-sm text-gray-800 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-600 pb-1 font-bold flex items-center justify-between\"&gt;\n                     &lt;span&gt;{t('sidebar.tagPreview')} \"{hoveredTag}\"&lt;/span&gt;\n                     &lt;span className=\"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 rounded\"&gt;{previewImages.length} {t('sidebar.recent')}&lt;/span&gt;\n                  &lt;/div&gt;\n                  &lt;div className=\"grid grid-cols-3 gap-2\"&gt;\n                    {previewImages.map(img =&gt; (\n                      &lt;div key={img.id} className=\"aspect-square bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-700 overflow-hidden\"&gt;\n                         {/* Note: In Tauri, file.url is a file path, not a usable URL. Use placeholder for now. */}\n                         &lt;div className=\"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center\"&gt;\n                           &lt;ImageIcon className=\"text-gray-400 dark:text-gray-500\" size={20} /&gt;\n                         &lt;/div&gt;\n                      &lt;/div&gt;\n                    ))}\n                  &lt;/div&gt;\n                &lt;/div&gt;,\n                document.body\n              )}\n            &lt;/div&gt;\n          ))}\n          {sortedTags.length === 0 &amp;&amp; !isCreatingTag &amp;&amp; (\n             &lt;div className=\"text-xs text-gray-400 italic px-2 py-1\"&gt;{t('sidebar.rightClickToAdd')}&lt;/div&gt;\n          )}\n        &lt;/div&gt;\n      )}\n    &lt;/div&gt;\n  );\n}\n\nexport const Sidebar: React.FC&lt;{\n  roots: string[];\n  files: Record&lt;string, FileNode&gt;;\n  people: Record&lt;string, Person&gt;;\n  customTags: string[];\n  currentFolderId: string;\n  expandedIds: string[];\n  tasks?: TaskProgress[];\n  onToggle: (id: string) =&gt; void;\n  onNavigate: (id: string) =&gt; void;\n  onTagSelect: (tag: string) =&gt; void;\n  onNavigateAllTags: () =&gt; void;\n  onPersonSelect: (personId: string) =&gt; void;\n  onNavigateAllPeople: () =&gt; void;\n  onContextMenu: (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'person', id: string) =&gt; void;\n  onDrop: (targetId: string, sourceIds: string[]) =&gt; void;\n  onDropOnTag: (tag: string, sourceIds: string[]) =&gt; void;\n  isCreatingTag: boolean;\n  onStartCreateTag: () =&gt; void;\n  onSaveNewTag: (tag: string) =&gt; void;\n  onCancelCreateTag: () =&gt; void;\n  onOpenSettings: () =&gt; void;\n  onRestoreTask: (taskId: string) =&gt; void;\n  onStartRenamePerson: (personId: string) =&gt; void;\n  onCreatePerson: () =&gt; void;\n  t: (key: string) =&gt; string;\n}&gt; = \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 232,
                "column": 1
              },
              "endPosition": {
                "line": 232,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 232,
                "column": 7
              },
              "endPosition": {
                "line": 232,
                "column": 47
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 12
              },
              "endPosition": {
                "line": 387,
                "column": 12
              }
            },
            {
              "startPosition": {
                "line": 387,
                "column": 27
              },
              "endPosition": {
                "line": 388,
                "column": 13
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagSection: React.FC&lt;TagSectionProps&gt; = ",
            "lineNumber": 232
          },
          {
            "text": "tag =&gt; (",
            "lineNumber": 387
          },
          {
            "lineNumber": 433
          },
          {
            "text": "              ",
            "lineNumber": 434
          },
          {
            "text": "              {hoveredTag === tag &amp;&amp; previewImages.length &gt; 0 &amp;&amp; hoveredTagPos &amp;&amp; createPortal(",
            "lineNumber": 435
          },
          {
            "text": "                &lt;div ",
            "lineNumber": 436
          },
          {
            "text": "                  className=\"fixed z-[100] bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl p-3 w-64 animate-fade-in pointer-events-none\" ",
            "lineNumber": 437
          },
          {
            "text": "                  style={{ top: hoveredTagPos.top, left: hoveredTagPos.left }}",
            "lineNumber": 438
          },
          {
            "text": "                &gt;",
            "lineNumber": 439
          },
          {
            "text": "                  &lt;div className=\"text-sm text-gray-800 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-600 pb-1 font-bold flex items-center justify-between\"&gt;",
            "lineNumber": 440
          },
          {
            "text": "                     &lt;span&gt;{t('sidebar.tagPreview')} \"{hoveredTag}\"&lt;/span&gt;",
            "lineNumber": 441
          },
          {
            "text": "                     &lt;span className=\"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 rounded\"&gt;{previewImages.length} {t('sidebar.recent')}&lt;/span&gt;",
            "lineNumber": 442
          },
          {
            "text": "                  &lt;/div&gt;",
            "lineNumber": 443
          },
          {
            "text": "                  &lt;div className=\"grid grid-cols-3 gap-2\"&gt;",
            "lineNumber": 444
          },
          {
            "text": "                    {previewImages.map(img =&gt; (",
            "lineNumber": 445
          },
          {
            "text": "                      &lt;div key={img.id} className=\"aspect-square bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-700 overflow-hidden\"&gt;",
            "lineNumber": 446
          },
          {
            "text": "                         {/* Note: In Tauri, file.url is a file path, not a usable URL. Use placeholder for now. */}",
            "lineNumber": 447
          },
          {
            "text": "                         &lt;div className=\"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center\"&gt;",
            "lineNumber": 448
          },
          {
            "text": "                           &lt;ImageIcon className=\"text-gray-400 dark:text-gray-500\" size={20} /&gt;",
            "lineNumber": 449
          },
          {
            "text": "                         &lt;/div&gt;",
            "lineNumber": 450
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 451
          },
          {
            "text": "                    ))}",
            "lineNumber": 452
          },
          {
            "text": "                  &lt;/div&gt;",
            "lineNumber": 453
          },
          {
            "text": "                &lt;/div&gt;,",
            "lineNumber": 454
          },
          {
            "text": "                document.body",
            "lineNumber": 455
          },
          {
            "text": "              )}",
            "lineNumber": 456
          },
          {
            "text": "            &lt;/div&gt;",
            "lineNumber": 457
          },
          {
            "text": "          ))}",
            "lineNumber": 458
          },
          {
            "text": "          {sortedTags.length === 0 &amp;&amp; !isCreatingTag &amp;&amp; (",
            "lineNumber": 459
          },
          {
            "text": "             &lt;div className=\"text-xs text-gray-400 italic px-2 py-1\"&gt;{t('sidebar.rightClickToAdd')}&lt;/div&gt;",
            "lineNumber": 460
          },
          {
            "text": "          )}",
            "lineNumber": 461
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 462
          },
          {
            "text": "      )}",
            "lineNumber": 463
          },
          {
            "text": "    &lt;/div&gt;",
            "lineNumber": 464
          },
          {
            "text": "  );",
            "lineNumber": 465
          },
          {
            "text": "}",
            "lineNumber": 466
          },
          {
            "lineNumber": 467
          },
          {
            "text": "export const Sidebar: React.FC&lt;{",
            "lineNumber": 468
          },
          {
            "text": "  roots: string[];",
            "lineNumber": 469
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 470
          },
          {
            "text": "  people: Record&lt;string, Person&gt;;",
            "lineNumber": 471
          },
          {
            "text": "  customTags: string[];",
            "lineNumber": 472
          },
          {
            "text": "  currentFolderId: string;",
            "lineNumber": 473
          },
          {
            "text": "  expandedIds: string[];",
            "lineNumber": 474
          },
          {
            "text": "  tasks?: TaskProgress[];",
            "lineNumber": 475
          },
          {
            "text": "  onToggle: (id: string) =&gt; void;",
            "lineNumber": 476
          },
          {
            "text": "  onNavigate: (id: string) =&gt; void;",
            "lineNumber": 477
          },
          {
            "text": "  onTagSelect: (tag: string) =&gt; void;",
            "lineNumber": 478
          },
          {
            "text": "  onNavigateAllTags: () =&gt; void;",
            "lineNumber": 479
          },
          {
            "text": "  onPersonSelect: (personId: string) =&gt; void;",
            "lineNumber": 480
          },
          {
            "text": "  onNavigateAllPeople: () =&gt; void;",
            "lineNumber": 481
          },
          {
            "text": "  onContextMenu: (e: React.MouseEvent, type: 'file' | 'tag' | 'tag-background' | 'root-folder' | 'person', id: string) =&gt; void;",
            "lineNumber": 482
          },
          {
            "text": "  onDrop: (targetId: string, sourceIds: string[]) =&gt; void;",
            "lineNumber": 483
          },
          {
            "text": "  onDropOnTag: (tag: string, sourceIds: string[]) =&gt; void;",
            "lineNumber": 484
          },
          {
            "text": "  isCreatingTag: boolean;",
            "lineNumber": 485
          },
          {
            "text": "  onStartCreateTag: () =&gt; void;",
            "lineNumber": 486
          },
          {
            "text": "  onSaveNewTag: (tag: string) =&gt; void;",
            "lineNumber": 487
          },
          {
            "text": "  onCancelCreateTag: () =&gt; void;",
            "lineNumber": 488
          },
          {
            "text": "  onOpenSettings: () =&gt; void;",
            "lineNumber": 489
          },
          {
            "text": "  onRestoreTask: (taskId: string) =&gt; void;",
            "lineNumber": 490
          },
          {
            "text": "  onStartRenamePerson: (personId: string) =&gt; void;",
            "lineNumber": 491
          },
          {
            "text": "  onCreatePerson: () =&gt; void;",
            "lineNumber": 492
          },
          {
            "text": "  t: (key: string) =&gt; string;",
            "lineNumber": 493
          },
          {
            "text": "}&gt; = ",
            "lineNumber": 494
          },
          {
            "text": ";",
            "lineNumber": 585
          }
        ]
      },
      "score": 0.33834588527679443
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 1329
          },
          "endPosition": {
            "line": 1543,
            "column": 1
          }
        },
        "contents": "const useLayout = \n() =&gt; {\n {\n        // Use provided people dictionary to generate IDs, ignore 'items' prop\n        // Filter people by search query if provided\n        let itemsList = Object.values(people || {});\n        if (searchQuery &amp;&amp; searchQuery.trim()) {\n            const query = searchQuery.toLowerCase().trim();\n            itemsList = itemsList.filter(person =&gt; \n                person.name.toLowerCase().includes(query)\n            );\n        }\n        const minColWidth = thumbnailSize;\n        const cols = Math.max(1, Math.floor((finalAvailableWidth + GAP) / (minColWidth + GAP)));\n        const itemWidth = (finalAvailableWidth - (cols - 1) * GAP) / cols;\n        const itemHeight = itemWidth + 60; // Extra space for text\n\n        itemsList.forEach((person, index) =&gt; {\n            const row = Math.floor(index / cols);\n            const col = index % cols;\n            layout.push({\n                id: person.id,\n                x: PADDING + col * (itemWidth + GAP),\n                y: PADDING + row * (itemHeight + GAP),\n                width: itemWidth,\n                height: itemHeight\n            });\n        });\n        const rows = Math.ceil(itemsList.length / cols);\n        totalHeight = PADDING + rows * (itemHeight + GAP);\n    } \n\n    return { layout, totalHeight };\n  }, [items, files, layoutMode, containerWidth, thumbnailSize, viewMode, aspectRatios, people, searchQuery]);\n};\n\ninterface FileGridProps {\n  displayFileIds: string[];\n  files: Record&lt;string, FileNode&gt;;\n  activeTab: TabState;\n  renamingId: string | null;\n  thumbnailSize: number;\n  hoverPlayingId: string | null;\n  onSetHoverPlayingId\n;\n}",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 1218,
                "column": 1
              },
              "endPosition": {
                "line": 1218,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 8
              },
              "endPosition": {
                "line": 1218,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 1218,
                "column": 14
              },
              "endPosition": {
                "line": 1218,
                "column": 50
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const useLayout = ",
            "lineNumber": 1330
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 1354
          },
          {
            "text": " {",
            "lineNumber": 1465
          },
          {
            "text": "        // Use provided people dictionary to generate IDs, ignore 'items' prop",
            "lineNumber": 1466
          },
          {
            "text": "        // Filter people by search query if provided",
            "lineNumber": 1467
          },
          {
            "text": "        let itemsList = Object.values(people || {});",
            "lineNumber": 1468
          },
          {
            "text": "        if (searchQuery &amp;&amp; searchQuery.trim()) {",
            "lineNumber": 1469
          },
          {
            "text": "            const query = searchQuery.toLowerCase().trim();",
            "lineNumber": 1470
          },
          {
            "text": "            itemsList = itemsList.filter(person =&gt; ",
            "lineNumber": 1471
          },
          {
            "text": "                person.name.toLowerCase().includes(query)",
            "lineNumber": 1472
          },
          {
            "text": "            );",
            "lineNumber": 1473
          },
          {
            "text": "        }",
            "lineNumber": 1474
          },
          {
            "text": "        const minColWidth = thumbnailSize;",
            "lineNumber": 1475
          },
          {
            "text": "        const cols = Math.max(1, Math.floor((finalAvailableWidth + GAP) / (minColWidth + GAP)));",
            "lineNumber": 1476
          },
          {
            "text": "        const itemWidth = (finalAvailableWidth - (cols - 1) * GAP) / cols;",
            "lineNumber": 1477
          },
          {
            "text": "        const itemHeight = itemWidth + 60; // Extra space for text",
            "lineNumber": 1478
          },
          {
            "lineNumber": 1479
          },
          {
            "text": "        itemsList.forEach((person, index) =&gt; {",
            "lineNumber": 1480
          },
          {
            "text": "            const row = Math.floor(index / cols);",
            "lineNumber": 1481
          },
          {
            "text": "            const col = index % cols;",
            "lineNumber": 1482
          },
          {
            "text": "            layout.push({",
            "lineNumber": 1483
          },
          {
            "text": "                id: person.id,",
            "lineNumber": 1484
          },
          {
            "text": "                x: PADDING + col * (itemWidth + GAP),",
            "lineNumber": 1485
          },
          {
            "text": "                y: PADDING + row * (itemHeight + GAP),",
            "lineNumber": 1486
          },
          {
            "text": "                width: itemWidth,",
            "lineNumber": 1487
          },
          {
            "text": "                height: itemHeight",
            "lineNumber": 1488
          },
          {
            "text": "            });",
            "lineNumber": 1489
          },
          {
            "text": "        });",
            "lineNumber": 1490
          },
          {
            "text": "        const rows = Math.ceil(itemsList.length / cols);",
            "lineNumber": 1491
          },
          {
            "text": "        totalHeight = PADDING + rows * (itemHeight + GAP);",
            "lineNumber": 1492
          },
          {
            "text": "    } ",
            "lineNumber": 1493
          },
          {
            "lineNumber": 1494
          },
          {
            "text": "    return { layout, totalHeight };",
            "lineNumber": 1495
          },
          {
            "text": "  }, [items, files, layoutMode, containerWidth, thumbnailSize, viewMode, aspectRatios, people, searchQuery]);",
            "lineNumber": 1496
          },
          {
            "text": "};",
            "lineNumber": 1497
          },
          {
            "lineNumber": 1498
          },
          {
            "text": "interface FileGridProps {",
            "lineNumber": 1499,
            "isSignature": true
          },
          {
            "text": "  displayFileIds: string[];",
            "lineNumber": 1500
          },
          {
            "text": "  files: Record&lt;string, FileNode&gt;;",
            "lineNumber": 1501
          },
          {
            "text": "  activeTab: TabState;",
            "lineNumber": 1502
          },
          {
            "text": "  renamingId: string | null;",
            "lineNumber": 1503
          },
          {
            "text": "  thumbnailSize: number;",
            "lineNumber": 1504
          },
          {
            "text": "  hoverPlayingId: string | null;",
            "lineNumber": 1505
          },
          {
            "text": "  onSetHoverPlayingId",
            "lineNumber": 1506
          },
          {
            "text": ";",
            "lineNumber": 1543,
            "isSignature": true
          },
          {
            "text": "}",
            "lineNumber": 1544,
            "isSignature": true
          }
        ]
      },
      "score": 0.3374435305595398
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nprev =&gt; (\n\n                      }));\n                  }\n              }\n          }\n          \n          showToast(t('settings.aiAnalyzeSuccess'));\n\n      } catch (err) {\n          console.error(err);\n          showToast(\"AI Analysis Failed\");\n      } finally {\n          updateTask(taskId, { status: 'completed', currentStep: t('tasks.completed') });\n          setTimeout(() =&gt; setState(prev =&gt; ({ ...prev, tasks: prev.tasks.filter(t =&gt; t.id !== taskId) })), 1000);\n      }\n  };\n  \n  // Function to analyze all files in a folder\n  const handleFolderAIAnalysis = async (folderId: string) =&gt; {\n      // Get all image files in the folder and check their AI analysis status\n      const getAllImageFilesInFolder = (folderId: string): { id: string; analyzed: boolean }[] =&gt; {\n          const folder = state.files[folderId];\n          if (!folder) return [];\n          \n          let imageFiles: { id: string; analyzed: boolean }[] = [];\n          \n          if (folder.children) {\n              for (const childId of folder.children) {\n                  const child = state.files[childId];\n                  if (child) {\n                      if (child.type === FileType.FOLDER) {\n                          // Recursively get files from subfolders\n                          imageFiles\n;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3599
          },
          {
            "text": "prev =&gt; (",
            "lineNumber": 4369
          },
          {
            "lineNumber": 4377
          },
          {
            "text": "                      }));",
            "lineNumber": 4378
          },
          {
            "text": "                  }",
            "lineNumber": 4379
          },
          {
            "text": "              }",
            "lineNumber": 4380
          },
          {
            "text": "          }",
            "lineNumber": 4381
          },
          {
            "text": "          ",
            "lineNumber": 4382
          },
          {
            "text": "          showToast(t('settings.aiAnalyzeSuccess'));",
            "lineNumber": 4383
          },
          {
            "lineNumber": 4384
          },
          {
            "text": "      } catch (err) {",
            "lineNumber": 4385
          },
          {
            "text": "          console.error(err);",
            "lineNumber": 4386
          },
          {
            "text": "          showToast(\"AI Analysis Failed\");",
            "lineNumber": 4387
          },
          {
            "text": "      } finally {",
            "lineNumber": 4388
          },
          {
            "text": "          updateTask(taskId, { status: 'completed', currentStep: t('tasks.completed') });",
            "lineNumber": 4389
          },
          {
            "text": "          setTimeout(() =&gt; setState(prev =&gt; ({ ...prev, tasks: prev.tasks.filter(t =&gt; t.id !== taskId) })), 1000);",
            "lineNumber": 4390
          },
          {
            "text": "      }",
            "lineNumber": 4391
          },
          {
            "text": "  };",
            "lineNumber": 4392
          },
          {
            "text": "  ",
            "lineNumber": 4393
          },
          {
            "text": "  // Function to analyze all files in a folder",
            "lineNumber": 4394
          },
          {
            "text": "  const handleFolderAIAnalysis = async (folderId: string) =&gt; {",
            "lineNumber": 4395
          },
          {
            "text": "      // Get all image files in the folder and check their AI analysis status",
            "lineNumber": 4396
          },
          {
            "text": "      const getAllImageFilesInFolder = (folderId: string): { id: string; analyzed: boolean }[] =&gt; {",
            "lineNumber": 4397
          },
          {
            "text": "          const folder = state.files[folderId];",
            "lineNumber": 4398
          },
          {
            "text": "          if (!folder) return [];",
            "lineNumber": 4399
          },
          {
            "text": "          ",
            "lineNumber": 4400
          },
          {
            "text": "          let imageFiles: { id: string; analyzed: boolean }[] = [];",
            "lineNumber": 4401
          },
          {
            "text": "          ",
            "lineNumber": 4402
          },
          {
            "text": "          if (folder.children) {",
            "lineNumber": 4403
          },
          {
            "text": "              for (const childId of folder.children) {",
            "lineNumber": 4404
          },
          {
            "text": "                  const child = state.files[childId];",
            "lineNumber": 4405
          },
          {
            "text": "                  if (child) {",
            "lineNumber": 4406
          },
          {
            "text": "                      if (child.type === FileType.FOLDER) {",
            "lineNumber": 4407
          },
          {
            "text": "                          // Recursively get files from subfolders",
            "lineNumber": 4408
          },
          {
            "text": "                          imageFiles",
            "lineNumber": 4409
          },
          {
            "text": ";",
            "lineNumber": 4420
          },
          {
            "text": ";",
            "lineNumber": 4441
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.3345910906791687
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleFolderAIAnalysis = async \n\n      \n      if (allImageIds.length === 0) return;\n      \n      // Get IDs of images that haven't been analyzed yet\n      const unanalyzedImageIds = allImageFiles.filter(file =&gt; !file.analyzed).map(file =&gt; file.id);\n      \n      if (unanalyzedImageIds.length &gt; 0) {\n          // If there are unanalyzed images, analyze them first\n          await handleAIAnalysis(unanalyzedImageIds, folderId);\n      } else {\n          // If all images are already analyzed, just generate the summary\n          // We'll call handleAIAnalysis with empty array and folderId to trigger summary generation\n          await handleAIAnalysis([], folderId);\n      }\n  };\n\n  return (\n    &lt;div className=\"w-full h-full flex flex-col bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 overflow-hidden font-sans transition-colors duration-300\" \n              onClick={closeContextMenu} onDragOver={handleDragOver} onDrop={handleExternalFileDrop} onDragLeave={handleDragLeave}&gt;\n      {/* 启动界面 */}\n      &lt;SplashScreen isVisible={showSplash}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            },
            {
              "startPosition": {
                "line": 4407,
                "column": 28
              },
              "endPosition": {
                "line": 4407,
                "column": 28
              }
            },
            {
              "startPosition": {
                "line": 4407,
                "column": 29
              },
              "endPosition": {
                "line": 4408,
                "column": 29
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleFolderAIAnalysis = async ",
            "lineNumber": 4395
          },
          {
            "lineNumber": 4426
          },
          {
            "text": "      ",
            "lineNumber": 4427
          },
          {
            "text": "      if (allImageIds.length === 0) return;",
            "lineNumber": 4428
          },
          {
            "text": "      ",
            "lineNumber": 4429
          },
          {
            "text": "      // Get IDs of images that haven't been analyzed yet",
            "lineNumber": 4430
          },
          {
            "text": "      const unanalyzedImageIds = allImageFiles.filter(file =&gt; !file.analyzed).map(file =&gt; file.id);",
            "lineNumber": 4431
          },
          {
            "text": "      ",
            "lineNumber": 4432
          },
          {
            "text": "      if (unanalyzedImageIds.length &gt; 0) {",
            "lineNumber": 4433
          },
          {
            "text": "          // If there are unanalyzed images, analyze them first",
            "lineNumber": 4434
          },
          {
            "text": "          await handleAIAnalysis(unanalyzedImageIds, folderId);",
            "lineNumber": 4435
          },
          {
            "text": "      } else {",
            "lineNumber": 4436
          },
          {
            "text": "          // If all images are already analyzed, just generate the summary",
            "lineNumber": 4437
          },
          {
            "text": "          // We'll call handleAIAnalysis with empty array and folderId to trigger summary generation",
            "lineNumber": 4438
          },
          {
            "text": "          await handleAIAnalysis([], folderId);",
            "lineNumber": 4439
          },
          {
            "text": "      }",
            "lineNumber": 4440
          },
          {
            "text": "  };",
            "lineNumber": 4441
          },
          {
            "lineNumber": 4442
          },
          {
            "text": "  return (",
            "lineNumber": 4443
          },
          {
            "text": "    &lt;div className=\"w-full h-full flex flex-col bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 overflow-hidden font-sans transition-colors duration-300\" ",
            "lineNumber": 4444
          },
          {
            "text": "              onClick={closeContextMenu} onDragOver={handleDragOver} onDrop={handleExternalFileDrop} onDragLeave={handleDragLeave}&gt;",
            "lineNumber": 4445
          },
          {
            "text": "      {/* 启动界面 */}",
            "lineNumber": 4446
          },
          {
            "text": "      &lt;SplashScreen isVisible={showSplash}",
            "lineNumber": 4447
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.3320557475090027
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\FileGrid.tsx",
        "range": {
          "startPosition": {
            "line": 566
          },
          "endPosition": {
            "line": 733,
            "column": 1
          }
        },
        "contents": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {\n\n              &lt;Tag size={64} className=\"mb-4 opacity-20\"/&gt;\n              &lt;p&gt;{t('sidebar.noTagsFound')}&lt;/p&gt;\n          &lt;/div&gt;\n      )}\n      {keys.map((group: string) =&gt; {\n          const tagsInGroup = groupedTags[group];\n          return (\n              &lt;div id={&#96;tag-group-${group}&#96;} key={group} className=\"mb-8 scroll-mt-4\"&gt;\n                   &lt;div className=\"flex items-center mb-0 border-b border-gray-100 dark:border-gray-800 pt-3 pb-3 sticky top-0 bg-white/95 dark:bg-gray-950/95 z-10 backdrop-blur-sm transition-colors h-16\"&gt;\n                       &lt;div className=\"w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-lg mr-3 shadow-sm border border-blue-100 dark:border-blue-900/50\"&gt;\n                          {group}\n                       &lt;/div&gt;\n                       &lt;span className=\"text-xs font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wider\"&gt;\n                          {tagsInGroup.length} {t('context.items')}\n                       &lt;/span&gt;\n                   &lt;/div&gt;\n                   &lt;div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3\"&gt;\n                       {tagsInGroup.map((tag: string) =&gt; {\n                           const count = tagCounts[tag] || 0;\n                           const isSelected = selectedTagIds.includes(tag);\n                           return (\n                              &lt;TagItem \n                                  key={tag}\n                                  tag={tag}\n                                  count={count}\n                                  isSelected={isSelected}\n                                  onTagClick={onTagClick}\n                                  onTagDoubleClick={onTagDoubleClick}\n                                  onTagContextMenu={onTagContextMenu}\n                                  handleMouseEnter={handleMouseEnter}\n                                  handleMouseLeave={handleMouseLeave}\n                              /&gt;\n                           );\n                       })}\n                   &lt;/div&gt;\n              &lt;/div&gt;\n          );\n      })}\n\n      {hoveredTag &amp;&amp; previewImages.length &gt; 0 &amp;&amp; hoveredTagPos &amp;&amp; createPortal(\n        &lt;div \n          className=\"fixed z-[100] bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl p-3 w-64 animate-fade-in pointer-events-none\" \n          style={{ top: hoveredTagPos.top, left: hoveredTagPos.left }}\n        &gt;\n          &lt;div className=\"text-sm text-gray-800 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-600 pb-1 font-bold flex items-center justify-between\"&gt;\n             &lt;span&gt;{t('sidebar.tagPreview')} \"{hoveredTag}\"&lt;/span&gt;\n             &lt;span className=\"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 rounded\"&gt;{previewImages.length} {t('sidebar.recent')}&lt;/span&gt;\n          &lt;/div&gt;\n          &lt;div className=\"grid grid-cols-3 gap-2\"&gt;\n            {previewImages.map((f: any) =&gt; (\n              &lt;div key={f.id} className=\"aspect-square bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-700 overflow-hidden\"&gt;\n                 {/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */\n            )\n\n}\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 453,
                "column": 1
              },
              "endPosition": {
                "line": 453,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 7
              },
              "endPosition": {
                "line": 453,
                "column": 22
              }
            },
            {
              "startPosition": {
                "line": 453,
                "column": 33
              },
              "endPosition": {
                "line": 472,
                "column": 3
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsList = ({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {",
            "lineNumber": 567
          },
          {
            "lineNumber": 665
          },
          {
            "text": "              &lt;Tag size={64} className=\"mb-4 opacity-20\"/&gt;",
            "lineNumber": 666
          },
          {
            "text": "              &lt;p&gt;{t('sidebar.noTagsFound')}&lt;/p&gt;",
            "lineNumber": 667
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 668
          },
          {
            "text": "      )}",
            "lineNumber": 669
          },
          {
            "text": "      {keys.map((group: string) =&gt; {",
            "lineNumber": 670
          },
          {
            "text": "          const tagsInGroup = groupedTags[group];",
            "lineNumber": 671
          },
          {
            "text": "          return (",
            "lineNumber": 672
          },
          {
            "text": "              &lt;div id={&#96;tag-group-${group}&#96;} key={group} className=\"mb-8 scroll-mt-4\"&gt;",
            "lineNumber": 673
          },
          {
            "text": "                   &lt;div className=\"flex items-center mb-0 border-b border-gray-100 dark:border-gray-800 pt-3 pb-3 sticky top-0 bg-white/95 dark:bg-gray-950/95 z-10 backdrop-blur-sm transition-colors h-16\"&gt;",
            "lineNumber": 674
          },
          {
            "text": "                       &lt;div className=\"w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold text-lg mr-3 shadow-sm border border-blue-100 dark:border-blue-900/50\"&gt;",
            "lineNumber": 675
          },
          {
            "text": "                          {group}",
            "lineNumber": 676
          },
          {
            "text": "                       &lt;/div&gt;",
            "lineNumber": 677
          },
          {
            "text": "                       &lt;span className=\"text-xs font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wider\"&gt;",
            "lineNumber": 678
          },
          {
            "text": "                          {tagsInGroup.length} {t('context.items')}",
            "lineNumber": 679
          },
          {
            "text": "                       &lt;/span&gt;",
            "lineNumber": 680
          },
          {
            "text": "                   &lt;/div&gt;",
            "lineNumber": 681
          },
          {
            "text": "                   &lt;div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3\"&gt;",
            "lineNumber": 682
          },
          {
            "text": "                       {tagsInGroup.map((tag: string) =&gt; {",
            "lineNumber": 683
          },
          {
            "text": "                           const count = tagCounts[tag] || 0;",
            "lineNumber": 684
          },
          {
            "text": "                           const isSelected = selectedTagIds.includes(tag);",
            "lineNumber": 685
          },
          {
            "text": "                           return (",
            "lineNumber": 686
          },
          {
            "text": "                              &lt;TagItem ",
            "lineNumber": 687
          },
          {
            "text": "                                  key={tag}",
            "lineNumber": 688
          },
          {
            "text": "                                  tag={tag}",
            "lineNumber": 689
          },
          {
            "text": "                                  count={count}",
            "lineNumber": 690
          },
          {
            "text": "                                  isSelected={isSelected}",
            "lineNumber": 691
          },
          {
            "text": "                                  onTagClick={onTagClick}",
            "lineNumber": 692
          },
          {
            "text": "                                  onTagDoubleClick={onTagDoubleClick}",
            "lineNumber": 693
          },
          {
            "text": "                                  onTagContextMenu={onTagContextMenu}",
            "lineNumber": 694
          },
          {
            "text": "                                  handleMouseEnter={handleMouseEnter}",
            "lineNumber": 695
          },
          {
            "text": "                                  handleMouseLeave={handleMouseLeave}",
            "lineNumber": 696
          },
          {
            "text": "                              /&gt;",
            "lineNumber": 697
          },
          {
            "text": "                           );",
            "lineNumber": 698
          },
          {
            "text": "                       })}",
            "lineNumber": 699
          },
          {
            "text": "                   &lt;/div&gt;",
            "lineNumber": 700
          },
          {
            "text": "              &lt;/div&gt;",
            "lineNumber": 701
          },
          {
            "text": "          );",
            "lineNumber": 702
          },
          {
            "text": "      })}",
            "lineNumber": 703
          },
          {
            "lineNumber": 704
          },
          {
            "text": "      {hoveredTag &amp;&amp; previewImages.length &gt; 0 &amp;&amp; hoveredTagPos &amp;&amp; createPortal(",
            "lineNumber": 705
          },
          {
            "text": "        &lt;div ",
            "lineNumber": 706
          },
          {
            "text": "          className=\"fixed z-[100] bg-white dark:bg-[#2d3748] border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl p-3 w-64 animate-fade-in pointer-events-none\" ",
            "lineNumber": 707
          },
          {
            "text": "          style={{ top: hoveredTagPos.top, left: hoveredTagPos.left }}",
            "lineNumber": 708
          },
          {
            "text": "        &gt;",
            "lineNumber": 709
          },
          {
            "text": "          &lt;div className=\"text-sm text-gray-800 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-600 pb-1 font-bold flex items-center justify-between\"&gt;",
            "lineNumber": 710
          },
          {
            "text": "             &lt;span&gt;{t('sidebar.tagPreview')} \"{hoveredTag}\"&lt;/span&gt;",
            "lineNumber": 711
          },
          {
            "text": "             &lt;span className=\"text-[10px] bg-gray-100 dark:bg-gray-700 px-1.5 rounded\"&gt;{previewImages.length} {t('sidebar.recent')}&lt;/span&gt;",
            "lineNumber": 712
          },
          {
            "text": "          &lt;/div&gt;",
            "lineNumber": 713
          },
          {
            "text": "          &lt;div className=\"grid grid-cols-3 gap-2\"&gt;",
            "lineNumber": 714
          },
          {
            "text": "            {previewImages.map((f: any) =&gt; (",
            "lineNumber": 715
          },
          {
            "text": "              &lt;div key={f.id} className=\"aspect-square bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-700 overflow-hidden\"&gt;",
            "lineNumber": 716
          },
          {
            "text": "                 {/* Note: In Tauri, file.url and file.previewUrl are file paths, not usable URLs. Use placeholder for now. */",
            "lineNumber": 717
          },
          {
            "text": "            )",
            "lineNumber": 722
          },
          {
            "lineNumber": 726
          },
          {
            "text": "}",
            "lineNumber": 729
          },
          {
            "text": ";",
            "lineNumber": 734
          }
        ]
      },
      "score": 0.33066868782043457
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleAIAnalysis = async \nallTexts.join('; ').length &gt; 300 ? '...' : ''}&#96;;\n                              }\n                          }\n                      } catch (err) {\n                          console.error('Failed to generate AI analysis', err);\n                          // Fallback to a better summary that doesn't list individual images\n                          const isChinese = state.settings.language === 'zh';\n                          summary = isChinese ? &#96;## 图片分析汇总\\n\\n&#96; : &#96;## Image Analysis Summary\\n\\n&#96;;\n                          \n                          // Extract all descriptions without numbering\n                          const allDescriptions = allResults\n                              .map(r =&gt; r.description || '')\n                              .filter(Boolean)\n                              .;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleAIAnalysis = async ",
            "lineNumber": 3599
          },
          {
            "text": "allTexts.join('; ').length &gt; 300 ? '...' : ''}&#96;;",
            "lineNumber": 4333
          },
          {
            "text": "                              }",
            "lineNumber": 4334
          },
          {
            "text": "                          }",
            "lineNumber": 4335
          },
          {
            "text": "                      } catch (err) {",
            "lineNumber": 4336
          },
          {
            "text": "                          console.error('Failed to generate AI analysis', err);",
            "lineNumber": 4337
          },
          {
            "text": "                          // Fallback to a better summary that doesn't list individual images",
            "lineNumber": 4338
          },
          {
            "text": "                          const isChinese = state.settings.language === 'zh';",
            "lineNumber": 4339
          },
          {
            "text": "                          summary = isChinese ? &#96;## 图片分析汇总\\n\\n&#96; : &#96;## Image Analysis Summary\\n\\n&#96;;",
            "lineNumber": 4340
          },
          {
            "text": "                          ",
            "lineNumber": 4341
          },
          {
            "text": "                          // Extract all descriptions without numbering",
            "lineNumber": 4342
          },
          {
            "text": "                          const allDescriptions = allResults",
            "lineNumber": 4343
          },
          {
            "text": "                              .map(r =&gt; r.description || '')",
            "lineNumber": 4344
          },
          {
            "text": "                              .filter(Boolean)",
            "lineNumber": 4345
          },
          {
            "text": "                              .;",
            "lineNumber": 4346
          },
          {
            "text": ";",
            "lineNumber": 4392
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.32898959517478943
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 43
          },
          "endPosition": {
            "line": 195,
            "column": 1
          }
        },
        "contents": "const TagsWidget = \nconst suggestedTags = \n [allTags, localSearchQuery, isFocused]);\n  \n  const keys = Object.keys(filteredGroupedTags).sort();\n  const totalTags = Object.values(filteredGroupedTags).reduce((acc, curr) =&gt; acc + curr.length, 0);\n\n  return (\n    &lt;div className=\"flex flex-col select-none bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-2xl overflow-hidden w-80 max-h-[400px] font-sans border border-gray-200 dark:border-gray-700 z-50\"&gt;\n      &lt;div className=\"px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\"&gt;\n        &lt;div className=\"flex items-center justify-between mb-3\"&gt;\n          &lt;span className=\"font-bold text-sm tracking-wide\"&gt;{t('sidebar.allTags')}&lt;/span&gt;\n          &lt;span className=\"text-xs text-gray-500 dark:text-gray-400 bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded-full\"&gt;\n            {totalTags}\n          &lt;/span&gt;\n        &lt;/div&gt;\n        &lt;div className=\"relative\"&gt;\n          &lt;Search size={14} className=\"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400\" /&gt;\n          &lt;input\n            type=\"text\"\n            id=\"tag-search-input\"\n            name=\"tag-search-input\"\n            placeholder={t('search.placeholder')}\n            value={localSearchQuery}\n            onChange={(e) =&gt; {\n              setLocalSearchQuery(e.target.value);\n              onSetTagSearchQuery(e.target.value);\n            }}\n            onFocus={() =&gt; setIsFocused(true)}\n            onBlur={() =&gt; {\n              // 延迟关闭，以便点击建议项时能触发点击事件\n              setTimeout(() =&gt; setIsFocused(false), 200);\n            }}\n            className=\"w-full pl-8 pr-2 py-1.5 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          /&gt;\n          {localSearchQuery &amp;&amp;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 42,
                "column": 1
              },
              "endPosition": {
                "line": 42,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 42,
                "column": 7
              },
              "endPosition": {
                "line": 42,
                "column": 20
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagsWidget = ",
            "lineNumber": 44
          },
          {
            "text": "const suggestedTags = ",
            "lineNumber": 79
          },
          {
            "text": " [allTags, localSearchQuery, isFocused]);",
            "lineNumber": 85
          },
          {
            "text": "  ",
            "lineNumber": 86
          },
          {
            "text": "  const keys = Object.keys(filteredGroupedTags).sort();",
            "lineNumber": 87
          },
          {
            "text": "  const totalTags = Object.values(filteredGroupedTags).reduce((acc, curr) =&gt; acc + curr.length, 0);",
            "lineNumber": 88
          },
          {
            "lineNumber": 89
          },
          {
            "text": "  return (",
            "lineNumber": 90
          },
          {
            "text": "    &lt;div className=\"flex flex-col select-none bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-2xl overflow-hidden w-80 max-h-[400px] font-sans border border-gray-200 dark:border-gray-700 z-50\"&gt;",
            "lineNumber": 91
          },
          {
            "text": "      &lt;div className=\"px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\"&gt;",
            "lineNumber": 92
          },
          {
            "text": "        &lt;div className=\"flex items-center justify-between mb-3\"&gt;",
            "lineNumber": 93
          },
          {
            "text": "          &lt;span className=\"font-bold text-sm tracking-wide\"&gt;{t('sidebar.allTags')}&lt;/span&gt;",
            "lineNumber": 94
          },
          {
            "text": "          &lt;span className=\"text-xs text-gray-500 dark:text-gray-400 bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded-full\"&gt;",
            "lineNumber": 95
          },
          {
            "text": "            {totalTags}",
            "lineNumber": 96
          },
          {
            "text": "          &lt;/span&gt;",
            "lineNumber": 97
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 98
          },
          {
            "text": "        &lt;div className=\"relative\"&gt;",
            "lineNumber": 99
          },
          {
            "text": "          &lt;Search size={14} className=\"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400\" /&gt;",
            "lineNumber": 100
          },
          {
            "text": "          &lt;input",
            "lineNumber": 101
          },
          {
            "text": "            type=\"text\"",
            "lineNumber": 102
          },
          {
            "text": "            id=\"tag-search-input\"",
            "lineNumber": 103
          },
          {
            "text": "            name=\"tag-search-input\"",
            "lineNumber": 104
          },
          {
            "text": "            placeholder={t('search.placeholder')}",
            "lineNumber": 105
          },
          {
            "text": "            value={localSearchQuery}",
            "lineNumber": 106
          },
          {
            "text": "            onChange={(e) =&gt; {",
            "lineNumber": 107
          },
          {
            "text": "              setLocalSearchQuery(e.target.value);",
            "lineNumber": 108
          },
          {
            "text": "              onSetTagSearchQuery(e.target.value);",
            "lineNumber": 109
          },
          {
            "text": "            }}",
            "lineNumber": 110
          },
          {
            "text": "            onFocus={() =&gt; setIsFocused(true)}",
            "lineNumber": 111
          },
          {
            "text": "            onBlur={() =&gt; {",
            "lineNumber": 112
          },
          {
            "text": "              // 延迟关闭，以便点击建议项时能触发点击事件",
            "lineNumber": 113
          },
          {
            "text": "              setTimeout(() =&gt; setIsFocused(false), 200);",
            "lineNumber": 114
          },
          {
            "text": "            }}",
            "lineNumber": 115
          },
          {
            "text": "            className=\"w-full pl-8 pr-2 py-1.5 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"",
            "lineNumber": 116
          },
          {
            "text": "          /&gt;",
            "lineNumber": 117
          },
          {
            "text": "          {localSearchQuery &amp;&amp;",
            "lineNumber": 118
          },
          {
            "text": ";",
            "lineNumber": 196
          }
        ]
      },
      "score": 0.3271060883998871
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 231
          },
          "endPosition": {
            "line": 465
          }
        },
        "contents": "const TagSection: React.FC&lt;TagSectionProps&gt; = \n\n\n          {sortedTags.map(tag =&gt; (\n            &lt;div \n              key={tag}\n              className=\"relative group\"\n              onMouseEnter={(e) =&gt; handleMouseEnter(e, tag)}\n              onMouseLeave={handleMouseLeave}\n              onContextMenu={(e) =&gt; onContextMenu(e, 'tag', tag)}\n              onDragOver={(e) =&gt; {\n                e.preventDefault();\n                e.stopPropagation();\n                setDragOverTag(tag);\n                e.dataTransfer.dropEffect = 'copy';\n              }}\n              onDragLeave={(e) =&gt; {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  if (e.relatedTarget &amp;&amp; e.currentTarget.contains(e.relatedTarget as Node)) return;\n                  setDragOverTag(null);\n              }}\n              onDrop={(e) =&gt; {\n                e.preventDefault();\n                e.stopPropagation();\n                setDragOverTag(null);\n                const data = e.dataTransfer.getData('application/json');\n                if (data) {\n                    try {\n                        const ids = JSON.parse(data);\n                        if (Array.isArray(ids) &amp;&amp; ids.length &gt; 0) {\n                            onDropOnTag(tag, ids);\n                        }\n                    } catch (err) {}\n                }\n              }}\n            &gt;\n              &lt;div \n                className=\n          )",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 232,
                "column": 1
              },
              "endPosition": {
                "line": 232,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 232,
                "column": 7
              },
              "endPosition": {
                "line": 232,
                "column": 47
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagSection: React.FC&lt;TagSectionProps&gt; = ",
            "lineNumber": 232
          },
          {
            "lineNumber": 385
          },
          {
            "lineNumber": 386
          },
          {
            "text": "          {sortedTags.map(tag =&gt; (",
            "lineNumber": 387
          },
          {
            "text": "            &lt;div ",
            "lineNumber": 388
          },
          {
            "text": "              key={tag}",
            "lineNumber": 389
          },
          {
            "text": "              className=\"relative group\"",
            "lineNumber": 390
          },
          {
            "text": "              onMouseEnter={(e) =&gt; handleMouseEnter(e, tag)}",
            "lineNumber": 391
          },
          {
            "text": "              onMouseLeave={handleMouseLeave}",
            "lineNumber": 392
          },
          {
            "text": "              onContextMenu={(e) =&gt; onContextMenu(e, 'tag', tag)}",
            "lineNumber": 393
          },
          {
            "text": "              onDragOver={(e) =&gt; {",
            "lineNumber": 394
          },
          {
            "text": "                e.preventDefault();",
            "lineNumber": 395
          },
          {
            "text": "                e.stopPropagation();",
            "lineNumber": 396
          },
          {
            "text": "                setDragOverTag(tag);",
            "lineNumber": 397
          },
          {
            "text": "                e.dataTransfer.dropEffect = 'copy';",
            "lineNumber": 398
          },
          {
            "text": "              }}",
            "lineNumber": 399
          },
          {
            "text": "              onDragLeave={(e) =&gt; {",
            "lineNumber": 400
          },
          {
            "text": "                  e.preventDefault();",
            "lineNumber": 401
          },
          {
            "text": "                  e.stopPropagation();",
            "lineNumber": 402
          },
          {
            "text": "                  if (e.relatedTarget &amp;&amp; e.currentTarget.contains(e.relatedTarget as Node)) return;",
            "lineNumber": 403
          },
          {
            "text": "                  setDragOverTag(null);",
            "lineNumber": 404
          },
          {
            "text": "              }}",
            "lineNumber": 405
          },
          {
            "text": "              onDrop={(e) =&gt; {",
            "lineNumber": 406
          },
          {
            "text": "                e.preventDefault();",
            "lineNumber": 407
          },
          {
            "text": "                e.stopPropagation();",
            "lineNumber": 408
          },
          {
            "text": "                setDragOverTag(null);",
            "lineNumber": 409
          },
          {
            "text": "                const data = e.dataTransfer.getData('application/json');",
            "lineNumber": 410
          },
          {
            "text": "                if (data) {",
            "lineNumber": 411
          },
          {
            "text": "                    try {",
            "lineNumber": 412
          },
          {
            "text": "                        const ids = JSON.parse(data);",
            "lineNumber": 413
          },
          {
            "text": "                        if (Array.isArray(ids) &amp;&amp; ids.length &gt; 0) {",
            "lineNumber": 414
          },
          {
            "text": "                            onDropOnTag(tag, ids);",
            "lineNumber": 415
          },
          {
            "text": "                        }",
            "lineNumber": 416
          },
          {
            "text": "                    } catch (err) {}",
            "lineNumber": 417
          },
          {
            "text": "                }",
            "lineNumber": 418
          },
          {
            "text": "              }}",
            "lineNumber": 419
          },
          {
            "text": "            &gt;",
            "lineNumber": 420
          },
          {
            "text": "              &lt;div ",
            "lineNumber": 421
          },
          {
            "text": "                className=",
            "lineNumber": 422
          },
          {
            "text": "          )",
            "lineNumber": 458
          }
        ]
      },
      "score": 0.3161872625350952
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleFolderAIAnalysis = async \nconst getAllImageFilesInFolder = \n\n                  if (child) {\n                      if (child.type === FileType.FOLDER) {\n                          // Recursively get files from subfolders\n                          imageFiles = [...imageFiles, ...getAllImageFilesInFolder(childId)];\n                      } else if (child.type === FileType.IMAGE) {\n                          // Check if image has been analyzed\n                          const analyzed = !!child.aiData?.analyzed;\n                          imageFiles.push({ id: childId, analyzed });\n                      }\n                  }\n              }\n          }\n          \n          return imageFiles;\n      };\n      \n      // Get all image files with their analysis status\n      const allImageFiles = getAllImageFilesInFolder(folderId);\n      \n      // Filter out non-image files and get all image IDs\n      const allImageIds = allImageFiles.map(file =&gt; file.id);\n      \n      if (allImageIds.length === 0) return;\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleFolderAIAnalysis = async ",
            "lineNumber": 4395
          },
          {
            "text": "const getAllImageFilesInFolder = ",
            "lineNumber": 4397
          },
          {
            "lineNumber": 4405
          },
          {
            "text": "                  if (child) {",
            "lineNumber": 4406
          },
          {
            "text": "                      if (child.type === FileType.FOLDER) {",
            "lineNumber": 4407
          },
          {
            "text": "                          // Recursively get files from subfolders",
            "lineNumber": 4408
          },
          {
            "text": "                          imageFiles = [...imageFiles, ...getAllImageFilesInFolder(childId)];",
            "lineNumber": 4409
          },
          {
            "text": "                      } else if (child.type === FileType.IMAGE) {",
            "lineNumber": 4410
          },
          {
            "text": "                          // Check if image has been analyzed",
            "lineNumber": 4411
          },
          {
            "text": "                          const analyzed = !!child.aiData?.analyzed;",
            "lineNumber": 4412
          },
          {
            "text": "                          imageFiles.push({ id: childId, analyzed });",
            "lineNumber": 4413
          },
          {
            "text": "                      }",
            "lineNumber": 4414
          },
          {
            "text": "                  }",
            "lineNumber": 4415
          },
          {
            "text": "              }",
            "lineNumber": 4416
          },
          {
            "text": "          }",
            "lineNumber": 4417
          },
          {
            "text": "          ",
            "lineNumber": 4418
          },
          {
            "text": "          return imageFiles;",
            "lineNumber": 4419
          },
          {
            "text": "      };",
            "lineNumber": 4420
          },
          {
            "text": "      ",
            "lineNumber": 4421
          },
          {
            "text": "      // Get all image files with their analysis status",
            "lineNumber": 4422
          },
          {
            "text": "      const allImageFiles = getAllImageFilesInFolder(folderId);",
            "lineNumber": 4423
          },
          {
            "text": "      ",
            "lineNumber": 4424
          },
          {
            "text": "      // Filter out non-image files and get all image IDs",
            "lineNumber": 4425
          },
          {
            "text": "      const allImageIds = allImageFiles.map(file =&gt; file.id);",
            "lineNumber": 4426
          },
          {
            "text": "      ",
            "lineNumber": 4427
          },
          {
            "text": "      if (allImageIds.length === 0) return;",
            "lineNumber": 4428
          },
          {
            "text": ";",
            "lineNumber": 4441
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.31442001461982727
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TopBar.tsx",
        "range": {
          "startPosition": {
            "line": 444
          },
          "endPosition": {
            "line": 807,
            "column": 1
          }
        },
        "contents": "export const TopBar: React.FC&lt;TopBarProps&gt; = \n\n                        &lt;span className=\"text-sm text-gray-700 dark:text-gray-200\"&gt;{t('folderSettings.remember')}&lt;/span&gt;\n                        &lt;button \n                            className={&#96;relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${hasFolderSettings ? 'bg-blue-500' : 'bg-gray-300 dark:bg-gray-600'}&#96;}\n                        &gt;\n                            &lt;span className={&#96;inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 ease-in-out ${hasFolderSettings ? 'translate-x-6' : 'translate-x-1'}&#96;} /&gt;\n                        &lt;/button&gt;\n                      &lt;/div&gt;\n                    &lt;/&gt;\n                  )}\n               &lt;/div&gt;\n             &lt;/&gt;\n           )}\n        &lt;/div&gt;\n\n        {/* Date Filter */}\n        &lt;div className=\"relative\"&gt;\n           &lt;button \n             onClick={() =&gt; setFilterMenuOpen(!filterMenuOpen)}\n             className={&#96;p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 ${filterMenuOpen || activeTab.dateFilter.start ? 'text-blue-500' : 'text-gray-600 dark:text-gray-300'}&#96;}\n             title={t('date.calendar')}\n           &gt;\n             &lt;Calendar size={18} /&gt;\n           &lt;/button&gt;\n           {filterMenuOpen &amp;&amp; (\n             &lt;&gt;\n               &lt;div className=\"fixed inset-0 z-40\" onClick={() =&gt; setFilterMenuOpen(false)}&gt;&lt;/div&gt;\n               &lt;div className=\"absolute top-full right-0 mt-2 z-50 animate-zoom-in\"&gt;\n                  &lt;CalendarWidget \n                      dateFilter={activeTab.dateFilter} \n                      onUpdate={onUpdateDateFilter}\n                      t={t}\n                  /&gt;\n               &lt;/div&gt;\n             &lt;/&gt;\n           )}\n        &lt;/div&gt;\n\n        {/* All Tags Widget */}\n        &lt;div className=\"relative\"&gt;\n           &lt;button\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 443,
                "column": 1
              },
              "endPosition": {
                "line": 443,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 8
              },
              "endPosition": {
                "line": 443,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 443,
                "column": 14
              },
              "endPosition": {
                "line": 443,
                "column": 46
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const TopBar: React.FC&lt;TopBarProps&gt; = ",
            "lineNumber": 445
          },
          {
            "lineNumber": 733
          },
          {
            "text": "                        &lt;span className=\"text-sm text-gray-700 dark:text-gray-200\"&gt;{t('folderSettings.remember')}&lt;/span&gt;",
            "lineNumber": 734
          },
          {
            "text": "                        &lt;button ",
            "lineNumber": 735
          },
          {
            "text": "                            className={&#96;relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${hasFolderSettings ? 'bg-blue-500' : 'bg-gray-300 dark:bg-gray-600'}&#96;}",
            "lineNumber": 736
          },
          {
            "text": "                        &gt;",
            "lineNumber": 737
          },
          {
            "text": "                            &lt;span className={&#96;inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 ease-in-out ${hasFolderSettings ? 'translate-x-6' : 'translate-x-1'}&#96;} /&gt;",
            "lineNumber": 738
          },
          {
            "text": "                        &lt;/button&gt;",
            "lineNumber": 739
          },
          {
            "text": "                      &lt;/div&gt;",
            "lineNumber": 740
          },
          {
            "text": "                    &lt;/&gt;",
            "lineNumber": 741
          },
          {
            "text": "                  )}",
            "lineNumber": 742
          },
          {
            "text": "               &lt;/div&gt;",
            "lineNumber": 743
          },
          {
            "text": "             &lt;/&gt;",
            "lineNumber": 744
          },
          {
            "text": "           )}",
            "lineNumber": 745
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 746
          },
          {
            "lineNumber": 747
          },
          {
            "text": "        {/* Date Filter */}",
            "lineNumber": 748
          },
          {
            "text": "        &lt;div className=\"relative\"&gt;",
            "lineNumber": 749
          },
          {
            "text": "           &lt;button ",
            "lineNumber": 750
          },
          {
            "text": "             onClick={() =&gt; setFilterMenuOpen(!filterMenuOpen)}",
            "lineNumber": 751
          },
          {
            "text": "             className={&#96;p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 ${filterMenuOpen || activeTab.dateFilter.start ? 'text-blue-500' : 'text-gray-600 dark:text-gray-300'}&#96;}",
            "lineNumber": 752
          },
          {
            "text": "             title={t('date.calendar')}",
            "lineNumber": 753
          },
          {
            "text": "           &gt;",
            "lineNumber": 754
          },
          {
            "text": "             &lt;Calendar size={18} /&gt;",
            "lineNumber": 755
          },
          {
            "text": "           &lt;/button&gt;",
            "lineNumber": 756
          },
          {
            "text": "           {filterMenuOpen &amp;&amp; (",
            "lineNumber": 757
          },
          {
            "text": "             &lt;&gt;",
            "lineNumber": 758
          },
          {
            "text": "               &lt;div className=\"fixed inset-0 z-40\" onClick={() =&gt; setFilterMenuOpen(false)}&gt;&lt;/div&gt;",
            "lineNumber": 759
          },
          {
            "text": "               &lt;div className=\"absolute top-full right-0 mt-2 z-50 animate-zoom-in\"&gt;",
            "lineNumber": 760
          },
          {
            "text": "                  &lt;CalendarWidget ",
            "lineNumber": 761
          },
          {
            "text": "                      dateFilter={activeTab.dateFilter} ",
            "lineNumber": 762
          },
          {
            "text": "                      onUpdate={onUpdateDateFilter}",
            "lineNumber": 763
          },
          {
            "text": "                      t={t}",
            "lineNumber": 764
          },
          {
            "text": "                  /&gt;",
            "lineNumber": 765
          },
          {
            "text": "               &lt;/div&gt;",
            "lineNumber": 766
          },
          {
            "text": "             &lt;/&gt;",
            "lineNumber": 767
          },
          {
            "text": "           )}",
            "lineNumber": 768
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 769
          },
          {
            "lineNumber": 770
          },
          {
            "text": "        {/* All Tags Widget */}",
            "lineNumber": 771
          },
          {
            "text": "        &lt;div className=\"relative\"&gt;",
            "lineNumber": 772
          },
          {
            "text": "           &lt;button",
            "lineNumber": 773
          },
          {
            "text": ";",
            "lineNumber": 808
          }
        ]
      },
      "score": 0.3088718056678772
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \n() =&gt; {\nconst loadPreviews = async \nconst promises = async (img: FileNode) =&gt; {\n\n\n              // 请求新图\n              const url = await getThumbnail(img.path, img.updatedAt, resourceRoot);\n              return url;\n          });\n\n          const thumbnails = await Promise.all(promises);\n          \n          // 过滤掉 null 值\n          const validThumbnails = thumbnails.filter((t: any): t is string =&gt; !!t);\n          \n          // 更新预览图\n          if (validThumbnails.length &gt; 0) {\n            setFolderPreviewImages(validThumbnails);\n          }\n        } catch (error) {\n          console.error('Failed to load folder previews:', error);\n        } finally {\n          setFolderPreviewLoaded(true);\n        }\n      };\n\n      loadPreviews();\n    } else {\n      setFolderPreviewLoaded(true);\n    }\n  }, [file, files, resourceRoot]);\n\n  const typeColors: Record&lt;string, string&gt; = {\n      'JPG': 'bg-green-500 dark:bg-green-400',\n      'JPEG': 'bg-green-500 dark:bg-green-400',\n      'PNG': 'bg-teal-500 dark:bg-teal-400',\n      'GIF': 'bg-purple-500 dark:bg-purple-400',\n      'WEBP': 'bg-pink-500 dark:bg-pink-400',\n      'SVG': 'bg-orange-500 dark:bg-orange-400',\n      'MP4': 'bg-red-500 dark:bg-red-400',\n      'MOV': 'bg-red-500 dark:bg-red-400',\n      'FOLDER': 'bg-blue-500 dark:bg-blue-400'\n  };\n  const defaultColor = 'bg-gray-500 dark:bg-gray-400';\n\n  const chartData = useMemo(() =&gt; {\n    if (!folderDetails) return [];\n    const data: { label: string; value: number; color: string }[] = [];\n    \n    if (folderDetails.subFolderCount &gt; 0) {\n        data.push({ \n            label: t('context.subfolders'), \n            value: folderDetails.subFolderCount, \n            color: typeColors['FOLDER'] || defaultColor\n        });\n    }\n  };\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "() =&gt; {",
            "lineNumber": 560
          },
          {
            "text": "const loadPreviews = async ",
            "lineNumber": 589
          },
          {
            "text": "const promises = async (img: FileNode) =&gt; {",
            "lineNumber": 594
          },
          {
            "lineNumber": 600
          },
          {
            "lineNumber": 601
          },
          {
            "text": "              // 请求新图",
            "lineNumber": 602
          },
          {
            "text": "              const url = await getThumbnail(img.path, img.updatedAt, resourceRoot);",
            "lineNumber": 603
          },
          {
            "text": "              return url;",
            "lineNumber": 604
          },
          {
            "text": "          });",
            "lineNumber": 605
          },
          {
            "lineNumber": 606
          },
          {
            "text": "          const thumbnails = await Promise.all(promises);",
            "lineNumber": 607
          },
          {
            "text": "          ",
            "lineNumber": 608
          },
          {
            "text": "          // 过滤掉 null 值",
            "lineNumber": 609
          },
          {
            "text": "          const validThumbnails = thumbnails.filter((t: any): t is string =&gt; !!t);",
            "lineNumber": 610
          },
          {
            "text": "          ",
            "lineNumber": 611
          },
          {
            "text": "          // 更新预览图",
            "lineNumber": 612
          },
          {
            "text": "          if (validThumbnails.length &gt; 0) {",
            "lineNumber": 613
          },
          {
            "text": "            setFolderPreviewImages(validThumbnails);",
            "lineNumber": 614
          },
          {
            "text": "          }",
            "lineNumber": 615
          },
          {
            "text": "        } catch (error) {",
            "lineNumber": 616
          },
          {
            "text": "          console.error('Failed to load folder previews:', error);",
            "lineNumber": 617
          },
          {
            "text": "        } finally {",
            "lineNumber": 618
          },
          {
            "text": "          setFolderPreviewLoaded(true);",
            "lineNumber": 619
          },
          {
            "text": "        }",
            "lineNumber": 620
          },
          {
            "text": "      };",
            "lineNumber": 621
          },
          {
            "lineNumber": 622
          },
          {
            "text": "      loadPreviews();",
            "lineNumber": 623
          },
          {
            "text": "    } else {",
            "lineNumber": 624
          },
          {
            "text": "      setFolderPreviewLoaded(true);",
            "lineNumber": 625
          },
          {
            "text": "    }",
            "lineNumber": 626
          },
          {
            "text": "  }, [file, files, resourceRoot]);",
            "lineNumber": 627
          },
          {
            "lineNumber": 628
          },
          {
            "text": "  const typeColors: Record&lt;string, string&gt; = {",
            "lineNumber": 629
          },
          {
            "text": "      'JPG': 'bg-green-500 dark:bg-green-400',",
            "lineNumber": 630
          },
          {
            "text": "      'JPEG': 'bg-green-500 dark:bg-green-400',",
            "lineNumber": 631
          },
          {
            "text": "      'PNG': 'bg-teal-500 dark:bg-teal-400',",
            "lineNumber": 632
          },
          {
            "text": "      'GIF': 'bg-purple-500 dark:bg-purple-400',",
            "lineNumber": 633
          },
          {
            "text": "      'WEBP': 'bg-pink-500 dark:bg-pink-400',",
            "lineNumber": 634
          },
          {
            "text": "      'SVG': 'bg-orange-500 dark:bg-orange-400',",
            "lineNumber": 635
          },
          {
            "text": "      'MP4': 'bg-red-500 dark:bg-red-400',",
            "lineNumber": 636
          },
          {
            "text": "      'MOV': 'bg-red-500 dark:bg-red-400',",
            "lineNumber": 637
          },
          {
            "text": "      'FOLDER': 'bg-blue-500 dark:bg-blue-400'",
            "lineNumber": 638
          },
          {
            "text": "  };",
            "lineNumber": 639
          },
          {
            "text": "  const defaultColor = 'bg-gray-500 dark:bg-gray-400';",
            "lineNumber": 640
          },
          {
            "lineNumber": 641
          },
          {
            "text": "  const chartData = useMemo(() =&gt; {",
            "lineNumber": 642
          },
          {
            "text": "    if (!folderDetails) return [];",
            "lineNumber": 643
          },
          {
            "text": "    const data: { label: string; value: number; color: string }[] = [];",
            "lineNumber": 644
          },
          {
            "text": "    ",
            "lineNumber": 645
          },
          {
            "text": "    if (folderDetails.subFolderCount &gt; 0) {",
            "lineNumber": 646
          },
          {
            "text": "        data.push({ ",
            "lineNumber": 647
          },
          {
            "text": "            label: t('context.subfolders'), ",
            "lineNumber": 648
          },
          {
            "text": "            value: folderDetails.subFolderCount, ",
            "lineNumber": 649
          },
          {
            "text": "            color: typeColors['FOLDER'] || defaultColor",
            "lineNumber": 650
          },
          {
            "text": "        });",
            "lineNumber": 651
          },
          {
            "text": "    }",
            "lineNumber": 652
          },
          {
            "text": "  };",
            "lineNumber": 663
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.30665650963783264
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\App.tsx",
        "range": {
          "startPosition": {
            "line": 511
          },
          "endPosition": {
            "line": 5058,
            "column": 1
          }
        },
        "contents": "export const App: React.FC = \nconst handleRenameTag = \nprev =&gt; {\n\n          \n          // Update tabs with tag references\n          const newTabs = prev.tabs.map(tab =&gt; {\n              let updatedTab = { ...tab };\n              \n              // Update tab's search query if it's searching for the old tag\n              if (updatedTab.searchQuery === oldTag) {\n                  updatedTab.searchQuery = trimmedNewTag;\n              }\n              \n              // Update tab's active tags if the old tag is active\n              if (updatedTab.activeTags.includes(oldTag)) {\n                  updatedTab.activeTags = updatedTab.activeTags.map(tag =&gt; tag === oldTag ? trimmedNewTag : tag);\n              }\n              \n              // Update tab's selected tag ids if the old tag is selected\n              if (updatedTab.selectedTagIds.includes(oldTag)) {\n                  updatedTab.selectedTagIds = updatedTab.selectedTagIds.map(tag =&gt; tag === oldTag ? trimmedNewTag : tag);\n              }\n              \n              return updatedTab;\n          });\n          \n          return {\n              ...prev,\n              files: newFiles,\n              customTags: newCustomTags,\n              tabs: newTabs,\n              activeModal: { type: null }\n          };\n      });\n  };\n  \n  const handleRenamePerson = (personId: string, newName: string) =&gt; {\n      if (!newName.trim()) return;\n      setState(prev =&gt; ({\n          ...prev,\n          people: {\n              ...prev.people,\n              [personId]: { ...prev.people[personId], name: newName }\n          },\n          activeModal: { type: null }\n      }));\n  };\n\n  const handleUpdatePerson = (personId: string, updates: Partial&lt;Person&gt;) =&gt; {\n      setState(prev =&gt; ({\n          ...prev,\n          people: {\n              ...prev.people,\n)\n;\n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 510,
                "column": 1
              },
              "endPosition": {
                "line": 510,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 8
              },
              "endPosition": {
                "line": 510,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 510,
                "column": 14
              },
              "endPosition": {
                "line": 510,
                "column": 30
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const App: React.FC = ",
            "lineNumber": 512
          },
          {
            "text": "const handleRenameTag = ",
            "lineNumber": 2353
          },
          {
            "text": "prev =&gt; {",
            "lineNumber": 2358
          },
          {
            "lineNumber": 2372
          },
          {
            "text": "          ",
            "lineNumber": 2373
          },
          {
            "text": "          // Update tabs with tag references",
            "lineNumber": 2374
          },
          {
            "text": "          const newTabs = prev.tabs.map(tab =&gt; {",
            "lineNumber": 2375
          },
          {
            "text": "              let updatedTab = { ...tab };",
            "lineNumber": 2376
          },
          {
            "text": "              ",
            "lineNumber": 2377
          },
          {
            "text": "              // Update tab's search query if it's searching for the old tag",
            "lineNumber": 2378
          },
          {
            "text": "              if (updatedTab.searchQuery === oldTag) {",
            "lineNumber": 2379
          },
          {
            "text": "                  updatedTab.searchQuery = trimmedNewTag;",
            "lineNumber": 2380
          },
          {
            "text": "              }",
            "lineNumber": 2381
          },
          {
            "text": "              ",
            "lineNumber": 2382
          },
          {
            "text": "              // Update tab's active tags if the old tag is active",
            "lineNumber": 2383
          },
          {
            "text": "              if (updatedTab.activeTags.includes(oldTag)) {",
            "lineNumber": 2384
          },
          {
            "text": "                  updatedTab.activeTags = updatedTab.activeTags.map(tag =&gt; tag === oldTag ? trimmedNewTag : tag);",
            "lineNumber": 2385
          },
          {
            "text": "              }",
            "lineNumber": 2386
          },
          {
            "text": "              ",
            "lineNumber": 2387
          },
          {
            "text": "              // Update tab's selected tag ids if the old tag is selected",
            "lineNumber": 2388
          },
          {
            "text": "              if (updatedTab.selectedTagIds.includes(oldTag)) {",
            "lineNumber": 2389
          },
          {
            "text": "                  updatedTab.selectedTagIds = updatedTab.selectedTagIds.map(tag =&gt; tag === oldTag ? trimmedNewTag : tag);",
            "lineNumber": 2390
          },
          {
            "text": "              }",
            "lineNumber": 2391
          },
          {
            "text": "              ",
            "lineNumber": 2392
          },
          {
            "text": "              return updatedTab;",
            "lineNumber": 2393
          },
          {
            "text": "          });",
            "lineNumber": 2394
          },
          {
            "text": "          ",
            "lineNumber": 2395
          },
          {
            "text": "          return {",
            "lineNumber": 2396
          },
          {
            "text": "              ...prev,",
            "lineNumber": 2397
          },
          {
            "text": "              files: newFiles,",
            "lineNumber": 2398
          },
          {
            "text": "              customTags: newCustomTags,",
            "lineNumber": 2399
          },
          {
            "text": "              tabs: newTabs,",
            "lineNumber": 2400
          },
          {
            "text": "              activeModal: { type: null }",
            "lineNumber": 2401
          },
          {
            "text": "          };",
            "lineNumber": 2402
          },
          {
            "text": "      });",
            "lineNumber": 2403
          },
          {
            "text": "  };",
            "lineNumber": 2404
          },
          {
            "text": "  ",
            "lineNumber": 2405
          },
          {
            "text": "  const handleRenamePerson = (personId: string, newName: string) =&gt; {",
            "lineNumber": 2406
          },
          {
            "text": "      if (!newName.trim()) return;",
            "lineNumber": 2407
          },
          {
            "text": "      setState(prev =&gt; ({",
            "lineNumber": 2408
          },
          {
            "text": "          ...prev,",
            "lineNumber": 2409
          },
          {
            "text": "          people: {",
            "lineNumber": 2410
          },
          {
            "text": "              ...prev.people,",
            "lineNumber": 2411
          },
          {
            "text": "              [personId]: { ...prev.people[personId], name: newName }",
            "lineNumber": 2412
          },
          {
            "text": "          },",
            "lineNumber": 2413
          },
          {
            "text": "          activeModal: { type: null }",
            "lineNumber": 2414
          },
          {
            "text": "      }));",
            "lineNumber": 2415
          },
          {
            "text": "  };",
            "lineNumber": 2416
          },
          {
            "lineNumber": 2417
          },
          {
            "text": "  const handleUpdatePerson = (personId: string, updates: Partial&lt;Person&gt;) =&gt; {",
            "lineNumber": 2418
          },
          {
            "text": "      setState(prev =&gt; ({",
            "lineNumber": 2419
          },
          {
            "text": "          ...prev,",
            "lineNumber": 2420
          },
          {
            "text": "          people: {",
            "lineNumber": 2421
          },
          {
            "text": "              ...prev.people,",
            "lineNumber": 2422
          },
          {
            "text": ")",
            "lineNumber": 2425
          },
          {
            "text": ";",
            "lineNumber": 2426
          },
          {
            "text": ";",
            "lineNumber": 5059
          }
        ]
      },
      "score": 0.30338525772094727
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\MetadataPanel.tsx",
        "range": {
          "startPosition": {
            "line": 321
          },
          "endPosition": {
            "line": 1515,
            "column": 1
          }
        },
        "contents": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = \nobj =&gt; (\n\n                                                &lt;/span&gt;\n                                            ))}\n                                        &lt;/div&gt;\n                                    &lt;/div&gt;\n                                )}\n\n                                {file.aiData.extractedText &amp;&amp; (\n                                    &lt;div className=\"mt-2 bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;\n                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1 flex items-center\"&gt;\n                                            &lt;FileText size={10} className=\"mr-1\"/&gt; {t('meta.aiExtractedText')}\n                                        &lt;/div&gt;\n                                        &lt;p className=\"text-xs text-gray-700 dark:text-gray-300 whitespace-pre-wrap leading-relaxed\"&gt;{file.aiData.extractedText}&lt;/p&gt;\n                                    &lt;/div&gt;\n                                )}\n\n                                {file.aiData.translatedText &amp;&amp; (\n                                    &lt;div className=\"mt-2 bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;\n                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1 flex items-center\"&gt;\n                                            &lt;Languages size={10} className=\"mr-1\"/&gt; {t('meta.aiTranslatedText')}\n                                        &lt;/div&gt;\n                                        \n;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 246,
                "column": 1
              },
              "endPosition": {
                "line": 246,
                "column": 8
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 8
              },
              "endPosition": {
                "line": 246,
                "column": 14
              }
            },
            {
              "startPosition": {
                "line": 246,
                "column": 14
              },
              "endPosition": {
                "line": 246,
                "column": 55
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "export const MetadataPanel: React.FC&lt;MetadataProps&gt; = ",
            "lineNumber": 322
          },
          {
            "text": "obj =&gt; (",
            "lineNumber": 1206
          },
          {
            "lineNumber": 1208
          },
          {
            "text": "                                                &lt;/span&gt;",
            "lineNumber": 1209
          },
          {
            "text": "                                            ))}",
            "lineNumber": 1210
          },
          {
            "text": "                                        &lt;/div&gt;",
            "lineNumber": 1211
          },
          {
            "text": "                                    &lt;/div&gt;",
            "lineNumber": 1212
          },
          {
            "text": "                                )}",
            "lineNumber": 1213
          },
          {
            "lineNumber": 1214
          },
          {
            "text": "                                {file.aiData.extractedText &amp;&amp; (",
            "lineNumber": 1215
          },
          {
            "text": "                                    &lt;div className=\"mt-2 bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;",
            "lineNumber": 1216
          },
          {
            "text": "                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1 flex items-center\"&gt;",
            "lineNumber": 1217
          },
          {
            "text": "                                            &lt;FileText size={10} className=\"mr-1\"/&gt; {t('meta.aiExtractedText')}",
            "lineNumber": 1218
          },
          {
            "text": "                                        &lt;/div&gt;",
            "lineNumber": 1219
          },
          {
            "text": "                                        &lt;p className=\"text-xs text-gray-700 dark:text-gray-300 whitespace-pre-wrap leading-relaxed\"&gt;{file.aiData.extractedText}&lt;/p&gt;",
            "lineNumber": 1220
          },
          {
            "text": "                                    &lt;/div&gt;",
            "lineNumber": 1221
          },
          {
            "text": "                                )}",
            "lineNumber": 1222
          },
          {
            "lineNumber": 1223
          },
          {
            "text": "                                {file.aiData.translatedText &amp;&amp; (",
            "lineNumber": 1224
          },
          {
            "text": "                                    &lt;div className=\"mt-2 bg-white dark:bg-gray-800 p-2 rounded border border-gray-100 dark:border-gray-700\"&gt;",
            "lineNumber": 1225
          },
          {
            "text": "                                        &lt;div className=\"text-[10px] text-gray-400 font-bold mb-1 flex items-center\"&gt;",
            "lineNumber": 1226
          },
          {
            "text": "                                            &lt;Languages size={10} className=\"mr-1\"/&gt; {t('meta.aiTranslatedText')}",
            "lineNumber": 1227
          },
          {
            "text": "                                        &lt;/div&gt;",
            "lineNumber": 1228
          },
          {
            "text": "                                        ",
            "lineNumber": 1229
          },
          {
            "text": ";",
            "lineNumber": 1516
          }
        ]
      },
      "score": 0.3028377890586853
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": ".\\src\\components\\TreeSidebar.tsx",
        "range": {
          "startPosition": {
            "line": 231
          },
          "endPosition": {
            "line": 465
          }
        },
        "contents": "const TagSection: React.FC&lt;TagSectionProps&gt; = \n\n\n  return (\n    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300 relative\"&gt;\n       &lt;div \n        className=\"flex items-center py-1 px-2 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-800 mt-2 group\"\n      &gt;\n        &lt;div className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\" onClick={() =&gt; setExpanded(!expanded)}&gt;\n           {expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;}\n        &lt;/div&gt;\n        &lt;div className=\"flex items-center flex-1\" onClick={onNavigateAllTags}&gt;\n          &lt;TagIcon size={14} className=\"mr-2 text-blue-500 dark:text-blue-400\" /&gt;\n          &lt;span className=\"font-bold text-gray-500 dark:text-gray-400 text-xs uppercase tracking-wider group-hover:text-black dark:group-hover:text-white transition-colors\"&gt;{t('sidebar.allTags')} ({sortedTags.length})&lt;/span&gt;\n        &lt;/div&gt;\n        &lt;button \n           className=\"p-1 rounded hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors opacity-0 group-hover:opacity-100\"\n           onClick={(e) =&gt; { e.stopPropagation(); onStartCreateTag(); }}\n           title={t('context.newTag')}\n        &gt;\n           &lt;Plus size={14} /&gt;\n        &lt;/button&gt;\n      &lt;/div&gt;\n\n      {expanded &amp;&amp;",
        "signatures": {
          "ranges": [
            {
              "startPosition": {
                "line": 232,
                "column": 1
              },
              "endPosition": {
                "line": 232,
                "column": 7
              }
            },
            {
              "startPosition": {
                "line": 232,
                "column": 7
              },
              "endPosition": {
                "line": 232,
                "column": 47
              }
            }
          ]
        },
        "detailedLines": [
          {
            "text": "const TagSection: React.FC&lt;TagSectionProps&gt; = ",
            "lineNumber": 232
          },
          {
            "lineNumber": 311
          },
          {
            "lineNumber": 312
          },
          {
            "text": "  return (",
            "lineNumber": 313
          },
          {
            "text": "    &lt;div className=\"select-none text-sm text-gray-600 dark:text-gray-300 relative\"&gt;",
            "lineNumber": 314
          },
          {
            "text": "       &lt;div ",
            "lineNumber": 315
          },
          {
            "text": "        className=\"flex items-center py-1 px-2 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-800 mt-2 group\"",
            "lineNumber": 316
          },
          {
            "text": "      &gt;",
            "lineNumber": 317
          },
          {
            "text": "        &lt;div className=\"p-1 mr-1 hover:bg-black/10 dark:hover:bg-white/10 rounded\" onClick={() =&gt; setExpanded(!expanded)}&gt;",
            "lineNumber": 318
          },
          {
            "text": "           {expanded ? &lt;ChevronDown size={14} /&gt; : &lt;ChevronRight size={14} /&gt;}",
            "lineNumber": 319
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 320
          },
          {
            "text": "        &lt;div className=\"flex items-center flex-1\" onClick={onNavigateAllTags}&gt;",
            "lineNumber": 321
          },
          {
            "text": "          &lt;TagIcon size={14} className=\"mr-2 text-blue-500 dark:text-blue-400\" /&gt;",
            "lineNumber": 322
          },
          {
            "text": "          &lt;span className=\"font-bold text-gray-500 dark:text-gray-400 text-xs uppercase tracking-wider group-hover:text-black dark:group-hover:text-white transition-colors\"&gt;{t('sidebar.allTags')} ({sortedTags.length})&lt;/span&gt;",
            "lineNumber": 323
          },
          {
            "text": "        &lt;/div&gt;",
            "lineNumber": 324
          },
          {
            "text": "        &lt;button ",
            "lineNumber": 325
          },
          {
            "text": "           className=\"p-1 rounded hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors opacity-0 group-hover:opacity-100\"",
            "lineNumber": 326
          },
          {
            "text": "           onClick={(e) =&gt; { e.stopPropagation(); onStartCreateTag(); }}",
            "lineNumber": 327
          },
          {
            "text": "           title={t('context.newTag')}",
            "lineNumber": 328
          },
          {
            "text": "        &gt;",
            "lineNumber": 329
          },
          {
            "text": "           &lt;Plus size={14} /&gt;",
            "lineNumber": 330
          },
          {
            "text": "        &lt;/button&gt;",
            "lineNumber": 331
          },
          {
            "text": "      &lt;/div&gt;",
            "lineNumber": 332
          },
          {
            "lineNumber": 333
          },
          {
            "text": "      {expanded &amp;&amp;",
            "lineNumber": 334
          }
        ]
      },
      "score": 0.2998102903366089
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


查看 `TagsList` 组件的实现：


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "TagsList|const TagsList",
  "path": "src/components/FileGrid.tsx",
  "contextAfter": 50,
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "TagsList|const TagsList",
    "path": "src/components/FileGrid.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/components/FileGrid.tsx",
              "matches": [
                {
                  "lineNumber": 567,
                  "content": "const TagsList = React.memo(({ groupedTags, keys, files, selectedTagIds, onTagClick, onTagDoubleClick, onTagContextMenu, t }: any) =&gt; {"
                },
                {
                  "lineNumber": 568,
                  "content": "  const [hoveredTag, setHoveredTag] = useState&lt;string | null&gt;(null);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 569,
                  "content": "  const [hoveredTagPos, setHoveredTagPos] = useState&lt;{ top: number, left: number } | null&gt;(null);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 570,
                  "content": "  const hoverTimerRef = useRef&lt;ReturnType&lt;typeof setTimeout&gt; | null&gt;(null);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 571,
                  "isContextLine": true
                },
                {
                  "lineNumber": 572,
                  "content": "  const tagCounts = useMemo(() =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 573,
                  "content": "      const counts: Record&lt;string, number&gt; = {};",
                  "isContextLine": true
                },
                {
                  "lineNumber": 574,
                  "content": "      Object.values(files).forEach((f: any) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 575,
                  "content": "          if (f.tags) {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 576,
                  "content": "              f.tags.forEach((t: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 577,
                  "content": "                  counts[t] = (counts[t] || 0) + 1;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 578,
                  "content": "              });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 579,
                  "content": "          }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 580,
                  "content": "      });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 581,
                  "content": "      return counts;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 582,
                  "content": "  }, [files]);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 583,
                  "isContextLine": true
                },
                {
                  "lineNumber": 584,
                  "content": "  const previewImages = useMemo(() =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 585,
                  "content": "    if (!hoveredTag) return [];",
                  "isContextLine": true
                },
                {
                  "lineNumber": 586,
                  "content": "    return Object.values(files)",
                  "isContextLine": true
                },
                {
                  "lineNumber": 587,
                  "content": "      .filter((f: any) =&gt; f.type === FileType.IMAGE &amp;&amp; f.tags.includes(hoveredTag))",
                  "isContextLine": true
                },
                {
                  "lineNumber": 588,
                  "content": "      .sort((a: any, b: any) =&gt; (b.createdAt || '').localeCompare(a.createdAt || ''))",
                  "isContextLine": true
                },
                {
                  "lineNumber": 589,
                  "content": "      .slice(0, 3);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 590,
                  "content": "  }, [hoveredTag, files]);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 591,
                  "isContextLine": true
                },
                {
                  "lineNumber": 592,
                  "content": "  const handleMouseEnter = useCallback((e: React.MouseEvent, tag: string) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 593,
                  "content": "    const target = e.currentTarget as HTMLElement;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 594,
                  "content": "    if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 595,
                  "isContextLine": true
                },
                {
                  "lineNumber": 596,
                  "content": "    hoverTimerRef.current = setTimeout(() =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 597,
                  "content": "      const rect = target.getBoundingClientRect();",
                  "isContextLine": true
                },
                {
                  "lineNumber": 598,
                  "content": "      const PREVIEW_WIDTH = 256;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 599,
                  "content": "      const PREVIEW_HEIGHT = 120;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 600,
                  "isContextLine": true
                },
                {
                  "lineNumber": 601,
                  "content": "      let left = rect.left + (rect.width / 2) - (PREVIEW_WIDTH / 2);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 602,
                  "content": "      let top = rect.bottom + 10;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 603,
                  "isContextLine": true
                },
                {
                  "lineNumber": 604,
                  "content": "      if (left &lt; 10) left = 10;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 605,
                  "content": "      if (left + PREVIEW_WIDTH &gt; window.innerWidth) left = window.innerWidth - PREVIEW_WIDTH - 10;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 606,
                  "content": "      if (top + PREVIEW_HEIGHT &gt; window.innerHeight) top = rect.top - PREVIEW_HEIGHT - 10;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 607,
                  "isContextLine": true
                },
                {
                  "lineNumber": 608,
                  "content": "      setHoveredTagPos({ top, left });",
                  "isContextLine": true
                },
                {
                  "lineNumber": 609,
                  "content": "      setHoveredTag(tag);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 610,
                  "content": "    }, 600);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 611,
                  "content": "  }, []);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 612,
                  "isContextLine": true
                },
                {
                  "lineNumber": 613,
                  "content": "  const handleMouseLeave = useCallback(() =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 614,
                  "content": "    if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 615,
                  "content": "    setHoveredTag(null);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 616,
                  "content": "    setHoveredTagPos(null);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 617,
                  "content": "  }, []);",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1834,
                  "content": "              &lt;TagsList"
                },
                {
                  "lineNumber": 1835,
                  "content": "                  groupedTags={groupedTags || {}}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1836,
                  "content": "                  keys={sortedKeys}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1837,
                  "content": "                  files={files}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1838,
                  "content": "                  selectedTagIds={activeTab.selectedTagIds}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1839,
                  "content": "                  onTagClick={handleTagClickStable}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1840,
                  "content": "                  onTagDoubleClick={handleTagDoubleClickStable}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1841,
                  "content": "                  onTagContextMenu={handleTagContextMenuStable}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1842,
                  "content": "                  t={t}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1843,
                  "content": "              /&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1844,
                  "content": "          &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1845,
                  "content": "      );",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1846,
                  "content": "  }",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1847,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1848,
                  "content": "  return (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1849,
                  "content": "      &lt;div",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1850,
                  "content": "          ref={containerRef}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1851,
                  "content": "          className={&#96;relative w-full h-full overflow-auto&#96;}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1852,
                  "content": "          onContextMenu={onBackgroundContextMenu}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1853,
                  "content": "          onMouseDown={onMouseDown}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1854,
                  "content": "          onMouseMove={onMouseMove}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1855,
                  "content": "          onMouseUp={onMouseUp}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1856,
                  "content": "      &gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1857,
                  "content": "          &lt;div className=\"absolute inset-0 pointer-events-none z-50\"&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1858,
                  "content": "              {selectionBox &amp;&amp; (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1859,
                  "content": "                  &lt;div",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1860,
                  "content": "                      className=\"absolute border-2 border-blue-500 bg-blue-100 dark:bg-blue-900/20 opacity-50 pointer-events-none\"",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1861,
                  "content": "                      style={{",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1862,
                  "content": "                          left: Math.min(selectionBox.startX, selectionBox.currentX),",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1863,
                  "content": "                          top: Math.min(selectionBox.startY, selectionBox.currentY),",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1864,
                  "content": "                          width: Math.abs(selectionBox.currentX - selectionBox.startX),",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1865,
                  "content": "                          height: Math.abs(selectionBox.currentY - selectionBox.startY),",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1866,
                  "content": "                      }}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1867,
                  "content": "                  /&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1868,
                  "content": "              )}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1869,
                  "content": "          &lt;/div&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1870,
                  "isContextLine": true
                },
                {
                  "lineNumber": 1871,
                  "content": "          {activeTab.viewMode === 'people-overview' ? (",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1872,
                  "content": "              &lt;div className=\"w-full\" style={{ position: 'relative', minHeight: '100%' }}&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1873,
                  "content": "                  &lt;div style={{ position: 'relative' }}&gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1874,
                  "content": "                      &lt;div",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1875,
                  "content": "                          className=\"relative\"",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1876,
                  "content": "                          style={{",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1877,
                  "content": "                              width: '100%',",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1878,
                  "content": "                              height: totalHeight,",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1879,
                  "content": "                              position: 'relative'",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1880,
                  "content": "                          }}",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1881,
                  "content": "                      &gt;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1882,
                  "content": "                          {visibleItems.map((item) =&gt; {",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1883,
                  "content": "                              const person = people ? people[item.id] : null;",
                  "isContextLine": true
                },
                {
                  "lineNumber": 1884,
                  "content": "                              if (!person) return null;",
                  "isContextLine": true
                }
              ]
            }
          ],
          "totalLines": 102,
          "totalMatchedLines": 2
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---



---


为标签面板添加与人物面板相同的搜索逻辑：


---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] 修改 TagsList 组件，添加 searchQuery 参数并根据搜索查询过滤标签
- [ ] 修改 FileGrid 组件，在 tags-overview 模式下传递 searchQuery 给 TagsList
- [ ] 修改 TopBar 组件，在标签面板时隐藏搜索范围选择器并更新占位符
- [ ] 修改 App 组件中的搜索处理逻辑，确保在标签面板时搜索只应用于标签

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "f54e9337-98eb-48b2-adf9-7e826d4e6556"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---



---


修改 `TagsList` 组件，添加搜索过滤逻辑：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "e96593cb-e22f-4880-9557-45b190383878"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "7d049b10-e697-4cae-a632-37495bdd1cd3"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "db2032a5-6596-428b-84ff-c7af0c4bac55"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "954dabeb-3f15-47a0-805e-8c7fcad2eb77"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "d91e6dab-270d-4e90-b6fe-4418b3d242c5"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "8036c9bb-30df-446a-987c-0acb85ac4b1b"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] 修改 TagsList 组件，添加 searchQuery 参数并根据搜索查询过滤标签
- [x] 修改 FileGrid 组件，在 tags-overview 模式下传递 searchQuery 给 TagsList
- [-] 修改 TopBar 组件，在标签面板时隐藏搜索范围选择器并更新占位符
- [ ] 修改 App 组件中的搜索处理逻辑，确保在标签面板时搜索只应用于标签

</details>
</tool-use>

---



---


修改 `TopBar` 组件，在标签面板时隐藏搜索范围选择器并更新占位符：


---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "d80cead8-2a19-489d-8670-d3fc51957670"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "4777ce7f-acd2-4cb6-9582-1bcdbbb5e52d"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] 修改 TagsList 组件，添加 searchQuery 参数并根据搜索查询过滤标签
- [x] 修改 FileGrid 组件，在 tags-overview 模式下传递 searchQuery 给 TagsList
- [x] 修改 TopBar 组件，在标签面板时隐藏搜索范围选择器并更新占位符
- [-] 修改 App 组件中的搜索处理逻辑，确保在标签面板时搜索只应用于标签

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "9926f490-fd69-43c4-a09d-18e449c6f20d"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="edit_file_v2">
<details>
<summary>Tool use: **edit_file_v2**</summary>

Additional data:

```json
{
  "codeblockId": "b0b4dc63-87d2-4b56-a3a5-420968a8eefc"
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] 修改 TagsList 组件，添加 searchQuery 参数并根据搜索查询过滤标签
- [x] 修改 FileGrid 组件，在 tags-overview 模式下传递 searchQuery 给 TagsList
- [x] 修改 TopBar 组件，在标签面板时隐藏搜索范围选择器并更新占位符
- [x] 修改 App 组件中的搜索处理逻辑，确保在标签面板时搜索只应用于标签

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "src/components/FileGrid.tsx",
    "src/components/TopBar.tsx",
    "src/App.tsx"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "src/components/FileGrid.tsx"
    },
    {
      "relativeWorkspacePath": "src/components/TopBar.tsx"
    },
    {
      "relativeWorkspacePath": "src/App.tsx"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---



---


检查 `TagsList` 组件，确保所有引用都已更新：


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: src/components/FileGrid.tsx</summary>

</details>
</tool-use>

---



---


所有修改已完成。验证关键部分：


---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "tags-overview|people-overview",
  "path": "src/components/TopBar.tsx",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "tags-overview|people-overview",
    "path": "src/components/TopBar.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/components/TopBar.tsx",
              "matches": [
                {
                  "lineNumber": 531,
                  "content": "          {activeTab.viewMode !== 'people-overview' &amp;&amp; activeTab.viewMode !== 'tags-overview' &amp;&amp; ("
                },
                {
                  "lineNumber": 573,
                  "content": "              activeTab.viewMode === 'people-overview'"
                },
                {
                  "lineNumber": 575,
                  "content": "                : activeTab.viewMode === 'tags-overview'"
                },
                {
                  "lineNumber": 724,
                  "content": "                       min={activeTab.viewMode === 'people-overview' ? 140 : 100}"
                },
                {
                  "lineNumber": 725,
                  "content": "                       max={activeTab.viewMode === 'people-overview' ? 450 : 480}"
                }
              ]
            }
          ],
          "totalLines": 5,
          "totalMatchedLines": 5
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "filteredGroupedTags|filteredKeys",
  "path": "src/components/FileGrid.tsx",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "filteredGroupedTags|filteredKeys",
    "path": "src/components/FileGrid.tsx",
    "outputMode": "content",
    "workspaceResults": {
      "c:\\Users\\Misaki\\Desktop\\git\\aurora-gallery-tauri": {
        "content": {
          "matches": [
            {
              "file": "src/components/FileGrid.tsx",
              "matches": [
                {
                  "lineNumber": 573,
                  "content": "  const filteredGroupedTags = useMemo(() =&gt; {"
                },
                {
                  "lineNumber": 591,
                  "content": "  const filteredKeys = useMemo(() =&gt; {"
                },
                {
                  "lineNumber": 592,
                  "content": "      return Object.keys(filteredGroupedTags).sort();"
                },
                {
                  "lineNumber": 593,
                  "content": "  }, [filteredGroupedTags]);"
                },
                {
                  "lineNumber": 645,
                  "content": "      {filteredKeys.length &gt; 0 &amp;&amp; ("
                },
                {
                  "lineNumber": 667,
                  "content": "            {filteredKeys.map((group: string) =&gt; ("
                },
                {
                  "lineNumber": 687,
                  "content": "      {filteredKeys.length === 0 &amp;&amp; ("
                },
                {
                  "lineNumber": 693,
                  "content": "      {filteredKeys.map((group: string) =&gt; {"
                },
                {
                  "lineNumber": 694,
                  "content": "          const tagsInGroup = filteredGroupedTags[group];"
                }
              ]
            }
          ],
          "totalLines": 9,
          "totalMatchedLines": 9
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---



---


所有修改已完成。总结如下：

## 修改总结

已为标签面板添加与人物面板相同的搜索逻辑：

### 1. **修改 `TagsList` 组件** (`src/components/FileGrid.tsx`)：
   - 添加 `searchQuery` 参数
   - 添加 `filteredGroupedTags`，根据搜索查询过滤标签
   - 添加 `filteredKeys`，基于过滤后的标签生成键
   - 更新组件，使用过滤后的标签和键

### 2. **修改 `FileGrid` 组件** (`src/components/FileGrid.tsx`)：
   - 在 `tags-overview` 模式下，将 `activeTab.searchQuery` 传递给 `TagsList`

### 3. **修改 `TopBar` 组件** (`src/components/TopBar.tsx`)：
   - 在标签面板时隐藏搜索范围选择器（`viewMode !== 'tags-overview'` 时显示）
   - 更新占位符：标签面板显示“搜索标签”，人物面板显示“搜索人物”，其他模式显示原有占位符

### 4. **修改 `App` 组件** (`src/App.tsx`)：
   - 更新 `onPerformSearch`：在标签面板时只更新搜索查询，不切换视图
   - 更新 `onSetToolbarQuery`：在标签面板时实时更新 `activeTab.searchQuery`，实现实时过滤

## 功能说明

- 在标签面板时：搜索框仅搜索标签名称，搜索范围选择器隐藏，占位符显示“搜索标签”
- 在人物面板时：搜索框仅搜索人物名称，搜索范围选择器隐藏，占位符显示“搜索人物”
- 离开标签/人物面板时：搜索功能恢复，搜索范围选择器显示，占位符恢复原样

所有更改已完成，代码已通过 linter 检查。

---

_**User**_

目前在所有标签面板下还存在有一个搜索框，删掉它 DOM Path: div#root > div.w-full h-full flex flex-col bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 overflow-hidden font-.an. tran.ition-color. duration-300 > div.flex-1 flex overflow-hidden relative tran.ition-all duration-300 ea.e-[cubic-bezier(0.25,0.1,0.25,1)] > div.flex-1 flex flex-col min-w-0 relative bg-white dark:bg-gray-950 > div.flex-1 flex flex-col relative bg-white dark:bg-gray-950 overflow-hidden > div.h-14 flex item.-center ju.tify-between px-4 text-x. text-gray-500 dark:text-gray-400 border-b border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-950/50 backdrop-blur .hrink-0 relative z-20 > div.flex item.-center w-full > div.flex-1 flex ju.tify-end > div.relative > div.flex item.-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 tran.ition-all border border-tran.parent
Position: top=108px, left=798px, width=250px, height=34px
React Component: App
HTML Element: <div class="flex items-center bg-gray-100 dark:bg-gray-800 rounded-full px-3 py-1.5 transition-all border border-transparent"></div> 

---

